# Specification: Adaptive Mastery System

**Track ID:** adaptive_mastery_20260220
**Type:** Feature
**Created:** 2026-02-20
**Status:** Draft

## Summary

A knowledge-graph-powered adaptive tutoring layer that adds Bayesian Knowledge Tracing with forgetting-curve decay, Obsidian vault integration, concept-map-based curriculum gating, adaptive scaffolding with localized failure mapping, teach-back gates, and Graph RAG-lite retrieval with subgraph pruning to the PT Study OS tutor.

## Context

PT Study OS currently has an adaptive tutor with LangChain-based chains, RAG via ChromaDB, method library, and tool-calling. This track adds a principled student model (BKT + forgetting curve), a curriculum controller driven by a concept map with prerequisite gating, and enriched retrieval via a knowledge graph seeded from Obsidian notes and course PDFs.

## User Story

As a DPT student, I want the tutor to track my mastery per concept with time-aware decay, gate content by prerequisites, scaffold and fade adaptively based on my performance, and retrieve context grounded in my own notes and the knowledge graph, so that I study efficiently with evidence-based spacing and scaffolding.

## Acceptance Criteria

- [ ] Skill mastery tracked per concept via BKT with configurable priors
- [ ] Effective mastery decays over time (forgetting curve) and drives gating/fading/scheduling
- [ ] Obsidian vault notes ingested with alias normalization and incremental updates
- [ ] Concept map controls curriculum: Locked / Available / Mastered per node
- [ ] Adaptive scaffolding fades hints based on mastery; "Evaluate My Work" localizes failure to specific skill_id/edge_id
- [ ] Teach-back gate prevents false mastery (Feynman technique)
- [ ] Knowledge graph seeded from Obsidian links + typed relation extraction
- [ ] Graph RAG retrieval uses hybrid vector+graph with subgraph pruning (PCST or equivalent)
- [ ] All structured outputs enforce JSON Schema contracts
- [ ] Practice telemetry captures every attempt, hint, and evaluation
- [ ] Metrics dashboard tracks mastery trajectory, hint dependence, error recurrence
- [ ] Session toggles enable controlled n-of-1 comparisons

## Dependencies

- Existing tutor infrastructure: `brain/tutor_chains.py`, `brain/tutor_rag.py`, `brain/dashboard/api_tutor.py`
- Existing RAG: ChromaDB at `brain/data/chroma_tutor/`
- Obsidian vault: `C:\Users\treyt\Desktop\Treys School`
- SQLite DB: `brain/data/pt_study.db`
- OpenRouter LLM access for relation extraction and tutor chains

## Out of Scope

- Multi-user support (single-user system)
- Real-time collaboration
- Mobile-native app (web dashboard only)
- Full knowledge graph visualization editor (read-only map view)
- Automated curriculum generation from scratch (manual vault notes are the source)

## Technical Notes

- **BKT parameters**: prior mastery, p_learn, p_guess, p_slip, decay rate lambda — all configurable
- **Forgetting curve**: `p_effective = p_latent * exp(-lambda * delta_t)` or logistic variant
- **Subgraph pruning**: Prize-Collecting Steiner Tree (PCST) or greedy approximation with token budget constraint
- **Entity resolution**: alias table from YAML frontmatter `aliases` field
- **Pedagogical moves**: hint, analogy, metacognitive prompt, evaluate-work, teach-back, synthesis
- **Fading**: multi-level ladder driven by effective mastery and hint dependence metric
- **Phases are strictly ordered**: 0 → 1 → 2 → 3 → 4 → 5 → 6 → 7 → 8 → 9

---

_Generated by Conductor. Review and edit as needed._
