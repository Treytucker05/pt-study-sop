import{c as ae,j as e,b as Ke,r as n,X as Ne,u as Me}from"./index-CIQFb-IM.js";import{f as W,a as D,S as pe,E as we,F as Ge,B as K,G as ze,I as Qe,o as Re,p as Be,n as Xe,L as fe}from"./layout-Be2Ma5qg.js";import{B as q,C as ge}from"./badge-Q79Q95Tm.js";import{I as E,T as C,d as te,e as re,f as H,g as de,h as be,P as le,i as ke,j as Ye,b as Ve}from"./theme-DpbbgCLl.js";import{C as ne}from"./checkbox-3MKVtgPj.js";import{M as He,t as P}from"./MaterialUploader-BVZ2CqfX.js";import{L as xe}from"./loader-circle-DtQE5mS4.js";import{F as he}from"./file-text-CAqfbFKa.js";import{C as Ce,a as Fe}from"./index-CZFdgV4q.js";import{C as ue}from"./clock-D-iMQ5PJ.js";import{Z as Se}from"./zap-DcQSkSdw.js";import{D as We,C as $e,F as Ie,a as Je,b as Ze,M as er,r as rr,P as sr}from"./index-oWa1nVJa.js";import{L as tr}from"./link-BGVJsJET.js";import{S as ar,a as nr}from"./send-B72VAHgW.js";import{S as ir}from"./square-BbA27wPN.js";import{M as je}from"./message-square-ub1Q4Z9q.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],lr=ae("cloud",or);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Pe=ae("credit-card",cr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],mr=ae("cpu",dr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],_e=ae("globe",xr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],qe=ae("map",ur);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],hr=ae("panel-right-close",pr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],gr=ae("settings-2",fr);function oe({className:t,...a}){return e.jsx("div",{className:Ke("animate-pulse rounded-md bg-primary/10",t),...a})}const br={pdf:"PDF",docx:"DOC",pptx:"PPT",md:"MD",txt:"TXT"};function yr({courseId:t,selectedMaterials:a,setSelectedMaterials:f}){const{data:b=[],isLoading:p}=W({queryKey:["tutor-materials",t],queryFn:()=>D.tutor.getMaterials(t?{course_id:t}:void 0)}),T=c=>{f(a.includes(c)?a.filter(A=>A!==c):[...a,c])},h=()=>{a.length===b.length?f([]):f(b.map(c=>c.id))};return p?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx(xe,{className:`${E} animate-spin text-muted-foreground`})}):b.length===0?e.jsx("div",{className:`${C} text-center py-2`,children:"No materials uploaded yet"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${te} text-muted-foreground hover:text-foreground cursor-pointer border-b border-muted-foreground/10 pb-1`,children:[e.jsx(ne,{checked:b.length>0&&a.length===b.length,onCheckedChange:h,className:"w-3 h-3"}),e.jsx("span",{children:"Select all"}),e.jsxs(q,{variant:"outline",className:`ml-auto ${re} h-4 px-1`,children:[a.length,"/",b.length]})]}),b.map(c=>e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${te} text-muted-foreground hover:text-foreground cursor-pointer`,children:[e.jsx(ne,{checked:a.includes(c.id),onCheckedChange:()=>T(c.id),className:"w-3 h-3"}),e.jsx(he,{className:`${E} text-primary/60 shrink-0`}),e.jsx("span",{className:"truncate flex-1",children:c.title}),e.jsx(q,{variant:"outline",className:`${re} h-4 px-1 shrink-0`,children:br[c.file_type]||c.file_type.toUpperCase()})]},c.id))]})}const Ee=["prepare","encode","interrogate","retrieve","refine","overlearn"];function jr({selectedBlockIds:t,setSelectedBlockIds:a}){const{data:f=[],isLoading:b}=W({queryKey:["tutor-method-blocks"],queryFn:()=>D.tutor.getMethodBlocks()}),[p,T]=n.useState(new Set),[h,c]=n.useState(null),[A,y]=n.useState(null),k=n.useMemo(()=>{const l=new Map;for(const d of f)l.set(d.id,d);return l},[f]),$=n.useMemo(()=>{const l={};for(const d of Ee)l[d]=[];for(const d of f)l[d.category]||(l[d.category]=[]),l[d.category].push(d);return l},[f]),u=n.useMemo(()=>t.map(l=>k.get(l)).filter(Boolean),[t,k]),_=n.useMemo(()=>u.reduce((l,d)=>l+(d.default_duration_min||0),0),[u]),L=l=>{T(d=>{const g=new Set(d);return g.has(l)?g.delete(l):g.add(l),g})},r=l=>{a([...t,l])},o=l=>{a(t.filter((d,g)=>g!==l))},m=l=>{c(l)},i=(l,d)=>{l.preventDefault(),y(d)},j=l=>{if(h===null||h===l){c(null),y(null);return}const d=[...t],[g]=d.splice(h,1);d.splice(l,0,g),a(d),c(null),y(null)},v=()=>{c(null),y(null)};return b?e.jsx("div",{className:`${C} p-2`,children:"Loading blocks..."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`${H} text-xs`,children:"BLOCK PICKER"}),e.jsx(pe,{className:"h-36 border-2 border-primary/30 bg-black/20",children:e.jsx("div",{className:"p-1",children:Ee.map(l=>{const d=$[l]||[];if(d.length===0)return null;const g=p.has(l),M=we[l];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>L(l),className:"w-full flex items-center gap-1 px-2 py-1 text-left hover:bg-black/30 transition-colors",children:[g?e.jsx(Ce,{className:"w-3 h-3",style:{color:M}}):e.jsx(Fe,{className:"w-3 h-3",style:{color:M}}),e.jsxs("span",{className:"font-arcade text-xs uppercase",style:{color:M},children:[Ge[l]," (",d.length,")"]})]}),!g&&e.jsx("div",{className:"pl-4 pb-1 space-y-0.5",children:d.map(U=>e.jsxs("button",{onClick:()=>r(U.id),className:"w-full text-left px-2 py-1 text-xs font-terminal text-foreground/80 hover:bg-primary/10 hover:text-foreground transition-colors flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:U.name}),e.jsxs("span",{className:`${C} text-xs shrink-0 ml-2`,children:["~",U.default_duration_min,"m"]})]},U.id))})]},l)})})}),e.jsxs("div",{className:`${H} text-xs flex items-center justify-between`,children:[e.jsx("span",{children:"YOUR CHAIN"}),u.length>0&&e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>a([]),className:"h-5 px-2 text-xs font-arcade text-destructive hover:text-destructive",children:"CLEAR"})]}),e.jsx("div",{className:"border-2 border-primary/30 bg-black/20 min-h-[60px]",children:u.length===0?e.jsx("div",{className:`${C} text-xs p-3 text-center`,children:"Click blocks above to build your study chain"}):e.jsx("div",{className:"p-1 space-y-0.5",children:u.map((l,d)=>{const g=we[l.category]||"#888";return e.jsxs("div",{draggable:!0,onDragStart:()=>m(d),onDragOver:M=>i(M,d),onDrop:()=>j(d),onDragEnd:v,className:`flex items-center gap-1 px-2 py-1 border transition-all ${A===d?"border-primary bg-primary/20":"border-primary/20 bg-black/30"}`,children:[e.jsx(ze,{className:"w-3 h-3 text-muted-foreground/40 cursor-grab shrink-0"}),e.jsx(q,{variant:"outline",className:"text-xs rounded-none px-1 h-4 shrink-0",style:{borderColor:g,color:g},children:l.category.slice(0,3).toUpperCase()}),e.jsx("span",{className:"font-terminal text-xs text-foreground/80 truncate flex-1",children:l.name}),e.jsxs("span",{className:`${C} text-xs shrink-0`,children:["~",l.default_duration_min,"m"]}),e.jsx("button",{onClick:()=>o(d),className:"shrink-0 text-muted-foreground/40 hover:text-destructive transition-colors",children:e.jsx(Ne,{className:"w-3 h-3"})})]},`${l.id}-${d}`)})})}),u.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("span",{className:`${C} text-xs`,children:[u.length," block",u.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1 font-terminal text-xs text-primary",children:[e.jsx(ue,{className:E}),"~",_," min"]})]})]})}const me=[{value:"arcee-ai/trinity-large-preview:free",label:"Trinity Large (free)"},{value:"qwen/qwen3-coder-next",label:"Qwen3 Coder Next"},{value:"google/gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite"}],vr=[{value:"Core",label:"LEARN",desc:"Prime + encode"},{value:"Sprint",label:"REVIEW",desc:"Retrieve + refine"},{value:"Quick Sprint",label:"QUICK",desc:"Quick retrieval"},{value:"Light",label:"LIGHT",desc:"Low energy"},{value:"Drill",label:"FIX",desc:"Target weak spots"}],Nr=["Teaching Sprint","Diagnostic Sprint"],Te={Core:"First Exposure (Core)",Sprint:"Review Sprint","Quick Sprint":"Quick Drill",Light:"Low Energy",Drill:"Mastery Review","Teaching Sprint":"First Exposure (Core)","Diagnostic Sprint":"Review Sprint"},Ae="tutor.autopick_chain.v1",Le="tutor.last_openrouter_model.v1",Oe="tutor.last_codex_model.v1";function ve(t){try{return localStorage.getItem(t)}catch{return null}}function ye(t,a){try{localStorage.setItem(t,a)}catch{}}function kr(t,a){const f=ve(t);return f===null?a:f==="true"}function se({children:t,icon:a}){return e.jsxs("div",{className:`${H} flex items-center gap-1.5 pb-1 border-b border-primary/20 mb-2`,children:[a,t]})}function De({courseId:t,setCourseId:a,selectedMaterials:f,setSelectedMaterials:b,mode:p,setMode:T,chainId:h,setChainId:c,customBlockIds:A,setCustomBlockIds:y,topic:k,setTopic:$,model:u,setModel:_,webSearch:L,setWebSearch:r,onStartSession:o,isStarting:m,hasActiveSession:i,compact:j=!1}){const{data:v,isLoading:l,isError:d}=W({queryKey:["tutor-content-sources"],queryFn:()=>D.tutor.getContentSources()}),{data:g=[],isLoading:M,isError:U}=W({queryKey:["tutor-template-chains"],queryFn:()=>D.tutor.getTemplateChains()}),{data:J=[],isLoading:Q}=W({queryKey:["courses-active"],queryFn:()=>D.courses.getActive()}),R=v?.openrouter_enabled??!1,w=u.includes("/")?"openrouter":"codex";n.useEffect(()=>{!R&&w==="openrouter"&&_("codex")},[R,w,_]),n.useEffect(()=>{u&&(u.includes("/")?ye(Le,u):ye(Oe,u))},[u]);const[F,Z]=n.useState(()=>kr(Ae,!0)),[X,z]=n.useState(null),[O,G]=n.useState("templates");n.useEffect(()=>{ye(Ae,String(F))},[F]);const N=Te[p],I=n.useMemo(()=>{if(N)return g.find(s=>s.name===N)},[g,N]);n.useEffect(()=>{F&&h===void 0&&I&&X!==p&&(c(I.id),z(p))},[F,h,I?.id,X,p,c]);const Y=s=>{if(T(s),!F||h!==void 0)return;const V=Te[s];if(!V)return;const x=g.find(S=>S.name===V);x&&(c(x.id),z(s))},ce=()=>{const s=ve(Oe),V=s&&!s.includes("/")?s:"codex";_(V)},ie=()=>{if(!R)return;const s=ve(Le),V=s&&s.includes("/")?s:me[0].value;_(V)};return n.useEffect(()=>{w==="openrouter"&&(me.some(s=>s.value===u)||_(me[0].value))},[w,u,_]),j?(g.find(s=>s.id===h)?.name,e.jsxs("div",{className:"flex flex-wrap items-end gap-3 p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`${H} mb-1`,children:"Mode"}),e.jsx("select",{value:p,onChange:s=>Y(s.target.value),className:`${de} border-2 border-primary/30 h-9 w-[140px]`,children:vr.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${H} mb-1`,children:"Chain"}),e.jsxs("select",{value:h??"",onChange:s=>c(s.target.value?Number(s.target.value):void 0),className:`${de} border-2 border-primary/30 h-9 w-[180px]`,children:[e.jsx("option",{value:"",children:"Freeform"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${H} mb-1`,children:"Topic"}),e.jsx("input",{value:k,onChange:s=>$(s.target.value),placeholder:"e.g. Hip Flexors",className:`${be} border-2 border-primary/30 h-9 w-[180px]`})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${H} mb-1`,children:"Model"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:ce,className:`px-3 h-9 border-2 font-arcade text-xs transition-colors ${w==="codex"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"CODEX"}),e.jsx("button",{onClick:ie,disabled:!R,className:`px-3 h-9 border-2 font-arcade text-xs transition-colors ${w==="openrouter"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"} ${R?"":"opacity-50 cursor-not-allowed"}`,children:"OR"})]})]}),e.jsxs("label",{className:`flex items-center gap-1.5 h-9 cursor-pointer ${w!=="codex"?"opacity-50":""}`,children:[e.jsx(ne,{checked:L,onCheckedChange:s=>w==="codex"&&r(!!s),disabled:w!=="codex",className:"w-3.5 h-3.5"}),e.jsx(_e,{className:E}),e.jsx("span",{className:"font-terminal text-xs",children:"Web"})]}),e.jsxs(K,{onClick:o,disabled:m||i,className:`h-9 px-5 rounded-none border-2 font-arcade text-xs ${i?"border-success/50 bg-success/10 text-success cursor-default":m?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[m?e.jsx(xe,{className:`${E} animate-spin mr-1`}):i?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success animate-pulse"}),"ACTIVE"]}):e.jsx(Se,{className:`${E} mr-1`}),!m&&!i&&"START"]})]})):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`shrink-0 ${le} pb-2 border-b-2 border-primary/30`,children:[e.jsx("div",{className:ke,children:"CONTENT FILTER"}),(d||U)&&e.jsxs("div",{className:`${C} text-destructive`,children:["Tutor API unavailable. Start the dashboard via ",e.jsx("span",{className:"font-arcade",children:"Start_Dashboard.bat"}),"."]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 ${C}`,children:[e.jsx(We,{className:E}),v?.total_materials??0," materials",e.jsx("span",{className:"text-muted-foreground/40",children:"|"}),v?.total_instructions??0," SOP"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsxs("div",{className:`${le} space-y-2`,children:[e.jsxs("div",{children:[e.jsx(se,{children:"Mode"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>Y("Core"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Core"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LEARN"}),e.jsx("div",{className:`${C} text-xs leading-tight truncate`,children:"Prime + encode"})]}),e.jsxs("button",{onClick:()=>Y("Quick Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Quick Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"QUICK"}),e.jsx("div",{className:`${C} text-xs leading-tight truncate`,children:"Quick retrieval"})]})]}),e.jsx("button",{onClick:()=>Y("Drill"),className:`w-full text-left px-2 py-2 border-2 transition-colors ${p==="Drill"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"FIX"}),e.jsx("div",{className:`${C} text-xs leading-tight`,children:"Target weak spots"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>Y("Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"REVIEW"}),e.jsx("div",{className:`${C} text-xs leading-tight truncate`,children:"Retrieve + refine"})]}),e.jsxs("button",{onClick:()=>Y("Light"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Light"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LIGHT"}),e.jsx("div",{className:`${C} text-xs leading-tight truncate`,children:"Low energy"})]})]})]}),e.jsx("div",{className:`${C} text-xs mt-2`,children:"Auto-picks a chain template. Override below."}),Nr.includes(p)&&e.jsxs("div",{className:`${C} text-xs mt-1`,children:["Legacy mode active: ",p]})]}),e.jsxs("div",{children:[e.jsx(se,{icon:e.jsx(tr,{className:E}),children:"Chain"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mb-2 min-w-0",children:[e.jsx("button",{onClick:()=>G("templates"),className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${O==="templates"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"TEMPLATES"}),e.jsx("button",{onClick:()=>{G("custom"),c(void 0)},className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${O==="custom"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"CUSTOM"})]}),O==="templates"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:`${C} text-xs min-w-0 truncate`,children:[e.jsx("span",{className:"opacity-70",children:"Rec:"})," ",I?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground font-medium",children:I.name}),e.jsxs(q,{variant:"outline",className:`ml-1 ${re} h-4 px-1.5 text-xs`,children:[I.blocks.length," blocks"]})]}):M?e.jsx(oe,{className:"inline-block w-20 h-4 bg-primary/10"}):e.jsx("span",{className:"opacity-70",children:"—"})]}),I&&h!==I.id&&e.jsx(K,{size:"sm",onClick:()=>c(I.id),className:"rounded-none h-6 px-2 font-arcade text-xs bg-primary text-primary-foreground hover:bg-primary/90 border border-primary",children:"APPLY"})]}),e.jsxs("label",{className:`flex items-center gap-2 ${te} text-muted-foreground mb-2 cursor-pointer`,children:[e.jsx(ne,{checked:F,onCheckedChange:s=>Z(s===!0),className:"w-3 h-3"}),e.jsx("span",{className:"select-none text-xs",children:"Auto-pick recommended chain"})]}),e.jsx(pe,{className:"h-40 border-2 border-primary/30 bg-black/20",children:e.jsxs("div",{className:"p-1 space-y-1",children:[e.jsx("button",{onClick:()=>{c(void 0),z(p)},className:`w-full text-left px-3 py-2 border-2 transition-all ${h?"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30":"border-primary bg-primary/20 text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs",children:"FREEFORM"}),e.jsx("div",{className:`${C} text-xs`,children:"No template"})]}),!h&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),M?e.jsxs("div",{className:"space-y-2 p-2",children:[e.jsx(oe,{className:"w-full h-10 bg-primary/10"}),e.jsx(oe,{className:"w-full h-10 bg-primary/10"}),e.jsx(oe,{className:"w-full h-10 bg-primary/10"})]}):g.map(s=>e.jsx("button",{onClick:()=>c(s.id),className:`w-full text-left px-3 py-2 border-2 transition-all ${h===s.id?"border-primary bg-primary/20 text-primary":"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-arcade text-xs truncate",children:s.name.toUpperCase()}),e.jsxs("div",{className:`${C} text-xs`,children:[s.blocks.length," blocks"]})]}),h===s.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary ml-2"})]})},s.id))]})})]}):e.jsx(jr,{selectedBlockIds:A,setSelectedBlockIds:y})]}),e.jsxs("div",{children:[e.jsx(se,{children:"Topic"}),e.jsx("input",{value:k,onChange:s=>$(s.target.value),placeholder:"e.g. Hip Flexors",className:`${be} border-2 border-primary/30`})]}),e.jsxs("div",{children:[e.jsx(se,{children:"Model"}),e.jsxs("div",{className:"space-y-1 mb-2",children:[e.jsx("button",{onClick:ce,className:`w-full text-left px-3 py-2 border-2 transition-colors ${w==="codex"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mr,{className:E}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"CODEX"}),e.jsx("div",{className:`${C} text-xs leading-tight`,children:"ChatGPT login"})]})]}),w==="codex"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),e.jsx("button",{onClick:ie,disabled:!R,className:`w-full text-left px-3 py-2 border-2 transition-colors ${w==="openrouter"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"} ${R?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lr,{className:E}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"OPENROUTER"}),e.jsx("div",{className:`${C} text-xs leading-tight`,children:R?"API key enabled":"API key missing"})]})]}),w==="openrouter"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})})]}),w==="openrouter"?e.jsx("select",{value:u,onChange:s=>_(s.target.value),className:`${de} border-2 border-primary/30`,children:me.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}):e.jsx("input",{value:u==="codex"?"":u,onChange:s=>_(s.target.value.trim()?s.target.value:"codex"),placeholder:"Codex model override (optional)",className:`${be} border-2 border-primary/30`})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${w!=="codex"?"opacity-50":""}`,children:[e.jsx(ne,{checked:L,onCheckedChange:s=>w==="codex"&&r(!!s),disabled:w!=="codex"}),e.jsx(_e,{className:E}),e.jsx("span",{className:`${te} text-xs`,children:"Web search"}),w!=="codex"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Codex only)"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"Course"}),Q?e.jsx(oe,{className:"w-full h-10 bg-primary/10"}):e.jsxs("select",{value:t??"",onChange:s=>a(s.target.value?Number(s.target.value):void 0),className:`${de} border-2 border-primary/30`,children:[e.jsx("option",{value:"",children:"All courses"}),J.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx(se,{icon:e.jsx(he,{className:E}),children:"Materials"}),e.jsx(yr,{courseId:t,selectedMaterials:f,setSelectedMaterials:b})]}),e.jsxs("div",{className:"border-t border-primary/10 pt-2",children:[e.jsx(se,{children:"Upload"}),e.jsx(He,{courseId:t})]})]})}),e.jsx("div",{className:`shrink-0 ${le} pt-2 border-t-2 border-primary/30`,children:e.jsxs(K,{onClick:o,disabled:m||i,className:`w-full h-9 rounded-none border-2 font-arcade text-xs ${i?"border-success/50 bg-success/10 text-success cursor-default":m?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[m?e.jsx(xe,{className:`${E} animate-spin mr-1`}):i?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success animate-pulse"}),"SESSION ACTIVE"]}):e.jsx(Se,{className:`${E} mr-1`}),!m&&!i&&"START SESSION"]})})]})}const Cr="tutor.vault_selected.v1",wr=24;function Sr(t,a){return t.includes(a)?t.filter(f=>f!==a):[...t,a]}function Ue({name:t,fullPath:a,isFolder:f,depth:b,selected:p,onToggle:T,expandedFolders:h,toggleFolder:c,connected:A,searchFilter:y}){const k=h.has(a);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 py-1 hover:bg-primary/10 transition-colors cursor-pointer min-h-[28px]",style:{paddingLeft:`${8+b*wr}px`},children:[e.jsx(ne,{checked:p,onCheckedChange:()=>T(a),className:"w-3.5 h-3.5 shrink-0"}),f?e.jsxs("button",{type:"button",onClick:()=>c(a),className:"flex items-center gap-1 min-w-0 flex-1",children:[k?e.jsx(Fe,{className:"w-3 h-3 text-muted-foreground shrink-0"}):e.jsx(Ce,{className:"w-3 h-3 text-muted-foreground shrink-0"}),e.jsx(Je,{className:"w-3.5 h-3.5 text-yellow-500 shrink-0"}),e.jsx("span",{className:"font-terminal text-sm truncate",children:t})]}):e.jsxs("span",{className:"flex items-center gap-1 min-w-0 flex-1",children:[e.jsx("span",{className:"w-3 shrink-0"}),e.jsx(Ze,{className:"w-3.5 h-3.5 text-blue-400 shrink-0"}),e.jsx("span",{className:"font-terminal text-sm truncate",children:t})]})]}),f&&k&&e.jsx($r,{folderPath:a,depth:b+1,selectedPaths:[],onToggle:T,expandedFolders:h,toggleFolder:c,connected:A,searchFilter:y,isSelected:$=>p||!1})]})}function $r({folderPath:t,depth:a,selectedPaths:f,onToggle:b,expandedFolders:p,toggleFolder:T,connected:h,searchFilter:c,isSelected:A}){const{data:y}=W({queryKey:["obsidian","files",t],queryFn:()=>D.obsidian.getFiles(t),enabled:h}),k=y?.files||[],$=c.toLowerCase();return e.jsx(e.Fragment,{children:k.map(u=>{const _=typeof u=="string"?u:u.path,L=_.endsWith("/"),r=_.replace(/\/$/,"").split("/").pop()||_,o=`${t}/${r}`;return $&&!r.toLowerCase().includes($)?null:e.jsx(Ue,{name:r,fullPath:o,isFolder:L,depth:a,selected:A(o),onToggle:b,expandedFolders:p,toggleFolder:T,connected:h,searchFilter:c},_)})})}function _r({selectedPaths:t,onSelectedPathsChange:a}){const[f,b]=n.useState(""),[p,T]=n.useState(new Set),{data:h}=W({queryKey:["obsidian","status"],queryFn:()=>D.obsidian.getStatus(),refetchInterval:3e4}),c=h?.connected===!0,{data:A}=W({queryKey:["obsidian","files","School"],queryFn:()=>D.obsidian.getFiles("School"),enabled:c}),y=n.useCallback(r=>{T(o=>{const m=new Set(o);return m.has(r)?m.delete(r):m.add(r),m})},[]),k=n.useCallback(r=>{a(Sr(t,r))},[t,a]),$=n.useCallback(r=>t.includes(r),[t]);n.useEffect(()=>{try{localStorage.setItem(Cr,JSON.stringify(t))}catch{}},[t]),t.filter(r=>A?.files?.some(o=>{const m=typeof o=="string"?o:o.path;return m.endsWith("/")&&`School/${m.replace(/\/$/,"").split("/").pop()}`===r})||r.endsWith("/")).length;const u=n.useMemo(()=>{const r=t.filter(i=>$e.some(j=>j.path===i)||!i.includes(".")&&!i.endsWith(".md")),o=t.length-r.length,m=[];return r.length&&m.push(`${r.length} folder${r.length>1?"s":""}`),o&&m.push(`${o} file${o>1?"s":""}`),m.join(", ")||"Nothing selected"},[t]);if(!c)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(Ie,{className:"w-8 h-8 text-primary/80 mb-3"}),e.jsx("p",{className:"font-arcade text-sm text-primary/90 text-center",children:"Obsidian offline"}),e.jsx("p",{className:"font-terminal text-sm text-muted-foreground text-center mt-2",children:"Open Obsidian with Local REST API enabled"})]});const _=A?.files||[],L=f.toLowerCase();return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 px-3 py-2 flex items-center gap-2 border-b border-primary/10",children:[$e.map(r=>{const o=t.includes(r.path);return e.jsx("button",{type:"button",onClick:()=>k(r.path),className:`px-2.5 py-1 font-arcade text-xs tracking-wider border-2 shrink-0 transition-colors ${o?"bg-primary text-primary-foreground border-primary":"border-primary/40 bg-black/50 text-primary/80 hover:bg-primary/20 hover:border-primary/60"}`,children:r.name},r.id)}),e.jsxs("div",{className:"relative flex-1 min-w-[120px]",children:[e.jsx(ar,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground pointer-events-none"}),e.jsx(Qe,{value:f,onChange:r=>b(r.target.value),placeholder:"Filter...",className:"h-7 pl-8 pr-3 text-sm font-terminal rounded-none border border-primary/20 bg-black/40 placeholder:text-muted-foreground/80 focus-visible:ring-1 focus-visible:ring-primary/60"})]})]}),e.jsx(pe,{className:"flex-1 min-h-0",children:e.jsx("div",{className:"px-1 py-1",children:_.map(r=>{const o=typeof r=="string"?r:r.path,m=o.endsWith("/"),i=o.replace(/\/$/,"").split("/").pop()||o,j=`School/${i}`;return L&&!i.toLowerCase().includes(L)?null:e.jsx(Ue,{name:i,fullPath:j,isFolder:m,depth:0,selected:$(j),onToggle:k,expandedFolders:p,toggleFolder:y,connected:c,searchFilter:f},o)})})}),e.jsxs("div",{className:"shrink-0 px-3 py-2 border-t border-primary/20 flex items-center justify-between",children:[e.jsx("span",{className:`${C} text-xs`,children:u}),t.length>0&&e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>a([]),className:"h-6 px-2 rounded-none font-terminal text-xs text-muted-foreground hover:text-primary gap-1",children:[e.jsx(Ne,{className:E}),"CLEAR"]})]})]})}function Er({sessionId:t,onArtifactCreated:a,onSessionEnd:f,chainBlocks:b=[],currentBlockIndex:p=0,onAdvanceBlock:T}){const h=b.length>0,c=h&&p>=b.length,[A,y]=n.useState([]),[k,$]=n.useState(""),[u,_]=n.useState(!1),L=n.useRef(null),r=n.useRef(null);n.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[A]),n.useEffect(()=>{r.current?.focus()},[t]);const o=n.useCallback(async()=>{if(!k.trim()||!t||u)return;const i=k.trim();$("");const j=/^\/(note|save)\b/i.test(i),v=/^\/(card|flashcard)\b/i.test(i),l=/^\/(map|diagram)\b/i.test(i);y(d=>[...d,{role:"user",content:i}]),y(d=>[...d,{role:"assistant",content:"",isStreaming:!0}]),_(!0);try{const g=(await fetch(`/api/tutor/session/${t}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i})})).body?.getReader(),M=new TextDecoder;if(!g)throw new Error("No response body");let U="",J="",Q=[],R;for(;;){const{done:w,value:F}=await g.read();if(w)break;U+=M.decode(F,{stream:!0});const Z=U.split(`
`);U=Z.pop()??"";for(const X of Z){if(!X.startsWith("data: "))continue;const z=X.slice(6);if(z==="[DONE]")break;try{const O=JSON.parse(z);if(O.type==="error"){y(G=>{const N=[...G];return N[N.length-1]={role:"assistant",content:`Error: ${O.content}`},N}),_(!1);return}O.type==="web_search_searching"&&y(G=>{const N=[...G];return N[N.length-1]={...N[N.length-1],content:`Searching the web...

`,isStreaming:!0},N}),O.type==="web_search_completed"&&(J="",y(G=>{const N=[...G];return N[N.length-1]={...N[N.length-1],content:"",isStreaming:!0},N})),O.type==="token"&&O.content&&(J+=O.content,y(G=>{const N=[...G],I=N[N.length-1];return N[N.length-1]={...I,content:I.content+O.content,isStreaming:!0},N})),O.type==="done"&&(Q=O.citations??[],R=O.model)}catch{}}}y(w=>{const F=[...w];return F[F.length-1]={role:"assistant",content:J,citations:Q,model:R,isStreaming:!1},F}),(j||v||l)&&a({type:j?"note":v?"card":"map",content:J,title:i.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(d){y(g=>{const M=[...g];return M[M.length-1]={role:"assistant",content:`Connection error: ${d instanceof Error?d.message:"Unknown"}`},M})}finally{_(!1)}},[k,t,u,a]),m=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),o())};return t?e.jsxs("div",{className:"flex flex-col h-full",children:[h&&e.jsxs("div",{className:"shrink-0 px-3 py-2 border-b-2 border-primary/30 bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto",children:[b.map((i,j)=>{const v=j<p,l=j===p&&!c;return e.jsxs("div",{className:"flex items-center shrink-0",children:[j>0&&e.jsx(Ce,{className:"w-4 h-4 text-muted-foreground/40 mx-0.5"}),e.jsxs("div",{className:`px-2 py-1 border-2 text-base font-terminal flex items-center gap-1 ${l?"border-primary bg-primary/20 text-primary":v?"border-primary/30 bg-primary/5 text-muted-foreground/70 line-through":"border-primary/20 text-muted-foreground/50"}`,children:[v&&e.jsx(Re,{className:"w-4 h-4"}),i.name]})]},i.id)}),!c&&T&&e.jsx("button",{onClick:T,className:"shrink-0 ml-2 px-3 py-1 border-2 border-primary/60 text-xs font-arcade text-primary hover:bg-primary/20 transition-colors",children:"NEXT"}),c&&e.jsx("span",{className:"shrink-0 ml-2 px-3 py-1 text-xs font-arcade text-green-400 border-2 border-green-400/50",children:"COMPLETE"})]}),!c&&b[p]&&e.jsxs("div",{className:"mt-1 text-base font-terminal text-muted-foreground",children:[e.jsx("span",{className:"text-primary",children:b[p].category.toUpperCase()})," ","· ~",b[p].duration,"min"]})]}),e.jsxs("div",{ref:L,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[A.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-primary",children:"SESSION STARTED"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),A.map((i,j)=>e.jsx("div",{className:`flex ${i.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-lg font-terminal ${i.role==="user"?"bg-primary/20 border-2 border-primary/50 text-foreground":"bg-black/40 border-2 border-primary/20 text-foreground"}`,children:[i.role==="assistant"?e.jsxs("div",{className:"prose prose-invert prose-lg max-w-none font-terminal [&_p]:my-2 [&_li]:my-1 [&_code]:text-base [&_pre]:text-base",children:[e.jsx(er,{remarkPlugins:[rr],children:i.content||(i.isStreaming?"...":"")}),i.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):e.jsx("div",{children:i.content}),(i.citations?.length||i.model)&&!i.isStreaming?e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-2 pt-2 border-t border-primary/20",children:[i.citations?.map(v=>v.url?e.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(q,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",children:["[",v.index,"] ",v.source]})},v.index):e.jsxs(q,{variant:"outline",className:"text-sm rounded-none",children:["[",v.index,"] ",v.source]},v.index)),i.model&&e.jsx(q,{variant:"outline",className:"text-sm rounded-none text-muted-foreground/60 ml-auto",children:i.model})]}):null]})},j))]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-t border-primary/20",children:[e.jsx("span",{className:"text-base font-terminal text-muted-foreground/60",children:"Commands:"}),e.jsxs(q,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/note "),children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"/note"]}),e.jsxs(q,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/card "),children:[e.jsx(Pe,{className:"w-4 h-4 mr-1"}),"/card"]}),e.jsxs(q,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/map "),children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"/map"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(K,{variant:"ghost",size:"sm",onClick:f,className:"text-sm font-terminal text-destructive hover:text-destructive h-8 px-3",children:[e.jsx(ir,{className:"w-4 h-4 mr-1"}),"END"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-primary/20",children:[e.jsx("input",{ref:r,value:k,onChange:i=>$(i.target.value),onKeyDown:m,placeholder:"Ask a question...",disabled:u,className:"flex-1 bg-black/60 border-2 border-primary/40 rounded-none px-3 py-2 text-lg font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),e.jsx(K,{onClick:o,disabled:!k.trim()||u,className:"rounded-none border-2 border-primary h-11 w-11 p-0",children:u?e.jsx(xe,{className:"w-5 h-5 animate-spin"}):e.jsx(nr,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const Tr={note:he,card:Pe,map:qe},Ar={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function Lr({sessionId:t,artifacts:a,turnCount:f,mode:b,topic:p,startedAt:T,recentSessions:h,onResumeSession:c}){const A=Me(),[y,k]=n.useState(null),[$,u]=n.useState(null),_=async r=>{try{await D.tutor.deleteSession(r),P.success("Session deleted"),A.invalidateQueries({queryKey:["tutor-sessions"]}),k(null)}catch(o){P.error(`Delete failed: ${o instanceof Error?o.message:"Unknown"}`)}},L=async r=>{u(r.session_id);try{const o=await D.tutor.getSession(r.session_id);if(!o.turns||o.turns.length===0){P.error("No turns to save");return}const m=[`# Tutor: ${r.topic||r.mode}`,`**Date:** ${new Date(r.started_at).toLocaleDateString()}`,`**Mode:** ${r.mode} | **Turns:** ${r.turn_count}`,"","---",""];for(const v of o.turns)m.push(`## Q${v.turn_number}`),m.push(v.question),m.push(""),v.answer&&(m.push("**Answer:**"),m.push(v.answer),m.push(""));const j=`Study Sessions/${`Tutor - ${(r.topic||r.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`}.md`;await D.obsidian.append(j,m.join(`
`)),P.success(`Saved to Obsidian: ${j}`)}catch(o){P.error(`Save failed: ${o instanceof Error?o.message:"Unknown"}`)}finally{u(null)}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${le} pb-2 border-b-2 border-primary/30`,children:e.jsx("div",{className:ke,children:"ARTIFACTS"})}),e.jsx(pe,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${le} space-y-3`,children:[t?e.jsxs("div",{className:"space-y-2 pb-3 border-b border-muted-foreground/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(q,{variant:"outline",className:`${re} h-5 px-1.5`,children:b}),e.jsx(q,{variant:"outline",className:`${re} h-5 px-1.5 text-primary`,children:"FIRST PASS"})]}),p&&e.jsx("div",{className:`${te} text-sm`,children:p}),e.jsxs("div",{className:`flex items-center gap-3 ${C}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:E}),f," turns"]}),T&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:E}),new Date(T).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):e.jsx("div",{className:`${te} text-muted-foreground/50 py-3 text-center`,children:"No active session"}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:H,children:"Artifacts"}),a.map((r,o)=>{const m=Tr[r.type],i=Ar[r.type];return e.jsxs("div",{className:"border-2 border-muted-foreground/20 p-2.5 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(m,{className:`${Ye} ${i}`}),e.jsx("span",{className:`${te} text-sm truncate flex-1`,children:r.title||`${r.type} #${o+1}`})]}),r.content&&e.jsx("div",{className:`${C} mt-1 line-clamp-2`,children:r.content.slice(0,100)})]},o)})]}),t&&a.length===0&&e.jsxs("div",{className:"text-center space-y-1 py-4",children:[e.jsx(Be,{className:`${Ve} text-muted-foreground/30 mx-auto`}),e.jsx("div",{className:`${C} text-muted-foreground/50`,children:"No artifacts yet"}),e.jsx("div",{className:`${C} text-muted-foreground/30`,children:"Use /note, /card, or /map"})]}),h.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-muted-foreground/20",children:[e.jsx("div",{className:H,children:"Recent Sessions"}),h.slice(0,8).map(r=>e.jsxs("div",{className:"border-2 border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>c(r.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"outline",className:`${re} h-5 px-1.5 shrink-0 ${r.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:r.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:r.topic||r.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${C}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:E}),r.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:E}),new Date(r.started_at).toLocaleDateString()]}),e.jsx(q,{variant:"outline",className:`${re} h-4 px-1 ml-auto`,children:r.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:$===r.session_id,onClick:o=>{o.stopPropagation(),L(r)},children:[e.jsx(Ie,{className:`${E} mr-1`}),$===r.session_id?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:y===r.session_id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(K,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:o=>{o.stopPropagation(),_(r.session_id)},children:e.jsx(Re,{className:E})}),e.jsx(K,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:o=>{o.stopPropagation(),k(null)},children:e.jsx(Ne,{className:E})})]}):e.jsx(K,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:o=>{o.stopPropagation(),k(r.session_id)},children:e.jsx(Xe,{className:E})})})]})]},r.session_id))]})]})})]})}function Vr(){const t=Me(),[a,f]=n.useState(null),[b,p]=n.useState(!1),[T,h]=n.useState(),[c,A]=n.useState([]),[y,k]=n.useState("Core"),[$,u]=n.useState(),[_,L]=n.useState(0),[r,o]=n.useState([]),[m,i]=n.useState([]),[j,v]=n.useState(""),[l,d]=n.useState("codex"),[g,M]=n.useState(!1),[U,J]=n.useState(()=>{try{const x=localStorage.getItem("tutor.vault_selected.v1");if(x){const S=JSON.parse(x);if(Array.isArray(S))return S}}catch{}return[]}),[Q,R]=n.useState([]),[w,F]=n.useState(0),[Z,X]=n.useState(null),[z,O]=n.useState(!1),[G,N]=n.useState(!1),{data:I=[]}=W({queryKey:["tutor-sessions"],queryFn:()=>D.tutor.listSessions({limit:10})}),Y=n.useCallback(async()=>{p(!0);try{let x=$;!x&&m.length>0&&(x=(await D.tutor.createCustomChain(m,`Custom ${j||"Chain"}`)).id);const S=await D.tutor.createSession({course_id:T,phase:"first_pass",mode:y,topic:j||void 0,content_filter:{...U.length>0?{folders:U}:{},...c.length>0?{material_ids:c}:{},model:l,...g?{web_search:!0}:{}},method_chain_id:x});if(f(S.session_id),X(S.started_at),R([]),F(0),L(S.current_block_index??0),N(!1),$){const ee=await D.tutor.getSession(S.session_id);ee.chain_blocks&&o(ee.chain_blocks.map(B=>({id:B.id,name:B.name,category:B.category,duration:B.default_duration_min})))}else o([]);P.success("Tutor session started"),t.invalidateQueries({queryKey:["tutor-sessions"]})}catch(x){P.error(`Failed to start session: ${x instanceof Error?x.message:"Unknown"}`)}finally{p(!1)}},[T,y,j,U,c,l,g,$,m,t]),ce=n.useCallback(async()=>{if(a)try{await D.tutor.endSession(a),P.success("Session ended"),f(null),R([]),F(0),X(null),L(0),o([]),O(!1),t.invalidateQueries({queryKey:["tutor-sessions"]})}catch(x){P.error(`Failed to end session: ${x instanceof Error?x.message:"Unknown"}`)}},[a,t]),ie=n.useCallback(async x=>{if(a)try{const S=await D.tutor.createArtifact(a,{type:x.type,content:x.content,title:x.title}),ee={type:x.type,title:x.title||`${x.type} #${Q.length+1}`,content:x.content.slice(0,200),createdAt:new Date().toISOString(),cardId:S.card_id};R(B=>[...B,ee]),O(!0),P.success(`${x.type.charAt(0).toUpperCase()+x.type.slice(1)} created`)}catch(S){P.error(`Failed to create artifact: ${S instanceof Error?S.message:"Unknown"}`)}},[a,Q.length]),s=n.useCallback(async()=>{if(a)try{const x=await D.tutor.advanceBlock(a);L(x.block_index),x.complete?P.success("Chain complete!"):P.success(`Advanced to: ${x.block_name}`)}catch(x){P.error(`Failed to advance block: ${x instanceof Error?x.message:"Unknown"}`)}},[a]),V=n.useCallback(async x=>{try{const S=await D.tutor.getSession(x);if(f(S.session_id),F(S.turn_count),X(S.started_at),k(S.mode),v(S.topic||""),h(S.course_id??void 0),S.artifacts_json)try{const ee=JSON.parse(S.artifacts_json);Array.isArray(ee)&&R(ee.map(B=>({type:B.type,title:B.title,content:"",createdAt:B.created_at})))}catch{R([])}P.success("Session resumed")}catch(S){P.error(`Failed to resume session: ${S instanceof Error?S.message:"Unknown"}`)}},[]);return!a&&!G?e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)] px-4 pb-2",children:[e.jsxs(ge,{className:"flex-1 min-h-0 bg-black/40 border-2 border-primary rounded-none overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"shrink-0 px-3 py-1.5 border-b-2 border-primary/30 flex items-center justify-between",children:[e.jsx("div",{className:ke,children:"VAULT FILES"}),e.jsx("span",{className:"font-arcade text-xs text-primary/50 tracking-widest",children:"TUTOR"})]}),e.jsx(_r,{selectedPaths:U,onSelectedPathsChange:J})]}),e.jsx(ge,{className:"shrink-0 mt-2 bg-black/40 border-2 border-primary rounded-none overflow-hidden",children:e.jsx(De,{courseId:T,setCourseId:h,selectedMaterials:c,setSelectedMaterials:A,mode:y,setMode:k,chainId:$,setChainId:u,customBlockIds:m,setCustomBlockIds:i,topic:j,setTopic:v,model:l,setModel:d,webSearch:g,setWebSearch:M,onStartSession:Y,isStarting:b,hasActiveSession:!1,compact:!0})}),I.length>0&&e.jsxs("div",{className:"shrink-0 flex items-center gap-2 mt-1 overflow-x-auto pb-1",children:[e.jsx("span",{className:"font-arcade text-xs text-primary/60 shrink-0",children:"RECENT:"}),I.slice(0,8).map(x=>e.jsxs("button",{onClick:()=>V(x.session_id),className:"shrink-0 border border-muted-foreground/20 hover:border-primary/50 hover:bg-primary/10 px-2 py-0.5 font-terminal text-xs text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${x.status==="active"?"bg-green-400":"bg-muted-foreground/40"}`}),e.jsx("span",{className:"truncate max-w-[100px]",children:x.topic||x.mode}),e.jsxs("span",{className:"text-muted-foreground/50",children:[x.turn_count,"t"]})]},x.session_id))]})]})}):G&&a?e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>N(!1),className:"rounded-none font-arcade text-xs text-primary h-8 px-3",children:"BACK TO CHAT"}),e.jsx("span",{className:"font-terminal text-base text-muted-foreground",children:"Editing session settings"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-2xl mx-auto py-6 px-4",children:e.jsx(ge,{className:"bg-black/40 border-2 border-primary rounded-none overflow-hidden",children:e.jsx(De,{courseId:T,setCourseId:h,selectedMaterials:c,setSelectedMaterials:A,mode:y,setMode:k,chainId:$,setChainId:u,customBlockIds:m,setCustomBlockIds:i,topic:j,setTopic:v,model:l,setModel:d,webSearch:g,setWebSearch:M,onStartSession:Y,isStarting:b,hasActiveSession:!0})})})})]})}):e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(q,{variant:"outline",className:`${re} h-6 px-2 text-primary border-primary/50`,children:y}),j&&e.jsx("span",{className:"font-terminal text-base text-foreground truncate max-w-[300px]",children:j}),e.jsxs("div",{className:`flex items-center gap-3 ${C} ml-auto`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:E}),w]}),Z&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:E}),new Date(Z).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"h-7 w-7 p-0 rounded-none text-muted-foreground hover:text-primary",title:"Session settings",children:e.jsx(gr,{className:"w-4 h-4"})}),e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>O(!z),className:`h-7 px-2 rounded-none font-terminal text-sm gap-1 ${z?"text-primary bg-primary/10":"text-muted-foreground hover:text-primary"}`,title:"Toggle artifacts panel",children:[z?e.jsx(hr,{className:"w-4 h-4"}):e.jsx(sr,{className:"w-4 h-4"}),Q.length>0&&e.jsx(q,{variant:"outline",className:"text-xs h-5 px-1 rounded-none",children:Q.length})]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsx("div",{className:"flex-1 bg-black/60 border-x-2 border-primary/20 flex flex-col min-w-0",children:e.jsx(Er,{sessionId:a,onArtifactCreated:ie,onSessionEnd:ce,chainBlocks:r,currentBlockIndex:_,onAdvanceBlock:s})}),z&&e.jsx("div",{className:"w-80 shrink-0 bg-black/40 border-l-2 border-primary/30 overflow-hidden",children:e.jsx(Lr,{sessionId:a,artifacts:Q,turnCount:w,mode:y,topic:j,startedAt:Z,onCreateArtifact:ie,recentSessions:I,onResumeSession:V})})]})]})})}export{Vr as default};
