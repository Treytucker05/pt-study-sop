import{c as K,r as f,j as e,b as T,u as le}from"./index-Dq2i42cU.js";import{w as Pe,f as C,u as Y,A as V,p as B,B as w,L as Ie,S as Oe,t as De,a as E}from"./layout-MVbPqDQb.js";import{C as u,a as N,b as j,c as h,B as p}from"./badge-BA71vPQw.js";import{S as ce,a as oe,b as de,c as xe,d as A}from"./select-DYp6QAUH.js";import{C as $e,T as Me,a as Le,b as _e,d as U,L as qe}from"./tabs-khOR1vqB.js";import{C as y,S as D,I as k,a as Z,b as Ue,c as F}from"./theme-DVlXyDCo.js";import{P as Fe}from"./play-CS_yjmmB.js";import{R as M}from"./refresh-cw-BOYL3V07.js";import{C as me}from"./clock-DNmmqlQe.js";import{T as ee}from"./trending-up-BAQj6lUN.js";import{S as se}from"./search-DYkyF6sy.js";import{C as Ve}from"./circle-check-BAh3DBrL.js";import{C as ae}from"./index-w1J5KrVK.js";import{C as $}from"./circle-alert-CtSeUk0v.js";import{M as Be}from"./message-square-g8S0jRvh.js";import{S as He}from"./send-CZYNsg88.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],te=K("circle-question-mark",Ke);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ue=K("circle-x",ze);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],re=K("history",Qe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Q=K("lightbulb",Ye);function We(a,r=[]){let o=[];function d(t,m){const n=f.createContext(m);n.displayName=t+"Context";const x=o.length;o=[...o,m];const v=g=>{const{scope:b,children:P,...R}=g,I=b?.[a]?.[x]||n,L=f.useMemo(()=>R,Object.values(R));return e.jsx(I.Provider,{value:L,children:P})};v.displayName=t+"Provider";function c(g,b){const P=b?.[a]?.[x]||n,R=f.useContext(P);if(R)return R;if(m!==void 0)return m;throw new Error(`\`${g}\` must be used within \`${t}\``)}return[v,c]}const i=()=>{const t=o.map(m=>f.createContext(m));return function(n){const x=n?.[a]||t;return f.useMemo(()=>({[`__scope${a}`]:{...n,[a]:x}}),[n,x])}};return i.scopeName=a,[d,Ge(i,...r)]}function Ge(...a){const r=a[0];if(a.length===1)return r;const o=()=>{const d=a.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(t){const m=d.reduce((n,{useScope:x,scopeName:v})=>{const g=x(t)[`__scope${v}`];return{...n,...g}},{});return f.useMemo(()=>({[`__scope${r.scopeName}`]:m}),[m])}};return o.scopeName=r.scopeName,o}var Je=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],he=Je.reduce((a,r)=>{const o=Pe(`Primitive.${r}`),d=f.forwardRef((i,t)=>{const{asChild:m,...n}=i,x=m?o:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(x,{...n,ref:t})});return d.displayName=`Primitive.${r}`,{...a,[r]:d}},{}),W="Progress",G=100,[Xe]=We(W),[Ze,es]=Xe(W),pe=f.forwardRef((a,r)=>{const{__scopeProgress:o,value:d=null,max:i,getValueLabel:t=ss,...m}=a;(i||i===0)&&!ne(i)&&console.error(as(`${i}`,"Progress"));const n=ne(i)?i:G;d!==null&&!ie(d,n)&&console.error(ts(`${d}`,"Progress"));const x=ie(d,n)?d:null,v=H(x)?t(x,n):void 0;return e.jsx(Ze,{scope:o,value:x,max:n,children:e.jsx(he.div,{"aria-valuemax":n,"aria-valuemin":0,"aria-valuenow":H(x)?x:void 0,"aria-valuetext":v,role:"progressbar","data-state":je(x,n),"data-value":x??void 0,"data-max":n,...m,ref:r})})});pe.displayName=W;var fe="ProgressIndicator",Ne=f.forwardRef((a,r)=>{const{__scopeProgress:o,...d}=a,i=es(fe,o);return e.jsx(he.div,{"data-state":je(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...d,ref:r})});Ne.displayName=fe;function ss(a,r){return`${Math.round(a/r*100)}%`}function je(a,r){return a==null?"indeterminate":a===r?"complete":"loading"}function H(a){return typeof a=="number"}function ne(a){return H(a)&&!isNaN(a)&&a>0}function ie(a,r){return H(a)&&!isNaN(a)&&a<=r&&a>=0}function as(a,r){return`Invalid prop \`max\` of value \`${a}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${G}\`.`}function ts(a,r){return`Invalid prop \`value\` of value \`${a}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${G} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ge=pe,rs=Ne;const be=f.forwardRef(({className:a,indicatorClassName:r,value:o,...d},i)=>e.jsx(ge,{ref:i,className:T("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...d,children:e.jsx(rs,{className:T("h-full w-full flex-1 bg-primary transition-all",r),style:{transform:`translateX(-${100-(o||0)}%)`}})}));be.displayName=ge.displayName;function ns(){const a=le(),[r,o]=f.useState(!1),[d,i]=f.useState("brain"),{data:t,isLoading:m}=C({queryKey:["scholarStatus"],queryFn:async()=>{const c=await fetch("/api/scholar/status");if(!c.ok)throw new Error("Failed to fetch Scholar status");return c.json()},refetchInterval:r?2e3:!1}),n=Y({mutationFn:async()=>{const c=await fetch("/api/scholar/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({triggered_by:"ui",mode:d})}),g=await c.json().catch(()=>({message:c.statusText}));if(!c.ok){const b=g&&(g.message||g.error)||`Failed to start Scholar run (${c.status})`;throw new Error(b)}return g},onSuccess:()=>{o(!0),a.invalidateQueries({queryKey:["scholarStatus"]})}});f.useEffect(()=>{t?.running?o(!0):r&&!t?.running&&(o(!1),a.invalidateQueries({queryKey:["scholarStatus"]}))},[t?.running,r,a]);const x=()=>m?e.jsx(M,{className:"w-4 h-4 animate-spin"}):t?.running?e.jsx(M,{className:"w-4 h-4 animate-spin text-primary"}):t?.status==="complete"?e.jsx($e,{className:`w-4 h-4 ${Z}`}):t?.status==="error"?e.jsx(ue,{className:`w-4 h-4 ${D}`}):e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),v=()=>t?.running?e.jsx(p,{className:"bg-primary/20 text-primary border-primary/50",children:"Running"}):t?.status==="complete"?e.jsx(p,{className:`bg-success/20 ${Z}`,children:"Complete"}):t?.status==="error"?e.jsx(p,{className:`bg-destructive/20 ${D}`,children:"Error"}):e.jsx(p,{variant:"outline",className:"text-muted-foreground",children:"Idle"});return e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x(),e.jsx(j,{className:"font-arcade text-sm text-primary",children:"SCHOLAR ORCHESTRATOR"})]}),v()]})}),e.jsxs(h,{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[n.isError&&e.jsxs("div",{className:"p-2 bg-destructive/10 border border-destructive/50 rounded-none",children:[e.jsx("div",{className:`font-terminal text-[10px] ${D}`,children:"Run Error:"}),e.jsx("div",{className:"font-terminal text-[10px] text-destructive/80",children:n.error?.message||"Unknown error"})]}),t?.running&&e.jsxs(e.Fragment,{children:[t.current_step&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Current Step:"}),e.jsx("div",{className:"font-terminal text-xs text-secondary",children:t.current_step})]}),t.progress!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground",children:"Progress:"}),e.jsxs("span",{className:"font-terminal text-[10px] text-primary",children:[Math.round(t.progress),"%"]})]}),e.jsx(be,{value:t.progress,className:"h-2 bg-black border border-primary/30"})]})]}),!t?.running&&t?.last_run&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Last Run:"}),e.jsx("div",{className:"font-terminal text-xs text-secondary",children:new Date(t.last_run).toLocaleString()})]}),t?.errors&&t.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:`font-terminal text-[10px] ${D}`,children:"Errors:"}),e.jsx("div",{className:"space-y-1 p-2 bg-destructive/10 border border-destructive/50 rounded-none",children:t.errors.map((c,g)=>e.jsxs("div",{className:`font-terminal text-[10px] ${D}`,children:["• ",c]},g))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Study mode"}),e.jsxs(ce,{value:d,onValueChange:c=>i(c),disabled:t?.running||n.isPending,children:[e.jsx(oe,{className:"rounded-none font-terminal text-xs border-primary/40 h-8",children:e.jsx(de,{})}),e.jsxs(xe,{className:"rounded-none bg-black border-primary",children:[e.jsx(A,{value:"brain",className:"font-terminal text-xs rounded-none",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(V,{className:k})," Brain Study"]})}),e.jsx(A,{value:"tutor",className:"font-terminal text-xs rounded-none",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(B,{className:k})," Tutor Study"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{onClick:()=>n.mutate(),disabled:t?.running||n.isPending,className:"flex-1 bg-primary hover:bg-primary/80 rounded-none font-terminal text-xs",children:[e.jsx(Fe,{className:`${k} mr-1`}),n.isPending?"Starting...":"Run Scholar"]}),e.jsx(w,{onClick:()=>a.invalidateQueries({queryKey:["scholarStatus"]}),variant:"outline",className:"rounded-none font-terminal text-xs",disabled:m,children:e.jsx(M,{className:`${k} ${m?"animate-spin":""}`})})]}),e.jsx("div",{className:"pt-2 border-t border-primary/30",children:e.jsx("p",{className:"font-terminal text-[9px] text-muted-foreground",children:d==="brain"?"Brain Study: session logs + SOP. Tutor Study: SOP library only (no telemetry).":"Tutor Study: evaluates sop/library, researches learning science, proposes changes."})})]})]})}function vs(){const a=le(),[r,o]=f.useState("summary"),[d,i]=f.useState([]),[t,m]=f.useState(""),[n,x]=f.useState(!1),v=f.useRef(null),{data:c=[]}=C({queryKey:["sessions"],queryFn:E.sessions.getAll}),{data:g=[]}=C({queryKey:["courses"],queryFn:E.courses.getAll}),{data:b=[]}=C({queryKey:["proposals"],queryFn:E.proposals.getAll}),{data:P=[]}=C({queryKey:["scholar-questions"],queryFn:E.scholar.getQuestions}),{data:R=[]}=C({queryKey:["scholar-findings"],queryFn:E.scholar.getFindings}),{data:I=[]}=C({queryKey:["scholar-tutor-audit"],queryFn:E.scholar.getTutorAudit}),{data:L}=C({queryKey:["scholar-clusters"],queryFn:E.scholar.getClusters}),z=Y({mutationFn:E.scholar.runClustering,onSuccess:()=>{a.invalidateQueries({queryKey:["scholar-clusters"]})}}),ye=Y({mutationFn:({id:s,data:l})=>E.proposals.update(s,l),onSuccess:()=>{a.invalidateQueries({queryKey:["proposals"]})}});f.useEffect(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[d]),c.slice(0,20);const ve=c.reduce((s,l)=>s+(l.minutes||0),0),Se=c.length>0?Math.round(ve/c.length):0,Ee=c.filter(s=>{const l=new Date(s.date),S=new Date;return S.setDate(S.getDate()-7),l>=S}).length,O=g.filter(s=>(s.totalSessions||0)<3),_=c.filter(s=>s.confusions&&s.confusions.length>0).flatMap(s=>s.confusions||[]),q=c.filter(s=>s.issues&&s.issues.length>0).flatMap(s=>s.issues||[]),we=O.length>0||_.length>0||q.length>0,J=async()=>{if(!t.trim())return;const s=t.trim();i(l=>[...l,{role:"user",content:s}]),m(""),x(!0);try{const l=await E.scholar.chat(s);i(S=>[...S,{role:"assistant",content:l.response}])}catch{i(S=>[...S,{role:"assistant",content:"Error processing your question. Please try again."}])}finally{x(!1)}},Re=P,Ce=I,ke=R,X=s=>{switch(s){case"APPROVED":return"bg-primary/20 text-primary border-primary";case"REJECTED":return"bg-destructive/20 text-destructive border-destructive";case"IMPLEMENTED":return"bg-success/20 text-success border-success";default:return"bg-muted/20 text-muted-foreground border-muted-foreground"}},Te=s=>{switch(s){case"HIGH":return"text-primary border-primary";case"MED":return"text-white border-white";default:return"text-muted-foreground border-muted-foreground"}};return e.jsx(Ie,{children:e.jsxs("div",{className:"min-h-[calc(100vh-140px)] flex flex-col gap-6",children:[e.jsxs("div",{className:"space-y-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:`${Ue} text-primary`}),e.jsx("h1",{className:"font-arcade text-lg text-primary",children:"SCHOLAR"}),e.jsx(p,{variant:"outline",className:"rounded-none text-[10px] font-terminal border-primary/50",children:"READ ONLY ADVISORY"})]}),e.jsxs(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs border-primary/40",onClick:()=>a.invalidateQueries(),"data-testid":"button-refresh-data",children:[e.jsx(M,{className:`${k} mr-2`})," REFRESH DATA"]})]}),e.jsx(ns,{})]}),e.jsx("div",{className:"flex-1",children:e.jsxs(Me,{value:r,onValueChange:o,className:"flex flex-col",children:[e.jsx(Le,{className:"bg-black/60 border-2 border-primary/40 rounded-none p-1 shrink-0 w-full justify-start overflow-x-auto",children:[{id:"summary",label:"SUMMARY",icon:ee},{id:"analysis",label:"ANALYSIS",icon:se},{id:"proposals",label:"PROPOSALS",icon:Q},{id:"history",label:"HISTORY",icon:re}].map(s=>e.jsxs(_e,{value:s.id,className:"rounded-none font-arcade text-[10px] data-[state=active]:bg-primary data-[state=active]:text-black px-3","data-testid":`tab-${s.id}`,children:[e.jsx(s.icon,{className:`${k} mr-1`}),s.label]},s.id))}),e.jsxs(U,{value:"summary",className:"flex-1 mt-6",children:[e.jsx(u,{className:`bg-black/40 ${y} mb-4`,children:e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"font-arcade text-[10px] text-secondary mb-2",children:"SCHOLAR RUN: HIGH-LEVEL → ANALYSIS → DECISIONS"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 font-terminal text-[11px] text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"1. Review study health"}),e.jsx("p",{children:"Scan totals and recent activity for obvious gaps."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"2. Dive into analysis"}),e.jsx("p",{children:"Use Tutor audit, questions, and evidence to understand why."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"3. Approve/track proposals"}),e.jsx("p",{children:"Decide which changes to adopt and track over time."})]})]})]})}),b.length>0&&e.jsx(u,{className:`bg-black/60 ${F} mb-4`,children:e.jsxs(h,{className:"p-3 flex flex-col md:flex-row md:items-center gap-3 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-primary"}),e.jsxs("p",{className:"font-terminal text-xs text-muted-foreground",children:["You have"," ",e.jsxs("span",{className:"text-primary",children:[b.filter(s=>s.status!=="REJECTED").length," active Scholar proposal",b.filter(s=>s.status!=="REJECTED").length===1?"":"s"]})," ","waiting for a decision."]})]}),e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] border-primary text-primary",onClick:()=>o("proposals"),"data-testid":"cta-review-proposals-from-summary",children:"GO TO PROPOSALS"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 pr-2",children:[e.jsxs(u,{className:`bg-black/40 ${F}`,children:[e.jsx(N,{className:"p-4 border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-sm text-primary flex items-center gap-3",children:[e.jsx(ee,{className:"w-4 h-4"})," STUDY HEALTH OVERVIEW"]})}),e.jsx(h,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-2xl text-primary",children:c.length}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"TOTAL SESSIONS"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-2xl text-white",children:Ee}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"THIS WEEK"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-arcade text-2xl text-secondary",children:[Se,"m"]}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"AVG/SESSION"})]})]})})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs text-white flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"})," WHAT APPEARS TO BE WORKING"]})}),e.jsxs(h,{className:"p-6",children:[e.jsx("ul",{className:"space-y-3 font-terminal text-sm",children:g.filter(s=>(s.totalSessions||0)>=3).length>0?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary shrink-0 mt-0.5"}),e.jsxs("span",{children:[g.filter(s=>(s.totalSessions||0)>=3).length," courses have consistent study activity"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary shrink-0 mt-0.5"}),e.jsx("span",{children:"Round-robin rotation ensuring balanced coverage"})]})]}):e.jsx("li",{className:"text-muted-foreground",children:"Insufficient data for strong conclusions. Aim for at least ~10 logged sessions (via the Dashboard Study Wheel) before trusting these patterns."})}),e.jsx("div",{className:"mt-3 pt-3 border-t border-primary/30",children:e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-primary/40",children:["CONFIDENCE: ",c.length>10?"MEDIUM":"LOW"," (based on ",c.length," sessions)"]})})]})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-destructive/50 rounded-none",children:[e.jsx(N,{className:"border-b border-destructive/30",children:e.jsxs(j,{className:"font-arcade text-xs text-destructive flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"})," POTENTIAL CONCERNS"]})}),e.jsxs(h,{className:"p-6",children:[e.jsxs("ul",{className:"space-y-3 font-terminal text-sm",children:[O.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[O.length," courses with low activity: ",O.map(s=>s.name).join(", ")]})]}),_.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[_.length," unresolved confusions logged"]})]}),q.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[q.length," session issues flagged"]})]}),O.length===0&&_.length===0&&q.length===0&&e.jsx("li",{className:"text-muted-foreground",children:"No significant concerns identified yet. Keep logging sessions; Scholar will surface issues here once patterns emerge."})]}),we&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] border-primary text-primary",onClick:()=>o("analysis"),"data-testid":"cta-open-analysis-from-summary",children:"OPEN DETAILED ANALYSIS"}),e.jsx(w,{variant:"ghost",size:"sm",className:"rounded-none font-arcade text-[10px]",onClick:()=>{window.location.href="/brain"},"data-testid":"cta-open-brain-from-summary",children:"REVIEW SESSIONS IN BRAIN"})]})]})]})]}),e.jsxs(u,{className:`bg-black/40 ${y} flex flex-col`,children:[e.jsx(N,{className:"border-b border-primary/30 shrink-0 sticky top-0 bg-black/95 z-10",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," ASK SCHOLAR"]})}),e.jsxs(h,{className:"p-0 flex-1 flex flex-col",children:[e.jsx(Oe,{className:"flex-1 p-3 min-h-[400px]",children:e.jsxs("div",{className:"space-y-3",children:[d.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Ask questions about your study data, patterns, or get recommendations."})]}),d.map((s,l)=>e.jsx("div",{className:T("p-2 rounded-none font-terminal text-xs",s.role==="user"?"bg-primary/20 text-primary ml-8":"bg-secondary/20 text-white mr-8"),children:s.content},l)),n&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground font-terminal text-xs",children:[e.jsx(M,{className:`${k} animate-spin`}),"Analyzing Brain data..."]}),e.jsx("div",{ref:v})]})}),e.jsx("div",{className:"p-2 border-t border-primary/30 shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(De,{value:t,onChange:s=>m(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),J())},placeholder:"Ask about your study patterns...",className:"rounded-none bg-black border-primary/40 text-xs min-h-[60px] resize-none","data-testid":"input-scholar-chat"}),e.jsx(w,{size:"icon",className:"rounded-none bg-primary text-black h-[60px] w-10",onClick:J,disabled:n,"data-testid":"button-send-chat",children:e.jsx(He,{className:"w-4 h-4"})})]})})]})]})]})]}),e.jsx(U,{value:"analysis",className:"flex-1 overflow-auto mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground",children:"Scholar analysis walks from how Tutor behaved, to where issues cluster, to concrete questions and evidence. If something looks important here, expect or create a matching proposal on the next tab."}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"})," TUTOR AUDIT"]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:`bg-black/40 ${F}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs text-primary flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"})," TUTOR BEHAVIOR AUDIT"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:I.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No audit data available"}):I.map((s,l)=>e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-terminal text-sm",children:s.sessionDate}),e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-primary",children:s.phase})]}),e.jsx("p",{className:"font-terminal text-xs mb-2",children:s.observation}),e.jsx("div",{className:"flex gap-2",children:e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px]",children:s.impact})})]},l))})})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"})," RECURRENT ISSUES"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:Ce.map((s,l)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-terminal text-sm",children:s.issue??"Unknown issue"}),e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-primary text-primary",children:["x",s.frequency??0]})]}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:(s.courses||[]).map((S,Ae)=>e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px]",children:S},Ae))})]},l))})})]})]})})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," QUESTION PIPELINE"]})}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground mb-3",children:"Scholar turns messy issues into tractable questions. Use this section to see what is still unanswered and where more Brain data or external research is needed."}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," QUESTION RESOLUTION PIPELINE"]})}),e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"space-y-2 font-terminal text-xs text-muted-foreground mb-4",children:[e.jsx("p",{children:"1. Generate question from identified issue"}),e.jsx("p",{children:"2. Attempt answer using Brain data"}),e.jsx("p",{children:"3. If insufficient, research learning science"}),e.jsx("p",{children:"4. If still unresolved, escalate to user"})]}),e.jsx("div",{className:"space-y-3",children:[{stage:"Identified",count:5},{stage:"Brain Analysis",count:3},{stage:"Research",count:1},{stage:"User Escalation",count:2}].map((s,l)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-primary/60"}),e.jsx("span",{className:"font-terminal text-sm flex-1",children:s.stage}),e.jsx(p,{variant:"outline",className:"rounded-none",children:s.count})]},l))})]})]}),e.jsxs(u,{className:`bg-black/40 ${F}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs text-primary flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"})," OPEN QUESTIONS"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:Re.map(s=>e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/30",children:[e.jsx("p",{className:"font-terminal text-sm mb-3",children:s.question}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground shrink-0",children:"Context:"}),e.jsx("span",{children:s.context})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground shrink-0",children:"Data Gap:"}),e.jsx("span",{children:s.dataInsufficient})]})]})]},s.id))})})]})]})]})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"})," EVIDENCE REVIEW"]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"})," OBSERVED DATA"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:R.map((s,l)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:s.category}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:s.sessionDate})]}),e.jsx("p",{className:"font-terminal text-sm",children:s.observation})]},l))})})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"})," RESEARCH INTERPRETATION"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:ke.map((s,l)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsx("div",{className:"font-arcade text-xs text-primary mb-2",children:s.topic??s.title}),e.jsx("p",{className:"font-terminal text-xs mb-2",children:s.summary??s.content}),e.jsx("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:e.jsxs("span",{children:["Source: ",s.source]})})]},l))})})]})]})})]}),e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsxs(N,{className:"border-b border-primary/30 flex flex-row items-center justify-between",children:[e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"})," TOPIC CLUSTERS"]}),e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs",onClick:()=>z.mutate(),disabled:z.isPending,children:z.isPending?"Running...":"Run Clustering"})]}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground mb-3",children:"Clustering works best after you have a healthy volume of sessions and findings. Use it to spot recurring themes that might deserve their own proposals."}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:L?.clusters?.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground col-span-2",children:"No clusters yet. Run clustering to analyze."}):L?.clusters?.map(s=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-arcade text-xs text-primary",children:["Cluster ",s.cluster_id]}),e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:[s.count," items"]})]}),e.jsx("div",{className:"space-y-2",children:s.items.map((l,S)=>e.jsxs("div",{className:"flex items-center gap-2 font-terminal text-xs",children:[e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px] shrink-0",children:l.source==="digest"?"DIG":"PROP"}),e.jsx("span",{className:"truncate",children:l.title||"Untitled"})]},S))})]},s.cluster_id))})]})]}),b.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] mt-2",onClick:()=>o("proposals"),"data-testid":"cta-next-proposals-from-analysis",children:"NEXT: REVIEW PROPOSALS"})})]})}),e.jsx(U,{value:"proposals",className:"flex-1 overflow-auto mt-4",children:e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsxs(N,{className:"border-b border-primary/30",children:[e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," IMPROVEMENT PROPOSALS"]}),e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mt-1",children:"No auto-implementation. All changes require user approval."}),e.jsxs("p",{className:"font-terminal text-[10px] text-muted-foreground mt-1",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Status legend:"})," ","DRAFT = idea only, APPROVED = you intend to implement, IMPLEMENTED = change applied, REJECTED = explicitly declined."]})]}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"font-arcade text-xs text-primary mb-2",children:"NO PROPOSALS YET"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Proposals are generated by the Scholar workflow after analyzing Brain session data. Run a Scholar analysis from the dashboard or via the Scholar CLI to create proposals."})]}):b.filter(s=>s.status!=="REJECTED").map(s=>e.jsxs("div",{className:"p-4 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:s.proposalId}),e.jsx("h4",{className:"font-terminal text-sm mt-1",children:s.summary})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(p,{variant:"outline",className:T("rounded-none text-[9px]",Te(s.priority||"MED")),children:s.priority||"MED"})})]}),s.targetSystem&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Target system: "}),e.jsx(p,{variant:"secondary",className:"rounded-none text-[9px]",children:s.targetSystem})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-primary/30",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-primary/40",children:"Confidence: MED"}),e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-primary/40",children:"Risk: LOW"})]}),e.jsxs(ce,{value:s.status||"DRAFT",onValueChange:l=>ye.mutate({id:s.id,data:{status:l}}),children:[e.jsx(oe,{className:T("rounded-none w-28 h-7 text-[10px]",X(s.status||"DRAFT")),"data-testid":`select-proposal-status-${s.id}`,children:e.jsx(de,{})}),e.jsxs(xe,{className:"rounded-none bg-black border-primary",children:[e.jsx(A,{value:"DRAFT",children:"PROPOSED"}),e.jsx(A,{value:"APPROVED",children:"APPROVED"}),e.jsx(A,{value:"REJECTED",children:"REJECTED"}),e.jsx(A,{value:"IMPLEMENTED",children:"IMPLEMENTED"})]})]})]})]},s.id))})})]})}),e.jsx(U,{value:"history",className:"flex-1 overflow-auto mt-4",children:e.jsxs(u,{className:`bg-black/40 ${y}`,children:[e.jsx(N,{className:"border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"})," PROPOSAL HISTORY (READ ONLY)"]})}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mb-2",children:"Read-only log of every Scholar proposal and its final status. Use this to see what has already been tried and decided before creating new changes."}),e.jsx("div",{className:"space-y-2",children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"font-arcade text-xs text-primary mb-2",children:"NO HISTORY YET"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Proposal history will appear here once Scholar generates its first analysis."})]}):b.map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-black/40 border border-secondary/50 font-terminal text-sm","data-testid":`history-proposal-${s.id}`,children:[e.jsx("div",{className:"w-20 font-terminal text-xs text-muted-foreground",children:s.proposalId}),e.jsx("div",{className:"flex-1 truncate",children:s.summary}),e.jsxs("div",{className:"flex gap-2 items-center shrink-0",children:[e.jsx(p,{variant:"outline",className:T("rounded-none text-[9px]",X(s.status||"DRAFT")),children:s.status||"DRAFT"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx(me,{className:`${k} inline mr-1`}),s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A"]})]})]},s.id))})]})]})})]})})]})})}export{vs as default};
