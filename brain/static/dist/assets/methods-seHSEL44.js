import{c as G,j as e,r as c,X as K,m as he,u as pe}from"./index-BcW_Cmk8.js";import{G as fe,c as C,D as A,d as T,e as I,f as O,g as Q,u as R,a as k,L as be,h as ge,I as _,b as N}from"./layout-7VRRr6LV.js";import{S as L,a as D,b as M,c as B,d as w}from"./select-BEb3BClr.js";import{P as X,a as Ne,E as je,b as ye}from"./colors-Bbj8o8sD.js";import{C as ve}from"./clock-BgeJMOFG.js";import{Z as Ce}from"./zap-CQ5p8Jjg.js";import{P as $}from"./plus-BEvv455R.js";import{T as Se}from"./trending-up-CrljBGRL.js";import{S as F}from"./star-DSe05mgE.js";import{P}from"./play-DceHeVdo.js";import{L as ke}from"./loader-circle-rMUrwLQR.js";import{C as we,a as Ee}from"./index-CBZ66Q7a.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],_e=G("arrow-right",Re);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ee=G("chart-column",Ae);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ie=G("link-2",Te),Z={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"};function U({block:a,compact:l,onClick:m,draggable:i,onDragStart:x}){const u=X[a.category]||Ne,t=u.border,r=u.badge,f=je[a.energy_cost]||ye;return l?e.jsx("div",{className:`border-2 ${t} p-2 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-terminal text-base truncate",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1 py-0.5 rounded-none ${r}`,children:Z[a.category]||a.category.toUpperCase()})]})}):e.jsxs("div",{className:`border-2 ${t} p-3 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-arcade text-sm",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 rounded-none ${r}`,children:Z[a.category]||a.category.toUpperCase()})]}),a.description&&e.jsx("p",{className:"font-terminal text-lg text-muted-foreground mb-2 line-clamp-2",children:a.description}),a.evidence&&e.jsx("p",{className:"font-terminal text-base text-primary/50 italic mb-2 line-clamp-1",children:a.evidence}),e.jsxs("div",{className:"flex items-center gap-3 text-base text-muted-foreground font-terminal",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),a.default_duration_min,"m"]}),e.jsxs("span",{className:`flex items-center gap-1 ${f}`,children:[e.jsx(Ce,{className:"w-4 h-4"}),a.energy_cost]}),a.best_stage&&e.jsx("span",{className:"text-primary/60",children:a.best_stage.replace("_"," ")})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags.slice(0,4).map(h=>e.jsx("span",{className:"text-sm font-terminal bg-secondary/30 px-1 py-0.5 text-muted-foreground",children:h},h))})]})}function Oe({chain:a,allBlocks:l,onSave:m,readOnly:i}){const[x,u]=c.useState(a.block_ids||[]),[t,r]=c.useState(!1),f=new Map(l.map(d=>[d.id,d])),h=x.map(d=>f.get(d)).filter(Boolean),b=d=>{const n=[...x];n.splice(d,1),u(n),m(n)},y=d=>{const n=[...x,d];u(n),m(n),r(!1)},g=d=>{if(d===0)return;const n=[...x];[n[d-1],n[d]]=[n[d],n[d-1]],u(n),m(n)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN BLOCKS"}),e.jsxs("span",{className:"text-xs font-terminal text-muted-foreground",children:["(",h.length," blocks)"]})]}),h.length===0&&e.jsx("div",{className:"border-[3px] border-dashed border-secondary p-4 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No blocks in this chain yet"})}),e.jsx("div",{className:"space-y-2",children:h.map((d,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!i&&e.jsx("button",{className:"text-muted-foreground hover:text-primary cursor-grab",onClick:()=>g(n),title:"Move up",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(U,{block:d,compact:!0})}),n<h.length-1&&e.jsx(_e,{className:"w-3 h-3 text-primary/40 shrink-0"}),!i&&e.jsx("button",{className:"text-muted-foreground hover:text-red-400",onClick:()=>b(n),children:e.jsx(K,{className:"w-3 h-3"})})]},`${d.id}-${n}`))}),!i&&e.jsx("div",{children:t?e.jsxs("div",{className:"border-[3px] border-double border-primary/30 bg-black/50 p-3 space-y-2 max-h-48 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-xs text-primary",children:"ADD BLOCK"}),e.jsx("button",{onClick:()=>r(!1),children:e.jsx(K,{className:"w-3 h-3 text-muted-foreground"})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:l.map(d=>e.jsx(U,{block:d,compact:!0,onClick:()=>y(d.id)},d.id))})]}):e.jsxs(C,{variant:"outline",size:"sm",className:"w-full rounded-none border-[3px] border-dashed border-secondary font-arcade text-xs",onClick:()=>r(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})})]})}function Le({data:a}){const{block_stats:l,chain_stats:m,recent_ratings:i}=a,x=l.filter(t=>t.usage_count>0),u=m.filter(t=>t.usage_count>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ee,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"BLOCK EFFECTIVENESS"})]}),x.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings yet. Rate methods after study sessions to see analytics."}):e.jsx("div",{className:"space-y-2",children:x.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-32 truncate",children:t.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:`h-full ${X[t.category]?.bar||"bg-primary"}`,style:{width:`${(t.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground w-8 text-right",children:t.avg_effectiveness??"—"}),e.jsxs("span",{className:"font-terminal text-xs text-muted-foreground w-6 text-right",children:["(",t.usage_count,")"]})]},t.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN COMPARISON"})]}),u.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No chain ratings yet."}):e.jsx("div",{className:"space-y-2",children:u.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-40 truncate",children:t.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${(t.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground w-8 text-right",children:t.avg_effectiveness??"—"})]},t.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(F,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"RECENT RATINGS"})]}),i.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings recorded yet."}):e.jsx("div",{className:"space-y-2",children:i.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center justify-between border border-secondary/50 p-2 rounded-none",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-terminal text-xs",children:t.method_name||t.chain_name||"Unknown"}),t.notes&&e.jsx("p",{className:"font-terminal text-xs text-muted-foreground mt-0.5 truncate max-w-[200px]",children:t.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-terminal",children:[e.jsxs("span",{children:["E:",t.effectiveness,"/5"]}),e.jsxs("span",{children:["G:",t.engagement,"/5"]})]})]},t.id))})]})]})}function J({value:a,onChange:l,label:m}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:m}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{onClick:()=>l(i),className:"p-0.5 hover:scale-110 transition-transform",children:e.jsx(F,{className:`w-5 h-5 ${i<=a?"text-primary fill-primary":"text-secondary"}`})},i))})]})}function De({open:a,onClose:l,onSubmit:m,targetName:i,targetType:x}){const[u,t]=c.useState(0),[r,f]=c.useState(0),[h,b]=c.useState(""),y=()=>{u===0||r===0||(m({effectiveness:u,engagement:r,notes:h}),t(0),f(0),b(""),l())};return e.jsx(A,{open:a,onOpenChange:g=>!g&&l(),children:e.jsxs(T,{className:"bg-black border-[3px] border-double border-primary rounded-none max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(I,{className:"font-arcade text-xs text-primary",children:["RATE ",x.toUpperCase()]}),e.jsx(O,{className:"sr-only",children:"Rate the effectiveness and engagement of this method"}),e.jsx("button",{onClick:l,children:e.jsx(K,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"font-terminal text-sm",children:i}),e.jsx(J,{value:u,onChange:t,label:"EFFECTIVENESS (did it help you learn?)"}),e.jsx(J,{value:r,onChange:f,label:"ENGAGEMENT (did it hold your focus?)"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:"NOTES (optional)"}),e.jsx(Q,{value:h,onChange:g=>b(g.target.value),placeholder:"What worked? What didn't?",className:"h-16 bg-secondary/20 border-[3px] border-double border-secondary font-terminal text-sm rounded-none resize-none mt-1"})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:y,disabled:u===0||r===0,children:"SUBMIT RATING"})]})]})})}const Me=["all","prepare","encode","interrogate","retrieve","refine","overlearn"],se={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"},Be=[{id:"library",label:"LIBRARY",icon:ge},{id:"chains",label:"CHAINS",icon:Ie},{id:"analytics",label:"ANALYTICS",icon:ee}];function es(){const[a,l]=c.useState("library"),[m,i]=c.useState("all"),[x,u]=c.useState(""),[t,r]=c.useState(!1),[f,h]=c.useState(!1),[b,y]=c.useState(null),[g,d]=c.useState(null),[n,S]=c.useState(null),[p,E]=c.useState(null),{toast:v}=he(),o=pe(),{data:H=[],isLoading:V}=R({queryKey:["methods"],queryFn:()=>N.methods.getAll()}),{data:q=[],isLoading:te}=R({queryKey:["chains"],queryFn:()=>N.chains.getAll()}),{data:z,isLoading:ae}=R({queryKey:["methods-analytics"],queryFn:()=>N.methods.analytics(),enabled:a==="analytics"}),{data:re=[]}=R({queryKey:["courses-active"],queryFn:()=>N.courses.getActive(),enabled:!!n}),{data:Y=[]}=R({queryKey:["chain-run-history"],queryFn:()=>N.chainRun.getHistory(),enabled:a==="chains"}),ne=k({mutationFn:N.methods.create,onSuccess:()=>{o.invalidateQueries({queryKey:["methods"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),r(!1),v({title:"Method block created"})}}),ie=k({mutationFn:N.methods.delete,onSuccess:()=>{o.invalidateQueries({queryKey:["methods"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Method block deleted"})}}),de=k({mutationFn:N.chains.create,onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),h(!1),v({title:"Chain created"})}}),le=k({mutationFn:({id:s,data:j})=>N.chains.update(s,j),onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),v({title:"Chain updated"})}}),oe=k({mutationFn:N.chains.delete,onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),y(null),v({title:"Chain deleted"})}}),ce=k({mutationFn:({id:s,data:j})=>N.methods.rate(s,j),onSuccess:()=>{o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),me=k({mutationFn:({id:s,data:j})=>N.chains.rate(s,j),onSuccess:()=>{o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),W=H.filter(s=>!(m!=="all"&&s.category!==m||x&&!s.name.toLowerCase().includes(x.toLowerCase()))),xe=async s=>{const j=await N.chains.getOne(s.id);y(j)},ue=s=>{g&&(g.type==="method"?ce.mutate({id:g.id,data:s}):me.mutate({id:g.id,data:s}))};return e.jsx(be,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-arcade text-xl text-primary",children:"METHOD_LIBRARY"}),e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Composable study methods — build, chain, rate, optimize"})]})}),e.jsx("div",{className:"flex gap-1 border-b-2 border-primary/30 pb-0",children:Be.map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:`flex items-center gap-1.5 px-3 py-2 font-arcade text-sm border-b-2 -mb-[2px] transition-colors ${a===s.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(s.icon,{className:"w-3 h-3"}),s.label]},s.id))}),a==="library"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_,{placeholder:"Search methods...",value:x,onChange:s=>u(s.target.value),className:"w-64 bg-black/40"}),e.jsx("div",{className:"flex gap-1",children:Me.map(s=>e.jsx("button",{onClick:()=>i(s),className:`px-3 py-1.5 font-arcade text-xs border-[3px] border-double rounded-none transition-colors ${m===s?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50 hover:bg-black/30"}`,children:se[s]||s.toUpperCase()},s))}),e.jsxs(C,{variant:"outline",size:"sm",className:"ml-auto rounded-none border-[3px] border-double font-arcade text-sm h-10",onClick:()=>r(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})]}),V?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading methods..."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:W.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx(U,{block:s}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx("button",{className:"p-1 bg-black/80 border border-primary/40 hover:border-primary",onClick:()=>d({id:s.id,name:s.name,type:"method"}),title:"Rate",children:e.jsx(F,{className:"w-3 h-3 text-primary"})}),e.jsx("button",{className:"p-1 bg-black/80 border border-destructive/40 hover:border-destructive text-destructive",onClick:()=>{confirm(`Delete "${s.name}"?`)&&ie.mutate(s.id)},title:"Delete",children:e.jsx("span",{className:"text-xs",children:"x"})})]})]},s.id))}),!V&&W.length===0&&e.jsxs("p",{className:"font-terminal text-base text-muted-foreground text-center py-8",children:["No methods found. ",m!=="all"?"Try a different category.":"Add your first method block."]})]}),a==="chains"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-arcade text-sm text-muted-foreground",children:[q.length," CHAINS (",q.filter(s=>s.is_template).length," templates)"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-[3px] border-double font-arcade text-sm h-10",onClick:()=>h(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," NEW CHAIN"]})]}),te?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading chains..."}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:q.map(s=>e.jsxs("div",{onClick:()=>xe(s),className:`border-[3px] border-double p-3 rounded-none cursor-pointer transition-colors ${b?.id===s.id?"border-primary bg-primary/10":"border-muted-foreground/30 hover:border-muted-foreground/50 hover:bg-black/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_template?e.jsx("span",{className:"text-xs font-arcade bg-primary/20 text-primary px-1.5 py-0.5",children:"TEMPLATE"}):null,e.jsx("button",{className:"p-0.5 hover:text-success",onClick:j=>{j.stopPropagation(),S({id:s.id,name:s.name})},title:"Run chain",children:e.jsx(P,{className:"w-3 h-3"})}),e.jsx("button",{className:"p-0.5 hover:text-primary",onClick:j=>{j.stopPropagation(),d({id:s.id,name:s.name,type:"chain"})},children:e.jsx(F,{className:"w-3 h-3"})})]})]}),s.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground line-clamp-1",children:s.description}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:(s.block_ids||[]).length>0&&e.jsxs("span",{className:"text-sm font-terminal text-muted-foreground",children:[(s.block_ids||[]).length," blocks"]})})]},s.id))}),e.jsx("div",{className:"border-[3px] border-double border-primary/30 bg-black/40 p-4 rounded-none",children:b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-arcade text-sm text-primary",children:b.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-[3px] border-double border-success text-success font-arcade text-xs h-8",onClick:()=>S({id:b.id,name:b.name}),children:[e.jsx(P,{className:"w-3 h-3 mr-1"})," RUN"]}),!b.is_template&&e.jsx(C,{variant:"ghost",size:"sm",className:"text-destructive rounded-none text-xs font-arcade h-8",onClick:()=>{confirm(`Delete chain "${b.name}"?`)&&oe.mutate(b.id)},children:"DELETE"})]})]}),b.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:b.description}),e.jsx(Oe,{chain:b,allBlocks:H,readOnly:!!b.is_template,onSave:s=>{le.mutate({id:b.id,data:{block_ids:s}})}})]}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Select a chain to view or edit"})})})]}),Y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-arcade text-sm text-muted-foreground",children:"RUN HISTORY"}),e.jsx("div",{className:"border-[3px] border-double border-primary/30 rounded-none overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-primary/30 bg-black/60",children:[e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"CHAIN"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STATUS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STEPS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"DATE"})]})}),e.jsx("tbody",{children:Y.slice(0,10).map(s=>e.jsxs("tr",{className:"border-b border-primary/20 hover:bg-primary/5 cursor-pointer",onClick:async()=>{const j=await N.chainRun.getOne(s.id);E(j)},children:[e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base",children:s.chain_name}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:s.topic}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 ${s.status==="completed"?"bg-success/20 text-success":s.status==="failed"?"bg-destructive/20 text-destructive":"bg-warning/20 text-warning"}`,children:s.status.toUpperCase()})}),e.jsxs("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:[s.current_step,"/",s.total_steps]}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:new Date(s.started_at).toLocaleDateString()})]},s.id))})]})})]})]}),a==="analytics"&&e.jsx("div",{children:ae?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading analytics..."}):z?e.jsx(Le,{data:z}):e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Failed to load analytics."})}),e.jsx(Fe,{open:t,onClose:()=>r(!1),onSubmit:s=>ne.mutate(s)}),e.jsx(qe,{open:f,onClose:()=>h(!1),onSubmit:s=>de.mutate(s)}),n&&e.jsx(Ke,{open:!!n,chainId:n.id,chainName:n.name,courses:re,onClose:()=>S(null),onComplete:s=>{E(s),S(null),o.invalidateQueries({queryKey:["chain-run-history"]}),v({title:`${s.chain_name} ${s.status}`})}}),p&&e.jsx($e,{open:!!p,result:p,onClose:()=>E(null)}),g&&e.jsx(De,{open:!!g,onClose:()=>d(null),onSubmit:ue,targetName:g.name,targetType:g.type})]})})}function Fe({open:a,onClose:l,onSubmit:m}){const[i,x]=c.useState(""),[u,t]=c.useState("prepare"),[r,f]=c.useState(""),[h,b]=c.useState(5),[y,g]=c.useState("medium"),[d,n]=c.useState(""),S=()=>{i.trim()&&(m({name:i.trim(),category:u,description:r.trim()||null,default_duration_min:h,energy_cost:y,best_stage:d||null,tags:[]}),x(""),f(""))};return e.jsx(A,{open:a,onOpenChange:p=>!p&&l(),children:e.jsxs(T,{className:"bg-black border-[3px] border-double border-primary rounded-none max-w-md",children:[e.jsx(I,{className:"font-arcade text-sm text-primary",children:"NEW METHOD BLOCK"}),e.jsx(O,{className:"sr-only",children:"Create a new method block"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(_,{placeholder:"Method name",value:i,onChange:p=>x(p.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsxs(L,{value:u,onValueChange:t,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["prepare","encode","interrogate","retrieve","refine","overlearn"].map(p=>e.jsx(w,{value:p,className:"font-terminal text-sm",children:se[p]||p.charAt(0).toUpperCase()+p.slice(1)},p))})]}),e.jsx(Q,{placeholder:"Description (optional)",value:r,onChange:p=>f(p.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"DURATION"}),e.jsx(_,{type:"number",value:h,onChange:p=>b(Number(p.target.value)),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"ENERGY"}),e.jsxs(L,{value:y,onValueChange:g,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["low","medium","high"].map(p=>e.jsx(w,{value:p,className:"font-terminal text-sm",children:p},p))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"BEST STAGE"}),e.jsxs(L,{value:d,onValueChange:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"Any"})}),e.jsxs(B,{className:"bg-black border-2 border-primary rounded-none",children:[e.jsx(w,{value:"first_exposure",className:"font-terminal text-sm",children:"First Exposure"}),e.jsx(w,{value:"review",className:"font-terminal text-sm",children:"Review"}),e.jsx(w,{value:"exam_prep",className:"font-terminal text-sm",children:"Exam Prep"}),e.jsx(w,{value:"consolidation",className:"font-terminal text-sm",children:"Consolidation"})]})]})]})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:S,disabled:!i.trim(),children:"CREATE BLOCK"})]})]})})}function qe({open:a,onClose:l,onSubmit:m}){const[i,x]=c.useState(""),[u,t]=c.useState(""),r=()=>{i.trim()&&(m({name:i.trim(),description:u.trim()||null,block_ids:[],context_tags:{},is_template:0}),x(""),t(""))};return e.jsx(A,{open:a,onOpenChange:f=>!f&&l(),children:e.jsxs(T,{className:"bg-black border-[3px] border-double border-primary rounded-none max-w-md",children:[e.jsx(I,{className:"font-arcade text-sm text-primary",children:"NEW CHAIN"}),e.jsx(O,{className:"sr-only",children:"Create a new method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(_,{placeholder:"Chain name",value:i,onChange:f=>x(f.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsx(Q,{placeholder:"Description (optional)",value:u,onChange:f=>t(f.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsx("p",{className:"font-terminal text-sm text-muted-foreground",children:"Add blocks to the chain after creating it."}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:r,disabled:!i.trim(),children:"CREATE CHAIN"})]})]})})}function Ke({open:a,chainId:l,chainName:m,courses:i,onClose:x,onComplete:u}){const[t,r]=c.useState(""),[f,h]=c.useState(""),[b,y]=c.useState(!0),[g,d]=c.useState(!0),[n,S]=c.useState(!1),[p,E]=c.useState(null),v=async()=>{if(t.trim()){S(!0),E(null);try{const o=await N.chainRun.start({chain_id:l,topic:t.trim(),course_id:f?Number(f):void 0,options:{write_obsidian:b,draft_cards:g}});u(o)}catch(o){E(o instanceof Error?o.message:"Chain run failed"),S(!1)}}};return e.jsx(A,{open:a,onOpenChange:o=>!o&&!n&&x(),children:e.jsxs(T,{className:"bg-black border-[3px] border-double border-primary rounded-none max-w-md",children:[e.jsxs(I,{className:"font-arcade text-sm text-primary",children:["RUN: ",m]}),e.jsx(O,{className:"sr-only",children:"Configure and run a method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx(_,{placeholder:"e.g., Glenohumeral Joint Ligaments",value:t,onChange:o=>r(o.target.value),disabled:n,className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"COURSE (OPTIONAL)"}),e.jsxs(L,{value:f,onValueChange:h,disabled:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"None"})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:i.map(o=>e.jsx(w,{value:String(o.id),className:"font-terminal text-sm",children:o.name},o.id))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:o=>y(o.target.checked),disabled:n,className:"accent-primary"}),"Write to Obsidian"]}),e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:o=>d(o.target.checked),disabled:n,className:"accent-primary"}),"Draft Anki cards"]})]}),p&&e.jsx("p",{className:"font-terminal text-base text-destructive",children:p}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:v,disabled:!t.trim()||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3 h-3 mr-2 animate-spin"}),"RUNNING..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-3 h-3 mr-1"})," START"]})}),n&&e.jsx("p",{className:"font-terminal text-sm text-muted-foreground text-center",children:"This may take 15-45 seconds depending on chain length."})]})]})})}function $e({open:a,result:l,onClose:m}){const[i,x]=c.useState(new Set([1])),u=r=>{x(f=>{const h=new Set(f);return h.has(r)?h.delete(r):h.add(r),h})},t=l.artifacts?.metrics;return e.jsx(A,{open:a,onOpenChange:r=>!r&&m(),children:e.jsxs(T,{className:"bg-black border-[3px] border-double border-primary rounded-none max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{className:"font-arcade text-sm text-primary flex items-center gap-2",children:[l.chain_name," RESULTS",e.jsx("span",{className:`text-xs px-1.5 py-0.5 ${l.status==="completed"?"bg-success/20 text-success":"bg-destructive/20 text-destructive"}`,children:l.status.toUpperCase()})]}),e.jsx(O,{className:"sr-only",children:"Chain run results"}),t&&e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"DURATION"}),e.jsxs("span",{className:"font-terminal text-sm",children:[(t.total_duration_ms/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"STEPS"}),e.jsx("span",{className:"font-terminal text-sm",children:t.steps_completed})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"CARDS"}),e.jsx("span",{className:"font-terminal text-sm",children:t.cards_drafted})]}),l.artifacts?.obsidian_path&&e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"OBSIDIAN"}),e.jsx("span",{className:"font-terminal text-sm text-success",children:"saved"})]})]}),e.jsx("div",{className:"space-y-2 mt-3",children:l.steps.map(r=>e.jsxs("div",{className:"border border-primary/30 rounded-none",children:[e.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-primary/5 text-left",onClick:()=>u(r.step),children:[i.has(r.step)?e.jsx(we,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}):e.jsx(Ee,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"font-arcade text-xs text-primary",children:[r.step,"."]}),e.jsx("span",{className:"font-terminal text-base",children:r.method_name}),e.jsxs("span",{className:"ml-auto font-terminal text-sm text-muted-foreground",children:[r.category," | ",(r.duration_ms/1e3).toFixed(1),"s"]})]}),i.has(r.step)&&e.jsx("div",{className:"px-3 pb-3 border-t border-primary/20",children:e.jsx("pre",{className:"font-terminal text-base text-muted-foreground whitespace-pre-wrap mt-2 leading-relaxed",children:r.output})})]},r.step))}),l.error&&e.jsxs("div",{className:"mt-3 border border-destructive/40 bg-destructive/10 px-3 py-2",children:[e.jsx("span",{className:"font-arcade text-xs text-destructive",children:"ERROR: "}),e.jsx("span",{className:"font-terminal text-base text-destructive/80",children:l.error})]}),e.jsx(C,{variant:"outline",className:"w-full mt-3 font-arcade rounded-none text-xs",onClick:m,children:"CLOSE"})]})})}export{es as default};
