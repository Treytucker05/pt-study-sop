import{c as le,j as e,a as Ie,r as o,X as ye,u as Ae}from"./index-BcW_Cmk8.js";import{u as ee,b as D,S as ue,H as Ne,J as Pe,c as B,G as qe,K as Ue,I as Ke,C as Le,B as Be,T as Ge,L as he}from"./layout-7VRRr6LV.js";import{B as P,C as fe}from"./badge-CcvPSPps.js";import{e as w,c as E,f as ne,a as re,j as Z,k as oe,d as ke,P as de,b as je,I as ze,h as Qe}from"./theme-DbEL8_7A.js";import{C as ie}from"./checkbox-D96jaIyJ.js";import{M as He,t as I}from"./MaterialUploader-Dd3zu0Le.js";import{L as me}from"./loader-circle-rMUrwLQR.js";import{F as pe}from"./file-text-D1KMrGe1.js";import{a as ve,C as Oe}from"./index-CBZ66Q7a.js";import{C as xe}from"./clock-BgeJMOFG.js";import{Z as Ce}from"./zap-CQ5p8Jjg.js";import{D as Ve,C as we,F as De,a as We,b as Xe,M as Ye,r as Je,P as Ze}from"./index-DtHNA_nq.js";import{L as er}from"./link-BH9ZrhXj.js";import{S as rr,a as sr}from"./send-CKxGQpzc.js";import{S as tr,a as ar}from"./square-e7OD9JTR.js";import{M as ge}from"./message-square-BVsLKndd.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],or=le("cloud",nr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Re=le("credit-card",ir);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],cr=le("cpu",lr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Se=le("globe",dr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Me=le("map",mr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],ur=le("panel-right-close",xr);function ce({className:a,...n}){return e.jsx("div",{className:Ie("animate-pulse rounded-md bg-primary/10",a),...n})}const pr={pdf:"PDF",docx:"DOC",pptx:"PPT",md:"MD",txt:"TXT"};function hr({courseId:a,selectedMaterials:n,setSelectedMaterials:g}){const{data:S=[],isLoading:p}=ee({queryKey:["tutor-materials",a],queryFn:()=>D.tutor.getMaterials(a?{course_id:a}:void 0)}),N=c=>{g(n.includes(c)?n.filter(A=>A!==c):[...n,c])},h=()=>{n.length===S.length?g([]):g(S.map(c=>c.id))};return p?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx(me,{className:`${w} animate-spin text-muted-foreground`})}):S.length===0?e.jsx("div",{className:`${E} text-center py-2`,children:"No materials uploaded yet"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${ne} text-muted-foreground hover:text-foreground cursor-pointer border-b border-muted-foreground/10 pb-1`,children:[e.jsx(ie,{checked:S.length>0&&n.length===S.length,onCheckedChange:h,className:"w-3 h-3"}),e.jsx("span",{children:"Select all"}),e.jsxs(P,{variant:"outline",className:`ml-auto ${re} h-4 px-1`,children:[n.length,"/",S.length]})]}),S.map(c=>e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${ne} text-muted-foreground hover:text-foreground cursor-pointer`,children:[e.jsx(ie,{checked:n.includes(c.id),onCheckedChange:()=>N(c.id),className:"w-3 h-3"}),e.jsx(pe,{className:`${w} text-primary/60 shrink-0`}),e.jsx("span",{className:"truncate flex-1",children:c.title}),e.jsx(P,{variant:"outline",className:`${re} h-4 px-1 shrink-0`,children:pr[c.file_type]||c.file_type.toUpperCase()})]},c.id))]})}const $e=["prepare","encode","interrogate","retrieve","refine","overlearn"];function fr({selectedBlockIds:a,setSelectedBlockIds:n}){const{data:g=[],isLoading:S}=ee({queryKey:["tutor-method-blocks"],queryFn:()=>D.tutor.getMethodBlocks()}),[p,N]=o.useState(new Set),[h,c]=o.useState(null),[A,$]=o.useState(null),y=o.useMemo(()=>{const t=new Map;for(const m of g)t.set(m.id,m);return t},[g]),_=o.useMemo(()=>{const t={};for(const m of $e)t[m]=[];for(const m of g)t[m.category]||(t[m.category]=[]),t[m.category].push(m);return t},[g]),f=o.useMemo(()=>a.map(t=>y.get(t)).filter(Boolean),[a,y]),k=o.useMemo(()=>f.reduce((t,m)=>t+(m.default_duration_min||0),0),[f]),L=t=>{N(m=>{const u=new Set(m);return u.has(t)?u.delete(t):u.add(t),u})},r=t=>{n([...a,t])},i=t=>{n(a.filter((m,u)=>u!==t))},d=t=>{c(t)},C=(t,m)=>{t.preventDefault(),$(m)},l=t=>{if(h===null||h===t){c(null),$(null);return}const m=[...a],[u]=m.splice(h,1);m.splice(t,0,u),n(m),c(null),$(null)},T=()=>{c(null),$(null)};return S?e.jsx("div",{className:`${E} p-2`,children:"Loading blocks..."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`${Z} text-xs`,children:"BLOCK PICKER"}),e.jsx(ue,{className:"h-36 border-[3px] border-double border-primary/30 bg-black/20",children:e.jsx("div",{className:"p-1",children:$e.map(t=>{const m=_[t]||[];if(m.length===0)return null;const u=p.has(t),M=Ne[t];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>L(t),className:"w-full flex items-center gap-1 px-2 py-1 text-left hover:bg-black/30 transition-colors",children:[u?e.jsx(ve,{className:"w-3 h-3",style:{color:M}}):e.jsx(Oe,{className:"w-3 h-3",style:{color:M}}),e.jsxs("span",{className:"font-arcade text-xs uppercase",style:{color:M},children:[Pe[t]," (",m.length,")"]})]}),!u&&e.jsx("div",{className:"pl-4 pb-1 space-y-0.5",children:m.map(F=>e.jsxs("button",{onClick:()=>r(F.id),className:"w-full text-left px-2 py-1 text-xs font-terminal text-foreground/80 hover:bg-primary/10 hover:text-foreground transition-colors flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:F.name}),e.jsxs("span",{className:`${E} text-xs shrink-0 ml-2`,children:["~",F.default_duration_min,"m"]})]},F.id))})]},t)})})}),e.jsxs("div",{className:`${Z} text-xs flex items-center justify-between`,children:[e.jsx("span",{children:"YOUR CHAIN"}),f.length>0&&e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>n([]),className:"h-5 px-2 text-xs font-arcade text-destructive hover:text-destructive",children:"CLEAR"})]}),e.jsx("div",{className:"border-[3px] border-double border-primary/30 bg-black/20 min-h-[60px]",children:f.length===0?e.jsx("div",{className:`${E} text-xs p-3 text-center`,children:"Click blocks above to build your study chain"}):e.jsx("div",{className:"p-1 space-y-0.5",children:f.map((t,m)=>{const u=Ne[t.category]||"#888";return e.jsxs("div",{draggable:!0,onDragStart:()=>d(m),onDragOver:M=>C(M,m),onDrop:()=>l(m),onDragEnd:T,className:`flex items-center gap-1 px-2 py-1 border-[3px] border-double transition-all ${A===m?"border-primary bg-primary/20":"border-primary/20 bg-black/30"}`,children:[e.jsx(qe,{className:"w-3 h-3 text-muted-foreground/40 cursor-grab shrink-0"}),e.jsx(P,{variant:"outline",className:"text-xs rounded-none px-1 h-4 shrink-0",style:{borderColor:u,color:u},children:t.category.slice(0,3).toUpperCase()}),e.jsx("span",{className:"font-terminal text-xs text-foreground/80 truncate flex-1",children:t.name}),e.jsxs("span",{className:`${E} text-xs shrink-0`,children:["~",t.default_duration_min,"m"]}),e.jsx("button",{onClick:()=>i(m),className:"shrink-0 text-muted-foreground/40 hover:text-destructive transition-colors",children:e.jsx(ye,{className:"w-3 h-3"})})]},`${t.id}-${m}`)})})}),f.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("span",{className:`${E} text-xs`,children:[f.length," block",f.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1 font-terminal text-xs text-primary",children:[e.jsx(xe,{className:w}),"~",k," min"]})]})]})}const be=[{value:"arcee-ai/trinity-large-preview:free",label:"Trinity Large (free)"},{value:"qwen/qwen3-coder-next",label:"Qwen3 Coder Next"},{value:"google/gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite"}],br=[{value:"Core",label:"LEARN",desc:"Prime + encode"},{value:"Sprint",label:"REVIEW",desc:"Retrieve + refine"},{value:"Quick Sprint",label:"QUICK",desc:"Quick retrieval"},{value:"Light",label:"LIGHT",desc:"Low energy"},{value:"Drill",label:"FIX",desc:"Target weak spots"}],gr=["Teaching Sprint","Diagnostic Sprint"],_e={Core:"First Exposure (Core)",Sprint:"Review Sprint","Quick Sprint":"Quick Drill",Light:"Low Energy",Drill:"Mastery Review","Teaching Sprint":"First Exposure (Core)","Diagnostic Sprint":"Review Sprint"},Ee="tutor.autopick_chain.v1";function yr(a){try{return localStorage.getItem(a)}catch{return null}}function jr(a,n){try{localStorage.setItem(a,n)}catch{}}function vr(a,n){const g=yr(a);return g===null?n:g==="true"}function ae({children:a,icon:n}){return e.jsxs("div",{className:`${Z} flex items-center gap-1.5 pb-1 border-b border-primary/20 mb-2`,children:[n,a]})}function Te({courseId:a,setCourseId:n,selectedMaterials:g,setSelectedMaterials:S,mode:p,setMode:N,chainId:h,setChainId:c,customBlockIds:A,setCustomBlockIds:$,topic:y,setTopic:_,model:f,setModel:k,webSearch:L,setWebSearch:r,onStartSession:i,isStarting:d,hasActiveSession:C,compact:l=!1}){const{data:T,isLoading:t,isError:m}=ee({queryKey:["tutor-content-sources"],queryFn:()=>D.tutor.getContentSources()}),{data:u=[],isLoading:M,isError:F}=ee({queryKey:["tutor-template-chains"],queryFn:()=>D.tutor.getTemplateChains()}),{data:se=[],isLoading:z}=ee({queryKey:["courses-active"],queryFn:()=>D.courses.getActive()}),q=T?.openrouter_enabled??!1,Q=T?.buster_enabled??!1,j=f==="buster"?"buster":f.includes("/")?"openrouter":"codex";o.useEffect(()=>{!q&&j==="openrouter"&&k("codex"),!Q&&j==="buster"&&k("codex")},[q,Q,j,k]);const O=s=>{if(s==="codex"){k("codex");return}if(s==="openrouter"){if(!q)return;const te=be[0]?.value??"arcee-ai/trinity-large-preview:free";k(f.includes("/")?f:te);return}Q&&k("buster")},[K,W]=o.useState(()=>vr(Ee,!0)),[X,R]=o.useState(null),[U,v]=o.useState("templates");o.useEffect(()=>{jr(Ee,String(K))},[K]);const Y=_e[p],H=o.useMemo(()=>{if(Y)return u.find(s=>s.name===Y)},[u,Y]);o.useEffect(()=>{K&&h===void 0&&H&&X!==p&&(c(H.id),R(p))},[K,h,H?.id,X,p,c]);const J=s=>{if(N(s),!K||h!==void 0)return;const te=_e[s];if(!te)return;const x=u.find(b=>b.name===te);x&&(c(x.id),R(s))};return l?(u.find(s=>s.id===h)?.name,e.jsxs("div",{className:"flex flex-wrap items-end gap-3 p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`${Z} mb-1`,children:"Mode"}),e.jsx("select",{value:p,onChange:s=>J(s.target.value),className:`${oe} border-[3px] border-double border-primary/30 h-9 w-[140px]`,children:br.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${Z} mb-1`,children:"Chain"}),e.jsxs("select",{value:h??"",onChange:s=>c(s.target.value?Number(s.target.value):void 0),className:`${oe} border-[3px] border-double border-primary/30 h-9 w-[180px]`,children:[e.jsx("option",{value:"",children:"Freeform"}),u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${Z} mb-1`,children:"Topic"}),e.jsx("input",{value:y,onChange:s=>_(s.target.value),placeholder:"e.g. Hip Flexors",className:`${ke} border-[3px] border-double border-primary/30 h-9 w-[180px]`})]}),e.jsxs("div",{children:[e.jsx("div",{className:`${Z} mb-1`,children:"Engine"}),e.jsxs("select",{value:j,onChange:s=>O(s.target.value),className:`${oe} border-[3px] border-double border-primary/30 h-9 w-[150px]`,children:[e.jsx("option",{value:"codex",children:"Codex"}),e.jsx("option",{value:"openrouter",disabled:!q,children:"OpenRouter"}),e.jsx("option",{value:"buster",disabled:!Q,children:"OpenClaw (Buster)"})]}),j==="openrouter"&&e.jsx("select",{value:f,onChange:s=>k(s.target.value),className:`${oe} border-[3px] border-double border-primary/30 h-9 w-[180px] mt-1`,children:be.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("label",{className:`flex items-center gap-1.5 h-9 cursor-pointer ${j!=="codex"?"opacity-50":""}`,children:[e.jsx(ie,{checked:L,onCheckedChange:s=>j==="codex"&&r(!!s),disabled:j!=="codex",className:"w-3.5 h-3.5"}),e.jsx(Se,{className:w}),e.jsx("span",{className:"font-terminal text-xs",children:"Web"})]}),e.jsxs(B,{onClick:i,disabled:d||C,className:`h-9 px-5 rounded-none border-2 font-arcade text-xs ${C?"border-success/50 bg-success/10 text-success cursor-default":d?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[d?e.jsx(me,{className:`${w} animate-spin mr-1`}):C?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success animate-pulse"}),"ACTIVE"]}):e.jsx(Ce,{className:`${w} mr-1`}),!d&&!C&&"START"]})]})):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`shrink-0 ${de} pb-2 border-b-[3px] border-double border-primary/30`,children:[e.jsx("div",{className:je,children:"CONTENT FILTER"}),(m||F)&&e.jsxs("div",{className:`${E} text-destructive`,children:["Tutor API unavailable. Start the dashboard via ",e.jsx("span",{className:"font-arcade",children:"Start_Dashboard.bat"}),"."]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 ${E}`,children:[e.jsx(Ve,{className:w}),T?.total_materials??0," materials",e.jsx("span",{className:"text-muted-foreground/40",children:"|"}),T?.total_instructions??0," SOP"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsxs("div",{className:`${de} space-y-2`,children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Mode"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>J("Core"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Core"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LEARN"}),e.jsx("div",{className:`${E} text-xs leading-tight truncate`,children:"Prime + encode"})]}),e.jsxs("button",{onClick:()=>J("Quick Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Quick Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"QUICK"}),e.jsx("div",{className:`${E} text-xs leading-tight truncate`,children:"Quick retrieval"})]})]}),e.jsx("button",{onClick:()=>J("Drill"),className:`w-full text-left px-2 py-2 border-2 transition-colors ${p==="Drill"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"FIX"}),e.jsx("div",{className:`${E} text-xs leading-tight`,children:"Target weak spots"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>J("Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"REVIEW"}),e.jsx("div",{className:`${E} text-xs leading-tight truncate`,children:"Retrieve + refine"})]}),e.jsxs("button",{onClick:()=>J("Light"),className:`text-left px-2 py-2 border-2 transition-colors ${p==="Light"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LIGHT"}),e.jsx("div",{className:`${E} text-xs leading-tight truncate`,children:"Low energy"})]})]})]}),e.jsx("div",{className:`${E} text-xs mt-2`,children:"Auto-picks a chain template. Override below."}),gr.includes(p)&&e.jsxs("div",{className:`${E} text-xs mt-1`,children:["Legacy mode active: ",p]})]}),e.jsxs("div",{children:[e.jsx(ae,{icon:e.jsx(er,{className:w}),children:"Chain"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mb-2 min-w-0",children:[e.jsx("button",{onClick:()=>v("templates"),className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${U==="templates"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"TEMPLATES"}),e.jsx("button",{onClick:()=>{v("custom"),c(void 0)},className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${U==="custom"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"CUSTOM"})]}),U==="templates"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:`${E} text-xs min-w-0 truncate`,children:[e.jsx("span",{className:"opacity-70",children:"Rec:"})," ",H?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground font-medium",children:H.name}),e.jsxs(P,{variant:"outline",className:`ml-1 ${re} h-4 px-1.5 text-xs`,children:[H.blocks.length," blocks"]})]}):M?e.jsx(ce,{className:"inline-block w-20 h-4 bg-primary/10"}):e.jsx("span",{className:"opacity-70",children:"—"})]}),H&&h!==H.id&&e.jsx(B,{size:"sm",onClick:()=>c(H.id),className:"rounded-none h-6 px-2 font-arcade text-xs bg-primary text-primary-foreground hover:bg-primary/90 border border-primary",children:"APPLY"})]}),e.jsxs("label",{className:`flex items-center gap-2 ${ne} text-muted-foreground mb-2 cursor-pointer`,children:[e.jsx(ie,{checked:K,onCheckedChange:s=>W(s===!0),className:"w-3 h-3"}),e.jsx("span",{className:"select-none text-xs",children:"Auto-pick recommended chain"})]}),e.jsx(ue,{className:"h-40 border-[3px] border-double border-primary/30 bg-black/20",children:e.jsxs("div",{className:"p-1 space-y-1",children:[e.jsx("button",{onClick:()=>{c(void 0),R(p)},className:`w-full text-left px-3 py-2 border-2 transition-all ${h?"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30":"border-primary bg-primary/20 text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs",children:"FREEFORM"}),e.jsx("div",{className:`${E} text-xs`,children:"No template"})]}),!h&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),M?e.jsxs("div",{className:"space-y-2 p-2",children:[e.jsx(ce,{className:"w-full h-10 bg-primary/10"}),e.jsx(ce,{className:"w-full h-10 bg-primary/10"}),e.jsx(ce,{className:"w-full h-10 bg-primary/10"})]}):u.map(s=>e.jsx("button",{onClick:()=>c(s.id),className:`w-full text-left px-3 py-2 border-2 transition-all ${h===s.id?"border-primary bg-primary/20 text-primary":"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-arcade text-xs truncate",children:s.name.toUpperCase()}),e.jsxs("div",{className:`${E} text-xs`,children:[s.blocks.length," blocks"]})]}),h===s.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary ml-2"})]})},s.id))]})})]}):e.jsx(fr,{selectedBlockIds:A,setSelectedBlockIds:$})]}),e.jsxs("div",{children:[e.jsx(ae,{children:"Topic"}),e.jsx("input",{value:y,onChange:s=>_(s.target.value),placeholder:"e.g. Hip Flexors",className:`${ke} border-[3px] border-double border-primary/30`})]}),e.jsxs("div",{children:[e.jsx(ae,{children:"Engine"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-2",children:[e.jsx("button",{onClick:()=>O("codex"),className:`text-left px-2 py-2 border-2 transition-colors ${j==="codex"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(cr,{className:w}),e.jsx("span",{className:"font-arcade text-xs",children:"CODEX"})]})}),e.jsx("button",{onClick:()=>O("openrouter"),disabled:!q,className:`text-left px-2 py-2 border-2 transition-colors ${j==="openrouter"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"} ${q?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(or,{className:w}),e.jsx("span",{className:"font-arcade text-xs",children:"OPENROUTER"})]})}),e.jsx("button",{onClick:()=>O("buster"),disabled:!Q,className:`text-left px-2 py-2 border-2 transition-colors ${j==="buster"?"border-amber-400 bg-amber-400/20 text-amber-400":"border-primary/30 text-foreground/80 hover:border-amber-400/50 hover:text-foreground hover:bg-black/30"} ${Q?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ue,{className:w}),e.jsx("span",{className:"font-arcade text-xs",children:"OPENCLAW"})]})})]}),j==="openrouter"&&e.jsx("select",{value:f,onChange:s=>k(s.target.value),className:`${oe} border-[3px] border-double border-primary/30`,children:be.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${j!=="codex"?"opacity-50":""}`,children:[e.jsx(ie,{checked:L,onCheckedChange:s=>j==="codex"&&r(!!s),disabled:j!=="codex"}),e.jsx(Se,{className:w}),e.jsx("span",{className:`${ne} text-xs`,children:"Web search"})]}),e.jsxs("div",{children:[e.jsx(ae,{children:"Course"}),z?e.jsx(ce,{className:"w-full h-10 bg-primary/10"}):e.jsxs("select",{value:a??"",onChange:s=>n(s.target.value?Number(s.target.value):void 0),className:`${oe} border-[3px] border-double border-primary/30`,children:[e.jsx("option",{value:"",children:"All courses"}),se.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx(ae,{icon:e.jsx(pe,{className:w}),children:"Materials"}),e.jsx(hr,{courseId:a,selectedMaterials:g,setSelectedMaterials:S})]}),e.jsxs("div",{className:"border-t border-primary/10 pt-2",children:[e.jsx(ae,{children:"Upload"}),e.jsx(He,{courseId:a})]})]})}),e.jsx("div",{className:`shrink-0 ${de} pt-2 border-t-2 border-primary/30`,children:e.jsxs(B,{onClick:i,disabled:d||C,className:`w-full h-9 rounded-none border-2 font-arcade text-xs ${C?"border-success/50 bg-success/10 text-success cursor-default":d?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[d?e.jsx(me,{className:`${w} animate-spin mr-1`}):C?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success animate-pulse"}),"SESSION ACTIVE"]}):e.jsx(Ce,{className:`${w} mr-1`}),!d&&!C&&"START SESSION"]})})]})}const Nr="tutor.vault_selected.v1",kr=24;function Cr(a,n){return a.includes(n)?a.filter(g=>g!==n):[...a,n]}function Fe({name:a,fullPath:n,isFolder:g,depth:S,selected:p,onToggle:N,expandedFolders:h,toggleFolder:c,connected:A,searchFilter:$}){const y=h.has(n);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 py-1 hover:bg-primary/10 transition-colors cursor-pointer min-h-[28px]",style:{paddingLeft:`${8+S*kr}px`},children:[e.jsx(ie,{checked:p,onCheckedChange:()=>N(n),className:"w-3.5 h-3.5 shrink-0"}),g?e.jsxs("button",{type:"button",onClick:()=>c(n),className:"flex items-center gap-1 min-w-0 flex-1",children:[y?e.jsx(Oe,{className:"w-3 h-3 text-muted-foreground shrink-0"}):e.jsx(ve,{className:"w-3 h-3 text-muted-foreground shrink-0"}),e.jsx(We,{className:"w-3.5 h-3.5 text-yellow-500 shrink-0"}),e.jsx("span",{className:"font-terminal text-sm truncate",children:a})]}):e.jsxs("span",{className:"flex items-center gap-1 min-w-0 flex-1",children:[e.jsx("span",{className:"w-3 shrink-0"}),e.jsx(Xe,{className:"w-3.5 h-3.5 text-blue-400 shrink-0"}),e.jsx("span",{className:"font-terminal text-sm truncate",children:a})]})]}),g&&y&&e.jsx(wr,{folderPath:n,depth:S+1,selectedPaths:[],onToggle:N,expandedFolders:h,toggleFolder:c,connected:A,searchFilter:$,isSelected:_=>p||!1})]})}function wr({folderPath:a,depth:n,selectedPaths:g,onToggle:S,expandedFolders:p,toggleFolder:N,connected:h,searchFilter:c,isSelected:A}){const{data:$}=ee({queryKey:["obsidian","files",a],queryFn:()=>D.obsidian.getFiles(a),enabled:h}),y=$?.files||[],_=c.toLowerCase();return e.jsx(e.Fragment,{children:y.map(f=>{const k=typeof f=="string"?f:f.path,L=k.endsWith("/"),r=k.replace(/\/$/,"").split("/").pop()||k,i=`${a}/${r}`;return _&&!r.toLowerCase().includes(_)?null:e.jsx(Fe,{name:r,fullPath:i,isFolder:L,depth:n,selected:A(i),onToggle:S,expandedFolders:p,toggleFolder:N,connected:h,searchFilter:c},k)})})}function Sr({selectedPaths:a,onSelectedPathsChange:n}){const[g,S]=o.useState(""),[p,N]=o.useState(new Set),{data:h}=ee({queryKey:["obsidian","status"],queryFn:()=>D.obsidian.getStatus(),refetchInterval:3e4}),c=h?.connected===!0,{data:A}=ee({queryKey:["obsidian","files","School"],queryFn:()=>D.obsidian.getFiles("School"),enabled:c}),$=o.useCallback(r=>{N(i=>{const d=new Set(i);return d.has(r)?d.delete(r):d.add(r),d})},[]),y=o.useCallback(r=>{n(Cr(a,r))},[a,n]),_=o.useCallback(r=>a.includes(r),[a]);o.useEffect(()=>{try{localStorage.setItem(Nr,JSON.stringify(a))}catch{}},[a]),a.filter(r=>A?.files?.some(i=>{const d=typeof i=="string"?i:i.path;return d.endsWith("/")&&`School/${d.replace(/\/$/,"").split("/").pop()}`===r})||r.endsWith("/")).length;const f=o.useMemo(()=>{const r=a.filter(C=>we.some(l=>l.path===C)||!C.includes(".")&&!C.endsWith(".md")),i=a.length-r.length,d=[];return r.length&&d.push(`${r.length} folder${r.length>1?"s":""}`),i&&d.push(`${i} file${i>1?"s":""}`),d.join(", ")||"Nothing selected"},[a]);if(!c)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(De,{className:"w-8 h-8 text-primary/80 mb-3"}),e.jsx("p",{className:"font-arcade text-sm text-primary/90 text-center",children:"Obsidian offline"}),e.jsx("p",{className:"font-terminal text-sm text-muted-foreground text-center mt-2",children:"Open Obsidian with Local REST API enabled"})]});const k=A?.files||[],L=g.toLowerCase();return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 px-3 py-2 flex items-center gap-2 border-b border-primary/10",children:[we.map(r=>{const i=a.includes(r.path);return e.jsx("button",{type:"button",onClick:()=>y(r.path),className:`px-2.5 py-1 font-arcade text-xs tracking-wider border-2 shrink-0 transition-colors ${i?"bg-primary text-primary-foreground border-primary":"border-primary/40 bg-black/50 text-primary/80 hover:bg-primary/20 hover:border-primary/60"}`,children:r.name},r.id)}),e.jsxs("div",{className:"relative flex-1 min-w-[120px]",children:[e.jsx(rr,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground pointer-events-none"}),e.jsx(Ke,{value:g,onChange:r=>S(r.target.value),placeholder:"Filter...",className:"h-7 pl-8 pr-3 text-sm font-terminal rounded-none border border-primary/20 bg-black/40 placeholder:text-muted-foreground/80 focus-visible:ring-1 focus-visible:ring-primary/60"})]})]}),e.jsx(ue,{className:"flex-1 min-h-0",children:e.jsx("div",{className:"px-1 py-1",children:k.map(r=>{const i=typeof r=="string"?r:r.path,d=i.endsWith("/"),C=i.replace(/\/$/,"").split("/").pop()||i,l=`School/${C}`;return L&&!C.toLowerCase().includes(L)?null:e.jsx(Fe,{name:C,fullPath:l,isFolder:d,depth:0,selected:_(l),onToggle:y,expandedFolders:p,toggleFolder:$,connected:c,searchFilter:g},i)})})}),e.jsxs("div",{className:"shrink-0 px-3 py-2 border-t border-primary/20 flex items-center justify-between",children:[e.jsx("span",{className:`${E} text-xs`,children:f}),a.length>0&&e.jsxs(B,{variant:"ghost",size:"sm",onClick:()=>n([]),className:"h-6 px-2 rounded-none font-terminal text-xs text-muted-foreground hover:text-primary gap-1",children:[e.jsx(ye,{className:w}),"CLEAR"]})]})]})}function $r({sessionId:a,engine:n,onArtifactCreated:g,onSessionEnd:S,chainBlocks:p=[],currentBlockIndex:N=0,onAdvanceBlock:h}){const c=p.length>0,A=c&&N>=p.length,[$,y]=o.useState([]),[_,f]=o.useState(""),[k,L]=o.useState(!1),r=o.useRef(null),i=o.useRef(null);o.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[$]),o.useEffect(()=>{i.current?.focus()},[a]);const d=o.useCallback(async()=>{if(!_.trim()||!a||k)return;const l=_.trim();f("");const T=/^\/(note|save)\b/i.test(l),t=/^\/(card|flashcard)\b/i.test(l),m=/^\/(map|diagram)\b/i.test(l);y(u=>[...u,{role:"user",content:l}]),y(u=>[...u,{role:"assistant",content:"",isStreaming:!0}]),L(!0);try{const u=await fetch(`/api/tutor/session/${a}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,...n?{engine:n}:{}})});if(!u.ok){let j=`HTTP ${u.status} ${u.statusText}`;try{const O=await u.text();if(O)try{j=JSON.parse(O).error||O}catch{j=O}}catch{}throw new Error(j)}const M=u.body?.getReader(),F=new TextDecoder;if(!M)throw new Error("No response body");let se="",z="",q=[],Q;for(;;){const{done:j,value:O}=await M.read();if(j)break;se+=F.decode(O,{stream:!0});const K=se.split(`
`);se=K.pop()??"";for(const W of K){if(!W.startsWith("data: "))continue;const X=W.slice(6);if(X==="[DONE]")break;try{const R=JSON.parse(X);if(R.type==="error"){y(U=>{const v=[...U];return v[v.length-1]={role:"assistant",content:`Error: ${R.content}`},v}),L(!1);return}R.type==="web_search_searching"&&y(U=>{const v=[...U];return v[v.length-1]={...v[v.length-1],content:`Searching the web...

`,isStreaming:!0},v}),R.type==="web_search_completed"&&(z="",y(U=>{const v=[...U];return v[v.length-1]={...v[v.length-1],content:"",isStreaming:!0},v})),R.type==="token"&&R.content&&(z+=R.content,y(U=>{const v=[...U],Y=v[v.length-1];return v[v.length-1]={...Y,content:Y.content+R.content,isStreaming:!0},v})),R.type==="done"&&(q=R.citations??[],Q=R.model)}catch{}}}y(j=>{const O=[...j];return O[O.length-1]={role:"assistant",content:z,citations:q,model:Q,isStreaming:!1},O}),(T||t||m)&&g({type:T?"note":t?"card":"map",content:z,title:l.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(u){y(M=>{const F=[...M];return F[F.length-1]={role:"assistant",content:`Connection error: ${u instanceof Error?u.message:"Unknown"}`},F})}finally{L(!1)}},[_,a,k,n,g]),C=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),d())};return a?e.jsxs("div",{className:"flex flex-col h-full",children:[c&&e.jsxs("div",{className:"shrink-0 px-3 py-2 border-b-2 border-primary/30 bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto",children:[p.map((l,T)=>{const t=T<N,m=T===N&&!A;return e.jsxs("div",{className:"flex items-center shrink-0",children:[T>0&&e.jsx(ve,{className:"w-4 h-4 text-muted-foreground/40 mx-0.5"}),e.jsxs("div",{className:`px-2 py-1 border-2 text-base font-terminal flex items-center gap-1 ${m?"border-primary bg-primary/20 text-primary":t?"border-primary/30 bg-primary/5 text-muted-foreground/70 line-through":"border-primary/20 text-muted-foreground/50"}`,children:[t&&e.jsx(Le,{className:"w-4 h-4"}),l.name]})]},l.id)}),!A&&h&&e.jsx("button",{onClick:h,className:"shrink-0 ml-2 px-3 py-1 border-[3px] border-double border-primary/60 text-xs font-arcade text-primary hover:bg-primary/20 transition-colors",children:"NEXT"}),A&&e.jsx("span",{className:"shrink-0 ml-2 px-3 py-1 text-xs font-arcade text-green-400 border-2 border-green-400/50",children:"COMPLETE"})]}),!A&&p[N]&&e.jsxs("div",{className:"mt-1 text-base font-terminal text-muted-foreground",children:[e.jsx("span",{className:"text-primary",children:p[N].category.toUpperCase()})," ","· ~",p[N].duration,"min"]})]}),e.jsxs("div",{ref:r,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[$.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-primary",children:"SESSION STARTED"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),$.map((l,T)=>e.jsx("div",{className:`flex ${l.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-lg font-terminal ${l.role==="user"?"bg-primary/20 border-[3px] border-double border-primary/50 text-foreground":"bg-black/40 border-[3px] border-double border-primary/20 text-foreground"}`,children:[l.role==="assistant"?e.jsxs("div",{className:"prose prose-invert prose-lg max-w-none font-terminal [&_p]:my-2 [&_li]:my-1 [&_code]:text-base [&_pre]:text-base",children:[e.jsx(Ye,{remarkPlugins:[Je],children:l.content||(l.isStreaming?"...":"")}),l.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):e.jsx("div",{children:l.content}),(l.citations?.length||l.model)&&!l.isStreaming?e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-2 pt-2 border-t border-primary/20",children:[l.citations?.map(t=>t.url?e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(P,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",children:["[",t.index,"] ",t.source]})},t.index):e.jsxs(P,{variant:"outline",className:"text-sm rounded-none",children:["[",t.index,"] ",t.source]},t.index)),l.model&&e.jsx(P,{variant:"outline",className:"text-sm rounded-none text-muted-foreground/60 ml-auto",children:l.model})]}):null]})},T))]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-t border-primary/20",children:[e.jsx("span",{className:"text-base font-terminal text-muted-foreground/60",children:"Commands:"}),e.jsxs(P,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>f("/note "),children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"/note"]}),e.jsxs(P,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>f("/card "),children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),"/card"]}),e.jsxs(P,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>f("/map "),children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"/map"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(B,{variant:"ghost",size:"sm",onClick:S,className:"text-sm font-terminal text-destructive hover:text-destructive h-8 px-3",children:[e.jsx(tr,{className:"w-4 h-4 mr-1"}),"END"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-primary/20",children:[e.jsx("input",{ref:i,value:_,onChange:l=>f(l.target.value),onKeyDown:C,placeholder:"Ask a question...",disabled:k,className:"flex-1 bg-black/60 border-[3px] border-double border-primary/40 rounded-none px-3 py-2 text-lg font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),e.jsx(B,{onClick:d,disabled:!_.trim()||k,className:"rounded-none border-[3px] border-double border-primary h-11 w-11 p-0",children:k?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(sr,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const _r={note:pe,card:Re,map:Me},Er={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function Tr({sessionId:a,artifacts:n,turnCount:g,mode:S,topic:p,startedAt:N,recentSessions:h,onResumeSession:c}){const A=Ae(),[$,y]=o.useState(null),[_,f]=o.useState(null),k=async r=>{try{await D.tutor.deleteSession(r),I.success("Session deleted"),A.invalidateQueries({queryKey:["tutor-sessions"]}),y(null)}catch(i){I.error(`Delete failed: ${i instanceof Error?i.message:"Unknown"}`)}},L=async r=>{f(r.session_id);try{const i=await D.tutor.getSession(r.session_id);if(!i.turns||i.turns.length===0){I.error("No turns to save");return}const d=[`# Tutor: ${r.topic||r.mode}`,`**Date:** ${new Date(r.started_at).toLocaleDateString()}`,`**Mode:** ${r.mode} | **Turns:** ${r.turn_count}`,"","---",""];for(const T of i.turns)d.push(`## Q${T.turn_number}`),d.push(T.question),d.push(""),T.answer&&(d.push("**Answer:**"),d.push(T.answer),d.push(""));const l=`Study Sessions/${`Tutor - ${(r.topic||r.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`}.md`;await D.obsidian.append(l,d.join(`
`)),I.success(`Saved to Obsidian: ${l}`)}catch(i){I.error(`Save failed: ${i instanceof Error?i.message:"Unknown"}`)}finally{f(null)}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${de} pb-2 border-b-[3px] border-double border-primary/30`,children:e.jsx("div",{className:je,children:"ARTIFACTS"})}),e.jsx(ue,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${de} space-y-3`,children:[a?e.jsxs("div",{className:"space-y-2 pb-3 border-b border-muted-foreground/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(P,{variant:"outline",className:`${re} h-5 px-1.5`,children:S}),e.jsx(P,{variant:"outline",className:`${re} h-5 px-1.5 text-primary`,children:"FIRST PASS"})]}),p&&e.jsx("div",{className:`${ne} text-sm`,children:p}),e.jsxs("div",{className:`flex items-center gap-3 ${E}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:w}),g," turns"]}),N&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:w}),new Date(N).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):e.jsx("div",{className:`${ne} text-muted-foreground/50 py-3 text-center`,children:"No active session"}),n.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:Z,children:"Artifacts"}),n.map((r,i)=>{const d=_r[r.type],C=Er[r.type];return e.jsxs("div",{className:"border-[3px] border-double border-muted-foreground/20 p-2.5 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(d,{className:`${ze} ${C}`}),e.jsx("span",{className:`${ne} text-sm truncate flex-1`,children:r.title||`${r.type} #${i+1}`})]}),r.content&&e.jsx("div",{className:`${E} mt-1 line-clamp-2`,children:r.content.slice(0,100)})]},i)})]}),a&&n.length===0&&e.jsxs("div",{className:"text-center space-y-1 py-4",children:[e.jsx(Be,{className:`${Qe} text-muted-foreground/30 mx-auto`}),e.jsx("div",{className:`${E} text-muted-foreground/50`,children:"No artifacts yet"}),e.jsx("div",{className:`${E} text-muted-foreground/30`,children:"Use /note, /card, or /map"})]}),h.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-muted-foreground/20",children:[e.jsx("div",{className:Z,children:"Recent Sessions"}),h.slice(0,8).map(r=>e.jsxs("div",{className:"border-[3px] border-double border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>c(r.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:"outline",className:`${re} h-5 px-1.5 shrink-0 ${r.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:r.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:r.topic||r.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${E}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:w}),r.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:w}),new Date(r.started_at).toLocaleDateString()]}),e.jsx(P,{variant:"outline",className:`${re} h-4 px-1 ml-auto`,children:r.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:_===r.session_id,onClick:i=>{i.stopPropagation(),L(r)},children:[e.jsx(De,{className:`${w} mr-1`}),_===r.session_id?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:$===r.session_id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(B,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:i=>{i.stopPropagation(),k(r.session_id)},children:e.jsx(Le,{className:w})}),e.jsx(B,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:i=>{i.stopPropagation(),y(null)},children:e.jsx(ye,{className:w})})]}):e.jsx(B,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:i=>{i.stopPropagation(),y(r.session_id)},children:e.jsx(Ge,{className:w})})})]})]},r.session_id))]})]})})]})}function Hr(){const a=Ae(),[n,g]=o.useState(null),[S,p]=o.useState(!1),[N,h]=o.useState(),[c,A]=o.useState([]),[$,y]=o.useState("Core"),[_,f]=o.useState(),[k,L]=o.useState(0),[r,i]=o.useState([]),[d,C]=o.useState([]),[l,T]=o.useState(""),[t,m]=o.useState("codex"),[u,M]=o.useState(!1),[F,se]=o.useState(()=>{try{const x=localStorage.getItem("tutor.vault_selected.v1");if(x){const b=JSON.parse(x);if(Array.isArray(b))return b}}catch{}return[]}),[z,q]=o.useState([]),[Q,j]=o.useState(0),[O,K]=o.useState(null),[W,X]=o.useState(!1),[R,U]=o.useState(!1),{data:v=[]}=ee({queryKey:["tutor-sessions"],queryFn:()=>D.tutor.listSessions({limit:10})}),Y=o.useCallback(async()=>{p(!0);try{let x=_;!x&&d.length>0&&(x=(await D.tutor.createCustomChain(d,`Custom ${l||"Chain"}`)).id);const b=await D.tutor.createSession({course_id:N,phase:"first_pass",mode:$,topic:l||void 0,content_filter:{...F.length>0?{folders:F}:{},...c.length>0?{material_ids:c}:{},model:t,...u?{web_search:!0}:{}},method_chain_id:x});if(g(b.session_id),K(b.started_at),q([]),j(0),L(b.current_block_index??0),U(!1),_){const G=await D.tutor.getSession(b.session_id);G.chain_blocks&&i(G.chain_blocks.map(V=>({id:V.id,name:V.name,category:V.category,duration:V.default_duration_min})))}else i([]);I.success("Tutor session started"),a.invalidateQueries({queryKey:["tutor-sessions"]})}catch(x){I.error(`Failed to start session: ${x instanceof Error?x.message:"Unknown"}`)}finally{p(!1)}},[N,$,l,F,c,t,u,_,d,a]),H=o.useCallback(async()=>{if(n)try{await D.tutor.endSession(n),I.success("Session ended"),g(null),q([]),j(0),K(null),L(0),i([]),X(!1),a.invalidateQueries({queryKey:["tutor-sessions"]})}catch(x){I.error(`Failed to end session: ${x instanceof Error?x.message:"Unknown"}`)}},[n,a]),J=o.useCallback(async x=>{if(n)try{const b=await D.tutor.createArtifact(n,{type:x.type,content:x.content,title:x.title}),G={type:x.type,title:x.title||`${x.type} #${z.length+1}`,content:x.content.slice(0,200),createdAt:new Date().toISOString(),cardId:b.card_id};q(V=>[...V,G]),X(!0),I.success(`${x.type.charAt(0).toUpperCase()+x.type.slice(1)} created`)}catch(b){I.error(`Failed to create artifact: ${b instanceof Error?b.message:"Unknown"}`)}},[n,z.length]),s=o.useCallback(async()=>{if(n)try{const x=await D.tutor.advanceBlock(n);L(x.block_index),x.complete?I.success("Chain complete!"):I.success(`Advanced to: ${x.block_name}`)}catch(x){I.error(`Failed to advance block: ${x instanceof Error?x.message:"Unknown"}`)}},[n]),te=o.useCallback(async x=>{try{const b=await D.tutor.getSession(x);if(g(b.session_id),j(b.turn_count),K(b.started_at),y(b.mode),T(b.topic||""),h(b.course_id??void 0),f(b.method_chain_id??void 0),L(b.current_block_index??0),i((b.chain_blocks||[]).map(G=>({id:G.id,name:G.name,category:G.category,duration:G.default_duration_min}))),b.content_filter?.material_ids&&A(b.content_filter.material_ids),b.content_filter?.model&&m(b.content_filter.model),M(!!b.content_filter?.web_search),b.artifacts_json)try{const G=JSON.parse(b.artifacts_json);Array.isArray(G)&&q(G.map(V=>({type:V.type,title:V.title,content:"",createdAt:V.created_at})))}catch{q([])}I.success("Session resumed")}catch(b){I.error(`Failed to resume session: ${b instanceof Error?b.message:"Unknown"}`)}},[]);return!n&&!R?e.jsx(he,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)] px-4 pb-2",children:[e.jsxs(fe,{className:"flex-1 min-h-0 bg-black/40 border-[3px] border-double border-primary rounded-none overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"shrink-0 px-3 py-1.5 border-b-2 border-primary/30 flex items-center justify-between",children:[e.jsx("div",{className:je,children:"VAULT FILES"}),e.jsx("span",{className:"font-arcade text-xs text-primary/50 tracking-widest",children:"TUTOR"})]}),e.jsx(Sr,{selectedPaths:F,onSelectedPathsChange:se})]}),e.jsx(fe,{className:"shrink-0 mt-2 bg-black/40 border-[3px] border-double border-primary rounded-none overflow-hidden",children:e.jsx(Te,{courseId:N,setCourseId:h,selectedMaterials:c,setSelectedMaterials:A,mode:$,setMode:y,chainId:_,setChainId:f,customBlockIds:d,setCustomBlockIds:C,topic:l,setTopic:T,model:t,setModel:m,webSearch:u,setWebSearch:M,onStartSession:Y,isStarting:S,hasActiveSession:!1,compact:!0})}),v.length>0&&e.jsxs("div",{className:"shrink-0 flex items-center gap-2 mt-1 overflow-x-auto pb-1",children:[e.jsx("span",{className:"font-arcade text-xs text-primary/60 shrink-0",children:"RECENT:"}),v.slice(0,8).map(x=>e.jsxs("button",{onClick:()=>te(x.session_id),className:"shrink-0 border border-muted-foreground/20 hover:border-primary/50 hover:bg-primary/10 px-2 py-0.5 font-terminal text-xs text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${x.status==="active"?"bg-green-400":"bg-muted-foreground/40"}`}),e.jsx("span",{className:"truncate max-w-[100px]",children:x.topic||x.mode}),e.jsxs("span",{className:"text-muted-foreground/50",children:[x.turn_count,"t"]})]},x.session_id))]})]})}):R&&n?e.jsx(he,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>U(!1),className:"rounded-none font-arcade text-xs text-primary h-8 px-3",children:"BACK TO CHAT"}),e.jsx("span",{className:"font-terminal text-base text-muted-foreground",children:"Editing session settings"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-2xl mx-auto py-6 px-4",children:e.jsx(fe,{className:"bg-black/40 border-[3px] border-double border-primary rounded-none overflow-hidden",children:e.jsx(Te,{courseId:N,setCourseId:h,selectedMaterials:c,setSelectedMaterials:A,mode:$,setMode:y,chainId:_,setChainId:f,customBlockIds:d,setCustomBlockIds:C,topic:l,setTopic:T,model:t,setModel:m,webSearch:u,setWebSearch:M,onStartSession:Y,isStarting:S,hasActiveSession:!0})})})})]})}):e.jsx(he,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(P,{variant:"outline",className:`${re} h-6 px-2 text-primary border-primary/50`,children:$}),l&&e.jsx("span",{className:"font-terminal text-base text-foreground truncate max-w-[300px]",children:l}),e.jsxs("div",{className:`flex items-center gap-3 ${E} ml-auto`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:w}),Q]}),O&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:w}),new Date(O).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>U(!0),className:"h-7 w-7 p-0 rounded-none text-muted-foreground hover:text-primary",title:"Session settings",children:e.jsx(ar,{className:"w-4 h-4"})}),e.jsxs(B,{variant:"ghost",size:"sm",onClick:()=>X(!W),className:`h-7 px-2 rounded-none font-terminal text-sm gap-1 ${W?"text-primary bg-primary/10":"text-muted-foreground hover:text-primary"}`,title:"Toggle artifacts panel",children:[W?e.jsx(ur,{className:"w-4 h-4"}):e.jsx(Ze,{className:"w-4 h-4"}),z.length>0&&e.jsx(P,{variant:"outline",className:"text-xs h-5 px-1 rounded-none",children:z.length})]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsx("div",{className:"flex-1 bg-black/60 border-x-2 border-primary/20 flex flex-col min-w-0",children:e.jsx($r,{sessionId:n,engine:t==="buster"?"buster":void 0,onArtifactCreated:J,onSessionEnd:H,chainBlocks:r,currentBlockIndex:k,onAdvanceBlock:s})}),W&&e.jsx("div",{className:"w-80 shrink-0 bg-black/40 border-l-2 border-primary/30 overflow-hidden",children:e.jsx(Tr,{sessionId:n,artifacts:z,turnCount:Q,mode:$,topic:l,startedAt:O,onCreateArtifact:J,recentSessions:v,onResumeSession:te})})]})]})})}export{Hr as default};
