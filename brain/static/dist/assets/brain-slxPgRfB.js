import{c as te,r,j as e,b as W,u as Xe,X as he}from"./index-Cht8m-QL.js";import{u as k,a as R,g as d,L as Cs,h as ks,B as c,T as se,S as pe,P as fe,C as ge,f as Ds,i as ve,j as U,D as Re,c as Le,d as qe,e as ze,k as $e,I as Be,l as Ke}from"./layout-Eaw49bc8.js";import{C as T,a as A,b as I,c as P}from"./card-D_2QE6M2.js";import{B as C,S as Ge,a as Ue,b as We,c as _e,d as y}from"./select-Cfp5bnZ1.js";import{C as Se}from"./checkbox-DlUkCtb2.js";import{T as Ye,A as Os,a as Es,b as Ts,c as As,d as Is,e as Ps,f as Fs,g as Ms}from"./alert-dialog-1df4BChe.js";import{B as Rs}from"./book-open-BX28v9RE.js";import{F as Ls,a as Je}from"./folder-DaQzG_-4.js";import{F as Qe}from"./file-text-CqMD8Fkm.js";import{R as He,S as qs}from"./send-DuEG6HU7.js";import{i as zs,f as $s}from"./format-D7m0hUtg.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Ks=te("chart-column",Bs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Us=te("database",Gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],_s=te("file",Ws);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ve=te("layers",Ys);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],Qs=te("message-circle",Js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Vs=te("paperclip",Hs),Ze=r.forwardRef(({className:l,...n},o)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:o,className:W("w-full caption-bottom text-sm",l),...n})}));Ze.displayName="Table";const es=r.forwardRef(({className:l,...n},o)=>e.jsx("thead",{ref:o,className:W("[&_tr]:border-b",l),...n}));es.displayName="TableHeader";const ss=r.forwardRef(({className:l,...n},o)=>e.jsx("tbody",{ref:o,className:W("[&_tr:last-child]:border-0",l),...n}));ss.displayName="TableBody";const Xs=r.forwardRef(({className:l,...n},o)=>e.jsx("tfoot",{ref:o,className:W("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",l),...n}));Xs.displayName="TableFooter";const we=r.forwardRef(({className:l,...n},o)=>e.jsx("tr",{ref:o,className:W("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",l),...n}));we.displayName="TableRow";const F=r.forwardRef(({className:l,...n},o)=>e.jsx("th",{ref:o,className:W("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),...n}));F.displayName="TableHead";const M=r.forwardRef(({className:l,...n},o)=>e.jsx("td",{ref:o,className:W("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),...n}));M.displayName="TableCell";const Zs=r.forwardRef(({className:l,...n},o)=>e.jsx("caption",{ref:o,className:W("mt-4 text-sm text-muted-foreground",l),...n}));Zs.displayName="TableCaption";const et=`I need you to extract schedule events from my course syllabus.

Return ONLY a valid JSON array with NO additional text, NO markdown code blocks, NO explanation.

Structure for each item:
{
  "type": "chapter" | "quiz" | "assignment" | "exam",
  "title": "string",
  "dueDate": "YYYY-MM-DD",
  "notes": "optional string or null"
}

Rules:
1. type must be EXACTLY one of: "chapter", "quiz", "assignment", "exam"
2. dueDate must be ISO format (YYYY-MM-DD) - if no date given, use null
3. Return ONLY the JSON array, nothing else

Here's my syllabus:

[PASTE YOUR SYLLABUS BELOW]`,st=`I need you to extract learning objectives from my course material.

Return ONLY a valid JSON array with NO additional text, NO markdown code blocks, NO explanation.

Structure for each item:
{
  "loCode": "string",
  "title": "string"
}

Rules:
1. loCode: Preserve original numbering if present, or create sequential "1", "2", "3"...
2. title: Keep the objective text exactly as written
3. Return ONLY the JSON array, nothing else

Here are my learning objectives:

[PASTE YOUR LOs BELOW]`;function tt(){const l=Xe(),[n,o]=r.useState(null),[u,ae]=r.useState(null),[L,f]=r.useState(""),[X,v]=r.useState(""),[_,b]=r.useState(null),[q,ne]=r.useState(""),[j,Y]=r.useState(null),[J,S]=r.useState(null),{data:de=[]}=k({queryKey:["courses"],queryFn:()=>d.courses.getActive()}),{data:h=[]}=k({queryKey:["modules",n],queryFn:()=>n?d.modules.getByCourse(n):Promise.resolve([]),enabled:!!n}),{data:D=[]}=k({queryKey:["learningObjectives",n],queryFn:()=>n?d.learningObjectives.getByCourse(n):Promise.resolve([]),enabled:!!n}),Q=R({mutationFn:async a=>{if(!n)throw new Error("Select a course first");const N=JSON.parse(a);return d.scheduleEvents.createBulk(n,N)},onSuccess:()=>{l.invalidateQueries({queryKey:["scheduleEvents"]}),f(""),b(null)},onError:a=>{b(a.message||"Failed to import schedule")}}),z=R({mutationFn:async a=>{if(!n)throw new Error("Select a course first");const N=JSON.parse(a);return d.learningObjectives.createBulk(n,u,N)},onSuccess:()=>{l.invalidateQueries({queryKey:["learningObjectives"]}),v(""),b(null)},onError:a=>{b(a.message||"Failed to import LOs")}}),$=R({mutationFn:({id:a,data:N})=>d.modules.update(a,N),onSuccess:()=>{l.invalidateQueries({queryKey:["modules"]})}}),H=a=>{navigator.clipboard.writeText(a)},re=async()=>{try{S(null);const a=j?await j.text():q,N=j?.name||"pasted_wrap.md",Z=await d.brain.ingest(a,N);Z.sessionSaved?(S({type:"success",message:`✓ Session saved! ID: ${Z.sessionId}, Cards: ${Z.cardsCreated||0}`}),ne(""),Y(null)):S({type:"error",message:Z.errors?.join(", ")||Z.message})}catch(a){S({type:"error",message:a.message||"Failed to ingest"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"border-2 border-primary rounded-none p-4 bg-primary/5",children:[e.jsx("h2",{className:"text-xl font-arcade text-primary mb-4",children:"WRAP SESSION INGESTION"}),J&&e.jsx("div",{className:`mb-4 p-3 rounded-none font-terminal text-sm ${J.type==="success"?"bg-green-900/30 border border-green-500 text-green-400":"bg-red-900/30 border border-red-500 text-red-400"}`,children:J.message}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 font-terminal text-muted-foreground",children:"Upload WRAP File (.md, .txt)"}),e.jsx("input",{type:"file",accept:".md,.txt",onChange:a=>{Y(a.target.files?.[0]||null),ne(""),S(null)},className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal text-sm"}),j&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 font-terminal",children:["Selected: ",j.name]})]}),e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground",children:"- OR -"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 font-terminal text-muted-foreground",children:"Paste WRAP Content"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-48 font-terminal text-sm",placeholder:"Paste your WRAP session here...",value:q,onChange:a=>{ne(a.target.value),Y(null),S(null)}})]}),e.jsx("button",{onClick:re,disabled:!q&&!j,className:"bg-primary hover:bg-primary/80 disabled:opacity-50 px-6 py-3 rounded-none font-arcade text-sm w-full",type:"button",children:"INGEST WRAP SESSION"})]})]}),e.jsx("h2",{className:"text-xl font-arcade text-primary",children:"MATERIAL INGESTION"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:n||"",onChange:a=>{o(a.target.value?parseInt(a.target.value):null),ae(null)},children:[e.jsx("option",{value:"",children:"-- Select Course --"}),de.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),_&&e.jsx("div",{className:"bg-destructive/20 border border-destructive rounded-none p-3 text-destructive font-terminal",children:_}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border border-secondary/50 rounded-none p-4",children:[e.jsx("h3",{className:"text-sm font-arcade mb-2 text-primary",children:"SCHEDULE IMPORT"}),e.jsx("button",{onClick:()=>H(et),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (JSON array) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-32 font-terminal text-sm",placeholder:'[{"type": "exam", "title": "...", "dueDate": "2026-01-20", "notes": null}]',value:L,onChange:a=>f(a.target.value)}),e.jsx("button",{onClick:()=>Q.mutate(L),disabled:!L||Q.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:Q.isPending?"Importing...":"Import Schedule"})]}),e.jsxs("div",{className:"border border-secondary/50 rounded-none p-4",children:[e.jsx("h3",{className:"text-sm font-arcade mb-2 text-primary",children:"MODULES"}),h.length===0?e.jsx("p",{className:"text-xs text-muted-foreground font-terminal",children:"No modules yet. Add modules manually or import."}):e.jsxs("table",{className:"w-full text-sm font-terminal",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-secondary/50",children:[e.jsx("th",{className:"text-left p-2",children:"Module"}),e.jsx("th",{className:"text-center p-2",children:"Files"}),e.jsx("th",{className:"text-center p-2",children:"NotebookLM"}),e.jsx("th",{className:"text-center p-2",children:"Status"})]})}),e.jsx("tbody",{children:h.map(a=>e.jsxs("tr",{className:"border-b border-secondary/30",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"checkbox",checked:a.filesDownloaded,onChange:N=>$.mutate({id:a.id,data:{filesDownloaded:N.target.checked}})})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"checkbox",checked:a.notebooklmLoaded,onChange:N=>$.mutate({id:a.id,data:{notebooklmLoaded:N.target.checked}})})}),e.jsx("td",{className:"text-center p-2",children:a.filesDownloaded&&a.notebooklmLoaded?e.jsx("span",{className:"text-green-400",children:"Ready"}):e.jsx("span",{className:"text-yellow-400",children:"Pending"})})]},a.id))})]})]}),e.jsxs("div",{className:"border border-secondary/50 rounded-none p-4",children:[e.jsx("h3",{className:"text-sm font-arcade mb-2 text-primary",children:"LEARNING OBJECTIVES IMPORT"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs mb-1 font-terminal text-muted-foreground",children:"Target Module (optional)"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:u||"",onChange:a=>ae(a.target.value?parseInt(a.target.value):null),children:[e.jsx("option",{value:"",children:"-- No Module (Course-level) --"}),h.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsx("button",{onClick:()=>H(st),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (JSON array) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-32 font-terminal text-sm",placeholder:'[{"loCode": "1.1", "title": "Define..."}]',value:X,onChange:a=>v(a.target.value)}),e.jsx("button",{onClick:()=>z.mutate(X),disabled:!X||z.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:z.isPending?"Importing...":"Import LOs"}),D.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-terminal text-xs mb-2",children:["Current LOs (",D.length,")"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:D.map(a=>e.jsxs("div",{className:"text-xs py-1 border-b border-secondary/30 font-terminal",children:[e.jsx("span",{className:"text-primary",children:a.loCode}),": ",a.title,e.jsx("span",{className:`ml-2 text-[10px] px-1 rounded ${a.status==="solid"?"bg-green-600":a.status==="in_progress"?"bg-yellow-600":a.status==="need_review"?"bg-orange-600":"bg-gray-600"}`,children:a.status})]},a.id))})]})]})]})]})}const at=(l,n="MM/dd")=>{if(!l)return"-";try{const o=l instanceof Date?l:new Date(l);return zs(o)?$s(o,n):"-"}catch{return"-"}},ce=l=>{if(Array.isArray(l))return l.filter(n=>typeof n=="string");if(typeof l=="string"){const n=l.trim();if(!n)return[];try{const o=JSON.parse(n);if(Array.isArray(o))return o.filter(u=>typeof u=="string")}catch{}return n.split(",").map(o=>o.trim()).filter(Boolean)}return[]};function bt(){const[l,n]=r.useState(""),[o,u]=r.useState([]),[ae,L]=r.useState(!1),[f,X]=r.useState(null),[v,_]=r.useState(new Set),[b,q]=r.useState(null),[ne,j]=r.useState(!1),[Y,J]=r.useState([]),[S,de]=r.useState(!1),[h,D]=r.useState(new Set),[Q,z]=r.useState(null),[$,H]=r.useState({front:"",back:"",deckName:""}),[re,a]=r.useState("all"),[N,Z]=r.useState(""),[nt,rt]=r.useState("all"),[x,O]=r.useState({mode:"",minutes:"",cards:"",confusions:"",weakAnchors:"",concepts:"",issues:"",notes:""}),[g,ts]=r.useState("School"),[le,be]=r.useState(null),[Ce,me]=r.useState(""),[ke,De]=r.useState(!1),[Oe,xe]=r.useState(!1),as=[{name:"EBP",path:"School/Evidence Based Practice"},{name:"ExPhys",path:"School/Exercise Physiology"},{name:"MS1",path:"School/Movement Science 1"},{name:"Neuro",path:"School/Neuroscience"},{name:"TI",path:"School/Theraputic Intervention"}],Ee=r.useRef(null),Te=r.useRef(null),{data:B=[],isLoading:ns}=k({queryKey:["sessions"],queryFn:d.sessions.getAll}),{data:p,isLoading:Ae}=k({queryKey:["brain","metrics"],queryFn:d.brain.getMetrics}),E=Xe(),Ne=R({mutationFn:s=>d.sessions.deleteMany(s),onSuccess:()=>{E.invalidateQueries({queryKey:["sessions"]}),E.invalidateQueries({queryKey:["brain","metrics"]}),_(new Set)}}),rs=R({mutationFn:({id:s,updates:t})=>d.sessions.update(s,t),onSuccess:()=>{E.invalidateQueries({queryKey:["sessions"]}),E.invalidateQueries({queryKey:["brain","metrics"]}),q(null)}}),ls=s=>{_(t=>{const i=new Set(t);return i.has(s)?i.delete(s):i.add(s),i})},os=()=>{v.size===B.length?_(new Set):_(new Set(B.map(s=>s.id)))},is=()=>{v.size!==0&&(J(Array.from(v)),j(!0))},cs=s=>{J([s]),j(!0)},ds=()=>{Ne.mutate(Y),j(!1),J([])};r.useEffect(()=>{if(b!==null){const s=B.find(t=>t.id===b);s&&O({mode:s.mode||"",minutes:s.minutes?.toString()||"",cards:s.cards?.toString()||"",confusions:ce(s.confusions).join(", "),weakAnchors:ce(s.weakAnchors).join(", "),concepts:ce(s.concepts).join(", "),issues:ce(s.issues).join(", "),notes:s.notes||""})}},[b,B]);const ms=()=>{if(b===null)return;const s=m=>m?m.split(",").map(w=>w.trim()).filter(Boolean):[],t=m=>m.length?JSON.stringify(m):null,i={mode:x.mode||"study",minutes:parseInt(x.minutes)||0,cards:parseInt(x.cards)||0,confusions:t(s(x.confusions)),weakAnchors:t(s(x.weakAnchors)),concepts:t(s(x.concepts)),issues:t(s(x.issues)),notes:x.notes||null};rs.mutate({id:b,updates:i})},{data:K}=k({queryKey:["obsidian","status"],queryFn:d.obsidian.getStatus,refetchInterval:3e4}),{data:xs,refetch:lt}=k({queryKey:["obsidian","files",g],queryFn:()=>d.obsidian.getFiles(g),enabled:K?.connected===!0}),us=async s=>{try{const t=await d.obsidian.getFile(s);t.success&&t.content!==void 0&&(be(s),me(t.content),xe(!1))}catch(t){console.error("Failed to load file:",t)}},hs=async()=>{if(le){De(!0);try{(await d.obsidian.saveFile(le,Ce)).success&&xe(!1)}catch(s){console.error("Failed to save file:",s)}finally{De(!1)}}},oe=s=>{ts(s),be(null),me("")},ps=()=>{const s=new Date().toISOString().split("T")[0],t=g?`${g}/Session-${s}.md`:`Session-${s}.md`,i=`# Study Session - ${s}

## Summary


## Concepts Covered
- 

## Strengths
- 

## Areas to Review
- 

## Notes

`;be(t),me(i),xe(!0)},{data:V,isLoading:fs,refetch:Ie}=k({queryKey:["anki","status"],queryFn:d.anki.getStatus,refetchInterval:3e4}),{data:gs}=k({queryKey:["anki","due"],queryFn:d.anki.getDue,enabled:V?.connected===!0}),{data:bs=[],refetch:ue}=k({queryKey:["anki","drafts"],queryFn:d.anki.getDrafts}),ee=bs.filter(s=>s.status==="pending"),je=R({mutationFn:d.anki.sync,onSuccess:()=>{E.invalidateQueries({queryKey:["anki"]}),ue()}}),Pe=R({mutationFn:s=>d.anki.approveDraft(s),onSuccess:()=>{ue()}}),Fe=R({mutationFn:s=>d.anki.deleteDraft(s),onSuccess:()=>{ue()}}),ye=R({mutationFn:({id:s,data:t})=>d.anki.updateDraft(s,t),onSuccess:()=>{ue(),z(null)}}),Ns=s=>{z(s.id),H({front:s.front,back:s.back,deckName:s.deckName})},js=()=>{Q!==null&&ye.mutate({id:Q,data:$})};r.useEffect(()=>{Te.current?.scrollIntoView({behavior:"smooth"})},[o]);const ys=s=>{let t=0;return/section\s*[ABCD]/i.test(s)&&(t+=2),/^[ABCD]\s*[:\)\-]/im.test(s)&&(t+=2),/front\s*:/i.test(s)&&/back\s*:/i.test(s)&&(t+=2),/\bWRAP\b/i.test(s)&&(t+=1),/```json/i.test(s)&&(t+=1),t>=2},Me=async()=>{if(!l.trim())return;const s=l;n(""),X(null),u(t=>[...t,{role:"user",content:s}]),L(!0);try{if(ys(s)){const t=await d.brain.ingest(s,"pasted_wrap.md");if(t.sessionSaved){const i=t.cardsCreated?` | Cards: ${t.cardsCreated}`:"";u(m=>[...m,{role:"assistant",content:`✓ Session saved (ID: ${t.sessionId})${i}
${t.message}`}]),E.invalidateQueries({queryKey:["sessions"]}),t.cardsCreated&&t.cardsCreated>0&&E.invalidateQueries({queryKey:["anki"]})}else{const i=t.errors?.join(", ")||t.message;u(m=>[...m,{role:"assistant",content:`⚠ ${i}`}])}}else{const t=await d.brain.chat(s,S,re);u(i=>[...i,{role:"assistant",content:t.response}]),t.wrapProcessed&&X({cardsCreated:t.cardsCreated||0,issuesLogged:t.issuesLogged||0,obsidianSynced:!!t.obsidianSynced,obsidianPath:t.obsidianPath,sessionId:t.sessionId??null,wrapSessionId:t.wrapSessionId??null}),t.cardsCreated&&t.cardsCreated>0&&E.invalidateQueries({queryKey:["anki"]})}}catch{u(i=>[...i,{role:"assistant",content:"Error processing request. Please try again."}])}finally{L(!1)}},vs=async()=>{try{const s=await navigator.clipboard.readText();s&&s.trim()&&n(s)}catch{u(s=>[...s,{role:"assistant",content:"Clipboard access failed. Paste manually."}])}},Ss=async s=>{const t=s.target.files?.[0];if(t){const i=new FileReader;i.onload=async m=>{const w=m.target?.result;u(G=>[...G,{role:"user",content:`[Uploaded: ${t.name}]
${w.slice(0,500)}${w.length>500?"...":""}`}]),L(!0);try{const G=await d.brain.ingest(w,t.name);if(G.sessionSaved)u(ie=>[...ie,{role:"assistant",content:`✓ Session saved (ID: ${G.sessionId})
${G.message}`}]);else{const ie=G.errors?.join(", ")||G.message;u(ws=>[...ws,{role:"assistant",content:`⚠ ${ie}`}])}}catch{u(ie=>[...ie,{role:"assistant",content:"Error processing file. Please try again."}])}finally{L(!1)}},i.readAsText(t)}};return e.jsxs(Cs,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"font-arcade text-xl text-primary flex items-center gap-2",children:[e.jsx(ks,{className:"w-6 h-6"}),"BRAIN ANALYTICS"]}),e.jsxs("div",{className:"flex items-center gap-4 font-terminal text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["SESSIONS: ",e.jsx("span",{className:"text-primary","data-testid":"text-total-sessions",children:p?.totalSessions||0})]}),e.jsxs("span",{className:"text-muted-foreground",children:["MINUTES: ",e.jsx("span",{className:"text-primary","data-testid":"text-total-minutes",children:p?.totalMinutes||0})]}),e.jsxs("span",{className:"text-muted-foreground",children:["CARDS: ",e.jsx("span",{className:"text-primary","data-testid":"text-total-cards",children:p?.totalCards||0})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"INGESTION"}),e.jsx(tt,{})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"SESSION EVIDENCE"}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(A,{className:"border-b border-secondary p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(I,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"SESSION EVIDENCE TABLE"]}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground mt-1",children:"Raw WRAP data. All metrics derive from these fields."})]}),v.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-terminal text-xs text-muted-foreground",children:[v.size," selected"]}),e.jsxs(c,{size:"sm",variant:"destructive",className:"font-terminal text-xs rounded-none",onClick:is,disabled:Ne.isPending,children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),Ne.isPending?"Deleting...":"Delete"]})]})]})}),e.jsx(P,{className:"p-0",children:ns?e.jsx("div",{className:"p-8 text-center font-terminal text-muted-foreground",children:"LOADING..."}):B.length===0?e.jsx("div",{className:"p-8 text-center font-terminal text-muted-foreground",children:"NO SESSIONS YET"}):e.jsx(pe,{className:"h-[400px]",children:e.jsxs(Ze,{children:[e.jsx(es,{children:e.jsxs(we,{className:"border-secondary hover:bg-transparent",children:[e.jsx(F,{className:"w-10",children:e.jsx(Se,{checked:v.size===B.length&&B.length>0,onCheckedChange:os,className:"border-primary data-[state=checked]:bg-primary"})}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"DATE"}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"COURSE"}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"MODE"}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"MIN"}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"CARDS"}),e.jsx(F,{className:"font-arcade text-xs text-primary",children:"CONFUSIONS"}),e.jsx(F,{className:"font-arcade text-xs text-primary w-10",children:"ACTIONS"})]})}),e.jsx(ss,{children:B.map(s=>e.jsxs(we,{className:"border-secondary hover:bg-primary/10 font-terminal text-sm","data-testid":`row-session-${s.id}`,children:[e.jsx(M,{children:e.jsx(Se,{checked:v.has(s.id),onCheckedChange:()=>ls(s.id),className:"border-secondary data-[state=checked]:bg-primary"})}),e.jsx(M,{className:"text-muted-foreground",children:at(s.date)}),e.jsx(M,{className:"font-bold",children:s.topic||"-"}),e.jsx(M,{children:e.jsx(C,{variant:"outline",className:"rounded-none border-secondary font-normal text-xs",children:s.mode})}),e.jsx(M,{children:s.minutes||0}),e.jsx(M,{children:s.cards||0}),e.jsx(M,{className:"max-w-[150px] truncate text-xs text-muted-foreground",children:ce(s.confusions).join(", ")||"-"}),e.jsx(M,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{size:"icon",variant:"ghost",className:"h-6 w-6 rounded-none hover:bg-primary/20",onClick:()=>q(s.id),title:"Edit session",children:e.jsx(fe,{className:"w-3 h-3"})}),e.jsx(c,{size:"icon",variant:"ghost",className:"h-6 w-6 rounded-none hover:bg-destructive/20 text-destructive",onClick:()=>cs(s.id),title:"Delete session",children:e.jsx(se,{className:"w-3 h-3"})})]})})]},s.id))})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"DERIVED METRICS"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(A,{className:"border-b border-secondary p-3",children:e.jsxs(I,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Ks,{className:"w-3 h-3"}),"SESSIONS PER COURSE"]})}),e.jsx(P,{className:"p-3 max-h-[200px] overflow-y-auto",children:Ae?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground",children:"LOADING..."}):(p?.sessionsPerCourse||[]).length===0?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground py-4",children:"NO DATA"}):e.jsx("div",{className:"space-y-2",children:p?.sessionsPerCourse.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between font-terminal text-xs",children:[e.jsx("span",{className:"truncate max-w-[120px]",children:s.course}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-primary",children:[s.count," sess"]}),e.jsxs("span",{className:"text-muted-foreground",children:[s.minutes," min"]})]})]},t))})})]}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(A,{className:"border-b border-secondary p-3",children:e.jsxs(I,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Ve,{className:"w-3 h-3"}),"MODE DISTRIBUTION"]})}),e.jsx(P,{className:"p-3 max-h-[200px] overflow-y-auto",children:Ae?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground",children:"LOADING..."}):(p?.modeDistribution||[]).length===0?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground py-4",children:"NO DATA"}):e.jsx("div",{className:"space-y-2",children:p?.modeDistribution.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between font-terminal text-xs",children:[e.jsx(C,{variant:"outline",className:"rounded-none border-secondary",children:s.mode}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-primary",children:[s.count," sess"]}),e.jsxs("span",{className:"text-muted-foreground",children:[s.minutes," min"]})]})]},t))})})]}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(A,{className:"border-b border-secondary p-3",children:e.jsxs(I,{className:"font-arcade text-xs flex items-center gap-2 text-orange-400",children:[e.jsx(Ye,{className:"w-3 h-3"}),"REPEATED CONFUSIONS"]})}),e.jsx(P,{className:"p-3 max-h-[200px] overflow-y-auto",children:(p?.recentConfusions||[]).length===0?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground py-4",children:"NO CONFUSIONS LOGGED"}):e.jsx("div",{className:"space-y-1",children:p?.recentConfusions.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between font-terminal text-xs",children:[e.jsx("span",{className:"truncate max-w-[150px] text-orange-300",children:s.text}),e.jsxs("span",{className:"text-muted-foreground",children:["x",s.count]})]},t))})})]}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(A,{className:"border-b border-secondary p-3",children:e.jsxs(I,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Rs,{className:"w-3 h-3"}),"CONCEPT FREQUENCY"]})}),e.jsx(P,{className:"p-3 max-h-[200px] overflow-y-auto",children:(p?.conceptFrequency||[]).length===0?e.jsx("div",{className:"text-center font-terminal text-xs text-muted-foreground py-4",children:"NO CONCEPTS LOGGED"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:p?.conceptFrequency.slice(0,15).map((s,t)=>e.jsxs(C,{variant:"outline",className:"rounded-none border-secondary font-terminal text-xs",children:[s.concept," (",s.count,")"]},t))})})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"ISSUES LOG"}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsxs(A,{className:"border-b border-secondary p-4",children:[e.jsxs(I,{className:"font-arcade text-sm flex items-center gap-2 text-red-400",children:[e.jsx(Ye,{className:"w-4 h-4"}),"ISSUES AND FAILURES LOG"]}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground mt-1",children:"Aggregated session issues: interruptions, source-lock failures, workflow problems"})]}),e.jsx(P,{className:"p-4",children:(p?.issuesLog||[]).length===0?e.jsx("div",{className:"text-center font-terminal text-muted-foreground py-8",children:"NO ISSUES LOGGED"}):e.jsx("div",{className:"space-y-2",children:p?.issuesLog.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-red-500/30 bg-red-500/5 font-terminal text-sm",children:[e.jsx("span",{className:"text-red-300",children:s.issue}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:s.course}),e.jsxs(C,{variant:"outline",className:"rounded-none border-red-500/50 text-red-400",children:["x",s.count]})]})]},t))})})]})]}),e.jsxs(T,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsxs(A,{className:"border-b border-secondary/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(I,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"OBSIDIAN VAULT",K?.connected?e.jsx(ge,{className:"w-3 h-3 text-green-500"}):e.jsx(he,{className:"w-3 h-3 text-red-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:ps,disabled:!K?.connected,children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),"New Note"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:s=>de(s.target.checked),disabled:!K?.connected,className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"font-terminal text-xs",children:"Auto-Sync"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1 mt-2 flex-wrap",children:as.map(s=>e.jsx(c,{size:"sm",variant:g===s.path?"default":"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:()=>oe(s.path),children:s.name},s.path))}),g&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 font-terminal text-xs text-muted-foreground",children:[e.jsx("button",{onClick:()=>oe(""),className:"hover:text-primary",children:"vault"}),g.split("/").map((s,t,i)=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ds,{className:"w-3 h-3"}),e.jsx("button",{onClick:()=>oe(i.slice(0,t+1).join("/")),className:"hover:text-primary",children:s})]},t))]})]}),e.jsx(P,{className:"p-0",children:K?.connected?e.jsxs("div",{className:"grid md:grid-cols-2 h-[300px]",children:[e.jsx("div",{className:"border-r border-secondary/30",children:e.jsx(pe,{className:"h-[300px]",children:e.jsxs("div",{className:"p-2 space-y-1",children:[g&&e.jsxs("button",{onClick:()=>{const s=g.split("/");s.pop(),oe(s.join("/"))},className:"w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs text-muted-foreground",children:[e.jsx(Je,{className:"w-3 h-3"}),".."]}),xs?.files?.map(s=>{const t=typeof s=="string"?s:s.path,i=t.endsWith("/"),m=t.replace(/\/$/,"").split("/").pop()||t;return e.jsxs("button",{onClick:()=>{if(i){const w=m.replace(/\/$/,"");oe(g?`${g}/${w}`:w)}else{const w=g?`${g}/${m}`:m;us(w)}},className:`w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs ${le?.endsWith(m)?"bg-primary/20 text-primary":""}`,children:[i?e.jsx(Je,{className:"w-3 h-3 text-yellow-500"}):e.jsx(_s,{className:"w-3 h-3 text-blue-400"}),m]},t)})]})})}),e.jsx("div",{className:"flex flex-col h-[300px]",children:le?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-secondary/30",children:[e.jsxs("span",{className:"font-terminal text-xs text-primary truncate",children:[le.split("/").pop(),Oe&&e.jsx("span",{className:"text-yellow-500 ml-1",children:"*"})]}),e.jsxs(c,{size:"sm",variant:"ghost",onClick:hs,disabled:!Oe||ke,className:"h-6 px-2",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),ke?"Saving...":"Save"]})]}),e.jsx("textarea",{value:Ce,onChange:s=>{me(s.target.value),xe(!0)},className:"flex-1 w-full p-3 bg-black/60 font-terminal text-sm resize-none focus:outline-none focus:ring-1 focus:ring-primary",placeholder:"File content..."})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center font-terminal text-xs text-muted-foreground",children:"Select a file to edit"})})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400 mb-2",children:"Obsidian Offline"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Obsidian with Local REST API plugin enabled"})]})})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs(T,{className:"bg-black/40 border-2 border-secondary/50 rounded-none",children:[e.jsx(A,{className:"border-b border-secondary/50 p-3",children:e.jsxs(I,{className:"font-arcade text-xs flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ve,{className:"w-3 h-3"}),"ANKI INTEGRATION",V?.connected?e.jsx(ge,{className:"w-3 h-3 text-green-500 ml-auto"}):e.jsx(he,{className:"w-3 h-3 text-red-500 ml-auto"})]})}),e.jsx(P,{className:"p-4 space-y-3",children:fs?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Checking Anki..."}):V?.connected?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Status:"}),e.jsx(C,{variant:"outline",className:"bg-green-500/20 text-green-400 border-green-500",children:"Connected"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Cards Created:"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:p?.totalCards||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Due Today:"}),e.jsx("span",{className:"font-arcade text-xs text-secondary",children:gs?.dueCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Reviewed Today:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:V.reviewedToday||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Decks:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:V.decks?.length||0})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",className:"flex-1 font-terminal text-xs",onClick:()=>Ie(),children:[e.jsx(He,{className:"w-3 h-3 mr-1"}),"Refresh"]}),e.jsx(c,{size:"sm",className:"flex-1 font-terminal text-xs bg-secondary hover:bg-secondary/80",onClick:()=>je.mutate(),disabled:je.isPending,children:je.isPending?"Syncing...":"Sync Cards"})]}),ee.length>0&&e.jsxs("div",{className:"pt-3 border-t border-secondary/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-arcade text-[10px] text-yellow-400",children:["PENDING CARDS (",ee.length,")"]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(c,{size:"sm",variant:"outline",className:"h-5 px-2 text-[10px] font-terminal",onClick:()=>{h.size===ee.length?D(new Set):D(new Set(ee.map(s=>s.id)))},children:h.size===ee.length?"None":"All"})})]}),h.size>0&&e.jsxs("div",{className:"flex gap-1 mb-2",children:[e.jsxs(c,{size:"sm",className:"h-6 px-2 text-[10px] font-terminal bg-green-600 hover:bg-green-700",onClick:()=>{h.forEach(s=>Pe.mutate(s)),D(new Set)},children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Approve (",h.size,")"]}),e.jsxs(c,{size:"sm",variant:"destructive",className:"h-6 px-2 text-[10px] font-terminal",onClick:()=>{h.forEach(s=>Fe.mutate(s)),D(new Set)},children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Delete (",h.size,")"]})]}),e.jsx(pe,{className:"h-[200px]",children:e.jsx("div",{className:"space-y-2",children:ee.map(s=>e.jsx("div",{className:`p-2 bg-black/40 border text-xs ${h.has(s.id)?"border-primary":"border-secondary/30"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Se,{checked:h.has(s.id),onCheckedChange:t=>{const i=new Set(h);t?i.add(s.id):i.delete(s.id),D(i)},className:"mt-1 border-secondary data-[state=checked]:bg-primary"}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"font-terminal text-primary truncate",children:s.front}),e.jsx("div",{className:"font-terminal text-muted-foreground mt-1 truncate",children:s.back}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(C,{variant:"outline",className:"text-[9px] border-blue-500/50 text-blue-400 shrink-0",children:s.deckName}),e.jsx(c,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>Ns(s),title:"Edit card",children:e.jsx(fe,{className:"w-3 h-3"})}),e.jsx(c,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-green-500/50 text-green-400 hover:bg-green-500/20",onClick:()=>Pe.mutate(s.id),title:"Approve card",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(c,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>Fe.mutate(s.id),title:"Delete card",children:e.jsx(se,{className:"w-3 h-3"})})]})]})]})},s.id))})})]})]}):e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400",children:V?.error||"Anki not connected"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Anki with AnkiConnect plugin"}),e.jsxs(c,{size:"sm",variant:"outline",className:"font-terminal text-xs",onClick:()=>Ie(),children:[e.jsx(He,{className:"w-3 h-3 mr-1"}),"Retry"]})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(T,{className:"bg-black/40 border-2 border-primary rounded-none h-[600px] flex flex-col",children:[e.jsx(A,{className:"border-b border-primary/50 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(I,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"LLM CHAT"]}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground mt-1",children:"Ask questions about your study data"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${K?.connected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:K?.connected?"Obsidian":"Obsidian Offline"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:s=>de(s.target.checked),disabled:!K?.connected,className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"font-terminal text-xs",children:"Sync Notes"})]})]})]})}),e.jsxs(P,{className:"flex-1 flex flex-col p-0 overflow-hidden",children:[e.jsx(pe,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-3",children:[o.length===0?e.jsxs("div",{className:"text-center font-terminal text-xs text-muted-foreground py-8",children:["Start a conversation or upload files.",e.jsx("br",{}),"Ask about your study patterns, concepts, or get summaries."]}):o.map((s,t)=>e.jsx("div",{className:`p-3 font-terminal text-sm ${s.role==="user"?"bg-primary/10 border-l-2 border-primary ml-4":"bg-secondary/10 border-l-2 border-secondary mr-4"}`,children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.content})},t)),ae&&e.jsx("div",{className:"p-3 font-terminal text-sm text-muted-foreground animate-pulse bg-secondary/10 border-l-2 border-secondary mr-4",children:"Thinking..."}),e.jsx("div",{ref:Te})]})}),f&&e.jsxs("div",{className:"border-t border-secondary/50 p-3 bg-black/40",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",className:"text-[10px]",children:"WRAP"}),e.jsxs("span",{className:"font-terminal text-xs text-muted-foreground",children:["Session ",f.wrapSessionId||f.sessionId||"logged"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",className:"text-[10px]",children:["Cards: ",f.cardsCreated]}),e.jsxs(C,{variant:"outline",className:"text-[10px]",children:["Issues: ",f.issuesLogged]}),e.jsxs(C,{variant:"outline",className:"text-[10px]",children:["Notes: ",f.obsidianSynced?"Merged":"Pending"]})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",className:"font-terminal text-xs",onClick:()=>E.invalidateQueries({queryKey:["anki"]}),children:"Refresh Anki Drafts"}),f.obsidianPath&&e.jsx(c,{variant:"outline",size:"sm",className:"font-terminal text-xs",onClick:()=>navigator.clipboard.writeText(f.obsidianPath||""),children:"Copy Obsidian Path"})]}),f.obsidianPath&&e.jsxs("div",{className:"mt-2 font-terminal text-[11px] text-muted-foreground",children:["Obsidian: ",f.obsidianPath]})]}),e.jsxs("div",{className:"border-t border-primary/50 p-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground self-center",children:"MODE:"}),["all","obsidian","anki","metrics"].map(s=>e.jsx(c,{variant:re===s?"default":"outline",size:"sm",className:`rounded-none font-arcade text-[10px] h-7 px-2 ${re===s?"bg-primary text-black":"border-secondary"}`,onClick:()=>a(s),children:s.toUpperCase()},s))]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"file",ref:Ee,onChange:Ss,accept:".txt,.json,.md,.csv",className:"hidden"}),e.jsx(c,{variant:"ghost",size:"icon",className:"rounded-none h-10 w-10 shrink-0",onClick:()=>Ee.current?.click(),"data-testid":"button-upload-file",title:"Attach file",children:e.jsx(Vs,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"rounded-none h-10 w-10 shrink-0",onClick:vs,title:"Paste WRAP",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx(U,{value:l,onChange:s=>n(s.target.value),placeholder:"Type a message or paste WRAP...",className:"rounded-none border-secondary bg-black font-terminal text-sm min-h-[40px] max-h-[200px] resize-none overflow-y-auto",rows:Math.min(8,Math.max(1,l.split(`
`).length)),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&!s.ctrlKey&&(s.preventDefault(),Me())},"data-testid":"input-chat"}),e.jsx(c,{size:"icon",className:"rounded-none bg-primary h-10 w-10 shrink-0",onClick:Me,disabled:!l.trim()||ae,"data-testid":"button-send-chat",children:e.jsx(qs,{className:"w-4 h-4"})})]})]})]})]})})]})]}),e.jsx(Re,{open:b!==null,onOpenChange:()=>q(null),children:e.jsxs(Le,{className:"bg-black border-2 border-primary rounded-none max-w-2xl",children:[e.jsxs(qe,{children:[e.jsxs(ze,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"EDIT SESSION #",b]}),e.jsx($e,{className:"font-terminal text-muted-foreground",children:"Update WRAP methodology fields for this study session"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Mode"}),e.jsxs(Ge,{value:x.mode,onValueChange:s=>O(t=>({...t,mode:s})),children:[e.jsx(Ue,{className:"rounded-none border-secondary",children:e.jsx(We,{placeholder:"Select mode"})}),e.jsxs(_e,{className:"rounded-none border-secondary bg-black",children:[e.jsx(y,{value:"Core",children:"Core"}),e.jsx(y,{value:"Sprint",children:"Sprint"}),e.jsx(y,{value:"Drill",children:"Drill"}),e.jsx(y,{value:"study",children:"Study"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Minutes"}),e.jsx(Be,{type:"number",value:x.minutes,onChange:s=>O(t=>({...t,minutes:s.target.value})),className:"rounded-none border-secondary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Cards"}),e.jsx(Be,{type:"number",value:x.cards,onChange:s=>O(t=>({...t,cards:s.target.value})),className:"rounded-none border-secondary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Confusions (comma-separated)"}),e.jsx(U,{value:x.confusions,onChange:s=>O(t=>({...t,confusions:s.target.value})),placeholder:"e.g., muscle insertion points, nerve pathways",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Weak Anchors (comma-separated)"}),e.jsx(U,{value:x.weakAnchors,onChange:s=>O(t=>({...t,weakAnchors:s.target.value})),placeholder:"e.g., brachial plexus diagram, ROM measurements",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Concepts (comma-separated)"}),e.jsx(U,{value:x.concepts,onChange:s=>O(t=>({...t,concepts:s.target.value})),placeholder:"e.g., upper extremity anatomy, peripheral nerves",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Issues (comma-separated)"}),e.jsx(U,{value:x.issues,onChange:s=>O(t=>({...t,issues:s.target.value})),placeholder:"e.g., interrupted by phone, lost focus after 30 min",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Notes"}),e.jsx(U,{value:x.notes,onChange:s=>O(t=>({...t,notes:s.target.value})),placeholder:"Free-form observations about the session",className:"rounded-none border-secondary min-h-[80px]"})]})]}),e.jsxs(Ke,{className:"gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>q(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(c,{onClick:ms,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})}),e.jsx(Os,{open:ne,onOpenChange:j,children:e.jsxs(Es,{className:"bg-black border-2 border-destructive rounded-none",children:[e.jsxs(Ts,{children:[e.jsxs(As,{className:"font-arcade text-destructive flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"CONFIRM DELETE"]}),e.jsxs(Is,{className:"font-terminal text-muted-foreground",children:["Are you sure you want to delete ",Y.length," session",Y.length!==1?"s":"","? This action cannot be undone."]})]}),e.jsxs(Ps,{className:"gap-2",children:[e.jsx(Fs,{className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:"Cancel"}),e.jsxs(Ms,{onClick:ds,className:"font-terminal rounded-none bg-destructive hover:bg-destructive/80 text-destructive-foreground",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),e.jsx(Re,{open:Q!==null,onOpenChange:()=>z(null),children:e.jsxs(Le,{className:"bg-black border-2 border-primary rounded-none max-w-lg",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsxs(qe,{children:[e.jsxs(ze,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"EDIT CARD"]}),e.jsx($e,{className:"font-terminal text-muted-foreground",children:"Edit card content and select target deck"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Front (Question)"}),e.jsx(U,{value:$.front,onChange:s=>H(t=>({...t,front:s.target.value})),placeholder:"Card front...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Back (Answer)"}),e.jsx(U,{value:$.back,onChange:s=>H(t=>({...t,back:s.target.value})),placeholder:"Card back...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Target Deck"}),e.jsxs(Ge,{value:$.deckName,onValueChange:s=>H(t=>({...t,deckName:s})),children:[e.jsx(Ue,{className:"rounded-none border-secondary",children:e.jsx(We,{placeholder:"Select deck"})}),e.jsxs(_e,{className:"rounded-none border-secondary bg-black max-h-[200px]",children:[e.jsx(y,{value:"PT::EBP",children:"PT::EBP (Evidence Based Practice)"}),e.jsx(y,{value:"PT::ExPhys",children:"PT::ExPhys (Exercise Physiology)"}),e.jsx(y,{value:"PT::MS1",children:"PT::MS1 (Movement Science 1)"}),e.jsx(y,{value:"PT::Neuro",children:"PT::Neuro (Neuroscience)"}),e.jsx(y,{value:"PT::TI",children:"PT::TI (Therapeutic Intervention)"}),e.jsx(y,{value:"PT::General",children:"PT::General"}),V?.decks?.filter(s=>!s.startsWith("PT::")).map(s=>e.jsx(y,{value:s,children:s},s))]})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:["Current: ",e.jsx("span",{className:"text-blue-400",children:$.deckName})]})]})]}),e.jsxs(Ke,{className:"gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>z(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(c,{onClick:js,disabled:ye.isPending,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),ye.isPending?"Saving...":"Save"]})]})]})})]})}export{bt as default};
