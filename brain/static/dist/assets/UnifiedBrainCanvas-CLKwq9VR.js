import{c as Ar,Q as UB,T as qB,n as rs,k as nt,r as E,j as f,U as Gt,b as Kt,a as Eh,W as HB,l as GB,Y as KB,Z as VB,$ as WB,a0 as YB,a1 as XB,a2 as ZB,a3 as WC,o as kh,R as Th,f as Mh,p as Ah,q as c1,e as Fl,d as dr,P as Xn,A as l1,g as La,s as YD,D as XD,C as ZD,t as QD,m as jh,a4 as QB,h as JB}from"./index-zrbYRJ__.js";import{t as eU,B as De,a as Cr,n as JD,s as Rh,R as tU,P as nU,O as rU,C as iU,U as sU,V as oU,x as dl,J as eN,M as tN,K as nN,N as rN,r as iN,Q as sN,I as aU,m as cU,f as Ip,S as oN,p as lU}from"./layout-BP63CjJV.js";import{t as aN,D as Oh,M as uU,a as dU}from"./brain-Ypf8q-PB.js";import{d as u1,e as cN,V as hU}from"./colors-BDuz-soV.js";import{P as Dh}from"./plus-CisaFkvv.js";import{A as fU,C as pU}from"./triangle-alert-C_KWRVup.js";import{F as lN}from"./file-text-Cl_fP06A.js";import{e as uN}from"./select-CIbCbSJy.js";import{c as dN,R as gU,I as mU}from"./tabs-B2bVz8p6.js";import{u as yU}from"./index-_UkbIFQl.js";import{C as sa}from"./checkbox-f9OqHXqc.js";import{S as vU,a as xU}from"./square-CT6JK21S.js";import{S as bU}from"./send-Cj_Oqy9E.js";import"./index-BSBC2sqM.js";import"./refresh-cw-CkONKAJB.js";import"./message-square-CYF3Bg0j.js";import"./loader-circle-Dzcas9x-.js";import"./badge-qR6sunCN.js";import"./external-link-DIv5j9kV.js";import"./star-CzKScepz.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SU=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],hN=Ar("arrow-left-right",SU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wU=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],fN=Ar("arrow-up-down",wU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _U=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],CU=Ar("diamond",_U);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PU=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]],pN=Ar("file-input",PU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IU=[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]],gN=Ar("hexagon",IU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EU=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m8 11 4 4 4-4",key:"1dohi6"}],["path",{d:"M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4",key:"1ywtjm"}]],mN=Ar("import",EU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kU=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],yN=Ar("layout-grid",kU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TU=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],vN=Ar("palette",TU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MU=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],xN=Ar("redo-2",MU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AU=[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]],jU=Ar("sprout",AU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RU=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],bN=Ar("undo-2",RU);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OU=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],DU=Ar("workflow",OU);function zt(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let r=0,i;r<n.length;r++)(i=zt(n[r]))!==""&&(e+=(e&&" ")+i);else for(let r in n)n[r]&&(e+=(e&&" ")+r);return e}var NU={value:()=>{}};function zl(){for(var n=0,e=arguments.length,r={},i;n<e;++n){if(!(i=arguments[n]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new vd(r)}function vd(n){this._=n}function LU(n,e){return n.trim().split(/^|\s+/).map(function(r){var i="",s=r.indexOf(".");if(s>=0&&(i=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}vd.prototype=zl.prototype={constructor:vd,on:function(n,e){var r=this._,i=LU(n+"",r),s,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((s=(n=i[o]).type)&&(s=FU(r[s],n.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(s=(n=i[o]).type)r[s]=YC(r[s],n.name,e);else if(e==null)for(s in r)r[s]=YC(r[s],n.name,null);return this},copy:function(){var n={},e=this._;for(var r in e)n[r]=e[r].slice();return new vd(n)},call:function(n,e){if((s=arguments.length-2)>0)for(var r=new Array(s),i=0,s,o;i<s;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],i=0,s=o.length;i<s;++i)o[i].value.apply(e,r)},apply:function(n,e,r){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],s=0,o=i.length;s<o;++s)i[s].value.apply(e,r)}};function FU(n,e){for(var r=0,i=n.length,s;r<i;++r)if((s=n[r]).name===e)return s.value}function YC(n,e,r){for(var i=0,s=n.length;i<s;++i)if(n[i].name===e){n[i]=NU,n=n.slice(0,i).concat(n.slice(i+1));break}return r!=null&&n.push({name:e,value:r}),n}var WS="http://www.w3.org/1999/xhtml";const XC={svg:"http://www.w3.org/2000/svg",xhtml:WS,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Nh(n){var e=n+="",r=e.indexOf(":");return r>=0&&(e=n.slice(0,r))!=="xmlns"&&(n=n.slice(r+1)),XC.hasOwnProperty(e)?{space:XC[e],local:n}:n}function zU(n){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===WS&&e.documentElement.namespaceURI===WS?e.createElement(n):e.createElementNS(r,n)}}function $U(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function SN(n){var e=Nh(n);return(e.local?$U:zU)(e)}function BU(){}function d1(n){return n==null?BU:function(){return this.querySelector(n)}}function UU(n){typeof n!="function"&&(n=d1(n));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var o=e[s],a=o.length,c=i[s]=new Array(a),l,u,d=0;d<a;++d)(l=o[d])&&(u=n.call(l,l.__data__,d,o))&&("__data__"in l&&(u.__data__=l.__data__),c[d]=u);return new cr(i,this._parents)}function qU(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function HU(){return[]}function wN(n){return n==null?HU:function(){return this.querySelectorAll(n)}}function GU(n){return function(){return qU(n.apply(this,arguments))}}function KU(n){typeof n=="function"?n=GU(n):n=wN(n);for(var e=this._groups,r=e.length,i=[],s=[],o=0;o<r;++o)for(var a=e[o],c=a.length,l,u=0;u<c;++u)(l=a[u])&&(i.push(n.call(l,l.__data__,u,a)),s.push(l));return new cr(i,s)}function _N(n){return function(){return this.matches(n)}}function CN(n){return function(e){return e.matches(n)}}var VU=Array.prototype.find;function WU(n){return function(){return VU.call(this.children,n)}}function YU(){return this.firstElementChild}function XU(n){return this.select(n==null?YU:WU(typeof n=="function"?n:CN(n)))}var ZU=Array.prototype.filter;function QU(){return Array.from(this.children)}function JU(n){return function(){return ZU.call(this.children,n)}}function e9(n){return this.selectAll(n==null?QU:JU(typeof n=="function"?n:CN(n)))}function t9(n){typeof n!="function"&&(n=_N(n));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var o=e[s],a=o.length,c=i[s]=[],l,u=0;u<a;++u)(l=o[u])&&n.call(l,l.__data__,u,o)&&c.push(l);return new cr(i,this._parents)}function PN(n){return new Array(n.length)}function n9(){return new cr(this._enter||this._groups.map(PN),this._parents)}function Od(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Od.prototype={constructor:Od,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function r9(n){return function(){return n}}function i9(n,e,r,i,s,o){for(var a=0,c,l=e.length,u=o.length;a<u;++a)(c=e[a])?(c.__data__=o[a],i[a]=c):r[a]=new Od(n,o[a]);for(;a<l;++a)(c=e[a])&&(s[a]=c)}function s9(n,e,r,i,s,o,a){var c,l,u=new Map,d=e.length,h=o.length,p=new Array(d),g;for(c=0;c<d;++c)(l=e[c])&&(p[c]=g=a.call(l,l.__data__,c,e)+"",u.has(g)?s[c]=l:u.set(g,l));for(c=0;c<h;++c)g=a.call(n,o[c],c,o)+"",(l=u.get(g))?(i[c]=l,l.__data__=o[c],u.delete(g)):r[c]=new Od(n,o[c]);for(c=0;c<d;++c)(l=e[c])&&u.get(p[c])===l&&(s[c]=l)}function o9(n){return n.__data__}function a9(n,e){if(!arguments.length)return Array.from(this,o9);var r=e?s9:i9,i=this._parents,s=this._groups;typeof n!="function"&&(n=r9(n));for(var o=s.length,a=new Array(o),c=new Array(o),l=new Array(o),u=0;u<o;++u){var d=i[u],h=s[u],p=h.length,g=c9(n.call(d,d&&d.__data__,u,i)),y=g.length,v=c[u]=new Array(y),x=a[u]=new Array(y),m=l[u]=new Array(p);r(d,h,v,x,m,g,e);for(var b=0,S=0,w,I;b<y;++b)if(w=v[b]){for(b>=S&&(S=b+1);!(I=x[S])&&++S<y;);w._next=I||null}}return a=new cr(a,i),a._enter=c,a._exit=l,a}function c9(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function l9(){return new cr(this._exit||this._groups.map(PN),this._parents)}function u9(n,e,r){var i=this.enter(),s=this,o=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(s=e(s),s&&(s=s.selection())),r==null?o.remove():r(o),i&&s?i.merge(s).order():s}function d9(n){for(var e=n.selection?n.selection():n,r=this._groups,i=e._groups,s=r.length,o=i.length,a=Math.min(s,o),c=new Array(s),l=0;l<a;++l)for(var u=r[l],d=i[l],h=u.length,p=c[l]=new Array(h),g,y=0;y<h;++y)(g=u[y]||d[y])&&(p[y]=g);for(;l<s;++l)c[l]=r[l];return new cr(c,this._parents)}function h9(){for(var n=this._groups,e=-1,r=n.length;++e<r;)for(var i=n[e],s=i.length-1,o=i[s],a;--s>=0;)(a=i[s])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function f9(n){n||(n=p9);function e(h,p){return h&&p?n(h.__data__,p.__data__):!h-!p}for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o){for(var a=r[o],c=a.length,l=s[o]=new Array(c),u,d=0;d<c;++d)(u=a[d])&&(l[d]=u);l.sort(e)}return new cr(s,this._parents).order()}function p9(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function g9(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function m9(){return Array.from(this)}function y9(){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i=n[e],s=0,o=i.length;s<o;++s){var a=i[s];if(a)return a}return null}function v9(){let n=0;for(const e of this)++n;return n}function x9(){return!this.node()}function b9(n){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var s=e[r],o=0,a=s.length,c;o<a;++o)(c=s[o])&&n.call(c,c.__data__,o,s);return this}function S9(n){return function(){this.removeAttribute(n)}}function w9(n){return function(){this.removeAttributeNS(n.space,n.local)}}function _9(n,e){return function(){this.setAttribute(n,e)}}function C9(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function P9(n,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(n):this.setAttribute(n,r)}}function I9(n,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,r)}}function E9(n,e){var r=Nh(n);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((e==null?r.local?w9:S9:typeof e=="function"?r.local?I9:P9:r.local?C9:_9)(r,e))}function IN(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function k9(n){return function(){this.style.removeProperty(n)}}function T9(n,e,r){return function(){this.style.setProperty(n,e,r)}}function M9(n,e,r){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,r)}}function A9(n,e,r){return arguments.length>1?this.each((e==null?k9:typeof e=="function"?M9:T9)(n,e,r??"")):wa(this.node(),n)}function wa(n,e){return n.style.getPropertyValue(e)||IN(n).getComputedStyle(n,null).getPropertyValue(e)}function j9(n){return function(){delete this[n]}}function R9(n,e){return function(){this[n]=e}}function O9(n,e){return function(){var r=e.apply(this,arguments);r==null?delete this[n]:this[n]=r}}function D9(n,e){return arguments.length>1?this.each((e==null?j9:typeof e=="function"?O9:R9)(n,e)):this.node()[n]}function EN(n){return n.trim().split(/^|\s+/)}function h1(n){return n.classList||new kN(n)}function kN(n){this._node=n,this._names=EN(n.getAttribute("class")||"")}kN.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function TN(n,e){for(var r=h1(n),i=-1,s=e.length;++i<s;)r.add(e[i])}function MN(n,e){for(var r=h1(n),i=-1,s=e.length;++i<s;)r.remove(e[i])}function N9(n){return function(){TN(this,n)}}function L9(n){return function(){MN(this,n)}}function F9(n,e){return function(){(e.apply(this,arguments)?TN:MN)(this,n)}}function z9(n,e){var r=EN(n+"");if(arguments.length<2){for(var i=h1(this.node()),s=-1,o=r.length;++s<o;)if(!i.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?F9:e?N9:L9)(r,e))}function $9(){this.textContent=""}function B9(n){return function(){this.textContent=n}}function U9(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function q9(n){return arguments.length?this.each(n==null?$9:(typeof n=="function"?U9:B9)(n)):this.node().textContent}function H9(){this.innerHTML=""}function G9(n){return function(){this.innerHTML=n}}function K9(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function V9(n){return arguments.length?this.each(n==null?H9:(typeof n=="function"?K9:G9)(n)):this.node().innerHTML}function W9(){this.nextSibling&&this.parentNode.appendChild(this)}function Y9(){return this.each(W9)}function X9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z9(){return this.each(X9)}function Q9(n){var e=typeof n=="function"?n:SN(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function J9(){return null}function e7(n,e){var r=typeof n=="function"?n:SN(n),i=e==null?J9:typeof e=="function"?e:d1(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function t7(){var n=this.parentNode;n&&n.removeChild(this)}function n7(){return this.each(t7)}function r7(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function i7(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function s7(n){return this.select(n?i7:r7)}function o7(n){return arguments.length?this.property("__data__",n):this.node().__data__}function a7(n){return function(e){n.call(this,e,this.__data__)}}function c7(n){return n.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");return i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),{type:e,name:r}})}function l7(n){return function(){var e=this.__on;if(e){for(var r=0,i=-1,s=e.length,o;r<s;++r)o=e[r],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):e[++i]=o;++i?e.length=i:delete this.__on}}}function u7(n,e,r){return function(){var i=this.__on,s,o=a7(e);if(i){for(var a=0,c=i.length;a<c;++a)if((s=i[a]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=r),s.value=e;return}}this.addEventListener(n.type,o,r),s={type:n.type,name:n.name,value:e,listener:o,options:r},i?i.push(s):this.__on=[s]}}function d7(n,e,r){var i=c7(n+""),s,o=i.length,a;if(arguments.length<2){var c=this.node().__on;if(c){for(var l=0,u=c.length,d;l<u;++l)for(s=0,d=c[l];s<o;++s)if((a=i[s]).type===d.type&&a.name===d.name)return d.value}return}for(c=e?u7:l7,s=0;s<o;++s)this.each(c(i[s],e,r));return this}function AN(n,e,r){var i=IN(n),s=i.CustomEvent;typeof s=="function"?s=new s(e,r):(s=i.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),n.dispatchEvent(s)}function h7(n,e){return function(){return AN(this,n,e)}}function f7(n,e){return function(){return AN(this,n,e.apply(this,arguments))}}function p7(n,e){return this.each((typeof e=="function"?f7:h7)(n,e))}function*g7(){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i=n[e],s=0,o=i.length,a;s<o;++s)(a=i[s])&&(yield a)}var jN=[null];function cr(n,e){this._groups=n,this._parents=e}function $l(){return new cr([[document.documentElement]],jN)}function m7(){return this}cr.prototype=$l.prototype={constructor:cr,select:UU,selectAll:KU,selectChild:XU,selectChildren:e9,filter:t9,data:a9,enter:n9,exit:l9,join:u9,merge:d9,selection:m7,order:h9,sort:f9,call:g9,nodes:m9,node:y9,size:v9,empty:x9,each:b9,attr:E9,style:A9,property:D9,classed:z9,text:q9,html:V9,raise:Y9,lower:Z9,append:Q9,insert:e7,remove:n7,clone:s7,datum:o7,on:d7,dispatch:p7,[Symbol.iterator]:g7};function xn(n){return typeof n=="string"?new cr([[document.querySelector(n)]],[document.documentElement]):new cr([[n]],jN)}function y7(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Sr(n,e){if(n=y7(n),e===void 0&&(e=n.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[n.clientX-s.left-e.clientLeft,n.clientY-s.top-e.clientTop]}}return[n.pageX,n.pageY]}const v7={passive:!1},hl={capture:!0,passive:!1};function Ep(n){n.stopImmediatePropagation()}function ya(n){n.preventDefault(),n.stopImmediatePropagation()}function RN(n){var e=n.document.documentElement,r=xn(n).on("dragstart.drag",ya,hl);"onselectstart"in e?r.on("selectstart.drag",ya,hl):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ON(n,e){var r=n.document.documentElement,i=xn(n).on("dragstart.drag",null);e&&(i.on("click.drag",ya,hl),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Mu=n=>()=>n;function YS(n,{sourceEvent:e,subject:r,target:i,identifier:s,active:o,x:a,y:c,dx:l,dy:u,dispatch:d}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}YS.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function x7(n){return!n.ctrlKey&&!n.button}function b7(){return this.parentNode}function S7(n,e){return e??{x:n.x,y:n.y}}function w7(){return navigator.maxTouchPoints||"ontouchstart"in this}function f1(){var n=x7,e=b7,r=S7,i=w7,s={},o=zl("start","drag","end"),a=0,c,l,u,d,h=0;function p(w){w.on("mousedown.drag",g).filter(i).on("touchstart.drag",x).on("touchmove.drag",m,v7).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(w,I){if(!(d||!n.call(this,w,I))){var C=S(this,e.call(this,w,I),w,I,"mouse");C&&(xn(w.view).on("mousemove.drag",y,hl).on("mouseup.drag",v,hl),RN(w.view),Ep(w),u=!1,c=w.clientX,l=w.clientY,C("start",w))}}function y(w){if(ya(w),!u){var I=w.clientX-c,C=w.clientY-l;u=I*I+C*C>h}s.mouse("drag",w)}function v(w){xn(w.view).on("mousemove.drag mouseup.drag",null),ON(w.view,u),ya(w),s.mouse("end",w)}function x(w,I){if(n.call(this,w,I)){var C=w.changedTouches,_=e.call(this,w,I),P=C.length,M,T;for(M=0;M<P;++M)(T=S(this,_,w,I,C[M].identifier,C[M]))&&(Ep(w),T("start",w,C[M]))}}function m(w){var I=w.changedTouches,C=I.length,_,P;for(_=0;_<C;++_)(P=s[I[_].identifier])&&(ya(w),P("drag",w,I[_]))}function b(w){var I=w.changedTouches,C=I.length,_,P;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),_=0;_<C;++_)(P=s[I[_].identifier])&&(Ep(w),P("end",w,I[_]))}function S(w,I,C,_,P,M){var T=o.copy(),A=Sr(M||C,I),R,O,j;if((j=r.call(w,new YS("beforestart",{sourceEvent:C,target:p,identifier:P,active:a,x:A[0],y:A[1],dx:0,dy:0,dispatch:T}),_))!=null)return R=j.x-A[0]||0,O=j.y-A[1]||0,function D(N,F,z){var $=A,G;switch(N){case"start":s[P]=D,G=a++;break;case"end":delete s[P],--a;case"drag":A=Sr(z||F,I),G=a;break}T.call(N,w,new YS(N,{sourceEvent:F,subject:j,target:p,identifier:P,active:G,x:A[0]+R,y:A[1]+O,dx:A[0]-$[0],dy:A[1]-$[1],dispatch:T}),_)}}return p.filter=function(w){return arguments.length?(n=typeof w=="function"?w:Mu(!!w),p):n},p.container=function(w){return arguments.length?(e=typeof w=="function"?w:Mu(w),p):e},p.subject=function(w){return arguments.length?(r=typeof w=="function"?w:Mu(w),p):r},p.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Mu(!!w),p):i},p.on=function(){var w=o.on.apply(o,arguments);return w===o?p:w},p.clickDistance=function(w){return arguments.length?(h=(w=+w)*w,p):Math.sqrt(h)},p}function p1(n,e,r){n.prototype=e.prototype=r,r.constructor=n}function DN(n,e){var r=Object.create(n.prototype);for(var i in e)r[i]=e[i];return r}function Bl(){}var fl=.7,Dd=1/fl,va="\\s*([+-]?\\d+)\\s*",pl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",gi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_7=/^#([0-9a-f]{3,8})$/,C7=new RegExp(`^rgb\\(${va},${va},${va}\\)$`),P7=new RegExp(`^rgb\\(${gi},${gi},${gi}\\)$`),I7=new RegExp(`^rgba\\(${va},${va},${va},${pl}\\)$`),E7=new RegExp(`^rgba\\(${gi},${gi},${gi},${pl}\\)$`),k7=new RegExp(`^hsl\\(${pl},${gi},${gi}\\)$`),T7=new RegExp(`^hsla\\(${pl},${gi},${gi},${pl}\\)$`),ZC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};p1(Bl,xo,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:QC,formatHex:QC,formatHex8:M7,formatHsl:A7,formatRgb:JC,toString:JC});function QC(){return this.rgb().formatHex()}function M7(){return this.rgb().formatHex8()}function A7(){return NN(this).formatHsl()}function JC(){return this.rgb().formatRgb()}function xo(n){var e,r;return n=(n+"").trim().toLowerCase(),(e=_7.exec(n))?(r=e[1].length,e=parseInt(e[1],16),r===6?eP(e):r===3?new qn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Au(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Au(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=C7.exec(n))?new qn(e[1],e[2],e[3],1):(e=P7.exec(n))?new qn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=I7.exec(n))?Au(e[1],e[2],e[3],e[4]):(e=E7.exec(n))?Au(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=k7.exec(n))?rP(e[1],e[2]/100,e[3]/100,1):(e=T7.exec(n))?rP(e[1],e[2]/100,e[3]/100,e[4]):ZC.hasOwnProperty(n)?eP(ZC[n]):n==="transparent"?new qn(NaN,NaN,NaN,0):null}function eP(n){return new qn(n>>16&255,n>>8&255,n&255,1)}function Au(n,e,r,i){return i<=0&&(n=e=r=NaN),new qn(n,e,r,i)}function j7(n){return n instanceof Bl||(n=xo(n)),n?(n=n.rgb(),new qn(n.r,n.g,n.b,n.opacity)):new qn}function XS(n,e,r,i){return arguments.length===1?j7(n):new qn(n,e,r,i??1)}function qn(n,e,r,i){this.r=+n,this.g=+e,this.b=+r,this.opacity=+i}p1(qn,XS,DN(Bl,{brighter(n){return n=n==null?Dd:Math.pow(Dd,n),new qn(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?fl:Math.pow(fl,n),new qn(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new qn(fo(this.r),fo(this.g),fo(this.b),Nd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tP,formatHex:tP,formatHex8:R7,formatRgb:nP,toString:nP}));function tP(){return`#${co(this.r)}${co(this.g)}${co(this.b)}`}function R7(){return`#${co(this.r)}${co(this.g)}${co(this.b)}${co((isNaN(this.opacity)?1:this.opacity)*255)}`}function nP(){const n=Nd(this.opacity);return`${n===1?"rgb(":"rgba("}${fo(this.r)}, ${fo(this.g)}, ${fo(this.b)}${n===1?")":`, ${n})`}`}function Nd(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function fo(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function co(n){return n=fo(n),(n<16?"0":"")+n.toString(16)}function rP(n,e,r,i){return i<=0?n=e=r=NaN:r<=0||r>=1?n=e=NaN:e<=0&&(n=NaN),new qr(n,e,r,i)}function NN(n){if(n instanceof qr)return new qr(n.h,n.s,n.l,n.opacity);if(n instanceof Bl||(n=xo(n)),!n)return new qr;if(n instanceof qr)return n;n=n.rgb();var e=n.r/255,r=n.g/255,i=n.b/255,s=Math.min(e,r,i),o=Math.max(e,r,i),a=NaN,c=o-s,l=(o+s)/2;return c?(e===o?a=(r-i)/c+(r<i)*6:r===o?a=(i-e)/c+2:a=(e-r)/c+4,c/=l<.5?o+s:2-o-s,a*=60):c=l>0&&l<1?0:a,new qr(a,c,l,n.opacity)}function O7(n,e,r,i){return arguments.length===1?NN(n):new qr(n,e,r,i??1)}function qr(n,e,r,i){this.h=+n,this.s=+e,this.l=+r,this.opacity=+i}p1(qr,O7,DN(Bl,{brighter(n){return n=n==null?Dd:Math.pow(Dd,n),new qr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?fl:Math.pow(fl,n),new qr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,s=2*r-i;return new qn(kp(n>=240?n-240:n+120,s,i),kp(n,s,i),kp(n<120?n+240:n-120,s,i),this.opacity)},clamp(){return new qr(iP(this.h),ju(this.s),ju(this.l),Nd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Nd(this.opacity);return`${n===1?"hsl(":"hsla("}${iP(this.h)}, ${ju(this.s)*100}%, ${ju(this.l)*100}%${n===1?")":`, ${n})`}`}}));function iP(n){return n=(n||0)%360,n<0?n+360:n}function ju(n){return Math.max(0,Math.min(1,n||0))}function kp(n,e,r){return(n<60?e+(r-e)*n/60:n<180?r:n<240?e+(r-e)*(240-n)/60:e)*255}const g1=n=>()=>n;function D7(n,e){return function(r){return n+r*e}}function N7(n,e,r){return n=Math.pow(n,r),e=Math.pow(e,r)-n,r=1/r,function(i){return Math.pow(n+i*e,r)}}function L7(n){return(n=+n)==1?LN:function(e,r){return r-e?N7(e,r,n):g1(isNaN(e)?r:e)}}function LN(n,e){var r=e-n;return r?D7(n,r):g1(isNaN(n)?e:n)}const Ld=(function n(e){var r=L7(e);function i(s,o){var a=r((s=XS(s)).r,(o=XS(o)).r),c=r(s.g,o.g),l=r(s.b,o.b),u=LN(s.opacity,o.opacity);return function(d){return s.r=a(d),s.g=c(d),s.b=l(d),s.opacity=u(d),s+""}}return i.gamma=n,i})(1);function F7(n,e){e||(e=[]);var r=n?Math.min(e.length,n.length):0,i=e.slice(),s;return function(o){for(s=0;s<r;++s)i[s]=n[s]*(1-o)+e[s]*o;return i}}function z7(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function $7(n,e){var r=e?e.length:0,i=n?Math.min(r,n.length):0,s=new Array(i),o=new Array(r),a;for(a=0;a<i;++a)s[a]=Zc(n[a],e[a]);for(;a<r;++a)o[a]=e[a];return function(c){for(a=0;a<i;++a)o[a]=s[a](c);return o}}function B7(n,e){var r=new Date;return n=+n,e=+e,function(i){return r.setTime(n*(1-i)+e*i),r}}function ci(n,e){return n=+n,e=+e,function(r){return n*(1-r)+e*r}}function U7(n,e){var r={},i={},s;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in n?r[s]=Zc(n[s],e[s]):i[s]=e[s];return function(o){for(s in r)i[s]=r[s](o);return i}}var ZS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Tp=new RegExp(ZS.source,"g");function q7(n){return function(){return n}}function H7(n){return function(e){return n(e)+""}}function FN(n,e){var r=ZS.lastIndex=Tp.lastIndex=0,i,s,o,a=-1,c=[],l=[];for(n=n+"",e=e+"";(i=ZS.exec(n))&&(s=Tp.exec(e));)(o=s.index)>r&&(o=e.slice(r,o),c[a]?c[a]+=o:c[++a]=o),(i=i[0])===(s=s[0])?c[a]?c[a]+=s:c[++a]=s:(c[++a]=null,l.push({i:a,x:ci(i,s)})),r=Tp.lastIndex;return r<e.length&&(o=e.slice(r),c[a]?c[a]+=o:c[++a]=o),c.length<2?l[0]?H7(l[0].x):q7(e):(e=l.length,function(u){for(var d=0,h;d<e;++d)c[(h=l[d]).i]=h.x(u);return c.join("")})}function Zc(n,e){var r=typeof e,i;return e==null||r==="boolean"?g1(e):(r==="number"?ci:r==="string"?(i=xo(e))?(e=i,Ld):FN:e instanceof xo?Ld:e instanceof Date?B7:z7(e)?F7:Array.isArray(e)?$7:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?U7:ci)(n,e)}var sP=180/Math.PI,QS={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zN(n,e,r,i,s,o){var a,c,l;return(a=Math.sqrt(n*n+e*e))&&(n/=a,e/=a),(l=n*r+e*i)&&(r-=n*l,i-=e*l),(c=Math.sqrt(r*r+i*i))&&(r/=c,i/=c,l/=c),n*i<e*r&&(n=-n,e=-e,l=-l,a=-a),{translateX:s,translateY:o,rotate:Math.atan2(e,n)*sP,skewX:Math.atan(l)*sP,scaleX:a,scaleY:c}}var Ru;function G7(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?QS:zN(e.a,e.b,e.c,e.d,e.e,e.f)}function K7(n){return n==null||(Ru||(Ru=document.createElementNS("http://www.w3.org/2000/svg","g")),Ru.setAttribute("transform",n),!(n=Ru.transform.baseVal.consolidate()))?QS:(n=n.matrix,zN(n.a,n.b,n.c,n.d,n.e,n.f))}function $N(n,e,r,i){function s(u){return u.length?u.pop()+" ":""}function o(u,d,h,p,g,y){if(u!==h||d!==p){var v=g.push("translate(",null,e,null,r);y.push({i:v-4,x:ci(u,h)},{i:v-2,x:ci(d,p)})}else(h||p)&&g.push("translate("+h+e+p+r)}function a(u,d,h,p){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),p.push({i:h.push(s(h)+"rotate(",null,i)-2,x:ci(u,d)})):d&&h.push(s(h)+"rotate("+d+i)}function c(u,d,h,p){u!==d?p.push({i:h.push(s(h)+"skewX(",null,i)-2,x:ci(u,d)}):d&&h.push(s(h)+"skewX("+d+i)}function l(u,d,h,p,g,y){if(u!==h||d!==p){var v=g.push(s(g)+"scale(",null,",",null,")");y.push({i:v-4,x:ci(u,h)},{i:v-2,x:ci(d,p)})}else(h!==1||p!==1)&&g.push(s(g)+"scale("+h+","+p+")")}return function(u,d){var h=[],p=[];return u=n(u),d=n(d),o(u.translateX,u.translateY,d.translateX,d.translateY,h,p),a(u.rotate,d.rotate,h,p),c(u.skewX,d.skewX,h,p),l(u.scaleX,u.scaleY,d.scaleX,d.scaleY,h,p),u=d=null,function(g){for(var y=-1,v=p.length,x;++y<v;)h[(x=p[y]).i]=x.x(g);return h.join("")}}}var V7=$N(G7,"px, ","px)","deg)"),W7=$N(K7,", ",")",")"),Y7=1e-12;function oP(n){return((n=Math.exp(n))+1/n)/2}function X7(n){return((n=Math.exp(n))-1/n)/2}function Z7(n){return((n=Math.exp(2*n))-1)/(n+1)}const xd=(function n(e,r,i){function s(o,a){var c=o[0],l=o[1],u=o[2],d=a[0],h=a[1],p=a[2],g=d-c,y=h-l,v=g*g+y*y,x,m;if(v<Y7)m=Math.log(p/u)/e,x=function(_){return[c+_*g,l+_*y,u*Math.exp(e*_*m)]};else{var b=Math.sqrt(v),S=(p*p-u*u+i*v)/(2*u*r*b),w=(p*p-u*u-i*v)/(2*p*r*b),I=Math.log(Math.sqrt(S*S+1)-S),C=Math.log(Math.sqrt(w*w+1)-w);m=(C-I)/e,x=function(_){var P=_*m,M=oP(I),T=u/(r*b)*(M*Z7(e*P+I)-X7(I));return[c+T*g,l+T*y,u*M/oP(e*P+I)]}}return x.duration=m*1e3*e/Math.SQRT2,x}return s.rho=function(o){var a=Math.max(.001,+o),c=a*a,l=c*c;return n(a,c,l)},s})(Math.SQRT2,2,4);var _a=0,jc=0,ac=0,BN=1e3,Fd,Rc,zd=0,bo=0,Lh=0,gl=typeof performance=="object"&&performance.now?performance:Date,UN=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function m1(){return bo||(UN(Q7),bo=gl.now()+Lh)}function Q7(){bo=0}function $d(){this._call=this._time=this._next=null}$d.prototype=y1.prototype={constructor:$d,restart:function(n,e,r){if(typeof n!="function")throw new TypeError("callback is not a function");r=(r==null?m1():+r)+(e==null?0:+e),!this._next&&Rc!==this&&(Rc?Rc._next=this:Fd=this,Rc=this),this._call=n,this._time=r,JS()},stop:function(){this._call&&(this._call=null,this._time=1/0,JS())}};function y1(n,e,r){var i=new $d;return i.restart(n,e,r),i}function J7(){m1(),++_a;for(var n=Fd,e;n;)(e=bo-n._time)>=0&&n._call.call(void 0,e),n=n._next;--_a}function aP(){bo=(zd=gl.now())+Lh,_a=jc=0;try{J7()}finally{_a=0,tq(),bo=0}}function eq(){var n=gl.now(),e=n-zd;e>BN&&(Lh-=e,zd=n)}function tq(){for(var n,e=Fd,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(r=e._next,e._next=null,e=n?n._next=r:Fd=r);Rc=n,JS(i)}function JS(n){if(!_a){jc&&(jc=clearTimeout(jc));var e=n-bo;e>24?(n<1/0&&(jc=setTimeout(aP,n-gl.now()-Lh)),ac&&(ac=clearInterval(ac))):(ac||(zd=gl.now(),ac=setInterval(eq,BN)),_a=1,UN(aP))}}function cP(n,e,r){var i=new $d;return e=e==null?0:+e,i.restart(s=>{i.stop(),n(s+e)},e,r),i}var nq=zl("start","end","cancel","interrupt"),rq=[],qN=0,lP=1,ew=2,bd=3,uP=4,tw=5,Sd=6;function Fh(n,e,r,i,s,o){var a=n.__transition;if(!a)n.__transition={};else if(r in a)return;iq(n,r,{name:e,index:i,group:s,on:nq,tween:rq,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:qN})}function v1(n,e){var r=Jr(n,e);if(r.state>qN)throw new Error("too late; already scheduled");return r}function Ii(n,e){var r=Jr(n,e);if(r.state>bd)throw new Error("too late; already running");return r}function Jr(n,e){var r=n.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function iq(n,e,r){var i=n.__transition,s;i[e]=r,r.timer=y1(o,0,r.time);function o(u){r.state=lP,r.timer.restart(a,r.delay,r.time),r.delay<=u&&a(u-r.delay)}function a(u){var d,h,p,g;if(r.state!==lP)return l();for(d in i)if(g=i[d],g.name===r.name){if(g.state===bd)return cP(a);g.state===uP?(g.state=Sd,g.timer.stop(),g.on.call("interrupt",n,n.__data__,g.index,g.group),delete i[d]):+d<e&&(g.state=Sd,g.timer.stop(),g.on.call("cancel",n,n.__data__,g.index,g.group),delete i[d])}if(cP(function(){r.state===bd&&(r.state=uP,r.timer.restart(c,r.delay,r.time),c(u))}),r.state=ew,r.on.call("start",n,n.__data__,r.index,r.group),r.state===ew){for(r.state=bd,s=new Array(p=r.tween.length),d=0,h=-1;d<p;++d)(g=r.tween[d].value.call(n,n.__data__,r.index,r.group))&&(s[++h]=g);s.length=h+1}}function c(u){for(var d=u<r.duration?r.ease.call(null,u/r.duration):(r.timer.restart(l),r.state=tw,1),h=-1,p=s.length;++h<p;)s[h].call(n,d);r.state===tw&&(r.on.call("end",n,n.__data__,r.index,r.group),l())}function l(){r.state=Sd,r.timer.stop(),delete i[e];for(var u in i)return;delete n.__transition}}function wd(n,e){var r=n.__transition,i,s,o=!0,a;if(r){e=e==null?null:e+"";for(a in r){if((i=r[a]).name!==e){o=!1;continue}s=i.state>ew&&i.state<tw,i.state=Sd,i.timer.stop(),i.on.call(s?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete r[a]}o&&delete n.__transition}}function sq(n){return this.each(function(){wd(this,n)})}function oq(n,e){var r,i;return function(){var s=Ii(this,n),o=s.tween;if(o!==r){i=r=o;for(var a=0,c=i.length;a<c;++a)if(i[a].name===e){i=i.slice(),i.splice(a,1);break}}s.tween=i}}function aq(n,e,r){var i,s;if(typeof r!="function")throw new Error;return function(){var o=Ii(this,n),a=o.tween;if(a!==i){s=(i=a).slice();for(var c={name:e,value:r},l=0,u=s.length;l<u;++l)if(s[l].name===e){s[l]=c;break}l===u&&s.push(c)}o.tween=s}}function cq(n,e){var r=this._id;if(n+="",arguments.length<2){for(var i=Jr(this.node(),r).tween,s=0,o=i.length,a;s<o;++s)if((a=i[s]).name===n)return a.value;return null}return this.each((e==null?oq:aq)(r,n,e))}function x1(n,e,r){var i=n._id;return n.each(function(){var s=Ii(this,i);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return Jr(s,i).value[e]}}function HN(n,e){var r;return(typeof e=="number"?ci:e instanceof xo?Ld:(r=xo(e))?(e=r,Ld):FN)(n,e)}function lq(n){return function(){this.removeAttribute(n)}}function uq(n){return function(){this.removeAttributeNS(n.space,n.local)}}function dq(n,e,r){var i,s=r+"",o;return function(){var a=this.getAttribute(n);return a===s?null:a===i?o:o=e(i=a,r)}}function hq(n,e,r){var i,s=r+"",o;return function(){var a=this.getAttributeNS(n.space,n.local);return a===s?null:a===i?o:o=e(i=a,r)}}function fq(n,e,r){var i,s,o;return function(){var a,c=r(this),l;return c==null?void this.removeAttribute(n):(a=this.getAttribute(n),l=c+"",a===l?null:a===i&&l===s?o:(s=l,o=e(i=a,c)))}}function pq(n,e,r){var i,s,o;return function(){var a,c=r(this),l;return c==null?void this.removeAttributeNS(n.space,n.local):(a=this.getAttributeNS(n.space,n.local),l=c+"",a===l?null:a===i&&l===s?o:(s=l,o=e(i=a,c)))}}function gq(n,e){var r=Nh(n),i=r==="transform"?W7:HN;return this.attrTween(n,typeof e=="function"?(r.local?pq:fq)(r,i,x1(this,"attr."+n,e)):e==null?(r.local?uq:lq)(r):(r.local?hq:dq)(r,i,e))}function mq(n,e){return function(r){this.setAttribute(n,e.call(this,r))}}function yq(n,e){return function(r){this.setAttributeNS(n.space,n.local,e.call(this,r))}}function vq(n,e){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&yq(n,o)),r}return s._value=e,s}function xq(n,e){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&mq(n,o)),r}return s._value=e,s}function bq(n,e){var r="attr."+n;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var i=Nh(n);return this.tween(r,(i.local?vq:xq)(i,e))}function Sq(n,e){return function(){v1(this,n).delay=+e.apply(this,arguments)}}function wq(n,e){return e=+e,function(){v1(this,n).delay=e}}function _q(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Sq:wq)(e,n)):Jr(this.node(),e).delay}function Cq(n,e){return function(){Ii(this,n).duration=+e.apply(this,arguments)}}function Pq(n,e){return e=+e,function(){Ii(this,n).duration=e}}function Iq(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Cq:Pq)(e,n)):Jr(this.node(),e).duration}function Eq(n,e){if(typeof e!="function")throw new Error;return function(){Ii(this,n).ease=e}}function kq(n){var e=this._id;return arguments.length?this.each(Eq(e,n)):Jr(this.node(),e).ease}function Tq(n,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;Ii(this,n).ease=r}}function Mq(n){if(typeof n!="function")throw new Error;return this.each(Tq(this._id,n))}function Aq(n){typeof n!="function"&&(n=_N(n));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var o=e[s],a=o.length,c=i[s]=[],l,u=0;u<a;++u)(l=o[u])&&n.call(l,l.__data__,u,o)&&c.push(l);return new Ji(i,this._parents,this._name,this._id)}function jq(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,r=n._groups,i=e.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var l=e[c],u=r[c],d=l.length,h=a[c]=new Array(d),p,g=0;g<d;++g)(p=l[g]||u[g])&&(h[g]=p);for(;c<i;++c)a[c]=e[c];return new Ji(a,this._parents,this._name,this._id)}function Rq(n){return(n+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function Oq(n,e,r){var i,s,o=Rq(e)?v1:Ii;return function(){var a=o(this,n),c=a.on;c!==i&&(s=(i=c).copy()).on(e,r),a.on=s}}function Dq(n,e){var r=this._id;return arguments.length<2?Jr(this.node(),r).on.on(n):this.each(Oq(r,n,e))}function Nq(n){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==n)return;e&&e.removeChild(this)}}function Lq(){return this.on("end.remove",Nq(this._id))}function Fq(n){var e=this._name,r=this._id;typeof n!="function"&&(n=d1(n));for(var i=this._groups,s=i.length,o=new Array(s),a=0;a<s;++a)for(var c=i[a],l=c.length,u=o[a]=new Array(l),d,h,p=0;p<l;++p)(d=c[p])&&(h=n.call(d,d.__data__,p,c))&&("__data__"in d&&(h.__data__=d.__data__),u[p]=h,Fh(u[p],e,r,p,u,Jr(d,r)));return new Ji(o,this._parents,e,r)}function zq(n){var e=this._name,r=this._id;typeof n!="function"&&(n=wN(n));for(var i=this._groups,s=i.length,o=[],a=[],c=0;c<s;++c)for(var l=i[c],u=l.length,d,h=0;h<u;++h)if(d=l[h]){for(var p=n.call(d,d.__data__,h,l),g,y=Jr(d,r),v=0,x=p.length;v<x;++v)(g=p[v])&&Fh(g,e,r,v,p,y);o.push(p),a.push(d)}return new Ji(o,a,e,r)}var $q=$l.prototype.constructor;function Bq(){return new $q(this._groups,this._parents)}function Uq(n,e){var r,i,s;return function(){var o=wa(this,n),a=(this.style.removeProperty(n),wa(this,n));return o===a?null:o===r&&a===i?s:s=e(r=o,i=a)}}function GN(n){return function(){this.style.removeProperty(n)}}function qq(n,e,r){var i,s=r+"",o;return function(){var a=wa(this,n);return a===s?null:a===i?o:o=e(i=a,r)}}function Hq(n,e,r){var i,s,o;return function(){var a=wa(this,n),c=r(this),l=c+"";return c==null&&(l=c=(this.style.removeProperty(n),wa(this,n))),a===l?null:a===i&&l===s?o:(s=l,o=e(i=a,c))}}function Gq(n,e){var r,i,s,o="style."+e,a="end."+o,c;return function(){var l=Ii(this,n),u=l.on,d=l.value[o]==null?c||(c=GN(e)):void 0;(u!==r||s!==d)&&(i=(r=u).copy()).on(a,s=d),l.on=i}}function Kq(n,e,r){var i=(n+="")=="transform"?V7:HN;return e==null?this.styleTween(n,Uq(n,i)).on("end.style."+n,GN(n)):typeof e=="function"?this.styleTween(n,Hq(n,i,x1(this,"style."+n,e))).each(Gq(this._id,n)):this.styleTween(n,qq(n,i,e),r).on("end.style."+n,null)}function Vq(n,e,r){return function(i){this.style.setProperty(n,e.call(this,i),r)}}function Wq(n,e,r){var i,s;function o(){var a=e.apply(this,arguments);return a!==s&&(i=(s=a)&&Vq(n,a,r)),i}return o._value=e,o}function Yq(n,e,r){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Wq(n,e,r??""))}function Xq(n){return function(){this.textContent=n}}function Zq(n){return function(){var e=n(this);this.textContent=e??""}}function Qq(n){return this.tween("text",typeof n=="function"?Zq(x1(this,"text",n)):Xq(n==null?"":n+""))}function Jq(n){return function(e){this.textContent=n.call(this,e)}}function eH(n){var e,r;function i(){var s=n.apply(this,arguments);return s!==r&&(e=(r=s)&&Jq(s)),e}return i._value=n,i}function tH(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,eH(n))}function nH(){for(var n=this._name,e=this._id,r=KN(),i=this._groups,s=i.length,o=0;o<s;++o)for(var a=i[o],c=a.length,l,u=0;u<c;++u)if(l=a[u]){var d=Jr(l,e);Fh(l,n,r,u,a,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Ji(i,this._parents,n,r)}function rH(){var n,e,r=this,i=r._id,s=r.size();return new Promise(function(o,a){var c={value:a},l={value:function(){--s===0&&o()}};r.each(function(){var u=Ii(this,i),d=u.on;d!==n&&(e=(n=d).copy(),e._.cancel.push(c),e._.interrupt.push(c),e._.end.push(l)),u.on=e}),s===0&&o()})}var iH=0;function Ji(n,e,r,i){this._groups=n,this._parents=e,this._name=r,this._id=i}function KN(){return++iH}var Oi=$l.prototype;Ji.prototype={constructor:Ji,select:Fq,selectAll:zq,selectChild:Oi.selectChild,selectChildren:Oi.selectChildren,filter:Aq,merge:jq,selection:Bq,transition:nH,call:Oi.call,nodes:Oi.nodes,node:Oi.node,size:Oi.size,empty:Oi.empty,each:Oi.each,on:Dq,attr:gq,attrTween:bq,style:Kq,styleTween:Yq,text:Qq,textTween:tH,remove:Lq,tween:cq,delay:_q,duration:Iq,ease:kq,easeVarying:Mq,end:rH,[Symbol.iterator]:Oi[Symbol.iterator]};function sH(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var oH={time:null,delay:0,duration:250,ease:sH};function aH(n,e){for(var r;!(r=n.__transition)||!(r=r[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return r}function cH(n){var e,r;n instanceof Ji?(e=n._id,n=n._name):(e=KN(),(r=oH).time=m1(),n=n==null?null:n+"");for(var i=this._groups,s=i.length,o=0;o<s;++o)for(var a=i[o],c=a.length,l,u=0;u<c;++u)(l=a[u])&&Fh(l,n,e,u,a,r||aH(l,e));return new Ji(i,this._parents,n,e)}$l.prototype.interrupt=sq;$l.prototype.transition=cH;const Ou=n=>()=>n;function lH(n,{sourceEvent:e,target:r,transform:i,dispatch:s}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Gi(n,e,r){this.k=n,this.x=e,this.y=r}Gi.prototype={constructor:Gi,scale:function(n){return n===1?this:new Gi(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Gi(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zh=new Gi(1,0,0);Br.prototype=Gi.prototype;function Br(n){for(;!n.__zoom;)if(!(n=n.parentNode))return zh;return n.__zoom}function Mp(n){n.stopImmediatePropagation()}function cc(n){n.preventDefault(),n.stopImmediatePropagation()}function uH(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function dH(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function dP(){return this.__zoom||zh}function hH(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function fH(){return navigator.maxTouchPoints||"ontouchstart"in this}function pH(n,e,r){var i=n.invertX(e[0][0])-r[0][0],s=n.invertX(e[1][0])-r[1][0],o=n.invertY(e[0][1])-r[0][1],a=n.invertY(e[1][1])-r[1][1];return n.translate(s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function b1(){var n=uH,e=dH,r=pH,i=hH,s=fH,o=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],c=250,l=xd,u=zl("start","zoom","end"),d,h,p,g=500,y=150,v=0,x=10;function m(j){j.property("__zoom",dP).on("wheel.zoom",P,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",T).filter(s).on("touchstart.zoom",A).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(j,D,N,F){var z=j.selection?j.selection():j;z.property("__zoom",dP),j!==z?I(j,D,N,F):z.interrupt().each(function(){C(this,arguments).event(F).start().zoom(null,typeof D=="function"?D.apply(this,arguments):D).end()})},m.scaleBy=function(j,D,N,F){m.scaleTo(j,function(){var z=this.__zoom.k,$=typeof D=="function"?D.apply(this,arguments):D;return z*$},N,F)},m.scaleTo=function(j,D,N,F){m.transform(j,function(){var z=e.apply(this,arguments),$=this.__zoom,G=N==null?w(z):typeof N=="function"?N.apply(this,arguments):N,X=$.invert(G),ee=typeof D=="function"?D.apply(this,arguments):D;return r(S(b($,ee),G,X),z,a)},N,F)},m.translateBy=function(j,D,N,F){m.transform(j,function(){return r(this.__zoom.translate(typeof D=="function"?D.apply(this,arguments):D,typeof N=="function"?N.apply(this,arguments):N),e.apply(this,arguments),a)},null,F)},m.translateTo=function(j,D,N,F,z){m.transform(j,function(){var $=e.apply(this,arguments),G=this.__zoom,X=F==null?w($):typeof F=="function"?F.apply(this,arguments):F;return r(zh.translate(X[0],X[1]).scale(G.k).translate(typeof D=="function"?-D.apply(this,arguments):-D,typeof N=="function"?-N.apply(this,arguments):-N),$,a)},F,z)};function b(j,D){return D=Math.max(o[0],Math.min(o[1],D)),D===j.k?j:new Gi(D,j.x,j.y)}function S(j,D,N){var F=D[0]-N[0]*j.k,z=D[1]-N[1]*j.k;return F===j.x&&z===j.y?j:new Gi(j.k,F,z)}function w(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function I(j,D,N,F){j.on("start.zoom",function(){C(this,arguments).event(F).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(F).end()}).tween("zoom",function(){var z=this,$=arguments,G=C(z,$).event(F),X=e.apply(z,$),ee=N==null?w(X):typeof N=="function"?N.apply(z,$):N,re=Math.max(X[1][0]-X[0][0],X[1][1]-X[0][1]),B=z.__zoom,U=typeof D=="function"?D.apply(z,$):D,Q=l(B.invert(ee).concat(re/B.k),U.invert(ee).concat(re/U.k));return function(K){if(K===1)K=U;else{var Y=Q(K),V=re/Y[2];K=new Gi(V,ee[0]-Y[0]*V,ee[1]-Y[1]*V)}G.zoom(null,K)}})}function C(j,D,N){return!N&&j.__zooming||new _(j,D)}function _(j,D){this.that=j,this.args=D,this.active=0,this.sourceEvent=null,this.extent=e.apply(j,D),this.taps=0}_.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,D){return this.mouse&&j!=="mouse"&&(this.mouse[1]=D.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=D.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=D.invert(this.touch1[0])),this.that.__zoom=D,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var D=xn(this.that).datum();u.call(j,this.that,new lH(j,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:u}),D)}};function P(j,...D){if(!n.apply(this,arguments))return;var N=C(this,D).event(j),F=this.__zoom,z=Math.max(o[0],Math.min(o[1],F.k*Math.pow(2,i.apply(this,arguments)))),$=Sr(j);if(N.wheel)(N.mouse[0][0]!==$[0]||N.mouse[0][1]!==$[1])&&(N.mouse[1]=F.invert(N.mouse[0]=$)),clearTimeout(N.wheel);else{if(F.k===z)return;N.mouse=[$,F.invert($)],wd(this),N.start()}cc(j),N.wheel=setTimeout(G,y),N.zoom("mouse",r(S(b(F,z),N.mouse[0],N.mouse[1]),N.extent,a));function G(){N.wheel=null,N.end()}}function M(j,...D){if(p||!n.apply(this,arguments))return;var N=j.currentTarget,F=C(this,D,!0).event(j),z=xn(j.view).on("mousemove.zoom",ee,!0).on("mouseup.zoom",re,!0),$=Sr(j,N),G=j.clientX,X=j.clientY;RN(j.view),Mp(j),F.mouse=[$,this.__zoom.invert($)],wd(this),F.start();function ee(B){if(cc(B),!F.moved){var U=B.clientX-G,Q=B.clientY-X;F.moved=U*U+Q*Q>v}F.event(B).zoom("mouse",r(S(F.that.__zoom,F.mouse[0]=Sr(B,N),F.mouse[1]),F.extent,a))}function re(B){z.on("mousemove.zoom mouseup.zoom",null),ON(B.view,F.moved),cc(B),F.event(B).end()}}function T(j,...D){if(n.apply(this,arguments)){var N=this.__zoom,F=Sr(j.changedTouches?j.changedTouches[0]:j,this),z=N.invert(F),$=N.k*(j.shiftKey?.5:2),G=r(S(b(N,$),F,z),e.apply(this,D),a);cc(j),c>0?xn(this).transition().duration(c).call(I,G,F,j):xn(this).call(m.transform,G,F,j)}}function A(j,...D){if(n.apply(this,arguments)){var N=j.touches,F=N.length,z=C(this,D,j.changedTouches.length===F).event(j),$,G,X,ee;for(Mp(j),G=0;G<F;++G)X=N[G],ee=Sr(X,this),ee=[ee,this.__zoom.invert(ee),X.identifier],z.touch0?!z.touch1&&z.touch0[2]!==ee[2]&&(z.touch1=ee,z.taps=0):(z.touch0=ee,$=!0,z.taps=1+!!d);d&&(d=clearTimeout(d)),$&&(z.taps<2&&(h=ee[0],d=setTimeout(function(){d=null},g)),wd(this),z.start())}}function R(j,...D){if(this.__zooming){var N=C(this,D).event(j),F=j.changedTouches,z=F.length,$,G,X,ee;for(cc(j),$=0;$<z;++$)G=F[$],X=Sr(G,this),N.touch0&&N.touch0[2]===G.identifier?N.touch0[0]=X:N.touch1&&N.touch1[2]===G.identifier&&(N.touch1[0]=X);if(G=N.that.__zoom,N.touch1){var re=N.touch0[0],B=N.touch0[1],U=N.touch1[0],Q=N.touch1[1],K=(K=U[0]-re[0])*K+(K=U[1]-re[1])*K,Y=(Y=Q[0]-B[0])*Y+(Y=Q[1]-B[1])*Y;G=b(G,Math.sqrt(K/Y)),X=[(re[0]+U[0])/2,(re[1]+U[1])/2],ee=[(B[0]+Q[0])/2,(B[1]+Q[1])/2]}else if(N.touch0)X=N.touch0[0],ee=N.touch0[1];else return;N.zoom("touch",r(S(G,X,ee),N.extent,a))}}function O(j,...D){if(this.__zooming){var N=C(this,D).event(j),F=j.changedTouches,z=F.length,$,G;for(Mp(j),p&&clearTimeout(p),p=setTimeout(function(){p=null},g),$=0;$<z;++$)G=F[$],N.touch0&&N.touch0[2]===G.identifier?delete N.touch0:N.touch1&&N.touch1[2]===G.identifier&&delete N.touch1;if(N.touch1&&!N.touch0&&(N.touch0=N.touch1,delete N.touch1),N.touch0)N.touch0[1]=this.__zoom.invert(N.touch0[0]);else if(N.end(),N.taps===2&&(G=Sr(G,this),Math.hypot(h[0]-G[0],h[1]-G[1])<x)){var X=xn(this).on("dblclick.zoom");X&&X.apply(this,arguments)}}}return m.wheelDelta=function(j){return arguments.length?(i=typeof j=="function"?j:Ou(+j),m):i},m.filter=function(j){return arguments.length?(n=typeof j=="function"?j:Ou(!!j),m):n},m.touchable=function(j){return arguments.length?(s=typeof j=="function"?j:Ou(!!j),m):s},m.extent=function(j){return arguments.length?(e=typeof j=="function"?j:Ou([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),m):e},m.scaleExtent=function(j){return arguments.length?(o[0]=+j[0],o[1]=+j[1],m):[o[0],o[1]]},m.translateExtent=function(j){return arguments.length?(a[0][0]=+j[0][0],a[1][0]=+j[1][0],a[0][1]=+j[0][1],a[1][1]=+j[1][1],m):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},m.constrain=function(j){return arguments.length?(r=j,m):r},m.duration=function(j){return arguments.length?(c=+j,m):c},m.interpolate=function(j){return arguments.length?(l=j,m):l},m.on=function(){var j=u.on.apply(u,arguments);return j===u?m:j},m.clickDistance=function(j){return arguments.length?(v=(j=+j)*j,m):Math.sqrt(v)},m.tapDistance=function(j){return arguments.length?(x=+j,m):x},m}const xi={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,{id:e,sourceHandle:r,targetHandle:i})=>`Couldn't create edge for ${n} handle id: "${n==="source"?r:i}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(n="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${n}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},ml=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],VN=["Enter"," ","Escape"],WN={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:n,x:e,y:r})=>`Moved selected node ${n}. New position, x: ${e}, y: ${r}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Ca;(function(n){n.Strict="strict",n.Loose="loose"})(Ca||(Ca={}));var po;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(po||(po={}));var yl;(function(n){n.Partial="partial",n.Full="full"})(yl||(yl={}));const YN={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ps;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(Ps||(Ps={}));var Ls;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(Ls||(Ls={}));var Ce;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(Ce||(Ce={}));const hP={[Ce.Left]:Ce.Right,[Ce.Right]:Ce.Left,[Ce.Top]:Ce.Bottom,[Ce.Bottom]:Ce.Top};function XN(n){return n===null?null:n?"valid":"invalid"}const ZN=n=>"id"in n&&"source"in n&&"target"in n,gH=n=>"id"in n&&"position"in n&&!("source"in n)&&!("target"in n),S1=n=>"id"in n&&"internals"in n&&!("source"in n)&&!("target"in n),Ul=(n,e=[0,0])=>{const{width:r,height:i}=is(n),s=n.origin??e,o=r*s[0],a=i*s[1];return{x:n.position.x-o,y:n.position.y-a}},mH=(n,e={nodeOrigin:[0,0]})=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const r=n.reduce((i,s)=>{const o=typeof s=="string";let a=!e.nodeLookup&&!o?s:void 0;e.nodeLookup&&(a=o?e.nodeLookup.get(s):S1(s)?s:e.nodeLookup.get(s.id));const c=a?Bd(a,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return $h(i,c)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Bh(r)},ql=(n,e={})=>{let r={x:1/0,y:1/0,x2:-1/0,y2:-1/0},i=!1;return n.forEach(s=>{(e.filter===void 0||e.filter(s))&&(r=$h(r,Bd(s)),i=!0)}),i?Bh(r):{x:0,y:0,width:0,height:0}},w1=(n,e,[r,i,s]=[0,0,1],o=!1,a=!1)=>{const c={...Gl(e,[r,i,s]),width:e.width/s,height:e.height/s},l=[];for(const u of n.values()){const{measured:d,selectable:h=!0,hidden:p=!1}=u;if(a&&!h||p)continue;const g=d.width??u.width??u.initialWidth??null,y=d.height??u.height??u.initialHeight??null,v=vl(c,Ia(u)),x=(g??0)*(y??0),m=o&&v>0;(!u.internals.handleBounds||m||v>=x||u.dragging)&&l.push(u)}return l},yH=(n,e)=>{const r=new Set;return n.forEach(i=>{r.add(i.id)}),e.filter(i=>r.has(i.source)||r.has(i.target))};function vH(n,e){const r=new Map,i=e?.nodes?new Set(e.nodes.map(s=>s.id)):null;return n.forEach(s=>{s.measured.width&&s.measured.height&&(e?.includeHiddenNodes||!s.hidden)&&(!i||i.has(s.id))&&r.set(s.id,s)}),r}async function xH({nodes:n,width:e,height:r,panZoom:i,minZoom:s,maxZoom:o},a){if(n.size===0)return Promise.resolve(!0);const c=vH(n,a),l=ql(c),u=_1(l,e,r,a?.minZoom??s,a?.maxZoom??o,a?.padding??.1);return await i.setViewport(u,{duration:a?.duration,ease:a?.ease,interpolate:a?.interpolate}),Promise.resolve(!0)}function QN({nodeId:n,nextPosition:e,nodeLookup:r,nodeOrigin:i=[0,0],nodeExtent:s,onError:o}){const a=r.get(n),c=a.parentId?r.get(a.parentId):void 0,{x:l,y:u}=c?c.internals.positionAbsolute:{x:0,y:0},d=a.origin??i;let h=a.extent||s;if(a.extent==="parent"&&!a.expandParent)if(!c)o?.("005",xi.error005());else{const g=c.measured.width,y=c.measured.height;g&&y&&(h=[[l,u],[l+g,u+y]])}else c&&Ea(a.extent)&&(h=[[a.extent[0][0]+l,a.extent[0][1]+u],[a.extent[1][0]+l,a.extent[1][1]+u]]);const p=Ea(h)?So(e,h,a.measured):e;return(a.measured.width===void 0||a.measured.height===void 0)&&o?.("015",xi.error015()),{position:{x:p.x-l+(a.measured.width??0)*d[0],y:p.y-u+(a.measured.height??0)*d[1]},positionAbsolute:p}}async function bH({nodesToRemove:n=[],edgesToRemove:e=[],nodes:r,edges:i,onBeforeDelete:s}){const o=new Set(n.map(p=>p.id)),a=[];for(const p of r){if(p.deletable===!1)continue;const g=o.has(p.id),y=!g&&p.parentId&&a.find(v=>v.id===p.parentId);(g||y)&&a.push(p)}const c=new Set(e.map(p=>p.id)),l=i.filter(p=>p.deletable!==!1),d=yH(a,l);for(const p of l)c.has(p.id)&&!d.find(y=>y.id===p.id)&&d.push(p);if(!s)return{edges:d,nodes:a};const h=await s({nodes:a,edges:d});return typeof h=="boolean"?h?{edges:d,nodes:a}:{edges:[],nodes:[]}:h}const Pa=(n,e=0,r=1)=>Math.min(Math.max(n,e),r),So=(n={x:0,y:0},e,r)=>({x:Pa(n.x,e[0][0],e[1][0]-(r?.width??0)),y:Pa(n.y,e[0][1],e[1][1]-(r?.height??0))});function JN(n,e,r){const{width:i,height:s}=is(r),{x:o,y:a}=r.internals.positionAbsolute;return So(n,[[o,a],[o+i,a+s]],e)}const fP=(n,e,r)=>n<e?Pa(Math.abs(n-e),1,e)/e:n>r?-Pa(Math.abs(n-r),1,e)/e:0,e3=(n,e,r=15,i=40)=>{const s=fP(n.x,i,e.width-i)*r,o=fP(n.y,i,e.height-i)*r;return[s,o]},$h=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),nw=({x:n,y:e,width:r,height:i})=>({x:n,y:e,x2:n+r,y2:e+i}),Bh=({x:n,y:e,x2:r,y2:i})=>({x:n,y:e,width:r-n,height:i-e}),Ia=(n,e=[0,0])=>{const{x:r,y:i}=S1(n)?n.internals.positionAbsolute:Ul(n,e);return{x:r,y:i,width:n.measured?.width??n.width??n.initialWidth??0,height:n.measured?.height??n.height??n.initialHeight??0}},Bd=(n,e=[0,0])=>{const{x:r,y:i}=S1(n)?n.internals.positionAbsolute:Ul(n,e);return{x:r,y:i,x2:r+(n.measured?.width??n.width??n.initialWidth??0),y2:i+(n.measured?.height??n.height??n.initialHeight??0)}},t3=(n,e)=>Bh($h(nw(n),nw(e))),vl=(n,e)=>{const r=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),i=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(r*i)},pP=n=>Gr(n.width)&&Gr(n.height)&&Gr(n.x)&&Gr(n.y),Gr=n=>!isNaN(n)&&isFinite(n),SH=(n,e)=>{},Hl=(n,e=[1,1])=>({x:e[0]*Math.round(n.x/e[0]),y:e[1]*Math.round(n.y/e[1])}),Gl=({x:n,y:e},[r,i,s],o=!1,a=[1,1])=>{const c={x:(n-r)/s,y:(e-i)/s};return o?Hl(c,a):c},Ud=({x:n,y:e},[r,i,s])=>({x:n*s+r,y:e*s+i});function Vo(n,e){if(typeof n=="number")return Math.floor((e-e/(1+n))*.5);if(typeof n=="string"&&n.endsWith("px")){const r=parseFloat(n);if(!Number.isNaN(r))return Math.floor(r)}if(typeof n=="string"&&n.endsWith("%")){const r=parseFloat(n);if(!Number.isNaN(r))return Math.floor(e*r*.01)}return console.error(`[React Flow] The padding value "${n}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function wH(n,e,r){if(typeof n=="string"||typeof n=="number"){const i=Vo(n,r),s=Vo(n,e);return{top:i,right:s,bottom:i,left:s,x:s*2,y:i*2}}if(typeof n=="object"){const i=Vo(n.top??n.y??0,r),s=Vo(n.bottom??n.y??0,r),o=Vo(n.left??n.x??0,e),a=Vo(n.right??n.x??0,e);return{top:i,right:a,bottom:s,left:o,x:o+a,y:i+s}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function _H(n,e,r,i,s,o){const{x:a,y:c}=Ud(n,[e,r,i]),{x:l,y:u}=Ud({x:n.x+n.width,y:n.y+n.height},[e,r,i]),d=s-l,h=o-u;return{left:Math.floor(a),top:Math.floor(c),right:Math.floor(d),bottom:Math.floor(h)}}const _1=(n,e,r,i,s,o)=>{const a=wH(o,e,r),c=(e-a.x)/n.width,l=(r-a.y)/n.height,u=Math.min(c,l),d=Pa(u,i,s),h=n.x+n.width/2,p=n.y+n.height/2,g=e/2-h*d,y=r/2-p*d,v=_H(n,g,y,d,e,r),x={left:Math.min(v.left-a.left,0),top:Math.min(v.top-a.top,0),right:Math.min(v.right-a.right,0),bottom:Math.min(v.bottom-a.bottom,0)};return{x:g-x.left+x.right,y:y-x.top+x.bottom,zoom:d}},xl=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Ea(n){return n!=null&&n!=="parent"}function is(n){return{width:n.measured?.width??n.width??n.initialWidth??0,height:n.measured?.height??n.height??n.initialHeight??0}}function n3(n){return(n.measured?.width??n.width??n.initialWidth)!==void 0&&(n.measured?.height??n.height??n.initialHeight)!==void 0}function r3(n,e={width:0,height:0},r,i,s){const o={...n},a=i.get(r);if(a){const c=a.origin||s;o.x+=a.internals.positionAbsolute.x-(e.width??0)*c[0],o.y+=a.internals.positionAbsolute.y-(e.height??0)*c[1]}return o}function gP(n,e){if(n.size!==e.size)return!1;for(const r of n)if(!e.has(r))return!1;return!0}function CH(){let n,e;return{promise:new Promise((i,s)=>{n=i,e=s}),resolve:n,reject:e}}function PH(n){return{...WN,...n||{}}}function Qc(n,{snapGrid:e=[0,0],snapToGrid:r=!1,transform:i,containerBounds:s}){const{x:o,y:a}=Kr(n),c=Gl({x:o-(s?.left??0),y:a-(s?.top??0)},i),{x:l,y:u}=r?Hl(c,e):c;return{xSnapped:l,ySnapped:u,...c}}const C1=n=>({width:n.offsetWidth,height:n.offsetHeight}),i3=n=>n?.getRootNode?.()||window?.document,IH=["INPUT","SELECT","TEXTAREA"];function s3(n){const e=n.composedPath?.()?.[0]||n.target;return e?.nodeType!==1?!1:IH.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const o3=n=>"clientX"in n,Kr=(n,e)=>{const r=o3(n),i=r?n.clientX:n.touches?.[0].clientX,s=r?n.clientY:n.touches?.[0].clientY;return{x:i-(e?.left??0),y:s-(e?.top??0)}},mP=(n,e,r,i,s)=>{const o=e.querySelectorAll(`.${n}`);return!o||!o.length?null:Array.from(o).map(a=>{const c=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),type:n,nodeId:s,position:a.getAttribute("data-handlepos"),x:(c.left-r.left)/i,y:(c.top-r.top)/i,...C1(a)}})};function a3({sourceX:n,sourceY:e,targetX:r,targetY:i,sourceControlX:s,sourceControlY:o,targetControlX:a,targetControlY:c}){const l=n*.125+s*.375+a*.375+r*.125,u=e*.125+o*.375+c*.375+i*.125,d=Math.abs(l-n),h=Math.abs(u-e);return[l,u,d,h]}function Du(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function yP({pos:n,x1:e,y1:r,x2:i,y2:s,c:o}){switch(n){case Ce.Left:return[e-Du(e-i,o),r];case Ce.Right:return[e+Du(i-e,o),r];case Ce.Top:return[e,r-Du(r-s,o)];case Ce.Bottom:return[e,r+Du(s-r,o)]}}function c3({sourceX:n,sourceY:e,sourcePosition:r=Ce.Bottom,targetX:i,targetY:s,targetPosition:o=Ce.Top,curvature:a=.25}){const[c,l]=yP({pos:r,x1:n,y1:e,x2:i,y2:s,c:a}),[u,d]=yP({pos:o,x1:i,y1:s,x2:n,y2:e,c:a}),[h,p,g,y]=a3({sourceX:n,sourceY:e,targetX:i,targetY:s,sourceControlX:c,sourceControlY:l,targetControlX:u,targetControlY:d});return[`M${n},${e} C${c},${l} ${u},${d} ${i},${s}`,h,p,g,y]}function l3({sourceX:n,sourceY:e,targetX:r,targetY:i}){const s=Math.abs(r-n)/2,o=r<n?r+s:r-s,a=Math.abs(i-e)/2,c=i<e?i+a:i-a;return[o,c,s,a]}function EH({sourceNode:n,targetNode:e,selected:r=!1,zIndex:i=0,elevateOnSelect:s=!1,zIndexMode:o="basic"}){if(o==="manual")return i;const a=s&&r?i+1e3:i,c=Math.max(n.parentId||s&&n.selected?n.internals.z:0,e.parentId||s&&e.selected?e.internals.z:0);return a+c}function kH({sourceNode:n,targetNode:e,width:r,height:i,transform:s}){const o=$h(Bd(n),Bd(e));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const a={x:-s[0]/s[2],y:-s[1]/s[2],width:r/s[2],height:i/s[2]};return vl(a,Bh(o))>0}const TH=({source:n,sourceHandle:e,target:r,targetHandle:i})=>`xy-edge__${n}${e||""}-${r}${i||""}`,MH=(n,e)=>e.some(r=>r.source===n.source&&r.target===n.target&&(r.sourceHandle===n.sourceHandle||!r.sourceHandle&&!n.sourceHandle)&&(r.targetHandle===n.targetHandle||!r.targetHandle&&!n.targetHandle)),P1=(n,e,r={})=>{if(!n.source||!n.target)return e;const i=r.getEdgeId||TH;let s;return ZN(n)?s={...n}:s={...n,id:i(n)},MH(s,e)?e:(s.sourceHandle===null&&delete s.sourceHandle,s.targetHandle===null&&delete s.targetHandle,e.concat(s))};function u3({sourceX:n,sourceY:e,targetX:r,targetY:i}){const[s,o,a,c]=l3({sourceX:n,sourceY:e,targetX:r,targetY:i});return[`M ${n},${e}L ${r},${i}`,s,o,a,c]}const vP={[Ce.Left]:{x:-1,y:0},[Ce.Right]:{x:1,y:0},[Ce.Top]:{x:0,y:-1},[Ce.Bottom]:{x:0,y:1}},AH=({source:n,sourcePosition:e=Ce.Bottom,target:r})=>e===Ce.Left||e===Ce.Right?n.x<r.x?{x:1,y:0}:{x:-1,y:0}:n.y<r.y?{x:0,y:1}:{x:0,y:-1},xP=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function jH({source:n,sourcePosition:e=Ce.Bottom,target:r,targetPosition:i=Ce.Top,center:s,offset:o,stepPosition:a}){const c=vP[e],l=vP[i],u={x:n.x+c.x*o,y:n.y+c.y*o},d={x:r.x+l.x*o,y:r.y+l.y*o},h=AH({source:u,sourcePosition:e,target:d}),p=h.x!==0?"x":"y",g=h[p];let y=[],v,x;const m={x:0,y:0},b={x:0,y:0},[,,S,w]=l3({sourceX:n.x,sourceY:n.y,targetX:r.x,targetY:r.y});if(c[p]*l[p]===-1){p==="x"?(v=s.x??u.x+(d.x-u.x)*a,x=s.y??(u.y+d.y)/2):(v=s.x??(u.x+d.x)/2,x=s.y??u.y+(d.y-u.y)*a);const C=[{x:v,y:u.y},{x:v,y:d.y}],_=[{x:u.x,y:x},{x:d.x,y:x}];c[p]===g?y=p==="x"?C:_:y=p==="x"?_:C}else{const C=[{x:u.x,y:d.y}],_=[{x:d.x,y:u.y}];if(p==="x"?y=c.x===g?_:C:y=c.y===g?C:_,e===i){const R=Math.abs(n[p]-r[p]);if(R<=o){const O=Math.min(o-1,o-R);c[p]===g?m[p]=(u[p]>n[p]?-1:1)*O:b[p]=(d[p]>r[p]?-1:1)*O}}if(e!==i){const R=p==="x"?"y":"x",O=c[p]===l[R],j=u[R]>d[R],D=u[R]<d[R];(c[p]===1&&(!O&&j||O&&D)||c[p]!==1&&(!O&&D||O&&j))&&(y=p==="x"?C:_)}const P={x:u.x+m.x,y:u.y+m.y},M={x:d.x+b.x,y:d.y+b.y},T=Math.max(Math.abs(P.x-y[0].x),Math.abs(M.x-y[0].x)),A=Math.max(Math.abs(P.y-y[0].y),Math.abs(M.y-y[0].y));T>=A?(v=(P.x+M.x)/2,x=y[0].y):(v=y[0].x,x=(P.y+M.y)/2)}return[[n,{x:u.x+m.x,y:u.y+m.y},...y,{x:d.x+b.x,y:d.y+b.y},r],v,x,S,w]}function RH(n,e,r,i){const s=Math.min(xP(n,e)/2,xP(e,r)/2,i),{x:o,y:a}=e;if(n.x===o&&o===r.x||n.y===a&&a===r.y)return`L${o} ${a}`;if(n.y===a){const u=n.x<r.x?-1:1,d=n.y<r.y?1:-1;return`L ${o+s*u},${a}Q ${o},${a} ${o},${a+s*d}`}const c=n.x<r.x?1:-1,l=n.y<r.y?-1:1;return`L ${o},${a+s*l}Q ${o},${a} ${o+s*c},${a}`}function rw({sourceX:n,sourceY:e,sourcePosition:r=Ce.Bottom,targetX:i,targetY:s,targetPosition:o=Ce.Top,borderRadius:a=5,centerX:c,centerY:l,offset:u=20,stepPosition:d=.5}){const[h,p,g,y,v]=jH({source:{x:n,y:e},sourcePosition:r,target:{x:i,y:s},targetPosition:o,center:{x:c,y:l},offset:u,stepPosition:d});return[h.reduce((m,b,S)=>{let w="";return S>0&&S<h.length-1?w=RH(h[S-1],b,h[S+1],a):w=`${S===0?"M":"L"}${b.x} ${b.y}`,m+=w,m},""),p,g,y,v]}function bP(n){return n&&!!(n.internals.handleBounds||n.handles?.length)&&!!(n.measured.width||n.width||n.initialWidth)}function OH(n){const{sourceNode:e,targetNode:r}=n;if(!bP(e)||!bP(r))return null;const i=e.internals.handleBounds||SP(e.handles),s=r.internals.handleBounds||SP(r.handles),o=wP(i?.source??[],n.sourceHandle),a=wP(n.connectionMode===Ca.Strict?s?.target??[]:(s?.target??[]).concat(s?.source??[]),n.targetHandle);if(!o||!a)return n.onError?.("008",xi.error008(o?"target":"source",{id:n.id,sourceHandle:n.sourceHandle,targetHandle:n.targetHandle})),null;const c=o?.position||Ce.Bottom,l=a?.position||Ce.Top,u=wo(e,o,c),d=wo(r,a,l);return{sourceX:u.x,sourceY:u.y,targetX:d.x,targetY:d.y,sourcePosition:c,targetPosition:l}}function SP(n){if(!n)return null;const e=[],r=[];for(const i of n)i.width=i.width??1,i.height=i.height??1,i.type==="source"?e.push(i):i.type==="target"&&r.push(i);return{source:e,target:r}}function wo(n,e,r=Ce.Left,i=!1){const s=(e?.x??0)+n.internals.positionAbsolute.x,o=(e?.y??0)+n.internals.positionAbsolute.y,{width:a,height:c}=e??is(n);if(i)return{x:s+a/2,y:o+c/2};switch(e?.position??r){case Ce.Top:return{x:s+a/2,y:o};case Ce.Right:return{x:s+a,y:o+c/2};case Ce.Bottom:return{x:s+a/2,y:o+c};case Ce.Left:return{x:s,y:o+c/2}}}function wP(n,e){return n&&(e?n.find(r=>r.id===e):n[0])||null}function iw(n,e){return n?typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(i=>`${i}=${n[i]}`).join("&")}`:""}function DH(n,{id:e,defaultColor:r,defaultMarkerStart:i,defaultMarkerEnd:s}){const o=new Set;return n.reduce((a,c)=>([c.markerStart||i,c.markerEnd||s].forEach(l=>{if(l&&typeof l=="object"){const u=iw(l,e);o.has(u)||(a.push({id:u,color:l.color||r,...l}),o.add(u))}}),a),[]).sort((a,c)=>a.id.localeCompare(c.id))}const d3=1e3,NH=10,I1={nodeOrigin:[0,0],nodeExtent:ml,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},LH={...I1,checkEquality:!0};function E1(n,e){const r={...n};for(const i in e)e[i]!==void 0&&(r[i]=e[i]);return r}function FH(n,e,r){const i=E1(I1,r);for(const s of n.values())if(s.parentId)T1(s,n,e,i);else{const o=Ul(s,i.nodeOrigin),a=Ea(s.extent)?s.extent:i.nodeExtent,c=So(o,a,is(s));s.internals.positionAbsolute=c}}function zH(n,e){if(!n.handles)return n.measured?e?.internals.handleBounds:void 0;const r=[],i=[];for(const s of n.handles){const o={id:s.id,width:s.width??1,height:s.height??1,nodeId:n.id,x:s.x,y:s.y,position:s.position,type:s.type};s.type==="source"?r.push(o):s.type==="target"&&i.push(o)}return{source:r,target:i}}function k1(n){return n==="manual"}function sw(n,e,r,i={}){const s=E1(LH,i),o={i:0},a=new Map(e),c=s?.elevateNodesOnSelect&&!k1(s.zIndexMode)?d3:0;let l=n.length>0;e.clear(),r.clear();for(const u of n){let d=a.get(u.id);if(s.checkEquality&&u===d?.internals.userNode)e.set(u.id,d);else{const h=Ul(u,s.nodeOrigin),p=Ea(u.extent)?u.extent:s.nodeExtent,g=So(h,p,is(u));d={...s.defaults,...u,measured:{width:u.measured?.width,height:u.measured?.height},internals:{positionAbsolute:g,handleBounds:zH(u,d),z:h3(u,c,s.zIndexMode),userNode:u}},e.set(u.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(l=!1),u.parentId&&T1(d,e,r,i,o)}return l}function $H(n,e){if(!n.parentId)return;const r=e.get(n.parentId);r?r.set(n.id,n):e.set(n.parentId,new Map([[n.id,n]]))}function T1(n,e,r,i,s){const{elevateNodesOnSelect:o,nodeOrigin:a,nodeExtent:c,zIndexMode:l}=E1(I1,i),u=n.parentId,d=e.get(u);if(!d){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}$H(n,r),s&&!d.parentId&&d.internals.rootParentIndex===void 0&&l==="auto"&&(d.internals.rootParentIndex=++s.i,d.internals.z=d.internals.z+s.i*NH),s&&d.internals.rootParentIndex!==void 0&&(s.i=d.internals.rootParentIndex);const h=o&&!k1(l)?d3:0,{x:p,y:g,z:y}=BH(n,d,a,c,h,l),{positionAbsolute:v}=n.internals,x=p!==v.x||g!==v.y;(x||y!==n.internals.z)&&e.set(n.id,{...n,internals:{...n.internals,positionAbsolute:x?{x:p,y:g}:v,z:y}})}function h3(n,e,r){const i=Gr(n.zIndex)?n.zIndex:0;return k1(r)?i:i+(n.selected?e:0)}function BH(n,e,r,i,s,o){const{x:a,y:c}=e.internals.positionAbsolute,l=is(n),u=Ul(n,r),d=Ea(n.extent)?So(u,n.extent,l):u;let h=So({x:a+d.x,y:c+d.y},i,l);n.extent==="parent"&&(h=JN(h,l,e));const p=h3(n,s,o),g=e.internals.z??0;return{x:h.x,y:h.y,z:g>=p?g+1:p}}function M1(n,e,r,i=[0,0]){const s=[],o=new Map;for(const a of n){const c=e.get(a.parentId);if(!c)continue;const l=o.get(a.parentId)?.expandedRect??Ia(c),u=t3(l,a.rect);o.set(a.parentId,{expandedRect:u,parent:c})}return o.size>0&&o.forEach(({expandedRect:a,parent:c},l)=>{const u=c.internals.positionAbsolute,d=is(c),h=c.origin??i,p=a.x<u.x?Math.round(Math.abs(u.x-a.x)):0,g=a.y<u.y?Math.round(Math.abs(u.y-a.y)):0,y=Math.max(d.width,Math.round(a.width)),v=Math.max(d.height,Math.round(a.height)),x=(y-d.width)*h[0],m=(v-d.height)*h[1];(p>0||g>0||x||m)&&(s.push({id:l,type:"position",position:{x:c.position.x-p+x,y:c.position.y-g+m}}),r.get(l)?.forEach(b=>{n.some(S=>S.id===b.id)||s.push({id:b.id,type:"position",position:{x:b.position.x+p,y:b.position.y+g}})})),(d.width<a.width||d.height<a.height||p||g)&&s.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:y+(p?h[0]*p-x:0),height:v+(g?h[1]*g-m:0)}})}),s}function UH(n,e,r,i,s,o,a){const c=i?.querySelector(".xyflow__viewport");let l=!1;if(!c)return{changes:[],updatedInternals:l};const u=[],d=window.getComputedStyle(c),{m22:h}=new window.DOMMatrixReadOnly(d.transform),p=[];for(const g of n.values()){const y=e.get(g.id);if(!y)continue;if(y.hidden){e.set(y.id,{...y,internals:{...y.internals,handleBounds:void 0}}),l=!0;continue}const v=C1(g.nodeElement),x=y.measured.width!==v.width||y.measured.height!==v.height;if(!!(v.width&&v.height&&(x||!y.internals.handleBounds||g.force))){const b=g.nodeElement.getBoundingClientRect(),S=Ea(y.extent)?y.extent:o;let{positionAbsolute:w}=y.internals;y.parentId&&y.extent==="parent"?w=JN(w,v,e.get(y.parentId)):S&&(w=So(w,S,v));const I={...y,measured:v,internals:{...y.internals,positionAbsolute:w,handleBounds:{source:mP("source",g.nodeElement,b,h,y.id),target:mP("target",g.nodeElement,b,h,y.id)}}};e.set(y.id,I),y.parentId&&T1(I,e,r,{nodeOrigin:s,zIndexMode:a}),l=!0,x&&(u.push({id:y.id,type:"dimensions",dimensions:v}),y.expandParent&&y.parentId&&p.push({id:y.id,parentId:y.parentId,rect:Ia(I,s)}))}}if(p.length>0){const g=M1(p,e,r,s);u.push(...g)}return{changes:u,updatedInternals:l}}async function qH({delta:n,panZoom:e,transform:r,translateExtent:i,width:s,height:o}){if(!e||!n.x&&!n.y)return Promise.resolve(!1);const a=await e.setViewportConstrained({x:r[0]+n.x,y:r[1]+n.y,zoom:r[2]},[[0,0],[s,o]],i),c=!!a&&(a.x!==r[0]||a.y!==r[1]||a.k!==r[2]);return Promise.resolve(c)}function _P(n,e,r,i,s,o){let a=s;const c=i.get(a)||new Map;i.set(a,c.set(r,e)),a=`${s}-${n}`;const l=i.get(a)||new Map;if(i.set(a,l.set(r,e)),o){a=`${s}-${n}-${o}`;const u=i.get(a)||new Map;i.set(a,u.set(r,e))}}function f3(n,e,r){n.clear(),e.clear();for(const i of r){const{source:s,target:o,sourceHandle:a=null,targetHandle:c=null}=i,l={edgeId:i.id,source:s,target:o,sourceHandle:a,targetHandle:c},u=`${s}-${a}--${o}-${c}`,d=`${o}-${c}--${s}-${a}`;_P("source",l,d,n,s,a),_P("target",l,u,n,o,c),e.set(i.id,i)}}function p3(n,e){if(!n.parentId)return!1;const r=e.get(n.parentId);return r?r.selected?!0:p3(r,e):!1}function CP(n,e,r){let i=n;do{if(i?.matches?.(e))return!0;if(i===r)return!1;i=i?.parentElement}while(i);return!1}function HH(n,e,r,i){const s=new Map;for(const[o,a]of n)if((a.selected||a.id===i)&&(!a.parentId||!p3(a,n))&&(a.draggable||e&&typeof a.draggable>"u")){const c=n.get(o);c&&s.set(o,{id:o,position:c.position||{x:0,y:0},distance:{x:r.x-c.internals.positionAbsolute.x,y:r.y-c.internals.positionAbsolute.y},extent:c.extent,parentId:c.parentId,origin:c.origin,expandParent:c.expandParent,internals:{positionAbsolute:c.internals.positionAbsolute||{x:0,y:0}},measured:{width:c.measured.width??0,height:c.measured.height??0}})}return s}function Ap({nodeId:n,dragItems:e,nodeLookup:r,dragging:i=!0}){const s=[];for(const[a,c]of e){const l=r.get(a)?.internals.userNode;l&&s.push({...l,position:c.position,dragging:i})}if(!n)return[s[0],s];const o=r.get(n)?.internals.userNode;return[o?{...o,position:e.get(n)?.position||o.position,dragging:i}:s[0],s]}function GH({dragItems:n,snapGrid:e,x:r,y:i}){const s=n.values().next().value;if(!s)return null;const o={x:r-s.distance.x,y:i-s.distance.y},a=Hl(o,e);return{x:a.x-o.x,y:a.y-o.y}}function KH({onNodeMouseDown:n,getStoreItems:e,onDragStart:r,onDrag:i,onDragStop:s}){let o={x:null,y:null},a=0,c=new Map,l=!1,u={x:0,y:0},d=null,h=!1,p=null,g=!1,y=!1,v=null;function x({noDragClassName:b,handleSelector:S,domNode:w,isSelectable:I,nodeId:C,nodeClickDistance:_=0}){p=xn(w);function P({x:R,y:O}){const{nodeLookup:j,nodeExtent:D,snapGrid:N,snapToGrid:F,nodeOrigin:z,onNodeDrag:$,onSelectionDrag:G,onError:X,updateNodePositions:ee}=e();o={x:R,y:O};let re=!1;const B=c.size>1,U=B&&D?nw(ql(c)):null,Q=B&&F?GH({dragItems:c,snapGrid:N,x:R,y:O}):null;for(const[K,Y]of c){if(!j.has(K))continue;let V={x:R-Y.distance.x,y:O-Y.distance.y};F&&(V=Q?{x:Math.round(V.x+Q.x),y:Math.round(V.y+Q.y)}:Hl(V,N));let ie=null;if(B&&D&&!Y.extent&&U){const{positionAbsolute:he}=Y.internals,xe=he.x-U.x+D[0][0],fe=he.x+Y.measured.width-U.x2+D[1][0],me=he.y-U.y+D[0][1],we=he.y+Y.measured.height-U.y2+D[1][1];ie=[[xe,me],[fe,we]]}const{position:ae,positionAbsolute:ye}=QN({nodeId:K,nextPosition:V,nodeLookup:j,nodeExtent:ie||D,nodeOrigin:z,onError:X});re=re||Y.position.x!==ae.x||Y.position.y!==ae.y,Y.position=ae,Y.internals.positionAbsolute=ye}if(y=y||re,!!re&&(ee(c,!0),v&&(i||$||!C&&G))){const[K,Y]=Ap({nodeId:C,dragItems:c,nodeLookup:j});i?.(v,c,K,Y),$?.(v,K,Y),C||G?.(v,Y)}}async function M(){if(!d)return;const{transform:R,panBy:O,autoPanSpeed:j,autoPanOnNodeDrag:D}=e();if(!D){l=!1,cancelAnimationFrame(a);return}const[N,F]=e3(u,d,j);(N!==0||F!==0)&&(o.x=(o.x??0)-N/R[2],o.y=(o.y??0)-F/R[2],await O({x:N,y:F})&&P(o)),a=requestAnimationFrame(M)}function T(R){const{nodeLookup:O,multiSelectionActive:j,nodesDraggable:D,transform:N,snapGrid:F,snapToGrid:z,selectNodesOnDrag:$,onNodeDragStart:G,onSelectionDragStart:X,unselectNodesAndEdges:ee}=e();h=!0,(!$||!I)&&!j&&C&&(O.get(C)?.selected||ee()),I&&$&&C&&n?.(C);const re=Qc(R.sourceEvent,{transform:N,snapGrid:F,snapToGrid:z,containerBounds:d});if(o=re,c=HH(O,D,re,C),c.size>0&&(r||G||!C&&X)){const[B,U]=Ap({nodeId:C,dragItems:c,nodeLookup:O});r?.(R.sourceEvent,c,B,U),G?.(R.sourceEvent,B,U),C||X?.(R.sourceEvent,U)}}const A=f1().clickDistance(_).on("start",R=>{const{domNode:O,nodeDragThreshold:j,transform:D,snapGrid:N,snapToGrid:F}=e();d=O?.getBoundingClientRect()||null,g=!1,y=!1,v=R.sourceEvent,j===0&&T(R),o=Qc(R.sourceEvent,{transform:D,snapGrid:N,snapToGrid:F,containerBounds:d}),u=Kr(R.sourceEvent,d)}).on("drag",R=>{const{autoPanOnNodeDrag:O,transform:j,snapGrid:D,snapToGrid:N,nodeDragThreshold:F,nodeLookup:z}=e(),$=Qc(R.sourceEvent,{transform:j,snapGrid:D,snapToGrid:N,containerBounds:d});if(v=R.sourceEvent,(R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1||C&&!z.has(C))&&(g=!0),!g){if(!l&&O&&h&&(l=!0,M()),!h){const G=Kr(R.sourceEvent,d),X=G.x-u.x,ee=G.y-u.y;Math.sqrt(X*X+ee*ee)>F&&T(R)}(o.x!==$.xSnapped||o.y!==$.ySnapped)&&c&&h&&(u=Kr(R.sourceEvent,d),P($))}}).on("end",R=>{if(!(!h||g)&&(l=!1,h=!1,cancelAnimationFrame(a),c.size>0)){const{nodeLookup:O,updateNodePositions:j,onNodeDragStop:D,onSelectionDragStop:N}=e();if(y&&(j(c,!1),y=!1),s||D||!C&&N){const[F,z]=Ap({nodeId:C,dragItems:c,nodeLookup:O,dragging:!1});s?.(R.sourceEvent,c,F,z),D?.(R.sourceEvent,F,z),C||N?.(R.sourceEvent,z)}}}).filter(R=>{const O=R.target;return!R.button&&(!b||!CP(O,`.${b}`,w))&&(!S||CP(O,S,w))});p.call(A)}function m(){p?.on(".drag",null)}return{update:x,destroy:m}}function VH(n,e,r){const i=[],s={x:n.x-r,y:n.y-r,width:r*2,height:r*2};for(const o of e.values())vl(s,Ia(o))>0&&i.push(o);return i}const WH=250;function YH(n,e,r,i){let s=[],o=1/0;const a=VH(n,r,e+WH);for(const c of a){const l=[...c.internals.handleBounds?.source??[],...c.internals.handleBounds?.target??[]];for(const u of l){if(i.nodeId===u.nodeId&&i.type===u.type&&i.id===u.id)continue;const{x:d,y:h}=wo(c,u,u.position,!0),p=Math.sqrt(Math.pow(d-n.x,2)+Math.pow(h-n.y,2));p>e||(p<o?(s=[{...u,x:d,y:h}],o=p):p===o&&s.push({...u,x:d,y:h}))}}if(!s.length)return null;if(s.length>1){const c=i.type==="source"?"target":"source";return s.find(l=>l.type===c)??s[0]}return s[0]}function g3(n,e,r,i,s,o=!1){const a=i.get(n);if(!a)return null;const c=s==="strict"?a.internals.handleBounds?.[e]:[...a.internals.handleBounds?.source??[],...a.internals.handleBounds?.target??[]],l=(r?c?.find(u=>u.id===r):c?.[0])??null;return l&&o?{...l,...wo(a,l,l.position,!0)}:l}function m3(n,e){return n||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function XH(n,e){let r=null;return e?r=!0:n&&!e&&(r=!1),r}const y3=()=>!0;function ZH(n,{connectionMode:e,connectionRadius:r,handleId:i,nodeId:s,edgeUpdaterType:o,isTarget:a,domNode:c,nodeLookup:l,lib:u,autoPanOnConnect:d,flowId:h,panBy:p,cancelConnection:g,onConnectStart:y,onConnect:v,onConnectEnd:x,isValidConnection:m=y3,onReconnectEnd:b,updateConnection:S,getTransform:w,getFromHandle:I,autoPanSpeed:C,dragThreshold:_=1,handleDomNode:P}){const M=i3(n.target);let T=0,A;const{x:R,y:O}=Kr(n),j=m3(o,P),D=c?.getBoundingClientRect();let N=!1;if(!D||!j)return;const F=g3(s,j,i,l,e);if(!F)return;let z=Kr(n,D),$=!1,G=null,X=!1,ee=null;function re(){if(!d||!D)return;const[ae,ye]=e3(z,D,C);p({x:ae,y:ye}),T=requestAnimationFrame(re)}const B={...F,nodeId:s,type:j,position:F.position},U=l.get(s);let K={inProgress:!0,isValid:null,from:wo(U,B,Ce.Left,!0),fromHandle:B,fromPosition:B.position,fromNode:U,to:z,toHandle:null,toPosition:hP[B.position],toNode:null,pointer:z};function Y(){N=!0,S(K),y?.(n,{nodeId:s,handleId:i,handleType:j})}_===0&&Y();function V(ae){if(!N){const{x:we,y:st}=Kr(ae),lt=we-R,Ut=st-O;if(!(lt*lt+Ut*Ut>_*_))return;Y()}if(!I()||!B){ie(ae);return}const ye=w();z=Kr(ae,D),A=YH(Gl(z,ye,!1,[1,1]),r,l,B),$||(re(),$=!0);const he=v3(ae,{handle:A,connectionMode:e,fromNodeId:s,fromHandleId:i,fromType:a?"target":"source",isValidConnection:m,doc:M,lib:u,flowId:h,nodeLookup:l});ee=he.handleDomNode,G=he.connection,X=XH(!!A,he.isValid);const xe=l.get(s),fe=xe?wo(xe,B,Ce.Left,!0):K.from,me={...K,from:fe,isValid:X,to:he.toHandle&&X?Ud({x:he.toHandle.x,y:he.toHandle.y},ye):z,toHandle:he.toHandle,toPosition:X&&he.toHandle?he.toHandle.position:hP[B.position],toNode:he.toHandle?l.get(he.toHandle.nodeId):null,pointer:z};S(me),K=me}function ie(ae){if(!("touches"in ae&&ae.touches.length>0)){if(N){(A||ee)&&G&&X&&v?.(G);const{inProgress:ye,...he}=K,xe={...he,toPosition:K.toHandle?K.toPosition:null};x?.(ae,xe),o&&b?.(ae,xe)}g(),cancelAnimationFrame(T),$=!1,X=!1,G=null,ee=null,M.removeEventListener("mousemove",V),M.removeEventListener("mouseup",ie),M.removeEventListener("touchmove",V),M.removeEventListener("touchend",ie)}}M.addEventListener("mousemove",V),M.addEventListener("mouseup",ie),M.addEventListener("touchmove",V),M.addEventListener("touchend",ie)}function v3(n,{handle:e,connectionMode:r,fromNodeId:i,fromHandleId:s,fromType:o,doc:a,lib:c,flowId:l,isValidConnection:u=y3,nodeLookup:d}){const h=o==="target",p=e?a.querySelector(`.${c}-flow__handle[data-id="${l}-${e?.nodeId}-${e?.id}-${e?.type}"]`):null,{x:g,y}=Kr(n),v=a.elementFromPoint(g,y),x=v?.classList.contains(`${c}-flow__handle`)?v:p,m={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const b=m3(void 0,x),S=x.getAttribute("data-nodeid"),w=x.getAttribute("data-handleid"),I=x.classList.contains("connectable"),C=x.classList.contains("connectableend");if(!S||!b)return m;const _={source:h?S:i,sourceHandle:h?w:s,target:h?i:S,targetHandle:h?s:w};m.connection=_;const M=I&&C&&(r===Ca.Strict?h&&b==="source"||!h&&b==="target":S!==i||w!==s);m.isValid=M&&u(_),m.toHandle=g3(S,b,w,d,r,!0)}return m}const ow={onPointerDown:ZH,isValid:v3};function QH({domNode:n,panZoom:e,getTransform:r,getViewScale:i}){const s=xn(n);function o({translateExtent:c,width:l,height:u,zoomStep:d=1,pannable:h=!0,zoomable:p=!0,inversePan:g=!1}){const y=S=>{if(S.sourceEvent.type!=="wheel"||!e)return;const w=r(),I=S.sourceEvent.ctrlKey&&xl()?10:1,C=-S.sourceEvent.deltaY*(S.sourceEvent.deltaMode===1?.05:S.sourceEvent.deltaMode?1:.002)*d,_=w[2]*Math.pow(2,C*I);e.scaleTo(_)};let v=[0,0];const x=S=>{(S.sourceEvent.type==="mousedown"||S.sourceEvent.type==="touchstart")&&(v=[S.sourceEvent.clientX??S.sourceEvent.touches[0].clientX,S.sourceEvent.clientY??S.sourceEvent.touches[0].clientY])},m=S=>{const w=r();if(S.sourceEvent.type!=="mousemove"&&S.sourceEvent.type!=="touchmove"||!e)return;const I=[S.sourceEvent.clientX??S.sourceEvent.touches[0].clientX,S.sourceEvent.clientY??S.sourceEvent.touches[0].clientY],C=[I[0]-v[0],I[1]-v[1]];v=I;const _=i()*Math.max(w[2],Math.log(w[2]))*(g?-1:1),P={x:w[0]-C[0]*_,y:w[1]-C[1]*_},M=[[0,0],[l,u]];e.setViewportConstrained({x:P.x,y:P.y,zoom:w[2]},M,c)},b=b1().on("start",x).on("zoom",h?m:null).on("zoom.wheel",p?y:null);s.call(b,{})}function a(){s.on("zoom",null)}return{update:o,destroy:a,pointer:Sr}}const Uh=n=>({x:n.x,y:n.y,zoom:n.k}),jp=({x:n,y:e,zoom:r})=>zh.translate(n,e).scale(r),oa=(n,e)=>n.target.closest(`.${e}`),x3=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),JH=n=>((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2,Rp=(n,e=0,r=JH,i=()=>{})=>{const s=typeof e=="number"&&e>0;return s||i(),s?n.transition().duration(e).ease(r).on("end",i):n},b3=n=>{const e=n.ctrlKey&&xl()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e};function eG({zoomPanValues:n,noWheelClassName:e,d3Selection:r,d3Zoom:i,panOnScrollMode:s,panOnScrollSpeed:o,zoomOnPinch:a,onPanZoomStart:c,onPanZoom:l,onPanZoomEnd:u}){return d=>{if(oa(d,e))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const h=r.property("__zoom").k||1;if(d.ctrlKey&&a){const x=Sr(d),m=b3(d),b=h*Math.pow(2,m);i.scaleTo(r,b,x,d);return}const p=d.deltaMode===1?20:1;let g=s===po.Vertical?0:d.deltaX*p,y=s===po.Horizontal?0:d.deltaY*p;!xl()&&d.shiftKey&&s!==po.Vertical&&(g=d.deltaY*p,y=0),i.translateBy(r,-(g/h)*o,-(y/h)*o,{internal:!0});const v=Uh(r.property("__zoom"));clearTimeout(n.panScrollTimeout),n.isPanScrolling?(l?.(d,v),n.panScrollTimeout=setTimeout(()=>{u?.(d,v),n.isPanScrolling=!1},150)):(n.isPanScrolling=!0,c?.(d,v))}}function tG({noWheelClassName:n,preventScrolling:e,d3ZoomHandler:r}){return function(i,s){const o=i.type==="wheel",a=!e&&o&&!i.ctrlKey,c=oa(i,n);if(i.ctrlKey&&o&&c&&i.preventDefault(),a||c)return null;i.preventDefault(),r.call(this,i,s)}}function nG({zoomPanValues:n,onDraggingChange:e,onPanZoomStart:r}){return i=>{if(i.sourceEvent?.internal)return;const s=Uh(i.transform);n.mouseButton=i.sourceEvent?.button||0,n.isZoomingOrPanning=!0,n.prevViewport=s,i.sourceEvent?.type==="mousedown"&&e(!0),r&&r?.(i.sourceEvent,s)}}function rG({zoomPanValues:n,panOnDrag:e,onPaneContextMenu:r,onTransformChange:i,onPanZoom:s}){return o=>{n.usedRightMouseButton=!!(r&&x3(e,n.mouseButton??0)),o.sourceEvent?.sync||i([o.transform.x,o.transform.y,o.transform.k]),s&&!o.sourceEvent?.internal&&s?.(o.sourceEvent,Uh(o.transform))}}function iG({zoomPanValues:n,panOnDrag:e,panOnScroll:r,onDraggingChange:i,onPanZoomEnd:s,onPaneContextMenu:o}){return a=>{if(!a.sourceEvent?.internal&&(n.isZoomingOrPanning=!1,o&&x3(e,n.mouseButton??0)&&!n.usedRightMouseButton&&a.sourceEvent&&o(a.sourceEvent),n.usedRightMouseButton=!1,i(!1),s)){const c=Uh(a.transform);n.prevViewport=c,clearTimeout(n.timerId),n.timerId=setTimeout(()=>{s?.(a.sourceEvent,c)},r?150:0)}}}function sG({zoomActivationKeyPressed:n,zoomOnScroll:e,zoomOnPinch:r,panOnDrag:i,panOnScroll:s,zoomOnDoubleClick:o,userSelectionActive:a,noWheelClassName:c,noPanClassName:l,lib:u,connectionInProgress:d}){return h=>{const p=n||e,g=r&&h.ctrlKey,y=h.type==="wheel";if(h.button===1&&h.type==="mousedown"&&(oa(h,`${u}-flow__node`)||oa(h,`${u}-flow__edge`)))return!0;if(!i&&!p&&!s&&!o&&!r||a||d&&!y||oa(h,c)&&y||oa(h,l)&&(!y||s&&y&&!n)||!r&&h.ctrlKey&&y)return!1;if(!r&&h.type==="touchstart"&&h.touches?.length>1)return h.preventDefault(),!1;if(!p&&!s&&!g&&y||!i&&(h.type==="mousedown"||h.type==="touchstart")||Array.isArray(i)&&!i.includes(h.button)&&h.type==="mousedown")return!1;const v=Array.isArray(i)&&i.includes(h.button)||!h.button||h.button<=1;return(!h.ctrlKey||y)&&v}}function oG({domNode:n,minZoom:e,maxZoom:r,translateExtent:i,viewport:s,onPanZoom:o,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=n.getBoundingClientRect(),h=b1().scaleExtent([e,r]).translateExtent(i),p=xn(n).call(h);b({x:s.x,y:s.y,zoom:Pa(s.zoom,e,r)},[[0,0],[d.width,d.height]],i);const g=p.on("wheel.zoom"),y=p.on("dblclick.zoom");h.wheelDelta(b3);function v(A,R){return p?new Promise(O=>{h?.interpolate(R?.interpolate==="linear"?Zc:xd).transform(Rp(p,R?.duration,R?.ease,()=>O(!0)),A)}):Promise.resolve(!1)}function x({noWheelClassName:A,noPanClassName:R,onPaneContextMenu:O,userSelectionActive:j,panOnScroll:D,panOnDrag:N,panOnScrollMode:F,panOnScrollSpeed:z,preventScrolling:$,zoomOnPinch:G,zoomOnScroll:X,zoomOnDoubleClick:ee,zoomActivationKeyPressed:re,lib:B,onTransformChange:U,connectionInProgress:Q,paneClickDistance:K,selectionOnDrag:Y}){j&&!u.isZoomingOrPanning&&m();const V=D&&!re&&!j;h.clickDistance(Y?1/0:!Gr(K)||K<0?0:K);const ie=V?eG({zoomPanValues:u,noWheelClassName:A,d3Selection:p,d3Zoom:h,panOnScrollMode:F,panOnScrollSpeed:z,zoomOnPinch:G,onPanZoomStart:a,onPanZoom:o,onPanZoomEnd:c}):tG({noWheelClassName:A,preventScrolling:$,d3ZoomHandler:g});if(p.on("wheel.zoom",ie,{passive:!1}),!j){const ye=nG({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:a});h.on("start",ye);const he=rG({zoomPanValues:u,panOnDrag:N,onPaneContextMenu:!!O,onPanZoom:o,onTransformChange:U});h.on("zoom",he);const xe=iG({zoomPanValues:u,panOnDrag:N,panOnScroll:D,onPaneContextMenu:O,onPanZoomEnd:c,onDraggingChange:l});h.on("end",xe)}const ae=sG({zoomActivationKeyPressed:re,panOnDrag:N,zoomOnScroll:X,panOnScroll:D,zoomOnDoubleClick:ee,zoomOnPinch:G,userSelectionActive:j,noPanClassName:R,noWheelClassName:A,lib:B,connectionInProgress:Q});h.filter(ae),ee?p.on("dblclick.zoom",y):p.on("dblclick.zoom",null)}function m(){h.on("zoom",null)}async function b(A,R,O){const j=jp(A),D=h?.constrain()(j,R,O);return D&&await v(D),new Promise(N=>N(D))}async function S(A,R){const O=jp(A);return await v(O,R),new Promise(j=>j(O))}function w(A){if(p){const R=jp(A),O=p.property("__zoom");(O.k!==A.zoom||O.x!==A.x||O.y!==A.y)&&h?.transform(p,R,null,{sync:!0})}}function I(){const A=p?Br(p.node()):{x:0,y:0,k:1};return{x:A.x,y:A.y,zoom:A.k}}function C(A,R){return p?new Promise(O=>{h?.interpolate(R?.interpolate==="linear"?Zc:xd).scaleTo(Rp(p,R?.duration,R?.ease,()=>O(!0)),A)}):Promise.resolve(!1)}function _(A,R){return p?new Promise(O=>{h?.interpolate(R?.interpolate==="linear"?Zc:xd).scaleBy(Rp(p,R?.duration,R?.ease,()=>O(!0)),A)}):Promise.resolve(!1)}function P(A){h?.scaleExtent(A)}function M(A){h?.translateExtent(A)}function T(A){const R=!Gr(A)||A<0?0:A;h?.clickDistance(R)}return{update:x,destroy:m,setViewport:S,setViewportConstrained:b,getViewport:I,scaleTo:C,scaleBy:_,setScaleExtent:P,setTranslateExtent:M,syncViewport:w,setClickDistance:T}}var _o;(function(n){n.Line="line",n.Handle="handle"})(_o||(_o={}));const aG=["top-left","top-right","bottom-left","bottom-right"],cG=["top","right","bottom","left"];function lG({width:n,prevWidth:e,height:r,prevHeight:i,affectsX:s,affectsY:o}){const a=n-e,c=r-i,l=[a>0?1:a<0?-1:0,c>0?1:c<0?-1:0];return a&&s&&(l[0]=l[0]*-1),c&&o&&(l[1]=l[1]*-1),l}function PP(n){const e=n.includes("right")||n.includes("left"),r=n.includes("bottom")||n.includes("top"),i=n.includes("left"),s=n.includes("top");return{isHorizontal:e,isVertical:r,affectsX:i,affectsY:s}}function vs(n,e){return Math.max(0,e-n)}function xs(n,e){return Math.max(0,n-e)}function Nu(n,e,r){return Math.max(0,e-n,n-r)}function IP(n,e){return n?!e:e}function uG(n,e,r,i,s,o,a,c){let{affectsX:l,affectsY:u}=e;const{isHorizontal:d,isVertical:h}=e,p=d&&h,{xSnapped:g,ySnapped:y}=r,{minWidth:v,maxWidth:x,minHeight:m,maxHeight:b}=i,{x:S,y:w,width:I,height:C,aspectRatio:_}=n;let P=Math.floor(d?g-n.pointerX:0),M=Math.floor(h?y-n.pointerY:0);const T=I+(l?-P:P),A=C+(u?-M:M),R=-o[0]*I,O=-o[1]*C;let j=Nu(T,v,x),D=Nu(A,m,b);if(a){let z=0,$=0;l&&P<0?z=vs(S+P+R,a[0][0]):!l&&P>0&&(z=xs(S+T+R,a[1][0])),u&&M<0?$=vs(w+M+O,a[0][1]):!u&&M>0&&($=xs(w+A+O,a[1][1])),j=Math.max(j,z),D=Math.max(D,$)}if(c){let z=0,$=0;l&&P>0?z=xs(S+P,c[0][0]):!l&&P<0&&(z=vs(S+T,c[1][0])),u&&M>0?$=xs(w+M,c[0][1]):!u&&M<0&&($=vs(w+A,c[1][1])),j=Math.max(j,z),D=Math.max(D,$)}if(s){if(d){const z=Nu(T/_,m,b)*_;if(j=Math.max(j,z),a){let $=0;!l&&!u||l&&!u&&p?$=xs(w+O+T/_,a[1][1])*_:$=vs(w+O+(l?P:-P)/_,a[0][1])*_,j=Math.max(j,$)}if(c){let $=0;!l&&!u||l&&!u&&p?$=vs(w+T/_,c[1][1])*_:$=xs(w+(l?P:-P)/_,c[0][1])*_,j=Math.max(j,$)}}if(h){const z=Nu(A*_,v,x)/_;if(D=Math.max(D,z),a){let $=0;!l&&!u||u&&!l&&p?$=xs(S+A*_+R,a[1][0])/_:$=vs(S+(u?M:-M)*_+R,a[0][0])/_,D=Math.max(D,$)}if(c){let $=0;!l&&!u||u&&!l&&p?$=vs(S+A*_,c[1][0])/_:$=xs(S+(u?M:-M)*_,c[0][0])/_,D=Math.max(D,$)}}}M=M+(M<0?D:-D),P=P+(P<0?j:-j),s&&(p?T>A*_?M=(IP(l,u)?-P:P)/_:P=(IP(l,u)?-M:M)*_:d?(M=P/_,u=l):(P=M*_,l=u));const N=l?S+P:S,F=u?w+M:w;return{width:I+(l?-P:P),height:C+(u?-M:M),x:o[0]*P*(l?-1:1)+N,y:o[1]*M*(u?-1:1)+F}}const S3={width:0,height:0,x:0,y:0},dG={...S3,pointerX:0,pointerY:0,aspectRatio:1};function hG(n){return[[0,0],[n.measured.width,n.measured.height]]}function fG(n,e,r){const i=e.position.x+n.position.x,s=e.position.y+n.position.y,o=n.measured.width??0,a=n.measured.height??0,c=r[0]*o,l=r[1]*a;return[[i-c,s-l],[i+o-c,s+a-l]]}function pG({domNode:n,nodeId:e,getStoreItems:r,onChange:i,onEnd:s}){const o=xn(n);let a={controlDirection:PP("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function c({controlPosition:u,boundaries:d,keepAspectRatio:h,resizeDirection:p,onResizeStart:g,onResize:y,onResizeEnd:v,shouldResize:x}){let m={...S3},b={...dG};a={boundaries:d,resizeDirection:p,keepAspectRatio:h,controlDirection:PP(u)};let S,w=null,I=[],C,_,P,M=!1;const T=f1().on("start",A=>{const{nodeLookup:R,transform:O,snapGrid:j,snapToGrid:D,nodeOrigin:N,paneDomNode:F}=r();if(S=R.get(e),!S)return;w=F?.getBoundingClientRect()??null;const{xSnapped:z,ySnapped:$}=Qc(A.sourceEvent,{transform:O,snapGrid:j,snapToGrid:D,containerBounds:w});m={width:S.measured.width??0,height:S.measured.height??0,x:S.position.x??0,y:S.position.y??0},b={...m,pointerX:z,pointerY:$,aspectRatio:m.width/m.height},C=void 0,S.parentId&&(S.extent==="parent"||S.expandParent)&&(C=R.get(S.parentId),_=C&&S.extent==="parent"?hG(C):void 0),I=[],P=void 0;for(const[G,X]of R)if(X.parentId===e&&(I.push({id:G,position:{...X.position},extent:X.extent}),X.extent==="parent"||X.expandParent)){const ee=fG(X,S,X.origin??N);P?P=[[Math.min(ee[0][0],P[0][0]),Math.min(ee[0][1],P[0][1])],[Math.max(ee[1][0],P[1][0]),Math.max(ee[1][1],P[1][1])]]:P=ee}g?.(A,{...m})}).on("drag",A=>{const{transform:R,snapGrid:O,snapToGrid:j,nodeOrigin:D}=r(),N=Qc(A.sourceEvent,{transform:R,snapGrid:O,snapToGrid:j,containerBounds:w}),F=[];if(!S)return;const{x:z,y:$,width:G,height:X}=m,ee={},re=S.origin??D,{width:B,height:U,x:Q,y:K}=uG(b,a.controlDirection,N,a.boundaries,a.keepAspectRatio,re,_,P),Y=B!==G,V=U!==X,ie=Q!==z&&Y,ae=K!==$&&V;if(!ie&&!ae&&!Y&&!V)return;if((ie||ae||re[0]===1||re[1]===1)&&(ee.x=ie?Q:m.x,ee.y=ae?K:m.y,m.x=ee.x,m.y=ee.y,I.length>0)){const fe=Q-z,me=K-$;for(const we of I)we.position={x:we.position.x-fe+re[0]*(B-G),y:we.position.y-me+re[1]*(U-X)},F.push(we)}if((Y||V)&&(ee.width=Y&&(!a.resizeDirection||a.resizeDirection==="horizontal")?B:m.width,ee.height=V&&(!a.resizeDirection||a.resizeDirection==="vertical")?U:m.height,m.width=ee.width,m.height=ee.height),C&&S.expandParent){const fe=re[0]*(ee.width??0);ee.x&&ee.x<fe&&(m.x=fe,b.x=b.x-(ee.x-fe));const me=re[1]*(ee.height??0);ee.y&&ee.y<me&&(m.y=me,b.y=b.y-(ee.y-me))}const ye=lG({width:m.width,prevWidth:G,height:m.height,prevHeight:X,affectsX:a.controlDirection.affectsX,affectsY:a.controlDirection.affectsY}),he={...m,direction:ye};x?.(A,he)!==!1&&(M=!0,y?.(A,he),i(ee,F))}).on("end",A=>{M&&(v?.(A,{...m}),s?.({...m}),M=!1)});o.call(T)}function l(){o.on(".drag",null)}return{update:c,destroy:l}}var Op={exports:{}},Dp={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EP;function gG(){if(EP)return Dp;EP=1;var n=UB(),e=qB();function r(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var i=typeof Object.is=="function"?Object.is:r,s=e.useSyncExternalStore,o=n.useRef,a=n.useEffect,c=n.useMemo,l=n.useDebugValue;return Dp.useSyncExternalStoreWithSelector=function(u,d,h,p,g){var y=o(null);if(y.current===null){var v={hasValue:!1,value:null};y.current=v}else v=y.current;y=c(function(){function m(C){if(!b){if(b=!0,S=C,C=p(C),g!==void 0&&v.hasValue){var _=v.value;if(g(_,C))return w=_}return w=C}if(_=w,i(S,C))return _;var P=p(C);return g!==void 0&&g(_,P)?(S=C,_):(S=C,w=P)}var b=!1,S,w,I=h===void 0?null:h;return[function(){return m(d())},I===null?void 0:function(){return m(I())}]},[d,h,p,g]);var x=s(u,y[0],y[1]);return a(function(){v.hasValue=!0,v.value=x},[x]),l(x),x},Dp}var kP;function mG(){return kP||(kP=1,Op.exports=gG()),Op.exports}var yG=mG();const vG=rs(yG),xG={},TP=n=>{let e;const r=new Set,i=(d,h)=>{const p=typeof d=="function"?d(e):d;if(!Object.is(p,e)){const g=e;e=h??(typeof p!="object"||p===null)?p:Object.assign({},e,p),r.forEach(y=>y(e,g))}},s=()=>e,l={setState:i,getState:s,getInitialState:()=>u,subscribe:d=>(r.add(d),()=>r.delete(d)),destroy:()=>{(xG?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},u=e=n(i,s,l);return l},bG=n=>n?TP(n):TP,{useDebugValue:SG}=nt,{useSyncExternalStoreWithSelector:wG}=vG,_G=n=>n;function w3(n,e=_G,r){const i=wG(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,r);return SG(i),i}const MP=(n,e)=>{const r=bG(n),i=(s,o=e)=>w3(r,s,o);return Object.assign(i,r),i},CG=(n,e)=>n?MP(n,e):MP;function _t(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[i,s]of n)if(!Object.is(s,e.get(i)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const i of n)if(!e.has(i))return!1;return!0}const r=Object.keys(n);if(r.length!==Object.keys(e).length)return!1;for(const i of r)if(!Object.prototype.hasOwnProperty.call(e,i)||!Object.is(n[i],e[i]))return!1;return!0}const qh=E.createContext(null),PG=qh.Provider,_3=xi.error001();function Ze(n,e){const r=E.useContext(qh);if(r===null)throw new Error(_3);return w3(r,n,e)}function Pt(){const n=E.useContext(qh);if(n===null)throw new Error(_3);return E.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe}),[n])}const AP={display:"none"},IG={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},C3="react-flow__node-desc",P3="react-flow__edge-desc",EG="react-flow__aria-live",kG=n=>n.ariaLiveMessage,TG=n=>n.ariaLabelConfig;function MG({rfId:n}){const e=Ze(kG);return f.jsx("div",{id:`${EG}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:IG,children:e})}function AG({rfId:n,disableKeyboardA11y:e}){const r=Ze(TG);return f.jsxs(f.Fragment,{children:[f.jsx("div",{id:`${C3}-${n}`,style:AP,children:e?r["node.a11yDescription.default"]:r["node.a11yDescription.keyboardDisabled"]}),f.jsx("div",{id:`${P3}-${n}`,style:AP,children:r["edge.a11yDescription.default"]}),!e&&f.jsx(MG,{rfId:n})]})}const Hh=E.forwardRef(({position:n="top-left",children:e,className:r,style:i,...s},o)=>{const a=`${n}`.split("-");return f.jsx("div",{className:zt(["react-flow__panel",r,...a]),style:i,ref:o,...s,children:e})});Hh.displayName="Panel";function jG({proOptions:n,position:e="bottom-right"}){return n?.hideAttribution?null:f.jsx(Hh,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:f.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const RG=n=>{const e=[],r=[];for(const[,i]of n.nodeLookup)i.selected&&e.push(i.internals.userNode);for(const[,i]of n.edgeLookup)i.selected&&r.push(i);return{selectedNodes:e,selectedEdges:r}},Lu=n=>n.id;function OG(n,e){return _t(n.selectedNodes.map(Lu),e.selectedNodes.map(Lu))&&_t(n.selectedEdges.map(Lu),e.selectedEdges.map(Lu))}function DG({onSelectionChange:n}){const e=Pt(),{selectedNodes:r,selectedEdges:i}=Ze(RG,OG);return E.useEffect(()=>{const s={nodes:r,edges:i};n?.(s),e.getState().onSelectionChangeHandlers.forEach(o=>o(s))},[r,i,n]),null}const NG=n=>!!n.onSelectionChangeHandlers;function LG({onSelectionChange:n}){const e=Ze(NG);return n||e?f.jsx(DG,{onSelectionChange:n}):null}const I3=[0,0],FG={x:0,y:0,zoom:1},zG=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],jP=[...zG,"rfId"],$G=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges}),RP={translateExtent:ml,nodeOrigin:I3,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function BG(n){const{setNodes:e,setEdges:r,setMinZoom:i,setMaxZoom:s,setTranslateExtent:o,setNodeExtent:a,reset:c,setDefaultNodesAndEdges:l}=Ze($G,_t),u=Pt();E.useEffect(()=>(l(n.defaultNodes,n.defaultEdges),()=>{d.current=RP,c()}),[]);const d=E.useRef(RP);return E.useEffect(()=>{for(const h of jP){const p=n[h],g=d.current[h];p!==g&&(typeof n[h]>"u"||(h==="nodes"?e(p):h==="edges"?r(p):h==="minZoom"?i(p):h==="maxZoom"?s(p):h==="translateExtent"?o(p):h==="nodeExtent"?a(p):h==="ariaLabelConfig"?u.setState({ariaLabelConfig:PH(p)}):h==="fitView"?u.setState({fitViewQueued:p}):h==="fitViewOptions"?u.setState({fitViewOptions:p}):u.setState({[h]:p})))}d.current=n},jP.map(h=>n[h])),null}function OP(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function UG(n){const[e,r]=E.useState(n==="system"?null:n);return E.useEffect(()=>{if(n!=="system"){r(n);return}const i=OP(),s=()=>r(i?.matches?"dark":"light");return s(),i?.addEventListener("change",s),()=>{i?.removeEventListener("change",s)}},[n]),e!==null?e:OP()?.matches?"dark":"light"}const DP=typeof document<"u"?document:null;function bl(n=null,e={target:DP,actInsideInputWithModifier:!0}){const[r,i]=E.useState(!1),s=E.useRef(!1),o=E.useRef(new Set([])),[a,c]=E.useMemo(()=>{if(n!==null){const u=(Array.isArray(n)?n:[n]).filter(h=>typeof h=="string").map(h=>h.replace("+",`
`).replace(`

`,`
+`).split(`
`)),d=u.reduce((h,p)=>h.concat(...p),[]);return[u,d]}return[[],[]]},[n]);return E.useEffect(()=>{const l=e?.target??DP,u=e?.actInsideInputWithModifier??!0;if(n!==null){const d=g=>{if(s.current=g.ctrlKey||g.metaKey||g.shiftKey||g.altKey,(!s.current||s.current&&!u)&&s3(g))return!1;const v=LP(g.code,c);if(o.current.add(g[v]),NP(a,o.current,!1)){const x=g.composedPath?.()?.[0]||g.target,m=x?.nodeName==="BUTTON"||x?.nodeName==="A";e.preventDefault!==!1&&(s.current||!m)&&g.preventDefault(),i(!0)}},h=g=>{const y=LP(g.code,c);NP(a,o.current,!0)?(i(!1),o.current.clear()):o.current.delete(g[y]),g.key==="Meta"&&o.current.clear(),s.current=!1},p=()=>{o.current.clear(),i(!1)};return l?.addEventListener("keydown",d),l?.addEventListener("keyup",h),window.addEventListener("blur",p),window.addEventListener("contextmenu",p),()=>{l?.removeEventListener("keydown",d),l?.removeEventListener("keyup",h),window.removeEventListener("blur",p),window.removeEventListener("contextmenu",p)}}},[n,i]),r}function NP(n,e,r){return n.filter(i=>r||i.length===e.size).some(i=>i.every(s=>e.has(s)))}function LP(n,e){return e.includes(n)?"code":"key"}const qG=()=>{const n=Pt();return E.useMemo(()=>({zoomIn:e=>{const{panZoom:r}=n.getState();return r?r.scaleBy(1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:r}=n.getState();return r?r.scaleBy(1/1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomTo:(e,r)=>{const{panZoom:i}=n.getState();return i?i.scaleTo(e,{duration:r?.duration}):Promise.resolve(!1)},getZoom:()=>n.getState().transform[2],setViewport:async(e,r)=>{const{transform:[i,s,o],panZoom:a}=n.getState();return a?(await a.setViewport({x:e.x??i,y:e.y??s,zoom:e.zoom??o},r),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,r,i]=n.getState().transform;return{x:e,y:r,zoom:i}},setCenter:async(e,r,i)=>n.getState().setCenter(e,r,i),fitBounds:async(e,r)=>{const{width:i,height:s,minZoom:o,maxZoom:a,panZoom:c}=n.getState(),l=_1(e,i,s,o,a,r?.padding??.1);return c?(await c.setViewport(l,{duration:r?.duration,ease:r?.ease,interpolate:r?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,r={})=>{const{transform:i,snapGrid:s,snapToGrid:o,domNode:a}=n.getState();if(!a)return e;const{x:c,y:l}=a.getBoundingClientRect(),u={x:e.x-c,y:e.y-l},d=r.snapGrid??s,h=r.snapToGrid??o;return Gl(u,i,h,d)},flowToScreenPosition:e=>{const{transform:r,domNode:i}=n.getState();if(!i)return e;const{x:s,y:o}=i.getBoundingClientRect(),a=Ud(e,r);return{x:a.x+s,y:a.y+o}}}),[])};function E3(n,e){const r=[],i=new Map,s=[];for(const o of n)if(o.type==="add"){s.push(o);continue}else if(o.type==="remove"||o.type==="replace")i.set(o.id,[o]);else{const a=i.get(o.id);a?a.push(o):i.set(o.id,[o])}for(const o of e){const a=i.get(o.id);if(!a){r.push(o);continue}if(a[0].type==="remove")continue;if(a[0].type==="replace"){r.push({...a[0].item});continue}const c={...o};for(const l of a)HG(l,c);r.push(c)}return s.length&&s.forEach(o=>{o.index!==void 0?r.splice(o.index,0,{...o.item}):r.push({...o.item})}),r}function HG(n,e){switch(n.type){case"select":{e.selected=n.selected;break}case"position":{typeof n.position<"u"&&(e.position=n.position),typeof n.dragging<"u"&&(e.dragging=n.dragging);break}case"dimensions":{typeof n.dimensions<"u"&&(e.measured={...n.dimensions},n.setAttributes&&((n.setAttributes===!0||n.setAttributes==="width")&&(e.width=n.dimensions.width),(n.setAttributes===!0||n.setAttributes==="height")&&(e.height=n.dimensions.height))),typeof n.resizing=="boolean"&&(e.resizing=n.resizing);break}}}function k3(n,e){return E3(n,e)}function T3(n,e){return E3(n,e)}function so(n,e){return{id:n,type:"select",selected:e}}function aa(n,e=new Set,r=!1){const i=[];for(const[s,o]of n){const a=e.has(s);!(o.selected===void 0&&!a)&&o.selected!==a&&(r&&(o.selected=a),i.push(so(o.id,a)))}return i}function FP({items:n=[],lookup:e}){const r=[],i=new Map(n.map(s=>[s.id,s]));for(const[s,o]of n.entries()){const a=e.get(o.id),c=a?.internals?.userNode??a;c!==void 0&&c!==o&&r.push({id:o.id,item:o,type:"replace"}),c===void 0&&r.push({item:o,type:"add",index:s})}for(const[s]of e)i.get(s)===void 0&&r.push({id:s,type:"remove"});return r}function zP(n){return{id:n.id,type:"remove"}}const $P=n=>gH(n),GG=n=>ZN(n);function M3(n){return E.forwardRef(n)}const KG=typeof window<"u"?E.useLayoutEffect:E.useEffect;function BP(n){const[e,r]=E.useState(BigInt(0)),[i]=E.useState(()=>VG(()=>r(s=>s+BigInt(1))));return KG(()=>{const s=i.get();s.length&&(n(s),i.reset())},[e]),i}function VG(n){let e=[];return{get:()=>e,reset:()=>{e=[]},push:r=>{e.push(r),n()}}}const A3=E.createContext(null);function WG({children:n}){const e=Pt(),r=E.useCallback(c=>{const{nodes:l=[],setNodes:u,hasDefaultNodes:d,onNodesChange:h,nodeLookup:p,fitViewQueued:g,onNodesChangeMiddlewareMap:y}=e.getState();let v=l;for(const m of c)v=typeof m=="function"?m(v):m;let x=FP({items:v,lookup:p});for(const m of y.values())x=m(x);d&&u(v),x.length>0?h?.(x):g&&window.requestAnimationFrame(()=>{const{fitViewQueued:m,nodes:b,setNodes:S}=e.getState();m&&S(b)})},[]),i=BP(r),s=E.useCallback(c=>{const{edges:l=[],setEdges:u,hasDefaultEdges:d,onEdgesChange:h,edgeLookup:p}=e.getState();let g=l;for(const y of c)g=typeof y=="function"?y(g):y;d?u(g):h&&h(FP({items:g,lookup:p}))},[]),o=BP(s),a=E.useMemo(()=>({nodeQueue:i,edgeQueue:o}),[]);return f.jsx(A3.Provider,{value:a,children:n})}function YG(){const n=E.useContext(A3);if(!n)throw new Error("useBatchContext must be used within a BatchProvider");return n}const XG=n=>!!n.panZoom;function A1(){const n=qG(),e=Pt(),r=YG(),i=Ze(XG),s=E.useMemo(()=>{const o=h=>e.getState().nodeLookup.get(h),a=h=>{r.nodeQueue.push(h)},c=h=>{r.edgeQueue.push(h)},l=h=>{const{nodeLookup:p,nodeOrigin:g}=e.getState(),y=$P(h)?h:p.get(h.id),v=y.parentId?r3(y.position,y.measured,y.parentId,p,g):y.position,x={...y,position:v,width:y.measured?.width??y.width,height:y.measured?.height??y.height};return Ia(x)},u=(h,p,g={replace:!1})=>{a(y=>y.map(v=>{if(v.id===h){const x=typeof p=="function"?p(v):p;return g.replace&&$P(x)?x:{...v,...x}}return v}))},d=(h,p,g={replace:!1})=>{c(y=>y.map(v=>{if(v.id===h){const x=typeof p=="function"?p(v):p;return g.replace&&GG(x)?x:{...v,...x}}return v}))};return{getNodes:()=>e.getState().nodes.map(h=>({...h})),getNode:h=>o(h)?.internals.userNode,getInternalNode:o,getEdges:()=>{const{edges:h=[]}=e.getState();return h.map(p=>({...p}))},getEdge:h=>e.getState().edgeLookup.get(h),setNodes:a,setEdges:c,addNodes:h=>{const p=Array.isArray(h)?h:[h];r.nodeQueue.push(g=>[...g,...p])},addEdges:h=>{const p=Array.isArray(h)?h:[h];r.edgeQueue.push(g=>[...g,...p])},toObject:()=>{const{nodes:h=[],edges:p=[],transform:g}=e.getState(),[y,v,x]=g;return{nodes:h.map(m=>({...m})),edges:p.map(m=>({...m})),viewport:{x:y,y:v,zoom:x}}},deleteElements:async({nodes:h=[],edges:p=[]})=>{const{nodes:g,edges:y,onNodesDelete:v,onEdgesDelete:x,triggerNodeChanges:m,triggerEdgeChanges:b,onDelete:S,onBeforeDelete:w}=e.getState(),{nodes:I,edges:C}=await bH({nodesToRemove:h,edgesToRemove:p,nodes:g,edges:y,onBeforeDelete:w}),_=C.length>0,P=I.length>0;if(_){const M=C.map(zP);x?.(C),b(M)}if(P){const M=I.map(zP);v?.(I),m(M)}return(P||_)&&S?.({nodes:I,edges:C}),{deletedNodes:I,deletedEdges:C}},getIntersectingNodes:(h,p=!0,g)=>{const y=pP(h),v=y?h:l(h),x=g!==void 0;return v?(g||e.getState().nodes).filter(m=>{const b=e.getState().nodeLookup.get(m.id);if(b&&!y&&(m.id===h.id||!b.internals.positionAbsolute))return!1;const S=Ia(x?m:b),w=vl(S,v);return p&&w>0||w>=S.width*S.height||w>=v.width*v.height}):[]},isNodeIntersecting:(h,p,g=!0)=>{const v=pP(h)?h:l(h);if(!v)return!1;const x=vl(v,p);return g&&x>0||x>=p.width*p.height||x>=v.width*v.height},updateNode:u,updateNodeData:(h,p,g={replace:!1})=>{u(h,y=>{const v=typeof p=="function"?p(y):p;return g.replace?{...y,data:v}:{...y,data:{...y.data,...v}}},g)},updateEdge:d,updateEdgeData:(h,p,g={replace:!1})=>{d(h,y=>{const v=typeof p=="function"?p(y):p;return g.replace?{...y,data:v}:{...y,data:{...y.data,...v}}},g)},getNodesBounds:h=>{const{nodeLookup:p,nodeOrigin:g}=e.getState();return mH(h,{nodeLookup:p,nodeOrigin:g})},getHandleConnections:({type:h,id:p,nodeId:g})=>Array.from(e.getState().connectionLookup.get(`${g}-${h}${p?`-${p}`:""}`)?.values()??[]),getNodeConnections:({type:h,handleId:p,nodeId:g})=>Array.from(e.getState().connectionLookup.get(`${g}${h?p?`-${h}-${p}`:`-${h}`:""}`)?.values()??[]),fitView:async h=>{const p=e.getState().fitViewResolver??CH();return e.setState({fitViewQueued:!0,fitViewOptions:h,fitViewResolver:p}),r.nodeQueue.push(g=>[...g]),p.promise}}},[]);return E.useMemo(()=>({...s,...n,viewportInitialized:i}),[i])}const UP=n=>n.selected,ZG=typeof window<"u"?window:void 0;function QG({deleteKeyCode:n,multiSelectionKeyCode:e}){const r=Pt(),{deleteElements:i}=A1(),s=bl(n,{actInsideInputWithModifier:!1}),o=bl(e,{target:ZG});E.useEffect(()=>{if(s){const{edges:a,nodes:c}=r.getState();i({nodes:c.filter(UP),edges:a.filter(UP)}),r.setState({nodesSelectionActive:!1})}},[s]),E.useEffect(()=>{r.setState({multiSelectionActive:o})},[o])}function JG(n){const e=Pt();E.useEffect(()=>{const r=()=>{if(!n.current||!(n.current.checkVisibility?.()??!0))return!1;const i=C1(n.current);(i.height===0||i.width===0)&&e.getState().onError?.("004",xi.error004()),e.setState({width:i.width||500,height:i.height||500})};if(n.current){r(),window.addEventListener("resize",r);const i=new ResizeObserver(()=>r());return i.observe(n.current),()=>{window.removeEventListener("resize",r),i&&n.current&&i.unobserve(n.current)}}},[])}const Gh={position:"absolute",width:"100%",height:"100%",top:0,left:0},eK=n=>({userSelectionActive:n.userSelectionActive,lib:n.lib,connectionInProgress:n.connection.inProgress});function tK({onPaneContextMenu:n,zoomOnScroll:e=!0,zoomOnPinch:r=!0,panOnScroll:i=!1,panOnScrollSpeed:s=.5,panOnScrollMode:o=po.Free,zoomOnDoubleClick:a=!0,panOnDrag:c=!0,defaultViewport:l,translateExtent:u,minZoom:d,maxZoom:h,zoomActivationKeyCode:p,preventScrolling:g=!0,children:y,noWheelClassName:v,noPanClassName:x,onViewportChange:m,isControlledViewport:b,paneClickDistance:S,selectionOnDrag:w}){const I=Pt(),C=E.useRef(null),{userSelectionActive:_,lib:P,connectionInProgress:M}=Ze(eK,_t),T=bl(p),A=E.useRef();JG(C);const R=E.useCallback(O=>{m?.({x:O[0],y:O[1],zoom:O[2]}),b||I.setState({transform:O})},[m,b]);return E.useEffect(()=>{if(C.current){A.current=oG({domNode:C.current,minZoom:d,maxZoom:h,translateExtent:u,viewport:l,onDraggingChange:N=>I.setState({paneDragging:N}),onPanZoomStart:(N,F)=>{const{onViewportChangeStart:z,onMoveStart:$}=I.getState();$?.(N,F),z?.(F)},onPanZoom:(N,F)=>{const{onViewportChange:z,onMove:$}=I.getState();$?.(N,F),z?.(F)},onPanZoomEnd:(N,F)=>{const{onViewportChangeEnd:z,onMoveEnd:$}=I.getState();$?.(N,F),z?.(F)}});const{x:O,y:j,zoom:D}=A.current.getViewport();return I.setState({panZoom:A.current,transform:[O,j,D],domNode:C.current.closest(".react-flow")}),()=>{A.current?.destroy()}}},[]),E.useEffect(()=>{A.current?.update({onPaneContextMenu:n,zoomOnScroll:e,zoomOnPinch:r,panOnScroll:i,panOnScrollSpeed:s,panOnScrollMode:o,zoomOnDoubleClick:a,panOnDrag:c,zoomActivationKeyPressed:T,preventScrolling:g,noPanClassName:x,userSelectionActive:_,noWheelClassName:v,lib:P,onTransformChange:R,connectionInProgress:M,selectionOnDrag:w,paneClickDistance:S})},[n,e,r,i,s,o,a,c,T,g,x,_,v,P,R,M,w,S]),f.jsx("div",{className:"react-flow__renderer",ref:C,style:Gh,children:y})}const nK=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function rK(){const{userSelectionActive:n,userSelectionRect:e}=Ze(nK,_t);return n&&e?f.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const Np=(n,e)=>r=>{r.target===e.current&&n?.(r)},iK=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,connectionInProgress:n.connection.inProgress,dragging:n.paneDragging});function sK({isSelecting:n,selectionKeyPressed:e,selectionMode:r=yl.Full,panOnDrag:i,paneClickDistance:s,selectionOnDrag:o,onSelectionStart:a,onSelectionEnd:c,onPaneClick:l,onPaneContextMenu:u,onPaneScroll:d,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:g,children:y}){const v=Pt(),{userSelectionActive:x,elementsSelectable:m,dragging:b,connectionInProgress:S}=Ze(iK,_t),w=m&&(n||x),I=E.useRef(null),C=E.useRef(),_=E.useRef(new Set),P=E.useRef(new Set),M=E.useRef(!1),T=z=>{if(M.current||S){M.current=!1;return}l?.(z),v.getState().resetSelectedElements(),v.setState({nodesSelectionActive:!1})},A=z=>{if(Array.isArray(i)&&i?.includes(2)){z.preventDefault();return}u?.(z)},R=d?z=>d(z):void 0,O=z=>{M.current&&(z.stopPropagation(),M.current=!1)},j=z=>{const{domNode:$}=v.getState();if(C.current=$?.getBoundingClientRect(),!C.current)return;const G=z.target===I.current;if(!G&&!!z.target.closest(".nokey")||!n||!(o&&G||e)||z.button!==0||!z.isPrimary)return;z.target?.setPointerCapture?.(z.pointerId),M.current=!1;const{x:re,y:B}=Kr(z.nativeEvent,C.current);v.setState({userSelectionRect:{width:0,height:0,startX:re,startY:B,x:re,y:B}}),G||(z.stopPropagation(),z.preventDefault())},D=z=>{const{userSelectionRect:$,transform:G,nodeLookup:X,edgeLookup:ee,connectionLookup:re,triggerNodeChanges:B,triggerEdgeChanges:U,defaultEdgeOptions:Q,resetSelectedElements:K}=v.getState();if(!C.current||!$)return;const{x:Y,y:V}=Kr(z.nativeEvent,C.current),{startX:ie,startY:ae}=$;if(!M.current){const me=e?0:s;if(Math.hypot(Y-ie,V-ae)<=me)return;K(),a?.(z)}M.current=!0;const ye={startX:ie,startY:ae,x:Y<ie?Y:ie,y:V<ae?V:ae,width:Math.abs(Y-ie),height:Math.abs(V-ae)},he=_.current,xe=P.current;_.current=new Set(w1(X,ye,G,r===yl.Partial,!0).map(me=>me.id)),P.current=new Set;const fe=Q?.selectable??!0;for(const me of _.current){const we=re.get(me);if(we)for(const{edgeId:st}of we.values()){const lt=ee.get(st);lt&&(lt.selectable??fe)&&P.current.add(st)}}if(!gP(he,_.current)){const me=aa(X,_.current,!0);B(me)}if(!gP(xe,P.current)){const me=aa(ee,P.current);U(me)}v.setState({userSelectionRect:ye,userSelectionActive:!0,nodesSelectionActive:!1})},N=z=>{z.button===0&&(z.target?.releasePointerCapture?.(z.pointerId),!x&&z.target===I.current&&v.getState().userSelectionRect&&T?.(z),v.setState({userSelectionActive:!1,userSelectionRect:null}),M.current&&(c?.(z),v.setState({nodesSelectionActive:_.current.size>0})))},F=i===!0||Array.isArray(i)&&i.includes(0);return f.jsxs("div",{className:zt(["react-flow__pane",{draggable:F,dragging:b,selection:n}]),onClick:w?void 0:Np(T,I),onContextMenu:Np(A,I),onWheel:Np(R,I),onPointerEnter:w?void 0:h,onPointerMove:w?D:p,onPointerUp:w?N:void 0,onPointerDownCapture:w?j:void 0,onClickCapture:w?O:void 0,onPointerLeave:g,ref:I,style:Gh,children:[y,f.jsx(rK,{})]})}function aw({id:n,store:e,unselect:r=!1,nodeRef:i}){const{addSelectedNodes:s,unselectNodesAndEdges:o,multiSelectionActive:a,nodeLookup:c,onError:l}=e.getState(),u=c.get(n);if(!u){l?.("012",xi.error012(n));return}e.setState({nodesSelectionActive:!1}),u.selected?(r||u.selected&&a)&&(o({nodes:[u],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):s([n])}function j3({nodeRef:n,disabled:e=!1,noDragClassName:r,handleSelector:i,nodeId:s,isSelectable:o,nodeClickDistance:a}){const c=Pt(),[l,u]=E.useState(!1),d=E.useRef();return E.useEffect(()=>{d.current=KH({getStoreItems:()=>c.getState(),onNodeMouseDown:h=>{aw({id:h,store:c,nodeRef:n})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),E.useEffect(()=>{if(e)d.current?.destroy();else if(n.current)return d.current?.update({noDragClassName:r,handleSelector:i,domNode:n.current,isSelectable:o,nodeId:s,nodeClickDistance:a}),()=>{d.current?.destroy()}},[r,i,e,o,n,s]),l}const oK=n=>e=>e.selected&&(e.draggable||n&&typeof e.draggable>"u");function R3(){const n=Pt();return E.useCallback(r=>{const{nodeExtent:i,snapToGrid:s,snapGrid:o,nodesDraggable:a,onError:c,updateNodePositions:l,nodeLookup:u,nodeOrigin:d}=n.getState(),h=new Map,p=oK(a),g=s?o[0]:5,y=s?o[1]:5,v=r.direction.x*g*r.factor,x=r.direction.y*y*r.factor;for(const[,m]of u){if(!p(m))continue;let b={x:m.internals.positionAbsolute.x+v,y:m.internals.positionAbsolute.y+x};s&&(b=Hl(b,o));const{position:S,positionAbsolute:w}=QN({nodeId:m.id,nextPosition:b,nodeLookup:u,nodeExtent:i,nodeOrigin:d,onError:c});m.position=S,m.internals.positionAbsolute=w,h.set(m.id,m)}l(h)},[])}const j1=E.createContext(null),aK=j1.Provider;j1.Consumer;const O3=()=>E.useContext(j1),cK=n=>({connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName,rfId:n.rfId}),lK=(n,e,r)=>i=>{const{connectionClickStartHandle:s,connectionMode:o,connection:a}=i,{fromHandle:c,toHandle:l,isValid:u}=a,d=l?.nodeId===n&&l?.id===e&&l?.type===r;return{connectingFrom:c?.nodeId===n&&c?.id===e&&c?.type===r,connectingTo:d,clickConnecting:s?.nodeId===n&&s?.id===e&&s?.type===r,isPossibleEndHandle:o===Ca.Strict?c?.type!==r:n!==c?.nodeId||e!==c?.id,connectionInProcess:!!c,clickConnectionInProcess:!!s,valid:d&&u}};function uK({type:n="source",position:e=Ce.Top,isValidConnection:r,isConnectable:i=!0,isConnectableStart:s=!0,isConnectableEnd:o=!0,id:a,onConnect:c,children:l,className:u,onMouseDown:d,onTouchStart:h,...p},g){const y=a||null,v=n==="target",x=Pt(),m=O3(),{connectOnClick:b,noPanClassName:S,rfId:w}=Ze(cK,_t),{connectingFrom:I,connectingTo:C,clickConnecting:_,isPossibleEndHandle:P,connectionInProcess:M,clickConnectionInProcess:T,valid:A}=Ze(lK(m,y,n),_t);m||x.getState().onError?.("010",xi.error010());const R=D=>{const{defaultEdgeOptions:N,onConnect:F,hasDefaultEdges:z}=x.getState(),$={...N,...D};if(z){const{edges:G,setEdges:X}=x.getState();X(P1($,G))}F?.($),c?.($)},O=D=>{if(!m)return;const N=o3(D.nativeEvent);if(s&&(N&&D.button===0||!N)){const F=x.getState();ow.onPointerDown(D.nativeEvent,{handleDomNode:D.currentTarget,autoPanOnConnect:F.autoPanOnConnect,connectionMode:F.connectionMode,connectionRadius:F.connectionRadius,domNode:F.domNode,nodeLookup:F.nodeLookup,lib:F.lib,isTarget:v,handleId:y,nodeId:m,flowId:F.rfId,panBy:F.panBy,cancelConnection:F.cancelConnection,onConnectStart:F.onConnectStart,onConnectEnd:F.onConnectEnd,updateConnection:F.updateConnection,onConnect:R,isValidConnection:r||F.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:F.autoPanSpeed,dragThreshold:F.connectionDragThreshold})}N?d?.(D):h?.(D)},j=D=>{const{onClickConnectStart:N,onClickConnectEnd:F,connectionClickStartHandle:z,connectionMode:$,isValidConnection:G,lib:X,rfId:ee,nodeLookup:re,connection:B}=x.getState();if(!m||!z&&!s)return;if(!z){N?.(D.nativeEvent,{nodeId:m,handleId:y,handleType:n}),x.setState({connectionClickStartHandle:{nodeId:m,type:n,id:y}});return}const U=i3(D.target),Q=r||G,{connection:K,isValid:Y}=ow.isValid(D.nativeEvent,{handle:{nodeId:m,id:y,type:n},connectionMode:$,fromNodeId:z.nodeId,fromHandleId:z.id||null,fromType:z.type,isValidConnection:Q,flowId:ee,doc:U,lib:X,nodeLookup:re});Y&&K&&R(K);const V=structuredClone(B);delete V.inProgress,V.toPosition=V.toHandle?V.toHandle.position:null,F?.(D,V),x.setState({connectionClickStartHandle:null})};return f.jsx("div",{"data-handleid":y,"data-nodeid":m,"data-handlepos":e,"data-id":`${w}-${m}-${y}-${n}`,className:zt(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",S,u,{source:!v,target:v,connectable:i,connectablestart:s,connectableend:o,clickconnecting:_,connectingfrom:I,connectingto:C,valid:A,connectionindicator:i&&(!M||P)&&(M||T?o:s)}]),onMouseDown:O,onTouchStart:O,onClick:b?j:void 0,ref:g,...p,children:l})}const Sn=E.memo(M3(uK));function dK({data:n,isConnectable:e,sourcePosition:r=Ce.Bottom}){return f.jsxs(f.Fragment,{children:[n?.label,f.jsx(Sn,{type:"source",position:r,isConnectable:e})]})}function hK({data:n,isConnectable:e,targetPosition:r=Ce.Top,sourcePosition:i=Ce.Bottom}){return f.jsxs(f.Fragment,{children:[f.jsx(Sn,{type:"target",position:r,isConnectable:e}),n?.label,f.jsx(Sn,{type:"source",position:i,isConnectable:e})]})}function fK(){return null}function pK({data:n,isConnectable:e,targetPosition:r=Ce.Top}){return f.jsxs(f.Fragment,{children:[f.jsx(Sn,{type:"target",position:r,isConnectable:e}),n?.label]})}const qd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},qP={input:dK,default:hK,output:pK,group:fK};function gK(n){return n.internals.handleBounds===void 0?{width:n.width??n.initialWidth??n.style?.width,height:n.height??n.initialHeight??n.style?.height}:{width:n.width??n.style?.width,height:n.height??n.style?.height}}const mK=n=>{const{width:e,height:r,x:i,y:s}=ql(n.nodeLookup,{filter:o=>!!o.selected});return{width:Gr(e)?e:null,height:Gr(r)?r:null,userSelectionActive:n.userSelectionActive,transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]}) translate(${i}px,${s}px)`}};function yK({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:r}){const i=Pt(),{width:s,height:o,transformString:a,userSelectionActive:c}=Ze(mK,_t),l=R3(),u=E.useRef(null);if(E.useEffect(()=>{r||u.current?.focus({preventScroll:!0})},[r]),j3({nodeRef:u}),c||!s||!o)return null;const d=n?p=>{const g=i.getState().nodes.filter(y=>y.selected);n(p,g)}:void 0,h=p=>{Object.prototype.hasOwnProperty.call(qd,p.key)&&(p.preventDefault(),l({direction:qd[p.key],factor:p.shiftKey?4:1}))};return f.jsx("div",{className:zt(["react-flow__nodesselection","react-flow__container",e]),style:{transform:a},children:f.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:r?void 0:-1,onKeyDown:r?void 0:h,style:{width:s,height:o}})})}const HP=typeof window<"u"?window:void 0,vK=n=>({nodesSelectionActive:n.nodesSelectionActive,userSelectionActive:n.userSelectionActive});function D3({children:n,onPaneClick:e,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:s,onPaneContextMenu:o,onPaneScroll:a,paneClickDistance:c,deleteKeyCode:l,selectionKeyCode:u,selectionOnDrag:d,selectionMode:h,onSelectionStart:p,onSelectionEnd:g,multiSelectionKeyCode:y,panActivationKeyCode:v,zoomActivationKeyCode:x,elementsSelectable:m,zoomOnScroll:b,zoomOnPinch:S,panOnScroll:w,panOnScrollSpeed:I,panOnScrollMode:C,zoomOnDoubleClick:_,panOnDrag:P,defaultViewport:M,translateExtent:T,minZoom:A,maxZoom:R,preventScrolling:O,onSelectionContextMenu:j,noWheelClassName:D,noPanClassName:N,disableKeyboardA11y:F,onViewportChange:z,isControlledViewport:$}){const{nodesSelectionActive:G,userSelectionActive:X}=Ze(vK,_t),ee=bl(u,{target:HP}),re=bl(v,{target:HP}),B=re||P,U=re||w,Q=d&&B!==!0,K=ee||X||Q;return QG({deleteKeyCode:l,multiSelectionKeyCode:y}),f.jsx(tK,{onPaneContextMenu:o,elementsSelectable:m,zoomOnScroll:b,zoomOnPinch:S,panOnScroll:U,panOnScrollSpeed:I,panOnScrollMode:C,zoomOnDoubleClick:_,panOnDrag:!ee&&B,defaultViewport:M,translateExtent:T,minZoom:A,maxZoom:R,zoomActivationKeyCode:x,preventScrolling:O,noWheelClassName:D,noPanClassName:N,onViewportChange:z,isControlledViewport:$,paneClickDistance:c,selectionOnDrag:Q,children:f.jsxs(sK,{onSelectionStart:p,onSelectionEnd:g,onPaneClick:e,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:s,onPaneContextMenu:o,onPaneScroll:a,panOnDrag:B,isSelecting:!!K,selectionMode:h,selectionKeyPressed:ee,paneClickDistance:c,selectionOnDrag:Q,children:[n,G&&f.jsx(yK,{onSelectionContextMenu:j,noPanClassName:N,disableKeyboardA11y:F})]})})}D3.displayName="FlowRenderer";const xK=E.memo(D3),bK=n=>e=>n?w1(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(r=>r.id):Array.from(e.nodeLookup.keys());function SK(n){return Ze(E.useCallback(bK(n),[n]),_t)}const wK=n=>n.updateNodeInternals;function _K(){const n=Ze(wK),[e]=E.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(r=>{const i=new Map;r.forEach(s=>{const o=s.target.getAttribute("data-id");i.set(o,{id:o,nodeElement:s.target,force:!0})}),n(i)}));return E.useEffect(()=>()=>{e?.disconnect()},[e]),e}function CK({node:n,nodeType:e,hasDimensions:r,resizeObserver:i}){const s=Pt(),o=E.useRef(null),a=E.useRef(null),c=E.useRef(n.sourcePosition),l=E.useRef(n.targetPosition),u=E.useRef(e),d=r&&!!n.internals.handleBounds;return E.useEffect(()=>{o.current&&!n.hidden&&(!d||a.current!==o.current)&&(a.current&&i?.unobserve(a.current),i?.observe(o.current),a.current=o.current)},[d,n.hidden]),E.useEffect(()=>()=>{a.current&&(i?.unobserve(a.current),a.current=null)},[]),E.useEffect(()=>{if(o.current){const h=u.current!==e,p=c.current!==n.sourcePosition,g=l.current!==n.targetPosition;(h||p||g)&&(u.current=e,c.current=n.sourcePosition,l.current=n.targetPosition,s.getState().updateNodeInternals(new Map([[n.id,{id:n.id,nodeElement:o.current,force:!0}]])))}},[n.id,e,n.sourcePosition,n.targetPosition]),o}function PK({id:n,onClick:e,onMouseEnter:r,onMouseMove:i,onMouseLeave:s,onContextMenu:o,onDoubleClick:a,nodesDraggable:c,elementsSelectable:l,nodesConnectable:u,nodesFocusable:d,resizeObserver:h,noDragClassName:p,noPanClassName:g,disableKeyboardA11y:y,rfId:v,nodeTypes:x,nodeClickDistance:m,onError:b}){const{node:S,internals:w,isParent:I}=Ze(Y=>{const V=Y.nodeLookup.get(n),ie=Y.parentLookup.has(n);return{node:V,internals:V.internals,isParent:ie}},_t);let C=S.type||"default",_=x?.[C]||qP[C];_===void 0&&(b?.("003",xi.error003(C)),C="default",_=x?.default||qP.default);const P=!!(S.draggable||c&&typeof S.draggable>"u"),M=!!(S.selectable||l&&typeof S.selectable>"u"),T=!!(S.connectable||u&&typeof S.connectable>"u"),A=!!(S.focusable||d&&typeof S.focusable>"u"),R=Pt(),O=n3(S),j=CK({node:S,nodeType:C,hasDimensions:O,resizeObserver:h}),D=j3({nodeRef:j,disabled:S.hidden||!P,noDragClassName:p,handleSelector:S.dragHandle,nodeId:n,isSelectable:M,nodeClickDistance:m}),N=R3();if(S.hidden)return null;const F=is(S),z=gK(S),$=M||P||e||r||i||s,G=r?Y=>r(Y,{...w.userNode}):void 0,X=i?Y=>i(Y,{...w.userNode}):void 0,ee=s?Y=>s(Y,{...w.userNode}):void 0,re=o?Y=>o(Y,{...w.userNode}):void 0,B=a?Y=>a(Y,{...w.userNode}):void 0,U=Y=>{const{selectNodesOnDrag:V,nodeDragThreshold:ie}=R.getState();M&&(!V||!P||ie>0)&&aw({id:n,store:R,nodeRef:j}),e&&e(Y,{...w.userNode})},Q=Y=>{if(!(s3(Y.nativeEvent)||y)){if(VN.includes(Y.key)&&M){const V=Y.key==="Escape";aw({id:n,store:R,unselect:V,nodeRef:j})}else if(P&&S.selected&&Object.prototype.hasOwnProperty.call(qd,Y.key)){Y.preventDefault();const{ariaLabelConfig:V}=R.getState();R.setState({ariaLiveMessage:V["node.a11yDescription.ariaLiveMessage"]({direction:Y.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),N({direction:qd[Y.key],factor:Y.shiftKey?4:1})}}},K=()=>{if(y||!j.current?.matches(":focus-visible"))return;const{transform:Y,width:V,height:ie,autoPanOnNodeFocus:ae,setCenter:ye}=R.getState();if(!ae)return;w1(new Map([[n,S]]),{x:0,y:0,width:V,height:ie},Y,!0).length>0||ye(S.position.x+F.width/2,S.position.y+F.height/2,{zoom:Y[2]})};return f.jsx("div",{className:zt(["react-flow__node",`react-flow__node-${C}`,{[g]:P},S.className,{selected:S.selected,selectable:M,parent:I,draggable:P,dragging:D}]),ref:j,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:$?"all":"none",visibility:O?"visible":"hidden",...S.style,...z},"data-id":n,"data-testid":`rf__node-${n}`,onMouseEnter:G,onMouseMove:X,onMouseLeave:ee,onContextMenu:re,onClick:U,onDoubleClick:B,onKeyDown:A?Q:void 0,tabIndex:A?0:void 0,onFocus:A?K:void 0,role:S.ariaRole??(A?"group":void 0),"aria-roledescription":"node","aria-describedby":y?void 0:`${C3}-${v}`,"aria-label":S.ariaLabel,...S.domAttributes,children:f.jsx(aK,{value:n,children:f.jsx(_,{id:n,data:S.data,type:C,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:S.selected??!1,selectable:M,draggable:P,deletable:S.deletable??!0,isConnectable:T,sourcePosition:S.sourcePosition,targetPosition:S.targetPosition,dragging:D,dragHandle:S.dragHandle,zIndex:w.z,parentId:S.parentId,...F})})})}var IK=E.memo(PK);const EK=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,onError:n.onError});function N3(n){const{nodesDraggable:e,nodesConnectable:r,nodesFocusable:i,elementsSelectable:s,onError:o}=Ze(EK,_t),a=SK(n.onlyRenderVisibleElements),c=_K();return f.jsx("div",{className:"react-flow__nodes",style:Gh,children:a.map(l=>f.jsx(IK,{id:l,nodeTypes:n.nodeTypes,nodeExtent:n.nodeExtent,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,resizeObserver:c,nodesDraggable:e,nodesConnectable:r,nodesFocusable:i,elementsSelectable:s,nodeClickDistance:n.nodeClickDistance,onError:o},l))})}N3.displayName="NodeRenderer";const kK=E.memo(N3);function TK(n){return Ze(E.useCallback(r=>{if(!n)return r.edges.map(s=>s.id);const i=[];if(r.width&&r.height)for(const s of r.edges){const o=r.nodeLookup.get(s.source),a=r.nodeLookup.get(s.target);o&&a&&kH({sourceNode:o,targetNode:a,width:r.width,height:r.height,transform:r.transform})&&i.push(s.id)}return i},[n]),_t)}const MK=({color:n="none",strokeWidth:e=1})=>{const r={strokeWidth:e,...n&&{stroke:n}};return f.jsx("polyline",{className:"arrow",style:r,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},AK=({color:n="none",strokeWidth:e=1})=>{const r={strokeWidth:e,...n&&{stroke:n,fill:n}};return f.jsx("polyline",{className:"arrowclosed",style:r,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},GP={[Ls.Arrow]:MK,[Ls.ArrowClosed]:AK};function jK(n){const e=Pt();return E.useMemo(()=>Object.prototype.hasOwnProperty.call(GP,n)?GP[n]:(e.getState().onError?.("009",xi.error009(n)),null),[n])}const RK=({id:n,type:e,color:r,width:i=12.5,height:s=12.5,markerUnits:o="strokeWidth",strokeWidth:a,orient:c="auto-start-reverse"})=>{const l=jK(e);return l?f.jsx("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${i}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:c,refX:"0",refY:"0",children:f.jsx(l,{color:r,strokeWidth:a})}):null},L3=({defaultColor:n,rfId:e})=>{const r=Ze(o=>o.edges),i=Ze(o=>o.defaultEdgeOptions),s=E.useMemo(()=>DH(r,{id:e,defaultColor:n,defaultMarkerStart:i?.markerStart,defaultMarkerEnd:i?.markerEnd}),[r,i,e,n]);return s.length?f.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:f.jsx("defs",{children:s.map(o=>f.jsx(RK,{id:o.id,type:o.type,color:o.color,width:o.width,height:o.height,markerUnits:o.markerUnits,strokeWidth:o.strokeWidth,orient:o.orient},o.id))})}):null};L3.displayName="MarkerDefinitions";var OK=E.memo(L3);function F3({x:n,y:e,label:r,labelStyle:i,labelShowBg:s=!0,labelBgStyle:o,labelBgPadding:a=[2,4],labelBgBorderRadius:c=2,children:l,className:u,...d}){const[h,p]=E.useState({x:1,y:0,width:0,height:0}),g=zt(["react-flow__edge-textwrapper",u]),y=E.useRef(null);return E.useEffect(()=>{if(y.current){const v=y.current.getBBox();p({x:v.x,y:v.y,width:v.width,height:v.height})}},[r]),r?f.jsxs("g",{transform:`translate(${n-h.width/2} ${e-h.height/2})`,className:g,visibility:h.width?"visible":"hidden",...d,children:[s&&f.jsx("rect",{width:h.width+2*a[0],x:-a[0],y:-a[1],height:h.height+2*a[1],className:"react-flow__edge-textbg",style:o,rx:c,ry:c}),f.jsx("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:y,style:i,children:r}),l]}):null}F3.displayName="EdgeText";const DK=E.memo(F3);function Kh({path:n,labelX:e,labelY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,interactionWidth:u=20,...d}){return f.jsxs(f.Fragment,{children:[f.jsx("path",{...d,d:n,fill:"none",className:zt(["react-flow__edge-path",d.className])}),u?f.jsx("path",{d:n,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,i&&Gr(e)&&Gr(r)?f.jsx(DK,{x:e,y:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function KP({pos:n,x1:e,y1:r,x2:i,y2:s}){return n===Ce.Left||n===Ce.Right?[.5*(e+i),r]:[e,.5*(r+s)]}function z3({sourceX:n,sourceY:e,sourcePosition:r=Ce.Bottom,targetX:i,targetY:s,targetPosition:o=Ce.Top}){const[a,c]=KP({pos:r,x1:n,y1:e,x2:i,y2:s}),[l,u]=KP({pos:o,x1:i,y1:s,x2:n,y2:e}),[d,h,p,g]=a3({sourceX:n,sourceY:e,targetX:i,targetY:s,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${n},${e} C${a},${c} ${l},${u} ${i},${s}`,d,h,p,g]}function $3(n){return E.memo(({id:e,sourceX:r,sourceY:i,targetX:s,targetY:o,sourcePosition:a,targetPosition:c,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:g,style:y,markerEnd:v,markerStart:x,interactionWidth:m})=>{const[b,S,w]=z3({sourceX:r,sourceY:i,sourcePosition:a,targetX:s,targetY:o,targetPosition:c}),I=n.isInternal?void 0:e;return f.jsx(Kh,{id:I,path:b,labelX:S,labelY:w,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:g,style:y,markerEnd:v,markerStart:x,interactionWidth:m})})}const NK=$3({isInternal:!1}),B3=$3({isInternal:!0});NK.displayName="SimpleBezierEdge";B3.displayName="SimpleBezierEdgeInternal";function U3(n){return E.memo(({id:e,sourceX:r,sourceY:i,targetX:s,targetY:o,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:h,style:p,sourcePosition:g=Ce.Bottom,targetPosition:y=Ce.Top,markerEnd:v,markerStart:x,pathOptions:m,interactionWidth:b})=>{const[S,w,I]=rw({sourceX:r,sourceY:i,sourcePosition:g,targetX:s,targetY:o,targetPosition:y,borderRadius:m?.borderRadius,offset:m?.offset,stepPosition:m?.stepPosition}),C=n.isInternal?void 0:e;return f.jsx(Kh,{id:C,path:S,labelX:w,labelY:I,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:h,style:p,markerEnd:v,markerStart:x,interactionWidth:b})})}const q3=U3({isInternal:!1}),H3=U3({isInternal:!0});q3.displayName="SmoothStepEdge";H3.displayName="SmoothStepEdgeInternal";function G3(n){return E.memo(({id:e,...r})=>{const i=n.isInternal?void 0:e;return f.jsx(q3,{...r,id:i,pathOptions:E.useMemo(()=>({borderRadius:0,offset:r.pathOptions?.offset}),[r.pathOptions?.offset])})})}const LK=G3({isInternal:!1}),K3=G3({isInternal:!0});LK.displayName="StepEdge";K3.displayName="StepEdgeInternal";function V3(n){return E.memo(({id:e,sourceX:r,sourceY:i,targetX:s,targetY:o,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:h,style:p,markerEnd:g,markerStart:y,interactionWidth:v})=>{const[x,m,b]=u3({sourceX:r,sourceY:i,targetX:s,targetY:o}),S=n.isInternal?void 0:e;return f.jsx(Kh,{id:S,path:x,labelX:m,labelY:b,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:h,style:p,markerEnd:g,markerStart:y,interactionWidth:v})})}const FK=V3({isInternal:!1}),W3=V3({isInternal:!0});FK.displayName="StraightEdge";W3.displayName="StraightEdgeInternal";function Y3(n){return E.memo(({id:e,sourceX:r,sourceY:i,targetX:s,targetY:o,sourcePosition:a=Ce.Bottom,targetPosition:c=Ce.Top,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:g,style:y,markerEnd:v,markerStart:x,pathOptions:m,interactionWidth:b})=>{const[S,w,I]=c3({sourceX:r,sourceY:i,sourcePosition:a,targetX:s,targetY:o,targetPosition:c,curvature:m?.curvature}),C=n.isInternal?void 0:e;return f.jsx(Kh,{id:C,path:S,labelX:w,labelY:I,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:g,style:y,markerEnd:v,markerStart:x,interactionWidth:b})})}const zK=Y3({isInternal:!1}),X3=Y3({isInternal:!0});zK.displayName="BezierEdge";X3.displayName="BezierEdgeInternal";const VP={default:X3,straight:W3,step:K3,smoothstep:H3,simplebezier:B3},WP={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},$K=(n,e,r)=>r===Ce.Left?n-e:r===Ce.Right?n+e:n,BK=(n,e,r)=>r===Ce.Top?n-e:r===Ce.Bottom?n+e:n,YP="react-flow__edgeupdater";function XP({position:n,centerX:e,centerY:r,radius:i=10,onMouseDown:s,onMouseEnter:o,onMouseOut:a,type:c}){return f.jsx("circle",{onMouseDown:s,onMouseEnter:o,onMouseOut:a,className:zt([YP,`${YP}-${c}`]),cx:$K(e,i,n),cy:BK(r,i,n),r:i,stroke:"transparent",fill:"transparent"})}function UK({isReconnectable:n,reconnectRadius:e,edge:r,sourceX:i,sourceY:s,targetX:o,targetY:a,sourcePosition:c,targetPosition:l,onReconnect:u,onReconnectStart:d,onReconnectEnd:h,setReconnecting:p,setUpdateHover:g}){const y=Pt(),v=(w,I)=>{if(w.button!==0)return;const{autoPanOnConnect:C,domNode:_,isValidConnection:P,connectionMode:M,connectionRadius:T,lib:A,onConnectStart:R,onConnectEnd:O,cancelConnection:j,nodeLookup:D,rfId:N,panBy:F,updateConnection:z}=y.getState(),$=I.type==="target",G=(re,B)=>{p(!1),h?.(re,r,I.type,B)},X=re=>u?.(r,re),ee=(re,B)=>{p(!0),d?.(w,r,I.type),R?.(re,B)};ow.onPointerDown(w.nativeEvent,{autoPanOnConnect:C,connectionMode:M,connectionRadius:T,domNode:_,handleId:I.id,nodeId:I.nodeId,nodeLookup:D,isTarget:$,edgeUpdaterType:I.type,lib:A,flowId:N,cancelConnection:j,panBy:F,isValidConnection:P,onConnect:X,onConnectStart:ee,onConnectEnd:O,onReconnectEnd:G,updateConnection:z,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,dragThreshold:y.getState().connectionDragThreshold,handleDomNode:w.currentTarget})},x=w=>v(w,{nodeId:r.target,id:r.targetHandle??null,type:"target"}),m=w=>v(w,{nodeId:r.source,id:r.sourceHandle??null,type:"source"}),b=()=>g(!0),S=()=>g(!1);return f.jsxs(f.Fragment,{children:[(n===!0||n==="source")&&f.jsx(XP,{position:c,centerX:i,centerY:s,radius:e,onMouseDown:x,onMouseEnter:b,onMouseOut:S,type:"source"}),(n===!0||n==="target")&&f.jsx(XP,{position:l,centerX:o,centerY:a,radius:e,onMouseDown:m,onMouseEnter:b,onMouseOut:S,type:"target"})]})}function qK({id:n,edgesFocusable:e,edgesReconnectable:r,elementsSelectable:i,onClick:s,onDoubleClick:o,onContextMenu:a,onMouseEnter:c,onMouseMove:l,onMouseLeave:u,reconnectRadius:d,onReconnect:h,onReconnectStart:p,onReconnectEnd:g,rfId:y,edgeTypes:v,noPanClassName:x,onError:m,disableKeyboardA11y:b}){let S=Ze(ye=>ye.edgeLookup.get(n));const w=Ze(ye=>ye.defaultEdgeOptions);S=w?{...w,...S}:S;let I=S.type||"default",C=v?.[I]||VP[I];C===void 0&&(m?.("011",xi.error011(I)),I="default",C=v?.default||VP.default);const _=!!(S.focusable||e&&typeof S.focusable>"u"),P=typeof h<"u"&&(S.reconnectable||r&&typeof S.reconnectable>"u"),M=!!(S.selectable||i&&typeof S.selectable>"u"),T=E.useRef(null),[A,R]=E.useState(!1),[O,j]=E.useState(!1),D=Pt(),{zIndex:N,sourceX:F,sourceY:z,targetX:$,targetY:G,sourcePosition:X,targetPosition:ee}=Ze(E.useCallback(ye=>{const he=ye.nodeLookup.get(S.source),xe=ye.nodeLookup.get(S.target);if(!he||!xe)return{zIndex:S.zIndex,...WP};const fe=OH({id:n,sourceNode:he,targetNode:xe,sourceHandle:S.sourceHandle||null,targetHandle:S.targetHandle||null,connectionMode:ye.connectionMode,onError:m});return{zIndex:EH({selected:S.selected,zIndex:S.zIndex,sourceNode:he,targetNode:xe,elevateOnSelect:ye.elevateEdgesOnSelect,zIndexMode:ye.zIndexMode}),...fe||WP}},[S.source,S.target,S.sourceHandle,S.targetHandle,S.selected,S.zIndex]),_t),re=E.useMemo(()=>S.markerStart?`url('#${iw(S.markerStart,y)}')`:void 0,[S.markerStart,y]),B=E.useMemo(()=>S.markerEnd?`url('#${iw(S.markerEnd,y)}')`:void 0,[S.markerEnd,y]);if(S.hidden||F===null||z===null||$===null||G===null)return null;const U=ye=>{const{addSelectedEdges:he,unselectNodesAndEdges:xe,multiSelectionActive:fe}=D.getState();M&&(D.setState({nodesSelectionActive:!1}),S.selected&&fe?(xe({nodes:[],edges:[S]}),T.current?.blur()):he([n])),s&&s(ye,S)},Q=o?ye=>{o(ye,{...S})}:void 0,K=a?ye=>{a(ye,{...S})}:void 0,Y=c?ye=>{c(ye,{...S})}:void 0,V=l?ye=>{l(ye,{...S})}:void 0,ie=u?ye=>{u(ye,{...S})}:void 0,ae=ye=>{if(!b&&VN.includes(ye.key)&&M){const{unselectNodesAndEdges:he,addSelectedEdges:xe}=D.getState();ye.key==="Escape"?(T.current?.blur(),he({edges:[S]})):xe([n])}};return f.jsx("svg",{style:{zIndex:N},children:f.jsxs("g",{className:zt(["react-flow__edge",`react-flow__edge-${I}`,S.className,x,{selected:S.selected,animated:S.animated,inactive:!M&&!s,updating:A,selectable:M}]),onClick:U,onDoubleClick:Q,onContextMenu:K,onMouseEnter:Y,onMouseMove:V,onMouseLeave:ie,onKeyDown:_?ae:void 0,tabIndex:_?0:void 0,role:S.ariaRole??(_?"group":"img"),"aria-roledescription":"edge","data-id":n,"data-testid":`rf__edge-${n}`,"aria-label":S.ariaLabel===null?void 0:S.ariaLabel||`Edge from ${S.source} to ${S.target}`,"aria-describedby":_?`${P3}-${y}`:void 0,ref:T,...S.domAttributes,children:[!O&&f.jsx(C,{id:n,source:S.source,target:S.target,type:S.type,selected:S.selected,animated:S.animated,selectable:M,deletable:S.deletable??!0,label:S.label,labelStyle:S.labelStyle,labelShowBg:S.labelShowBg,labelBgStyle:S.labelBgStyle,labelBgPadding:S.labelBgPadding,labelBgBorderRadius:S.labelBgBorderRadius,sourceX:F,sourceY:z,targetX:$,targetY:G,sourcePosition:X,targetPosition:ee,data:S.data,style:S.style,sourceHandleId:S.sourceHandle,targetHandleId:S.targetHandle,markerStart:re,markerEnd:B,pathOptions:"pathOptions"in S?S.pathOptions:void 0,interactionWidth:S.interactionWidth}),P&&f.jsx(UK,{edge:S,isReconnectable:P,reconnectRadius:d,onReconnect:h,onReconnectStart:p,onReconnectEnd:g,sourceX:F,sourceY:z,targetX:$,targetY:G,sourcePosition:X,targetPosition:ee,setUpdateHover:R,setReconnecting:j})]})})}var HK=E.memo(qK);const GK=n=>({edgesFocusable:n.edgesFocusable,edgesReconnectable:n.edgesReconnectable,elementsSelectable:n.elementsSelectable,connectionMode:n.connectionMode,onError:n.onError});function Z3({defaultMarkerColor:n,onlyRenderVisibleElements:e,rfId:r,edgeTypes:i,noPanClassName:s,onReconnect:o,onEdgeContextMenu:a,onEdgeMouseEnter:c,onEdgeMouseMove:l,onEdgeMouseLeave:u,onEdgeClick:d,reconnectRadius:h,onEdgeDoubleClick:p,onReconnectStart:g,onReconnectEnd:y,disableKeyboardA11y:v}){const{edgesFocusable:x,edgesReconnectable:m,elementsSelectable:b,onError:S}=Ze(GK,_t),w=TK(e);return f.jsxs("div",{className:"react-flow__edges",children:[f.jsx(OK,{defaultColor:n,rfId:r}),w.map(I=>f.jsx(HK,{id:I,edgesFocusable:x,edgesReconnectable:m,elementsSelectable:b,noPanClassName:s,onReconnect:o,onContextMenu:a,onMouseEnter:c,onMouseMove:l,onMouseLeave:u,onClick:d,reconnectRadius:h,onDoubleClick:p,onReconnectStart:g,onReconnectEnd:y,rfId:r,onError:S,edgeTypes:i,disableKeyboardA11y:v},I))]})}Z3.displayName="EdgeRenderer";const KK=E.memo(Z3),VK=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function WK({children:n}){const e=Ze(VK);return f.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:n})}function YK(n){const e=A1(),r=E.useRef(!1);E.useEffect(()=>{!r.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),r.current=!0)},[n,e.viewportInitialized])}const XK=n=>n.panZoom?.syncViewport;function ZK(n){const e=Ze(XK),r=Pt();return E.useEffect(()=>{n&&(e?.(n),r.setState({transform:[n.x,n.y,n.zoom]}))},[n,e]),null}function QK(n){return n.connection.inProgress?{...n.connection,to:Gl(n.connection.to,n.transform)}:{...n.connection}}function JK(n){return QK}function eV(n){const e=JK();return Ze(e,_t)}const tV=n=>({nodesConnectable:n.nodesConnectable,isValid:n.connection.isValid,inProgress:n.connection.inProgress,width:n.width,height:n.height});function nV({containerStyle:n,style:e,type:r,component:i}){const{nodesConnectable:s,width:o,height:a,isValid:c,inProgress:l}=Ze(tV,_t);return!(o&&s&&l)?null:f.jsx("svg",{style:n,width:o,height:a,className:"react-flow__connectionline react-flow__container",children:f.jsx("g",{className:zt(["react-flow__connection",XN(c)]),children:f.jsx(Q3,{style:e,type:r,CustomComponent:i,isValid:c})})})}const Q3=({style:n,type:e=Ps.Bezier,CustomComponent:r,isValid:i})=>{const{inProgress:s,from:o,fromNode:a,fromHandle:c,fromPosition:l,to:u,toNode:d,toHandle:h,toPosition:p,pointer:g}=eV();if(!s)return;if(r)return f.jsx(r,{connectionLineType:e,connectionLineStyle:n,fromNode:a,fromHandle:c,fromX:o.x,fromY:o.y,toX:u.x,toY:u.y,fromPosition:l,toPosition:p,connectionStatus:XN(i),toNode:d,toHandle:h,pointer:g});let y="";const v={sourceX:o.x,sourceY:o.y,sourcePosition:l,targetX:u.x,targetY:u.y,targetPosition:p};switch(e){case Ps.Bezier:[y]=c3(v);break;case Ps.SimpleBezier:[y]=z3(v);break;case Ps.Step:[y]=rw({...v,borderRadius:0});break;case Ps.SmoothStep:[y]=rw(v);break;default:[y]=u3(v)}return f.jsx("path",{d:y,fill:"none",className:"react-flow__connection-path",style:n})};Q3.displayName="ConnectionLine";const rV={};function ZP(n=rV){E.useRef(n),Pt(),E.useEffect(()=>{},[n])}function iV(){Pt(),E.useRef(!1),E.useEffect(()=>{},[])}function J3({nodeTypes:n,edgeTypes:e,onInit:r,onNodeClick:i,onEdgeClick:s,onNodeDoubleClick:o,onEdgeDoubleClick:a,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:d,onSelectionContextMenu:h,onSelectionStart:p,onSelectionEnd:g,connectionLineType:y,connectionLineStyle:v,connectionLineComponent:x,connectionLineContainerStyle:m,selectionKeyCode:b,selectionOnDrag:S,selectionMode:w,multiSelectionKeyCode:I,panActivationKeyCode:C,zoomActivationKeyCode:_,deleteKeyCode:P,onlyRenderVisibleElements:M,elementsSelectable:T,defaultViewport:A,translateExtent:R,minZoom:O,maxZoom:j,preventScrolling:D,defaultMarkerColor:N,zoomOnScroll:F,zoomOnPinch:z,panOnScroll:$,panOnScrollSpeed:G,panOnScrollMode:X,zoomOnDoubleClick:ee,panOnDrag:re,onPaneClick:B,onPaneMouseEnter:U,onPaneMouseMove:Q,onPaneMouseLeave:K,onPaneScroll:Y,onPaneContextMenu:V,paneClickDistance:ie,nodeClickDistance:ae,onEdgeContextMenu:ye,onEdgeMouseEnter:he,onEdgeMouseMove:xe,onEdgeMouseLeave:fe,reconnectRadius:me,onReconnect:we,onReconnectStart:st,onReconnectEnd:lt,noDragClassName:Ut,noWheelClassName:Bt,noPanClassName:se,disableKeyboardA11y:ve,nodeExtent:Se,rfId:Ke,viewport:ke,onViewportChange:Ne}){return ZP(n),ZP(e),iV(),YK(r),ZK(ke),f.jsx(xK,{onPaneClick:B,onPaneMouseEnter:U,onPaneMouseMove:Q,onPaneMouseLeave:K,onPaneContextMenu:V,onPaneScroll:Y,paneClickDistance:ie,deleteKeyCode:P,selectionKeyCode:b,selectionOnDrag:S,selectionMode:w,onSelectionStart:p,onSelectionEnd:g,multiSelectionKeyCode:I,panActivationKeyCode:C,zoomActivationKeyCode:_,elementsSelectable:T,zoomOnScroll:F,zoomOnPinch:z,zoomOnDoubleClick:ee,panOnScroll:$,panOnScrollSpeed:G,panOnScrollMode:X,panOnDrag:re,defaultViewport:A,translateExtent:R,minZoom:O,maxZoom:j,onSelectionContextMenu:h,preventScrolling:D,noDragClassName:Ut,noWheelClassName:Bt,noPanClassName:se,disableKeyboardA11y:ve,onViewportChange:Ne,isControlledViewport:!!ke,children:f.jsxs(WK,{children:[f.jsx(KK,{edgeTypes:e,onEdgeClick:s,onEdgeDoubleClick:a,onReconnect:we,onReconnectStart:st,onReconnectEnd:lt,onlyRenderVisibleElements:M,onEdgeContextMenu:ye,onEdgeMouseEnter:he,onEdgeMouseMove:xe,onEdgeMouseLeave:fe,reconnectRadius:me,defaultMarkerColor:N,noPanClassName:se,disableKeyboardA11y:ve,rfId:Ke}),f.jsx(nV,{style:v,type:y,component:x,containerStyle:m}),f.jsx("div",{className:"react-flow__edgelabel-renderer"}),f.jsx(kK,{nodeTypes:n,onNodeClick:i,onNodeDoubleClick:o,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:d,nodeClickDistance:ae,onlyRenderVisibleElements:M,noPanClassName:se,noDragClassName:Ut,disableKeyboardA11y:ve,nodeExtent:Se,rfId:Ke}),f.jsx("div",{className:"react-flow__viewport-portal"})]})})}J3.displayName="GraphView";const sV=E.memo(J3),QP=({nodes:n,edges:e,defaultNodes:r,defaultEdges:i,width:s,height:o,fitView:a,fitViewOptions:c,minZoom:l=.5,maxZoom:u=2,nodeOrigin:d,nodeExtent:h,zIndexMode:p="basic"}={})=>{const g=new Map,y=new Map,v=new Map,x=new Map,m=i??e??[],b=r??n??[],S=d??[0,0],w=h??ml;f3(v,x,m);const I=sw(b,g,y,{nodeOrigin:S,nodeExtent:w,zIndexMode:p});let C=[0,0,1];if(a&&s&&o){const _=ql(g,{filter:A=>!!((A.width||A.initialWidth)&&(A.height||A.initialHeight))}),{x:P,y:M,zoom:T}=_1(_,s,o,l,u,c?.padding??.1);C=[P,M,T]}return{rfId:"1",width:s??0,height:o??0,transform:C,nodes:b,nodesInitialized:I,nodeLookup:g,parentLookup:y,edges:m,edgeLookup:x,connectionLookup:v,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:r!==void 0,hasDefaultEdges:i!==void 0,panZoom:null,minZoom:l,maxZoom:u,translateExtent:ml,nodeExtent:w,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Ca.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:S,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:a??!1,fitViewOptions:c,fitViewResolver:null,connection:{...YN},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:SH,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:WN,zIndexMode:p,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},oV=({nodes:n,edges:e,defaultNodes:r,defaultEdges:i,width:s,height:o,fitView:a,fitViewOptions:c,minZoom:l,maxZoom:u,nodeOrigin:d,nodeExtent:h,zIndexMode:p})=>CG((g,y)=>{async function v(){const{nodeLookup:x,panZoom:m,fitViewOptions:b,fitViewResolver:S,width:w,height:I,minZoom:C,maxZoom:_}=y();m&&(await xH({nodes:x,width:w,height:I,panZoom:m,minZoom:C,maxZoom:_},b),S?.resolve(!0),g({fitViewResolver:null}))}return{...QP({nodes:n,edges:e,width:s,height:o,fitView:a,fitViewOptions:c,minZoom:l,maxZoom:u,nodeOrigin:d,nodeExtent:h,defaultNodes:r,defaultEdges:i,zIndexMode:p}),setNodes:x=>{const{nodeLookup:m,parentLookup:b,nodeOrigin:S,elevateNodesOnSelect:w,fitViewQueued:I,zIndexMode:C}=y(),_=sw(x,m,b,{nodeOrigin:S,nodeExtent:h,elevateNodesOnSelect:w,checkEquality:!0,zIndexMode:C});I&&_?(v(),g({nodes:x,nodesInitialized:_,fitViewQueued:!1,fitViewOptions:void 0})):g({nodes:x,nodesInitialized:_})},setEdges:x=>{const{connectionLookup:m,edgeLookup:b}=y();f3(m,b,x),g({edges:x})},setDefaultNodesAndEdges:(x,m)=>{if(x){const{setNodes:b}=y();b(x),g({hasDefaultNodes:!0})}if(m){const{setEdges:b}=y();b(m),g({hasDefaultEdges:!0})}},updateNodeInternals:x=>{const{triggerNodeChanges:m,nodeLookup:b,parentLookup:S,domNode:w,nodeOrigin:I,nodeExtent:C,debug:_,fitViewQueued:P,zIndexMode:M}=y(),{changes:T,updatedInternals:A}=UH(x,b,S,w,I,C,M);A&&(FH(b,S,{nodeOrigin:I,nodeExtent:C,zIndexMode:M}),P?(v(),g({fitViewQueued:!1,fitViewOptions:void 0})):g({}),T?.length>0&&(_&&console.log("React Flow: trigger node changes",T),m?.(T)))},updateNodePositions:(x,m=!1)=>{const b=[];let S=[];const{nodeLookup:w,triggerNodeChanges:I,connection:C,updateConnection:_,onNodesChangeMiddlewareMap:P}=y();for(const[M,T]of x){const A=w.get(M),R=!!(A?.expandParent&&A?.parentId&&T?.position),O={id:M,type:"position",position:R?{x:Math.max(0,T.position.x),y:Math.max(0,T.position.y)}:T.position,dragging:m};if(A&&C.inProgress&&C.fromNode.id===A.id){const j=wo(A,C.fromHandle,Ce.Left,!0);_({...C,from:j})}R&&A.parentId&&b.push({id:M,parentId:A.parentId,rect:{...T.internals.positionAbsolute,width:T.measured.width??0,height:T.measured.height??0}}),S.push(O)}if(b.length>0){const{parentLookup:M,nodeOrigin:T}=y(),A=M1(b,w,M,T);S.push(...A)}for(const M of P.values())S=M(S);I(S)},triggerNodeChanges:x=>{const{onNodesChange:m,setNodes:b,nodes:S,hasDefaultNodes:w,debug:I}=y();if(x?.length){if(w){const C=k3(x,S);b(C)}I&&console.log("React Flow: trigger node changes",x),m?.(x)}},triggerEdgeChanges:x=>{const{onEdgesChange:m,setEdges:b,edges:S,hasDefaultEdges:w,debug:I}=y();if(x?.length){if(w){const C=T3(x,S);b(C)}I&&console.log("React Flow: trigger edge changes",x),m?.(x)}},addSelectedNodes:x=>{const{multiSelectionActive:m,edgeLookup:b,nodeLookup:S,triggerNodeChanges:w,triggerEdgeChanges:I}=y();if(m){const C=x.map(_=>so(_,!0));w(C);return}w(aa(S,new Set([...x]),!0)),I(aa(b))},addSelectedEdges:x=>{const{multiSelectionActive:m,edgeLookup:b,nodeLookup:S,triggerNodeChanges:w,triggerEdgeChanges:I}=y();if(m){const C=x.map(_=>so(_,!0));I(C);return}I(aa(b,new Set([...x]))),w(aa(S,new Set,!0))},unselectNodesAndEdges:({nodes:x,edges:m}={})=>{const{edges:b,nodes:S,nodeLookup:w,triggerNodeChanges:I,triggerEdgeChanges:C}=y(),_=x||S,P=m||b,M=_.map(A=>{const R=w.get(A.id);return R&&(R.selected=!1),so(A.id,!1)}),T=P.map(A=>so(A.id,!1));I(M),C(T)},setMinZoom:x=>{const{panZoom:m,maxZoom:b}=y();m?.setScaleExtent([x,b]),g({minZoom:x})},setMaxZoom:x=>{const{panZoom:m,minZoom:b}=y();m?.setScaleExtent([b,x]),g({maxZoom:x})},setTranslateExtent:x=>{y().panZoom?.setTranslateExtent(x),g({translateExtent:x})},resetSelectedElements:()=>{const{edges:x,nodes:m,triggerNodeChanges:b,triggerEdgeChanges:S,elementsSelectable:w}=y();if(!w)return;const I=m.reduce((_,P)=>P.selected?[..._,so(P.id,!1)]:_,[]),C=x.reduce((_,P)=>P.selected?[..._,so(P.id,!1)]:_,[]);b(I),S(C)},setNodeExtent:x=>{const{nodes:m,nodeLookup:b,parentLookup:S,nodeOrigin:w,elevateNodesOnSelect:I,nodeExtent:C,zIndexMode:_}=y();x[0][0]===C[0][0]&&x[0][1]===C[0][1]&&x[1][0]===C[1][0]&&x[1][1]===C[1][1]||(sw(m,b,S,{nodeOrigin:w,nodeExtent:x,elevateNodesOnSelect:I,checkEquality:!1,zIndexMode:_}),g({nodeExtent:x}))},panBy:x=>{const{transform:m,width:b,height:S,panZoom:w,translateExtent:I}=y();return qH({delta:x,panZoom:w,transform:m,translateExtent:I,width:b,height:S})},setCenter:async(x,m,b)=>{const{width:S,height:w,maxZoom:I,panZoom:C}=y();if(!C)return Promise.resolve(!1);const _=typeof b?.zoom<"u"?b.zoom:I;return await C.setViewport({x:S/2-x*_,y:w/2-m*_,zoom:_},{duration:b?.duration,ease:b?.ease,interpolate:b?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{g({connection:{...YN}})},updateConnection:x=>{g({connection:x})},reset:()=>g({...QP()})}},Object.is);function aV({initialNodes:n,initialEdges:e,defaultNodes:r,defaultEdges:i,initialWidth:s,initialHeight:o,initialMinZoom:a,initialMaxZoom:c,initialFitViewOptions:l,fitView:u,nodeOrigin:d,nodeExtent:h,zIndexMode:p,children:g}){const[y]=E.useState(()=>oV({nodes:n,edges:e,defaultNodes:r,defaultEdges:i,width:s,height:o,fitView:u,minZoom:a,maxZoom:c,fitViewOptions:l,nodeOrigin:d,nodeExtent:h,zIndexMode:p}));return f.jsx(PG,{value:y,children:f.jsx(WG,{children:g})})}function cV({children:n,nodes:e,edges:r,defaultNodes:i,defaultEdges:s,width:o,height:a,fitView:c,fitViewOptions:l,minZoom:u,maxZoom:d,nodeOrigin:h,nodeExtent:p,zIndexMode:g}){return E.useContext(qh)?f.jsx(f.Fragment,{children:n}):f.jsx(aV,{initialNodes:e,initialEdges:r,defaultNodes:i,defaultEdges:s,initialWidth:o,initialHeight:a,fitView:c,initialFitViewOptions:l,initialMinZoom:u,initialMaxZoom:d,nodeOrigin:h,nodeExtent:p,zIndexMode:g,children:n})}const lV={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function uV({nodes:n,edges:e,defaultNodes:r,defaultEdges:i,className:s,nodeTypes:o,edgeTypes:a,onNodeClick:c,onEdgeClick:l,onInit:u,onMove:d,onMoveStart:h,onMoveEnd:p,onConnect:g,onConnectStart:y,onConnectEnd:v,onClickConnectStart:x,onClickConnectEnd:m,onNodeMouseEnter:b,onNodeMouseMove:S,onNodeMouseLeave:w,onNodeContextMenu:I,onNodeDoubleClick:C,onNodeDragStart:_,onNodeDrag:P,onNodeDragStop:M,onNodesDelete:T,onEdgesDelete:A,onDelete:R,onSelectionChange:O,onSelectionDragStart:j,onSelectionDrag:D,onSelectionDragStop:N,onSelectionContextMenu:F,onSelectionStart:z,onSelectionEnd:$,onBeforeDelete:G,connectionMode:X,connectionLineType:ee=Ps.Bezier,connectionLineStyle:re,connectionLineComponent:B,connectionLineContainerStyle:U,deleteKeyCode:Q="Backspace",selectionKeyCode:K="Shift",selectionOnDrag:Y=!1,selectionMode:V=yl.Full,panActivationKeyCode:ie="Space",multiSelectionKeyCode:ae=xl()?"Meta":"Control",zoomActivationKeyCode:ye=xl()?"Meta":"Control",snapToGrid:he,snapGrid:xe,onlyRenderVisibleElements:fe=!1,selectNodesOnDrag:me,nodesDraggable:we,autoPanOnNodeFocus:st,nodesConnectable:lt,nodesFocusable:Ut,nodeOrigin:Bt=I3,edgesFocusable:se,edgesReconnectable:ve,elementsSelectable:Se=!0,defaultViewport:Ke=FG,minZoom:ke=.5,maxZoom:Ne=2,translateExtent:ut=ml,preventScrolling:Xe=!0,nodeExtent:J,defaultMarkerColor:le="#b1b1b7",zoomOnScroll:ge=!0,zoomOnPinch:Le=!0,panOnScroll:Re=!1,panOnScrollSpeed:hn=.5,panOnScrollMode:Xs=po.Free,zoomOnDoubleClick:Nr=!0,panOnDrag:Lr=!0,onPaneClick:pr,onPaneMouseEnter:Fr,onPaneMouseMove:Mi,onPaneMouseLeave:qo,onPaneScroll:Ja,onPaneContextMenu:Zs,paneClickDistance:ec=1,nodeClickDistance:tc=0,children:nc,onReconnect:Qs,onReconnectStart:Zf,onReconnectEnd:Qf,onEdgeContextMenu:Jf,onEdgeDoubleClick:ep,onEdgeMouseEnter:tp,onEdgeMouseMove:yu,onEdgeMouseLeave:rc,reconnectRadius:Ai=10,onNodesChange:np,onEdgesChange:rp,noDragClassName:ip="nodrag",noWheelClassName:sp="nowheel",noPanClassName:vu="nopan",fitView:gr,fitViewOptions:xu,connectOnClick:op,attributionPosition:ap,proOptions:cp,defaultEdgeOptions:lp,elevateNodesOnSelect:ji=!0,elevateEdgesOnSelect:up=!1,disableKeyboardA11y:bu=!1,autoPanOnConnect:dp,autoPanOnNodeDrag:hp,autoPanSpeed:fp,connectionRadius:Ho,isValidConnection:pp,onError:gp,style:ii,id:Su,nodeDragThreshold:mp,connectionDragThreshold:yp,viewport:vp,onViewportChange:xp,width:bp,height:Go,colorMode:Sp="light",debug:Js,onScroll:ic,ariaLabelConfig:wu,zIndexMode:_u="basic",...wp},_p){const sc=Su||"1",Cu=UG(Sp),Cp=E.useCallback(Pu=>{Pu.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),ic?.(Pu)},[ic]);return f.jsx("div",{"data-testid":"rf__wrapper",...wp,onScroll:Cp,style:{...ii,...lV},ref:_p,className:zt(["react-flow",s,Cu]),id:Su,role:"application",children:f.jsxs(cV,{nodes:n,edges:e,width:bp,height:Go,fitView:gr,fitViewOptions:xu,minZoom:ke,maxZoom:Ne,nodeOrigin:Bt,nodeExtent:J,zIndexMode:_u,children:[f.jsx(sV,{onInit:u,onNodeClick:c,onEdgeClick:l,onNodeMouseEnter:b,onNodeMouseMove:S,onNodeMouseLeave:w,onNodeContextMenu:I,onNodeDoubleClick:C,nodeTypes:o,edgeTypes:a,connectionLineType:ee,connectionLineStyle:re,connectionLineComponent:B,connectionLineContainerStyle:U,selectionKeyCode:K,selectionOnDrag:Y,selectionMode:V,deleteKeyCode:Q,multiSelectionKeyCode:ae,panActivationKeyCode:ie,zoomActivationKeyCode:ye,onlyRenderVisibleElements:fe,defaultViewport:Ke,translateExtent:ut,minZoom:ke,maxZoom:Ne,preventScrolling:Xe,zoomOnScroll:ge,zoomOnPinch:Le,zoomOnDoubleClick:Nr,panOnScroll:Re,panOnScrollSpeed:hn,panOnScrollMode:Xs,panOnDrag:Lr,onPaneClick:pr,onPaneMouseEnter:Fr,onPaneMouseMove:Mi,onPaneMouseLeave:qo,onPaneScroll:Ja,onPaneContextMenu:Zs,paneClickDistance:ec,nodeClickDistance:tc,onSelectionContextMenu:F,onSelectionStart:z,onSelectionEnd:$,onReconnect:Qs,onReconnectStart:Zf,onReconnectEnd:Qf,onEdgeContextMenu:Jf,onEdgeDoubleClick:ep,onEdgeMouseEnter:tp,onEdgeMouseMove:yu,onEdgeMouseLeave:rc,reconnectRadius:Ai,defaultMarkerColor:le,noDragClassName:ip,noWheelClassName:sp,noPanClassName:vu,rfId:sc,disableKeyboardA11y:bu,nodeExtent:J,viewport:vp,onViewportChange:xp}),f.jsx(BG,{nodes:n,edges:e,defaultNodes:r,defaultEdges:i,onConnect:g,onConnectStart:y,onConnectEnd:v,onClickConnectStart:x,onClickConnectEnd:m,nodesDraggable:we,autoPanOnNodeFocus:st,nodesConnectable:lt,nodesFocusable:Ut,edgesFocusable:se,edgesReconnectable:ve,elementsSelectable:Se,elevateNodesOnSelect:ji,elevateEdgesOnSelect:up,minZoom:ke,maxZoom:Ne,nodeExtent:J,onNodesChange:np,onEdgesChange:rp,snapToGrid:he,snapGrid:xe,connectionMode:X,translateExtent:ut,connectOnClick:op,defaultEdgeOptions:lp,fitView:gr,fitViewOptions:xu,onNodesDelete:T,onEdgesDelete:A,onDelete:R,onNodeDragStart:_,onNodeDrag:P,onNodeDragStop:M,onSelectionDrag:D,onSelectionDragStart:j,onSelectionDragStop:N,onMove:d,onMoveStart:h,onMoveEnd:p,noPanClassName:vu,nodeOrigin:Bt,rfId:sc,autoPanOnConnect:dp,autoPanOnNodeDrag:hp,autoPanSpeed:fp,onError:gp,connectionRadius:Ho,isValidConnection:pp,selectNodesOnDrag:me,nodeDragThreshold:mp,connectionDragThreshold:yp,onBeforeDelete:G,debug:Js,ariaLabelConfig:wu,zIndexMode:_u}),f.jsx(LG,{onSelectionChange:O}),nc,f.jsx(jG,{proOptions:cp,position:ap}),f.jsx(AG,{rfId:sc,disableKeyboardA11y:bu})]})})}var e5=M3(uV);function t5(n){const[e,r]=E.useState(n),i=E.useCallback(s=>r(o=>k3(s,o)),[]);return[e,r,i]}function n5(n){const[e,r]=E.useState(n),i=E.useCallback(s=>r(o=>T3(s,o)),[]);return[e,r,i]}function dV({dimensions:n,lineWidth:e,variant:r,className:i}){return f.jsx("path",{strokeWidth:e,d:`M${n[0]/2} 0 V${n[1]} M0 ${n[1]/2} H${n[0]}`,className:zt(["react-flow__background-pattern",r,i])})}function hV({radius:n,className:e}){return f.jsx("circle",{cx:n,cy:n,r:n,className:zt(["react-flow__background-pattern","dots",e])})}var As;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(As||(As={}));const fV={[As.Dots]:1,[As.Lines]:1,[As.Cross]:6},pV=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function r5({id:n,variant:e=As.Dots,gap:r=20,size:i,lineWidth:s=1,offset:o=0,color:a,bgColor:c,style:l,className:u,patternClassName:d}){const h=E.useRef(null),{transform:p,patternId:g}=Ze(pV,_t),y=i||fV[e],v=e===As.Dots,x=e===As.Cross,m=Array.isArray(r)?r:[r,r],b=[m[0]*p[2]||1,m[1]*p[2]||1],S=y*p[2],w=Array.isArray(o)?o:[o,o],I=x?[S,S]:b,C=[w[0]*p[2]||1+I[0]/2,w[1]*p[2]||1+I[1]/2],_=`${g}${n||""}`;return f.jsxs("svg",{className:zt(["react-flow__background",u]),style:{...l,...Gh,"--xy-background-color-props":c,"--xy-background-pattern-color-props":a},ref:h,"data-testid":"rf__background",children:[f.jsx("pattern",{id:_,x:p[0]%b[0],y:p[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:v?f.jsx(hV,{radius:S/2,className:d}):f.jsx(dV,{dimensions:I,lineWidth:s,variant:e,className:d})}),f.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${_})`})]})}r5.displayName="Background";const i5=E.memo(r5);function gV(){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:f.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function mV(){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:f.jsx("path",{d:"M0 0h32v4.2H0z"})})}function yV(){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:f.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function vV(){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:f.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function xV(){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:f.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Fu({children:n,className:e,...r}){return f.jsx("button",{type:"button",className:zt(["react-flow__controls-button",e]),...r,children:n})}const bV=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom,ariaLabelConfig:n.ariaLabelConfig});function s5({style:n,showZoom:e=!0,showFitView:r=!0,showInteractive:i=!0,fitViewOptions:s,onZoomIn:o,onZoomOut:a,onFitView:c,onInteractiveChange:l,className:u,children:d,position:h="bottom-left",orientation:p="vertical","aria-label":g}){const y=Pt(),{isInteractive:v,minZoomReached:x,maxZoomReached:m,ariaLabelConfig:b}=Ze(bV,_t),{zoomIn:S,zoomOut:w,fitView:I}=A1(),C=()=>{S(),o?.()},_=()=>{w(),a?.()},P=()=>{I(s),c?.()},M=()=>{y.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),l?.(!v)},T=p==="horizontal"?"horizontal":"vertical";return f.jsxs(Hh,{className:zt(["react-flow__controls",T,u]),position:h,style:n,"data-testid":"rf__controls","aria-label":g??b["controls.ariaLabel"],children:[e&&f.jsxs(f.Fragment,{children:[f.jsx(Fu,{onClick:C,className:"react-flow__controls-zoomin",title:b["controls.zoomIn.ariaLabel"],"aria-label":b["controls.zoomIn.ariaLabel"],disabled:m,children:f.jsx(gV,{})}),f.jsx(Fu,{onClick:_,className:"react-flow__controls-zoomout",title:b["controls.zoomOut.ariaLabel"],"aria-label":b["controls.zoomOut.ariaLabel"],disabled:x,children:f.jsx(mV,{})})]}),r&&f.jsx(Fu,{className:"react-flow__controls-fitview",onClick:P,title:b["controls.fitView.ariaLabel"],"aria-label":b["controls.fitView.ariaLabel"],children:f.jsx(yV,{})}),i&&f.jsx(Fu,{className:"react-flow__controls-interactive",onClick:M,title:b["controls.interactive.ariaLabel"],"aria-label":b["controls.interactive.ariaLabel"],children:v?f.jsx(xV,{}):f.jsx(vV,{})}),d]})}s5.displayName="Controls";const o5=E.memo(s5);function SV({id:n,x:e,y:r,width:i,height:s,style:o,color:a,strokeColor:c,strokeWidth:l,className:u,borderRadius:d,shapeRendering:h,selected:p,onClick:g}){const{background:y,backgroundColor:v}=o||{},x=a||y||v;return f.jsx("rect",{className:zt(["react-flow__minimap-node",{selected:p},u]),x:e,y:r,rx:d,ry:d,width:i,height:s,style:{fill:x,stroke:c,strokeWidth:l},shapeRendering:h,onClick:g?m=>g(m,n):void 0})}const wV=E.memo(SV),_V=n=>n.nodes.map(e=>e.id),Lp=n=>n instanceof Function?n:()=>n;function CV({nodeStrokeColor:n,nodeColor:e,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:s,nodeComponent:o=wV,onClick:a}){const c=Ze(_V,_t),l=Lp(e),u=Lp(n),d=Lp(r),h=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return f.jsx(f.Fragment,{children:c.map(p=>f.jsx(IV,{id:p,nodeColorFunc:l,nodeStrokeColorFunc:u,nodeClassNameFunc:d,nodeBorderRadius:i,nodeStrokeWidth:s,NodeComponent:o,onClick:a,shapeRendering:h},p))})}function PV({id:n,nodeColorFunc:e,nodeStrokeColorFunc:r,nodeClassNameFunc:i,nodeBorderRadius:s,nodeStrokeWidth:o,shapeRendering:a,NodeComponent:c,onClick:l}){const{node:u,x:d,y:h,width:p,height:g}=Ze(y=>{const{internals:v}=y.nodeLookup.get(n),x=v.userNode,{x:m,y:b}=v.positionAbsolute,{width:S,height:w}=is(x);return{node:x,x:m,y:b,width:S,height:w}},_t);return!u||u.hidden||!n3(u)?null:f.jsx(c,{x:d,y:h,width:p,height:g,style:u.style,selected:!!u.selected,className:i(u),color:e(u),borderRadius:s,strokeColor:r(u),strokeWidth:o,shapeRendering:a,onClick:l,id:u.id})}const IV=E.memo(PV);var EV=E.memo(CV);const kV=200,TV=150,MV=n=>!n.hidden,AV=n=>{const e={x:-n.transform[0]/n.transform[2],y:-n.transform[1]/n.transform[2],width:n.width/n.transform[2],height:n.height/n.transform[2]};return{viewBB:e,boundingRect:n.nodeLookup.size>0?t3(ql(n.nodeLookup,{filter:MV}),e):e,rfId:n.rfId,panZoom:n.panZoom,translateExtent:n.translateExtent,flowWidth:n.width,flowHeight:n.height,ariaLabelConfig:n.ariaLabelConfig}},jV="react-flow__minimap-desc";function a5({style:n,className:e,nodeStrokeColor:r,nodeColor:i,nodeClassName:s="",nodeBorderRadius:o=5,nodeStrokeWidth:a,nodeComponent:c,bgColor:l,maskColor:u,maskStrokeColor:d,maskStrokeWidth:h,position:p="bottom-right",onClick:g,onNodeClick:y,pannable:v=!1,zoomable:x=!1,ariaLabel:m,inversePan:b,zoomStep:S=1,offsetScale:w=5}){const I=Pt(),C=E.useRef(null),{boundingRect:_,viewBB:P,rfId:M,panZoom:T,translateExtent:A,flowWidth:R,flowHeight:O,ariaLabelConfig:j}=Ze(AV,_t),D=n?.width??kV,N=n?.height??TV,F=_.width/D,z=_.height/N,$=Math.max(F,z),G=$*D,X=$*N,ee=w*$,re=_.x-(G-_.width)/2-ee,B=_.y-(X-_.height)/2-ee,U=G+ee*2,Q=X+ee*2,K=`${jV}-${M}`,Y=E.useRef(0),V=E.useRef();Y.current=$,E.useEffect(()=>{if(C.current&&T)return V.current=QH({domNode:C.current,panZoom:T,getTransform:()=>I.getState().transform,getViewScale:()=>Y.current}),()=>{V.current?.destroy()}},[T]),E.useEffect(()=>{V.current?.update({translateExtent:A,width:R,height:O,inversePan:b,pannable:v,zoomStep:S,zoomable:x})},[v,x,b,S,A,R,O]);const ie=g?he=>{const[xe,fe]=V.current?.pointer(he)||[0,0];g(he,{x:xe,y:fe})}:void 0,ae=y?E.useCallback((he,xe)=>{const fe=I.getState().nodeLookup.get(xe).internals.userNode;y(he,fe)},[]):void 0,ye=m??j["minimap.ariaLabel"];return f.jsx(Hh,{position:p,style:{...n,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof h=="number"?h*$:void 0,"--xy-minimap-node-background-color-props":typeof i=="string"?i:void 0,"--xy-minimap-node-stroke-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-width-props":typeof a=="number"?a:void 0},className:zt(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:f.jsxs("svg",{width:D,height:N,viewBox:`${re} ${B} ${U} ${Q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":K,ref:C,onClick:ie,children:[ye&&f.jsx("title",{id:K,children:ye}),f.jsx(EV,{onClick:ae,nodeColor:i,nodeStrokeColor:r,nodeBorderRadius:o,nodeClassName:s,nodeStrokeWidth:a,nodeComponent:c}),f.jsx("path",{className:"react-flow__minimap-mask",d:`M${re-ee},${B-ee}h${U+ee*2}v${Q+ee*2}h${-U-ee*2}z
        M${P.x},${P.y}h${P.width}v${P.height}h${-P.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}a5.displayName="MiniMap";const c5=E.memo(a5),RV=n=>e=>n?`${Math.max(1/e.transform[2],1)}`:void 0,OV={[_o.Line]:"right",[_o.Handle]:"bottom-right"};function DV({nodeId:n,position:e,variant:r=_o.Handle,className:i,style:s=void 0,children:o,color:a,minWidth:c=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:h=!1,resizeDirection:p,autoScale:g=!0,shouldResize:y,onResizeStart:v,onResize:x,onResizeEnd:m}){const b=O3(),S=typeof n=="string"?n:b,w=Pt(),I=E.useRef(null),C=r===_o.Handle,_=Ze(E.useCallback(RV(C&&g),[C,g]),_t),P=E.useRef(null),M=e??OV[r];E.useEffect(()=>{if(!(!I.current||!S))return P.current||(P.current=pG({domNode:I.current,nodeId:S,getStoreItems:()=>{const{nodeLookup:A,transform:R,snapGrid:O,snapToGrid:j,nodeOrigin:D,domNode:N}=w.getState();return{nodeLookup:A,transform:R,snapGrid:O,snapToGrid:j,nodeOrigin:D,paneDomNode:N}},onChange:(A,R)=>{const{triggerNodeChanges:O,nodeLookup:j,parentLookup:D,nodeOrigin:N}=w.getState(),F=[],z={x:A.x,y:A.y},$=j.get(S);if($&&$.expandParent&&$.parentId){const G=$.origin??N,X=A.width??$.measured.width??0,ee=A.height??$.measured.height??0,re={id:$.id,parentId:$.parentId,rect:{width:X,height:ee,...r3({x:A.x??$.position.x,y:A.y??$.position.y},{width:X,height:ee},$.parentId,j,G)}},B=M1([re],j,D,N);F.push(...B),z.x=A.x?Math.max(G[0]*X,A.x):void 0,z.y=A.y?Math.max(G[1]*ee,A.y):void 0}if(z.x!==void 0&&z.y!==void 0){const G={id:S,type:"position",position:{...z}};F.push(G)}if(A.width!==void 0&&A.height!==void 0){const X={id:S,type:"dimensions",resizing:!0,setAttributes:p?p==="horizontal"?"width":"height":!0,dimensions:{width:A.width,height:A.height}};F.push(X)}for(const G of R){const X={...G,type:"position"};F.push(X)}O(F)},onEnd:({width:A,height:R})=>{const O={id:S,type:"dimensions",resizing:!1,dimensions:{width:A,height:R}};w.getState().triggerNodeChanges([O])}})),P.current.update({controlPosition:M,boundaries:{minWidth:c,minHeight:l,maxWidth:u,maxHeight:d},keepAspectRatio:h,resizeDirection:p,onResizeStart:v,onResize:x,onResizeEnd:m,shouldResize:y}),()=>{P.current?.destroy()}},[M,c,l,u,d,h,v,x,m,y]);const T=M.split("-");return f.jsx("div",{className:zt(["react-flow__resize-control","nodrag",...T,r,i]),ref:I,style:{...s,scale:_,...a&&{[C?"backgroundColor":"borderColor"]:a}},children:o})}const JP=E.memo(DV);function l5({nodeId:n,isVisible:e=!0,handleClassName:r,handleStyle:i,lineClassName:s,lineStyle:o,color:a,minWidth:c=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:h=!1,autoScale:p=!0,shouldResize:g,onResizeStart:y,onResize:v,onResizeEnd:x}){return e?f.jsxs(f.Fragment,{children:[cG.map(m=>f.jsx(JP,{className:s,style:o,nodeId:n,position:m,variant:_o.Line,color:a,minWidth:c,minHeight:l,maxWidth:u,maxHeight:d,onResizeStart:y,keepAspectRatio:h,autoScale:p,shouldResize:g,onResize:v,onResizeEnd:x},m)),aG.map(m=>f.jsx(JP,{className:r,style:i,nodeId:n,position:m,color:a,minWidth:c,minHeight:l,maxWidth:u,maxHeight:d,onResizeStart:y,keepAspectRatio:h,autoScale:p,shouldResize:g,onResize:v,onResizeEnd:x},m))]}):null}function R1(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fp,eI;function NV(){if(eI)return Fp;eI=1;function n(){this.__data__=[],this.size=0}return Fp=n,Fp}var zp,tI;function Fa(){if(tI)return zp;tI=1;function n(e,r){return e===r||e!==e&&r!==r}return zp=n,zp}var $p,nI;function Vh(){if(nI)return $p;nI=1;var n=Fa();function e(r,i){for(var s=r.length;s--;)if(n(r[s][0],i))return s;return-1}return $p=e,$p}var Bp,rI;function LV(){if(rI)return Bp;rI=1;var n=Vh(),e=Array.prototype,r=e.splice;function i(s){var o=this.__data__,a=n(o,s);if(a<0)return!1;var c=o.length-1;return a==c?o.pop():r.call(o,a,1),--this.size,!0}return Bp=i,Bp}var Up,iI;function FV(){if(iI)return Up;iI=1;var n=Vh();function e(r){var i=this.__data__,s=n(i,r);return s<0?void 0:i[s][1]}return Up=e,Up}var qp,sI;function zV(){if(sI)return qp;sI=1;var n=Vh();function e(r){return n(this.__data__,r)>-1}return qp=e,qp}var Hp,oI;function $V(){if(oI)return Hp;oI=1;var n=Vh();function e(r,i){var s=this.__data__,o=n(s,r);return o<0?(++this.size,s.push([r,i])):s[o][1]=i,this}return Hp=e,Hp}var Gp,aI;function Wh(){if(aI)return Gp;aI=1;var n=NV(),e=LV(),r=FV(),i=zV(),s=$V();function o(a){var c=-1,l=a==null?0:a.length;for(this.clear();++c<l;){var u=a[c];this.set(u[0],u[1])}}return o.prototype.clear=n,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,Gp=o,Gp}var Kp,cI;function BV(){if(cI)return Kp;cI=1;var n=Wh();function e(){this.__data__=new n,this.size=0}return Kp=e,Kp}var Vp,lI;function UV(){if(lI)return Vp;lI=1;function n(e){var r=this.__data__,i=r.delete(e);return this.size=r.size,i}return Vp=n,Vp}var Wp,uI;function qV(){if(uI)return Wp;uI=1;function n(e){return this.__data__.get(e)}return Wp=n,Wp}var Yp,dI;function HV(){if(dI)return Yp;dI=1;function n(e){return this.__data__.has(e)}return Yp=n,Yp}var Xp,hI;function u5(){if(hI)return Xp;hI=1;var n=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt;return Xp=n,Xp}var Zp,fI;function ei(){if(fI)return Zp;fI=1;var n=u5(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=n||e||Function("return this")();return Zp=r,Zp}var Qp,pI;function za(){if(pI)return Qp;pI=1;var n=ei(),e=n.Symbol;return Qp=e,Qp}var Jp,gI;function GV(){if(gI)return Jp;gI=1;var n=za(),e=Object.prototype,r=e.hasOwnProperty,i=e.toString,s=n?n.toStringTag:void 0;function o(a){var c=r.call(a,s),l=a[s];try{a[s]=void 0;var u=!0}catch{}var d=i.call(a);return u&&(c?a[s]=l:delete a[s]),d}return Jp=o,Jp}var eg,mI;function KV(){if(mI)return eg;mI=1;var n=Object.prototype,e=n.toString;function r(i){return e.call(i)}return eg=r,eg}var tg,yI;function Oo(){if(yI)return tg;yI=1;var n=za(),e=GV(),r=KV(),i="[object Null]",s="[object Undefined]",o=n?n.toStringTag:void 0;function a(c){return c==null?c===void 0?s:i:o&&o in Object(c)?e(c):r(c)}return tg=a,tg}var ng,vI;function jr(){if(vI)return ng;vI=1;function n(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return ng=n,ng}var rg,xI;function Kl(){if(xI)return rg;xI=1;var n=Oo(),e=jr(),r="[object AsyncFunction]",i="[object Function]",s="[object GeneratorFunction]",o="[object Proxy]";function a(c){if(!e(c))return!1;var l=n(c);return l==i||l==s||l==r||l==o}return rg=a,rg}var ig,bI;function VV(){if(bI)return ig;bI=1;var n=ei(),e=n["__core-js_shared__"];return ig=e,ig}var sg,SI;function WV(){if(SI)return sg;SI=1;var n=VV(),e=(function(){var i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""})();function r(i){return!!e&&e in i}return sg=r,sg}var og,wI;function d5(){if(wI)return og;wI=1;var n=Function.prototype,e=n.toString;function r(i){if(i!=null){try{return e.call(i)}catch{}try{return i+""}catch{}}return""}return og=r,og}var ag,_I;function YV(){if(_I)return ag;_I=1;var n=Kl(),e=WV(),r=jr(),i=d5(),s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=Function.prototype,c=Object.prototype,l=a.toString,u=c.hasOwnProperty,d=RegExp("^"+l.call(u).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(p){if(!r(p)||e(p))return!1;var g=n(p)?d:o;return g.test(i(p))}return ag=h,ag}var cg,CI;function XV(){if(CI)return cg;CI=1;function n(e,r){return e?.[r]}return cg=n,cg}var lg,PI;function Do(){if(PI)return lg;PI=1;var n=YV(),e=XV();function r(i,s){var o=e(i,s);return n(o)?o:void 0}return lg=r,lg}var ug,II;function O1(){if(II)return ug;II=1;var n=Do(),e=ei(),r=n(e,"Map");return ug=r,ug}var dg,EI;function Yh(){if(EI)return dg;EI=1;var n=Do(),e=n(Object,"create");return dg=e,dg}var hg,kI;function ZV(){if(kI)return hg;kI=1;var n=Yh();function e(){this.__data__=n?n(null):{},this.size=0}return hg=e,hg}var fg,TI;function QV(){if(TI)return fg;TI=1;function n(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return fg=n,fg}var pg,MI;function JV(){if(MI)return pg;MI=1;var n=Yh(),e="__lodash_hash_undefined__",r=Object.prototype,i=r.hasOwnProperty;function s(o){var a=this.__data__;if(n){var c=a[o];return c===e?void 0:c}return i.call(a,o)?a[o]:void 0}return pg=s,pg}var gg,AI;function eW(){if(AI)return gg;AI=1;var n=Yh(),e=Object.prototype,r=e.hasOwnProperty;function i(s){var o=this.__data__;return n?o[s]!==void 0:r.call(o,s)}return gg=i,gg}var mg,jI;function tW(){if(jI)return mg;jI=1;var n=Yh(),e="__lodash_hash_undefined__";function r(i,s){var o=this.__data__;return this.size+=this.has(i)?0:1,o[i]=n&&s===void 0?e:s,this}return mg=r,mg}var yg,RI;function nW(){if(RI)return yg;RI=1;var n=ZV(),e=QV(),r=JV(),i=eW(),s=tW();function o(a){var c=-1,l=a==null?0:a.length;for(this.clear();++c<l;){var u=a[c];this.set(u[0],u[1])}}return o.prototype.clear=n,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,yg=o,yg}var vg,OI;function rW(){if(OI)return vg;OI=1;var n=nW(),e=Wh(),r=O1();function i(){this.size=0,this.__data__={hash:new n,map:new(r||e),string:new n}}return vg=i,vg}var xg,DI;function iW(){if(DI)return xg;DI=1;function n(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return xg=n,xg}var bg,NI;function Xh(){if(NI)return bg;NI=1;var n=iW();function e(r,i){var s=r.__data__;return n(i)?s[typeof i=="string"?"string":"hash"]:s.map}return bg=e,bg}var Sg,LI;function sW(){if(LI)return Sg;LI=1;var n=Xh();function e(r){var i=n(this,r).delete(r);return this.size-=i?1:0,i}return Sg=e,Sg}var wg,FI;function oW(){if(FI)return wg;FI=1;var n=Xh();function e(r){return n(this,r).get(r)}return wg=e,wg}var _g,zI;function aW(){if(zI)return _g;zI=1;var n=Xh();function e(r){return n(this,r).has(r)}return _g=e,_g}var Cg,$I;function cW(){if($I)return Cg;$I=1;var n=Xh();function e(r,i){var s=n(this,r),o=s.size;return s.set(r,i),this.size+=s.size==o?0:1,this}return Cg=e,Cg}var Pg,BI;function D1(){if(BI)return Pg;BI=1;var n=rW(),e=sW(),r=oW(),i=aW(),s=cW();function o(a){var c=-1,l=a==null?0:a.length;for(this.clear();++c<l;){var u=a[c];this.set(u[0],u[1])}}return o.prototype.clear=n,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,Pg=o,Pg}var Ig,UI;function lW(){if(UI)return Ig;UI=1;var n=Wh(),e=O1(),r=D1(),i=200;function s(o,a){var c=this.__data__;if(c instanceof n){var l=c.__data__;if(!e||l.length<i-1)return l.push([o,a]),this.size=++c.size,this;c=this.__data__=new r(l)}return c.set(o,a),this.size=c.size,this}return Ig=s,Ig}var Eg,qI;function Zh(){if(qI)return Eg;qI=1;var n=Wh(),e=BV(),r=UV(),i=qV(),s=HV(),o=lW();function a(c){var l=this.__data__=new n(c);this.size=l.size}return a.prototype.clear=e,a.prototype.delete=r,a.prototype.get=i,a.prototype.has=s,a.prototype.set=o,Eg=a,Eg}var kg,HI;function N1(){if(HI)return kg;HI=1;function n(e,r){for(var i=-1,s=e==null?0:e.length;++i<s&&r(e[i],i,e)!==!1;);return e}return kg=n,kg}var Tg,GI;function h5(){if(GI)return Tg;GI=1;var n=Do(),e=(function(){try{var r=n(Object,"defineProperty");return r({},"",{}),r}catch{}})();return Tg=e,Tg}var Mg,KI;function Qh(){if(KI)return Mg;KI=1;var n=h5();function e(r,i,s){i=="__proto__"&&n?n(r,i,{configurable:!0,enumerable:!0,value:s,writable:!0}):r[i]=s}return Mg=e,Mg}var Ag,VI;function Jh(){if(VI)return Ag;VI=1;var n=Qh(),e=Fa(),r=Object.prototype,i=r.hasOwnProperty;function s(o,a,c){var l=o[a];(!(i.call(o,a)&&e(l,c))||c===void 0&&!(a in o))&&n(o,a,c)}return Ag=s,Ag}var jg,WI;function Vl(){if(WI)return jg;WI=1;var n=Jh(),e=Qh();function r(i,s,o,a){var c=!o;o||(o={});for(var l=-1,u=s.length;++l<u;){var d=s[l],h=a?a(o[d],i[d],d,o,i):void 0;h===void 0&&(h=i[d]),c?e(o,d,h):n(o,d,h)}return o}return jg=r,jg}var Rg,YI;function uW(){if(YI)return Rg;YI=1;function n(e,r){for(var i=-1,s=Array(e);++i<e;)s[i]=r(i);return s}return Rg=n,Rg}var Og,XI;function Ei(){if(XI)return Og;XI=1;function n(e){return e!=null&&typeof e=="object"}return Og=n,Og}var Dg,ZI;function dW(){if(ZI)return Dg;ZI=1;var n=Oo(),e=Ei(),r="[object Arguments]";function i(s){return e(s)&&n(s)==r}return Dg=i,Dg}var Ng,QI;function Wl(){if(QI)return Ng;QI=1;var n=dW(),e=Ei(),r=Object.prototype,i=r.hasOwnProperty,s=r.propertyIsEnumerable,o=n((function(){return arguments})())?n:function(a){return e(a)&&i.call(a,"callee")&&!s.call(a,"callee")};return Ng=o,Ng}var Lg,JI;function $t(){if(JI)return Lg;JI=1;var n=Array.isArray;return Lg=n,Lg}var Oc={exports:{}},Fg,eE;function hW(){if(eE)return Fg;eE=1;function n(){return!1}return Fg=n,Fg}Oc.exports;var tE;function $a(){return tE||(tE=1,(function(n,e){var r=ei(),i=hW(),s=e&&!e.nodeType&&e,o=s&&!0&&n&&!n.nodeType&&n,a=o&&o.exports===s,c=a?r.Buffer:void 0,l=c?c.isBuffer:void 0,u=l||i;n.exports=u})(Oc,Oc.exports)),Oc.exports}var zg,nE;function ef(){if(nE)return zg;nE=1;var n=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(i,s){var o=typeof i;return s=s??n,!!s&&(o=="number"||o!="symbol"&&e.test(i))&&i>-1&&i%1==0&&i<s}return zg=r,zg}var $g,rE;function L1(){if(rE)return $g;rE=1;var n=9007199254740991;function e(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=n}return $g=e,$g}var Bg,iE;function fW(){if(iE)return Bg;iE=1;var n=Oo(),e=L1(),r=Ei(),i="[object Arguments]",s="[object Array]",o="[object Boolean]",a="[object Date]",c="[object Error]",l="[object Function]",u="[object Map]",d="[object Number]",h="[object Object]",p="[object RegExp]",g="[object Set]",y="[object String]",v="[object WeakMap]",x="[object ArrayBuffer]",m="[object DataView]",b="[object Float32Array]",S="[object Float64Array]",w="[object Int8Array]",I="[object Int16Array]",C="[object Int32Array]",_="[object Uint8Array]",P="[object Uint8ClampedArray]",M="[object Uint16Array]",T="[object Uint32Array]",A={};A[b]=A[S]=A[w]=A[I]=A[C]=A[_]=A[P]=A[M]=A[T]=!0,A[i]=A[s]=A[x]=A[o]=A[m]=A[a]=A[c]=A[l]=A[u]=A[d]=A[h]=A[p]=A[g]=A[y]=A[v]=!1;function R(O){return r(O)&&e(O.length)&&!!A[n(O)]}return Bg=R,Bg}var Ug,sE;function tf(){if(sE)return Ug;sE=1;function n(e){return function(r){return e(r)}}return Ug=n,Ug}var Dc={exports:{}};Dc.exports;var oE;function F1(){return oE||(oE=1,(function(n,e){var r=u5(),i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,a=o&&r.process,c=(function(){try{var l=s&&s.require&&s.require("util").types;return l||a&&a.binding&&a.binding("util")}catch{}})();n.exports=c})(Dc,Dc.exports)),Dc.exports}var qg,aE;function Yl(){if(aE)return qg;aE=1;var n=fW(),e=tf(),r=F1(),i=r&&r.isTypedArray,s=i?e(i):n;return qg=s,qg}var Hg,cE;function f5(){if(cE)return Hg;cE=1;var n=uW(),e=Wl(),r=$t(),i=$a(),s=ef(),o=Yl(),a=Object.prototype,c=a.hasOwnProperty;function l(u,d){var h=r(u),p=!h&&e(u),g=!h&&!p&&i(u),y=!h&&!p&&!g&&o(u),v=h||p||g||y,x=v?n(u.length,String):[],m=x.length;for(var b in u)(d||c.call(u,b))&&!(v&&(b=="length"||g&&(b=="offset"||b=="parent")||y&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||s(b,m)))&&x.push(b);return x}return Hg=l,Hg}var Gg,lE;function nf(){if(lE)return Gg;lE=1;var n=Object.prototype;function e(r){var i=r&&r.constructor,s=typeof i=="function"&&i.prototype||n;return r===s}return Gg=e,Gg}var Kg,uE;function p5(){if(uE)return Kg;uE=1;function n(e,r){return function(i){return e(r(i))}}return Kg=n,Kg}var Vg,dE;function pW(){if(dE)return Vg;dE=1;var n=p5(),e=n(Object.keys,Object);return Vg=e,Vg}var Wg,hE;function z1(){if(hE)return Wg;hE=1;var n=nf(),e=pW(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!n(o))return e(o);var a=[];for(var c in Object(o))i.call(o,c)&&c!="constructor"&&a.push(c);return a}return Wg=s,Wg}var Yg,fE;function ss(){if(fE)return Yg;fE=1;var n=Kl(),e=L1();function r(i){return i!=null&&e(i.length)&&!n(i)}return Yg=r,Yg}var Xg,pE;function Bs(){if(pE)return Xg;pE=1;var n=f5(),e=z1(),r=ss();function i(s){return r(s)?n(s):e(s)}return Xg=i,Xg}var Zg,gE;function gW(){if(gE)return Zg;gE=1;var n=Vl(),e=Bs();function r(i,s){return i&&n(s,e(s),i)}return Zg=r,Zg}var Qg,mE;function mW(){if(mE)return Qg;mE=1;function n(e){var r=[];if(e!=null)for(var i in Object(e))r.push(i);return r}return Qg=n,Qg}var Jg,yE;function yW(){if(yE)return Jg;yE=1;var n=jr(),e=nf(),r=mW(),i=Object.prototype,s=i.hasOwnProperty;function o(a){if(!n(a))return r(a);var c=e(a),l=[];for(var u in a)u=="constructor"&&(c||!s.call(a,u))||l.push(u);return l}return Jg=o,Jg}var em,vE;function No(){if(vE)return em;vE=1;var n=f5(),e=yW(),r=ss();function i(s){return r(s)?n(s,!0):e(s)}return em=i,em}var tm,xE;function vW(){if(xE)return tm;xE=1;var n=Vl(),e=No();function r(i,s){return i&&n(s,e(s),i)}return tm=r,tm}var Nc={exports:{}};Nc.exports;var bE;function g5(){return bE||(bE=1,(function(n,e){var r=ei(),i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,a=o?r.Buffer:void 0,c=a?a.allocUnsafe:void 0;function l(u,d){if(d)return u.slice();var h=u.length,p=c?c(h):new u.constructor(h);return u.copy(p),p}n.exports=l})(Nc,Nc.exports)),Nc.exports}var nm,SE;function m5(){if(SE)return nm;SE=1;function n(e,r){var i=-1,s=e.length;for(r||(r=Array(s));++i<s;)r[i]=e[i];return r}return nm=n,nm}var rm,wE;function y5(){if(wE)return rm;wE=1;function n(e,r){for(var i=-1,s=e==null?0:e.length,o=0,a=[];++i<s;){var c=e[i];r(c,i,e)&&(a[o++]=c)}return a}return rm=n,rm}var im,_E;function v5(){if(_E)return im;_E=1;function n(){return[]}return im=n,im}var sm,CE;function $1(){if(CE)return sm;CE=1;var n=y5(),e=v5(),r=Object.prototype,i=r.propertyIsEnumerable,s=Object.getOwnPropertySymbols,o=s?function(a){return a==null?[]:(a=Object(a),n(s(a),function(c){return i.call(a,c)}))}:e;return sm=o,sm}var om,PE;function xW(){if(PE)return om;PE=1;var n=Vl(),e=$1();function r(i,s){return n(i,e(i),s)}return om=r,om}var am,IE;function B1(){if(IE)return am;IE=1;function n(e,r){for(var i=-1,s=r.length,o=e.length;++i<s;)e[o+i]=r[i];return e}return am=n,am}var cm,EE;function rf(){if(EE)return cm;EE=1;var n=p5(),e=n(Object.getPrototypeOf,Object);return cm=e,cm}var lm,kE;function x5(){if(kE)return lm;kE=1;var n=B1(),e=rf(),r=$1(),i=v5(),s=Object.getOwnPropertySymbols,o=s?function(a){for(var c=[];a;)n(c,r(a)),a=e(a);return c}:i;return lm=o,lm}var um,TE;function bW(){if(TE)return um;TE=1;var n=Vl(),e=x5();function r(i,s){return n(i,e(i),s)}return um=r,um}var dm,ME;function b5(){if(ME)return dm;ME=1;var n=B1(),e=$t();function r(i,s,o){var a=s(i);return e(i)?a:n(a,o(i))}return dm=r,dm}var hm,AE;function S5(){if(AE)return hm;AE=1;var n=b5(),e=$1(),r=Bs();function i(s){return n(s,r,e)}return hm=i,hm}var fm,jE;function SW(){if(jE)return fm;jE=1;var n=b5(),e=x5(),r=No();function i(s){return n(s,r,e)}return fm=i,fm}var pm,RE;function wW(){if(RE)return pm;RE=1;var n=Do(),e=ei(),r=n(e,"DataView");return pm=r,pm}var gm,OE;function _W(){if(OE)return gm;OE=1;var n=Do(),e=ei(),r=n(e,"Promise");return gm=r,gm}var mm,DE;function w5(){if(DE)return mm;DE=1;var n=Do(),e=ei(),r=n(e,"Set");return mm=r,mm}var ym,NE;function CW(){if(NE)return ym;NE=1;var n=Do(),e=ei(),r=n(e,"WeakMap");return ym=r,ym}var vm,LE;function Ba(){if(LE)return vm;LE=1;var n=wW(),e=O1(),r=_W(),i=w5(),s=CW(),o=Oo(),a=d5(),c="[object Map]",l="[object Object]",u="[object Promise]",d="[object Set]",h="[object WeakMap]",p="[object DataView]",g=a(n),y=a(e),v=a(r),x=a(i),m=a(s),b=o;return(n&&b(new n(new ArrayBuffer(1)))!=p||e&&b(new e)!=c||r&&b(r.resolve())!=u||i&&b(new i)!=d||s&&b(new s)!=h)&&(b=function(S){var w=o(S),I=w==l?S.constructor:void 0,C=I?a(I):"";if(C)switch(C){case g:return p;case y:return c;case v:return u;case x:return d;case m:return h}return w}),vm=b,vm}var xm,FE;function PW(){if(FE)return xm;FE=1;var n=Object.prototype,e=n.hasOwnProperty;function r(i){var s=i.length,o=new i.constructor(s);return s&&typeof i[0]=="string"&&e.call(i,"index")&&(o.index=i.index,o.input=i.input),o}return xm=r,xm}var bm,zE;function _5(){if(zE)return bm;zE=1;var n=ei(),e=n.Uint8Array;return bm=e,bm}var Sm,$E;function U1(){if($E)return Sm;$E=1;var n=_5();function e(r){var i=new r.constructor(r.byteLength);return new n(i).set(new n(r)),i}return Sm=e,Sm}var wm,BE;function IW(){if(BE)return wm;BE=1;var n=U1();function e(r,i){var s=i?n(r.buffer):r.buffer;return new r.constructor(s,r.byteOffset,r.byteLength)}return wm=e,wm}var _m,UE;function EW(){if(UE)return _m;UE=1;var n=/\w*$/;function e(r){var i=new r.constructor(r.source,n.exec(r));return i.lastIndex=r.lastIndex,i}return _m=e,_m}var Cm,qE;function kW(){if(qE)return Cm;qE=1;var n=za(),e=n?n.prototype:void 0,r=e?e.valueOf:void 0;function i(s){return r?Object(r.call(s)):{}}return Cm=i,Cm}var Pm,HE;function C5(){if(HE)return Pm;HE=1;var n=U1();function e(r,i){var s=i?n(r.buffer):r.buffer;return new r.constructor(s,r.byteOffset,r.length)}return Pm=e,Pm}var Im,GE;function TW(){if(GE)return Im;GE=1;var n=U1(),e=IW(),r=EW(),i=kW(),s=C5(),o="[object Boolean]",a="[object Date]",c="[object Map]",l="[object Number]",u="[object RegExp]",d="[object Set]",h="[object String]",p="[object Symbol]",g="[object ArrayBuffer]",y="[object DataView]",v="[object Float32Array]",x="[object Float64Array]",m="[object Int8Array]",b="[object Int16Array]",S="[object Int32Array]",w="[object Uint8Array]",I="[object Uint8ClampedArray]",C="[object Uint16Array]",_="[object Uint32Array]";function P(M,T,A){var R=M.constructor;switch(T){case g:return n(M);case o:case a:return new R(+M);case y:return e(M,A);case v:case x:case m:case b:case S:case w:case I:case C:case _:return s(M,A);case c:return new R;case l:case h:return new R(M);case u:return r(M);case d:return new R;case p:return i(M)}}return Im=P,Im}var Em,KE;function P5(){if(KE)return Em;KE=1;var n=jr(),e=Object.create,r=(function(){function i(){}return function(s){if(!n(s))return{};if(e)return e(s);i.prototype=s;var o=new i;return i.prototype=void 0,o}})();return Em=r,Em}var km,VE;function I5(){if(VE)return km;VE=1;var n=P5(),e=rf(),r=nf();function i(s){return typeof s.constructor=="function"&&!r(s)?n(e(s)):{}}return km=i,km}var Tm,WE;function MW(){if(WE)return Tm;WE=1;var n=Ba(),e=Ei(),r="[object Map]";function i(s){return e(s)&&n(s)==r}return Tm=i,Tm}var Mm,YE;function AW(){if(YE)return Mm;YE=1;var n=MW(),e=tf(),r=F1(),i=r&&r.isMap,s=i?e(i):n;return Mm=s,Mm}var Am,XE;function jW(){if(XE)return Am;XE=1;var n=Ba(),e=Ei(),r="[object Set]";function i(s){return e(s)&&n(s)==r}return Am=i,Am}var jm,ZE;function RW(){if(ZE)return jm;ZE=1;var n=jW(),e=tf(),r=F1(),i=r&&r.isSet,s=i?e(i):n;return jm=s,jm}var Rm,QE;function E5(){if(QE)return Rm;QE=1;var n=Zh(),e=N1(),r=Jh(),i=gW(),s=vW(),o=g5(),a=m5(),c=xW(),l=bW(),u=S5(),d=SW(),h=Ba(),p=PW(),g=TW(),y=I5(),v=$t(),x=$a(),m=AW(),b=jr(),S=RW(),w=Bs(),I=No(),C=1,_=2,P=4,M="[object Arguments]",T="[object Array]",A="[object Boolean]",R="[object Date]",O="[object Error]",j="[object Function]",D="[object GeneratorFunction]",N="[object Map]",F="[object Number]",z="[object Object]",$="[object RegExp]",G="[object Set]",X="[object String]",ee="[object Symbol]",re="[object WeakMap]",B="[object ArrayBuffer]",U="[object DataView]",Q="[object Float32Array]",K="[object Float64Array]",Y="[object Int8Array]",V="[object Int16Array]",ie="[object Int32Array]",ae="[object Uint8Array]",ye="[object Uint8ClampedArray]",he="[object Uint16Array]",xe="[object Uint32Array]",fe={};fe[M]=fe[T]=fe[B]=fe[U]=fe[A]=fe[R]=fe[Q]=fe[K]=fe[Y]=fe[V]=fe[ie]=fe[N]=fe[F]=fe[z]=fe[$]=fe[G]=fe[X]=fe[ee]=fe[ae]=fe[ye]=fe[he]=fe[xe]=!0,fe[O]=fe[j]=fe[re]=!1;function me(we,st,lt,Ut,Bt,se){var ve,Se=st&C,Ke=st&_,ke=st&P;if(lt&&(ve=Bt?lt(we,Ut,Bt,se):lt(we)),ve!==void 0)return ve;if(!b(we))return we;var Ne=v(we);if(Ne){if(ve=p(we),!Se)return a(we,ve)}else{var ut=h(we),Xe=ut==j||ut==D;if(x(we))return o(we,Se);if(ut==z||ut==M||Xe&&!Bt){if(ve=Ke||Xe?{}:y(we),!Se)return Ke?l(we,s(ve,we)):c(we,i(ve,we))}else{if(!fe[ut])return Bt?we:{};ve=g(we,ut,Se)}}se||(se=new n);var J=se.get(we);if(J)return J;se.set(we,ve),S(we)?we.forEach(function(Le){ve.add(me(Le,st,lt,Le,we,se))}):m(we)&&we.forEach(function(Le,Re){ve.set(Re,me(Le,st,lt,Re,we,se))});var le=ke?Ke?d:u:Ke?I:w,ge=Ne?void 0:le(we);return e(ge||we,function(Le,Re){ge&&(Re=Le,Le=we[Re]),r(ve,Re,me(Le,st,lt,Re,we,se))}),ve}return Rm=me,Rm}var Om,JE;function OW(){if(JE)return Om;JE=1;var n=E5(),e=4;function r(i){return n(i,e)}return Om=r,Om}var Dm,e2;function q1(){if(e2)return Dm;e2=1;function n(e){return function(){return e}}return Dm=n,Dm}var Nm,t2;function DW(){if(t2)return Nm;t2=1;function n(e){return function(r,i,s){for(var o=-1,a=Object(r),c=s(r),l=c.length;l--;){var u=c[e?l:++o];if(i(a[u],u,a)===!1)break}return r}}return Nm=n,Nm}var Lm,n2;function H1(){if(n2)return Lm;n2=1;var n=DW(),e=n();return Lm=e,Lm}var Fm,r2;function G1(){if(r2)return Fm;r2=1;var n=H1(),e=Bs();function r(i,s){return i&&n(i,s,e)}return Fm=r,Fm}var zm,i2;function NW(){if(i2)return zm;i2=1;var n=ss();function e(r,i){return function(s,o){if(s==null)return s;if(!n(s))return r(s,o);for(var a=s.length,c=i?a:-1,l=Object(s);(i?c--:++c<a)&&o(l[c],c,l)!==!1;);return s}}return zm=e,zm}var $m,s2;function sf(){if(s2)return $m;s2=1;var n=G1(),e=NW(),r=e(n);return $m=r,$m}var Bm,o2;function Lo(){if(o2)return Bm;o2=1;function n(e){return e}return Bm=n,Bm}var Um,a2;function k5(){if(a2)return Um;a2=1;var n=Lo();function e(r){return typeof r=="function"?r:n}return Um=e,Um}var qm,c2;function T5(){if(c2)return qm;c2=1;var n=N1(),e=sf(),r=k5(),i=$t();function s(o,a){var c=i(o)?n:e;return c(o,r(a))}return qm=s,qm}var Hm,l2;function M5(){return l2||(l2=1,Hm=T5()),Hm}var Gm,u2;function LW(){if(u2)return Gm;u2=1;var n=sf();function e(r,i){var s=[];return n(r,function(o,a,c){i(o,a,c)&&s.push(o)}),s}return Gm=e,Gm}var Km,d2;function FW(){if(d2)return Km;d2=1;var n="__lodash_hash_undefined__";function e(r){return this.__data__.set(r,n),this}return Km=e,Km}var Vm,h2;function zW(){if(h2)return Vm;h2=1;function n(e){return this.__data__.has(e)}return Vm=n,Vm}var Wm,f2;function A5(){if(f2)return Wm;f2=1;var n=D1(),e=FW(),r=zW();function i(s){var o=-1,a=s==null?0:s.length;for(this.__data__=new n;++o<a;)this.add(s[o])}return i.prototype.add=i.prototype.push=e,i.prototype.has=r,Wm=i,Wm}var Ym,p2;function $W(){if(p2)return Ym;p2=1;function n(e,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(e[i],i,e))return!0;return!1}return Ym=n,Ym}var Xm,g2;function j5(){if(g2)return Xm;g2=1;function n(e,r){return e.has(r)}return Xm=n,Xm}var Zm,m2;function R5(){if(m2)return Zm;m2=1;var n=A5(),e=$W(),r=j5(),i=1,s=2;function o(a,c,l,u,d,h){var p=l&i,g=a.length,y=c.length;if(g!=y&&!(p&&y>g))return!1;var v=h.get(a),x=h.get(c);if(v&&x)return v==c&&x==a;var m=-1,b=!0,S=l&s?new n:void 0;for(h.set(a,c),h.set(c,a);++m<g;){var w=a[m],I=c[m];if(u)var C=p?u(I,w,m,c,a,h):u(w,I,m,a,c,h);if(C!==void 0){if(C)continue;b=!1;break}if(S){if(!e(c,function(_,P){if(!r(S,P)&&(w===_||d(w,_,l,u,h)))return S.push(P)})){b=!1;break}}else if(!(w===I||d(w,I,l,u,h))){b=!1;break}}return h.delete(a),h.delete(c),b}return Zm=o,Zm}var Qm,y2;function BW(){if(y2)return Qm;y2=1;function n(e){var r=-1,i=Array(e.size);return e.forEach(function(s,o){i[++r]=[o,s]}),i}return Qm=n,Qm}var Jm,v2;function K1(){if(v2)return Jm;v2=1;function n(e){var r=-1,i=Array(e.size);return e.forEach(function(s){i[++r]=s}),i}return Jm=n,Jm}var ey,x2;function UW(){if(x2)return ey;x2=1;var n=za(),e=_5(),r=Fa(),i=R5(),s=BW(),o=K1(),a=1,c=2,l="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Map]",p="[object Number]",g="[object RegExp]",y="[object Set]",v="[object String]",x="[object Symbol]",m="[object ArrayBuffer]",b="[object DataView]",S=n?n.prototype:void 0,w=S?S.valueOf:void 0;function I(C,_,P,M,T,A,R){switch(P){case b:if(C.byteLength!=_.byteLength||C.byteOffset!=_.byteOffset)return!1;C=C.buffer,_=_.buffer;case m:return!(C.byteLength!=_.byteLength||!A(new e(C),new e(_)));case l:case u:case p:return r(+C,+_);case d:return C.name==_.name&&C.message==_.message;case g:case v:return C==_+"";case h:var O=s;case y:var j=M&a;if(O||(O=o),C.size!=_.size&&!j)return!1;var D=R.get(C);if(D)return D==_;M|=c,R.set(C,_);var N=i(O(C),O(_),M,T,A,R);return R.delete(C),N;case x:if(w)return w.call(C)==w.call(_)}return!1}return ey=I,ey}var ty,b2;function qW(){if(b2)return ty;b2=1;var n=S5(),e=1,r=Object.prototype,i=r.hasOwnProperty;function s(o,a,c,l,u,d){var h=c&e,p=n(o),g=p.length,y=n(a),v=y.length;if(g!=v&&!h)return!1;for(var x=g;x--;){var m=p[x];if(!(h?m in a:i.call(a,m)))return!1}var b=d.get(o),S=d.get(a);if(b&&S)return b==a&&S==o;var w=!0;d.set(o,a),d.set(a,o);for(var I=h;++x<g;){m=p[x];var C=o[m],_=a[m];if(l)var P=h?l(_,C,m,a,o,d):l(C,_,m,o,a,d);if(!(P===void 0?C===_||u(C,_,c,l,d):P)){w=!1;break}I||(I=m=="constructor")}if(w&&!I){var M=o.constructor,T=a.constructor;M!=T&&"constructor"in o&&"constructor"in a&&!(typeof M=="function"&&M instanceof M&&typeof T=="function"&&T instanceof T)&&(w=!1)}return d.delete(o),d.delete(a),w}return ty=s,ty}var ny,S2;function HW(){if(S2)return ny;S2=1;var n=Zh(),e=R5(),r=UW(),i=qW(),s=Ba(),o=$t(),a=$a(),c=Yl(),l=1,u="[object Arguments]",d="[object Array]",h="[object Object]",p=Object.prototype,g=p.hasOwnProperty;function y(v,x,m,b,S,w){var I=o(v),C=o(x),_=I?d:s(v),P=C?d:s(x);_=_==u?h:_,P=P==u?h:P;var M=_==h,T=P==h,A=_==P;if(A&&a(v)){if(!a(x))return!1;I=!0,M=!1}if(A&&!M)return w||(w=new n),I||c(v)?e(v,x,m,b,S,w):r(v,x,_,m,b,S,w);if(!(m&l)){var R=M&&g.call(v,"__wrapped__"),O=T&&g.call(x,"__wrapped__");if(R||O){var j=R?v.value():v,D=O?x.value():x;return w||(w=new n),S(j,D,m,b,w)}}return A?(w||(w=new n),i(v,x,m,b,S,w)):!1}return ny=y,ny}var ry,w2;function O5(){if(w2)return ry;w2=1;var n=HW(),e=Ei();function r(i,s,o,a,c){return i===s?!0:i==null||s==null||!e(i)&&!e(s)?i!==i&&s!==s:n(i,s,o,a,r,c)}return ry=r,ry}var iy,_2;function GW(){if(_2)return iy;_2=1;var n=Zh(),e=O5(),r=1,i=2;function s(o,a,c,l){var u=c.length,d=u,h=!l;if(o==null)return!d;for(o=Object(o);u--;){var p=c[u];if(h&&p[2]?p[1]!==o[p[0]]:!(p[0]in o))return!1}for(;++u<d;){p=c[u];var g=p[0],y=o[g],v=p[1];if(h&&p[2]){if(y===void 0&&!(g in o))return!1}else{var x=new n;if(l)var m=l(y,v,g,o,a,x);if(!(m===void 0?e(v,y,r|i,l,x):m))return!1}}return!0}return iy=s,iy}var sy,C2;function D5(){if(C2)return sy;C2=1;var n=jr();function e(r){return r===r&&!n(r)}return sy=e,sy}var oy,P2;function KW(){if(P2)return oy;P2=1;var n=D5(),e=Bs();function r(i){for(var s=e(i),o=s.length;o--;){var a=s[o],c=i[a];s[o]=[a,c,n(c)]}return s}return oy=r,oy}var ay,I2;function N5(){if(I2)return ay;I2=1;function n(e,r){return function(i){return i==null?!1:i[e]===r&&(r!==void 0||e in Object(i))}}return ay=n,ay}var cy,E2;function VW(){if(E2)return cy;E2=1;var n=GW(),e=KW(),r=N5();function i(s){var o=e(s);return o.length==1&&o[0][2]?r(o[0][0],o[0][1]):function(a){return a===s||n(a,s,o)}}return cy=i,cy}var ly,k2;function Ua(){if(k2)return ly;k2=1;var n=Oo(),e=Ei(),r="[object Symbol]";function i(s){return typeof s=="symbol"||e(s)&&n(s)==r}return ly=i,ly}var uy,T2;function V1(){if(T2)return uy;T2=1;var n=$t(),e=Ua(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;function s(o,a){if(n(o))return!1;var c=typeof o;return c=="number"||c=="symbol"||c=="boolean"||o==null||e(o)?!0:i.test(o)||!r.test(o)||a!=null&&o in Object(a)}return uy=s,uy}var dy,M2;function WW(){if(M2)return dy;M2=1;var n=D1(),e="Expected a function";function r(i,s){if(typeof i!="function"||s!=null&&typeof s!="function")throw new TypeError(e);var o=function(){var a=arguments,c=s?s.apply(this,a):a[0],l=o.cache;if(l.has(c))return l.get(c);var u=i.apply(this,a);return o.cache=l.set(c,u)||l,u};return o.cache=new(r.Cache||n),o}return r.Cache=n,dy=r,dy}var hy,A2;function YW(){if(A2)return hy;A2=1;var n=WW(),e=500;function r(i){var s=n(i,function(a){return o.size===e&&o.clear(),a}),o=s.cache;return s}return hy=r,hy}var fy,j2;function XW(){if(j2)return fy;j2=1;var n=YW(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,i=n(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(e,function(a,c,l,u){o.push(l?u.replace(r,"$1"):c||a)}),o});return fy=i,fy}var py,R2;function of(){if(R2)return py;R2=1;function n(e,r){for(var i=-1,s=e==null?0:e.length,o=Array(s);++i<s;)o[i]=r(e[i],i,e);return o}return py=n,py}var gy,O2;function ZW(){if(O2)return gy;O2=1;var n=za(),e=of(),r=$t(),i=Ua(),s=n?n.prototype:void 0,o=s?s.toString:void 0;function a(c){if(typeof c=="string")return c;if(r(c))return e(c,a)+"";if(i(c))return o?o.call(c):"";var l=c+"";return l=="0"&&1/c==-1/0?"-0":l}return gy=a,gy}var my,D2;function L5(){if(D2)return my;D2=1;var n=ZW();function e(r){return r==null?"":n(r)}return my=e,my}var yy,N2;function af(){if(N2)return yy;N2=1;var n=$t(),e=V1(),r=XW(),i=L5();function s(o,a){return n(o)?o:e(o,a)?[o]:r(i(o))}return yy=s,yy}var vy,L2;function Xl(){if(L2)return vy;L2=1;var n=Ua();function e(r){if(typeof r=="string"||n(r))return r;var i=r+"";return i=="0"&&1/r==-1/0?"-0":i}return vy=e,vy}var xy,F2;function cf(){if(F2)return xy;F2=1;var n=af(),e=Xl();function r(i,s){s=n(s,i);for(var o=0,a=s.length;i!=null&&o<a;)i=i[e(s[o++])];return o&&o==a?i:void 0}return xy=r,xy}var by,z2;function QW(){if(z2)return by;z2=1;var n=cf();function e(r,i,s){var o=r==null?void 0:n(r,i);return o===void 0?s:o}return by=e,by}var Sy,$2;function JW(){if($2)return Sy;$2=1;function n(e,r){return e!=null&&r in Object(e)}return Sy=n,Sy}var wy,B2;function F5(){if(B2)return wy;B2=1;var n=af(),e=Wl(),r=$t(),i=ef(),s=L1(),o=Xl();function a(c,l,u){l=n(l,c);for(var d=-1,h=l.length,p=!1;++d<h;){var g=o(l[d]);if(!(p=c!=null&&u(c,g)))break;c=c[g]}return p||++d!=h?p:(h=c==null?0:c.length,!!h&&s(h)&&i(g,h)&&(r(c)||e(c)))}return wy=a,wy}var _y,U2;function z5(){if(U2)return _y;U2=1;var n=JW(),e=F5();function r(i,s){return i!=null&&e(i,s,n)}return _y=r,_y}var Cy,q2;function eY(){if(q2)return Cy;q2=1;var n=O5(),e=QW(),r=z5(),i=V1(),s=D5(),o=N5(),a=Xl(),c=1,l=2;function u(d,h){return i(d)&&s(h)?o(a(d),h):function(p){var g=e(p,d);return g===void 0&&g===h?r(p,d):n(h,g,c|l)}}return Cy=u,Cy}var Py,H2;function $5(){if(H2)return Py;H2=1;function n(e){return function(r){return r?.[e]}}return Py=n,Py}var Iy,G2;function tY(){if(G2)return Iy;G2=1;var n=cf();function e(r){return function(i){return n(i,r)}}return Iy=e,Iy}var Ey,K2;function nY(){if(K2)return Ey;K2=1;var n=$5(),e=tY(),r=V1(),i=Xl();function s(o){return r(o)?n(i(o)):e(o)}return Ey=s,Ey}var ky,V2;function os(){if(V2)return ky;V2=1;var n=VW(),e=eY(),r=Lo(),i=$t(),s=nY();function o(a){return typeof a=="function"?a:a==null?r:typeof a=="object"?i(a)?e(a[0],a[1]):n(a):s(a)}return ky=o,ky}var Ty,W2;function B5(){if(W2)return Ty;W2=1;var n=y5(),e=LW(),r=os(),i=$t();function s(o,a){var c=i(o)?n:e;return c(o,r(a,3))}return Ty=s,Ty}var My,Y2;function rY(){if(Y2)return My;Y2=1;var n=Object.prototype,e=n.hasOwnProperty;function r(i,s){return i!=null&&e.call(i,s)}return My=r,My}var Ay,X2;function U5(){if(X2)return Ay;X2=1;var n=rY(),e=F5();function r(i,s){return i!=null&&e(i,s,n)}return Ay=r,Ay}var jy,Z2;function iY(){if(Z2)return jy;Z2=1;var n=z1(),e=Ba(),r=Wl(),i=$t(),s=ss(),o=$a(),a=nf(),c=Yl(),l="[object Map]",u="[object Set]",d=Object.prototype,h=d.hasOwnProperty;function p(g){if(g==null)return!0;if(s(g)&&(i(g)||typeof g=="string"||typeof g.splice=="function"||o(g)||c(g)||r(g)))return!g.length;var y=e(g);if(y==l||y==u)return!g.size;if(a(g))return!n(g).length;for(var v in g)if(h.call(g,v))return!1;return!0}return jy=p,jy}var Ry,Q2;function q5(){if(Q2)return Ry;Q2=1;function n(e){return e===void 0}return Ry=n,Ry}var Oy,J2;function H5(){if(J2)return Oy;J2=1;var n=sf(),e=ss();function r(i,s){var o=-1,a=e(i)?Array(i.length):[];return n(i,function(c,l,u){a[++o]=s(c,l,u)}),a}return Oy=r,Oy}var Dy,ek;function G5(){if(ek)return Dy;ek=1;var n=of(),e=os(),r=H5(),i=$t();function s(o,a){var c=i(o)?n:r;return c(o,e(a,3))}return Dy=s,Dy}var Ny,tk;function sY(){if(tk)return Ny;tk=1;function n(e,r,i,s){var o=-1,a=e==null?0:e.length;for(s&&a&&(i=e[++o]);++o<a;)i=r(i,e[o],o,e);return i}return Ny=n,Ny}var Ly,nk;function oY(){if(nk)return Ly;nk=1;function n(e,r,i,s,o){return o(e,function(a,c,l){i=s?(s=!1,a):r(i,a,c,l)}),i}return Ly=n,Ly}var Fy,rk;function K5(){if(rk)return Fy;rk=1;var n=sY(),e=sf(),r=os(),i=oY(),s=$t();function o(a,c,l){var u=s(a)?n:i,d=arguments.length<3;return u(a,r(c,4),l,d,e)}return Fy=o,Fy}var zy,ik;function aY(){if(ik)return zy;ik=1;var n=Oo(),e=$t(),r=Ei(),i="[object String]";function s(o){return typeof o=="string"||!e(o)&&r(o)&&n(o)==i}return zy=s,zy}var $y,sk;function cY(){if(sk)return $y;sk=1;var n=$5(),e=n("length");return $y=e,$y}var By,ok;function lY(){if(ok)return By;ok=1;var n="\\ud800-\\udfff",e="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",i="\\u20d0-\\u20ff",s=e+r+i,o="\\ufe0e\\ufe0f",a="\\u200d",c=RegExp("["+a+n+s+o+"]");function l(u){return c.test(u)}return By=l,By}var Uy,ak;function uY(){if(ak)return Uy;ak=1;var n="\\ud800-\\udfff",e="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",i="\\u20d0-\\u20ff",s=e+r+i,o="\\ufe0e\\ufe0f",a="["+n+"]",c="["+s+"]",l="\\ud83c[\\udffb-\\udfff]",u="(?:"+c+"|"+l+")",d="[^"+n+"]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",g="\\u200d",y=u+"?",v="["+o+"]?",x="(?:"+g+"(?:"+[d,h,p].join("|")+")"+v+y+")*",m=v+y+x,b="(?:"+[d+c+"?",c,h,p,a].join("|")+")",S=RegExp(l+"(?="+l+")|"+b+m,"g");function w(I){for(var C=S.lastIndex=0;S.test(I);)++C;return C}return Uy=w,Uy}var qy,ck;function dY(){if(ck)return qy;ck=1;var n=cY(),e=lY(),r=uY();function i(s){return e(s)?r(s):n(s)}return qy=i,qy}var Hy,lk;function hY(){if(lk)return Hy;lk=1;var n=z1(),e=Ba(),r=ss(),i=aY(),s=dY(),o="[object Map]",a="[object Set]";function c(l){if(l==null)return 0;if(r(l))return i(l)?s(l):l.length;var u=e(l);return u==o||u==a?l.size:n(l).length}return Hy=c,Hy}var Gy,uk;function fY(){if(uk)return Gy;uk=1;var n=N1(),e=P5(),r=G1(),i=os(),s=rf(),o=$t(),a=$a(),c=Kl(),l=jr(),u=Yl();function d(h,p,g){var y=o(h),v=y||a(h)||u(h);if(p=i(p,4),g==null){var x=h&&h.constructor;v?g=y?new x:[]:l(h)?g=c(x)?e(s(h)):{}:g={}}return(v?n:r)(h,function(m,b,S){return p(g,m,b,S)}),g}return Gy=d,Gy}var Ky,dk;function pY(){if(dk)return Ky;dk=1;var n=za(),e=Wl(),r=$t(),i=n?n.isConcatSpreadable:void 0;function s(o){return r(o)||e(o)||!!(i&&o&&o[i])}return Ky=s,Ky}var Vy,hk;function W1(){if(hk)return Vy;hk=1;var n=B1(),e=pY();function r(i,s,o,a,c){var l=-1,u=i.length;for(o||(o=e),c||(c=[]);++l<u;){var d=i[l];s>0&&o(d)?s>1?r(d,s-1,o,a,c):n(c,d):a||(c[c.length]=d)}return c}return Vy=r,Vy}var Wy,fk;function gY(){if(fk)return Wy;fk=1;function n(e,r,i){switch(i.length){case 0:return e.call(r);case 1:return e.call(r,i[0]);case 2:return e.call(r,i[0],i[1]);case 3:return e.call(r,i[0],i[1],i[2])}return e.apply(r,i)}return Wy=n,Wy}var Yy,pk;function V5(){if(pk)return Yy;pk=1;var n=gY(),e=Math.max;function r(i,s,o){return s=e(s===void 0?i.length-1:s,0),function(){for(var a=arguments,c=-1,l=e(a.length-s,0),u=Array(l);++c<l;)u[c]=a[s+c];c=-1;for(var d=Array(s+1);++c<s;)d[c]=a[c];return d[s]=o(u),n(i,this,d)}}return Yy=r,Yy}var Xy,gk;function mY(){if(gk)return Xy;gk=1;var n=q1(),e=h5(),r=Lo(),i=e?function(s,o){return e(s,"toString",{configurable:!0,enumerable:!1,value:n(o),writable:!0})}:r;return Xy=i,Xy}var Zy,mk;function yY(){if(mk)return Zy;mk=1;var n=800,e=16,r=Date.now;function i(s){var o=0,a=0;return function(){var c=r(),l=e-(c-a);if(a=c,l>0){if(++o>=n)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}return Zy=i,Zy}var Qy,yk;function W5(){if(yk)return Qy;yk=1;var n=mY(),e=yY(),r=e(n);return Qy=r,Qy}var Jy,vk;function lf(){if(vk)return Jy;vk=1;var n=Lo(),e=V5(),r=W5();function i(s,o){return r(e(s,o,n),s+"")}return Jy=i,Jy}var ev,xk;function Y5(){if(xk)return ev;xk=1;function n(e,r,i,s){for(var o=e.length,a=i+(s?1:-1);s?a--:++a<o;)if(r(e[a],a,e))return a;return-1}return ev=n,ev}var tv,bk;function vY(){if(bk)return tv;bk=1;function n(e){return e!==e}return tv=n,tv}var nv,Sk;function xY(){if(Sk)return nv;Sk=1;function n(e,r,i){for(var s=i-1,o=e.length;++s<o;)if(e[s]===r)return s;return-1}return nv=n,nv}var rv,wk;function bY(){if(wk)return rv;wk=1;var n=Y5(),e=vY(),r=xY();function i(s,o,a){return o===o?r(s,o,a):n(s,e,a)}return rv=i,rv}var iv,_k;function SY(){if(_k)return iv;_k=1;var n=bY();function e(r,i){var s=r==null?0:r.length;return!!s&&n(r,i,0)>-1}return iv=e,iv}var sv,Ck;function wY(){if(Ck)return sv;Ck=1;function n(e,r,i){for(var s=-1,o=e==null?0:e.length;++s<o;)if(i(r,e[s]))return!0;return!1}return sv=n,sv}var ov,Pk;function _Y(){if(Pk)return ov;Pk=1;function n(){}return ov=n,ov}var av,Ik;function CY(){if(Ik)return av;Ik=1;var n=w5(),e=_Y(),r=K1(),i=1/0,s=n&&1/r(new n([,-0]))[1]==i?function(o){return new n(o)}:e;return av=s,av}var cv,Ek;function PY(){if(Ek)return cv;Ek=1;var n=A5(),e=SY(),r=wY(),i=j5(),s=CY(),o=K1(),a=200;function c(l,u,d){var h=-1,p=e,g=l.length,y=!0,v=[],x=v;if(d)y=!1,p=r;else if(g>=a){var m=u?null:s(l);if(m)return o(m);y=!1,p=i,x=new n}else x=u?[]:v;e:for(;++h<g;){var b=l[h],S=u?u(b):b;if(b=d||b!==0?b:0,y&&S===S){for(var w=x.length;w--;)if(x[w]===S)continue e;u&&x.push(S),v.push(b)}else p(x,S,d)||(x!==v&&x.push(S),v.push(b))}return v}return cv=c,cv}var lv,kk;function X5(){if(kk)return lv;kk=1;var n=ss(),e=Ei();function r(i){return e(i)&&n(i)}return lv=r,lv}var uv,Tk;function IY(){if(Tk)return uv;Tk=1;var n=W1(),e=lf(),r=PY(),i=X5(),s=e(function(o){return r(n(o,1,i,!0))});return uv=s,uv}var dv,Mk;function EY(){if(Mk)return dv;Mk=1;var n=of();function e(r,i){return n(i,function(s){return r[s]})}return dv=e,dv}var hv,Ak;function Z5(){if(Ak)return hv;Ak=1;var n=EY(),e=Bs();function r(i){return i==null?[]:n(i,e(i))}return hv=r,hv}var fv,jk;function Rr(){if(jk)return fv;jk=1;var n;if(typeof R1=="function")try{n={clone:OW(),constant:q1(),each:M5(),filter:B5(),has:U5(),isArray:$t(),isEmpty:iY(),isFunction:Kl(),isUndefined:q5(),keys:Bs(),map:G5(),reduce:K5(),size:hY(),transform:fY(),union:IY(),values:Z5()}}catch{}return n||(n=window._),fv=n,fv}var pv,Rk;function Y1(){if(Rk)return pv;Rk=1;var n=Rr();pv=s;var e="\0",r="\0",i="";function s(d){this._isDirected=n.has(d,"directed")?d.directed:!0,this._isMultigraph=n.has(d,"multigraph")?d.multigraph:!1,this._isCompound=n.has(d,"compound")?d.compound:!1,this._label=void 0,this._defaultNodeLabelFn=n.constant(void 0),this._defaultEdgeLabelFn=n.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[r]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}s.prototype._nodeCount=0,s.prototype._edgeCount=0,s.prototype.isDirected=function(){return this._isDirected},s.prototype.isMultigraph=function(){return this._isMultigraph},s.prototype.isCompound=function(){return this._isCompound},s.prototype.setGraph=function(d){return this._label=d,this},s.prototype.graph=function(){return this._label},s.prototype.setDefaultNodeLabel=function(d){return n.isFunction(d)||(d=n.constant(d)),this._defaultNodeLabelFn=d,this},s.prototype.nodeCount=function(){return this._nodeCount},s.prototype.nodes=function(){return n.keys(this._nodes)},s.prototype.sources=function(){var d=this;return n.filter(this.nodes(),function(h){return n.isEmpty(d._in[h])})},s.prototype.sinks=function(){var d=this;return n.filter(this.nodes(),function(h){return n.isEmpty(d._out[h])})},s.prototype.setNodes=function(d,h){var p=arguments,g=this;return n.each(d,function(y){p.length>1?g.setNode(y,h):g.setNode(y)}),this},s.prototype.setNode=function(d,h){return n.has(this._nodes,d)?(arguments.length>1&&(this._nodes[d]=h),this):(this._nodes[d]=arguments.length>1?h:this._defaultNodeLabelFn(d),this._isCompound&&(this._parent[d]=r,this._children[d]={},this._children[r][d]=!0),this._in[d]={},this._preds[d]={},this._out[d]={},this._sucs[d]={},++this._nodeCount,this)},s.prototype.node=function(d){return this._nodes[d]},s.prototype.hasNode=function(d){return n.has(this._nodes,d)},s.prototype.removeNode=function(d){var h=this;if(n.has(this._nodes,d)){var p=function(g){h.removeEdge(h._edgeObjs[g])};delete this._nodes[d],this._isCompound&&(this._removeFromParentsChildList(d),delete this._parent[d],n.each(this.children(d),function(g){h.setParent(g)}),delete this._children[d]),n.each(n.keys(this._in[d]),p),delete this._in[d],delete this._preds[d],n.each(n.keys(this._out[d]),p),delete this._out[d],delete this._sucs[d],--this._nodeCount}return this},s.prototype.setParent=function(d,h){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(n.isUndefined(h))h=r;else{h+="";for(var p=h;!n.isUndefined(p);p=this.parent(p))if(p===d)throw new Error("Setting "+h+" as parent of "+d+" would create a cycle");this.setNode(h)}return this.setNode(d),this._removeFromParentsChildList(d),this._parent[d]=h,this._children[h][d]=!0,this},s.prototype._removeFromParentsChildList=function(d){delete this._children[this._parent[d]][d]},s.prototype.parent=function(d){if(this._isCompound){var h=this._parent[d];if(h!==r)return h}},s.prototype.children=function(d){if(n.isUndefined(d)&&(d=r),this._isCompound){var h=this._children[d];if(h)return n.keys(h)}else{if(d===r)return this.nodes();if(this.hasNode(d))return[]}},s.prototype.predecessors=function(d){var h=this._preds[d];if(h)return n.keys(h)},s.prototype.successors=function(d){var h=this._sucs[d];if(h)return n.keys(h)},s.prototype.neighbors=function(d){var h=this.predecessors(d);if(h)return n.union(h,this.successors(d))},s.prototype.isLeaf=function(d){var h;return this.isDirected()?h=this.successors(d):h=this.neighbors(d),h.length===0},s.prototype.filterNodes=function(d){var h=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});h.setGraph(this.graph());var p=this;n.each(this._nodes,function(v,x){d(x)&&h.setNode(x,v)}),n.each(this._edgeObjs,function(v){h.hasNode(v.v)&&h.hasNode(v.w)&&h.setEdge(v,p.edge(v))});var g={};function y(v){var x=p.parent(v);return x===void 0||h.hasNode(x)?(g[v]=x,x):x in g?g[x]:y(x)}return this._isCompound&&n.each(h.nodes(),function(v){h.setParent(v,y(v))}),h},s.prototype.setDefaultEdgeLabel=function(d){return n.isFunction(d)||(d=n.constant(d)),this._defaultEdgeLabelFn=d,this},s.prototype.edgeCount=function(){return this._edgeCount},s.prototype.edges=function(){return n.values(this._edgeObjs)},s.prototype.setPath=function(d,h){var p=this,g=arguments;return n.reduce(d,function(y,v){return g.length>1?p.setEdge(y,v,h):p.setEdge(y,v),v}),this},s.prototype.setEdge=function(){var d,h,p,g,y=!1,v=arguments[0];typeof v=="object"&&v!==null&&"v"in v?(d=v.v,h=v.w,p=v.name,arguments.length===2&&(g=arguments[1],y=!0)):(d=v,h=arguments[1],p=arguments[3],arguments.length>2&&(g=arguments[2],y=!0)),d=""+d,h=""+h,n.isUndefined(p)||(p=""+p);var x=c(this._isDirected,d,h,p);if(n.has(this._edgeLabels,x))return y&&(this._edgeLabels[x]=g),this;if(!n.isUndefined(p)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(d),this.setNode(h),this._edgeLabels[x]=y?g:this._defaultEdgeLabelFn(d,h,p);var m=l(this._isDirected,d,h,p);return d=m.v,h=m.w,Object.freeze(m),this._edgeObjs[x]=m,o(this._preds[h],d),o(this._sucs[d],h),this._in[h][x]=m,this._out[d][x]=m,this._edgeCount++,this},s.prototype.edge=function(d,h,p){var g=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,d,h,p);return this._edgeLabels[g]},s.prototype.hasEdge=function(d,h,p){var g=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,d,h,p);return n.has(this._edgeLabels,g)},s.prototype.removeEdge=function(d,h,p){var g=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,d,h,p),y=this._edgeObjs[g];return y&&(d=y.v,h=y.w,delete this._edgeLabels[g],delete this._edgeObjs[g],a(this._preds[h],d),a(this._sucs[d],h),delete this._in[h][g],delete this._out[d][g],this._edgeCount--),this},s.prototype.inEdges=function(d,h){var p=this._in[d];if(p){var g=n.values(p);return h?n.filter(g,function(y){return y.v===h}):g}},s.prototype.outEdges=function(d,h){var p=this._out[d];if(p){var g=n.values(p);return h?n.filter(g,function(y){return y.w===h}):g}},s.prototype.nodeEdges=function(d,h){var p=this.inEdges(d,h);if(p)return p.concat(this.outEdges(d,h))};function o(d,h){d[h]?d[h]++:d[h]=1}function a(d,h){--d[h]||delete d[h]}function c(d,h,p,g){var y=""+h,v=""+p;if(!d&&y>v){var x=y;y=v,v=x}return y+i+v+i+(n.isUndefined(g)?e:g)}function l(d,h,p,g){var y=""+h,v=""+p;if(!d&&y>v){var x=y;y=v,v=x}var m={v:y,w:v};return g&&(m.name=g),m}function u(d,h){return c(d,h.v,h.w,h.name)}return pv}var gv,Ok;function kY(){return Ok||(Ok=1,gv="2.1.8"),gv}var mv,Dk;function TY(){return Dk||(Dk=1,mv={Graph:Y1(),version:kY()}),mv}var yv,Nk;function MY(){if(Nk)return yv;Nk=1;var n=Rr(),e=Y1();yv={write:r,read:o};function r(a){var c={options:{directed:a.isDirected(),multigraph:a.isMultigraph(),compound:a.isCompound()},nodes:i(a),edges:s(a)};return n.isUndefined(a.graph())||(c.value=n.clone(a.graph())),c}function i(a){return n.map(a.nodes(),function(c){var l=a.node(c),u=a.parent(c),d={v:c};return n.isUndefined(l)||(d.value=l),n.isUndefined(u)||(d.parent=u),d})}function s(a){return n.map(a.edges(),function(c){var l=a.edge(c),u={v:c.v,w:c.w};return n.isUndefined(c.name)||(u.name=c.name),n.isUndefined(l)||(u.value=l),u})}function o(a){var c=new e(a.options).setGraph(a.value);return n.each(a.nodes,function(l){c.setNode(l.v,l.value),l.parent&&c.setParent(l.v,l.parent)}),n.each(a.edges,function(l){c.setEdge({v:l.v,w:l.w,name:l.name},l.value)}),c}return yv}var vv,Lk;function AY(){if(Lk)return vv;Lk=1;var n=Rr();vv=e;function e(r){var i={},s=[],o;function a(c){n.has(i,c)||(i[c]=!0,o.push(c),n.each(r.successors(c),a),n.each(r.predecessors(c),a))}return n.each(r.nodes(),function(c){o=[],a(c),o.length&&s.push(o)}),s}return vv}var xv,Fk;function Q5(){if(Fk)return xv;Fk=1;var n=Rr();xv=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(r){return r.key})},e.prototype.has=function(r){return n.has(this._keyIndices,r)},e.prototype.priority=function(r){var i=this._keyIndices[r];if(i!==void 0)return this._arr[i].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(r,i){var s=this._keyIndices;if(r=String(r),!n.has(s,r)){var o=this._arr,a=o.length;return s[r]=a,o.push({key:r,priority:i}),this._decrease(a),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var r=this._arr.pop();return delete this._keyIndices[r.key],this._heapify(0),r.key},e.prototype.decrease=function(r,i){var s=this._keyIndices[r];if(i>this._arr[s].priority)throw new Error("New priority is greater than current priority. Key: "+r+" Old: "+this._arr[s].priority+" New: "+i);this._arr[s].priority=i,this._decrease(s)},e.prototype._heapify=function(r){var i=this._arr,s=2*r,o=s+1,a=r;s<i.length&&(a=i[s].priority<i[a].priority?s:a,o<i.length&&(a=i[o].priority<i[a].priority?o:a),a!==r&&(this._swap(r,a),this._heapify(a)))},e.prototype._decrease=function(r){for(var i=this._arr,s=i[r].priority,o;r!==0&&(o=r>>1,!(i[o].priority<s));)this._swap(r,o),r=o},e.prototype._swap=function(r,i){var s=this._arr,o=this._keyIndices,a=s[r],c=s[i];s[r]=c,s[i]=a,o[c.key]=r,o[a.key]=i},xv}var bv,zk;function J5(){if(zk)return bv;zk=1;var n=Rr(),e=Q5();bv=i;var r=n.constant(1);function i(o,a,c,l){return s(o,String(a),c||r,l||function(u){return o.outEdges(u)})}function s(o,a,c,l){var u={},d=new e,h,p,g=function(y){var v=y.v!==h?y.v:y.w,x=u[v],m=c(y),b=p.distance+m;if(m<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+y+" Weight: "+m);b<x.distance&&(x.distance=b,x.predecessor=h,d.decrease(v,b))};for(o.nodes().forEach(function(y){var v=y===a?0:Number.POSITIVE_INFINITY;u[y]={distance:v},d.add(y,v)});d.size()>0&&(h=d.removeMin(),p=u[h],p.distance!==Number.POSITIVE_INFINITY);)l(h).forEach(g);return u}return bv}var Sv,$k;function jY(){if($k)return Sv;$k=1;var n=J5(),e=Rr();Sv=r;function r(i,s,o){return e.transform(i.nodes(),function(a,c){a[c]=n(i,c,s,o)},{})}return Sv}var wv,Bk;function eL(){if(Bk)return wv;Bk=1;var n=Rr();wv=e;function e(r){var i=0,s=[],o={},a=[];function c(l){var u=o[l]={onStack:!0,lowlink:i,index:i++};if(s.push(l),r.successors(l).forEach(function(p){n.has(o,p)?o[p].onStack&&(u.lowlink=Math.min(u.lowlink,o[p].index)):(c(p),u.lowlink=Math.min(u.lowlink,o[p].lowlink))}),u.lowlink===u.index){var d=[],h;do h=s.pop(),o[h].onStack=!1,d.push(h);while(l!==h);a.push(d)}}return r.nodes().forEach(function(l){n.has(o,l)||c(l)}),a}return wv}var _v,Uk;function RY(){if(Uk)return _v;Uk=1;var n=Rr(),e=eL();_v=r;function r(i){return n.filter(e(i),function(s){return s.length>1||s.length===1&&i.hasEdge(s[0],s[0])})}return _v}var Cv,qk;function OY(){if(qk)return Cv;qk=1;var n=Rr();Cv=r;var e=n.constant(1);function r(s,o,a){return i(s,o||e,a||function(c){return s.outEdges(c)})}function i(s,o,a){var c={},l=s.nodes();return l.forEach(function(u){c[u]={},c[u][u]={distance:0},l.forEach(function(d){u!==d&&(c[u][d]={distance:Number.POSITIVE_INFINITY})}),a(u).forEach(function(d){var h=d.v===u?d.w:d.v,p=o(d);c[u][h]={distance:p,predecessor:u}})}),l.forEach(function(u){var d=c[u];l.forEach(function(h){var p=c[h];l.forEach(function(g){var y=p[u],v=d[g],x=p[g],m=y.distance+v.distance;m<x.distance&&(x.distance=m,x.predecessor=v.predecessor)})})}),c}return Cv}var Pv,Hk;function tL(){if(Hk)return Pv;Hk=1;var n=Rr();Pv=e,e.CycleException=r;function e(i){var s={},o={},a=[];function c(l){if(n.has(o,l))throw new r;n.has(s,l)||(o[l]=!0,s[l]=!0,n.each(i.predecessors(l),c),delete o[l],a.push(l))}if(n.each(i.sinks(),c),n.size(s)!==i.nodeCount())throw new r;return a}function r(){}return r.prototype=new Error,Pv}var Iv,Gk;function DY(){if(Gk)return Iv;Gk=1;var n=tL();Iv=e;function e(r){try{n(r)}catch(i){if(i instanceof n.CycleException)return!1;throw i}return!0}return Iv}var Ev,Kk;function nL(){if(Kk)return Ev;Kk=1;var n=Rr();Ev=e;function e(i,s,o){n.isArray(s)||(s=[s]);var a=(i.isDirected()?i.successors:i.neighbors).bind(i),c=[],l={};return n.each(s,function(u){if(!i.hasNode(u))throw new Error("Graph does not have node: "+u);r(i,u,o==="post",l,a,c)}),c}function r(i,s,o,a,c,l){n.has(a,s)||(a[s]=!0,o||l.push(s),n.each(c(s),function(u){r(i,u,o,a,c,l)}),o&&l.push(s))}return Ev}var kv,Vk;function NY(){if(Vk)return kv;Vk=1;var n=nL();kv=e;function e(r,i){return n(r,i,"post")}return kv}var Tv,Wk;function LY(){if(Wk)return Tv;Wk=1;var n=nL();Tv=e;function e(r,i){return n(r,i,"pre")}return Tv}var Mv,Yk;function FY(){if(Yk)return Mv;Yk=1;var n=Rr(),e=Y1(),r=Q5();Mv=i;function i(s,o){var a=new e,c={},l=new r,u;function d(p){var g=p.v===u?p.w:p.v,y=l.priority(g);if(y!==void 0){var v=o(p);v<y&&(c[g]=u,l.decrease(g,v))}}if(s.nodeCount()===0)return a;n.each(s.nodes(),function(p){l.add(p,Number.POSITIVE_INFINITY),a.setNode(p)}),l.decrease(s.nodes()[0],0);for(var h=!1;l.size()>0;){if(u=l.removeMin(),n.has(c,u))a.setEdge(u,c[u]);else{if(h)throw new Error("Input graph is not connected: "+s);h=!0}s.nodeEdges(u).forEach(d)}return a}return Mv}var Av,Xk;function zY(){return Xk||(Xk=1,Av={components:AY(),dijkstra:J5(),dijkstraAll:jY(),findCycles:RY(),floydWarshall:OY(),isAcyclic:DY(),postorder:NY(),preorder:LY(),prim:FY(),tarjan:eL(),topsort:tL()}),Av}var jv,Zk;function $Y(){if(Zk)return jv;Zk=1;var n=TY();return jv={Graph:n.Graph,json:MY(),alg:zY(),version:n.version},jv}var Rv,Qk;function Zr(){if(Qk)return Rv;Qk=1;var n;if(typeof R1=="function")try{n=$Y()}catch{}return n||(n=window.graphlib),Rv=n,Rv}var Ov,Jk;function BY(){if(Jk)return Ov;Jk=1;var n=E5(),e=1,r=4;function i(s){return n(s,e|r)}return Ov=i,Ov}var Dv,eT;function uf(){if(eT)return Dv;eT=1;var n=Fa(),e=ss(),r=ef(),i=jr();function s(o,a,c){if(!i(c))return!1;var l=typeof a;return(l=="number"?e(c)&&r(a,c.length):l=="string"&&a in c)?n(c[a],o):!1}return Dv=s,Dv}var Nv,tT;function UY(){if(tT)return Nv;tT=1;var n=lf(),e=Fa(),r=uf(),i=No(),s=Object.prototype,o=s.hasOwnProperty,a=n(function(c,l){c=Object(c);var u=-1,d=l.length,h=d>2?l[2]:void 0;for(h&&r(l[0],l[1],h)&&(d=1);++u<d;)for(var p=l[u],g=i(p),y=-1,v=g.length;++y<v;){var x=g[y],m=c[x];(m===void 0||e(m,s[x])&&!o.call(c,x))&&(c[x]=p[x])}return c});return Nv=a,Nv}var Lv,nT;function qY(){if(nT)return Lv;nT=1;var n=os(),e=ss(),r=Bs();function i(s){return function(o,a,c){var l=Object(o);if(!e(o)){var u=n(a,3);o=r(o),a=function(h){return u(l[h],h,l)}}var d=s(o,a,c);return d>-1?l[u?o[d]:d]:void 0}}return Lv=i,Lv}var Fv,rT;function HY(){if(rT)return Fv;rT=1;var n=/\s/;function e(r){for(var i=r.length;i--&&n.test(r.charAt(i)););return i}return Fv=e,Fv}var zv,iT;function GY(){if(iT)return zv;iT=1;var n=HY(),e=/^\s+/;function r(i){return i&&i.slice(0,n(i)+1).replace(e,"")}return zv=r,zv}var $v,sT;function KY(){if(sT)return $v;sT=1;var n=GY(),e=jr(),r=Ua(),i=NaN,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,c=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return i;if(e(u)){var d=typeof u.valueOf=="function"?u.valueOf():u;u=e(d)?d+"":d}if(typeof u!="string")return u===0?u:+u;u=n(u);var h=o.test(u);return h||a.test(u)?c(u.slice(2),h?2:8):s.test(u)?i:+u}return $v=l,$v}var Bv,oT;function rL(){if(oT)return Bv;oT=1;var n=KY(),e=1/0,r=17976931348623157e292;function i(s){if(!s)return s===0?s:0;if(s=n(s),s===e||s===-e){var o=s<0?-1:1;return o*r}return s===s?s:0}return Bv=i,Bv}var Uv,aT;function VY(){if(aT)return Uv;aT=1;var n=rL();function e(r){var i=n(r),s=i%1;return i===i?s?i-s:i:0}return Uv=e,Uv}var qv,cT;function WY(){if(cT)return qv;cT=1;var n=Y5(),e=os(),r=VY(),i=Math.max;function s(o,a,c){var l=o==null?0:o.length;if(!l)return-1;var u=c==null?0:r(c);return u<0&&(u=i(l+u,0)),n(o,e(a,3),u)}return qv=s,qv}var Hv,lT;function YY(){if(lT)return Hv;lT=1;var n=qY(),e=WY(),r=n(e);return Hv=r,Hv}var Gv,uT;function iL(){if(uT)return Gv;uT=1;var n=W1();function e(r){var i=r==null?0:r.length;return i?n(r,1):[]}return Gv=e,Gv}var Kv,dT;function XY(){if(dT)return Kv;dT=1;var n=H1(),e=k5(),r=No();function i(s,o){return s==null?s:n(s,e(o),r)}return Kv=i,Kv}var Vv,hT;function ZY(){if(hT)return Vv;hT=1;function n(e){var r=e==null?0:e.length;return r?e[r-1]:void 0}return Vv=n,Vv}var Wv,fT;function QY(){if(fT)return Wv;fT=1;var n=Qh(),e=G1(),r=os();function i(s,o){var a={};return o=r(o,3),e(s,function(c,l,u){n(a,l,o(c,l,u))}),a}return Wv=i,Wv}var Yv,pT;function X1(){if(pT)return Yv;pT=1;var n=Ua();function e(r,i,s){for(var o=-1,a=r.length;++o<a;){var c=r[o],l=i(c);if(l!=null&&(u===void 0?l===l&&!n(l):s(l,u)))var u=l,d=c}return d}return Yv=e,Yv}var Xv,gT;function JY(){if(gT)return Xv;gT=1;function n(e,r){return e>r}return Xv=n,Xv}var Zv,mT;function eX(){if(mT)return Zv;mT=1;var n=X1(),e=JY(),r=Lo();function i(s){return s&&s.length?n(s,r,e):void 0}return Zv=i,Zv}var Qv,yT;function sL(){if(yT)return Qv;yT=1;var n=Qh(),e=Fa();function r(i,s,o){(o!==void 0&&!e(i[s],o)||o===void 0&&!(s in i))&&n(i,s,o)}return Qv=r,Qv}var Jv,vT;function tX(){if(vT)return Jv;vT=1;var n=Oo(),e=rf(),r=Ei(),i="[object Object]",s=Function.prototype,o=Object.prototype,a=s.toString,c=o.hasOwnProperty,l=a.call(Object);function u(d){if(!r(d)||n(d)!=i)return!1;var h=e(d);if(h===null)return!0;var p=c.call(h,"constructor")&&h.constructor;return typeof p=="function"&&p instanceof p&&a.call(p)==l}return Jv=u,Jv}var e0,xT;function oL(){if(xT)return e0;xT=1;function n(e,r){if(!(r==="constructor"&&typeof e[r]=="function")&&r!="__proto__")return e[r]}return e0=n,e0}var t0,bT;function nX(){if(bT)return t0;bT=1;var n=Vl(),e=No();function r(i){return n(i,e(i))}return t0=r,t0}var n0,ST;function rX(){if(ST)return n0;ST=1;var n=sL(),e=g5(),r=C5(),i=m5(),s=I5(),o=Wl(),a=$t(),c=X5(),l=$a(),u=Kl(),d=jr(),h=tX(),p=Yl(),g=oL(),y=nX();function v(x,m,b,S,w,I,C){var _=g(x,b),P=g(m,b),M=C.get(P);if(M){n(x,b,M);return}var T=I?I(_,P,b+"",x,m,C):void 0,A=T===void 0;if(A){var R=a(P),O=!R&&l(P),j=!R&&!O&&p(P);T=P,R||O||j?a(_)?T=_:c(_)?T=i(_):O?(A=!1,T=e(P,!0)):j?(A=!1,T=r(P,!0)):T=[]:h(P)||o(P)?(T=_,o(_)?T=y(_):(!d(_)||u(_))&&(T=s(P))):A=!1}A&&(C.set(P,T),w(T,P,S,I,C),C.delete(P)),n(x,b,T)}return n0=v,n0}var r0,wT;function iX(){if(wT)return r0;wT=1;var n=Zh(),e=sL(),r=H1(),i=rX(),s=jr(),o=No(),a=oL();function c(l,u,d,h,p){l!==u&&r(u,function(g,y){if(p||(p=new n),s(g))i(l,u,y,d,c,h,p);else{var v=h?h(a(l,y),g,y+"",l,u,p):void 0;v===void 0&&(v=g),e(l,y,v)}},o)}return r0=c,r0}var i0,_T;function sX(){if(_T)return i0;_T=1;var n=lf(),e=uf();function r(i){return n(function(s,o){var a=-1,c=o.length,l=c>1?o[c-1]:void 0,u=c>2?o[2]:void 0;for(l=i.length>3&&typeof l=="function"?(c--,l):void 0,u&&e(o[0],o[1],u)&&(l=c<3?void 0:l,c=1),s=Object(s);++a<c;){var d=o[a];d&&i(s,d,a,l)}return s})}return i0=r,i0}var s0,CT;function oX(){if(CT)return s0;CT=1;var n=iX(),e=sX(),r=e(function(i,s,o){n(i,s,o)});return s0=r,s0}var o0,PT;function aL(){if(PT)return o0;PT=1;function n(e,r){return e<r}return o0=n,o0}var a0,IT;function aX(){if(IT)return a0;IT=1;var n=X1(),e=aL(),r=Lo();function i(s){return s&&s.length?n(s,r,e):void 0}return a0=i,a0}var c0,ET;function cX(){if(ET)return c0;ET=1;var n=X1(),e=os(),r=aL();function i(s,o){return s&&s.length?n(s,e(o,2),r):void 0}return c0=i,c0}var l0,kT;function lX(){if(kT)return l0;kT=1;var n=ei(),e=function(){return n.Date.now()};return l0=e,l0}var u0,TT;function uX(){if(TT)return u0;TT=1;var n=Jh(),e=af(),r=ef(),i=jr(),s=Xl();function o(a,c,l,u){if(!i(a))return a;c=e(c,a);for(var d=-1,h=c.length,p=h-1,g=a;g!=null&&++d<h;){var y=s(c[d]),v=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return a;if(d!=p){var x=g[y];v=u?u(x,y,g):void 0,v===void 0&&(v=i(x)?x:r(c[d+1])?[]:{})}n(g,y,v),g=g[y]}return a}return u0=o,u0}var d0,MT;function dX(){if(MT)return d0;MT=1;var n=cf(),e=uX(),r=af();function i(s,o,a){for(var c=-1,l=o.length,u={};++c<l;){var d=o[c],h=n(s,d);a(h,d)&&e(u,r(d,s),h)}return u}return d0=i,d0}var h0,AT;function hX(){if(AT)return h0;AT=1;var n=dX(),e=z5();function r(i,s){return n(i,s,function(o,a){return e(i,a)})}return h0=r,h0}var f0,jT;function fX(){if(jT)return f0;jT=1;var n=iL(),e=V5(),r=W5();function i(s){return r(e(s,void 0,n),s+"")}return f0=i,f0}var p0,RT;function pX(){if(RT)return p0;RT=1;var n=hX(),e=fX(),r=e(function(i,s){return i==null?{}:n(i,s)});return p0=r,p0}var g0,OT;function gX(){if(OT)return g0;OT=1;var n=Math.ceil,e=Math.max;function r(i,s,o,a){for(var c=-1,l=e(n((s-i)/(o||1)),0),u=Array(l);l--;)u[a?l:++c]=i,i+=o;return u}return g0=r,g0}var m0,DT;function mX(){if(DT)return m0;DT=1;var n=gX(),e=uf(),r=rL();function i(s){return function(o,a,c){return c&&typeof c!="number"&&e(o,a,c)&&(a=c=void 0),o=r(o),a===void 0?(a=o,o=0):a=r(a),c=c===void 0?o<a?1:-1:r(c),n(o,a,c,s)}}return m0=i,m0}var y0,NT;function yX(){if(NT)return y0;NT=1;var n=mX(),e=n();return y0=e,y0}var v0,LT;function vX(){if(LT)return v0;LT=1;function n(e,r){var i=e.length;for(e.sort(r);i--;)e[i]=e[i].value;return e}return v0=n,v0}var x0,FT;function xX(){if(FT)return x0;FT=1;var n=Ua();function e(r,i){if(r!==i){var s=r!==void 0,o=r===null,a=r===r,c=n(r),l=i!==void 0,u=i===null,d=i===i,h=n(i);if(!u&&!h&&!c&&r>i||c&&l&&d&&!u&&!h||o&&l&&d||!s&&d||!a)return 1;if(!o&&!c&&!h&&r<i||h&&s&&a&&!o&&!c||u&&s&&a||!l&&a||!d)return-1}return 0}return x0=e,x0}var b0,zT;function bX(){if(zT)return b0;zT=1;var n=xX();function e(r,i,s){for(var o=-1,a=r.criteria,c=i.criteria,l=a.length,u=s.length;++o<l;){var d=n(a[o],c[o]);if(d){if(o>=u)return d;var h=s[o];return d*(h=="desc"?-1:1)}}return r.index-i.index}return b0=e,b0}var S0,$T;function SX(){if($T)return S0;$T=1;var n=of(),e=cf(),r=os(),i=H5(),s=vX(),o=tf(),a=bX(),c=Lo(),l=$t();function u(d,h,p){h.length?h=n(h,function(v){return l(v)?function(x){return e(x,v.length===1?v[0]:v)}:v}):h=[c];var g=-1;h=n(h,o(r));var y=i(d,function(v,x,m){var b=n(h,function(S){return S(v)});return{criteria:b,index:++g,value:v}});return s(y,function(v,x){return a(v,x,p)})}return S0=u,S0}var w0,BT;function wX(){if(BT)return w0;BT=1;var n=W1(),e=SX(),r=lf(),i=uf(),s=r(function(o,a){if(o==null)return[];var c=a.length;return c>1&&i(o,a[0],a[1])?a=[]:c>2&&i(a[0],a[1],a[2])&&(a=[a[0]]),e(o,n(a,1),[])});return w0=s,w0}var _0,UT;function _X(){if(UT)return _0;UT=1;var n=L5(),e=0;function r(i){var s=++e;return n(i)+s}return _0=r,_0}var C0,qT;function CX(){if(qT)return C0;qT=1;function n(e,r,i){for(var s=-1,o=e.length,a=r.length,c={};++s<o;){var l=s<a?r[s]:void 0;i(c,e[s],l)}return c}return C0=n,C0}var P0,HT;function PX(){if(HT)return P0;HT=1;var n=Jh(),e=CX();function r(i,s){return e(i||[],s||[],n)}return P0=r,P0}var I0,GT;function It(){if(GT)return I0;GT=1;var n;if(typeof R1=="function")try{n={cloneDeep:BY(),constant:q1(),defaults:UY(),each:M5(),filter:B5(),find:YY(),flatten:iL(),forEach:T5(),forIn:XY(),has:U5(),isUndefined:q5(),last:ZY(),map:G5(),mapValues:QY(),max:eX(),merge:oX(),min:aX(),minBy:cX(),now:lX(),pick:pX(),range:yX(),reduce:K5(),sortBy:wX(),uniqueId:_X(),values:Z5(),zipObject:PX()}}catch{}return n||(n=window._),I0=n,I0}var E0,KT;function IX(){if(KT)return E0;KT=1,E0=n;function n(){var i={};i._next=i._prev=i,this._sentinel=i}n.prototype.dequeue=function(){var i=this._sentinel,s=i._prev;if(s!==i)return e(s),s},n.prototype.enqueue=function(i){var s=this._sentinel;i._prev&&i._next&&e(i),i._next=s._next,s._next._prev=i,s._next=i,i._prev=s},n.prototype.toString=function(){for(var i=[],s=this._sentinel,o=s._prev;o!==s;)i.push(JSON.stringify(o,r)),o=o._prev;return"["+i.join(", ")+"]"};function e(i){i._prev._next=i._next,i._next._prev=i._prev,delete i._next,delete i._prev}function r(i,s){if(i!=="_next"&&i!=="_prev")return s}return E0}var k0,VT;function EX(){if(VT)return k0;VT=1;var n=It(),e=Zr().Graph,r=IX();k0=s;var i=n.constant(1);function s(u,d){if(u.nodeCount()<=1)return[];var h=c(u,d||i),p=o(h.graph,h.buckets,h.zeroIdx);return n.flatten(n.map(p,function(g){return u.outEdges(g.v,g.w)}),!0)}function o(u,d,h){for(var p=[],g=d[d.length-1],y=d[0],v;u.nodeCount();){for(;v=y.dequeue();)a(u,d,h,v);for(;v=g.dequeue();)a(u,d,h,v);if(u.nodeCount()){for(var x=d.length-2;x>0;--x)if(v=d[x].dequeue(),v){p=p.concat(a(u,d,h,v,!0));break}}}return p}function a(u,d,h,p,g){var y=g?[]:void 0;return n.forEach(u.inEdges(p.v),function(v){var x=u.edge(v),m=u.node(v.v);g&&y.push({v:v.v,w:v.w}),m.out-=x,l(d,h,m)}),n.forEach(u.outEdges(p.v),function(v){var x=u.edge(v),m=v.w,b=u.node(m);b.in-=x,l(d,h,b)}),u.removeNode(p.v),y}function c(u,d){var h=new e,p=0,g=0;n.forEach(u.nodes(),function(x){h.setNode(x,{v:x,in:0,out:0})}),n.forEach(u.edges(),function(x){var m=h.edge(x.v,x.w)||0,b=d(x),S=m+b;h.setEdge(x.v,x.w,S),g=Math.max(g,h.node(x.v).out+=b),p=Math.max(p,h.node(x.w).in+=b)});var y=n.range(g+p+3).map(function(){return new r}),v=p+1;return n.forEach(h.nodes(),function(x){l(y,v,h.node(x))}),{graph:h,buckets:y,zeroIdx:v}}function l(u,d,h){h.out?h.in?u[h.out-h.in+d].enqueue(h):u[u.length-1].enqueue(h):u[0].enqueue(h)}return k0}var T0,WT;function kX(){if(WT)return T0;WT=1;var n=It(),e=EX();T0={run:r,undo:s};function r(o){var a=o.graph().acyclicer==="greedy"?e(o,c(o)):i(o);n.forEach(a,function(l){var u=o.edge(l);o.removeEdge(l),u.forwardName=l.name,u.reversed=!0,o.setEdge(l.w,l.v,u,n.uniqueId("rev"))});function c(l){return function(u){return l.edge(u).weight}}}function i(o){var a=[],c={},l={};function u(d){n.has(l,d)||(l[d]=!0,c[d]=!0,n.forEach(o.outEdges(d),function(h){n.has(c,h.w)?a.push(h):u(h.w)}),delete c[d])}return n.forEach(o.nodes(),u),a}function s(o){n.forEach(o.edges(),function(a){var c=o.edge(a);if(c.reversed){o.removeEdge(a);var l=c.forwardName;delete c.reversed,delete c.forwardName,o.setEdge(a.w,a.v,c,l)}})}return T0}var M0,YT;function Vn(){if(YT)return M0;YT=1;var n=It(),e=Zr().Graph;M0={addDummyNode:r,simplify:i,asNonCompoundGraph:s,successorWeights:o,predecessorWeights:a,intersectRect:c,buildLayerMatrix:l,normalizeRanks:u,removeEmptyRanks:d,addBorderNode:h,maxRank:p,partition:g,time:y,notime:v};function r(x,m,b,S){var w;do w=n.uniqueId(S);while(x.hasNode(w));return b.dummy=m,x.setNode(w,b),w}function i(x){var m=new e().setGraph(x.graph());return n.forEach(x.nodes(),function(b){m.setNode(b,x.node(b))}),n.forEach(x.edges(),function(b){var S=m.edge(b.v,b.w)||{weight:0,minlen:1},w=x.edge(b);m.setEdge(b.v,b.w,{weight:S.weight+w.weight,minlen:Math.max(S.minlen,w.minlen)})}),m}function s(x){var m=new e({multigraph:x.isMultigraph()}).setGraph(x.graph());return n.forEach(x.nodes(),function(b){x.children(b).length||m.setNode(b,x.node(b))}),n.forEach(x.edges(),function(b){m.setEdge(b,x.edge(b))}),m}function o(x){var m=n.map(x.nodes(),function(b){var S={};return n.forEach(x.outEdges(b),function(w){S[w.w]=(S[w.w]||0)+x.edge(w).weight}),S});return n.zipObject(x.nodes(),m)}function a(x){var m=n.map(x.nodes(),function(b){var S={};return n.forEach(x.inEdges(b),function(w){S[w.v]=(S[w.v]||0)+x.edge(w).weight}),S});return n.zipObject(x.nodes(),m)}function c(x,m){var b=x.x,S=x.y,w=m.x-b,I=m.y-S,C=x.width/2,_=x.height/2;if(!w&&!I)throw new Error("Not possible to find intersection inside of the rectangle");var P,M;return Math.abs(I)*C>Math.abs(w)*_?(I<0&&(_=-_),P=_*w/I,M=_):(w<0&&(C=-C),P=C,M=C*I/w),{x:b+P,y:S+M}}function l(x){var m=n.map(n.range(p(x)+1),function(){return[]});return n.forEach(x.nodes(),function(b){var S=x.node(b),w=S.rank;n.isUndefined(w)||(m[w][S.order]=b)}),m}function u(x){var m=n.min(n.map(x.nodes(),function(b){return x.node(b).rank}));n.forEach(x.nodes(),function(b){var S=x.node(b);n.has(S,"rank")&&(S.rank-=m)})}function d(x){var m=n.min(n.map(x.nodes(),function(I){return x.node(I).rank})),b=[];n.forEach(x.nodes(),function(I){var C=x.node(I).rank-m;b[C]||(b[C]=[]),b[C].push(I)});var S=0,w=x.graph().nodeRankFactor;n.forEach(b,function(I,C){n.isUndefined(I)&&C%w!==0?--S:S&&n.forEach(I,function(_){x.node(_).rank+=S})})}function h(x,m,b,S){var w={width:0,height:0};return arguments.length>=4&&(w.rank=b,w.order=S),r(x,"border",w,m)}function p(x){return n.max(n.map(x.nodes(),function(m){var b=x.node(m).rank;if(!n.isUndefined(b))return b}))}function g(x,m){var b={lhs:[],rhs:[]};return n.forEach(x,function(S){m(S)?b.lhs.push(S):b.rhs.push(S)}),b}function y(x,m){var b=n.now();try{return m()}finally{console.log(x+" time: "+(n.now()-b)+"ms")}}function v(x,m){return m()}return M0}var A0,XT;function TX(){if(XT)return A0;XT=1;var n=It(),e=Vn();A0={run:r,undo:s};function r(o){o.graph().dummyChains=[],n.forEach(o.edges(),function(a){i(o,a)})}function i(o,a){var c=a.v,l=o.node(c).rank,u=a.w,d=o.node(u).rank,h=a.name,p=o.edge(a),g=p.labelRank;if(d!==l+1){o.removeEdge(a);var y,v,x;for(x=0,++l;l<d;++x,++l)p.points=[],v={width:0,height:0,edgeLabel:p,edgeObj:a,rank:l},y=e.addDummyNode(o,"edge",v,"_d"),l===g&&(v.width=p.width,v.height=p.height,v.dummy="edge-label",v.labelpos=p.labelpos),o.setEdge(c,y,{weight:p.weight},h),x===0&&o.graph().dummyChains.push(y),c=y;o.setEdge(c,u,{weight:p.weight},h)}}function s(o){n.forEach(o.graph().dummyChains,function(a){var c=o.node(a),l=c.edgeLabel,u;for(o.setEdge(c.edgeObj,l);c.dummy;)u=o.successors(a)[0],o.removeNode(a),l.points.push({x:c.x,y:c.y}),c.dummy==="edge-label"&&(l.x=c.x,l.y=c.y,l.width=c.width,l.height=c.height),a=u,c=o.node(a)})}return A0}var j0,ZT;function Hd(){if(ZT)return j0;ZT=1;var n=It();j0={longestPath:e,slack:r};function e(i){var s={};function o(a){var c=i.node(a);if(n.has(s,a))return c.rank;s[a]=!0;var l=n.min(n.map(i.outEdges(a),function(u){return o(u.w)-i.edge(u).minlen}));return(l===Number.POSITIVE_INFINITY||l===void 0||l===null)&&(l=0),c.rank=l}n.forEach(i.sources(),o)}function r(i,s){return i.node(s.w).rank-i.node(s.v).rank-i.edge(s).minlen}return j0}var R0,QT;function cL(){if(QT)return R0;QT=1;var n=It(),e=Zr().Graph,r=Hd().slack;R0=i;function i(c){var l=new e({directed:!1}),u=c.nodes()[0],d=c.nodeCount();l.setNode(u,{});for(var h,p;s(l,c)<d;)h=o(l,c),p=l.hasNode(h.v)?r(c,h):-r(c,h),a(l,c,p);return l}function s(c,l){function u(d){n.forEach(l.nodeEdges(d),function(h){var p=h.v,g=d===p?h.w:p;!c.hasNode(g)&&!r(l,h)&&(c.setNode(g,{}),c.setEdge(d,g,{}),u(g))})}return n.forEach(c.nodes(),u),c.nodeCount()}function o(c,l){return n.minBy(l.edges(),function(u){if(c.hasNode(u.v)!==c.hasNode(u.w))return r(l,u)})}function a(c,l,u){n.forEach(c.nodes(),function(d){l.node(d).rank+=u})}return R0}var O0,JT;function MX(){if(JT)return O0;JT=1;var n=It(),e=cL(),r=Hd().slack,i=Hd().longestPath,s=Zr().alg.preorder,o=Zr().alg.postorder,a=Vn().simplify;O0=c,c.initLowLimValues=h,c.initCutValues=l,c.calcCutValue=d,c.leaveEdge=g,c.enterEdge=y,c.exchangeEdges=v;function c(S){S=a(S),i(S);var w=e(S);h(w),l(w,S);for(var I,C;I=g(w);)C=y(w,S,I),v(w,S,I,C)}function l(S,w){var I=o(S,S.nodes());I=I.slice(0,I.length-1),n.forEach(I,function(C){u(S,w,C)})}function u(S,w,I){var C=S.node(I),_=C.parent;S.edge(I,_).cutvalue=d(S,w,I)}function d(S,w,I){var C=S.node(I),_=C.parent,P=!0,M=w.edge(I,_),T=0;return M||(P=!1,M=w.edge(_,I)),T=M.weight,n.forEach(w.nodeEdges(I),function(A){var R=A.v===I,O=R?A.w:A.v;if(O!==_){var j=R===P,D=w.edge(A).weight;if(T+=j?D:-D,m(S,I,O)){var N=S.edge(I,O).cutvalue;T+=j?-N:N}}}),T}function h(S,w){arguments.length<2&&(w=S.nodes()[0]),p(S,{},1,w)}function p(S,w,I,C,_){var P=I,M=S.node(C);return w[C]=!0,n.forEach(S.neighbors(C),function(T){n.has(w,T)||(I=p(S,w,I,T,C))}),M.low=P,M.lim=I++,_?M.parent=_:delete M.parent,I}function g(S){return n.find(S.edges(),function(w){return S.edge(w).cutvalue<0})}function y(S,w,I){var C=I.v,_=I.w;w.hasEdge(C,_)||(C=I.w,_=I.v);var P=S.node(C),M=S.node(_),T=P,A=!1;P.lim>M.lim&&(T=M,A=!0);var R=n.filter(w.edges(),function(O){return A===b(S,S.node(O.v),T)&&A!==b(S,S.node(O.w),T)});return n.minBy(R,function(O){return r(w,O)})}function v(S,w,I,C){var _=I.v,P=I.w;S.removeEdge(_,P),S.setEdge(C.v,C.w,{}),h(S),l(S,w),x(S,w)}function x(S,w){var I=n.find(S.nodes(),function(_){return!w.node(_).parent}),C=s(S,I);C=C.slice(1),n.forEach(C,function(_){var P=S.node(_).parent,M=w.edge(_,P),T=!1;M||(M=w.edge(P,_),T=!0),w.node(_).rank=w.node(P).rank+(T?M.minlen:-M.minlen)})}function m(S,w,I){return S.hasEdge(w,I)}function b(S,w,I){return I.low<=w.lim&&w.lim<=I.lim}return O0}var D0,eM;function AX(){if(eM)return D0;eM=1;var n=Hd(),e=n.longestPath,r=cL(),i=MX();D0=s;function s(l){switch(l.graph().ranker){case"network-simplex":c(l);break;case"tight-tree":a(l);break;case"longest-path":o(l);break;default:c(l)}}var o=e;function a(l){e(l),r(l)}function c(l){i(l)}return D0}var N0,tM;function jX(){if(tM)return N0;tM=1;var n=It();N0=e;function e(s){var o=i(s);n.forEach(s.graph().dummyChains,function(a){for(var c=s.node(a),l=c.edgeObj,u=r(s,o,l.v,l.w),d=u.path,h=u.lca,p=0,g=d[p],y=!0;a!==l.w;){if(c=s.node(a),y){for(;(g=d[p])!==h&&s.node(g).maxRank<c.rank;)p++;g===h&&(y=!1)}if(!y){for(;p<d.length-1&&s.node(g=d[p+1]).minRank<=c.rank;)p++;g=d[p]}s.setParent(a,g),a=s.successors(a)[0]}})}function r(s,o,a,c){var l=[],u=[],d=Math.min(o[a].low,o[c].low),h=Math.max(o[a].lim,o[c].lim),p,g;p=a;do p=s.parent(p),l.push(p);while(p&&(o[p].low>d||h>o[p].lim));for(g=p,p=c;(p=s.parent(p))!==g;)u.push(p);return{path:l.concat(u.reverse()),lca:g}}function i(s){var o={},a=0;function c(l){var u=a;n.forEach(s.children(l),c),o[l]={low:u,lim:a++}}return n.forEach(s.children(),c),o}return N0}var L0,nM;function RX(){if(nM)return L0;nM=1;var n=It(),e=Vn();L0={run:r,cleanup:a};function r(c){var l=e.addDummyNode(c,"root",{},"_root"),u=s(c),d=n.max(n.values(u))-1,h=2*d+1;c.graph().nestingRoot=l,n.forEach(c.edges(),function(g){c.edge(g).minlen*=h});var p=o(c)+1;n.forEach(c.children(),function(g){i(c,l,h,p,d,u,g)}),c.graph().nodeRankFactor=h}function i(c,l,u,d,h,p,g){var y=c.children(g);if(!y.length){g!==l&&c.setEdge(l,g,{weight:0,minlen:u});return}var v=e.addBorderNode(c,"_bt"),x=e.addBorderNode(c,"_bb"),m=c.node(g);c.setParent(v,g),m.borderTop=v,c.setParent(x,g),m.borderBottom=x,n.forEach(y,function(b){i(c,l,u,d,h,p,b);var S=c.node(b),w=S.borderTop?S.borderTop:b,I=S.borderBottom?S.borderBottom:b,C=S.borderTop?d:2*d,_=w!==I?1:h-p[g]+1;c.setEdge(v,w,{weight:C,minlen:_,nestingEdge:!0}),c.setEdge(I,x,{weight:C,minlen:_,nestingEdge:!0})}),c.parent(g)||c.setEdge(l,v,{weight:0,minlen:h+p[g]})}function s(c){var l={};function u(d,h){var p=c.children(d);p&&p.length&&n.forEach(p,function(g){u(g,h+1)}),l[d]=h}return n.forEach(c.children(),function(d){u(d,1)}),l}function o(c){return n.reduce(c.edges(),function(l,u){return l+c.edge(u).weight},0)}function a(c){var l=c.graph();c.removeNode(l.nestingRoot),delete l.nestingRoot,n.forEach(c.edges(),function(u){var d=c.edge(u);d.nestingEdge&&c.removeEdge(u)})}return L0}var F0,rM;function OX(){if(rM)return F0;rM=1;var n=It(),e=Vn();F0=r;function r(s){function o(a){var c=s.children(a),l=s.node(a);if(c.length&&n.forEach(c,o),n.has(l,"minRank")){l.borderLeft=[],l.borderRight=[];for(var u=l.minRank,d=l.maxRank+1;u<d;++u)i(s,"borderLeft","_bl",a,l,u),i(s,"borderRight","_br",a,l,u)}}n.forEach(s.children(),o)}function i(s,o,a,c,l,u){var d={width:0,height:0,rank:u,borderType:o},h=l[o][u-1],p=e.addDummyNode(s,"border",d,a);l[o][u]=p,s.setParent(p,c),h&&s.setEdge(h,p,{weight:1})}return F0}var z0,iM;function DX(){if(iM)return z0;iM=1;var n=It();z0={adjust:e,undo:r};function e(u){var d=u.graph().rankdir.toLowerCase();(d==="lr"||d==="rl")&&i(u)}function r(u){var d=u.graph().rankdir.toLowerCase();(d==="bt"||d==="rl")&&o(u),(d==="lr"||d==="rl")&&(c(u),i(u))}function i(u){n.forEach(u.nodes(),function(d){s(u.node(d))}),n.forEach(u.edges(),function(d){s(u.edge(d))})}function s(u){var d=u.width;u.width=u.height,u.height=d}function o(u){n.forEach(u.nodes(),function(d){a(u.node(d))}),n.forEach(u.edges(),function(d){var h=u.edge(d);n.forEach(h.points,a),n.has(h,"y")&&a(h)})}function a(u){u.y=-u.y}function c(u){n.forEach(u.nodes(),function(d){l(u.node(d))}),n.forEach(u.edges(),function(d){var h=u.edge(d);n.forEach(h.points,l),n.has(h,"x")&&l(h)})}function l(u){var d=u.x;u.x=u.y,u.y=d}return z0}var $0,sM;function NX(){if(sM)return $0;sM=1;var n=It();$0=e;function e(r){var i={},s=n.filter(r.nodes(),function(u){return!r.children(u).length}),o=n.max(n.map(s,function(u){return r.node(u).rank})),a=n.map(n.range(o+1),function(){return[]});function c(u){if(!n.has(i,u)){i[u]=!0;var d=r.node(u);a[d.rank].push(u),n.forEach(r.successors(u),c)}}var l=n.sortBy(s,function(u){return r.node(u).rank});return n.forEach(l,c),a}return $0}var B0,oM;function LX(){if(oM)return B0;oM=1;var n=It();B0=e;function e(i,s){for(var o=0,a=1;a<s.length;++a)o+=r(i,s[a-1],s[a]);return o}function r(i,s,o){for(var a=n.zipObject(o,n.map(o,function(p,g){return g})),c=n.flatten(n.map(s,function(p){return n.sortBy(n.map(i.outEdges(p),function(g){return{pos:a[g.w],weight:i.edge(g).weight}}),"pos")}),!0),l=1;l<o.length;)l<<=1;var u=2*l-1;l-=1;var d=n.map(new Array(u),function(){return 0}),h=0;return n.forEach(c.forEach(function(p){var g=p.pos+l;d[g]+=p.weight;for(var y=0;g>0;)g%2&&(y+=d[g+1]),g=g-1>>1,d[g]+=p.weight;h+=p.weight*y})),h}return B0}var U0,aM;function FX(){if(aM)return U0;aM=1;var n=It();U0=e;function e(r,i){return n.map(i,function(s){var o=r.inEdges(s);if(o.length){var a=n.reduce(o,function(c,l){var u=r.edge(l),d=r.node(l.v);return{sum:c.sum+u.weight*d.order,weight:c.weight+u.weight}},{sum:0,weight:0});return{v:s,barycenter:a.sum/a.weight,weight:a.weight}}else return{v:s}})}return U0}var q0,cM;function zX(){if(cM)return q0;cM=1;var n=It();q0=e;function e(s,o){var a={};n.forEach(s,function(l,u){var d=a[l.v]={indegree:0,in:[],out:[],vs:[l.v],i:u};n.isUndefined(l.barycenter)||(d.barycenter=l.barycenter,d.weight=l.weight)}),n.forEach(o.edges(),function(l){var u=a[l.v],d=a[l.w];!n.isUndefined(u)&&!n.isUndefined(d)&&(d.indegree++,u.out.push(a[l.w]))});var c=n.filter(a,function(l){return!l.indegree});return r(c)}function r(s){var o=[];function a(u){return function(d){d.merged||(n.isUndefined(d.barycenter)||n.isUndefined(u.barycenter)||d.barycenter>=u.barycenter)&&i(u,d)}}function c(u){return function(d){d.in.push(u),--d.indegree===0&&s.push(d)}}for(;s.length;){var l=s.pop();o.push(l),n.forEach(l.in.reverse(),a(l)),n.forEach(l.out,c(l))}return n.map(n.filter(o,function(u){return!u.merged}),function(u){return n.pick(u,["vs","i","barycenter","weight"])})}function i(s,o){var a=0,c=0;s.weight&&(a+=s.barycenter*s.weight,c+=s.weight),o.weight&&(a+=o.barycenter*o.weight,c+=o.weight),s.vs=o.vs.concat(s.vs),s.barycenter=a/c,s.weight=c,s.i=Math.min(o.i,s.i),o.merged=!0}return q0}var H0,lM;function $X(){if(lM)return H0;lM=1;var n=It(),e=Vn();H0=r;function r(o,a){var c=e.partition(o,function(v){return n.has(v,"barycenter")}),l=c.lhs,u=n.sortBy(c.rhs,function(v){return-v.i}),d=[],h=0,p=0,g=0;l.sort(s(!!a)),g=i(d,u,g),n.forEach(l,function(v){g+=v.vs.length,d.push(v.vs),h+=v.barycenter*v.weight,p+=v.weight,g=i(d,u,g)});var y={vs:n.flatten(d,!0)};return p&&(y.barycenter=h/p,y.weight=p),y}function i(o,a,c){for(var l;a.length&&(l=n.last(a)).i<=c;)a.pop(),o.push(l.vs),c++;return c}function s(o){return function(a,c){return a.barycenter<c.barycenter?-1:a.barycenter>c.barycenter?1:o?c.i-a.i:a.i-c.i}}return H0}var G0,uM;function BX(){if(uM)return G0;uM=1;var n=It(),e=FX(),r=zX(),i=$X();G0=s;function s(c,l,u,d){var h=c.children(l),p=c.node(l),g=p?p.borderLeft:void 0,y=p?p.borderRight:void 0,v={};g&&(h=n.filter(h,function(I){return I!==g&&I!==y}));var x=e(c,h);n.forEach(x,function(I){if(c.children(I.v).length){var C=s(c,I.v,u,d);v[I.v]=C,n.has(C,"barycenter")&&a(I,C)}});var m=r(x,u);o(m,v);var b=i(m,d);if(g&&(b.vs=n.flatten([g,b.vs,y],!0),c.predecessors(g).length)){var S=c.node(c.predecessors(g)[0]),w=c.node(c.predecessors(y)[0]);n.has(b,"barycenter")||(b.barycenter=0,b.weight=0),b.barycenter=(b.barycenter*b.weight+S.order+w.order)/(b.weight+2),b.weight+=2}return b}function o(c,l){n.forEach(c,function(u){u.vs=n.flatten(u.vs.map(function(d){return l[d]?l[d].vs:d}),!0)})}function a(c,l){n.isUndefined(c.barycenter)?(c.barycenter=l.barycenter,c.weight=l.weight):(c.barycenter=(c.barycenter*c.weight+l.barycenter*l.weight)/(c.weight+l.weight),c.weight+=l.weight)}return G0}var K0,dM;function UX(){if(dM)return K0;dM=1;var n=It(),e=Zr().Graph;K0=r;function r(s,o,a){var c=i(s),l=new e({compound:!0}).setGraph({root:c}).setDefaultNodeLabel(function(u){return s.node(u)});return n.forEach(s.nodes(),function(u){var d=s.node(u),h=s.parent(u);(d.rank===o||d.minRank<=o&&o<=d.maxRank)&&(l.setNode(u),l.setParent(u,h||c),n.forEach(s[a](u),function(p){var g=p.v===u?p.w:p.v,y=l.edge(g,u),v=n.isUndefined(y)?0:y.weight;l.setEdge(g,u,{weight:s.edge(p).weight+v})}),n.has(d,"minRank")&&l.setNode(u,{borderLeft:d.borderLeft[o],borderRight:d.borderRight[o]}))}),l}function i(s){for(var o;s.hasNode(o=n.uniqueId("_root")););return o}return K0}var V0,hM;function qX(){if(hM)return V0;hM=1;var n=It();V0=e;function e(r,i,s){var o={},a;n.forEach(s,function(c){for(var l=r.parent(c),u,d;l;){if(u=r.parent(l),u?(d=o[u],o[u]=l):(d=a,a=l),d&&d!==l){i.setEdge(d,l);return}l=u}})}return V0}var W0,fM;function HX(){if(fM)return W0;fM=1;var n=It(),e=NX(),r=LX(),i=BX(),s=UX(),o=qX(),a=Zr().Graph,c=Vn();W0=l;function l(p){var g=c.maxRank(p),y=u(p,n.range(1,g+1),"inEdges"),v=u(p,n.range(g-1,-1,-1),"outEdges"),x=e(p);h(p,x);for(var m=Number.POSITIVE_INFINITY,b,S=0,w=0;w<4;++S,++w){d(S%2?y:v,S%4>=2),x=c.buildLayerMatrix(p);var I=r(p,x);I<m&&(w=0,b=n.cloneDeep(x),m=I)}h(p,b)}function u(p,g,y){return n.map(g,function(v){return s(p,v,y)})}function d(p,g){var y=new a;n.forEach(p,function(v){var x=v.graph().root,m=i(v,x,y,g);n.forEach(m.vs,function(b,S){v.node(b).order=S}),o(v,y,m.vs)})}function h(p,g){n.forEach(g,function(y){n.forEach(y,function(v,x){p.node(v).order=x})})}return W0}var Y0,pM;function GX(){if(pM)return Y0;pM=1;var n=It(),e=Zr().Graph,r=Vn();Y0={positionX:y,findType1Conflicts:i,findType2Conflicts:s,addConflict:a,hasConflict:c,verticalAlignment:l,horizontalCompaction:u,alignCoordinates:p,findSmallestWidthAlignment:h,balance:g};function i(m,b){var S={};function w(I,C){var _=0,P=0,M=I.length,T=n.last(C);return n.forEach(C,function(A,R){var O=o(m,A),j=O?m.node(O).order:M;(O||A===T)&&(n.forEach(C.slice(P,R+1),function(D){n.forEach(m.predecessors(D),function(N){var F=m.node(N),z=F.order;(z<_||j<z)&&!(F.dummy&&m.node(D).dummy)&&a(S,N,D)})}),P=R+1,_=j)}),C}return n.reduce(b,w),S}function s(m,b){var S={};function w(C,_,P,M,T){var A;n.forEach(n.range(_,P),function(R){A=C[R],m.node(A).dummy&&n.forEach(m.predecessors(A),function(O){var j=m.node(O);j.dummy&&(j.order<M||j.order>T)&&a(S,O,A)})})}function I(C,_){var P=-1,M,T=0;return n.forEach(_,function(A,R){if(m.node(A).dummy==="border"){var O=m.predecessors(A);O.length&&(M=m.node(O[0]).order,w(_,T,R,P,M),T=R,P=M)}w(_,T,_.length,M,C.length)}),_}return n.reduce(b,I),S}function o(m,b){if(m.node(b).dummy)return n.find(m.predecessors(b),function(S){return m.node(S).dummy})}function a(m,b,S){if(b>S){var w=b;b=S,S=w}var I=m[b];I||(m[b]=I={}),I[S]=!0}function c(m,b,S){if(b>S){var w=b;b=S,S=w}return n.has(m[b],S)}function l(m,b,S,w){var I={},C={},_={};return n.forEach(b,function(P){n.forEach(P,function(M,T){I[M]=M,C[M]=M,_[M]=T})}),n.forEach(b,function(P){var M=-1;n.forEach(P,function(T){var A=w(T);if(A.length){A=n.sortBy(A,function(N){return _[N]});for(var R=(A.length-1)/2,O=Math.floor(R),j=Math.ceil(R);O<=j;++O){var D=A[O];C[T]===T&&M<_[D]&&!c(S,T,D)&&(C[D]=T,C[T]=I[T]=I[D],M=_[D])}}})}),{root:I,align:C}}function u(m,b,S,w,I){var C={},_=d(m,b,S,I),P=I?"borderLeft":"borderRight";function M(R,O){for(var j=_.nodes(),D=j.pop(),N={};D;)N[D]?R(D):(N[D]=!0,j.push(D),j=j.concat(O(D))),D=j.pop()}function T(R){C[R]=_.inEdges(R).reduce(function(O,j){return Math.max(O,C[j.v]+_.edge(j))},0)}function A(R){var O=_.outEdges(R).reduce(function(D,N){return Math.min(D,C[N.w]-_.edge(N))},Number.POSITIVE_INFINITY),j=m.node(R);O!==Number.POSITIVE_INFINITY&&j.borderType!==P&&(C[R]=Math.max(C[R],O))}return M(T,_.predecessors.bind(_)),M(A,_.successors.bind(_)),n.forEach(w,function(R){C[R]=C[S[R]]}),C}function d(m,b,S,w){var I=new e,C=m.graph(),_=v(C.nodesep,C.edgesep,w);return n.forEach(b,function(P){var M;n.forEach(P,function(T){var A=S[T];if(I.setNode(A),M){var R=S[M],O=I.edge(R,A);I.setEdge(R,A,Math.max(_(m,T,M),O||0))}M=T})}),I}function h(m,b){return n.minBy(n.values(b),function(S){var w=Number.NEGATIVE_INFINITY,I=Number.POSITIVE_INFINITY;return n.forIn(S,function(C,_){var P=x(m,_)/2;w=Math.max(C+P,w),I=Math.min(C-P,I)}),w-I})}function p(m,b){var S=n.values(b),w=n.min(S),I=n.max(S);n.forEach(["u","d"],function(C){n.forEach(["l","r"],function(_){var P=C+_,M=m[P],T;if(M!==b){var A=n.values(M);T=_==="l"?w-n.min(A):I-n.max(A),T&&(m[P]=n.mapValues(M,function(R){return R+T}))}})})}function g(m,b){return n.mapValues(m.ul,function(S,w){if(b)return m[b.toLowerCase()][w];var I=n.sortBy(n.map(m,w));return(I[1]+I[2])/2})}function y(m){var b=r.buildLayerMatrix(m),S=n.merge(i(m,b),s(m,b)),w={},I;n.forEach(["u","d"],function(_){I=_==="u"?b:n.values(b).reverse(),n.forEach(["l","r"],function(P){P==="r"&&(I=n.map(I,function(R){return n.values(R).reverse()}));var M=(_==="u"?m.predecessors:m.successors).bind(m),T=l(m,I,S,M),A=u(m,I,T.root,T.align,P==="r");P==="r"&&(A=n.mapValues(A,function(R){return-R})),w[_+P]=A})});var C=h(m,w);return p(w,C),g(w,m.graph().align)}function v(m,b,S){return function(w,I,C){var _=w.node(I),P=w.node(C),M=0,T;if(M+=_.width/2,n.has(_,"labelpos"))switch(_.labelpos.toLowerCase()){case"l":T=-_.width/2;break;case"r":T=_.width/2;break}if(T&&(M+=S?T:-T),T=0,M+=(_.dummy?b:m)/2,M+=(P.dummy?b:m)/2,M+=P.width/2,n.has(P,"labelpos"))switch(P.labelpos.toLowerCase()){case"l":T=P.width/2;break;case"r":T=-P.width/2;break}return T&&(M+=S?T:-T),T=0,M}}function x(m,b){return m.node(b).width}return Y0}var X0,gM;function KX(){if(gM)return X0;gM=1;var n=It(),e=Vn(),r=GX().positionX;X0=i;function i(o){o=e.asNonCompoundGraph(o),s(o),n.forEach(r(o),function(a,c){o.node(c).x=a})}function s(o){var a=e.buildLayerMatrix(o),c=o.graph().ranksep,l=0;n.forEach(a,function(u){var d=n.max(n.map(u,function(h){return o.node(h).height}));n.forEach(u,function(h){o.node(h).y=l+d/2}),l+=d+c})}return X0}var Z0,mM;function VX(){if(mM)return Z0;mM=1;var n=It(),e=kX(),r=TX(),i=AX(),s=Vn().normalizeRanks,o=jX(),a=Vn().removeEmptyRanks,c=RX(),l=OX(),u=DX(),d=HX(),h=KX(),p=Vn(),g=Zr().Graph;Z0=y;function y(B,U){var Q=U&&U.debugTiming?p.time:p.notime;Q("layout",function(){var K=Q("  buildLayoutGraph",function(){return M(B)});Q("  runLayout",function(){v(K,Q)}),Q("  updateInputGraph",function(){x(B,K)})})}function v(B,U){U("    makeSpaceForEdgeLabels",function(){T(B)}),U("    removeSelfEdges",function(){$(B)}),U("    acyclic",function(){e.run(B)}),U("    nestingGraph.run",function(){c.run(B)}),U("    rank",function(){i(p.asNonCompoundGraph(B))}),U("    injectEdgeLabelProxies",function(){A(B)}),U("    removeEmptyRanks",function(){a(B)}),U("    nestingGraph.cleanup",function(){c.cleanup(B)}),U("    normalizeRanks",function(){s(B)}),U("    assignRankMinMax",function(){R(B)}),U("    removeEdgeLabelProxies",function(){O(B)}),U("    normalize.run",function(){r.run(B)}),U("    parentDummyChains",function(){o(B)}),U("    addBorderSegments",function(){l(B)}),U("    order",function(){d(B)}),U("    insertSelfEdges",function(){G(B)}),U("    adjustCoordinateSystem",function(){u.adjust(B)}),U("    position",function(){h(B)}),U("    positionSelfEdges",function(){X(B)}),U("    removeBorderNodes",function(){z(B)}),U("    normalize.undo",function(){r.undo(B)}),U("    fixupEdgeLabelCoords",function(){N(B)}),U("    undoCoordinateSystem",function(){u.undo(B)}),U("    translateGraph",function(){j(B)}),U("    assignNodeIntersects",function(){D(B)}),U("    reversePoints",function(){F(B)}),U("    acyclic.undo",function(){e.undo(B)})}function x(B,U){n.forEach(B.nodes(),function(Q){var K=B.node(Q),Y=U.node(Q);K&&(K.x=Y.x,K.y=Y.y,U.children(Q).length&&(K.width=Y.width,K.height=Y.height))}),n.forEach(B.edges(),function(Q){var K=B.edge(Q),Y=U.edge(Q);K.points=Y.points,n.has(Y,"x")&&(K.x=Y.x,K.y=Y.y)}),B.graph().width=U.graph().width,B.graph().height=U.graph().height}var m=["nodesep","edgesep","ranksep","marginx","marginy"],b={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},S=["acyclicer","ranker","rankdir","align"],w=["width","height"],I={width:0,height:0},C=["minlen","weight","width","height","labeloffset"],_={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},P=["labelpos"];function M(B){var U=new g({multigraph:!0,compound:!0}),Q=re(B.graph());return U.setGraph(n.merge({},b,ee(Q,m),n.pick(Q,S))),n.forEach(B.nodes(),function(K){var Y=re(B.node(K));U.setNode(K,n.defaults(ee(Y,w),I)),U.setParent(K,B.parent(K))}),n.forEach(B.edges(),function(K){var Y=re(B.edge(K));U.setEdge(K,n.merge({},_,ee(Y,C),n.pick(Y,P)))}),U}function T(B){var U=B.graph();U.ranksep/=2,n.forEach(B.edges(),function(Q){var K=B.edge(Q);K.minlen*=2,K.labelpos.toLowerCase()!=="c"&&(U.rankdir==="TB"||U.rankdir==="BT"?K.width+=K.labeloffset:K.height+=K.labeloffset)})}function A(B){n.forEach(B.edges(),function(U){var Q=B.edge(U);if(Q.width&&Q.height){var K=B.node(U.v),Y=B.node(U.w),V={rank:(Y.rank-K.rank)/2+K.rank,e:U};p.addDummyNode(B,"edge-proxy",V,"_ep")}})}function R(B){var U=0;n.forEach(B.nodes(),function(Q){var K=B.node(Q);K.borderTop&&(K.minRank=B.node(K.borderTop).rank,K.maxRank=B.node(K.borderBottom).rank,U=n.max(U,K.maxRank))}),B.graph().maxRank=U}function O(B){n.forEach(B.nodes(),function(U){var Q=B.node(U);Q.dummy==="edge-proxy"&&(B.edge(Q.e).labelRank=Q.rank,B.removeNode(U))})}function j(B){var U=Number.POSITIVE_INFINITY,Q=0,K=Number.POSITIVE_INFINITY,Y=0,V=B.graph(),ie=V.marginx||0,ae=V.marginy||0;function ye(he){var xe=he.x,fe=he.y,me=he.width,we=he.height;U=Math.min(U,xe-me/2),Q=Math.max(Q,xe+me/2),K=Math.min(K,fe-we/2),Y=Math.max(Y,fe+we/2)}n.forEach(B.nodes(),function(he){ye(B.node(he))}),n.forEach(B.edges(),function(he){var xe=B.edge(he);n.has(xe,"x")&&ye(xe)}),U-=ie,K-=ae,n.forEach(B.nodes(),function(he){var xe=B.node(he);xe.x-=U,xe.y-=K}),n.forEach(B.edges(),function(he){var xe=B.edge(he);n.forEach(xe.points,function(fe){fe.x-=U,fe.y-=K}),n.has(xe,"x")&&(xe.x-=U),n.has(xe,"y")&&(xe.y-=K)}),V.width=Q-U+ie,V.height=Y-K+ae}function D(B){n.forEach(B.edges(),function(U){var Q=B.edge(U),K=B.node(U.v),Y=B.node(U.w),V,ie;Q.points?(V=Q.points[0],ie=Q.points[Q.points.length-1]):(Q.points=[],V=Y,ie=K),Q.points.unshift(p.intersectRect(K,V)),Q.points.push(p.intersectRect(Y,ie))})}function N(B){n.forEach(B.edges(),function(U){var Q=B.edge(U);if(n.has(Q,"x"))switch((Q.labelpos==="l"||Q.labelpos==="r")&&(Q.width-=Q.labeloffset),Q.labelpos){case"l":Q.x-=Q.width/2+Q.labeloffset;break;case"r":Q.x+=Q.width/2+Q.labeloffset;break}})}function F(B){n.forEach(B.edges(),function(U){var Q=B.edge(U);Q.reversed&&Q.points.reverse()})}function z(B){n.forEach(B.nodes(),function(U){if(B.children(U).length){var Q=B.node(U),K=B.node(Q.borderTop),Y=B.node(Q.borderBottom),V=B.node(n.last(Q.borderLeft)),ie=B.node(n.last(Q.borderRight));Q.width=Math.abs(ie.x-V.x),Q.height=Math.abs(Y.y-K.y),Q.x=V.x+Q.width/2,Q.y=K.y+Q.height/2}}),n.forEach(B.nodes(),function(U){B.node(U).dummy==="border"&&B.removeNode(U)})}function $(B){n.forEach(B.edges(),function(U){if(U.v===U.w){var Q=B.node(U.v);Q.selfEdges||(Q.selfEdges=[]),Q.selfEdges.push({e:U,label:B.edge(U)}),B.removeEdge(U)}})}function G(B){var U=p.buildLayerMatrix(B);n.forEach(U,function(Q){var K=0;n.forEach(Q,function(Y,V){var ie=B.node(Y);ie.order=V+K,n.forEach(ie.selfEdges,function(ae){p.addDummyNode(B,"selfedge",{width:ae.label.width,height:ae.label.height,rank:ie.rank,order:V+ ++K,e:ae.e,label:ae.label},"_se")}),delete ie.selfEdges})})}function X(B){n.forEach(B.nodes(),function(U){var Q=B.node(U);if(Q.dummy==="selfedge"){var K=B.node(Q.e.v),Y=K.x+K.width/2,V=K.y,ie=Q.x-Y,ae=K.height/2;B.setEdge(Q.e,Q.label),B.removeNode(U),Q.label.points=[{x:Y+2*ie/3,y:V-ae},{x:Y+5*ie/6,y:V-ae},{x:Y+ie,y:V},{x:Y+5*ie/6,y:V+ae},{x:Y+2*ie/3,y:V+ae}],Q.label.x=Q.x,Q.label.y=Q.y}})}function ee(B,U){return n.mapValues(n.pick(B,U),Number)}function re(B){var U={};return n.forEach(B,function(Q,K){U[K.toLowerCase()]=Q}),U}return Z0}var Q0,yM;function WX(){if(yM)return Q0;yM=1;var n=It(),e=Vn(),r=Zr().Graph;Q0={debugOrdering:i};function i(s){var o=e.buildLayerMatrix(s),a=new r({compound:!0,multigraph:!0}).setGraph({});return n.forEach(s.nodes(),function(c){a.setNode(c,{label:c}),a.setParent(c,"layer"+s.node(c).rank)}),n.forEach(s.edges(),function(c){a.setEdge(c.v,c.w,{},c.name)}),n.forEach(o,function(c,l){var u="layer"+l;a.setNode(u,{rank:"same"}),n.reduce(c,function(d,h){return a.setEdge(d,h,{style:"invis"}),h})}),a}return Q0}var J0,vM;function YX(){return vM||(vM=1,J0="0.8.5"),J0}var ex,xM;function XX(){return xM||(xM=1,ex={graphlib:Zr(),layout:VX(),debug:WX(),util:{time:Vn().time,notime:Vn().notime},version:YX()}),ex}var ZX=XX();const bM=rs(ZX),QX=/^graph\s+(TD|TB|LR|RL|BT)/i,JX=/^\s*(\w+)\["([^"]+)"\]/,eZ=/^\s*(\w+)\(["']?([^)"']+)["']?\)/,tZ=/^\s*(\w+)\{["']?([^}"']+)["']?\}/,nZ=/^\s*(\w+)\s*-->\s*\|([^|]+)\|\s*(\w+)/,rZ=/^\s*(\w+)\s*-->\s*(\w+)/,iZ=/^\s*(\w+)\s*-->\s*(\w+)\["([^"]+)"\]/;function lL(n){const e=n.split(`
`).map(c=>c.trim()).filter(Boolean);let r="TB";const i=new Map,s=[];let o=0;for(const c of e){const l=c.match(QX);if(l){const v=l[1].toUpperCase();r=v==="LR"||v==="RL"?"LR":"TB";continue}if(/^(subgraph|end|style|class|classDef|linkStyle)\b/i.test(c))continue;const u=c.match(nZ);if(u){const[,v,x,m]=u;i.has(v)||i.set(v,v),i.has(m)||i.set(m,m),s.push({id:`e${o++}`,source:v,target:m,label:x.trim()});continue}const d=c.match(iZ);if(d){const[,v,x,m]=d;i.has(v)||i.set(v,v),i.set(x,m),s.push({id:`e${o++}`,source:v,target:x});continue}const h=c.match(rZ);if(h){const[,v,x]=h;i.has(v)||i.set(v,v),i.has(x)||i.set(x,x),s.push({id:`e${o++}`,source:v,target:x});continue}const p=c.match(JX);if(p){const[,v,x]=p;i.set(v,x);continue}const g=c.match(eZ);if(g){const[,v,x]=g;i.set(v,x);continue}const y=c.match(tZ);if(y){const[,v,x]=y;i.set(v,x);continue}}return{nodes:Array.from(i.entries()).map(([c,l])=>({id:c,type:"arcade",position:{x:0,y:0},data:{label:l}})),edges:s,direction:r}}function Jc(n,e,r="TB"){const i=[`graph ${r}`];for(const s of n){const o=s.data.label||s.id;i.push(`    ${s.id}["${o}"]`)}i.push("");for(const s of e)s.label?i.push(`    ${s.source} -->|${s.label}| ${s.target}`):i.push(`    ${s.source} --> ${s.target}`);return i.join(`
`)}function lo(n,e,r){const{direction:i,nodeWidth:s=180,nodeHeight:o=50,rankSep:a=80,nodeSep:c=40}=r,l=new bM.graphlib.Graph;l.setDefaultEdgeLabel(()=>({})),l.setGraph({rankdir:i,ranksep:a,nodesep:c});for(const u of n)l.setNode(u.id,{width:s,height:o});for(const u of e)l.setEdge(u.source,u.target);return bM.layout(l),n.map(u=>{const d=l.node(u.id);return{...u,position:{x:d.x-s/2,y:d.y-o/2}}})}function Z1(n){return(n||"Untitled Canvas").trim().replace(/[/\\?%*:|"<>]/g,"-")||"Untitled Canvas"}function Q1(n){const e=new Date().toISOString(),r=["---","type: brain-canvas",`canvas_mode: ${n.mode}`,`title: "${n.title.replace(/"/g,'\\"')}"`,`updated: ${e}`];return n.layoutPath&&r.push(`layout_path: "${n.layoutPath}"`),n.strokesPath&&r.push(`strokes_path: "${n.strokesPath}"`),n.snapshotPath&&r.push(`snapshot_path: "${n.snapshotPath}"`),r.push("---","",`# ${n.title}`,""),n.mermaid?.trim()?r.push("```mermaid",n.mermaid.trim(),"```",""):r.push("> Freehand canvas content is stored in sidecar JSON files.",""),r.join(`
`)}const cw=u1,sZ=cN;function oZ({data:n,selected:e}){const r=n.label,i=n.colorIdx??0,s=cw[i]||cw[0];return f.jsxs("div",{className:Kt("px-3 py-2 font-terminal text-xs border-2 rounded-none min-w-[100px] text-center",e?"border-primary text-primary ring-1 ring-primary":`${s.border} ${s.text}`,s.bg),children:[f.jsx(Sn,{type:"target",position:Ce.Top,className:"!bg-primary !border-primary !w-2 !h-2"}),f.jsx(Sn,{type:"target",position:Ce.Left,className:"!bg-primary !border-primary !w-2 !h-2"}),r,f.jsx(Sn,{type:"source",position:Ce.Bottom,className:"!bg-primary !border-primary !w-2 !h-2"}),f.jsx(Sn,{type:"source",position:Ce.Right,className:"!bg-primary !border-primary !w-2 !h-2"})]})}const aZ={arcade:oZ},cZ={type:"smoothstep",style:{stroke:"hsl(var(--primary))",strokeWidth:2},markerEnd:{type:Ls.ArrowClosed,color:"hsl(var(--primary))"}},lZ=[{id:"basic-concept-map",name:"Concept Map",description:"Central concept with labeled branches",category:"concept-map",mermaid:`graph TD
    A["Central Concept"]
    B["Related Idea 1"]
    C["Related Idea 2"]
    D["Related Idea 3"]
    E["Related Idea 4"]
    A -->|"causes"| B
    A -->|"includes"| C
    A -->|"affects"| D
    B -->|"leads to"| E`},{id:"process-flowchart",name:"Process Flowchart",description:"Linear process with decision point",category:"flowchart",mermaid:`graph TD
    A["Start / Input"]
    B["Step 1"]
    C{"Decision?"}
    D["Path A"]
    E["Path B"]
    F["Outcome"]
    A --> B
    B --> C
    C -->|"Yes"| D
    C -->|"No"| E
    D --> F
    E --> F`},{id:"clinical-decision-tree",name:"Clinical Decision Tree",description:"Presentation to diagnosis reasoning",category:"decision-tree",mermaid:`graph TD
    A["Patient Presentation"]
    B{"Key Finding 1?"}
    C{"Key Finding 2?"}
    D["Differential A"]
    E["Differential B"]
    F["Confirm: Test X"]
    G["Confirm: Test Y"]
    A --> B
    B -->|"Present"| D
    B -->|"Absent"| C
    C -->|"Positive"| E
    C -->|"Negative"| D
    D --> F
    E --> G`},{id:"physiological-pathway",name:"Physiological Pathway",description:"Stimulus to response cascade",category:"pathway",mermaid:`graph TD
    A["Stimulus"]
    B["Receptor / Sensor"]
    C["Signal Transduction"]
    D["Effector Response"]
    E["Outcome / Adaptation"]
    F["Feedback Loop"]
    A --> B
    B --> C
    C --> D
    D --> E
    E -->|"negative feedback"| A
    E -->|"modulates"| F
    F --> B`},{id:"compare-contrast",name:"Compare & Contrast",description:"Two concepts with shared and unique features",category:"compare",mermaid:`graph LR
    A["Concept A"]
    B["Shared Feature 1"]
    C["Shared Feature 2"]
    D["Concept B"]
    E["Unique to A"]
    F["Unique to B"]
    A --> B
    D --> B
    A --> C
    D --> C
    A --> E
    D --> F`}];function uZ({mermaidInput:n,onMermaidInputChange:e,onImport:r,onBlank:i,className:s}){return f.jsxs("div",{className:Kt("flex flex-col items-center h-full p-4 gap-3 overflow-auto",s),children:[f.jsx("p",{className:"font-arcade text-xs text-primary",children:"CONCEPT MAP EDITOR"}),f.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"START FROM TEMPLATE"}),f.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-md",children:lZ.map(o=>f.jsxs("button",{onClick:()=>r(o.mermaid),className:"border-2 border-secondary/50 hover:border-primary p-3 cursor-pointer text-left transition-colors bg-black/40",children:[f.jsx("p",{className:"font-terminal text-xs text-primary",children:o.name}),f.jsx("p",{className:"font-terminal text-xs text-muted-foreground mt-0.5",children:o.description})]},o.id))}),f.jsx("div",{className:"w-px h-2"}),f.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"OR PASTE MERMAID CODE"}),f.jsx(eU,{value:n,onChange:o=>e(o.target.value),placeholder:`graph TD
    A["Main Topic"]
    B["Subtopic 1"]
    C["Subtopic 2"]
    A --> B
    A --> C`,className:"w-full max-w-md h-32 font-mono text-xs rounded-none border-secondary bg-black/60"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs(De,{size:"sm",className:"font-terminal text-xs rounded-none",onClick:()=>r(n),disabled:!n.trim(),children:[f.jsx(mN,{className:"w-3 h-3 mr-1"}),"Import"]}),f.jsxs(De,{size:"sm",variant:"outline",className:"font-terminal text-xs rounded-none",onClick:i,children:[f.jsx(Dh,{className:"w-3 h-3 mr-1"}),"Blank Canvas"]})]})]})}function dZ({initialMermaid:n,onSave:e,onInitialMermaidConsumed:r,hideToolbar:i=!1,externalCommand:s,onStatusChange:o,className:a}){const[c,l,u]=t5([]),[d,h,p]=n5([]),[g,y]=E.useState("TB"),[v,x]=E.useState(!n&&c.length===0),[m,b]=E.useState(n||""),[S,w]=E.useState(0),[I,C]=E.useState(!1),[_,P]=E.useState(null),[M,T]=E.useState(!1),A=E.useRef(null),R=E.useRef(!1),O=E.useRef(0),{toast:j}=Eh(),D=E.useCallback(V=>{if(!V.trim())return;const ie=lL(V);y(ie.direction);const ae=lo(ie.nodes,ie.edges,{direction:ie.direction});l(ae),h(ie.edges),w(ie.nodes.length),x(!1),T(!0)},[l,h]);E.useEffect(()=>{n?.trim()&&!R.current&&(R.current=!0,D(n),b(n),r?.())},[n,D,r]),E.useEffect(()=>{if(!I)return;const V=ie=>{ie.key==="Escape"&&C(!1)};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[I]);const N=E.useCallback(V=>{T(!0),u(V)},[u]),F=E.useCallback(V=>{T(!0),p(V)},[p]),z=E.useCallback(V=>{T(!0),h(ie=>P1(V,ie))},[h]),$=E.useCallback(()=>{const V=lo(c,d,{direction:g});l(V),T(!0)},[c,d,g,l]),G=E.useCallback(()=>{const V=g==="TB"?"LR":"TB";y(V);const ie=lo(c,d,{direction:V});l(ie),T(!0)},[g,c,d,l]),X=E.useCallback(()=>{const V=`N${S+1}`;w(ae=>ae+1);const ie={id:V,type:"arcade",position:{x:Math.random()*300+50,y:Math.random()*200+50},data:{label:`New Node ${S+1}`,colorIdx:0}};l(ae=>[...ae,ie]),T(!0)},[S,l]),ee=E.useCallback(()=>{l(V=>V.filter(ie=>!ie.selected)),h(V=>V.filter(ie=>!ie.selected)),T(!0)},[l,h]),re=E.useCallback(V=>{l(ie=>ie.map(ae=>ae.selected?{...ae,data:{...ae.data,colorIdx:V}}:ae)),P(null),T(!0)},[l]),B=E.useCallback(V=>{h(ie=>ie.map(ae=>ae.selected?{...ae,style:{...ae.style,stroke:V,strokeWidth:2},markerEnd:{type:Ls.ArrowClosed,color:V}}:ae)),P(null),T(!0)},[h]),U=E.useCallback(async()=>{if(A.current)try{const V=A.current.querySelector(".react-flow__viewport");if(!V)return;const ie=await aN(V,{backgroundColor:"#000",quality:1}),ae=document.createElement("a");ae.download="concept-map.png",ae.href=ie,ae.click(),j({title:"PNG exported"})}catch(V){j({title:"Export failed",description:String(V),variant:"destructive"})}},[j]),Q=E.useCallback(()=>{const V=Jc(c,d,g);navigator.clipboard.writeText(V),j({title:"Mermaid copied to clipboard"})},[c,d,g,j]),K=E.useCallback(async()=>{const V=Jc(c,d,g),ie=Z1(c[0]?.data?.label||"Untitled Canvas"),ae=`Brain Canvas/${ie}`,ye=`${ae}.md`,he=`${ae}.layout.json`,xe=JSON.stringify({direction:g,nodes:c.map(me=>({id:me.id,type:me.type,position:me.position,data:me.data,style:me.style})),edges:d.map(me=>({id:me.id,source:me.source,target:me.target,label:me.label,style:me.style,markerEnd:me.markerEnd})),updated:new Date().toISOString()},null,2),fe=Q1({mode:"structured",title:ie,mermaid:V,layoutPath:he});try{await Cr.obsidian.saveFile(he,xe),await Cr.obsidian.saveFile(ye,fe),j({title:"Saved to vault",description:ye}),e?.(V),T(!1)}catch(me){j({title:"Save failed",description:String(me),variant:"destructive"})}},[c,d,g,j,e]),Y=E.useCallback(()=>{x(!0),b(c.length>0?Jc(c,d,g):"")},[c,d,g]);return E.useEffect(()=>{o?.({mode:"structured",isDirty:M,nodeCount:c.length,edgeCount:d.length,canUndo:!1,canRedo:!1,supportsMermaid:!0,supportsDraw:!1,selectedLabels:c.filter(V=>V.selected).map(V=>String(V.data?.label||V.id))})},[o,M,c,d]),E.useEffect(()=>{if(!(!s||s.target!=="structured")&&s.id!==O.current)switch(O.current=s.id,s.type){case"save":K();break;case"export_png":U();break;case"export_mermaid":Q();break;case"import_mermaid":{const V=typeof s.payload=="string"?s.payload.trim():"";V?(D(V),b(V)):Y();break}case"add_node":X();break;case"delete_selected":ee();break;case"auto_layout":$();break;case"toggle_direction":G();break}},[s,K,U,Q,D,Y,X,ee,$,G]),v&&c.length===0?f.jsx(uZ,{mermaidInput:m,onMermaidInputChange:b,onImport:D,onBlank:()=>{x(!1),X()},className:a}):f.jsxs("div",{className:Kt("flex flex-col",I?"fixed inset-0 z-[100010] bg-black":"h-full",a),children:[!i&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-secondary/30 bg-black/40 shrink-0 flex-wrap",children:[f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:Y,title:"Back to import",children:f.jsx(fU,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:X,title:"Add node",children:f.jsx(Dh,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:ee,title:"Delete selected",children:f.jsx(JD,{className:"w-3 h-3"})}),f.jsxs("div",{className:"relative",children:[f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:()=>P(_?null:"node"),title:"Color selected",children:f.jsx(vN,{className:"w-3 h-3"})}),_&&f.jsxs("div",{className:"absolute top-full left-0 mt-1 p-2 bg-black border-2 border-primary/50 z-50 space-y-2 min-w-[160px]",children:[f.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"NODE COLORS"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:cw.map((V,ie)=>f.jsx("button",{onClick:()=>re(ie),className:Kt("w-5 h-5 border-2 rounded-none",V.border,V.bg),title:V.name},V.name))}),f.jsx("p",{className:"font-terminal text-xs text-muted-foreground pt-1",children:"EDGE COLORS"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:sZ.map(V=>f.jsx("button",{onClick:()=>B(V.stroke),className:"w-5 h-5 border-2 border-secondary/50 rounded-none",style:{backgroundColor:V.stroke},title:V.name},V.name))})]})]}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:$,title:"Auto layout",children:f.jsx(yN,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:G,title:`Direction: ${g}`,children:g==="TB"?f.jsx(fN,{className:"w-3 h-3"}):f.jsx(hN,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:Q,title:"Copy Mermaid",children:f.jsx(lN,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:U,title:"Export PNG",children:f.jsx(Oh,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:K,title:"Save to vault",children:f.jsx(Rh,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:()=>C(!I),title:I?"Exit fullscreen":"Fullscreen",children:I?f.jsx(uU,{className:"w-3 h-3"}):f.jsx(dU,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-xs font-terminal",onClick:()=>{x(!0),l([]),h([])},title:"Import Mermaid",children:f.jsx(mN,{className:"w-3 h-3"})}),f.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs font-terminal text-muted-foreground",children:[f.jsxs("span",{children:[c.length,"N / ",d.length,"E"]}),f.jsx("span",{className:Kt("w-2 h-2 rounded-full",M?"bg-destructive":"bg-success")}),f.jsx("span",{children:M?"Unsaved":"Saved"})]})]}),f.jsx("div",{className:"flex-1 min-h-0",ref:A,children:f.jsxs(e5,{nodes:c,edges:d,onNodesChange:N,onEdgesChange:F,onConnect:z,nodeTypes:aZ,defaultEdgeOptions:cZ,fitView:!0,className:"bg-black/80",proOptions:{hideAttribution:!0},onPaneClick:()=>P(null),children:[f.jsx(i5,{color:"hsl(var(--primary) / 0.1)",gap:20}),f.jsx(o5,{className:"!bg-black !border-primary [&_button]:!bg-black/80 [&_button]:!border-primary/50 [&_button]:!text-primary"}),f.jsx(c5,{className:"!bg-black/80 !border-primary",nodeColor:"hsl(var(--primary))",maskColor:"rgba(0,0,0,0.5)"})]})})]})}var SM={},lc,wM;function Cn(){if(wM)return lc;wM=1;var n=function(e){return e&&e.Math===Math&&e};return lc=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof Gt=="object"&&Gt)||n(typeof lc=="object"&&lc)||(function(){return this})()||Function("return this")(),lc}var tx={},nx,_M;function Pn(){return _M||(_M=1,nx=function(n){try{return!!n()}catch{return!0}}),nx}var rx,CM;function as(){if(CM)return rx;CM=1;var n=Pn();return rx=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),rx}var ix,PM;function df(){if(PM)return ix;PM=1;var n=Pn();return ix=!n(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),ix}var sx,IM;function cs(){if(IM)return sx;IM=1;var n=df(),e=Function.prototype.call;return sx=n?e.bind(e):function(){return e.apply(e,arguments)},sx}var ox={},EM;function hZ(){if(EM)return ox;EM=1;var n={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,r=e&&!n.call({1:2},1);return ox.f=r?function(s){var o=e(this,s);return!!o&&o.enumerable}:n,ox}var ax,kM;function J1(){return kM||(kM=1,ax=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}}),ax}var cx,TM;function Zt(){if(TM)return cx;TM=1;var n=df(),e=Function.prototype,r=e.call,i=n&&e.bind.bind(r,r);return cx=n?i:function(s){return function(){return r.apply(s,arguments)}},cx}var lx,MM;function qa(){if(MM)return lx;MM=1;var n=Zt(),e=n({}.toString),r=n("".slice);return lx=function(i){return r(e(i),8,-1)},lx}var ux,AM;function fZ(){if(AM)return ux;AM=1;var n=Zt(),e=Pn(),r=qa(),i=Object,s=n("".split);return ux=e(function(){return!i("z").propertyIsEnumerable(0)})?function(o){return r(o)==="String"?s(o,""):i(o)}:i,ux}var dx,jM;function uL(){return jM||(jM=1,dx=function(n){return n==null}),dx}var hx,RM;function Ha(){if(RM)return hx;RM=1;var n=uL(),e=TypeError;return hx=function(r){if(n(r))throw new e("Can't call method on "+r);return r},hx}var fx,OM;function hf(){if(OM)return fx;OM=1;var n=fZ(),e=Ha();return fx=function(r){return n(e(r))},fx}var px,DM;function Mn(){if(DM)return px;DM=1;var n=typeof document=="object"&&document.all;return px=typeof n>"u"&&n!==void 0?function(e){return typeof e=="function"||e===n}:function(e){return typeof e=="function"},px}var gx,NM;function ls(){if(NM)return gx;NM=1;var n=Mn();return gx=function(e){return typeof e=="object"?e!==null:n(e)},gx}var mx,LM;function ff(){if(LM)return mx;LM=1;var n=Cn(),e=Mn(),r=function(i){return e(i)?i:void 0};return mx=function(i,s){return arguments.length<2?r(n[i]):n[i]&&n[i][s]},mx}var yx,FM;function dL(){if(FM)return yx;FM=1;var n=Zt();return yx=n({}.isPrototypeOf),yx}var vx,zM;function pZ(){if(zM)return vx;zM=1;var n=Cn(),e=n.navigator,r=e&&e.userAgent;return vx=r?String(r):"",vx}var xx,$M;function gZ(){if($M)return xx;$M=1;var n=Cn(),e=pZ(),r=n.process,i=n.Deno,s=r&&r.versions||i&&i.version,o=s&&s.v8,a,c;return o&&(a=o.split("."),c=a[0]>0&&a[0]<4?1:+(a[0]+a[1])),!c&&e&&(a=e.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=e.match(/Chrome\/(\d+)/),a&&(c=+a[1]))),xx=c,xx}var bx,BM;function hL(){if(BM)return bx;BM=1;var n=gZ(),e=Pn(),r=Cn(),i=r.String;return bx=!!Object.getOwnPropertySymbols&&!e(function(){var s=Symbol("symbol detection");return!i(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&n&&n<41}),bx}var Sx,UM;function fL(){if(UM)return Sx;UM=1;var n=hL();return Sx=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Sx}var wx,qM;function pL(){if(qM)return wx;qM=1;var n=ff(),e=Mn(),r=dL(),i=fL(),s=Object;return wx=i?function(o){return typeof o=="symbol"}:function(o){var a=n("Symbol");return e(a)&&r(a.prototype,s(o))},wx}var _x,HM;function mZ(){if(HM)return _x;HM=1;var n=String;return _x=function(e){try{return n(e)}catch{return"Object"}},_x}var Cx,GM;function e_(){if(GM)return Cx;GM=1;var n=Mn(),e=mZ(),r=TypeError;return Cx=function(i){if(n(i))return i;throw new r(e(i)+" is not a function")},Cx}var Px,KM;function t_(){if(KM)return Px;KM=1;var n=e_(),e=uL();return Px=function(r,i){var s=r[i];return e(s)?void 0:n(s)},Px}var Ix,VM;function yZ(){if(VM)return Ix;VM=1;var n=cs(),e=Mn(),r=ls(),i=TypeError;return Ix=function(s,o){var a,c;if(o==="string"&&e(a=s.toString)&&!r(c=n(a,s))||e(a=s.valueOf)&&!r(c=n(a,s))||o!=="string"&&e(a=s.toString)&&!r(c=n(a,s)))return c;throw new i("Can't convert object to primitive value")},Ix}var Ex={exports:{}},kx,WM;function gL(){return WM||(WM=1,kx=!1),kx}var Tx,YM;function n_(){if(YM)return Tx;YM=1;var n=Cn(),e=Object.defineProperty;return Tx=function(r,i){try{e(n,r,{value:i,configurable:!0,writable:!0})}catch{n[r]=i}return i},Tx}var XM;function r_(){if(XM)return Ex.exports;XM=1;var n=gL(),e=Cn(),r=n_(),i="__core-js_shared__",s=Ex.exports=e[i]||r(i,{});return(s.versions||(s.versions=[])).push({version:"3.48.0",mode:n?"pure":"global",copyright:" 20132025 Denis Pushkarev (zloirock.ru), 20252026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"}),Ex.exports}var Mx,ZM;function i_(){if(ZM)return Mx;ZM=1;var n=r_();return Mx=function(e,r){return n[e]||(n[e]=r||{})},Mx}var Ax,QM;function Zl(){if(QM)return Ax;QM=1;var n=Ha(),e=Object;return Ax=function(r){return e(n(r))},Ax}var jx,JM;function Us(){if(JM)return jx;JM=1;var n=Zt(),e=Zl(),r=n({}.hasOwnProperty);return jx=Object.hasOwn||function(s,o){return r(e(s),o)},jx}var Rx,eA;function mL(){if(eA)return Rx;eA=1;var n=Zt(),e=0,r=Math.random(),i=n(1.1.toString);return Rx=function(s){return"Symbol("+(s===void 0?"":s)+")_"+i(++e+r,36)},Rx}var Ox,tA;function us(){if(tA)return Ox;tA=1;var n=Cn(),e=i_(),r=Us(),i=mL(),s=hL(),o=fL(),a=n.Symbol,c=e("wks"),l=o?a.for||a:a&&a.withoutSetter||i;return Ox=function(u){return r(c,u)||(c[u]=s&&r(a,u)?a[u]:l("Symbol."+u)),c[u]},Ox}var Dx,nA;function vZ(){if(nA)return Dx;nA=1;var n=cs(),e=ls(),r=pL(),i=t_(),s=yZ(),o=us(),a=TypeError,c=o("toPrimitive");return Dx=function(l,u){if(!e(l)||r(l))return l;var d=i(l,c),h;if(d){if(u===void 0&&(u="default"),h=n(d,l,u),!e(h)||r(h))return h;throw new a("Can't convert object to primitive value")}return u===void 0&&(u="number"),s(l,u)},Dx}var Nx,rA;function yL(){if(rA)return Nx;rA=1;var n=vZ(),e=pL();return Nx=function(r){var i=n(r,"string");return e(i)?i:i+""},Nx}var Lx,iA;function vL(){if(iA)return Lx;iA=1;var n=Cn(),e=ls(),r=n.document,i=e(r)&&e(r.createElement);return Lx=function(s){return i?r.createElement(s):{}},Lx}var Fx,sA;function xL(){if(sA)return Fx;sA=1;var n=as(),e=Pn(),r=vL();return Fx=!n&&!e(function(){return Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a!==7}),Fx}var oA;function bL(){if(oA)return tx;oA=1;var n=as(),e=cs(),r=hZ(),i=J1(),s=hf(),o=yL(),a=Us(),c=xL(),l=Object.getOwnPropertyDescriptor;return tx.f=n?l:function(d,h){if(d=s(d),h=o(h),c)try{return l(d,h)}catch{}if(a(d,h))return i(!e(r.f,d,h),d[h])},tx}var zx={},$x,aA;function SL(){if(aA)return $x;aA=1;var n=as(),e=Pn();return $x=n&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),$x}var Bx,cA;function Fo(){if(cA)return Bx;cA=1;var n=ls(),e=String,r=TypeError;return Bx=function(i){if(n(i))return i;throw new r(e(i)+" is not an object")},Bx}var lA;function Ga(){if(lA)return zx;lA=1;var n=as(),e=xL(),r=SL(),i=Fo(),s=yL(),o=TypeError,a=Object.defineProperty,c=Object.getOwnPropertyDescriptor,l="enumerable",u="configurable",d="writable";return zx.f=n?r?function(p,g,y){if(i(p),g=s(g),i(y),typeof p=="function"&&g==="prototype"&&"value"in y&&d in y&&!y[d]){var v=c(p,g);v&&v[d]&&(p[g]=y.value,y={configurable:u in y?y[u]:v[u],enumerable:l in y?y[l]:v[l],writable:!1})}return a(p,g,y)}:a:function(p,g,y){if(i(p),g=s(g),i(y),e)try{return a(p,g,y)}catch{}if("get"in y||"set"in y)throw new o("Accessors not supported");return"value"in y&&(p[g]=y.value),p},zx}var Ux,uA;function s_(){if(uA)return Ux;uA=1;var n=as(),e=Ga(),r=J1();return Ux=n?function(i,s,o){return e.f(i,s,r(1,o))}:function(i,s,o){return i[s]=o,i},Ux}var qx={exports:{}},Hx,dA;function xZ(){if(dA)return Hx;dA=1;var n=as(),e=Us(),r=Function.prototype,i=n&&Object.getOwnPropertyDescriptor,s=e(r,"name"),o=s&&(function(){}).name==="something",a=s&&(!n||n&&i(r,"name").configurable);return Hx={EXISTS:s,PROPER:o,CONFIGURABLE:a},Hx}var Gx,hA;function wL(){if(hA)return Gx;hA=1;var n=Zt(),e=Mn(),r=r_(),i=n(Function.toString);return e(r.inspectSource)||(r.inspectSource=function(s){return i(s)}),Gx=r.inspectSource,Gx}var Kx,fA;function bZ(){if(fA)return Kx;fA=1;var n=Cn(),e=Mn(),r=n.WeakMap;return Kx=e(r)&&/native code/.test(String(r)),Kx}var Vx,pA;function _L(){if(pA)return Vx;pA=1;var n=i_(),e=mL(),r=n("keys");return Vx=function(i){return r[i]||(r[i]=e(i))},Vx}var Wx,gA;function o_(){return gA||(gA=1,Wx={}),Wx}var Yx,mA;function CL(){if(mA)return Yx;mA=1;var n=bZ(),e=Cn(),r=ls(),i=s_(),s=Us(),o=r_(),a=_L(),c=o_(),l="Object already initialized",u=e.TypeError,d=e.WeakMap,h,p,g,y=function(b){return g(b)?p(b):h(b,{})},v=function(b){return function(S){var w;if(!r(S)||(w=p(S)).type!==b)throw new u("Incompatible receiver, "+b+" required");return w}};if(n||o.state){var x=o.state||(o.state=new d);x.get=x.get,x.has=x.has,x.set=x.set,h=function(b,S){if(x.has(b))throw new u(l);return S.facade=b,x.set(b,S),S},p=function(b){return x.get(b)||{}},g=function(b){return x.has(b)}}else{var m=a("state");c[m]=!0,h=function(b,S){if(s(b,m))throw new u(l);return S.facade=b,i(b,m,S),S},p=function(b){return s(b,m)?b[m]:{}},g=function(b){return s(b,m)}}return Yx={set:h,get:p,has:g,enforce:y,getterFor:v},Yx}var yA;function SZ(){if(yA)return qx.exports;yA=1;var n=Zt(),e=Pn(),r=Mn(),i=Us(),s=as(),o=xZ().CONFIGURABLE,a=wL(),c=CL(),l=c.enforce,u=c.get,d=String,h=Object.defineProperty,p=n("".slice),g=n("".replace),y=n([].join),v=s&&!e(function(){return h(function(){},"length",{value:8}).length!==8}),x=String(String).split("String"),m=qx.exports=function(b,S,w){p(d(S),0,7)==="Symbol("&&(S="["+g(d(S),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),w&&w.getter&&(S="get "+S),w&&w.setter&&(S="set "+S),(!i(b,"name")||o&&b.name!==S)&&(s?h(b,"name",{value:S,configurable:!0}):b.name=S),v&&w&&i(w,"arity")&&b.length!==w.arity&&h(b,"length",{value:w.arity});try{w&&i(w,"constructor")&&w.constructor?s&&h(b,"prototype",{writable:!1}):b.prototype&&(b.prototype=void 0)}catch{}var I=l(b);return i(I,"source")||(I.source=y(x,typeof S=="string"?S:"")),b};return Function.prototype.toString=m(function(){return r(this)&&u(this).source||a(this)},"toString"),qx.exports}var Xx,vA;function PL(){if(vA)return Xx;vA=1;var n=Mn(),e=Ga(),r=SZ(),i=n_();return Xx=function(s,o,a,c){c||(c={});var l=c.enumerable,u=c.name!==void 0?c.name:o;if(n(a)&&r(a,u,c),c.global)l?s[o]=a:i(o,a);else{try{c.unsafe?s[o]&&(l=!0):delete s[o]}catch{}l?s[o]=a:e.f(s,o,{value:a,enumerable:!1,configurable:!c.nonConfigurable,writable:!c.nonWritable})}return s},Xx}var Zx={},Qx,xA;function wZ(){if(xA)return Qx;xA=1;var n=Math.ceil,e=Math.floor;return Qx=Math.trunc||function(i){var s=+i;return(s>0?e:n)(s)},Qx}var Jx,bA;function zo(){if(bA)return Jx;bA=1;var n=wZ();return Jx=function(e){var r=+e;return r!==r||r===0?0:n(r)},Jx}var eb,SA;function _Z(){if(SA)return eb;SA=1;var n=zo(),e=Math.max,r=Math.min;return eb=function(i,s){var o=n(i);return o<0?e(o+s,0):r(o,s)},eb}var tb,wA;function IL(){if(wA)return tb;wA=1;var n=zo(),e=Math.min;return tb=function(r){var i=n(r);return i>0?e(i,9007199254740991):0},tb}var nb,_A;function Ql(){if(_A)return nb;_A=1;var n=IL();return nb=function(e){return n(e.length)},nb}var rb,CA;function CZ(){if(CA)return rb;CA=1;var n=hf(),e=_Z(),r=Ql(),i=function(s){return function(o,a,c){var l=n(o),u=r(l);if(u===0)return!s&&-1;var d=e(c,u),h;if(s&&a!==a){for(;u>d;)if(h=l[d++],h!==h)return!0}else for(;u>d;d++)if((s||d in l)&&l[d]===a)return s||d||0;return!s&&-1}};return rb={includes:i(!0),indexOf:i(!1)},rb}var ib,PA;function EL(){if(PA)return ib;PA=1;var n=Zt(),e=Us(),r=hf(),i=CZ().indexOf,s=o_(),o=n([].push);return ib=function(a,c){var l=r(a),u=0,d=[],h;for(h in l)!e(s,h)&&e(l,h)&&o(d,h);for(;c.length>u;)e(l,h=c[u++])&&(~i(d,h)||o(d,h));return d},ib}var sb,IA;function a_(){return IA||(IA=1,sb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),sb}var EA;function PZ(){if(EA)return Zx;EA=1;var n=EL(),e=a_(),r=e.concat("length","prototype");return Zx.f=Object.getOwnPropertyNames||function(s){return n(s,r)},Zx}var ob={},kA;function IZ(){return kA||(kA=1,ob.f=Object.getOwnPropertySymbols),ob}var ab,TA;function EZ(){if(TA)return ab;TA=1;var n=ff(),e=Zt(),r=PZ(),i=IZ(),s=Fo(),o=e([].concat);return ab=n("Reflect","ownKeys")||function(c){var l=r.f(s(c)),u=i.f;return u?o(l,u(c)):l},ab}var cb,MA;function kZ(){if(MA)return cb;MA=1;var n=Us(),e=EZ(),r=bL(),i=Ga();return cb=function(s,o,a){for(var c=e(o),l=i.f,u=r.f,d=0;d<c.length;d++){var h=c[d];!n(s,h)&&!(a&&n(a,h))&&l(s,h,u(o,h))}},cb}var lb,AA;function TZ(){if(AA)return lb;AA=1;var n=Pn(),e=Mn(),r=/#|\.prototype\./,i=function(l,u){var d=o[s(l)];return d===c?!0:d===a?!1:e(u)?n(u):!!u},s=i.normalize=function(l){return String(l).replace(r,".").toLowerCase()},o=i.data={},a=i.NATIVE="N",c=i.POLYFILL="P";return lb=i,lb}var ub,jA;function Ka(){if(jA)return ub;jA=1;var n=Cn(),e=bL().f,r=s_(),i=PL(),s=n_(),o=kZ(),a=TZ();return ub=function(c,l){var u=c.target,d=c.global,h=c.stat,p,g,y,v,x,m;if(d?g=n:h?g=n[u]||s(u,{}):g=n[u]&&n[u].prototype,g)for(y in l){if(x=l[y],c.dontCallGetSet?(m=e(g,y),v=m&&m.value):v=g[y],p=a(d?y:u+(h?".":"#")+y,c.forced),!p&&v!==void 0){if(typeof x==typeof v)continue;o(x,v)}(c.sham||v&&v.sham)&&r(x,"sham",!0),i(g,y,x,c)}},ub}var db={},hb,RA;function MZ(){if(RA)return hb;RA=1;var n=EL(),e=a_();return hb=Object.keys||function(i){return n(i,e)},hb}var OA;function AZ(){if(OA)return db;OA=1;var n=as(),e=SL(),r=Ga(),i=Fo(),s=hf(),o=MZ();return db.f=n&&!e?Object.defineProperties:function(c,l){i(c);for(var u=s(l),d=o(l),h=d.length,p=0,g;h>p;)r.f(c,g=d[p++],u[g]);return c},db}var fb,DA;function jZ(){if(DA)return fb;DA=1;var n=ff();return fb=n("document","documentElement"),fb}var pb,NA;function kL(){if(NA)return pb;NA=1;var n=Fo(),e=AZ(),r=a_(),i=o_(),s=jZ(),o=vL(),a=_L(),c=">",l="<",u="prototype",d="script",h=a("IE_PROTO"),p=function(){},g=function(b){return l+d+c+b+l+"/"+d+c},y=function(b){b.write(g("")),b.close();var S=b.parentWindow.Object;return b=null,S},v=function(){var b=o("iframe"),S="java"+d+":",w;return b.style.display="none",s.appendChild(b),b.src=String(S),w=b.contentWindow.document,w.open(),w.write(g("document.F=Object")),w.close(),w.F},x,m=function(){try{x=new ActiveXObject("htmlfile")}catch{}m=typeof document<"u"?document.domain&&x?y(x):v():y(x);for(var b=r.length;b--;)delete m[u][r[b]];return m()};return i[h]=!0,pb=Object.create||function(S,w){var I;return S!==null?(p[u]=n(S),I=new p,p[u]=null,I[h]=S):I=m(),w===void 0?I:e.f(I,w)},pb}var gb,LA;function c_(){if(LA)return gb;LA=1;var n=us(),e=kL(),r=Ga().f,i=n("unscopables"),s=Array.prototype;return s[i]===void 0&&r(s,i,{configurable:!0,value:e(null)}),gb=function(o){s[i][o]=!0},gb}var FA;function RZ(){if(FA)return SM;FA=1;var n=Ka(),e=Zl(),r=Ql(),i=zo(),s=c_();return n({target:"Array",proto:!0},{at:function(a){var c=e(this),l=r(c),u=i(a),d=u>=0?u:l+u;return d<0||d>=l?void 0:c[d]}}),s("at"),SM}var mb,zA;function Jl(){if(zA)return mb;zA=1;var n=Cn(),e=Zt();return mb=function(r,i){return e(n[r].prototype[i])},mb}var yb,$A;function OZ(){if($A)return yb;$A=1,RZ();var n=Jl();return yb=n("Array","at"),yb}var vb,BA;function DZ(){if(BA)return vb;BA=1;var n=OZ();return vb=n,vb}DZ();var UA={},xb,qA;function TL(){if(qA)return xb;qA=1;var n=qa();return xb=Array.isArray||function(r){return n(r)==="Array"},xb}var bb,HA;function NZ(){if(HA)return bb;HA=1;var n=TypeError,e=9007199254740991;return bb=function(r){if(r>e)throw n("Maximum allowed index exceeded");return r},bb}var Sb,GA;function LZ(){if(GA)return Sb;GA=1;var n=qa(),e=Zt();return Sb=function(r){if(n(r)==="Function")return e(r)},Sb}var wb,KA;function FZ(){if(KA)return wb;KA=1;var n=LZ(),e=e_(),r=df(),i=n(n.bind);return wb=function(s,o){return e(s),o===void 0?s:r?i(s,o):function(){return s.apply(o,arguments)}},wb}var _b,VA;function zZ(){if(VA)return _b;VA=1;var n=as(),e=Ga(),r=J1();return _b=function(i,s,o){n?e.f(i,s,r(0,o)):i[s]=o},_b}var Cb,WA;function ML(){if(WA)return Cb;WA=1;var n=TL(),e=Ql(),r=NZ(),i=FZ(),s=zZ(),o=function(a,c,l,u,d,h,p,g){for(var y=d,v=0,x=p?i(p,g):!1,m,b;v<u;)v in l&&(m=x?x(l[v],v,c):l[v],h>0&&n(m)?(b=e(m),y=o(a,c,m,b,y,h-1)-1):(r(y+1),s(a,y,m)),y++),v++;return y};return Cb=o,Cb}var Pb,YA;function $Z(){if(YA)return Pb;YA=1;var n=us(),e=n("toStringTag"),r={};return r[e]="z",Pb=String(r)==="[object z]",Pb}var Ib,XA;function AL(){if(XA)return Ib;XA=1;var n=$Z(),e=Mn(),r=qa(),i=us(),s=i("toStringTag"),o=Object,a=r((function(){return arguments})())==="Arguments",c=function(l,u){try{return l[u]}catch{}};return Ib=n?r:function(l){var u,d,h;return l===void 0?"Undefined":l===null?"Null":typeof(d=c(u=o(l),s))=="string"?d:a?r(u):(h=r(u))==="Object"&&e(u.callee)?"Arguments":h},Ib}var Eb,ZA;function BZ(){if(ZA)return Eb;ZA=1;var n=Zt(),e=Pn(),r=Mn(),i=AL(),s=ff(),o=wL(),a=function(){},c=s("Reflect","construct"),l=/^\s*(?:class|function)\b/,u=n(l.exec),d=!l.test(a),h=function(y){if(!r(y))return!1;try{return c(a,[],y),!0}catch{return!1}},p=function(y){if(!r(y))return!1;switch(i(y)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!u(l,o(y))}catch{return!0}};return p.sham=!0,Eb=!c||e(function(){var g;return h(h.call)||!h(Object)||!h(function(){g=!0})||g})?p:h,Eb}var kb,QA;function UZ(){if(QA)return kb;QA=1;var n=TL(),e=BZ(),r=ls(),i=us(),s=i("species"),o=Array;return kb=function(a){var c;return n(a)&&(c=a.constructor,e(c)&&(c===o||n(c.prototype))?c=void 0:r(c)&&(c=c[s],c===null&&(c=void 0))),c===void 0?o:c},kb}var Tb,JA;function jL(){if(JA)return Tb;JA=1;var n=UZ();return Tb=function(e,r){return new(n(e))(r===0?0:r)},Tb}var ej;function qZ(){if(ej)return UA;ej=1;var n=Ka(),e=ML(),r=e_(),i=Zl(),s=Ql(),o=jL();return n({target:"Array",proto:!0},{flatMap:function(c){var l=i(this),u=s(l),d;return r(c),d=o(l,0),e(d,l,l,u,0,1,c,arguments.length>1?arguments[1]:void 0),d}}),UA}var tj={},nj;function HZ(){if(nj)return tj;nj=1;var n=c_();return n("flatMap"),tj}var Mb,rj;function GZ(){if(rj)return Mb;rj=1,qZ(),HZ();var n=Jl();return Mb=n("Array","flatMap"),Mb}var Ab,ij;function KZ(){if(ij)return Ab;ij=1;var n=GZ();return Ab=n,Ab}KZ();var sj={},oj;function VZ(){if(oj)return sj;oj=1;var n=Ka(),e=ML(),r=Zl(),i=Ql(),s=zo(),o=jL();return n({target:"Array",proto:!0},{flat:function(){var c=arguments.length?arguments[0]:void 0,l=r(this),u=i(l),d=o(l,0);return e(d,l,l,u,0,c===void 0?1:s(c)),d}}),sj}var aj={},cj;function WZ(){if(cj)return aj;cj=1;var n=c_();return n("flat"),aj}var jb,lj;function YZ(){if(lj)return jb;lj=1,VZ(),WZ();var n=Jl();return jb=n("Array","flat"),jb}var Rb,uj;function XZ(){if(uj)return Rb;uj=1;var n=YZ();return Rb=n,Rb}XZ();var dj={},Ob,hj;function eu(){if(hj)return Ob;hj=1;var n=AL(),e=String;return Ob=function(r){if(n(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(r)},Ob}var fj;function ZZ(){if(fj)return dj;fj=1;var n=Ka(),e=Zt(),r=Ha(),i=zo(),s=eu(),o=Pn(),a=e("".charAt),c=o(function(){return"".at(-2)!=="\uD842"});return n({target:"String",proto:!0,forced:c},{at:function(u){var d=s(r(this)),h=d.length,p=i(u),g=p>=0?p:h+p;return g<0||g>=h?void 0:a(d,g)}}),dj}var Db,pj;function QZ(){if(pj)return Db;pj=1,ZZ();var n=Jl();return Db=n("String","at"),Db}var Nb,gj;function JZ(){if(gj)return Nb;gj=1;var n=QZ();return Nb=n,Nb}JZ();var mj={},Lb,yj;function RL(){if(yj)return Lb;yj=1;var n=Fo();return Lb=function(){var e=n(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},Lb}var Fb,vj;function eQ(){if(vj)return Fb;vj=1;var n=Pn(),e=Cn(),r=e.RegExp,i=n(function(){var a=r("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),s=i||n(function(){return!r("a","y").sticky}),o=i||n(function(){var a=r("^r","gy");return a.lastIndex=2,a.exec("str")!==null});return Fb={BROKEN_CARET:o,MISSED_STICKY:s,UNSUPPORTED_Y:i},Fb}var zb,xj;function tQ(){if(xj)return zb;xj=1;var n=Pn(),e=Cn(),r=e.RegExp;return zb=n(function(){var i=r(".","s");return!(i.dotAll&&i.test(`
`)&&i.flags==="s")}),zb}var $b,bj;function nQ(){if(bj)return $b;bj=1;var n=Pn(),e=Cn(),r=e.RegExp;return $b=n(function(){var i=r("(?<a>b)","g");return i.exec("b").groups.a!=="b"||"b".replace(i,"$<a>c")!=="bc"}),$b}var Bb,Sj;function l_(){if(Sj)return Bb;Sj=1;var n=cs(),e=Zt(),r=eu(),i=RL(),s=eQ(),o=i_(),a=kL(),c=CL().get,l=tQ(),u=nQ(),d=o("native-string-replace",String.prototype.replace),h=RegExp.prototype.exec,p=h,g=e("".charAt),y=e("".indexOf),v=e("".replace),x=e("".slice),m=(function(){var I=/a/,C=/b*/g;return n(h,I,"a"),n(h,C,"a"),I.lastIndex!==0||C.lastIndex!==0})(),b=s.BROKEN_CARET,S=/()??/.exec("")[1]!==void 0,w=m||S||b||l||u;return w&&(p=function(C){var _=this,P=c(_),M=r(C),T=P.raw,A,R,O,j,D,N,F;if(T)return T.lastIndex=_.lastIndex,A=n(p,T,M),_.lastIndex=T.lastIndex,A;var z=P.groups,$=b&&_.sticky,G=n(i,_),X=_.source,ee=0,re=M;if($&&(G=v(G,"y",""),y(G,"g")===-1&&(G+="g"),re=x(M,_.lastIndex),_.lastIndex>0&&(!_.multiline||_.multiline&&g(M,_.lastIndex-1)!==`
`)&&(X="(?: "+X+")",re=" "+re,ee++),R=new RegExp("^(?:"+X+")",G)),S&&(R=new RegExp("^"+X+"$(?!\\s)",G)),m&&(O=_.lastIndex),j=n(h,$?R:_,re),$?j?(j.input=x(j.input,ee),j[0]=x(j[0],ee),j.index=_.lastIndex,_.lastIndex+=j[0].length):_.lastIndex=0:m&&j&&(_.lastIndex=_.global?j.index+j[0].length:O),S&&j&&j.length>1&&n(d,j[0],R,function(){for(D=1;D<arguments.length-2;D++)arguments[D]===void 0&&(j[D]=void 0)}),j&&z)for(j.groups=N=a(null),D=0;D<z.length;D++)F=z[D],N[F[0]]=j[F[1]];return j}),Bb=p,Bb}var wj;function OL(){if(wj)return mj;wj=1;var n=Ka(),e=l_();return n({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),mj}var _j={},Ub,Cj;function rQ(){if(Cj)return Ub;Cj=1;var n=df(),e=Function.prototype,r=e.apply,i=e.call;return Ub=typeof Reflect=="object"&&Reflect.apply||(n?i.bind(r):function(){return i.apply(r,arguments)}),Ub}var qb,Pj;function iQ(){if(Pj)return qb;Pj=1,OL();var n=cs(),e=PL(),r=l_(),i=Pn(),s=us(),o=s_(),a=s("species"),c=RegExp.prototype;return qb=function(l,u,d,h){var p=s(l),g=!i(function(){var m={};return m[p]=function(){return 7},""[l](m)!==7}),y=g&&!i(function(){var m=!1,b=/a/;if(l==="split"){var S={};S[a]=function(){return b},b={constructor:S,flags:""},b[p]=/./[p]}return b.exec=function(){return m=!0,null},b[p](""),!m});if(!g||!y||d){var v=/./[p],x=u(p,""[l],function(m,b,S,w,I){var C=b.exec;return C===r||C===c.exec?g&&!I?{done:!0,value:n(v,b,S,w)}:{done:!0,value:n(m,S,b,w)}:{done:!1}});e(String.prototype,l,x[0]),e(c,p,x[1])}h&&o(c[p],"sham",!0)},qb}var Hb,Ij;function sQ(){if(Ij)return Hb;Ij=1;var n=Zt(),e=zo(),r=eu(),i=Ha(),s=n("".charAt),o=n("".charCodeAt),a=n("".slice),c=function(l){return function(u,d){var h=r(i(u)),p=e(d),g=h.length,y,v;return p<0||p>=g?l?"":void 0:(y=o(h,p),y<55296||y>56319||p+1===g||(v=o(h,p+1))<56320||v>57343?l?s(h,p):y:l?a(h,p,p+2):(y-55296<<10)+(v-56320)+65536)}};return Hb={codeAt:c(!1),charAt:c(!0)},Hb}var Gb,Ej;function oQ(){if(Ej)return Gb;Ej=1;var n=sQ().charAt;return Gb=function(e,r,i){return r+(i?n(e,r).length:1)},Gb}var Kb,kj;function DL(){if(kj)return Kb;kj=1;var n=Zt(),e=Zl(),r=Math.floor,i=n("".charAt),s=n("".replace),o=n("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,c=/\$([$&'`]|\d{1,2})/g;return Kb=function(l,u,d,h,p,g){var y=d+l.length,v=h.length,x=c;return p!==void 0&&(p=e(p),x=a),s(g,x,function(m,b){var S;switch(i(b,0)){case"$":return"$";case"&":return l;case"`":return o(u,0,d);case"'":return o(u,y);case"<":S=p[o(b,1,-1)];break;default:var w=+b;if(w===0)return m;if(w>v){var I=r(w/10);return I===0?m:I<=v?h[I-1]===void 0?i(b,1):h[I-1]+i(b,1):m}S=h[w-1]}return S===void 0?"":S})},Kb}var Vb,Tj;function aQ(){if(Tj)return Vb;Tj=1;var n=Cn(),e=Pn(),r=n.RegExp,i=!e(function(){var s=!0;try{r(".","d")}catch{s=!1}var o={},a="",c=s?"dgimsy":"gimsy",l=function(p,g){Object.defineProperty(o,p,{get:function(){return a+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};s&&(u.hasIndices="d");for(var d in u)l(d,u[d]);var h=Object.getOwnPropertyDescriptor(r.prototype,"flags").get.call(o);return h!==c||a!==c});return Vb={correct:i},Vb}var Wb,Mj;function NL(){if(Mj)return Wb;Mj=1;var n=cs(),e=Us(),r=dL(),i=aQ(),s=RL(),o=RegExp.prototype;return Wb=i.correct?function(a){return a.flags}:function(a){return!i.correct&&r(o,a)&&!e(a,"flags")?n(s,a):a.flags},Wb}var Yb,Aj;function cQ(){if(Aj)return Yb;Aj=1;var n=cs(),e=Fo(),r=Mn(),i=qa(),s=l_(),o=TypeError;return Yb=function(a,c){var l=a.exec;if(r(l)){var u=n(l,a,c);return u!==null&&e(u),u}if(i(a)==="RegExp")return n(s,a,c);throw new o("RegExp#exec called on incompatible receiver")},Yb}var jj;function lQ(){if(jj)return _j;jj=1;var n=rQ(),e=cs(),r=Zt(),i=iQ(),s=Pn(),o=Fo(),a=Mn(),c=ls(),l=zo(),u=IL(),d=eu(),h=Ha(),p=oQ(),g=t_(),y=DL(),v=NL(),x=cQ(),m=us(),b=m("replace"),S=Math.max,w=Math.min,I=r([].concat),C=r([].push),_=r("".indexOf),P=r("".slice),M=function(O){return O===void 0?O:String(O)},T=(function(){return"a".replace(/./,"$0")==="$0"})(),A=(function(){return/./[b]?/./[b]("a","$0")==="":!1})(),R=!s(function(){var O=/./;return O.exec=function(){var j=[];return j.groups={a:"7"},j},"".replace(O,"$<a>")!=="7"});return i("replace",function(O,j,D){var N=A?"$":"$0";return[function(z,$){var G=h(this),X=c(z)?g(z,b):void 0;return X?e(X,z,G,$):e(j,d(G),z,$)},function(F,z){var $=o(this),G=d(F);if(typeof z=="string"&&_(z,N)===-1&&_(z,"$<")===-1){var X=D(j,$,G,z);if(X.done)return X.value}var ee=a(z);ee||(z=d(z));var re=d(v($)),B=_(re,"g")!==-1,U;B&&(U=_(re,"u")!==-1,$.lastIndex=0);for(var Q=[],K;K=x($,G),!(K===null||(C(Q,K),!B));){var Y=d(K[0]);Y===""&&($.lastIndex=p(G,u($.lastIndex),U))}for(var V="",ie=0,ae=0;ae<Q.length;ae++){K=Q[ae];for(var ye=d(K[0]),he=S(w(l(K.index),G.length),0),xe=[],fe,me=1;me<K.length;me++)C(xe,M(K[me]));var we=K.groups;if(ee){var st=I([ye],xe,he,G);we!==void 0&&C(st,we),fe=d(n(z,void 0,st))}else fe=y(ye,G,he,xe,we,z);he>=ie&&(V+=P(G,ie,he)+fe,ie=he+ye.length)}return V+P(G,ie)}]},!R||!T||A),_j}var Rj={},Xb,Oj;function uQ(){if(Oj)return Xb;Oj=1;var n=ls(),e=qa(),r=us(),i=r("match");return Xb=function(s){var o;return n(s)&&((o=s[i])!==void 0?!!o:e(s)==="RegExp")},Xb}var Dj;function dQ(){if(Dj)return Rj;Dj=1;var n=Ka(),e=cs(),r=Zt(),i=Ha(),s=Mn(),o=ls(),a=uQ(),c=eu(),l=t_(),u=NL(),d=DL(),h=us(),p=gL(),g=h("replace"),y=TypeError,v=r("".indexOf),x=r("".replace),m=r("".slice),b=Math.max;return n({target:"String",proto:!0},{replaceAll:function(w,I){var C=i(this),_,P,M,T,A,R,O,j,D,N,F=0,z="";if(o(w)){if(_=a(w),_&&(P=c(i(u(w))),!~v(P,"g")))throw new y("`.replaceAll` does not allow non-global regexes");if(M=l(w,g),M)return e(M,w,C,I);if(p&&_)return x(c(C),w,I)}for(T=c(C),A=c(w),R=s(I),R||(I=c(I)),O=A.length,j=b(1,O),D=v(T,A);D!==-1;)N=R?c(I(A,D,T)):d(A,T,D,[],void 0,I),z+=m(T,F,D)+N,F=D+O,D=D+j>T.length?-1:v(T,A,D+j);return F<T.length&&(z+=m(T,F)),z}}),Rj}var Zb,Nj;function hQ(){if(Nj)return Zb;Nj=1,OL(),lQ(),dQ();var n=Jl();return Zb=n("String","replaceAll"),Zb}var Qb,Lj;function fQ(){if(Lj)return Qb;Lj=1;var n=hQ();return Qb=n,Qb}fQ();function LL(n){return n&&typeof n=="object"&&"parents"in n}function FL(n){for(let e=0,r=n.parents.length;e<r;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const Gd=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&LL(n))for(let r=0,i=n.parents.length;r<i;r++)Gd(n.parents[r],n)},u_=(n,e)=>{if(n.children.add(e)&&LL(n))for(let r=0,i=n.parents.length;r<i;r++)u_(n.parents[r],n)};function zL(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function qs(n,e){const r=Symbol.for(`com.tldraw.state/${n}`),i=globalThis;return i[r]??=e(),i[r]}const Yi=qs("empty_array",()=>Object.freeze([])),Fj=8;class Kd{arraySize=0;array=Array(Fj);set=null;get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<Fj?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const r=this.array.indexOf(e);return r===-1?!1:(this.array[r]=void 0,this.arraySize--,r!==this.arraySize&&(this.array[r]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let r=0;r<this.arraySize;r++){const i=this.array[r];typeof i<"u"&&e(i)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const sr=Symbol.for("com.tldraw.state/RESET_VALUE");class $L{constructor(e){this.capacity=e,this.buffer=new Array(e)}index=0;buffer;pushEntry(e,r,i){if(i!==void 0){if(i===sr){this.clear();return}this.buffer[this.index]=[e,r,i],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:r,capacity:i,buffer:s}=this;for(let o=0;o<i;o++){const a=(r-1+i-o)%i,c=s[a];if(!c)return sr;const[l,u]=c;if(o===0&&e>=u)return[];if(l<=e&&e<u){const d=o+1,h=new Array(d);for(let p=0;p<d;p++)h[p]=s[(a+p)%i][2];return h}}return sr}}class pQ{constructor(e,r){this.below=e,this.child=r}offset=0;maybeRemoved}const xt=qs("capture",()=>({stack:null}));function zu(n){const e=xt.stack;xt.stack=null;try{return n()}finally{xt.stack=e}}function BL(n){xt.stack=new pQ(xt.stack,n),n.parentSet.clear()}function UL(){const n=xt.stack;if(xt.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const r=n.child.parents[e];n.child.parentSet.has(r)||Gd(r,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const r=n.maybeRemoved[e];n.child.parentSet.has(r)||Gd(r,n.child)}}function Vd(n){if(xt.stack){if(xt.stack.child.parentSet.has(n))return;if(xt.stack.child.parentSet.add(n),xt.stack.child.isActivelyListening&&u_(n,xt.stack.child),xt.stack.offset<xt.stack.child.parents.length){const r=xt.stack.child.parents[xt.stack.offset];r!==n&&(xt.stack.maybeRemoved?xt.stack.maybeRemoved.push(r):xt.stack.maybeRemoved=[r])}xt.stack.child.parents[xt.stack.offset]=n,xt.stack.child.parentEpochs[xt.stack.offset]=n.lastChangedEpoch,xt.stack.offset++}}const Es=-1;class gQ{constructor(e,r,i){this.name=e,this.runEffect=r,this._scheduleEffect=i?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=Es;lastReactedEpoch=Es;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentSet=new Kd;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Fn()){if(this.parents.length&&!FL(this)){this.lastReactedEpoch=Fn();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,r=this.parents.length;e<r;e++)u_(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,r=this.parents.length;e<r;e++)Gd(this.parents[e],this)}execute(){try{BL(this);const e=Fn(),r=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,r}finally{UL()}}}const Va=qs("EffectScheduler",()=>gQ);function $o(n,e,r){const i=new Va(n,e,r);return i.attach(),i.scheduleEffect(),()=>{i.detach()}}function mQ(n,e,r){const i=new Va(n,e,r);return{scheduler:i,start:s=>{const o=s?.force??!1;i.attach(),o?i.scheduleEffect():i.maybeScheduleEffect()},stop:()=>{i.detach()}}}class yQ{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return this.parent===null}commit(){this.isRoot?qL(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,r)=>{this.parent.initialAtomValues.has(r)||this.parent.initialAtomValues.set(r,e)})}abort(){ht.globalEpoch++,this.initialAtomValues.forEach((e,r)=>{r.set(e),r.historyBuffer?.clear()}),this.commit()}}const ht=qs("transactions",()=>({globalEpoch:Es+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:Es+1}));function vQ(){return ht.reactionEpoch}function Fn(){return ht.globalEpoch}function xQ(){return ht.globalIsReacting}function d_(n,e){e.lastTraversedEpoch!==ht.globalEpoch&&(e.lastTraversedEpoch=ht.globalEpoch,e instanceof Va?n.add(e):e.children.visit(r=>d_(n,r)))}function qL(n){if(ht.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{ht.globalIsReacting=!0,ht.reactionEpoch=ht.globalEpoch;const e=new Set;for(const i of n)i.children.visit(s=>d_(e,s));for(const i of e)i.maybeScheduleEffect();let r=0;for(;ht.cleanupReactors?.size;){if(r++>1e3)throw new Error("Reaction update depth limit exceeded");const i=ht.cleanupReactors;ht.cleanupReactors=null;for(const s of i)s.maybeScheduleEffect()}}finally{ht.cleanupReactors=null,ht.globalIsReacting=!1}}function bQ(n,e){if(ht.globalIsReacting){const r=ht.cleanupReactors??=new Set;n.children.visit(i=>d_(r,i))}else ht.currentTransaction?ht.currentTransaction.initialAtomValues.has(n)||ht.currentTransaction.initialAtomValues.set(n,e):qL([n])}function SQ(){ht.globalEpoch++}function wQ(n){const e=new yQ(ht.currentTransaction);ht.currentTransaction=e;try{let r,i=!1;try{r=n(()=>i=!0)}catch(s){throw e.abort(),s}return i?e.abort():e.commit(),r}finally{ht.currentTransaction=ht.currentTransaction.parent}}function mi(n){return ht.currentTransaction?n():wQ(n)}class _Q{constructor(e,r,i){this.name=e,this.current=r,this.isEqual=i?.isEqual??null,i&&(i.historyLength&&(this.historyBuffer=new $L(i.historyLength)),this.computeDiff=i.computeDiff)}isEqual;computeDiff;lastChangedEpoch=Fn();children=new Kd;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return Vd(this),this.current}set(e,r){if(this.isEqual?.(this.current,e)??zL(this.current,e))return this.current;SQ(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Fn(),r??this.computeDiff?.(this.current,e,this.lastChangedEpoch,Fn())??sr),this.lastChangedEpoch=Fn();const i=this.current;return this.current=e,bQ(this,i),e}update(e){return this.set(e(this.current))}getDiffSince(e){return Vd(this),e>=this.lastChangedEpoch?Yi:this.historyBuffer?.getChangesSince(e)??sr}}const CQ=qs("Atom",()=>_Q);function Vt(n,e,r){return new CQ(n,e,r)}let zj=!1;function PQ(){zj||(zj=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Lc=Symbol.for("com.tldraw.state/UNINITIALIZED"),go=n=>n===Lc,lw=qs("WithDiff",()=>class{constructor(e,r){this.value=e,this.diff=r}});function Fc(n,e){return new lw(n,e)}class IQ{constructor(e,r,i){this.name=e,this.derive=r,i?.historyLength&&(this.historyBuffer=new $L(i.historyLength)),this.computeDiff=i?.computeDiff,this.isEqual=i?.isEqual??zL}lastChangedEpoch=Es;lastTraversedEpoch=Es;lastCheckedEpoch=Es;parentSet=new Kd;parents=[];parentEpochs=[];children=new Kd;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=Lc;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){const r=this.lastChangedEpoch===Es,i=Fn();if(!r&&(this.lastCheckedEpoch===i||this.isActivelyListening&&xQ()&&this.lastTraversedEpoch<vQ()||!FL(this)))if(this.lastCheckedEpoch=i,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{BL(this);const s=this.derive(this.state,this.lastCheckedEpoch),o=s instanceof lw?s.value:s,a=this.state===Lc;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const c=s instanceof lw?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Fn(),c??this.computeDiff?.(this.state,o,this.lastCheckedEpoch,Fn())??sr)}this.lastChangedEpoch=Fn(),this.state=o}return this.error=null,this.lastCheckedEpoch=Fn(),this.state}catch(s){if(this.state!==Lc&&(this.state=Lc,this.lastChangedEpoch=Fn()),this.lastCheckedEpoch=Fn(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{UL()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Vd(this)}}getDiffSince(e){return this.__unsafe__getWithoutCapture(!0),Vd(this),e>=this.lastChangedEpoch?Yi:this.historyBuffer?.getChangesSince(e)??sr}}const h_=qs("Computed",()=>IQ);function EQ(n={},e,r,i){const s=i.value,o=Symbol.for("__@tldraw/state__computed__"+r);return i.value=function(){let a=this[o];return a||(a=new h_(r,s.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:a})),a.get()},i.value[TQ]=!0,i}function $j(n={},e,r,i){return i.get?(PQ(),kQ(n,e,r,i)):EQ(n,e,r,i)}function kQ(n={},e,r,i){const s=i.get,o=Symbol.for("__@tldraw/state__computed__"+r);return i.get=function(){let a=this[o];return a||(a=new h_(r,s.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:a})),a.get()},i}const TQ="@@__isComputedMethod__@@";function oe(){if(arguments.length===1){const n=arguments[0];return(e,r,i)=>$j(n,e,r,i)}else return typeof arguments[0]=="string"?new h_(arguments[0],arguments[1],arguments[2]):$j(void 0,arguments[0],arguments[1],arguments[2])}const HL=1,MQ=qs("apiVersion",()=>HL);if(MQ!==HL)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var Jb,Bj;function AQ(){if(Bj)return Jb;Bj=1;var n="Expected a function",e=NaN,r="[object Symbol]",i=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,c=parseInt,l=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt,u=typeof self=="object"&&self&&self.Object===Object&&self,d=l||u||Function("return this")(),h=Object.prototype,p=h.toString,g=Math.max,y=Math.min,v=function(){return d.Date.now()};function x(C,_,P){var M,T,A,R,O,j,D=0,N=!1,F=!1,z=!0;if(typeof C!="function")throw new TypeError(n);_=I(_)||0,b(P)&&(N=!!P.leading,F="maxWait"in P,A=F?g(I(P.maxWait)||0,_):A,z="trailing"in P?!!P.trailing:z);function $(Y){var V=M,ie=T;return M=T=void 0,D=Y,R=C.apply(ie,V),R}function G(Y){return D=Y,O=setTimeout(re,_),N?$(Y):R}function X(Y){var V=Y-j,ie=Y-D,ae=_-V;return F?y(ae,A-ie):ae}function ee(Y){var V=Y-j,ie=Y-D;return j===void 0||V>=_||V<0||F&&ie>=A}function re(){var Y=v();if(ee(Y))return B(Y);O=setTimeout(re,X(Y))}function B(Y){return O=void 0,z&&M?$(Y):(M=T=void 0,R)}function U(){O!==void 0&&clearTimeout(O),D=0,M=j=T=O=void 0}function Q(){return O===void 0?R:B(v())}function K(){var Y=v(),V=ee(Y);if(M=arguments,T=this,j=Y,V){if(O===void 0)return G(j);if(F)return O=setTimeout(re,_),$(j)}return O===void 0&&(O=setTimeout(re,_)),R}return K.cancel=U,K.flush=Q,K}function m(C,_,P){var M=!0,T=!0;if(typeof C!="function")throw new TypeError(n);return b(P)&&(M="leading"in P?!!P.leading:M,T="trailing"in P?!!P.trailing:T),x(C,_,{leading:M,maxWait:_,trailing:T})}function b(C){var _=typeof C;return!!C&&(_=="object"||_=="function")}function S(C){return!!C&&typeof C=="object"}function w(C){return typeof C=="symbol"||S(C)&&p.call(C)==r}function I(C){if(typeof C=="number")return C;if(w(C))return e;if(b(C)){var _=typeof C.valueOf=="function"?C.valueOf():C;C=b(_)?_+"":_}if(typeof C!="string")return C===0?C:+C;C=C.replace(i,"");var P=o.test(C);return P||a.test(C)?c(C.slice(2),P?2:8):s.test(C)?e:+C}return Jb=m,Jb}var jQ=AQ();const GL=rs(jQ);var eS,Uj;function RQ(){if(Uj)return eS;Uj=1;var n=200,e="__lodash_hash_undefined__",r=1/0,i="[object Function]",s="[object GeneratorFunction]",o=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,c=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")();function d(J,le){var ge=J?J.length:0;return!!ge&&p(J,le,0)>-1}function h(J,le,ge,Le){for(var Re=J.length,hn=ge+-1;++hn<Re;)if(le(J[hn],hn,J))return hn;return-1}function p(J,le,ge){if(le!==le)return h(J,g,ge);for(var Le=ge-1,Re=J.length;++Le<Re;)if(J[Le]===le)return Le;return-1}function g(J){return J!==J}function y(J,le){return J.has(le)}function v(J,le){return J?.[le]}function x(J){var le=!1;if(J!=null&&typeof J.toString!="function")try{le=!!(J+"")}catch{}return le}function m(J){var le=-1,ge=Array(J.size);return J.forEach(function(Le){ge[++le]=Le}),ge}var b=Array.prototype,S=Function.prototype,w=Object.prototype,I=u["__core-js_shared__"],C=(function(){var J=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||"");return J?"Symbol(src)_1."+J:""})(),_=S.toString,P=w.hasOwnProperty,M=w.toString,T=RegExp("^"+_.call(P).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=b.splice,R=Bt(u,"Map"),O=Bt(u,"Set"),j=Bt(Object,"create");function D(J){var le=-1,ge=J?J.length:0;for(this.clear();++le<ge;){var Le=J[le];this.set(Le[0],Le[1])}}function N(){this.__data__=j?j(null):{}}function F(J){return this.has(J)&&delete this.__data__[J]}function z(J){var le=this.__data__;if(j){var ge=le[J];return ge===e?void 0:ge}return P.call(le,J)?le[J]:void 0}function $(J){var le=this.__data__;return j?le[J]!==void 0:P.call(le,J)}function G(J,le){var ge=this.__data__;return ge[J]=j&&le===void 0?e:le,this}D.prototype.clear=N,D.prototype.delete=F,D.prototype.get=z,D.prototype.has=$,D.prototype.set=G;function X(J){var le=-1,ge=J?J.length:0;for(this.clear();++le<ge;){var Le=J[le];this.set(Le[0],Le[1])}}function ee(){this.__data__=[]}function re(J){var le=this.__data__,ge=me(le,J);if(ge<0)return!1;var Le=le.length-1;return ge==Le?le.pop():A.call(le,ge,1),!0}function B(J){var le=this.__data__,ge=me(le,J);return ge<0?void 0:le[ge][1]}function U(J){return me(this.__data__,J)>-1}function Q(J,le){var ge=this.__data__,Le=me(ge,J);return Le<0?ge.push([J,le]):ge[Le][1]=le,this}X.prototype.clear=ee,X.prototype.delete=re,X.prototype.get=B,X.prototype.has=U,X.prototype.set=Q;function K(J){var le=-1,ge=J?J.length:0;for(this.clear();++le<ge;){var Le=J[le];this.set(Le[0],Le[1])}}function Y(){this.__data__={hash:new D,map:new(R||X),string:new D}}function V(J){return Ut(this,J).delete(J)}function ie(J){return Ut(this,J).get(J)}function ae(J){return Ut(this,J).has(J)}function ye(J,le){return Ut(this,J).set(J,le),this}K.prototype.clear=Y,K.prototype.delete=V,K.prototype.get=ie,K.prototype.has=ae,K.prototype.set=ye;function he(J){var le=-1,ge=J?J.length:0;for(this.__data__=new K;++le<ge;)this.add(J[le])}function xe(J){return this.__data__.set(J,e),this}function fe(J){return this.__data__.has(J)}he.prototype.add=he.prototype.push=xe,he.prototype.has=fe;function me(J,le){for(var ge=J.length;ge--;)if(ke(J[ge][0],le))return ge;return-1}function we(J){if(!ut(J)||ve(J))return!1;var le=Ne(J)||x(J)?T:a;return le.test(Se(J))}function st(J,le,ge){var Le=-1,Re=d,hn=J.length,Xs=!0,Nr=[],Lr=Nr;if(hn>=n){var pr=lt(J);if(pr)return m(pr);Xs=!1,Re=y,Lr=new he}else Lr=Nr;e:for(;++Le<hn;){var Fr=J[Le],Mi=Fr;if(Fr=Fr!==0?Fr:0,Xs&&Mi===Mi){for(var qo=Lr.length;qo--;)if(Lr[qo]===Mi)continue e;Nr.push(Fr)}else Re(Lr,Mi,ge)||(Lr!==Nr&&Lr.push(Mi),Nr.push(Fr))}return Nr}var lt=O&&1/m(new O([,-0]))[1]==r?function(J){return new O(J)}:Xe;function Ut(J,le){var ge=J.__data__;return se(le)?ge[typeof le=="string"?"string":"hash"]:ge.map}function Bt(J,le){var ge=v(J,le);return we(ge)?ge:void 0}function se(J){var le=typeof J;return le=="string"||le=="number"||le=="symbol"||le=="boolean"?J!=="__proto__":J===null}function ve(J){return!!C&&C in J}function Se(J){if(J!=null){try{return _.call(J)}catch{}try{return J+""}catch{}}return""}function Ke(J){return J&&J.length?st(J):[]}function ke(J,le){return J===le||J!==J&&le!==le}function Ne(J){var le=ut(J)?M.call(J):"";return le==i||le==s}function ut(J){var le=typeof J;return!!J&&(le=="object"||le=="function")}function Xe(){}return eS=Ke,eS}var OQ=RQ();const DQ=rs(OQ),zc={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},NQ=zc.Good;class KL{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,r=e===0?0:Math.floor(this.frames/e),i=r>55?zc.Good:r>30?zc.Mid:zc.Poor,s=i===zc.Mid?"black":"white",o=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${o} %c${r}%c fps`,`color: white; background: ${NQ};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${i};color: ${s};`,"font-weight: normal")}isStarted(){return this.started}}function f_(n,e){const r=[];e:for(const i of n){for(const s of r)if(e?e(i,s):i===s)continue e;r.push(i)}return r}function Be(n){return n.filter(e=>e!=null)}function rn(n){return n[n.length-1]}function LQ(n,e){let r,i=1/0;for(const s of n){const o=e(s);o<i&&(r=s,i=o)}return r}function FQ(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Object.is(n[r],e[r]))return!1;return!0}class es{items=new WeakMap;get(e,r){return this.items.has(e)||this.items.set(e,r(e)),this.items.get(e)}}function VL(n){const e=(...r)=>{try{return n(...r)}catch(i){throw i instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(i,e),i}};return e}const Sl=()=>{},js={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function wn(n,e){const r=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${r}`)}const gt=VL((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),Pr=VL((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function WL(n,e){let r;const i=(...s)=>(r||(r={},r.promise=new Promise((o,a)=>{r.resolve=o,r.reject=a})),clearTimeout(r.timeout),r.latestArgs=s,r.timeout=setTimeout(()=>{const o=r;r=void 0;try{o.resolve(n(...o.latestArgs))}catch(a){o.reject(a)}},e),r.promise);return i.cancel=()=>{r&&clearTimeout(r.timeout)},i}const qj=new WeakMap;function p_(n,e){if(typeof n!="object"||n===null)return;let r=qj.get(n);r||(r={tags:{},extras:{}},qj.set(n,r)),e.tags&&(r.tags={...r.tags,...e.tags}),e.extras&&(r.extras={...r.extras,...e.extras})}async function bi(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const ka=(n,e)=>{const r=new window.Image(n,e);return r.referrerPolicy="strict-origin-when-cross-origin",r};class mo{static async dataUrlToArrayBuffer(e){return bi(e).then(function(r){return r.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((r,i)=>{if(e){const s=new FileReader;s.onload=()=>r(s.result),s.onerror=o=>i(o),s.onabort=o=>i(o),s.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((r,i)=>{if(e){const s=new FileReader;s.onload=()=>r(s.result),s.onerror=o=>i(o),s.onabort=o=>i(o),s.readAsText(e)}})}}function uw(n){let e=0;for(let r=0;r<n.length;r++)e=(e<<5)-e+n.charCodeAt(r),e|=0;return e+""}function zQ(n){const e=new DataView(n);let r=0;for(let i=0;i<e.byteLength;i++)r=(r<<5)-r+e.getUint8(i),r|=0;return r+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function $Q(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function i(o,a,c,l,u=1024){if(!a)return-1;a=new RegExp(a,"g");const d=a.source.length,h=new TextDecoder,p=o.length;if(typeof l>"u"&&(l=p),c>=p||l<=0||c>=l)return-1;o=o.subarray(c,l);let g=-1,y=0,v=0,x="";e:for(;y<o.length;){const m=y+u,b=o.subarray(y,m),S=h.decode(b,{stream:!0}),w=x+S;let I,C=-1;for(;(I=a.exec(w))!==null;){C=I.index-x.length,g=v+C;break e}y=m,v+=S.length;const _=C>-1?C+d:S.length-d;x=S.slice(_)}return g>=0&&(g+=c>=0?c:p+c),g}const s=i(e,"IDAT",12);return s>=12?i(e,"acTL",8,s)>=8:!1}const BQ=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function Hj(n,e){let r=0;for(;n[e+r];)r+=n[e+r]+1;return r+1}function UQ(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function qQ(n){const e=new Uint8Array(n);let r,i,s=0,o=0;if(!UQ(n))return!1;for(r=e[10]&128,i=e[10]&7,s+=6,s+=7,s+=r?3*Math.pow(2,i+1):0;o<2&&s<e.length;)switch(e[s]){case 44:o+=1,r=e[s+9]&128,i=e[s+9]&7,s+=10,s+=r?3*Math.pow(2,i+1):0,s+=Hj(e,s+1)+1;break;case 33:s+=2,s+=Hj(e,s);break;case 59:s=e.length;break;default:s=e.length;break}return o>1}let dw=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(dw=new Int32Array(dw));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const HQ=(n,e)=>{let r=-1;for(let i=0;i<n.length;i++)r=dw[(r^n[i])&255]^r>>>8;return r^-1},Gj=4,Kj=4;class ui{static isPng(e,r){return e.getUint8(r+0)===137&&e.getUint8(r+1)===80&&e.getUint8(r+2)===78&&e.getUint8(r+3)===71&&e.getUint8(r+4)===13&&e.getUint8(r+5)===10&&e.getUint8(r+6)===26&&e.getUint8(r+7)===10}static getChunkType(e,r){return[String.fromCharCode(e.getUint8(r)),String.fromCharCode(e.getUint8(r+1)),String.fromCharCode(e.getUint8(r+2)),String.fromCharCode(e.getUint8(r+3))].join("")}static readChunks(e,r=0){const i={};if(!ui.isPng(e,r))throw new Error("Not a PNG");for(r+=8;r<=e.buffer.byteLength;){const s=r,o=e.getInt32(r);r+=4;const a=ui.getChunkType(e,r);if(a==="IDAT"&&i[a]){r+=o+Gj+Kj;continue}if(a==="IEND")break;i[a]={start:s,dataOffset:r+4,size:o},r+=o+Gj+Kj}return i}static parsePhys(e,r){return{ppux:e.getUint32(r),ppuy:e.getUint32(r+4),unit:e.getUint8(r+4)}}static findChunk(e,r){return ui.readChunks(e)[r]}static setPhysChunk(e,r=1,i){let s=46,o=0;const a=ui.findChunk(e,"pHYs");a&&(s=a.start,o=a.size);const c=ui.findChunk(e,"IDAT");c&&(s=c.start,o=0);const l=new ArrayBuffer(21),u=new DataView(l);u.setUint32(0,9),u.setUint8(4,112),u.setUint8(5,72),u.setUint8(6,89),u.setUint8(7,115);const d=2835.5;u.setInt32(8,d*r),u.setInt32(12,d*r),u.setInt8(16,1);const h=new Uint8Array(l.slice(4,17));u.setInt32(17,HQ(h));const p=e.buffer.slice(0,s),g=e.buffer.slice(s+o);return new Blob([p,l,g],i)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function GQ(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function KQ(n){const e=new Uint8Array(n);return!GQ(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const YL=Object.freeze(["image/svg+xml"]),XL=Object.freeze(["image/jpeg","image/png","image/webp"]),ZL=Object.freeze(["image/gif","image/apng","image/avif"]),g_=Object.freeze([...XL,...YL,...ZL]),QL=Object.freeze(["video/mp4","video/webm","video/quicktime"]),VQ=[...g_,...QL].join(",");class di{static loadVideo(e){return new Promise((r,i)=>{const s=document.createElement("video");s.onloadeddata=()=>r(s),s.onerror=o=>{console.error(o),i(new Error("Could not load video"))},s.crossOrigin="anonymous",s.src=e})}static loadImage(e){return new Promise((r,i)=>{const s=ka();s.onload=()=>r(s),s.onerror=o=>{console.error(o),i(new Error("Could not load image"))},s.crossOrigin="anonymous",s.referrerPolicy="strict-origin-when-cross-origin",s.src=e})}static async getVideoSize(e){return di.usingObjectURL(e,async r=>{const i=await di.loadVideo(r);return{w:i.videoWidth,h:i.videoHeight}})}static async getImageSize(e){const r=await di.usingObjectURL(e,di.loadImage);try{if(e.type==="image/png"){const i=new DataView(await e.arrayBuffer());if(ui.isPng(i,0)){const s=ui.findChunk(i,"pHYs");if(s){const o=ui.parsePhys(i,s.dataOffset);if(o.unit===0&&o.ppux===o.ppuy){const a=Math.max(o.ppux/2834.5,1);return{w:Math.round(r.naturalWidth/a),h:Math.round(r.naturalHeight/a)}}}}}}catch(i){return console.error(i),{w:r.naturalWidth,h:r.naturalHeight}}return{w:r.naturalWidth,h:r.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?qQ(await e.arrayBuffer()):e.type==="image/avif"?BQ(await e.arrayBuffer()):e.type==="image/webp"?KQ(await e.arrayBuffer()):e.type==="image/apng"?$Q(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return ZL.includes(e||"")}static isStaticImageType(e){return XL.includes(e||"")}static isVectorImageType(e){return YL.includes(e||"")}static isImageType(e){return g_.includes(e)}static async usingObjectURL(e,r){const i=URL.createObjectURL(e);try{return await r(i)}finally{URL.revokeObjectURL(i)}}}function $n(n,e,r){return n+(e-n)*r}function ti(n=""){let e=0,r=0,i=0,s=0;function o(){const a=e^e<<11;return e=r,r=i,i=s,s^=(s>>>19^a^a>>>8)>>>0,s/4294967296*2}for(let a=0;a<n.length+64;a++)e^=n.charCodeAt(a)|0,o();return o}function Ta(n,e,r,i=!1){const[s,o]=e,[a,c]=r,l=a+(n-s)/(o-s)*(c-a);return i?a<c?Math.max(Math.min(l,c),a):Math.max(Math.min(l,a),c):l}function yi(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Hn(n,e){if(yi(n,e))return n[e]}function Vj(n){return Object.keys(n)}function jt(n){return Object.values(n)}function Wn(n){return Object.entries(n)}function JL(n){return Object.fromEntries(n)}function el(n,e){const r={};let i=!1;for(const[s,o]of Wn(n))e(s,o)?r[s]=o:i=!0;return i?r:n}function tu(n,e){const r={};for(const[i,s]of Wn(n)){const o=e(i,s);r[i]=o}return r}function eF(n,e){if(n===e)return!0;const r=new Set(Object.keys(n)),i=new Set(Object.keys(e));if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s)||!Object.is(n[s],e[s]))return!1;return!0}const ir="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",tF="a0",nF="A00000000000000000000000000";function rF(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-97+2;if(n>="A"&&n<="Z")return 90-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function iF(n){if(n.length!==rF(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function Wj(n){if(n===void 0)throw Error("n is undefined")}function Yj(n){iF(n);const[e,...r]=n.split("");let i=!0;for(let s=r.length-1;i&&s>=0;s--){const o=ir.indexOf(r[s])+1;o===ir.length?r[s]="0":(r[s]=ir.charAt(o),i=!1)}if(i){if(e==="Z")return"a0";if(e==="z")return;const s=String.fromCharCode(e.charCodeAt(0)+1);return s>"a"?r.push("0"):r.pop(),s+r.join("")}else return e+r.join("")}function WQ(n){iF(n);const[e,...r]=n.split("");let i=!0;for(let s=r.length-1;i&&s>=0;s--){const o=ir.indexOf(r[s])-1;o===-1?r[s]=ir.slice(-1):(r[s]=ir.charAt(o),i=!1)}if(i){if(e==="a")return"Z"+ir.slice(-1);if(e==="A")return;const s=String.fromCharCode(e.charCodeAt(0)-1);return s<"Z"?r.push(ir.slice(-1)):r.pop(),s+r.join("")}else return e+r.join("")}function ca(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let s=0;for(;(n.charAt(s)||"0")===e.charAt(s);)s++;if(s>0)return e.slice(0,s)+ca(n.slice(s),e.slice(s))}const r=n?ir.indexOf(n.charAt(0)):0,i=e!==void 0?ir.indexOf(e.charAt(0)):ir.length;if(i-r>1){const s=Math.round(.5*(r+i));return ir.charAt(s)}else return e&&e.length>1?e.slice(0,1):ir.charAt(r)+ca(n.slice(1),void 0)}function $c(n){const e=rF(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function hw(n){if(n===nF)throw new Error("invalid index: "+n);const e=$c(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function Wo(n,e){if(n!==void 0&&hw(n),e!==void 0&&hw(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return tF;if(n===void 0){if(e===void 0)throw Error("b is undefined");const c=$c(e),l=e.slice(c.length);if(c===nF)return c+ca("",l);if(c<e)return c;const u=WQ(c);return Wj(u),u}if(e===void 0){const c=$c(n),l=n.slice(c.length),u=Yj(c);return u===void 0?c+ca(l,void 0):u}const r=$c(n),i=n.slice(r.length),s=$c(e),o=e.slice(s.length);if(r===s)return r+ca(i,o);const a=Yj(r);return Wj(a),a<e?a:r+ca(i,void 0)}function Fs(n,e,r){if(r===0)return[];if(r===1)return[Wo(n,e)];if(e===void 0){let o=Wo(n,e);const a=[o];for(let c=0;c<r-1;c++)o=Wo(o,e),a.push(o);return a}if(n===void 0){let o=Wo(n,e);const a=[o];for(let c=0;c<r-1;c++)o=Wo(n,o),a.push(o);return a.reverse(),a}const i=Math.floor(r/2),s=Wo(n,e);return[...Fs(n,s,i),s,...Fs(s,e,r-i-1)]}const sF=tF;function YQ(n){hw(n)}function Ma(n,e,r){return Fs(n,e,r)}function tS(n,e){return Fs(n,void 0,e)}function wl(n,e){return Fs(n,e,1)[0]}function Hr(n){return Fs(n,void 0,1)[0]}function XQ(n){return Fs(void 0,n,1)[0]}function _l(n,e="a1"){return[e,...Fs(e,void 0,n)]}function bn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function ZQ(n,e){return n.id>e.id?1:-1}function m_(n){try{return localStorage.getItem(n)}catch{return null}}function y_(n,e){try{localStorage.setItem(n,e)}catch{}}function QQ(){try{localStorage.clear()}catch{}}function oF(n){try{return sessionStorage.getItem(n)}catch{return null}}function v_(n,e){try{sessionStorage.setItem(n,e)}catch{}}function aF(n){try{sessionStorage.removeItem(n)}catch{}}function JQ(){try{sessionStorage.clear()}catch{}}const la=[],eJ=60,_d=Math.ceil(1e3/eJ);let uc,nS=0,fw=0;const tJ=()=>{const n=la.splice(0,la.length);for(const e of n)e()};function cF(){if(uc)return;const n=Date.now(),e=n-fw;if(nS+e<_d){uc=requestAnimationFrame(()=>{uc=void 0,cF()});return}uc=requestAnimationFrame(()=>{uc=void 0,fw=n,nS=Math.min(nS+e-_d,_d*10),tJ()})}let Xj=!1;function lF(n){return la.includes(n)||(la.push(n),Xj||(Xj=!0,fw=Date.now()-_d-1),cF()),()=>{const e=la.indexOf(n);e>-1&&la.splice(e,1)}}class nJ{timeouts=[];intervals=[];rafs=[];setTimeout(e,r,...i){const s=window.setTimeout(e,r,i);return this.timeouts.push(s),s}setInterval(e,r,...i){const s=window.setInterval(e,r,i);return this.intervals.push(s),s}requestAnimationFrame(e){const r=window.requestAnimationFrame(e);return this.rafs.push(r),r}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function rJ(n){return n!==null}function iJ(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const uF=iJ(),ft=uF[0];uF[1];const sJ=Object.getPrototypeOf(ft({}));var rS={};const x_={enableLicensing:oJ("enableLicensing",{defaults:{all:!0,production:!1}})},dF=Nn("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Dt={logPreventDefaults:Nn("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Nn("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Nn("logElementRemoves",{defaults:{all:!1}}),debugSvg:Nn("debugSvg",{defaults:{all:!1}}),showFps:Nn("showFps",{defaults:{all:!1}}),measurePerformance:Nn("measurePerformance",{defaults:{all:!1}}),throwToBlob:Nn("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Nn("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Nn("debugCursors",{defaults:{all:!1}}),forceSrgb:Nn("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Nn("debugGeometry",{defaults:{all:!1}}),hideShapes:Nn("hideShapes",{defaults:{all:!1}}),editOnType:Nn("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;$o("element removal logging",()=>{Dt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Nn(n,{defaults:e,shouldStoreForSession:r=!0}){return hF({name:n,defaults:e,shouldStoreForSession:r})}function oJ(n,{defaults:e,shouldStoreForSession:r=!0}){return hF({name:n,defaults:e,shouldStoreForSession:r})}function hF(n){const e=cJ(n),r=n.shouldStoreForSession?aJ(n.name):null,i=Vt(`debug:${n.name}`,r??e);return typeof window<"u"&&(n.shouldStoreForSession&&$o(`debug:${n.name}`,()=>{const s=i.get();s===e?aF(`tldraw_debug:${n.name}`):v_(`tldraw_debug:${n.name}`,JSON.stringify(s))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,s=>s.toUpperCase())}`,{get(){return i.get()},set(s){i.set(s)},configurable:!0})),Object.assign(i,n)}function aJ(n){try{return JSON.parse(oF(`tldraw_debug:${n}`)??"null")}catch{return null}}function iS(n){try{return n()}catch{return null}}function cJ(n){switch(iS(()=>rS.TLDRAW_ENV)??iS(()=>rS.VERCEL_PUBLIC_TLDRAW_ENV)??iS(()=>rS.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}class Cd{constructor(e){this.previousValue=e}nextValue;diff;get(){const e=this.diff?.removed?.size??0,r=this.diff?.added?.size??0;if(!(e===0&&r===0))return{value:this.nextValue,diff:this.diff}}_add(e,r){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},r?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){const r=this.previousValue.has(e);if(r)return this.diff?.removed?.has(e)?this._add(e,r):void 0;this.nextValue?.has(e)||this._add(e,r)}_remove(e,r){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},r?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){const r=this.previousValue.has(e);if(!r)return this.diff?.added?.has(e)?this._remove(e,r):void 0;this.diff?.removed?.has(e)||this._remove(e,r)}}let fF=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");class pf{constructor(e,r){this.typeName=e,this.createDefaultProperties=r.createDefaultProperties,this.validator=r.validator??{validate:s=>s},this.scope=r.scope??"document",this.ephemeralKeys=r.ephemeralKeys;const i=new Set;if(r.ephemeralKeys)for(const[s,o]of Wn(r.ephemeralKeys))o&&i.add(s);this.ephemeralKeySet=i}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){const r={...this.createDefaultProperties(),id:this.createId()};for(const[i,s]of Object.entries(e))s!==void 0&&(r[i]=s);return r.typeName=this.typeName,r}clone(e){return{...ft(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??fF())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let r=0;r<this.typeName.length;r++)if(e[r]!==this.typeName[r])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new pf(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,r){return r&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(r,e):this.validator.validate(e)}}function ki(n,e){return new pf(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Wd(){return{added:{},updated:{},removed:{}}}function pw(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[r,i]of Object.values(n.updated))e.updated[r.id]=[i,r];return e}function pF(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function b_(n){const e={added:{},removed:{},updated:{}};return tl(e,n),e}function tl(n,e){for(const r of e){for(const[i,s]of Wn(r.added))if(n.removed[i]){const o=n.removed[i];delete n.removed[i],o!==s&&(n.updated[i]=[o,s])}else n.added[i]=s;for(const[i,[s,o]]of Wn(r.updated)){if(n.added[i]){n.added[i]=o,delete n.updated[i],delete n.removed[i];continue}if(n.updated[i]){n.updated[i]=[n.updated[i][0],o],delete n.removed[i];continue}n.updated[i]=r.updated[i],delete n.removed[i]}for(const[i,s]of Wn(r.removed))n.added[i]?delete n.added[i]:n.updated[i]?(n.removed[i]=n.updated[i][0],delete n.updated[i]):n.removed[i]=s}}var Bc={exports:{}};Bc.exports;var Zj;function lJ(){return Zj||(Zj=1,(function(n,e){var r=200,i="__lodash_hash_undefined__",s=1,o=2,a=9007199254740991,c="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",h="[object Date]",p="[object Error]",g="[object Function]",y="[object GeneratorFunction]",v="[object Map]",x="[object Number]",m="[object Null]",b="[object Object]",S="[object Promise]",w="[object Proxy]",I="[object RegExp]",C="[object Set]",_="[object String]",P="[object Symbol]",M="[object Undefined]",T="[object WeakMap]",A="[object ArrayBuffer]",R="[object DataView]",O="[object Float32Array]",j="[object Float64Array]",D="[object Int8Array]",N="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",$="[object Uint8ClampedArray]",G="[object Uint16Array]",X="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,B=/^(?:0|[1-9]\d*)$/,U={};U[O]=U[j]=U[D]=U[N]=U[F]=U[z]=U[$]=U[G]=U[X]=!0,U[c]=U[l]=U[A]=U[d]=U[R]=U[h]=U[p]=U[g]=U[v]=U[x]=U[b]=U[I]=U[C]=U[_]=U[T]=!1;var Q=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt,K=typeof self=="object"&&self&&self.Object===Object&&self,Y=Q||K||Function("return this")(),V=e&&!e.nodeType&&e,ie=V&&!0&&n&&!n.nodeType&&n,ae=ie&&ie.exports===V,ye=ae&&Q.process,he=(function(){try{return ye&&ye.binding&&ye.binding("util")}catch{}})(),xe=he&&he.isTypedArray;function fe(L,H){for(var ce=-1,_e=L==null?0:L.length,mt=0,$e=[];++ce<_e;){var At=L[ce];H(At,ce,L)&&($e[mt++]=At)}return $e}function me(L,H){for(var ce=-1,_e=H.length,mt=L.length;++ce<_e;)L[mt+ce]=H[ce];return L}function we(L,H){for(var ce=-1,_e=L==null?0:L.length;++ce<_e;)if(H(L[ce],ce,L))return!0;return!1}function st(L,H){for(var ce=-1,_e=Array(L);++ce<L;)_e[ce]=H(ce);return _e}function lt(L){return function(H){return L(H)}}function Ut(L,H){return L.has(H)}function Bt(L,H){return L?.[H]}function se(L){var H=-1,ce=Array(L.size);return L.forEach(function(_e,mt){ce[++H]=[mt,_e]}),ce}function ve(L,H){return function(ce){return L(H(ce))}}function Se(L){var H=-1,ce=Array(L.size);return L.forEach(function(_e){ce[++H]=_e}),ce}var Ke=Array.prototype,ke=Function.prototype,Ne=Object.prototype,ut=Y["__core-js_shared__"],Xe=ke.toString,J=Ne.hasOwnProperty,le=(function(){var L=/[^.]+$/.exec(ut&&ut.keys&&ut.keys.IE_PROTO||"");return L?"Symbol(src)_1."+L:""})(),ge=Ne.toString,Le=RegExp("^"+Xe.call(J).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=ae?Y.Buffer:void 0,hn=Y.Symbol,Xs=Y.Uint8Array,Nr=Ne.propertyIsEnumerable,Lr=Ke.splice,pr=hn?hn.toStringTag:void 0,Fr=Object.getOwnPropertySymbols,Mi=Re?Re.isBuffer:void 0,qo=ve(Object.keys,Object),Ja=Ko(Y,"DataView"),Zs=Ko(Y,"Map"),ec=Ko(Y,"Promise"),tc=Ko(Y,"Set"),nc=Ko(Y,"WeakMap"),Qs=Ko(Object,"create"),Zf=eo(Ja),Qf=eo(Zs),Jf=eo(ec),ep=eo(tc),tp=eo(nc),yu=hn?hn.prototype:void 0,rc=yu?yu.valueOf:void 0;function Ai(L){var H=-1,ce=L==null?0:L.length;for(this.clear();++H<ce;){var _e=L[H];this.set(_e[0],_e[1])}}function np(){this.__data__=Qs?Qs(null):{},this.size=0}function rp(L){var H=this.has(L)&&delete this.__data__[L];return this.size-=H?1:0,H}function ip(L){var H=this.__data__;if(Qs){var ce=H[L];return ce===i?void 0:ce}return J.call(H,L)?H[L]:void 0}function sp(L){var H=this.__data__;return Qs?H[L]!==void 0:J.call(H,L)}function vu(L,H){var ce=this.__data__;return this.size+=this.has(L)?0:1,ce[L]=Qs&&H===void 0?i:H,this}Ai.prototype.clear=np,Ai.prototype.delete=rp,Ai.prototype.get=ip,Ai.prototype.has=sp,Ai.prototype.set=vu;function gr(L){var H=-1,ce=L==null?0:L.length;for(this.clear();++H<ce;){var _e=L[H];this.set(_e[0],_e[1])}}function xu(){this.__data__=[],this.size=0}function op(L){var H=this.__data__,ce=Go(H,L);if(ce<0)return!1;var _e=H.length-1;return ce==_e?H.pop():Lr.call(H,ce,1),--this.size,!0}function ap(L){var H=this.__data__,ce=Go(H,L);return ce<0?void 0:H[ce][1]}function cp(L){return Go(this.__data__,L)>-1}function lp(L,H){var ce=this.__data__,_e=Go(ce,L);return _e<0?(++this.size,ce.push([L,H])):ce[_e][1]=H,this}gr.prototype.clear=xu,gr.prototype.delete=op,gr.prototype.get=ap,gr.prototype.has=cp,gr.prototype.set=lp;function ji(L){var H=-1,ce=L==null?0:L.length;for(this.clear();++H<ce;){var _e=L[H];this.set(_e[0],_e[1])}}function up(){this.size=0,this.__data__={hash:new Ai,map:new(Zs||gr),string:new Ai}}function bu(L){var H=Iu(this,L).delete(L);return this.size-=H?1:0,H}function dp(L){return Iu(this,L).get(L)}function hp(L){return Iu(this,L).has(L)}function fp(L,H){var ce=Iu(this,L),_e=ce.size;return ce.set(L,H),this.size+=ce.size==_e?0:1,this}ji.prototype.clear=up,ji.prototype.delete=bu,ji.prototype.get=dp,ji.prototype.has=hp,ji.prototype.set=fp;function Ho(L){var H=-1,ce=L==null?0:L.length;for(this.__data__=new ji;++H<ce;)this.add(L[H])}function pp(L){return this.__data__.set(L,i),this}function gp(L){return this.__data__.has(L)}Ho.prototype.add=Ho.prototype.push=pp,Ho.prototype.has=gp;function ii(L){var H=this.__data__=new gr(L);this.size=H.size}function Su(){this.__data__=new gr,this.size=0}function mp(L){var H=this.__data__,ce=H.delete(L);return this.size=H.size,ce}function yp(L){return this.__data__.get(L)}function vp(L){return this.__data__.has(L)}function xp(L,H){var ce=this.__data__;if(ce instanceof gr){var _e=ce.__data__;if(!Zs||_e.length<r-1)return _e.push([L,H]),this.size=++ce.size,this;ce=this.__data__=new ji(_e)}return ce.set(L,H),this.size=ce.size,this}ii.prototype.clear=Su,ii.prototype.delete=mp,ii.prototype.get=yp,ii.prototype.has=vp,ii.prototype.set=xp;function bp(L,H){var ce=Eu(L),_e=!ce&&NB(L),mt=!ce&&!_e&&Pp(L),$e=!ce&&!_e&&!mt&&KC(L),At=ce||_e||mt||$e,qt=At?st(L.length,String):[],en=qt.length;for(var Et in L)J.call(L,Et)&&!(At&&(Et=="length"||mt&&(Et=="offset"||Et=="parent")||$e&&(Et=="buffer"||Et=="byteLength"||Et=="byteOffset")||AB(Et,en)))&&qt.push(Et);return qt}function Go(L,H){for(var ce=L.length;ce--;)if(UC(L[ce][0],H))return ce;return-1}function Sp(L,H,ce){var _e=H(L);return Eu(L)?_e:me(_e,ce(L))}function Js(L){return L==null?L===void 0?M:m:pr&&pr in Object(L)?TB(L):DB(L)}function ic(L){return oc(L)&&Js(L)==c}function wu(L,H,ce,_e,mt){return L===H?!0:L==null||H==null||!oc(L)&&!oc(H)?L!==L&&H!==H:_u(L,H,ce,_e,wu,mt)}function _u(L,H,ce,_e,mt,$e){var At=Eu(L),qt=Eu(H),en=At?l:ms(L),Et=qt?l:ms(H);en=en==c?b:en,Et=Et==c?b:Et;var er=en==b,zr=Et==b,fn=en==Et;if(fn&&Pp(L)){if(!Pp(H))return!1;At=!0,er=!1}if(fn&&!er)return $e||($e=new ii),At||KC(L)?Cu(L,H,ce,_e,mt,$e):Cp(L,H,en,ce,_e,mt,$e);if(!(ce&s)){var mr=er&&J.call(L,"__wrapped__"),yr=zr&&J.call(H,"__wrapped__");if(mr||yr){var ys=mr?L.value():L,Ri=yr?H.value():H;return $e||($e=new ii),mt(ys,Ri,ce,_e,$e)}}return fn?($e||($e=new ii),Pu(L,H,ce,_e,mt,$e)):!1}function wp(L){if(!GC(L)||RB(L))return!1;var H=qC(L)?Le:re;return H.test(eo(L))}function _p(L){return oc(L)&&HC(L.length)&&!!U[Js(L)]}function sc(L){if(!OB(L))return qo(L);var H=[];for(var ce in Object(L))J.call(L,ce)&&ce!="constructor"&&H.push(ce);return H}function Cu(L,H,ce,_e,mt,$e){var At=ce&s,qt=L.length,en=H.length;if(qt!=en&&!(At&&en>qt))return!1;var Et=$e.get(L);if(Et&&$e.get(H))return Et==H;var er=-1,zr=!0,fn=ce&o?new Ho:void 0;for($e.set(L,H),$e.set(H,L);++er<qt;){var mr=L[er],yr=H[er];if(_e)var ys=At?_e(yr,mr,er,H,L,$e):_e(mr,yr,er,L,H,$e);if(ys!==void 0){if(ys)continue;zr=!1;break}if(fn){if(!we(H,function(Ri,to){if(!Ut(fn,to)&&(mr===Ri||mt(mr,Ri,ce,_e,$e)))return fn.push(to)})){zr=!1;break}}else if(!(mr===yr||mt(mr,yr,ce,_e,$e))){zr=!1;break}}return $e.delete(L),$e.delete(H),zr}function Cp(L,H,ce,_e,mt,$e,At){switch(ce){case R:if(L.byteLength!=H.byteLength||L.byteOffset!=H.byteOffset)return!1;L=L.buffer,H=H.buffer;case A:return!(L.byteLength!=H.byteLength||!$e(new Xs(L),new Xs(H)));case d:case h:case x:return UC(+L,+H);case p:return L.name==H.name&&L.message==H.message;case I:case _:return L==H+"";case v:var qt=se;case C:var en=_e&s;if(qt||(qt=Se),L.size!=H.size&&!en)return!1;var Et=At.get(L);if(Et)return Et==H;_e|=o,At.set(L,H);var er=Cu(qt(L),qt(H),_e,mt,$e,At);return At.delete(L),er;case P:if(rc)return rc.call(L)==rc.call(H)}return!1}function Pu(L,H,ce,_e,mt,$e){var At=ce&s,qt=BC(L),en=qt.length,Et=BC(H),er=Et.length;if(en!=er&&!At)return!1;for(var zr=en;zr--;){var fn=qt[zr];if(!(At?fn in H:J.call(H,fn)))return!1}var mr=$e.get(L);if(mr&&$e.get(H))return mr==H;var yr=!0;$e.set(L,H),$e.set(H,L);for(var ys=At;++zr<en;){fn=qt[zr];var Ri=L[fn],to=H[fn];if(_e)var VC=At?_e(to,Ri,fn,H,L,$e):_e(Ri,to,fn,L,H,$e);if(!(VC===void 0?Ri===to||mt(Ri,to,ce,_e,$e):VC)){yr=!1;break}ys||(ys=fn=="constructor")}if(yr&&!ys){var ku=L.constructor,Tu=H.constructor;ku!=Tu&&"constructor"in L&&"constructor"in H&&!(typeof ku=="function"&&ku instanceof ku&&typeof Tu=="function"&&Tu instanceof Tu)&&(yr=!1)}return $e.delete(L),$e.delete(H),yr}function BC(L){return Sp(L,zB,MB)}function Iu(L,H){var ce=L.__data__;return jB(H)?ce[typeof H=="string"?"string":"hash"]:ce.map}function Ko(L,H){var ce=Bt(L,H);return wp(ce)?ce:void 0}function TB(L){var H=J.call(L,pr),ce=L[pr];try{L[pr]=void 0;var _e=!0}catch{}var mt=ge.call(L);return _e&&(H?L[pr]=ce:delete L[pr]),mt}var MB=Fr?function(L){return L==null?[]:(L=Object(L),fe(Fr(L),function(H){return Nr.call(L,H)}))}:$B,ms=Js;(Ja&&ms(new Ja(new ArrayBuffer(1)))!=R||Zs&&ms(new Zs)!=v||ec&&ms(ec.resolve())!=S||tc&&ms(new tc)!=C||nc&&ms(new nc)!=T)&&(ms=function(L){var H=Js(L),ce=H==b?L.constructor:void 0,_e=ce?eo(ce):"";if(_e)switch(_e){case Zf:return R;case Qf:return v;case Jf:return S;case ep:return C;case tp:return T}return H});function AB(L,H){return H=H??a,!!H&&(typeof L=="number"||B.test(L))&&L>-1&&L%1==0&&L<H}function jB(L){var H=typeof L;return H=="string"||H=="number"||H=="symbol"||H=="boolean"?L!=="__proto__":L===null}function RB(L){return!!le&&le in L}function OB(L){var H=L&&L.constructor,ce=typeof H=="function"&&H.prototype||Ne;return L===ce}function DB(L){return ge.call(L)}function eo(L){if(L!=null){try{return Xe.call(L)}catch{}try{return L+""}catch{}}return""}function UC(L,H){return L===H||L!==L&&H!==H}var NB=ic((function(){return arguments})())?ic:function(L){return oc(L)&&J.call(L,"callee")&&!Nr.call(L,"callee")},Eu=Array.isArray;function LB(L){return L!=null&&HC(L.length)&&!qC(L)}var Pp=Mi||BB;function FB(L,H){return wu(L,H)}function qC(L){if(!GC(L))return!1;var H=Js(L);return H==g||H==y||H==u||H==w}function HC(L){return typeof L=="number"&&L>-1&&L%1==0&&L<=a}function GC(L){var H=typeof L;return L!=null&&(H=="object"||H=="function")}function oc(L){return L!=null&&typeof L=="object"}var KC=xe?lt(xe):_p;function zB(L){return LB(L)?bp(L):sc(L)}function $B(){return[]}function BB(){return!1}n.exports=FB})(Bc,Bc.exports)),Bc.exports}var uJ=lJ();const dJ=rs(uJ);function hJ(n){if(n.length===0)return new Set;const e=n[0],r=n.slice(1),i=new Set;for(const s of e)r.every(o=>o.has(s))&&i.add(s);return i}function fJ(n,e){const r={};for(const i of e)n.has(i)||(r.added??=new Set,r.added.add(i));for(const i of n)e.has(i)||(r.removed??=new Set,r.removed.add(i));return r.added||r.removed?r:void 0}function Qj(n,e){for(const[r,i]of Object.entries(n)){const s=i,o=e[r];if("eq"in s&&o!==s.eq||"neq"in s&&o===s.neq||"gt"in s&&(typeof o!="number"||o<=s.gt))return!1}return!0}function Jj(n,e,r){const i=Object.fromEntries(Object.keys(r).map(s=>[s,new Set]));for(const[s,o]of Object.entries(r))if("eq"in o){const c=n.index(e,s).get().get(o.eq);if(c)for(const l of c)i[s].add(l)}else if("neq"in o){const a=n.index(e,s);for(const[c,l]of a.get())if(c!==o.neq)for(const u of l)i[s].add(u)}else if("gt"in o){const a=n.index(e,s);for(const[c,l]of a.get())if(c>o.gt)for(const u of l)i[s].add(u)}return hJ(Object.values(i))}class pJ{constructor(e,r){this.atoms=e,this.history=r}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const r=oe("filterHistory:"+e,(i,s)=>{if(go(i))return this.history.get();const o=this.history.getDiffSince(s);if(o===sr)return this.history.get();const a={added:{},removed:{},updated:{}};let c=0,l=0,u=0;for(const d of o){for(const h of jt(d.added))if(h.typeName===e)if(a.removed[h.id]){const p=a.removed[h.id];delete a.removed[h.id],l--,p!==h&&(a.updated[h.id]=[p,h],u++)}else a.added[h.id]=h,c++;for(const[h,p]of jt(d.updated))p.typeName===e&&(a.added[p.id]?a.added[p.id]=p:a.updated[p.id]?a.updated[p.id]=[a.updated[p.id][0],p]:(a.updated[p.id]=[h,p],u++));for(const h of jt(d.removed))h.typeName===e&&(a.added[h.id]?(delete a.added[h.id],c--):a.updated[h.id]?(a.removed[h.id]=a.updated[h.id][0],delete a.updated[h.id],u--,l++):(a.removed[h.id]=h,l++))}return c||l||u?Fc(this.history.get(),a):i},{historyLength:100});return this.historyCache.set(e,r),r}index(e,r){const i=e+":"+r;if(this.indexCache.has(i))return this.indexCache.get(i);const s=this.__uncached_createIndex(e,r);return this.indexCache.set(i,s),s}__uncached_createIndex(e,r){const i=this.filterHistory(e),s=()=>{i.get();const o=new Map;for(const a of jt(this.atoms.get())){const c=a.get();if(c.typeName===e){const l=c[r];o.has(l)||o.set(l,new Set),o.get(l).add(c.id)}}return o};return oe("index:"+e+":"+r,(o,a)=>{if(go(o))return s();const c=i.getDiffSince(a);if(c===sr)return s();const l=new Map,u=(g,y)=>{let v=l.get(g);v||(v=new Cd(o.get(g)??new Set)),v.add(y),l.set(g,v)},d=(g,y)=>{let v=l.get(g);v||(v=new Cd(o.get(g)??new Set)),v.remove(y),l.set(g,v)};for(const g of c){for(const y of jt(g.added))if(y.typeName===e){const v=y[r];u(v,y.id)}for(const[y,v]of jt(g.updated))if(v.typeName===e){const x=y[r],m=v[r];x!==m&&(d(x,v.id),u(m,v.id))}for(const y of jt(g.removed))if(y.typeName===e){const v=y[r];d(v,y.id)}}let h,p;for(const[g,y]of l){const v=y.get();v&&(h||(h=new Map(o)),p||(p=new Map),v.value.size===0?h.delete(g):h.set(g,v.value),p.set(g,v.diff))}return h&&p?Fc(h,p):o},{historyLength:100})}record(e,r=()=>({}),i="record:"+e+(r?":"+r.toString():"")){const s=this.ids(e,r,i);return oe(i,()=>{for(const o of s.get())return this.atoms.get()[o]?.get()})}records(e,r=()=>({}),i="records:"+e+(r?":"+r.toString():"")){const s=this.ids(e,r,"ids:"+i);return oe(i,()=>[...s.get()].map(o=>{const a=this.atoms.get()[o];if(!a)throw new Error("no atom found for record id: "+o);return a.get()}))}ids(e,r=()=>({}),i="ids:"+e+(r?":"+r.toString():"")){const s=this.filterHistory(e),o=()=>{s.get();const l=r();return Object.keys(l).length===0?new Set(jt(this.atoms.get()).flatMap(u=>{const d=u.get();return d.typeName===e?d.id:[]})):Jj(this,e,l)},a=l=>{const u=o(),d=fJ(l,u);return d?Fc(u,d):l},c=oe("ids_query:"+i,r,{isEqual:dJ});return oe("query:"+i,(l,u)=>{const d=c.get();if(go(l))return o();if(u<c.lastChangedEpoch)return a(l);const h=s.getDiffSince(u);if(h===sr)return a(l);const p=new Cd(l);for(const y of h){for(const v of jt(y.added))v.typeName===e&&Qj(d,v)&&p.add(v.id);for(const[v,x]of jt(y.updated))x.typeName===e&&(Qj(d,x)?p.add(x.id):p.remove(x.id));for(const v of jt(y.removed))v.typeName===e&&p.remove(v.id)}const g=p.get();return g?Fc(g.value,g.diff):l},{historyLength:50})}exec(e,r){const i=Jj(this,e,r);if(i.size===0)return Yi;const s=this.atoms.get();return[...i].map(o=>s[o].get())}}class gJ{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,r){if(!this._isEnabled)return e;const i=this._beforeCreateHandlers[e.typeName];if(i){let s=e;for(const o of i)s=o(s,r);return s}return e}handleAfterCreate(e,r){if(!this._isEnabled)return;const i=this._afterCreateHandlers[e.typeName];if(i)for(const s of i)s(e,r)}handleBeforeChange(e,r,i){if(!this._isEnabled)return r;const s=this._beforeChangeHandlers[r.typeName];if(s){let o=r;for(const a of s)o=a(e,o,i);return o}return r}handleAfterChange(e,r,i){if(!this._isEnabled)return;const s=this._afterChangeHandlers[r.typeName];if(s)for(const o of s)o(e,r,i)}handleBeforeDelete(e,r){if(!this._isEnabled)return!0;const i=this._beforeDeleteHandlers[e.typeName];if(i){for(const s of i)if(s(e,r)===!1)return!1}return!0}handleAfterDelete(e,r){if(!this._isEnabled)return;const i=this._afterDeleteHandlers[e.typeName];if(i)for(const s of i)s(e,r)}handleOperationComplete(e){if(this._isEnabled)for(const r of this._operationCompleteHandlers)r(e)}register(e){const r=[];for(const[i,s]of Object.entries(e))s?.beforeCreate&&r.push(this.registerBeforeCreateHandler(i,s.beforeCreate)),s?.afterCreate&&r.push(this.registerAfterCreateHandler(i,s.afterCreate)),s?.beforeChange&&r.push(this.registerBeforeChangeHandler(i,s.beforeChange)),s?.afterChange&&r.push(this.registerAfterChangeHandler(i,s.afterChange)),s?.beforeDelete&&r.push(this.registerBeforeDeleteHandler(i,s.beforeDelete)),s?.afterDelete&&r.push(this.registerAfterDeleteHandler(i,s.afterDelete));return()=>{for(const i of r)i()}}registerBeforeCreateHandler(e,r){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(r),()=>no(this._beforeCreateHandlers[e],r)}registerAfterCreateHandler(e,r){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(r),()=>no(this._afterCreateHandlers[e],r)}registerBeforeChangeHandler(e,r){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(r),()=>no(this._beforeChangeHandlers[e],r)}registerAfterChangeHandler(e,r){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(r),()=>no(this._afterChangeHandlers[e],r)}registerBeforeDeleteHandler(e,r){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(r),()=>no(this._beforeDeleteHandlers[e],r)}registerAfterDeleteHandler(e,r){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(r),()=>no(this._afterDeleteHandlers[e],r)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>no(this._operationCompleteHandlers,e)}}function no(n,e){const r=n.indexOf(e);r>=0&&n.splice(r,1)}class S_{id;atoms=Vt("store_atoms",{});history=Vt("history",0,{historyLength:1e3});query=new pJ(this.atoms,this.history);listeners=new Set;historyAccumulator=new yJ;historyReactor;cancelHistoryReactor=()=>{};schema;props;scopedTypes;sideEffects=new gJ(this);constructor(e){const{initialData:r,schema:i,id:s}=e;this.id=s??fF(),this.schema=i,this.props=e.props,r&&this.atoms.set(JL(Wn(r).map(([o,a])=>[o,Vt("atom:"+o,this.schema.validateRecord(this,a,"initialize",null))]))),this.historyReactor=mQ("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:o=>this.cancelHistoryReactor=lF(o)}),this.scopedTypes={document:new Set(jt(this.schema.types).filter(o=>o.scope==="document").map(o=>o.typeName)),session:new Set(jt(this.schema.types).filter(o=>o.scope==="session").map(o=>o.typeName)),presence:new Set(jt(this.schema.types).filter(o=>o.scope==="presence").map(o=>o.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:r,source:i}of e){let s=null,o=null,a=null;for(const{onHistory:c,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==i))if(l.scope!=="all")if(l.scope==="document"){if(o??=this.filterChangesByScope(r,"document"),!o)continue;c({changes:o,source:i})}else if(l.scope==="session"){if(s??=this.filterChangesByScope(r,"session"),!s)continue;c({changes:s,source:i})}else{if(a??=this.filterChangesByScope(r,"presence"),!a)continue;c({changes:a,source:i})}else c({changes:r,source:i})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,r){const i={added:el(e.added,(s,o)=>this.scopedTypes[r].has(o.typeName)),updated:el(e.updated,(s,o)=>this.scopedTypes[r].has(o[1].typeName)),removed:el(e.removed,(s,o)=>this.scopedTypes[r].has(o.typeName))};return Object.keys(i.added).length===0&&Object.keys(i.updated).length===0&&Object.keys(i.removed).length===0?null:i}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(r=>this.schema.validateRecord(this,r,e,null))}put=(e,r)=>{this.atomic(()=>{const i={},s={},o=this.atoms.__unsafe__getWithoutCapture();let a=null,c,l=!1;const u=this.isMergingRemoteChanges?"remote":"user";for(let d=0,h=e.length;d<h;d++){c=e[d];const p=(a??o)[c.id];if(p){const g=p.__unsafe__getWithoutCapture();if(c=this.sideEffects.handleBeforeChange(g,c,u),this.schema.validateRecord(this,c,r??"updateRecord",g)===g)continue;p.set(c),l=!0;const v=p.__unsafe__getWithoutCapture();i[c.id]=[g,v],this.addDiffForAfterEvent(g,v)}else c=this.sideEffects.handleBeforeCreate(c,u),l=!0,c=this.schema.validateRecord(this,c,r??"createRecord",null),s[c.id]=c,this.addDiffForAfterEvent(null,c),a||(a={...o}),a[c.id]=Vt("atom:"+c.id,c)}a&&this.atoms.set(a),l&&this.updateHistory({added:s,updated:i,removed:{}})})};remove=e=>{this.atomic(()=>{const r=new Set,i=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const o of e){const a=this.atoms.__unsafe__getWithoutCapture()[o];a&&this.sideEffects.handleBeforeDelete(a.get(),i)===!1&&r.add(o)}let s;this.atoms.update(o=>{let a;for(const c of e){if(r.has(c)||!(c in o))continue;a||(a={...o}),s||(s={}),delete a[c];const l=o[c].get();s[c]=l,this.addDiffForAfterEvent(l,null)}return a??o}),s&&this.updateHistory({added:{},updated:{},removed:s})})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.__unsafe__getWithoutCapture()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{const r={};for(const[i,s]of Wn(this.atoms.get())){const o=s.get();(e==="all"||this.scopedTypes[e].has(o.typeName))&&(r[i]=o)}return r};getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const r=this.schema.migrateStoreSnapshot(e);if(r.type==="error")throw new Error(`Failed to migrate snapshot: ${r.reason}`);return{store:r.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const r=this.schema.migrateStoreSnapshot(e);if(r.type==="error")throw new Error(`Failed to migrate snapshot: ${r.reason}`);const i=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(r.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(i)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords=()=>jt(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove(Vj(this.atoms.get()))};update=(e,r)=>{const i=this.atoms.get()[e];if(!i){console.error(`Record ${e} not found. This is probably an error`);return}this.put([r(i.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,r)=>{this._flushHistory();const i={onHistory:e,filters:{source:r?.source??"all",scope:r?.scope??"all"}};return this.listeners.add(i),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(i),this.listeners.size===0&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,mi(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){const r=[],i=this.historyAccumulator.addInterceptor(s=>r.push(s.changes));try{return mi(e),b_(r)}finally{i()}}applyDiff(e,{runCallbacks:r=!0,ignoreEphemeralKeys:i=!1}={}){this.atomic(()=>{const s=jt(e.added);for(const[a,c]of jt(e.updated)){const l=this.schema.getType(c.typeName);if(i&&l.ephemeralKeySet.size){const u=this.get(c.id);if(!u){s.push(c);continue}let d=null;for(const[h,p]of Object.entries(c))l.ephemeralKeySet.has(h)||Object.is(p,Hn(u,h))||(d||(d={...u}),d[h]=p);d&&s.push(d)}else s.push(c)}const o=Vj(e.removed);s.length&&this.put(s),o.length&&this.remove(o)},r)}createComputedCache=(e,r,i)=>{const s=new es;return{get:o=>{const a=this.atoms.get()[o];if(a)return s.get(a,()=>{const c=i?oe(a.name+":equals",()=>a.get(),{isEqual:i}):a;return oe(e+":"+o,()=>r(c.get()))}).get()}}};createSelectedComputedCache=(e,r,i)=>{const s=new es;return{get:o=>{const a=this.atoms.get()[o];if(a)return s.get(a,()=>{const c=oe(e+":"+o+":selector",()=>r(a.get()));return oe(e+":"+o,()=>i(c.get()))}).get()}}};_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,r){if(gt(this.pendingAfterEvents,"must be in event operation"),e===r||(e&&r&&gt(e.id===r.id),!e&&!r))return;const i=(e||r).id,s=this.pendingAfterEvents.get(i);s?s.after=r:this.pendingAfterEvents.set(i,{before:e,after:r})}flushAtomicCallbacks(){let e=0;const r=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const i=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:o}of i.values())s&&o?this.sideEffects.handleAfterChange(s,o,r):s&&!o?this.sideEffects.handleAfterDelete(s,r):!s&&o&&this.sideEffects.handleAfterCreate(o,r);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(r)}}}_isInAtomicOp=!1;atomic(e,r=!0){return mi(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const i=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(r??i),this._isInAtomicOp=!0;try{const s=e();return this.flushAtomicCallbacks(),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(i),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(r=>e(r,this.isMergingRemoteChanges?"remote":"user"))}}function mJ(n){if(n.length===0)return[];const e=[];let r=[n[0]],i;for(let s=1,o=n.length;s<o;s++)i=n[s],r[0].source!==i.source&&(e.push(r),r=[]),r.push(i);return e.push(r),e.map(s=>({source:s[0].source,changes:b_(s.map(o=>o.changes))}))}class yJ{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const r of this._interceptors)r(e)}flush(){const e=mJ(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function vJ(n,e,r){const i=new es;return{get(s,o){return i.get(s,()=>(s instanceof S_?s:s.store).createComputedCache(n,l=>e(s,l),r)).get(o)}}}function xJ(n){const e=[];for(let r=n.length-1;r>=0;r--){const i=n[r];if("id"in i)e.unshift(i);else{const s=i.dependsOn,o=e[0];o&&(e[0]={...o,dependsOn:s.concat(o.dependsOn??[])})}}return e}function xa({sequence:n,sequenceId:e,retroactive:r=!0}){const i={sequenceId:e,retroactive:r,sequence:xJ(n)};return gF(i),i}function Zn(n,e){return Object.fromEntries(Wn(e).map(([r,i])=>[r,`${n}/${i}`]))}function hr(n){const e=n.sequenceId;return xa({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(r=>"id"in r?{...r,scope:"record",filter:i=>i.typeName===n.recordType&&(r.filter?.(i)??!0)&&(n.filter?.(i)??!0)}:r)})}function bJ(n){const e=new Map(n.map(o=>[o.id,o])),r=new Set,i=[];function s(o){gt(!r.has(o.id),`Circular dependency in migrations: ${o.id}`),r.add(o.id);const{version:a,sequenceId:c}=Yd(o.id),l=e.get(`${c}/${a-1}`);if(l&&s(l),o.dependsOn)for(const u of o.dependsOn){const d=e.get(u);d&&s(d)}e.delete(o.id),i.push(o)}for(const o of e.values())s(o);return i}function Yd(n){const[e,r]=n.split("/");return{sequenceId:e,version:parseInt(r)}}function eR(n,e){e&&gt(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),gt(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function gF(n){if(gt(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),gt(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;eR(n.sequence[0].id,n.sequenceId);let e=Yd(n.sequence[0].id).version;gt(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let r=1;r<n.sequence.length;r++){const i=n.sequence[r].id;eR(i,n.sequenceId);const s=Yd(i).version;gt(s===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[r].id}'`),e=s}}var Cs=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Cs||{});function SJ(n){if(n.schemaVersion>2||n.schemaVersion<1)return js.err("Bad schema version");if(n.schemaVersion===2)return js.ok(n);const e={schemaVersion:2,sequences:{}};for(const[r,i]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${r}`]=i.version,"subTypeKey"in i)for(const[s,o]of Object.entries(i.subTypeVersions))e.sequences[`com.tldraw.${r}.${s}`]=o;return js.ok(e)}class w_{constructor(e,r){this.types=e,this.options=r;for(const s of r.migrations??[])gt(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),gF(s),this.migrations[s.sequenceId]=s;const i=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=bJ(i);for(const s of this.sortedMigrations)if(s.dependsOn?.length)for(const o of s.dependsOn){const a=i.find(c=>c.id===o);gt(a,`Migration '${s.id}' depends on missing migration '${o}'`)}}static create(e,r){return new w_(e,r??{})}migrations={};sortedMigrations;validateRecord(e,r,i,s){try{const o=Hn(this.types,r.typeName);if(!o)throw new Error(`Missing definition for record type ${r.typeName}`);return o.validate(r,s??void 0)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:r,phase:i,recordBefore:s,error:o});throw o}}getMigrationsSince(e){const r=SJ(e);if(!r.ok)return r;const i=r.value,s=new Set(Object.keys(i.sequences).filter(a=>this.migrations[a]));for(const a in this.migrations)i.sequences[a]===void 0&&this.migrations[a].retroactive&&s.add(a);if(s.size===0)return js.ok([]);const o=new Set;for(const a of s){const c=i.sequences[a];if(typeof c!="number"&&this.migrations[a].retroactive||c===0){for(const d of this.migrations[a].sequence)o.add(d.id);continue}const l=`${a}/${c}`,u=this.migrations[a].sequence.findIndex(d=>d.id===l);if(u===-1)return js.err("Incompatible schema?");for(const d of this.migrations[a].sequence.slice(u+1))o.add(d.id)}return js.ok(this.sortedMigrations.filter(({id:a})=>o.has(a)))}migratePersistedRecord(e,r,i="up"){const s=this.getMigrationsSince(r);if(!s.ok)return console.error("Error migrating record",s.error),{type:"error",reason:Cs.MigrationError};let o=s.value;if(o.length===0)return{type:"success",value:e};if(o.some(a=>a.scope==="store"))return{type:"error",reason:i==="down"?Cs.TargetVersionTooOld:Cs.TargetVersionTooNew};if(i==="down"){if(!o.every(a=>a.down))return{type:"error",reason:Cs.TargetVersionTooOld};o=o.slice().reverse()}e=ft(e);try{for(const a of o){if(a.scope==="store")throw new Error;if(!(a.filter?a.filter(e):!0))continue;const l=a[i](e);l&&(e=ft(l))}}catch(a){return console.error("Error migrating record",a),{type:"error",reason:Cs.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:r}=e;const i=this.getMigrationsSince(e.schema);if(!i.ok)return console.error("Error migrating store",i.error),{type:"error",reason:Cs.MigrationError};const s=i.value;if(s.length===0)return{type:"success",value:r};r=ft(r);try{for(const o of s)if(o.scope==="record")for(const[a,c]of Object.entries(r)){if(!(o.filter?o.filter(c):!0))continue;const u=o.up(c);u&&(r[a]=ft(u))}else if(o.scope==="store"){const a=o.up(r);a&&(r=ft(a))}else wn(o)}catch(o){return console.error("Error migrating store",o),{type:"error",reason:Cs.MigrationError}}return{type:"success",value:r}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:r})=>[e,r.length?Yd(r.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const r=Hn(this.types,e);return gt(r,"record type does not exists"),r}}function wJ(n){if(!n.length)return null;let e="";for(const r of n)typeof r=="number"?e+=`.${r}`:r.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${r.slice(1)}`:e+=r:e+=`.${r}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Ye extends Error{constructor(e,r=[]){const i=wJ(r),s=e.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(r?`At ${i}: ${s}`:s),this.rawMessage=e,this.path=r}name="ValidationError"}function Yn(n,e){try{return e()}catch(r){throw r instanceof Ye?new Ye(r.rawMessage,[n,...r.path]):new Ye(r.toString(),[n])}}function zs(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:wn(e)}}class An{constructor(e,r){this.validationFn=e,this.validateUsingKnownGoodVersionFn=r}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,r){return Object.is(e,r)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,r):this.validate(r)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return kJ(this)}optional(){return yF(this)}refine(e){return new An(r=>e(this.validate(r)),(r,i)=>{const s=this.validateUsingKnownGoodVersion(r,i);return Object.is(r,s)?r:e(s)})}check(e,r){return typeof e=="string"?this.refine(i=>(Yn(`(check ${e})`,()=>r(i)),i)):this.refine(i=>(e(i),i))}}class _J extends An{constructor(e){super(r=>{const i=tR.validate(r);for(let s=0;s<i.length;s++)Yn(s,()=>e.validate(i[s]));return i},(r,i)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(i);const s=tR.validate(i);let o=r.length!==s.length;for(let a=0;a<s.length;a++){const c=s[a];if(a>=r.length){o=!0,Yn(a,()=>e.validate(c));continue}if(Object.is(r[a],c))continue;const l=Yn(a,()=>e.validateUsingKnownGoodVersion(r[a],c));Object.is(l,r[a])||(o=!0)}return o?i:r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Ye("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Ye("Expected an array with length greater than 1")})}}class Xd extends An{constructor(e,r=!1){super(i=>{if(typeof i!="object"||i===null)throw new Ye(`Expected object, got ${zs(i)}`);for(const[s,o]of Object.entries(e))Yn(s,()=>{o.validate(Hn(i,s))});if(!r){for(const s of Object.keys(i))if(!yi(e,s))throw new Ye("Unexpected property",[s])}return i},(i,s)=>{if(typeof s!="object"||s===null)throw new Ye(`Expected object, got ${zs(s)}`);let o=!1;for(const[a,c]of Object.entries(e)){const l=Hn(i,a),u=Hn(s,a);if(Object.is(l,u))continue;const d=Yn(a,()=>{const h=c;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(l,u):h.validate(u)});Object.is(d,l)||(o=!0)}if(!r){for(const a of Object.keys(s))if(!yi(e,a))throw new Ye("Unexpected property",[a])}for(const a of Object.keys(i))if(!yi(s,a)){o=!0;break}return o?s:i}),this.config=e,this.shouldAllowUnknownProperties=r}allowUnknownProperties(){return new Xd(this.config,!0)}extend(e){return new Xd({...this.config,...e})}}class gf extends An{constructor(e,r,i,s){super(o=>{this.expectObject(o);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,c):Yn(`(${e} = ${c})`,()=>a.validate(o))},(o,a)=>{this.expectObject(a),this.expectObject(o);const{matchingSchema:c,variant:l}=this.getMatchingSchemaAndVariant(a);return c===void 0?this.unknownValueValidation(a,l):Hn(o,e)!==Hn(a,e)?Yn(`(${e} = ${l})`,()=>c.validate(a)):Yn(`(${e} = ${l})`,()=>c.validateUsingKnownGoodVersion?c.validateUsingKnownGoodVersion(o,a):c.validate(a))}),this.key=e,this.config=r,this.unknownValueValidation=i,this.useNumberKeys=s}expectObject(e){if(typeof e!="object"||e===null)throw new Ye(`Expected an object, got ${zs(e)}`,[])}getMatchingSchemaAndVariant(e){const r=Hn(e,this.key);if(!this.useNumberKeys&&typeof r!="string")throw new Ye(`Expected a string for key "${this.key}", got ${zs(r)}`);if(this.useNumberKeys&&!Number.isFinite(Number(r)))throw new Ye(`Expected a number for key "${this.key}", got "${r}"`);return{matchingSchema:yi(this.config,r)?this.config[r]:void 0,variant:r}}validateUnknownVariants(e){return new gf(this.key,this.config,e,this.useNumberKeys)}}class CJ extends An{constructor(e,r){super(i=>{if(typeof i!="object"||i===null)throw new Ye(`Expected object, got ${zs(i)}`);for(const[s,o]of Object.entries(i))Yn(s,()=>{e.validate(s),r.validate(o)});return i},(i,s)=>{if(typeof s!="object"||s===null)throw new Ye(`Expected object, got ${zs(s)}`);let o=!1;for(const[a,c]of Object.entries(s)){if(!yi(i,a)){o=!0,Yn(a,()=>{e.validate(a),r.validate(c)});continue}const l=Hn(i,a),u=c;if(Object.is(l,u))continue;const d=Yn(a,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(l,u):r.validate(u));Object.is(d,l)||(o=!0)}for(const a of Object.keys(i))if(!yi(s,a)){o=!0;break}return o?s:i}),this.keyValidator=e,this.valueValidator=r}}function __(n){return new An(e=>{if(typeof e!==n)throw new Ye(`Expected ${n}, got ${zs(e)}`);return e})}const PJ=new An(n=>n),ze=__("string"),Oe=__("number").check(n=>{if(Number.isNaN(n))throw new Ye("Expected a number, got NaN");if(!Number.isFinite(n))throw new Ye(`Expected a finite number, got ${n}`)}),Zd=Oe.check(n=>{if(n<0)throw new Ye(`Expected a positive number, got ${n}`)}),Ft=Oe.check(n=>{if(n<=0)throw new Ye(`Expected a non-zero positive number, got ${n}`)}),mF=Oe.check(n=>{if(!Number.isInteger(n))throw new Ye(`Expected an integer, got ${n}`)}),Pd=mF.check(n=>{if(n<0)throw new Ye(`Expected a positive integer, got ${n}`)}),IJ=mF.check(n=>{if(n<=0)throw new Ye(`Expected a non-zero positive integer, got ${n}`)}),Ue=__("boolean");function _n(n){return new An(e=>{if(e!==n)throw new Ye(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const tR=new An(n=>{if(!Array.isArray(n))throw new Ye(`Expected an array, got ${zs(n)}`);return n});function sn(n){return new _J(n)}function He(n){return new Xd(n)}function gw(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===sJ)}function mw(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(mw):gw(n)?Object.values(n).every(mw):!1}const on=new An(n=>{if(mw(n))return n;throw new Ye(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let r=n.length!==e.length;for(let i=0;i<e.length;i++){if(i>=n.length){r=!0,on.validate(e[i]);continue}const s=n[i],o=e[i];if(Object.is(s,o))continue;const a=on.validateUsingKnownGoodVersion(s,o);Object.is(a,s)||(r=!0)}return r?e:n}else if(gw(n)&&gw(e)){let r=!1;for(const i of Object.keys(e)){if(!yi(n,i)){r=!0,on.validate(e[i]);continue}const s=n[i],o=e[i];if(Object.is(s,o))continue;const a=on.validateUsingKnownGoodVersion(s,o);Object.is(a,s)||(r=!0)}for(const i of Object.keys(n))if(!yi(e,i)){r=!0;break}return r?e:n}else return on.validate(e)});function Qd(n,e){return new CJ(n,e)}function C_(n,e){return new gf(n,e,(r,i)=>{throw new Ye(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(i)}`,[n])},!1)}function EJ(n,e){return new gf(n,e,(r,i)=>{throw new Ye(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(i)}`,[n])},!0)}function Ti(n,e){return new An(r=>Yn(n,()=>e.validate(r)),(r,i)=>Yn(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(r,i):e.validate(i)))}function mf(n){return new An(e=>{if(!n.has(e)){const r=Array.from(n,i=>JSON.stringify(i)).join(" or ");throw new Ye(`Expected ${r}, got ${e}`)}return e})}function yF(n){return new An(e=>{if(e!==void 0)return n.validate(e)},(e,r)=>{if(!(e===void 0&&r===void 0)&&r!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,r):n.validate(r)})}function kJ(n){return new An(e=>e===null?null:n.validate(e),(e,r)=>r===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,r):n.validate(r))}function yf(...n){return mf(new Set(n))}function P_(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new Ye(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new Ye(`Expected a valid url, got ${JSON.stringify(n)}`)}}const TJ=new Set(["http:","https:","mailto:"]),lr=ze.check(n=>{if(n==="")return;const e=P_(n);if(!TJ.has(e.protocol.toLowerCase()))throw new Ye(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),MJ=new Set(["http:","https:","data:","asset:"]),Co=ze.check(n=>{if(n==="")return;const e=P_(n);if(!MJ.has(e.protocol.toLowerCase()))throw new Ye(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});ze.check(n=>{if(n==="")return;if(!P_(n).protocol.toLowerCase().match(/^https?:$/))throw new Ye(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const I_=ze.refine(n=>{try{return YQ(n),n}catch{throw new Ye(`Expected an index key, got ${JSON.stringify(n)}`)}});function or(n){return ze.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const vf=or("asset");function E_(n,e){return He({id:vf,typeName:_n("asset"),type:_n(n),props:e,meta:on})}const Po=He({x:Oe,y:Oe,z:Oe.optional()}),nl=He({x:Oe,y:Oe,w:Oe,h:Oe});let vF=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");const xF=Oe.check(n=>{if(n<0||n>1)throw new Ye("Opacity must be between 0 and 1")}),AJ=ze.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),wr=or("shape");function jJ(n,e,r){return He({id:wr,typeName:_n("shape"),x:Oe,y:Oe,rotation:Oe,index:I_,parentId:AJ,type:_n(n),isLocked:Ue,opacity:xF,props:e?He(e):on,meta:r?He(r):on})}const RJ=or("binding");function OJ(n,e,r){return He({id:RJ,typeName:_n("binding"),type:_n(n),fromId:wr,toId:wr,props:e?He(e):on,meta:r?He(r):on})}Zn("com.tldraw.binding",{});hr({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function yo(n){return`binding:${vF()}`}function DJ(n){return ki("binding",{scope:"document",validator:Ti("binding",C_("type",tu(n,(e,{props:r,meta:i})=>OJ(e,r,i))))}).withDefaultProperties(()=>({meta:{}}))}class ln{constructor(e,r,i){this.id=e,this.defaultValue=r,this.type=i}static define(e,r){const{defaultValue:i,type:s=PJ}=r;return new ln(e,i,s)}static defineEnum(e,r){const{defaultValue:i,values:s}=r;return new NJ(e,i,s)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,r){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,r):this.validate(r)}}class NJ extends ln{constructor(e,r,i){super(e,r,yf(...i)),this.values=i}}const $u=Zn("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),LJ=hr({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:$u.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:$u.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:$u.AddMeta,up:n=>{n.meta={}}},{id:$u.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function ua(n){return n?n.typeName==="shape":!1}function zn(n){return n?n.startsWith("shape:"):!1}function it(n){return`shape:${n??vF()}`}function bF(n){const e=new Map;for(const[r,i]of Object.entries(n))if(i instanceof ln){if(e.has(i))throw new Error(`Duplicate style prop ${i.id}. Each style prop can only be used once within a shape.`);e.set(i,r)}return e}function ni(n,e){return tu(e,(r,i)=>`com.tldraw.shape.${n}/${i}`)}function FJ(n){return ki("shape",{scope:"document",validator:Ti("shape",C_("type",tu(n,(e,{props:r,meta:i})=>jJ(e,r,i))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function nR(n,e){const r=[];for(const[i,{migrations:s}]of Object.entries(e)){const o=`com.tldraw.${n}.${i}`;s?"sequenceId"in s?(gt(o===s.sequenceId,`sequenceId mismatch for ${i} ${pf} migrations. Expected '${o}', got '${s.sequenceId}'`),r.push(s)):"sequence"in s?r.push(xa({sequenceId:o,retroactive:!1,sequence:s.sequence.map(a=>"id"in a?SF(n,i,a):a)})):r.push(xa({sequenceId:o,retroactive:!1,sequence:Object.keys(s.migrators).map(a=>Number(a)).sort((a,c)=>a-c).map(a=>({id:`${o}/${a}`,scope:"record",filter:c=>c.typeName===n&&c.type===i,up:c=>{const l=s.migrators[a].up(c);if(l)return l},down:c=>{const l=s.migrators[a].down(c);if(l)return l}}))})):r.push(xa({sequenceId:o,retroactive:!1,sequence:[]}))}return r}function SF(n,e,r){return{id:r.id,dependsOn:r.dependsOn,scope:"record",filter:i=>i.typeName===n&&i.type===e,up:i=>{const s=r.up(i.props);s&&(i.props=s)},down:typeof r.down=="function"?i=>{const s=r.down(i.props);s&&(i.props=s)}:void 0}}const wF=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],Jd={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function ds(n){return n.isDarkMode?Jd.darkMode:Jd.lightMode}const ur=ln.defineEnum("tldraw:color",{defaultValue:"black",values:wF}),_F=ln.defineEnum("tldraw:labelColor",{defaultValue:"black",values:wF}),Io=ln.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Eo=ln.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Si=ln.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),CF={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},wi=ln.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),PF=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],eh=ln.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:PF}),th=ln.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:PF}),IF={labelColor:_F,color:ur,fill:Eo,dash:Io,size:wi,arrowheadStart:eh,arrowheadEnd:th,font:Si,start:Po,end:Po,bend:Oe,text:ze,labelPosition:Oe,scale:Ft},na=ni("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Bu(n){return SF("shape","arrow",n)}const EF=xa({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Bu({id:na.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),Bu({id:na.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Bu({id:na.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:na.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(r=>r.typeName==="shape"&&r.type==="arrow");for(const r of e){const{start:i,end:s}=r.props;if(i.type==="binding"){const o=yo(),a={typeName:"binding",id:o,type:"arrow",fromId:r.id,toId:i.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};n[o]=a,r.props.start={x:0,y:0}}else delete r.props.start.type;if(s.type==="binding"){const o=yo(),a={typeName:"binding",id:o,type:"arrow",fromId:r.id,toId:s.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};n[o]=a,r.props.end={x:0,y:0}}else delete r.props.end.type}}},Bu({id:na.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),kF={terminal:yf("start","end"),normalizedAnchor:Po,isExact:Ue,isPrecise:Ue},TF={sequence:[{dependsOn:[na.ExtractBindings]}]},zJ=Ti("camera",He({typeName:_n("camera"),id:or("camera"),x:Oe,y:Oe,z:Oe,meta:on})),$J=Zn("com.tldraw.camera",{AddMeta:1}),BJ=hr({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:$J.AddMeta,up:n=>{n.meta={}}}]}),hi=ki("camera",{validator:zJ,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),UJ=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),MF=mf(UJ),qJ=He({type:MF,rotation:Oe}),HJ=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),GJ=mf(HJ),KJ=new Set(["starting","paused","active","stopping"]),AF=He({id:ze,points:sn(Po),size:Zd,color:GJ,opacity:Oe,state:mf(KJ),delay:Oe,shrink:Oe,taper:Ue}),Cl=or("page"),VJ=Ti("page",He({typeName:_n("page"),id:Cl,name:ze,index:I_,meta:on})),WJ=Zn("com.tldraw.page",{AddMeta:1}),YJ=hr({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:WJ.AddMeta,up:n=>{n.meta={}}}]}),ts=ki("page",{validator:VJ,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Ln(n){return ts.isId(n)}const XJ={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},jF=n=>n?el(n,e=>XJ[e]):null;or("instance");function ZJ(n){const e={};for(const[i,s]of n)e[i]=yF(s);const r=Ti("instance",He({typeName:_n("instance"),id:or("instance"),currentPageId:Cl,followingUserId:ze.nullable(),brush:nl.nullable(),opacityForNextShape:xF,stylesForNextShape:He(e),cursor:qJ,scribbles:sn(AF),isFocusMode:Ue,isDebugMode:Ue,isToolLocked:Ue,exportBackground:Ue,screenBounds:nl,insets:sn(Ue),zoomBrush:nl.nullable(),isPenMode:Ue,isGridMode:Ue,chatMessage:ze,isChatting:Ue,highlightedUserIds:sn(ze),isFocused:Ue,devicePixelRatio:Oe,isCoarsePointer:Ue,isHoveringCanvas:Ue.nullable(),openMenus:sn(ze),isChangingStyle:Ue,isReadonly:Ue,meta:on,duplicateProps:He({shapeIds:sn(or("shape")),offset:He({x:Oe,y:Oe})}).nullable()}));return ki("instance",{validator:r,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const yt=Zn("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),QJ=hr({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:yt.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:yt.RemoveDialog,up:({dialog:n,...e})=>e},{id:yt.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:yt.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([r])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(r)))})},{id:yt.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:yt.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:yt.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:yt.AddZoom,up:n=>({...n,zoomBrush:null})},{id:yt.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:yt.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:yt.RemoveUserId,up:({userId:n,...e})=>e},{id:yt.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:yt.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...r})=>({...r,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:yt.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:yt.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:yt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:yt.AddMeta,up:n=>({...n,meta:{}})},{id:yt.RemoveCursorColor,up:n=>{const{color:e,...r}=n.cursor;return{...n,cursor:r}}},{id:yt.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:yt.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:yt.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:yt.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:yt.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:yt.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:yt.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),kn="instance:instance",JJ=Ti("instance_page_state",He({typeName:_n("instance_page_state"),id:or("instance_page_state"),pageId:Cl,selectedShapeIds:sn(wr),hintingShapeIds:sn(wr),erasingShapeIds:sn(wr),hoveredShapeId:wr.nullable(),editingShapeId:wr.nullable(),croppingShapeId:wr.nullable(),focusedGroupId:wr.nullable(),meta:on})),dc=Zn("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),eee=hr({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:dc.AddCroppingId,up(n){n.croppingShapeId=null}},{id:dc.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:dc.AddMeta,up:n=>{n.meta={}}},{id:dc.RenameProperties,up:n=>{},down:n=>{}},{id:dc.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Vr=ki("instance_page_state",{validator:JJ,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),tee=Ti("pointer",He({typeName:_n("pointer"),id:or("pointer"),x:Oe,y:Oe,lastActivityTimestamp:Oe,meta:on})),nee=Zn("com.tldraw.pointer",{AddMeta:1}),ree=hr({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:nee.AddMeta,up:n=>{n.meta={}}}]}),k_=ki("pointer",{validator:tee,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),nh=k_.createId("pointer"),iee=Ti("instance_presence",He({typeName:_n("instance_presence"),id:or("instance_presence"),userId:ze,userName:ze,lastActivityTimestamp:Oe,followingUserId:ze.nullable(),cursor:He({x:Oe,y:Oe,type:MF,rotation:Oe}),color:ze,camera:He({x:Oe,y:Oe,z:Oe}),screenBounds:nl,selectedShapeIds:sn(or("shape")),currentPageId:or("page"),brush:nl.nullable(),scribbles:sn(AF),chatMessage:ze,meta:on})),hc=Zn("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),see=hr({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:hc.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:hc.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:hc.AddChatMessage,up:n=>{n.chatMessage=""}},{id:hc.AddMeta,up:n=>{n.meta={}}},{id:hc.RenameSelectedShapeIds,up:n=>{}}]}),oee=ki("instance_presence",{validator:iee,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),aee=Ti("document",He({typeName:_n("document"),id:_n("document:document"),gridSize:Oe,name:ze,meta:on})),rR=Zn("com.tldraw.document",{AddName:1,AddMeta:2}),cee=hr({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:rR.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:rR.AddMeta,up:n=>{n.meta={}}}]}),T_=ki("document",{validator:aee,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),yw=T_.createId("document");function lee(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function iR(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const uee=({error:n,phase:e,record:r,recordBefore:i})=>{throw p_(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:i?iR(ft(i)):void 0,recordAfter:iR(ft(r))}}),n};function dee(){return[ts.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function hee(n){const e=n.query.ids("page"),r=()=>{if(!n.has(yw))return n.put([T_.create({id:yw,name:n.props.defaultName})]),r();if(!n.has(nh))return n.put([k_.create({id:nh})]),r();const i=e.get();if(i.size===0)return n.put(dee()),r();const s=()=>[...i].map(l=>n.get(l)).sort(lee)[0].id,o=n.get(kn);if(o){if(!i.has(o.currentPageId))return n.put([{...o,currentPageId:s()}]),r()}else return n.put([n.schema.types.instance.create({id:kn,currentPageId:s(),exportBackground:!0})]),r();const a=new Set,c=new Set;for(const l of i){const u=Vr.createId(l);n.has(u)||a.add(u);const d=hi.createId(l);n.has(d)||c.add(d)}a.size>0&&n.put([...a].map(l=>Vr.create({id:l,pageId:Vr.parseId(l)}))),c.size>0&&n.put([...c].map(l=>hi.create({id:l})))};return r}const fee=E_("bookmark",He({title:ze,description:ze,image:ze,favicon:ze,src:Co.nullable()})),sR=Zn("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),pee=hr({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:sR.MakeUrlsValid,up:n=>{Co.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:sR.AddFavicon,up:n=>{Co.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),gee=E_("image",He({w:Oe,h:Oe,name:ze,isAnimated:Ue,mimeType:ze.nullable(),src:Co.nullable(),fileSize:Ft.optional()})),fc=Zn("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),mee=hr({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:fc.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:fc.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:fc.MakeUrlsValid,up:n=>{Co.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:fc.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:fc.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),yee=E_("video",He({w:Oe,h:Oe,name:ze,isAnimated:Ue,mimeType:ze.nullable(),src:Co.nullable(),fileSize:Oe.optional()})),pc=Zn("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),vee=hr({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:pc.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:pc.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:pc.MakeUrlsValid,up:n=>{Co.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:pc.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:pc.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),xee=Ti("asset",C_("type",{image:gee,video:yee,bookmark:fee})),bee=Zn("com.tldraw.asset",{AddMeta:1}),See=hr({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:bee.AddMeta,up:n=>{n.meta={}}}]}),uo=ki("asset",{validator:xee,scope:"document"}).withDefaultProperties(()=>({meta:{}})),RF={w:Ft,h:Ft,assetId:vf.nullable(),url:lr},oR=ni("bookmark",{NullAssetId:1,MakeUrlsValid:2}),OF={sequence:[{id:oR.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:oR.MakeUrlsValid,up:n=>{lr.isValid(n.url)||(n.url="")},down:n=>{}}]},DF=He({type:yf("free","straight"),points:sn(Po)}),NF={color:ur,fill:Eo,dash:Io,size:wi,segments:sn(DF),isComplete:Ue,isClosed:Ue,isPen:Ue,scale:Ft},aR=ni("draw",{AddInPen:1,AddScale:2}),LF={sequence:[{id:aR.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let r=!(e[0].z===0||e[0].z===.5);e[1]&&(r=r&&!(e[1].z===0||e[1].z===.5)),n.isPen=r},down:"retired"},{id:aR.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]};var wee={};const cR=/(^\/r\/[^/]+\/?$)/,et=n=>{try{return new URL(n)}catch{return}},nu=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(cR))return n},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(cR))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const r=e.searchParams.get("url");if(r)return r}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let r;if(e){const[,i,s,o]=e;r=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${wee.NEXT_PUBLIC_GC_API_KEY}&center=${i},${s}&zoom=${o}`}else r="";return r}},fromEmbedUrl:n=>{const e=et(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const i=e.searchParams.get("zoom"),[s,o]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${o},${i}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=et(n),r=e&&e.pathname.match(/\/v\/(.+)\/?/);if(r)return`https://www.val.town/embed/${r[1]}`},fromEmbedUrl:n=>{const e=et(n),r=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(r)return`https://www.val.town/v/${r[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=et(n),r=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(r)return`https://codesandbox.io/embed/${r[1]}`},fromEmbedUrl:n=>{const e=et(n),r=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(r)return`https://codesandbox.io/s/${r[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,r=n.match(e);if(r){const[i,s,o]=r;return`https://codepen.io/${s}/embed/${o}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,r=n.match(e);if(r){const[i,s,o]=r;return`https://codepen.io/${s}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,r=n.match(e);if(r){const[i,s]=r;return`https://scratch.mit.edu/projects/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,r=n.match(e);if(r){const[i,s]=r;return`https://scratch.mit.edu/projects/${s}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=et(n);if(!e)return;const r=e.hostname.replace(/^www./,"");if(r==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((r==="youtube.com"||r==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=et(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const i=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(i)return`https://www.youtube.com/watch?v=${i[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=et(n),r=e?.searchParams.get("cid");if(e?.pathname.match(/\/calendar\/u\/0/)&&r){e.pathname="/calendar/embed";const i=Array.from(e.searchParams.keys());for(const s of i)e.searchParams.delete(s);return e.searchParams.set("src",r),e.href}},fromEmbedUrl:n=>{const e=et(n),r=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&r){e.pathname="/calendar/u/0";const i=Array.from(e.searchParams.keys());for(const s of i)e.searchParams.delete(s);return e.searchParams.set("cid",r),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=et(n);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/pub\/?$/)){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.href}},fromEmbedUrl:n=>{const e=et(n);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=et(n);if(e&&e.hostname==="player.vimeo.com"){const r=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(r)return"https://vimeo.com/"+r[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=et(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const r=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${r}?cell=*`}},fromEmbedUrl:n=>{const e=et(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=et(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=et(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],_ee={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},FF={w:Ft,h:Ft,url:ze},Uu=ni("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),zF={sequence:[{id:Uu.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,r=new URL(e).host.replace("www.","");let i;for(const s of nu)if(s.hostnames.includes(r))try{i=s.fromEmbedUrl(e)}catch(o){console.warn(o)}n.tmpOldUrl=n.url,n.url=i??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:Uu.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:Uu.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:Uu.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},$F={w:Ft,h:Ft,name:ze},BF={sequence:[]},rh=ln.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ih=ln.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Wr=ln.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),UF={geo:Wr,labelColor:_F,color:ur,fill:Eo,dash:Io,size:wi,font:Si,align:rh,verticalAlign:ih,url:lr,w:Ft,h:Ft,growY:Zd,text:ze,scale:Ft},Di=ni("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),qF={sequence:[{id:Di.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Di.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:Di.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Di.AddCheckBox,up:n=>{},down:"retired"},{id:Di.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Di.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:Di.AddCloud,up:n=>{},down:"retired"},{id:Di.MakeUrlsValid,up:n=>{lr.isValid(n.url)||(n.url="")},down:n=>{}},{id:Di.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},HF={},GF={sequence:[]},KF={color:ur,size:wi,segments:sn(DF),isComplete:Ue,isPen:Ue,scale:Ft},Cee=ni("highlight",{AddScale:1}),VF={sequence:[{id:Cee.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},Pee=He({topLeft:Po,bottomRight:Po}),WF={w:Ft,h:Ft,playing:Ue,url:lr,assetId:vf.nullable(),crop:Pee.nullable(),flipX:Ue,flipY:Ue},qu=ni("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),YF={sequence:[{id:qu.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:qu.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:qu.MakeUrlsValid,up:n=>{lr.isValid(n.url)||(n.url="")},down:n=>{}},{id:qu.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},sh=ln.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),Iee=He({id:ze,index:I_,x:Oe,y:Oe}),XF={color:ur,dash:Io,size:wi,spline:sh,points:Qd(ze,Iee),scale:Ft},gc=ni("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),ZF={sequence:[{id:gc.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:gc.RemoveExtraHandleProps,up:n=>{n.handles=JL(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([r,i])=>({index:r,...i})).sort(bn);n.handles=Object.fromEntries(e.map((r,i)=>{const s=i===0?"start":i===e.length-1?"end":`handle:${r.index}`;return[s,{id:s,type:"vertex",canBind:!1,canSnap:!0,index:r.index,x:r.x,y:r.y}]}))}},{id:gc.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([r,{x:i,y:s}])=>({x:i,y:s,index:r})).sort(bn);n.points=e.map(({x:r,y:i})=>({x:r,y:i})),delete n.handles},down:n=>{const e=_l(n.points.length);n.handles=Object.fromEntries(n.points.map((r,i)=>[e[i],{x:r.x,y:r.y}])),delete n.points}},{id:gc.PointIndexIds,up:n=>{const e=_l(n.points.length);n.points=Object.fromEntries(n.points.map((r,i)=>{const s=e[i];return[s,{id:s,index:s,x:r.x,y:r.y}]}))},down:n=>{const e=Object.values(n.points).sort(bn);n.points=e.map(({x:r,y:i})=>({x:r,y:i}))}},{id:gc.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},QF={color:ur,size:wi,font:Si,fontSizeAdjustment:Zd,align:rh,verticalAlign:ih,growY:Zd,url:lr,text:ze,scale:Ft},ro=ni("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),JF={sequence:[{id:ro.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:ro.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ro.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:ro.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:ro.MakeUrlsValid,up:n=>{lr.isValid(n.url)||(n.url="")},down:n=>{}},{id:ro.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:ro.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},vw=ln.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),ez={color:ur,size:wi,font:Si,textAlign:vw,w:Ft,text:ze,scale:Ft,autoSize:Ue},lR=ni("text",{RemoveJustify:1,AddTextAlign:2}),tz={sequence:[{id:lR.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:lR.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},nz={w:Ft,h:Ft,time:Oe,playing:Ue,url:lr,assetId:vf.nullable()},uR=ni("video",{AddUrlProp:1,MakeUrlsValid:2}),rz={sequence:[{id:uR.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:uR.MakeUrlsValid,up:n=>{lr.isValid(n.url)||(n.url="")},down:n=>{}}]},Hu=Zn("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),Eee=xa({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Hu.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,r]of Wn(n))r.typeName==="shape"&&(r.type==="icon"||r.type==="code")&&delete n[e]}},{id:Hu.AddInstancePresenceType,scope:"store",up(n){}},{id:Hu.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,r]of Wn(n))r.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:Hu.RemoveUserDocument,scope:"store",up:n=>{for(const[e,r]of Wn(n))r.typeName.match("user_document")&&delete n[e]}}]}),kee={arrow:{migrations:EF,props:IF},bookmark:{migrations:OF,props:RF},draw:{migrations:LF,props:NF},embed:{migrations:zF,props:FF},frame:{migrations:BF,props:$F},geo:{migrations:qF,props:UF},group:{migrations:GF,props:HF},highlight:{migrations:VF,props:KF},image:{migrations:YF,props:WF},line:{migrations:ZF,props:XF},note:{migrations:JF,props:QF},text:{migrations:tz,props:ez},video:{migrations:rz,props:nz}},Tee={arrow:{migrations:TF,props:kF}};function Mee({shapes:n=kee,bindings:e=Tee,migrations:r}={}){const i=new Map;for(const c of jt(n))for(const l of bF(c.props??{}).keys()){if(i.has(l.id)&&i.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);i.set(l.id,l)}const s=FJ(n),o=DJ(e),a=ZJ(i);return w_.create({asset:uo,binding:o,camera:hi,document:T_,instance:a,instance_page_state:Vr,page:ts,instance_presence:oee,pointer:k_,shape:s},{migrations:[Eee,See,BJ,cee,QJ,eee,YJ,see,ree,LJ,pee,mee,vee,...nR("shape",n),...nR("binding",e),...r??[]],onValidationFailure:uee,createIntegrityChecker:hee})}const Pl=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function Aee(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return jee(n)}function jee(n){for(const e of n){const r=Ree(e);if(r)return r}return"en"}const dR={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Ree(n){const e=Pl.find(s=>s.locale===n.toLowerCase());if(e)return e.locale;const[r,i]=n.split(/[-_]/).map(s=>s.toLowerCase());if(i){const s=Pl.find(o=>o.locale===r);if(s)return s.locale}return r in dR?dR[r]:null}function xf(n,e){const r=nt.useRef(e);r.current=e;const[i,s,o]=nt.useMemo(()=>{let a=null;const c=d=>(a=d,()=>{a=null}),l=new Va(`useStateTracking(${n})`,()=>r.current?.(),{scheduleEffect(){a?.()}});return[l,c,()=>l.scheduleCount]},[n]);return nt.useSyncExternalStore(s,o,o),nt.useEffect(()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()}),[i]),i.execute()}const hR={apply(n,e,r){return xf(n.displayName??n.name??"tracked(???)",()=>n.apply(e,r))}},Oee=Symbol.for("react.memo"),Dee=Symbol.for("react.forward_ref");function Qt(n){let e=null;const r=n.$$typeof;return r===Oee&&(n=n.type,e=n.compare),r===Dee?E.memo(E.forwardRef(new Proxy(n.render,hR))):E.memo(new Proxy(n,hR),e)}function Nee(){const n=arguments[0],e=arguments[1],r=arguments.length===3?void 0:arguments[2],i=arguments.length===3?arguments[2]:arguments[3];return E.useMemo(()=>oe(`useComputed(${n})`,e,r),i)}function Rs(n,e,r=Yi){E.useEffect(()=>{const i=new Va(n,e);return i.attach(),i.execute(),()=>{i.detach()}},r)}function ne(){const n=arguments,e=n.length===3?n[2]:[n[0]],r=n.length===3?n[0]:`useValue(${n[0].name})`,i=E.useRef(!0);i.current=!0;const s=E.useMemo(()=>n.length===1?n[0]:oe(r,()=>{if(i.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:a}=E.useMemo(()=>({subscribe:c=>$o(`useValue(${r})`,()=>{s.get(),c()}),getSnapshot:()=>s.get()}),[s]);return E.useSyncExternalStore(o,a,a)}finally{i.current=!1}}var sS={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var fR;function Lee(){return fR||(fR=1,(function(n){(function(){var e={}.hasOwnProperty;function r(){for(var o="",a=0;a<arguments.length;a++){var c=arguments[a];c&&(o=s(o,i(c)))}return o}function i(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return r.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var c in o)e.call(o,c)&&o[c]&&(a=s(a,c));return a}function s(o,a){return a?o?o+" "+a:o+a:o}n.exports?(r.default=r,n.exports=r):window.classNames=r})()})(sS)),sS.exports}var Fee=Lee();const Me=rs(Fee),iz="2.4.6",pR={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z"},zee={error:null};class sz extends E.Component{static getDerivedStateFromError(e){return{error:e}}state=zee;componentDidCatch(e){this.props.onError?.(e)}render(){const{error:e}=this.state;if(e!==null){const{fallback:r}=this.props;return f.jsx(r,{error:e})}return this.props.children}}function Il({children:n,fallback:e,...r}){return e===null?n:f.jsx(sz,{fallback:e,...r,children:n})}const bf=E.createContext(null);function Z(){const n=nt.useContext(bf);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function $ee(){return f.jsx("div",{className:"tl-background"})}function Wa(n,e,r,i,s,o){E.useLayoutEffect(()=>{const a=n.current;if(!a||e===void 0)return;let c=`translate(${e}px, ${r}px)`;i!==void 0&&(c+=` scale(${i})`),s!==void 0&&(c+=` rotate(${s}rad)`),o&&(c+=` translate(${o.x}px, ${o.y}px)`),a.style.transform=c})}const Wt={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class k{constructor(e=0,r=0,i=1){this.x=e,this.y=r,this.z=i}get pressure(){return this.z}set(e=this.x,r=this.y,i=this.z){return this.x=e,this.y=r,this.z=i,this}setTo({x:e=0,y:r=0,z:i=1}){return this.x=e,this.y=r,this.z=i,this}rot(e){if(e===0)return this;const{x:r,y:i}=this,s=Math.sin(e),o=Math.cos(e);return this.x=r*o-i*s,this.y=r*s+i*o,this}rotWith(e,r){if(r===0)return this;const i=this.x-e.x,s=this.y-e.y,o=Math.sin(r),a=Math.cos(r);return this.x=e.x+(i*a-s*o),this.y=e.y+(i*o+s*a),this}clone(){const{x:e,y:r,z:i}=this;return new k(e,r,i)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,r){return this.x-=e,this.y-=r,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,r){return this.x+=e,this.y+=r,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,r){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),r!==void 0&&(this.x=Math.min(this.x,r),this.y=Math.min(this.y,r)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,r){const i=k.Tan(e,this);return this.add(i.mul(r))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return k.Dpr(this,e)}cpr(e){return k.Cpr(this,e)}len2(){return k.Len2(this)}len(){return k.Len(this)}pry(e){return k.Pry(this,e)}per(){const{x:e,y:r}=this;return this.x=r,this.y=-e,this}uni(){return k.Uni(this)}tan(e){return k.Tan(this,e)}dist(e){return k.Dist(this,e)}distanceToLineSegment(e,r){return k.DistanceToLineSegment(e,r,this)}slope(e){return k.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return k.Angle(this,e)}toAngle(){return k.ToAngle(this)}lrp(e,r){return this.x=this.x+(e.x-this.x)*r,this.y=this.y+(e.y-this.y)*r,this}equals(e){return k.Equals(this,e)}equalsXY(e,r){return k.EqualsXY(this,e,r)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return k.ToFixed(this)}toString(){return k.ToString(k.ToFixed(this))}toJson(){return k.ToJson(this)}toArray(){return k.ToArray(this)}static Add(e,r){return new k(e.x+r.x,e.y+r.y)}static AddXY(e,r,i){return new k(e.x+r,e.y+i)}static Sub(e,r){return new k(e.x-r.x,e.y-r.y)}static SubXY(e,r,i){return new k(e.x-r,e.y-i)}static AddScalar(e,r){return new k(e.x+r,e.y+r)}static SubScalar(e,r){return new k(e.x-r,e.y-r)}static Div(e,r){return new k(e.x/r,e.y/r)}static Mul(e,r){return new k(e.x*r,e.y*r)}static DivV(e,r){return new k(e.x/r.x,e.y/r.y)}static MulV(e,r){return new k(e.x*r.x,e.y*r.y)}static Neg(e){return new k(-e.x,-e.y)}static Per(e){return new k(e.y,-e.x)}static Abs(e){return new k(Math.abs(e.x),Math.abs(e.y))}static Dist(e,r){return((e.y-r.y)**2+(e.x-r.x)**2)**.5}static DistMin(e,r,i){return(e.x-r.x)*(e.x-r.x)+(e.y-r.y)*(e.y-r.y)<i**2}static Dist2(e,r){return(e.x-r.x)*(e.x-r.x)+(e.y-r.y)*(e.y-r.y)}static Dpr(e,r){return e.x*r.x+e.y*r.y}static Cross(e,r){return new k(e.y*r.z-e.z*r.y,e.z*r.x-e.x*r.z)}static Cpr(e,r){return e.x*r.y-r.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,r){return k.Dpr(e,r)/k.Len(r)}static Uni(e){return k.Div(e,k.Len(e))}static Tan(e,r){return k.Uni(k.Sub(e,r))}static Min(e,r){return new k(Math.min(e.x,r.x),Math.min(e.y,r.y))}static Max(e,r){return new k(Math.max(e.x,r.x),Math.max(e.y,r.y))}static From({x:e,y:r,z:i=1}){return new k(e,r,i)}static FromArray(e){return new k(e[0],e[1])}static Rot(e,r=0){const i=Math.sin(r),s=Math.cos(r);return new k(e.x*s-e.y*i,e.x*i+e.y*s)}static RotWith(e,r,i){const s=e.x-r.x,o=e.y-r.y,a=Math.sin(i),c=Math.cos(i);return new k(r.x+(s*c-o*a),r.y+(s*a+o*c))}static NearestPointOnLineThroughPoint(e,r,i){return k.Mul(r,k.Sub(i,e).pry(r)).add(e)}static NearestPointOnLineSegment(e,r,i,s=!0){if(k.Equals(e,i)||k.Equals(r,i))return k.From(i);const o=k.Tan(r,e),a=k.Add(e,k.Mul(o,k.Sub(i,e).pry(o)));if(s){if(a.x<Math.min(e.x,r.x))return k.Cast(e.x<r.x?e:r);if(a.x>Math.max(e.x,r.x))return k.Cast(e.x>r.x?e:r);if(a.y<Math.min(e.y,r.y))return k.Cast(e.y<r.y?e:r);if(a.y>Math.max(e.y,r.y))return k.Cast(e.y>r.y?e:r)}return a}static DistanceToLineThroughPoint(e,r,i){return k.Dist(i,k.NearestPointOnLineThroughPoint(e,r,i))}static DistanceToLineSegment(e,r,i,s=!0){return k.Dist(i,k.NearestPointOnLineSegment(e,r,i,s))}static Snap(e,r=1){return new k(Math.round(e.x/r)*r,Math.round(e.y/r)*r)}static Cast(e){return e instanceof k?e:k.From(e)}static Slope(e,r){return e.x===r.y?NaN:(e.y-r.y)/(e.x-r.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,r){return Math.atan2(r.y-e.y,r.x-e.x)}static Lrp(e,r,i){return k.Sub(r,e).mul(i).add(e)}static Med(e,r){return new k((e.x+r.x)/2,(e.y+r.y)/2)}static Equals(e,r){return Math.abs(e.x-r.x)<1e-4&&Math.abs(e.y-r.y)<1e-4}static EqualsXY(e,r,i){return e.x===r&&e.y===i}static Clockwise(e,r,i){return(i.x-e.x)*(r.y-e.y)-(r.x-e.x)*(i.y-e.y)<0}static Rescale(e,r){const i=k.Len(e);return new k(r*e.x/i,r*e.y/i)}static ScaleWithOrigin(e,r,i){return k.Sub(e,i).mul(r).add(i)}static ToFixed(e){return new k(Hi(e.x),Hi(e.y))}static ToInt(e){return new k(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,r,i){return k.Add(e,k.Tan(r,e).mul(i))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let r=Math.atan2(e.y,e.x);return r<0&&(r+=Math.PI*2),r}static FromAngle(e,r=1){return new k(Math.cos(e)*r,Math.sin(e)*r)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:r,y:i,z:s}=e;return{x:r,y:i,z:s}}static Average(e){const r=e.length,i=new k(0,0);if(r===0)return i;for(let s=0;s<r;s++)i.add(e[s]);return i.div(r)}static Clamp(e,r,i){return i===void 0?new k(Math.min(Math.max(e.x,r)),Math.min(Math.max(e.y,r))):new k(Math.min(Math.max(e.x,r),i),Math.min(Math.max(e.y,r),i))}static PointsBetween(e,r,i=6){const s=[];for(let o=0;o<i;o++){const a=Wt.easeInQuad(o/(i-1)),c=k.Lrp(e,r,a);c.z=Math.min(1,.5+Math.abs(.5-Bee(a))*.65),s.push(c)}return s}static SnapToGrid(e,r=8){return new k(Math.round(e.x/r)*r,Math.round(e.y/r)*r)}}const Bee=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Qe(n){return`${W(n.x)},${W(n.y)} `}function Bn(n,e){return`${W((n.x+e.x)/2)},${W((n.y+e.y)/2)} `}const Je=Math.PI,pt=Je/2,rt=Je*2,Uee=Math.sin;function Ht(n,e,r){return Math.max(e,typeof r<"u"?Math.min(n,r):n)}function Gu(n,e=1e10){return n?Math.round(n*e)/e:0}function Os(n,e,r=1e-6){return Math.abs(n-e)<=r}function oz(n,e){const r=Math.pow(n-e,2)/Math.pow(n+e,2);return Je*(n+e)*(1+3*r/(10+Math.sqrt(4-3*r)))}function Ds(n){return n=n%rt,n<0?n=n+rt:n===0&&(n=0),n}function ru(n,e){return n=Ds(n),e=Ds(e),n>e&&(e+=rt),e-n}function az(n,e){return rt-ru(n,e)}function Id(n,e){const r=(e-n)%rt;return 2*r%rt-r}function xw(n){return(rt+n)%rt}function oh(n,e){const r=rt/e;let i=Math.floor((xw(n)+r/2)/r)*r%rt;return i<Je&&(i+=rt),i>Je&&(i-=rt),i}function cz(n,e){return n===e||Os(n%(Math.PI/2)-e%(Math.PI/2),0)}function qee(n){return n*Je/180}function Hee(n){return n*180/Je}function ko(n,e,r){return new k(n.x,n.y).add(k.FromAngle(r,e))}function oS(n,e,r){const i=n/2,s=e/2,o=[];let a=1/0,c=-1/0,l=1/0,u=-1/0;for(let y=0;y<r;y++){const v=rt/r,x=-pt+y*v,m=i+i*Math.cos(x),b=s+s*Math.sin(x);m<a&&(a=m),b<l&&(l=b),m>c&&(c=m),b>u&&(u=b),o.push(new k(m,b))}const d=c-a,h=u-l,p=n-d,g=e-h;if(p!==0||g!==0)for(let y=0;y<o.length;y++){const v=o[y];v.x=(v.x-a)/d*n,v.y=(v.y-l)/h*e}return o}function mc(n,e,r,i){return n<i&&r<e}function Ur(n,e,r,i){const s=Math.max(n,r),o=Math.min(e,i);return s<=o?[s,o]:null}function gR(n,e,r){return(e.x-n.x)*(r.y-n.y)-(r.x-n.x)*(e.y-n.y)}function ar(n,e){let r=0,i,s;for(let o=0;o<e.length;o++){if(i=e[o],i.x===n.x&&i.y===n.y||(s=e[(o+1)%e.length],k.Dist(n,i)+k.Dist(n,s)===k.Dist(i,s)))return!0;i.y<=n.y?s.y>n.y&&gR(i,s,n)>0&&(r+=1):s.y<=n.y&&gR(i,s,n)<0&&(r-=1)}return r!==0}function W(n){return Math.round(n*1e4)/1e4}function Hi(n){return Math.round(n*100)/100}const mR=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function Is(n,e,r){return r<0?ru(n,e):az(n,e)}function bw(n,e,r,i){let s;if(Math.abs(n)>Je){s=Id(e,i);const o=Id(i,r);return Math.abs(s)<Math.abs(o)?s/n:(n-o)/n}else{s=Id(e,i);const o=s/n;return Math.sign(s)!==Math.sign(n)?Math.abs(o)>.5?1:0:o}}function Gee(n,e,r,i){const s=2*((e-n)%rt)%rt-(e-n)%rt;return i?(rt-Math.abs(s))*(r?1:-1):s}function M_(n,e,r){const i=-2*(n.x*(e.y-r.y)-n.y*(e.x-r.x)+e.x*r.y-r.x*e.y);return new k(((n.x*n.x+n.y*n.y)*(r.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-r.y)+(r.x*r.x+r.y*r.y)*(e.y-n.y))/i,((n.x*n.x+n.y*n.y)*(e.x-r.x)+(e.x*e.x+e.y*e.y)*(r.x-n.x)+(r.x*r.x+r.y*r.y)*(n.x-e.x))/i)}function Kee(n,e,r,i,s){if(r===null)return[k.From(n),k.From(e)];const o=[],a=k.Angle(r,n),c=k.Angle(r,e),l=ru(a,c);for(let u=0;u<s;u++){const d=u/(s-1),h=a+l*d,p=ko(r,i,h);o.push(p)}return o}const aS=({brush:n,color:e,opacity:r,className:i})=>{const s=E.useRef(null);Wa(s,n.x,n.y);const o=W(Math.max(1,n.w)),a=W(Math.max(1,n.h));return f.jsx("svg",{className:"tl-overlays__item",ref:s,children:e?f.jsxs("g",{className:"tl-brush",opacity:r,children:[f.jsx("rect",{width:o,height:a,fill:e,opacity:.75}),f.jsx("rect",{width:o,height:a,fill:"none",stroke:e,opacity:.1})]}):f.jsx("rect",{className:`tl-brush tl-brush__default ${i}`,width:o,height:a})})},yR={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},cS={duration:0,easing:Wt.easeInOutCubic},vR={CAMERA_MOVE:-10},Vee=["top","right","bottom","left"],xR=0,A_=2,Ku=1,bR=5,Wee=128;function ah(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return ah(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function We(n){n.preventDefault(),Dt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function iu(n,e){if(n.setPointerCapture(e.pointerId),Dt.logPointerCaptures.get()){const r=dF.get();r.set(n,(r.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function su(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),Dt.logPointerCaptures.get())){const r=dF.get();r.get(n)===1?r.delete(n):r.has(n)?r.set(n,r.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const Xt=n=>n.stopPropagation(),gn=(n,e,r)=>{n&&n.style.setProperty(e,r)};function Gn(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function lz(){const n=Z();return E.useMemo(function(){let i,s;function o(v){if(!v.isKilled){if(v.button===A_){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Gn(v)});return}v.button!==0&&v.button!==1&&v.button!==5||(iu(v.currentTarget,v),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Gn(v)}))}}function a(v){v.isKilled||v.clientX===i&&v.clientY===s||(i=v.clientX,s=v.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Gn(v)}))}function c(v){v.isKilled||v.button!==0&&v.button!==1&&v.button!==2&&v.button!==5||(i=v.clientX,s=v.clientY,su(v.currentTarget,v),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Gn(v)}))}function l(v){if(v.isKilled||n.getInstanceState().isPenMode&&v.pointerType!=="pen")return;const x=v.pointerType==="mouse"||v.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!0:null})}function u(v){if(v.isKilled||n.getInstanceState().isPenMode&&v.pointerType!=="pen")return;const x=v.pointerType==="mouse"||v.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!1:null})}function d(v){v.isKilled=!0,We(v)}function h(v){v.isKilled=!0,v.target instanceof HTMLElement&&v.target.tagName!=="A"&&v.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&v.target.className.includes("tl-text-content"))&&We(v)}function p(v){We(v)}async function g(v){if(We(v),!v.dataTransfer?.files?.length)return;const x=Array.from(v.dataTransfer.files);await n.putExternalContent({type:"files",files:x,point:n.screenToPage({x:v.clientX,y:v.clientY}),ignoreParent:!1})}function y(v){Xt(v)}return{onPointerDown:o,onPointerMove:a,onPointerUp:c,onPointerEnter:l,onPointerLeave:u,onDragOver:p,onDrop:g,onTouchStart:d,onTouchEnd:h,onClick:y}},[n])}function Yee(){const n=Z();E.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const r=a=>{const c=a.pointerType!=="mouse";e!==c&&(e=c,n.updateInstanceState({isCoarsePointer:c}))};window.addEventListener("pointerdown",r,{capture:!0});const i=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),s=n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos,o=()=>{const a=s?!1:i.matches;e===a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};return i&&(i.addEventListener("change",o),o()),()=>{window.removeEventListener("pointerdown",r,{capture:!0}),i&&i.removeEventListener("change",o)}},[n])}const uz=E.createContext(null);function Xee({container:n,children:e}){return f.jsx(uz.Provider,{value:n,children:e})}function Jt(){return Pr(E.useContext(uz),"useContainer used outside of <Tldraw />")}function Zee(){const n=Z(),e=Jt(),r=ne("isFocused",()=>n.getIsFocused(),[n]);E.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let i=null;const s=()=>{i?.();const o=`(resolution: ${window.devicePixelRatio}dppx)`,a=matchMedia(o),c=l=>{l.type==="change"&&s()};a.addEventListener?a.addEventListener("change",s):a.addListener&&a.addListener(c),i=()=>{a.removeEventListener?a.removeEventListener("change",s):a.removeListener&&a.removeListener(c)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{i?.()}},[n]),E.useEffect(()=>{if(!r)return;const i=c=>{if(c.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!Vu()&&We(c),c.isKilled)return;switch(c.isKilled=!0,c.key){case"=":case"-":case"0":{if(c.metaKey||c.ctrlKey){We(c);return}break}case"Tab":{if(Vu()||n.getIsMenuOpen())return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&c.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),n.focus());return}default:if(Vu()||n.getIsMenuOpen())return}const l={type:"keyboard",name:c.repeat?"key_repeat":"key_down",key:c.key,code:c.code,shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey};n.dispatch(l)},s=c=>{if(c.isKilled||(c.isKilled=!0,Vu()||n.getIsMenuOpen())||c.key===",")return;const l={type:"keyboard",name:"key_up",key:c.key,code:c.code,shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey};n.dispatch(l)};function o(c){if(e.contains(c.target)){const l=c.touches[0].pageX,u=c.touches[0].radiusX||0;(l-u<10||l+u>n.getViewportScreenBounds().width-10)&&(c.target?.tagName==="BUTTON"&&c.target?.click(),We(c))}}const a=c=>{e.contains(c.target)&&(c.ctrlKey||c.metaKey)&&We(c)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",a,{passive:!1}),document.addEventListener("gesturestart",We),document.addEventListener("gesturechange",We),document.addEventListener("gestureend",We),e.addEventListener("keydown",i),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",a),document.removeEventListener("gesturestart",We),document.removeEventListener("gesturechange",We),document.removeEventListener("gestureend",We),e.removeEventListener("keydown",i),e.removeEventListener("keyup",s)}},[n,e,r])}const Qee=["input","select","button","textarea"];function Vu(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||Qee.indexOf(n.tagName.toLowerCase())>-1))}const Jee=["textarea","input"];function ete(n){const e=Z();E.useEffect(()=>{const r=n.current;if(!r)return;const i=s=>{if(s instanceof PointerEvent&&s.pointerType==="pen"){s.isKilled=!0;const{target:o}=s;if(Jee.includes(o.tagName?.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;We(s)}};return r.addEventListener("touchstart",i),r.addEventListener("touchend",i),()=>{r.removeEventListener("touchstart",i),r.removeEventListener("touchend",i)}},[e,n])}function tte(n,e,r){return Math.max(e,Math.min(n,r))}const an={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function SR(n,e,r){return e===0||Math.abs(e)===1/0?Math.pow(n,r*5):n*e*r/(e+r*n)}function wR(n,e,r,i=.15){return i===0?tte(n,e,r):n<e?-SR(e-n,r-e,i)+e:n>r?+SR(n-r,r-e,i)+r:n}function nte(n,[e,r],[i,s]){const[[o,a],[c,l]]=n;return[wR(e,o,a,i),wR(r,c,l,s)]}function rte(n,e){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ite(n){var e=rte(n,"string");return typeof e=="symbol"?e:String(e)}function yn(n,e,r){return e=ite(e),e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function _R(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,i)}return r}function Tt(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_R(Object(r),!0).forEach(function(i){yn(n,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):_R(Object(r)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(r,i))})}return n}const dz={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function CR(n){return n?n[0].toUpperCase()+n.slice(1):""}const ste=["enter","leave"];function ote(n=!1,e){return n&&!ste.includes(e)}function ate(n,e="",r=!1){const i=dz[n],s=i&&i[e]||e;return"on"+CR(n)+CR(s)+(ote(r,s)?"Capture":"")}const cte=["gotpointercapture","lostpointercapture"];function lte(n){let e=n.substring(2).toLowerCase();const r=!!~e.indexOf("passive");r&&(e=e.replace("passive",""));const i=cte.includes(e)?"capturecapture":"capture",s=!!~e.indexOf(i);return s&&(e=e.replace("capture","")),{device:e,capture:s,passive:r}}function ute(n,e=""){const r=dz[n],i=r&&r[e]||e;return n+i}function hz(n){return"touches"in n}function dte(n){return hz(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function hte(n){return Array.from(n.touches).filter(e=>{var r,i;return e.target===n.currentTarget||((r=n.currentTarget)===null||r===void 0||(i=r.contains)===null||i===void 0?void 0:i.call(r,e.target))})}function Sw(n,e){try{const r=e.clientX-n.clientX,i=e.clientY-n.clientY,s=(e.clientX+n.clientX)/2,o=(e.clientY+n.clientY)/2,a=Math.hypot(r,i);return{angle:-(Math.atan2(r,i)*180)/Math.PI,distance:a,origin:[s,o]}}catch{}return null}function fte(n){return hte(n).map(e=>e.identifier)}function PR(n,e){const[r,i]=Array.from(n.touches).filter(s=>e.includes(s.identifier));return Sw(r,i)}const IR=40,ER=800;function fz(n){let{deltaX:e,deltaY:r,deltaMode:i}=n;return i===1?(e*=IR,r*=IR):i===2&&(e*=ER,r*=ER),[e,r]}function pte(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:r,altKey:i,metaKey:s,ctrlKey:o}=n;Object.assign(e,{shiftKey:r,altKey:i,metaKey:s,ctrlKey:o})}return e}function ch(n,...e){return typeof n=="function"?n(...e):n}function gte(){}function mte(...n){return n.length===0?gte:n.length===1?n[0]:function(){let e;for(const r of n)e=r.apply(this,arguments)||e;return e}}function kR(n,e){return Object.assign({},e,n||{})}const yte=32;class pz{constructor(e,r,i){this.ctrl=e,this.args=r,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:r,ingKey:i,args:s}=this;r[i]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const r=this.state,i=this.config;r._active||(this.reset(),this.computeInitial(),r._active=!0,r.target=e.target,r.currentTarget=e.currentTarget,r.lastOffset=i.from?ch(i.from,r):r.offset,r.offset=r.lastOffset,r.startTime=r.timeStamp=e.timeStamp)}computeValues(e){const r=this.state;r._values=e,r.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:r,config:i,shared:s}=this;r.args=this.args;let o=0;if(e&&(r.event=e,i.preventDefault&&e.cancelable&&r.event.preventDefault(),r.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,pte(e)),s.down=s.pressed=s.buttons%2===1||s.touches>0,o=e.timeStamp-r.timeStamp,r.timeStamp=e.timeStamp,r.elapsedTime=r.timeStamp-r.startTime),r._active){const C=r._delta.map(Math.abs);an.addTo(r._distance,C)}this.axisIntent&&this.axisIntent(e);const[a,c]=r._movement,[l,u]=i.threshold,{_step:d,values:h}=r;if(i.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(a)>=l&&h[0]),d[1]===!1&&(d[1]=Math.abs(c)>=u&&h[1])):(d[0]===!1&&(d[0]=Math.abs(a)>=l&&Math.sign(a)*l),d[1]===!1&&(d[1]=Math.abs(c)>=u&&Math.sign(c)*u)),r.intentional=d[0]!==!1||d[1]!==!1,!r.intentional)return;const p=[0,0];if(i.hasCustomTransform){const[C,_]=h;p[0]=d[0]!==!1?C-d[0]:0,p[1]=d[1]!==!1?_-d[1]:0}else p[0]=d[0]!==!1?a-d[0]:0,p[1]=d[1]!==!1?c-d[1]:0;this.restrictToAxis&&!r._blocked&&this.restrictToAxis(p);const g=r.offset,y=r._active&&!r._blocked||r.active;y&&(r.first=r._active&&!r.active,r.last=!r._active&&r.active,r.active=s[this.ingKey]=r._active,e&&(r.first&&("bounds"in i&&(r._bounds=ch(i.bounds,r)),this.setup&&this.setup()),r.movement=p,this.computeOffset()));const[v,x]=r.offset,[[m,b],[S,w]]=r._bounds;r.overflow=[v<m?-1:v>b?1:0,x<S?-1:x>w?1:0],r._movementBound[0]=r.overflow[0]?r._movementBound[0]===!1?r._movement[0]:r._movementBound[0]:!1,r._movementBound[1]=r.overflow[1]?r._movementBound[1]===!1?r._movement[1]:r._movementBound[1]:!1;const I=r._active?i.rubberband||[0,0]:[0,0];if(r.offset=nte(r._bounds,r.offset,I),r.delta=an.sub(r.offset,g),this.computeMovement(),y&&(!r.last||o>yte)){r.delta=an.sub(r.offset,g);const C=r.delta.map(Math.abs);an.addTo(r.distance,C),r.direction=r.delta.map(Math.sign),r._direction=r._delta.map(Math.sign),!r.first&&o>0&&(r.velocity=[C[0]/o,C[1]/o],r.timeDelta=o)}}emit(){const e=this.state,r=this.shared,i=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!i.triggerAllEvents)return;const s=this.handler(Tt(Tt(Tt({},r),e),{},{[this.aliasKey]:e.values}));s!==void 0&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function vte([n,e],r){const i=Math.abs(n),s=Math.abs(e);if(i>s&&i>r)return"x";if(s>i&&s>r)return"y"}class xte extends pz{constructor(...e){super(...e),yn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=an.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=an.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const r=this.state,i=this.config;if(!r.axis&&e){const s=typeof i.axisThreshold=="object"?i.axisThreshold[dte(e)]:i.axisThreshold;r.axis=vte(r._movement,s)}r._blocked=(i.lockDirection||!!i.axis)&&!r.axis||!!i.axis&&i.axis!==r.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const bte=n=>n,TR=.15,gz={enabled(n=!0){return n},eventOptions(n,e,r){return Tt(Tt({},r.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[TR,TR];case!1:return[0,0];default:return an.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return an.toVector(n)},transform(n,e,r){const i=n||r.shared.transform;return this.hasCustomTransform=!!i,i||bte},threshold(n){return an.toVector(n,0)}},Ste=0,ou=Tt(Tt({},gz),{},{axis(n,e,{axis:r}){if(this.lockDirection=r==="lock",!this.lockDirection)return r},axisThreshold(n=Ste){return n},bounds(n={}){if(typeof n=="function")return o=>ou.bounds(n(o));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:r=1/0,top:i=-1/0,bottom:s=1/0}=n;return[[e,r],[i,s]]}}),au=typeof window<"u"&&window.document&&window.document.createElement;function mz(){return au&&"ontouchstart"in window}function wte(){return mz()||au&&window.navigator.maxTouchPoints>1}function _te(){return au&&"onpointerdown"in window}function Cte(){return au&&"exitPointerLock"in window.document}function Pte(){try{return"constructor"in GestureEvent}catch{return!1}}const Ir={isBrowser:au,gesture:Pte(),touch:mz(),touchscreen:wte(),pointer:_te(),pointerLock:Cte()},Ite=250,Ete=180,kte=.5,Tte=50,Mte=250,Ate=10,MR={mouse:0,touch:0,pen:8};Tt(Tt({},ou),{},{device(n,e,{pointer:{touch:r=!1,lock:i=!1,mouse:s=!1}={}}){return this.pointerLock=i&&Ir.pointerLock,Ir.touch&&r?"touch":this.pointerLock?"mouse":Ir.pointer&&!s?"pointer":Ir.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:r}){if(this.preventScrollDelay=typeof r=="number"?r:r||r===void 0&&n?Ite:void 0,!(!Ir.touchscreen||r===!1))return n||(r!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:r=!0,buttons:i=1,keys:s=!0}={}}){return this.pointerButtons=i,this.keys=s,!this.pointerLock&&this.device==="pointer"&&r},threshold(n,e,{filterTaps:r=!1,tapsThreshold:i=3,axis:s=void 0}){const o=an.toVector(n,r?i:s?1:0);return this.filterTaps=r,this.tapsThreshold=i,o},swipe({velocity:n=kte,distance:e=Tte,duration:r=Mte}={}){return{velocity:this.transform(an.toVector(n)),distance:this.transform(an.toVector(e)),duration:r}},delay(n=0){switch(n){case!0:return Ete;case!1:return 0;default:return n}},axisThreshold(n){return n?Tt(Tt({},MR),n):MR},keyboardDisplacement(n=Ate){return n}});function yz(n){const[e,r]=n.overflow,[i,s]=n._delta,[o,a]=n._direction;(e<0&&i>0&&o<0||e>0&&i<0&&o>0)&&(n._movement[0]=n._movementBound[0]),(r<0&&s>0&&a<0||r>0&&s<0&&a>0)&&(n._movement[1]=n._movementBound[1])}const jte=30,Rte=100;class Ote extends pz{constructor(...e){super(...e),yn(this,"ingKey","pinching"),yn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:r,lastOffset:i}=this.state;e==="wheel"?this.state.offset=an.add(r,i):this.state.offset=[(1+r[0])*i[0],r[1]+i[1]]}computeMovement(){const{offset:e,lastOffset:r}=this.state;this.state.movement=[e[0]/r[0],e[1]-r[1]]}axisIntent(){const e=this.state,[r,i]=e._movement;if(!e.axis){const s=Math.abs(r)*jte-Math.abs(i);s<0?e.axis="angle":s>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const r=this.state,i=this.ctrl.touchIds;if(r._active&&r._touchIds.every(o=>i.has(o))||i.size<2)return;this.start(e),r._touchIds=Array.from(i).slice(0,2);const s=PR(e,r._touchIds);s&&this.pinchStart(e,s)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const r=this.state,i=r._pointerEvents,s=this.ctrl.pointerIds;if(r._active&&Array.from(i.keys()).every(a=>s.has(a))||(i.size<2&&i.set(e.pointerId,e),r._pointerEvents.size<2))return;this.start(e);const o=Sw(...Array.from(i.values()));o&&this.pinchStart(e,o)}pinchStart(e,r){const i=this.state;i.origin=r.origin,this.computeValues([r.distance,r.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const r=PR(e,this.state._touchIds);r&&this.pinchMove(e,r)}pointerMove(e){const r=this.state._pointerEvents;if(r.has(e.pointerId)&&r.set(e.pointerId,e),!this.state._active)return;const i=Sw(...Array.from(r.values()));i&&this.pinchMove(e,i)}pinchMove(e,r){const i=this.state,s=i._values[1],o=r.angle-s;let a=0;Math.abs(o)>270&&(a+=Math.sign(o)),this.computeValues([r.distance,r.angle-360*a]),i.origin=r.origin,i.turns=a,i._movement=[i._values[0]/i._initial[0]-1,i._values[1]-i._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(r=>!this.ctrl.touchIds.has(r))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const r=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}r._pointerEvents.has(e.pointerId)&&r._pointerEvents.delete(e.pointerId),r._active&&r._pointerEvents.size<2&&(r._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const r=this.state;r._active||(this.start(e),this.computeValues([e.scale,e.rotation]),r.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const r=this.state;this.computeValues([e.scale,e.rotation]),r.origin=[e.clientX,e.clientY];const i=r._movement;r._movement=[e.scale-1,e.rotation],r._delta=an.sub(r._movement,i),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const r=this.config.modifierKey;r&&(Array.isArray(r)?!r.find(i=>e[i]):!e[r])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const i=this.state;i._delta=[-fz(e)[1]/Rte*i.offset[0],0],an.addTo(i._movement,i._delta),yz(i),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const r=this.config.device;r&&(e(r,"start",this[r+"Start"].bind(this)),e(r,"change",this[r+"Move"].bind(this)),e(r,"end",this[r+"End"].bind(this)),e(r,"cancel",this[r+"End"].bind(this)),e("lostPointerCapture","",this[r+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const Dte=Tt(Tt({},gz),{},{device(n,e,{shared:r,pointer:{touch:i=!1}={}}){if(r.target&&!Ir.touch&&Ir.gesture)return"gesture";if(Ir.touch&&i)return"touch";if(Ir.touchscreen){if(Ir.pointer)return"pointer";if(Ir.touch)return"touch"}},bounds(n,e,{scaleBounds:r={},angleBounds:i={}}){const s=a=>{const c=kR(ch(r,a),{min:-1/0,max:1/0});return[c.min,c.max]},o=a=>{const c=kR(ch(i,a),{min:-1/0,max:1/0});return[c.min,c.max]};return typeof r!="function"&&typeof i!="function"?[s(),o()]:a=>[s(a),o(a)]},threshold(n,e,r){return this.lockDirection=r.axis==="lock",an.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Tt(Tt({},ou),{},{mouseOnly:(n=!0)=>n});class Nte extends xte{constructor(...e){super(...e),yn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const r=this.state;r._delta=fz(e),an.addTo(r._movement,r._delta),yz(r),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const Lte=ou;Tt(Tt({},ou),{},{mouseOnly:(n=!0)=>n});const j_=new Map,ww=new Map;function Fte(n){j_.set(n.key,n.engine),ww.set(n.key,n.resolver)}const zte={key:"pinch",engine:Ote,resolver:Dte},$te={key:"wheel",engine:Nte,resolver:Lte};function Bte(n,e){if(n==null)return{};var r={},i=Object.keys(n),s,o;for(o=0;o<i.length;o++)s=i[o],!(e.indexOf(s)>=0)&&(r[s]=n[s]);return r}function Ute(n,e){if(n==null)return{};var r=Bte(n,e),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(s=0;s<o.length;s++)i=o[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(r[i]=n[i])}return r}const qte={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Ir.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},Hte=["target","eventOptions","window","enabled","transform"];function Ed(n={},e){const r={};for(const[i,s]of Object.entries(e))switch(typeof s){case"function":r[i]=s.call(r,n[i],i,n);break;case"object":r[i]=Ed(n[i],s);break;case"boolean":s&&(r[i]=n[i]);break}return r}function Gte(n,e,r={}){const i=n,{target:s,eventOptions:o,window:a,enabled:c,transform:l}=i,u=Ute(i,Hte);if(r.shared=Ed({target:s,eventOptions:o,window:a,enabled:c,transform:l},qte),e){const d=ww.get(e);r[e]=Ed(Tt({shared:r.shared},u),d)}else for(const d in u){const h=ww.get(d);h&&(r[d]=Ed(Tt({shared:r.shared},u[d]),h))}return r}class vz{constructor(e,r){yn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=r}add(e,r,i,s,o){const a=this._listeners,c=ute(r,i),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=Tt(Tt({},l),o);e.addEventListener(c,s,u);const d=()=>{e.removeEventListener(c,s,u),a.delete(d)};return a.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Kte{constructor(){yn(this,"_timeouts",new Map)}add(e,r,i=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(r,i,...s))}remove(e){const r=this._timeouts.get(e);r&&window.clearTimeout(r)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Vte{constructor(e){yn(this,"gestures",new Set),yn(this,"_targetEventStore",new vz(this)),yn(this,"gestureEventStores",{}),yn(this,"gestureTimeoutStores",{}),yn(this,"handlers",{}),yn(this,"config",{}),yn(this,"pointerIds",new Set),yn(this,"touchIds",new Set),yn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Wte(this,e)}setEventIds(e){if(hz(e))return this.touchIds=new Set(fte(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,r){this.handlers=e,this.nativeHandlers=r}applyConfig(e,r){this.config=Gte(e,r,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const r=this.config.shared,i={};let s;if(!(r.target&&(s=r.target(),!s))){if(r.enabled){for(const a of this.gestures){const c=this.config[a],l=AR(i,c.eventOptions,!!s);if(c.enabled){const u=j_.get(a);new u(this,e,a).bind(l)}}const o=AR(i,r.eventOptions,!!s);for(const a in this.nativeHandlers)o(a,"",c=>this.nativeHandlers[a](Tt(Tt({},this.state.shared),{},{event:c,args:e})),void 0,!0)}for(const o in i)i[o]=mte(...i[o]);if(!s)return i;for(const o in i){const{device:a,capture:c,passive:l}=lte(o);this._targetEventStore.add(s,a,"",i[o],{capture:c,passive:l})}}}}function Yo(n,e){n.gestures.add(e),n.gestureEventStores[e]=new vz(n,e),n.gestureTimeoutStores[e]=new Kte}function Wte(n,e){e.drag&&Yo(n,"drag"),e.wheel&&Yo(n,"wheel"),e.scroll&&Yo(n,"scroll"),e.move&&Yo(n,"move"),e.pinch&&Yo(n,"pinch"),e.hover&&Yo(n,"hover")}const AR=(n,e,r)=>(i,s,o,a={},c=!1)=>{var l,u;const d=(l=a.capture)!==null&&l!==void 0?l:e.capture,h=(u=a.passive)!==null&&u!==void 0?u:e.passive;let p=c?i:ate(i,s,d);r&&h&&(p+="Passive"),n[p]=n[p]||[],n[p].push(o)},Yte=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Xte(n){const e={},r={},i=new Set;for(let s in n)Yte.test(s)?(i.add(RegExp.lastMatch),r[s]=n[s]):e[s]=n[s];return[r,e,i]}function Xo(n,e,r,i,s,o){if(!n.has(r)||!j_.has(i))return;const a=r+"Start",c=r+"End",l=u=>{let d;return u.first&&a in e&&e[a](u),r in e&&(d=e[r](u)),u.last&&c in e&&e[c](u),d};s[i]=l,o[i]=o[i]||{}}function Zte(n,e){const[r,i,s]=Xte(n),o={};return Xo(s,r,"onDrag","drag",o,e),Xo(s,r,"onWheel","wheel",o,e),Xo(s,r,"onScroll","scroll",o,e),Xo(s,r,"onPinch","pinch",o,e),Xo(s,r,"onMove","move",o,e),Xo(s,r,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:i}}function Qte(n,e={},r,i){const s=nt.useMemo(()=>new Vte(n),[]);if(s.applyHandlers(n,i),s.applyConfig(e,r),nt.useEffect(s.effect.bind(s)),nt.useEffect(()=>s.clean.bind(s),[]),e.target===void 0)return s.bind.bind(s)}function Jte(n){return n.forEach(Fte),function(r,i){const{handlers:s,nativeHandlers:o,config:a}=Zte(r,i||{});return Qte(s,a,void 0,o)}}const jR=10,ene=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function xz(n){let{deltaY:e,deltaX:r}=n,i=0;return n.ctrlKey||n.altKey||n.metaKey?i=(Math.abs(e)>jR?jR*Math.sign(e):e)/100:n.shiftKey&&!ene&&(r=e,e=0),{x:-r,y:-e,z:-i}}const tne=Jte([$te,zte]);let Zo;const nne=n=>Zo===void 0?(Zo=n,!1):n-Zo>120&&n-Zo<160?(Zo=n,!0):(Zo=n,!1);function rne(n){const e=Z(),r=E.useMemo(()=>{let i="not sure";const s=({event:v})=>{if(!e.getInstanceState().isFocused||(i="not sure",nne(Date.now())))return;const x=e.getEditingShapeId();if(x){const S=e.getShape(x);if(S&&e.getShapeUtil(S).canScroll(S)&&e.getShapePageBounds(x)?.containsPoint(e.inputs.currentPagePoint))return}We(v),Xt(v);const m=xz(v);if(m.x===0&&m.y===0)return;const b={type:"wheel",name:"wheel",delta:m,point:new k(v.clientX,v.clientY),shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey};e.dispatch(b)};let o=1,a=1,c=1,l=0;const u=new k,d=new k,h=v=>{const x=n.current;i="not sure";const{event:m,origin:b,da:S}=v;m instanceof WheelEvent||(m.target===x||x?.contains(m.target))&&(d.x=b[0],d.y=b[1],u.x=b[0],u.y=b[1],o=S[0],a=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:b[0],y:b[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey}))},p=v=>{if(v&&(i="zooming"),i==="zooming")return;const x=Math.abs(l-o),m=k.Dist(u,d);switch(i){case"not sure":{x>24?i="zooming":m>16&&(i="panning");break}case"panning":{x>64&&(i="zooming");break}}};return{onWheel:s,onPinchStart:h,onPinchEnd:v=>{const x=n.current,{event:m,origin:b,offset:S}=v;if(m instanceof WheelEvent||!(m.target===x||x?.contains(m.target)))return;const w=S[0];i="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:b[0],y:b[1],z:w},delta:{x:b[0],y:b[1]},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey})})},onPinch:v=>{const x=n.current,{event:m,origin:b,offset:S,da:w}=v;if(m instanceof WheelEvent||!(m.target===x||x?.contains(m.target)))return;const I=v.type==="gesturechange"||v.type==="gestureend";l=w[0];const C=b[0]-d.x,_=b[1]-d.y;switch(d.x=b[0],d.y=b[1],p(I),i){case"zooming":{c=S[0],e.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:c},delta:{x:C,y:_},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:a},delta:{x:C,y:_},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey});break}}}}},[e,n]);tne(r,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function lS(n,e,r){const i=n.getShape(e),s=n.getShapeHandles(i);return{shape:i,handle:s.find(o=>o.id===r)}}function ine(n,e){const r=Z();return E.useMemo(()=>{const i=l=>{if(l.isKilled)return;const u=ah(l.currentTarget);iu(u,l);const{shape:d,handle:h}=lS(r,n,e);h&&r.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_down",...Gn(l)})};let s,o;return{onPointerDown:i,onPointerMove:l=>{if(l.isKilled||l.clientX===s&&l.clientY===o)return;s=l.clientX,o=l.clientY;const{shape:u,handle:d}=lS(r,n,e);d&&r.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_move",...Gn(l)})},onPointerUp:l=>{if(l.isKilled)return;const u=ah(l.currentTarget);su(u,l);const{shape:d,handle:h}=lS(r,n,e);h&&r.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_up",...Gn(l)})}}},[r,n,e])}class pe{constructor(e=0,r=0,i=0,s=0){this.x=e,this.y=r,this.w=i,this.h=s}x=0;y=0;w=0;h=0;get point(){return new k(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new k(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY)]}get cornersAndCenter(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new k(this.w,this.h)}toFixed(){return this.x=Gu(this.x),this.y=Gu(this.y),this.w=Gu(this.w),this.h=Gu(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,r=0,i=0,s=0){return this.x=e,this.y=r,this.w=i,this.h=s,this}expand(e){const r=Math.min(this.minX,e.minX),i=Math.min(this.minY,e.minY),s=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=r,this.y=i,this.w=s-r,this.h=o-i,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:r,w:i,h:s}=this;return new pe(e,r,i,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const r=Math.round(this.minX/e)*e,i=Math.round(this.minY/e)*e,s=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=r,this.minY=i,this.width=Math.max(1,s-r),this.height=Math.max(1,o-i)}collides(e){return pe.Collides(this,e)}contains(e){return pe.Contains(this,e)}includes(e){return pe.Includes(this,e)}containsPoint(e,r=0){return pe.ContainsPoint(this,e,r)}getHandlePoint(e){switch(e){case"top_left":return new k(this.minX,this.minY);case"top_right":return new k(this.maxX,this.minY);case"bottom_left":return new k(this.minX,this.maxY);case"bottom_right":return new k(this.maxX,this.maxY);case"top":return new k(this.midX,this.minY);case"right":return new k(this.maxX,this.midY);case"bottom":return new k(this.midX,this.maxY);case"left":return new k(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,r,i){const{minX:s,minY:o,maxX:a,maxY:c}=this;let{minX:l,minY:u,maxX:d,maxY:h}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=r;break}case"right":case"top_right":case"bottom_right":{d+=r;break}}switch(e){case"top":case"top_left":case"top_right":{u+=i;break}case"bottom":case"bottom_left":case"bottom_right":{h+=i;break}}const p=(d-l)/(a-s),g=(h-u)/(c-o),y=p<0,v=g<0;if(y){const x=d;d=l,l=x}if(v){const x=h;h=u,u=x}this.minX=l,this.minY=u,this.width=Math.abs(d-l),this.height=Math.abs(h-u)}union(e){const r=Math.min(this.minX,e.x),i=Math.min(this.minY,e.y),s=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=r,this.y=i,this.width=s-r,this.height=o-i,this}static From(e){return new pe(e.x,e.y,e.w,e.h)}static FromCenter(e,r){return new pe(e.x-r.x/2,e.y-r.y/2,r.x,r.y)}static FromPoints(e){if(e.length===0)return new pe;let r=1/0,i=1/0,s=-1/0,o=-1/0,a;for(let c=0,l=e.length;c<l;c++)a=e[c],r=Math.min(a.x,r),i=Math.min(a.y,i),s=Math.max(a.x,s),o=Math.max(a.y,o);return new pe(r,i,s-r,o-i)}static Expand(e,r){const i=Math.min(r.minX,e.minX),s=Math.min(r.minY,e.minY),o=Math.max(r.maxX,e.maxX),a=Math.max(r.maxY,e.maxY);return new pe(i,s,o-i,a-s)}static ExpandBy(e,r){return new pe(e.minX-r,e.minY-r,e.width+r*2,e.height+r*2)}static Collides=(e,r)=>!(e.maxX<r.minX||e.minX>r.maxX||e.maxY<r.minY||e.minY>r.maxY);static Contains=(e,r)=>e.minX<r.minX&&e.minY<r.minY&&e.maxY>r.maxY&&e.maxX>r.maxX;static Includes=(e,r)=>pe.Collides(e,r)||pe.Contains(e,r);static ContainsPoint=(e,r,i=0)=>!(r.x<e.minX-i||r.y<e.minY-i||r.x>e.maxX+i||r.y>e.maxY+i);static Common=e=>{let r=1/0,i=1/0,s=-1/0,o=-1/0;for(let a=0;a<e.length;a++){const c=e[a];r=Math.min(r,c.minX),i=Math.min(i,c.minY),s=Math.max(s,c.maxX),o=Math.max(o,c.maxY)}return new pe(r,i,s-r,o-i)};static Sides=(e,r=0)=>{const{corners:i}=e;return[[i[0],i[1]],[i[1],i[2]],[i[2],i[3]],[i[3],i[0]]]};static Resize(e,r,i,s,o=!1){const{minX:a,minY:c,maxX:l,maxY:u}=e;let{minX:d,minY:h,maxX:p,maxY:g}=e;switch(r){case"left":case"top_left":case"bottom_left":{d+=i;break}case"right":case"top_right":case"bottom_right":{p+=i;break}}switch(r){case"top":case"top_left":case"top_right":{h+=s;break}case"bottom":case"bottom_left":case"bottom_right":{g+=s;break}}const y=(p-d)/(l-a),v=(g-h)/(u-c),x=y<0,m=v<0;if(o){const S=(l-a)/(u-c),w=Math.abs(p-d),I=Math.abs(g-h),C=w*(v<0?1:-1)*(1/S),_=I*(y<0?1:-1)*S,P=S<w/I;switch(r){case"top_left":{P?h=g+C:d=p+_;break}case"top_right":{P?h=g+C:p=d-_;break}case"bottom_right":{P?g=h-C:p=d-_;break}case"bottom_left":{P?g=h-C:d=p+_;break}case"bottom":case"top":{const M=(d+p)/2,T=I*S;d=M-T/2,p=M+T/2;break}case"left":case"right":{const M=(h+g)/2,T=w/S;h=M-T/2,g=M+T/2;break}}}if(x){const S=p;p=d,d=S}if(m){const S=g;g=h,h=S}const b=new pe(d,h,Math.abs(p-d),Math.abs(g-h));return{box:b,scaleX:+(b.width/e.width*(y>0?1:-1)).toFixed(5),scaleY:+(b.height/e.height*(v>0?1:-1)).toFixed(5)}}equals(e){return pe.Equals(this,e)}static Equals(e,r){return r.x===e.x&&r.y===e.y&&r.w===e.w&&r.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new pe(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function sne(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function one(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function ane(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}function cne(n){const e=Z();E.useLayoutEffect(()=>{let r=new pe;function i(){const u=n.current;if(!u)return null;const d=u.getBoundingClientRect(),h=new pe(d.left||d.x,d.top||d.y,Math.max(d.width,1),Math.max(d.height,1));r.equals(h)||(e.updateViewportScreenBounds(h),r=h)}i();const s=GL(i,200,{trailing:!0}),o=e.timers.setInterval(s,1e3);window.addEventListener("resize",s);const a=new ResizeObserver(u=>{u[0].contentRect&&s()}),c=n.current;let l=null;return c&&(a.observe(c),l=lne(c),l.addEventListener("scroll",s)),()=>{clearInterval(o),window.removeEventListener("resize",s),a.disconnect(),l?.removeEventListener("scroll",s),s.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const lne=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:r}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(r==="auto"||r==="scroll"||r==="overlay"))return e;e=e.parentElement}return document};class de{constructor(e,r,i,s,o,a){this.a=e,this.b=r,this.c=i,this.d=s,this.e=o,this.f=a}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const r=e,{a:i,b:s,c:o,d:a,e:c,f:l}=this;return this.a=i*r.a+o*r.b,this.c=i*r.c+o*r.d,this.e=i*r.e+o*r.f+c,this.b=s*r.a+a*r.b,this.d=s*r.c+a*r.d,this.f=s*r.e+a*r.f+l,this}rotate(e,r,i){return e===0?this:r===void 0?this.multiply(de.Rotate(e)):this.translate(r,i).multiply(de.Rotate(e)).translate(-r,-i)}translate(e,r){return this.multiply(de.Translate(e,r))}scale(e,r){return this.multiply(de.Scale(e,r))}invert(){const{a:e,b:r,c:i,d:s,e:o,f:a}=this,c=e*s-r*i;return this.a=s/c,this.b=r/-c,this.c=i/-c,this.d=e/c,this.e=(s*o-i*a)/-c,this.f=(r*o-e*a)/c,this}applyToPoint(e){return de.applyToPoint(this,e)}applyToPoints(e){return de.applyToPoints(this,e)}rotation(){return de.Rotation(this)}point(){return de.Point(this)}decomposed(){return de.Decompose(this)}toCssString(){return de.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return de.Decompose(this)}clone(){return new de(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new de(1,0,0,1,0,0)}static Translate(e,r){return new de(1,0,0,1,e,r)}static Rotate(e,r,i){if(e===0)return de.Identity();const s=Math.cos(e),o=Math.sin(e),a=new de(s,o,-o,s,0,0);return r===void 0?a:de.Compose(de.Translate(r,i),a,de.Translate(-r,-i))}static Scale=(e,r,i,s)=>{const o=new de(e,0,0,r,0,0);return i===void 0?o:de.Compose(de.Translate(i,s),o,de.Translate(-i,-s))};static Multiply(e,r){return{a:e.a*r.a+e.c*r.b,c:e.a*r.c+e.c*r.d,e:e.a*r.e+e.c*r.f+e.e,b:e.b*r.a+e.d*r.b,d:e.b*r.c+e.d*r.d,f:e.b*r.e+e.d*r.f+e.f}}static Inverse(e){const r=e.a*e.d-e.b*e.c;return{a:e.d/r,b:e.b/-r,c:e.c/-r,d:e.a/r,e:(e.d*e.e-e.c*e.f)/-r,f:(e.b*e.e-e.a*e.f)/r}}static Absolute(e){const r=e.a*e.d-e.b*e.c;return{a:e.d/r,b:e.b/-r,c:e.c/-r,d:e.a/r,e:(e.d*e.e-e.c*e.f)/r,f:(e.b*e.e-e.a*e.f)/-r}}static Compose(...e){const r=de.Identity();for(let i=0,s=e.length;i<s;i++)r.multiply(e[i]);return r}static Point(e){return new k(e.e,e.f)}static Rotation(e){let r;if(e.a!==0||e.c!==0){const i=(e.a*e.a+e.c*e.c)**.5;r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const i=(e.b*e.b+e.d*e.d)**.5;r=pt+Math.acos(e.b/i)*(e.d>0?-1:1)}else r=0;return xw(r)}static Decompose(e){let r,i,s;if(e.a!==0||e.c!==0){const o=(e.a*e.a+e.c*e.c)**.5;r=o,i=(e.a*e.d-e.b*e.c)/o,s=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=(e.b*e.b+e.d*e.d)**.5;r=(e.a*e.d-e.b*e.c)/o,i=o,s=pt+Math.acos(e.b/o)*(e.d>0?-1:1)}else r=0,i=0,s=0;return{x:e.e,y:e.f,scaleX:r,scaleY:i,rotation:xw(s)}}static Smooth(e,r=1e10){return e.a=Math.round(e.a*r)/r,e.b=Math.round(e.b*r)/r,e.c=Math.round(e.c*r)/r,e.d=Math.round(e.d*r)/r,e.e=Math.round(e.e*r)/r,e.f=Math.round(e.f*r)/r,e}static toCssString(e){return`matrix(${W(e.a)}, ${W(e.b)}, ${W(e.c)}, ${W(e.d)}, ${W(e.e)}, ${W(e.f)})`}static applyToPoint(e,r){return new k(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z)}static applyToXY(e,r,i){return[e.a*r+e.c*i+e.e,e.b*r+e.d*i+e.f]}static applyToPoints(e,r){return r.map(i=>new k(e.a*i.x+e.c*i.y+e.e,e.b*i.x+e.d*i.y+e.f,i.z))}static applyToBounds(e,r){return new pe(e.e+r.minX,e.f+r.minY,r.width,r.height)}static From(e){return new de(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof de?e:de.From(e)}}function bz(n,e){return e===0?n:bz(e,n%e)}function Sz(n){const e=n.toString().split(".")[1];if(!e)return 1;const r=Math.pow(10,e.length),i=parseInt(e,10);return r/bz(i,r)}class Hs{isFilled=!1;isClosed=!0;isLabel=!1;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,r=0,i=!1){return this.isClosed&&(this.isFilled||i)&&ar(e,this.vertices)?!0:k.Dist2(e,this.nearestPoint(e))<=r*r}distanceToPoint(e,r=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||r)&&ar(e,this.vertices)?-1:1)}distanceToLineSegment(e,r){if(e.equals(r))return this.distanceToPoint(e);const{vertices:i}=this;let s,o=1/0,a,c,l;for(let u=0;u<i.length;u++)c=i[u],l=k.NearestPointOnLineSegment(e,r,c,!0),a=k.Dist2(c,l),a<o&&(o=a,s=l);if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&ar(s,this.vertices)?-o:o}hitTestLineSegment(e,r,i=0){return this.distanceToLineSegment(e,r)<=i}nearestPointOnLineSegment(e,r){const{vertices:i}=this;let s,o=1/0,a,c,l;for(let u=0;u<i.length;u++)c=i[u],l=k.NearestPointOnLineSegment(e,r,c,!0),a=k.Dist2(c,l),a<o&&(o=a,s=l);if(!s)throw Error("nearest point not found");return s}isPointInBounds(e,r=0){const{bounds:i}=this;return!(e.x<i.minX-r||e.y<i.minY-r||e.x>i.maxX+r||e.y>i.maxY+r)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return pe.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let r=0;for(let i=0,s=e.length;i<s;i++){const o=e[i],a=e[(i+1)%s];r+=o.x*a.y-a.x*o.y}return r/2}toSimpleSvgPath(){let e="";const{vertices:r}=this,i=r.length;if(i===0)return e;e+=`M${r[0].x},${r[0].y}`;for(let s=1;s<i;s++)e+=`L${r[s].x},${r[s].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let r,i=e[0],s=0;for(let o=1;o<e.length;o++)r=e[o],s+=k.Dist2(i,r),i=r;return Math.sqrt(s)}}class Qr extends Hs{children=[];ignoredChildren=[];constructor(e){super({...e,isClosed:!0,isFilled:!1});for(const r of e.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let r=1/0,i;const{children:s}=this;if(s.length===0)throw Error("no children");let o,a;for(const c of s)o=c.nearestPoint(e),a=k.Dist2(o,e),a<r&&(r=a,i=o);if(!i)throw Error("nearest point not found");return i}distanceToPoint(e,r=!1){return Math.min(...this.children.map((i,s)=>i.distanceToPoint(e,r||s>0)))}hitTestPoint(e,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(e,r,i))}hitTestLineSegment(e,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(e,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const i of this.children)e+=i.toSimpleSvgPath();const r=pe.FromPoints(this.vertices).corners;for(let i=0,s=r.length;i<s;i++){const o=r[i],a=r[(i-1+s)%s],c=o.dist(a),l=r[(i+1)%s],u=o.dist(l),d=o.clone().lrp(a,4/c),h=o,p=o.clone().lrp(l,4/u);e+=`M${d.x},${d.y} L${h.x},${h.y} L${p.x},${p.y} `}return e}getLength(){return this.children.reduce((e,r)=>r.isLabel?e:e+r.length,0)}getSvgPathData(){return this.children.map((e,r)=>e.isLabel?"":e.getSvgPathData(r===0)).join(" ")}}function une(n=!0){const[e,r]=E.useState(0),i=Z();E.useEffect(()=>{if(!n)return;const s=()=>r(o=>o+1);return i.on("tick",s),()=>{i.off("tick",s)}},[i,n])}const dne=Qt(function({showStroke:e=!0,showVertices:r=!0,showClosestPointOnOutline:i=!0}){const s=Z();une(i);const o=s.getZoomLevel(),a=s.getRenderingShapes(),{inputs:{currentPagePoint:c}}=s;return f.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:a.map(l=>{const u=s.getShape(l.id);if(u.type==="group")return null;const d=s.getShapeGeometry(u),h=s.getShapePageTransform(u),p=s.getPointInShapeSpace(u,c),g=d.nearestPoint(p),y=d.distanceToPoint(p,!0),v=Math.abs(y)*o,x=y<0,{vertices:m}=d;return f.jsxs("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&f.jsx("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/o,fill:"none",children:f.jsx(wz,{geometry:d})}),r&&m.map((b,S)=>f.jsx("circle",{cx:b.x,cy:b.y,r:2/o,fill:`hsl(${Ta(S,[0,m.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/o},`v${S}`)),i&&v<150&&f.jsx("line",{x1:g.x,y1:g.y,x2:p.x,y2:p.y,opacity:1-v/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/o})]},l.id+"_outline")})})});function wz({geometry:n}){return n instanceof Qr?f.jsx(f.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,r)=>f.jsx(wz,{geometry:e},r))}):f.jsx("path",{d:n.toSimpleSvgPath()})}function _z(n){return DQ(n)}function Cz(){const n=Z(),e=Nee("userIds",()=>_z(n.getCollaborators().map(r=>r.userId)).sort(),{isEqual:(r,i)=>r.join(",")===i.join?.(",")},[n]);return ne(e)}function Sf(n){const e=Z();return ne(`latestPresence:${n}`,()=>e.getCollaborators().find(i=>i.userId===n),[e,n])??null}const hne=Qt(function(){return Cz().map(r=>f.jsx(fne,{collaboratorId:r},r))}),fne=Qt(function({collaboratorId:e}){const r=Z(),i=Sf(e),s=gne(r,i);if(!(i&&i.currentPageId===r.getCurrentPageId()))return null;switch(s){case"inactive":{const{followingUserId:o,highlightedUserIds:a}=r.getInstanceState();if(!(o===i.userId||a.includes(i.userId)))return null;break}case"idle":{const{highlightedUserIds:o}=r.getInstanceState();if(i.followingUserId===r.user.getId()&&!(i.chatMessage||o.includes(i.userId)))return null;break}}return f.jsx(pne,{latestPresence:i})}),pne=Qt(function({latestPresence:e}){const r=Z(),{CollaboratorBrush:i,CollaboratorScribble:s,CollaboratorCursor:o,CollaboratorHint:a,CollaboratorShapeIndicator:c}=Ct(),l=r.getZoomLevel(),u=r.getViewportPageBounds(),{userId:d,chatMessage:h,brush:p,scribbles:g,selectedShapeIds:y,userName:v,cursor:x,color:m}=e,b=!(x.x<u.minX-12/l||x.y<u.minY-16/l||x.x>u.maxX-12/l||x.y>u.maxY-16/l);return f.jsxs(f.Fragment,{children:[p&&i?f.jsx(i,{className:"tl-collaborator__brush",brush:p,color:m,opacity:.1},d+"_brush"):null,b&&o?f.jsx(o,{className:"tl-collaborator__cursor",point:x,color:m,zoom:l,name:v!=="New User"?v:null,chatMessage:h},d+"_cursor"):a?f.jsx(a,{className:"tl-collaborator__cursor-hint",point:x,color:m,zoom:l,viewport:u},d+"_cursor_hint"):null,s&&g.length?f.jsx(f.Fragment,{children:g.map(S=>f.jsx(s,{className:"tl-collaborator__scribble",scribble:S,color:m,zoom:l,opacity:S.color==="laser"?.5:.1},d+"_scribble_"+S.id))}):null,c&&y.map(S=>f.jsx(c,{className:"tl-collaborator__shape-indicator",shapeId:S,color:m,opacity:.5},d+"_"+S))]})});function RR(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function gne(n,e){const r=E.useRef(e?.lastActivityTimestamp??-1),[i,s]=E.useState(()=>RR(n,Date.now()-r.current));return E.useEffect(()=>{const o=n.timers.setInterval(()=>{s(RR(n,Date.now()-r.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(o)},[n]),e&&(r.current=e.lastActivityTimestamp),i}const Pz=E.memo(function({id:e,shape:r,util:i,index:s,backgroundIndex:o,opacity:a,dprMultiple:c}){const l=Z(),{ShapeErrorFallback:u}=Ct(),d=E.useRef(null),h=E.useRef(null),p=E.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Rs("set shape stuff",()=>{const v=l.getShape(e);if(!v)return;const x=p.current,m=l.getShapeClipPath(e)??"none";m!==x.clipPath&&(gn(d.current,"clip-path",m),gn(h.current,"clip-path",m),x.clipPath=m);const b=l.getShapePageTransform(e),S=de.toCssString(b),w=l.getShapeGeometry(v).bounds;S!==x.transform&&(gn(d.current,"transform",S),gn(h.current,"transform",S),x.transform=S);const I=w.w%c,C=w.h%c,_=I===0?w.w:w.w+(c-I),P=C===0?w.h:w.h+(c-C);(_!==x.width||P!==x.height)&&(gn(d.current,"width",Math.max(_,c)+"px"),gn(d.current,"height",Math.max(P,c)+"px"),gn(h.current,"width",Math.max(_,c)+"px"),gn(h.current,"height",Math.max(P,c)+"px"),x.width=_,x.height=P)},[l]),Rs("set opacity and z-index",()=>{const v=d.current,x=h.current;gn(v,"opacity",a),gn(x,"opacity",a),gn(v,"z-index",s),gn(x,"z-index",o)},[a,s,o]),Rs("set display",()=>{if(!l.getShape(e))return;const m=l.getCulledShapes().has(e);m!==p.current.isCulled&&(gn(d.current,"display",m?"none":"block"),gn(h.current,"display",m?"none":"block"),p.current.isCulled=m)},[l]);const g=E.useCallback(v=>l.annotateError(v,{origin:"shape",willCrashApp:!1}),[l]);if(!r)return null;const y="fill"in r.props&&r.props.fill!=="none";return f.jsxs(f.Fragment,{children:[i.backgroundComponent&&f.jsx("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":r.type,draggable:!1,children:f.jsx(Il,{fallback:u,onError:g,children:f.jsx(yne,{shape:r,util:i})})}),f.jsx("div",{ref:d,className:"tl-shape","data-shape-type":r.type,"data-shape-is-filled":y,draggable:!1,children:f.jsx(Il,{fallback:u,onError:g,children:f.jsx(mne,{shape:r,util:i})})})]})}),mne=E.memo(function({shape:e,util:r}){return xf("InnerShape:"+e.type,()=>r.component(r.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),yne=E.memo(function({shape:e,util:r}){return xf("InnerShape:"+e.type,()=>r.backgroundComponent?.(r.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function vne({className:n}){const e=Z(),{Background:r,SvgDefs:i,ShapeIndicators:s}=Ct(),o=E.useRef(null),a=E.useRef(null),c=E.useRef(null),l=Jt();cne(o),Zee(),Yee(),rne(o),ete(o);const u=E.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Rs("position layers",function(){const{x:b,y:S,z:w}=e.getCamera();if(u.current.allowTextOutline&&e.environment.isSafari&&(l.style.setProperty("--tl-text-outline","none"),u.current.allowTextOutline=!1),u.current.allowTextOutline&&w<e.options.textShadowLod!==u.current.lodDisableTextOutline){const _=w<e.options.textShadowLod;l.style.setProperty("--tl-text-outline",_?"none":"var(--tl-text-outline-reference)"),u.current.lodDisableTextOutline=_}const I=w>=1?Ta(w,[1,8],[.125,.5],!0):Ta(w,[.1,1],[-2,.125],!0),C=`scale(${W(w)}) translate(${W(b+I)}px,${W(S+I)}px)`;gn(a.current,"transform",C),gn(c.current,"transform",C)},[e,l]);const d=lz(),h=ne("shapeSvgDefs",()=>{const m=new Map;for(const b of jt(e.shapeUtils)){if(!b)return;const S=b.getCanvasSvgDefs();for(const{key:w,component:I}of S)m.has(w)||m.set(w,f.jsx(I,{},w))}return[...m.values()]},[e]),p=ne("debug_shapes",()=>Dt.hideShapes.get(),[Dt]),g=ne("debug_svg",()=>Dt.debugSvg.get(),[Dt]),y=ne("debug_geometry",()=>Dt.debugGeometry.get(),[Dt]),v=ne("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),x=ne("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return f.jsxs(f.Fragment,{children:[f.jsxs("div",{ref:o,draggable:!1,"data-iseditinganything":v,"data-isselectinganything":x,className:Me("tl-canvas",n),"data-testid":"canvas",...d,children:[f.jsx("svg",{className:"tl-svg-context",children:f.jsxs("defs",{children:[h,f.jsx(jne,{}),f.jsx(Rne,{}),i&&f.jsx(i,{})]})}),r&&f.jsx("div",{className:"tl-background__wrapper",children:f.jsx(r,{})}),f.jsx(bne,{}),f.jsxs("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[f.jsx(Lne,{}),f.jsx(Nne,{}),p?null:g?f.jsx(kne,{}):f.jsx(Mne,{})]}),f.jsx("div",{className:"tl-overlays",children:f.jsxs("div",{ref:c,className:"tl-html-layer",children:[y?f.jsx(dne,{}):null,f.jsx(Pne,{}),f.jsx(wne,{}),f.jsx(Sne,{}),f.jsx(_ne,{}),s&&f.jsx(s,{}),f.jsx(Ane,{}),f.jsx(Cne,{}),f.jsx(Dne,{}),f.jsx(hne,{})]})}),f.jsx(Fne,{})]}),f.jsx(xne,{})]})}function xne(){const{InFrontOfTheCanvas:n}=Ct();return n?f.jsx(n,{}):null}function bne(){const n=Z(),e=ne("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:r,y:i,z:s}=ne("camera",()=>n.getCamera(),[n]),o=ne("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:a}=Ct();return a&&o?f.jsx(a,{x:r,y:i,z:s,size:e}):null}function Sne(){const n=Z(),e=ne("scribbles",()=>n.getInstanceState().scribbles,[n]),r=ne("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:i}=Ct();return i&&e.length?e.map(s=>f.jsx(i,{className:"tl-user-scribble",scribble:s,zoom:r},s.id)):null}function wne(){const n=Z(),e=ne("brush",()=>n.getInstanceState().brush,[n]),{Brush:r}=Ct();return r&&e?f.jsx(r,{className:"tl-user-brush",brush:e}):null}function _ne(){const n=Z(),e=ne("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:r}=Ct();return r&&e?f.jsx(r,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function Cne(){const n=Z(),e=ne("snapLines",()=>n.snaps.getIndicators(),[n]),r=ne("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:i}=Ct();return i&&e.length>0?e.map(s=>f.jsx(i,{className:"tl-user-snapline",line:s,zoom:r},s.id)):null}function Pne(){const n=Z(),e=ne("handles shapeIdWithHandles",()=>{const{isReadonly:r,isChangingStyle:i}=n.getInstanceState();if(r||i)return!1;const s=n.getOnlySelectedShape();return!s||!n.getShapeHandles(s)?!1:s.id},[n]);return e?f.jsx(Ine,{shapeId:e}):null}function Ine({shapeId:n}){const e=Z(),{Handles:r}=Ct(),i=ne("zoomLevel",()=>e.getZoomLevel(),[e]),s=ne("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),o=ne("handles transform",()=>e.getShapePageTransform(n),[e,n]),a=ne("handles",()=>{const c=e.getShapeHandles(n);if(!c)return null;const l=(s?e.options.coarseHandleRadius:e.options.handleRadius)/i*2;return c.filter(u=>u.type!=="virtual"||!c.some(d=>d!==u&&d.type==="vertex"&&k.Dist(u,d)<l)).sort(u=>u.type==="vertex"?1:-1)},[e,i,s,n]);return!r||!a||!o?null:f.jsx(r,{children:f.jsx("g",{transform:de.toCssString(o),children:a.map(c=>f.jsx(Ene,{shapeId:n,handle:c,zoom:i,isCoarse:s},c.id))})})}function Ene({shapeId:n,handle:e,zoom:r,isCoarse:i}){const s=ine(n,e.id),{Handle:o}=Ct();return o?f.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...s,children:f.jsx(o,{shapeId:n,handle:e,zoom:r,isCoarse:i})}):null}function kne(){const n=Z(),e=ne("rendering shapes",()=>n.getRenderingShapes(),[n]),r=ne("dpr multiple",()=>Sz(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return e.map(i=>f.jsxs(E.Fragment,{children:[f.jsx(Pz,{...i,dprMultiple:r}),f.jsx(One,{id:i.id})]},i.id+"_fragment"))}function Tne(){const n=Z(),e=E.useRef(new Set);return Rs("reflow for culled shapes",()=>{const r=n.getCulledShapes();if(e.current.size===r.size&&[...r].every(s=>e.current.has(s)))return;e.current=r;const i=document.getElementsByClassName("tl-canvas");i.length!==0&&i[0].offsetHeight},[n]),null}function Mne(){const n=Z(),e=ne("rendering shapes",()=>n.getRenderingShapes(),[n]),r=ne("dpr multiple",()=>Sz(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return f.jsxs(f.Fragment,{children:[e.map(i=>f.jsx(Pz,{...i,dprMultiple:r},i.id+"_shape")),n.environment.isSafari&&f.jsx(Tne,{})]})}function Ane(){const n=Z(),{ShapeIndicator:e}=Ct(),r=ne("hinting shape ids",()=>f_(n.getHintingShapeIds()),[n]);return!r.length||!e?null:r.map(i=>f.jsx(e,{className:"tl-user-indicator__hint",shapeId:i},i+"_hinting"))}function jne(){return f.jsxs("g",{id:"cursor",children:[f.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[f.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),f.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),f.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[f.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),f.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),f.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[f.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),f.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function Rne(){return f.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function One({id:n}){const e=Z(),[r,i]=E.useState(null),s=ne("is in root",()=>e.getShape(n)?.parentId===e.getCurrentPageId(),[e,n]);return E.useEffect(()=>{if(!s)return;let o=null;const a=$o("shape to svg",async()=>{const c=Math.random();o=c;const u=e.isShapeOfType(n,"frame")?0:10;let d=e.getShapePageBounds(n);if(!d)return;d=d.clone().expandBy(u);const h=await e.getSvgString([n],{padding:u,background:e.getInstanceState().exportBackground});if(o!==c||!h)return;const p=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;i({src:p,bounds:d})});return()=>{o=null,a()}},[e,n,s]),!s||!r?null:f.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function Dne(){const n=Z(),e=ne("selection rotation",()=>n.getSelectionRotation(),[n]),r=ne("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:i}=Ct();return!r||!i?null:f.jsx(i,{bounds:r,rotation:e})}function Nne(){const n=Z(),e=ne("selection rotation",()=>n.getSelectionRotation(),[n]),r=ne("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:i}=Ct();return!r||!i?null:f.jsx(i,{bounds:r,rotation:e})}function Lne(){const{OnTheCanvas:n}=Ct();return n?f.jsx(n,{}):null}function Fne(){const n=Z(),e=ne("camera state",()=>n.getCameraState(),[n]);return f.jsx("div",{className:Me("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function zne({className:n,zoom:e,point:r,color:i,viewport:s,opacity:o=1}){const a=E.useRef(null);return Wa(a,Ht(r.x,s.minX+5/e,s.maxX-5/e),Ht(r.y,s.minY+5/e,s.maxY-5/e),1/e,k.Angle(s.center,r)),f.jsxs("svg",{ref:a,className:Me("tl-overlays__item",n),children:[f.jsx("use",{href:"#cursor_hint",color:i,strokeWidth:3,stroke:"var(--color-background)"}),f.jsx("use",{href:"#cursor_hint",color:i,opacity:o})]})}const OR=E.memo(function({className:e,zoom:r,point:i,color:s,name:o,chatMessage:a}){const c=E.useRef(null);return Wa(c,i?.x,i?.y,1/r),i?f.jsxs("div",{ref:c,className:Me("tl-overlays__item",e),children:[f.jsx("svg",{className:"tl-cursor",children:f.jsx("use",{href:"#cursor",color:s})}),a?f.jsxs(f.Fragment,{children:[o&&f.jsx("div",{className:"tl-nametag-title",style:{color:s},children:o}),f.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:s},children:a})]}):o&&f.jsx("div",{className:"tl-nametag",style:{backgroundColor:s},children:o})]}):null});function Iz(){return E.useId().replace(/:/g,"_")}function $ne({x:n,y:e,z:r,size:i}){const s=`grid_${Iz()}`,o=Z(),{gridSteps:a}=o.options;return f.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[f.jsx("defs",{children:a.map(({min:c,mid:l,step:u},d)=>{const h=u*i*r,p=.5+n*r,g=.5+e*r,y=p>0?p%h:h+p%h,v=g>0?g%h:h+g%h,x=r<l?Ta(r,[c,l],[0,1]):1;return f.jsx("pattern",{id:`${s}_${u}`,width:h,height:h,patternUnits:"userSpaceOnUse",children:f.jsx("circle",{className:"tl-grid-dot",cx:y,cy:v,r:1,opacity:x})},d)})}),a.map(({step:c},l)=>f.jsx("rect",{width:"100%",height:"100%",fill:`url(#${s}_${c})`},l))]})}function Bne({handle:n,isCoarse:e,className:r,zoom:i}){const s=Z(),o=(e?s.options.coarseHandleRadius:s.options.handleRadius)/i;if(n.type==="clone"){const c=3/i,l=`M0,${-c} A${c},${c} 0 0,1 0,${c}`,u=Vee.indexOf(n.id);return f.jsxs("g",{className:Me(`tl-handle tl-handle__${n.type}`,r),children:[f.jsx("circle",{className:"tl-handle__bg",r:o}),f.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*u})`})]})}const a=(n.type==="create"&&e?3:4)/Math.max(i,.25);return f.jsxs("g",{className:Me(`tl-handle tl-handle__${n.type}`,r),children:[f.jsx("circle",{className:"tl-handle__bg",r:o}),f.jsx("circle",{className:"tl-handle__fg",r:a})]})}const Une=({children:n})=>f.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),qne=()=>{const{Spinner:n}=Ct();return f.jsx(G_,{children:n?f.jsx(n,{}):null})};function R_(n,e=!0){const r=n.length;if(r<2)return"";let i=n[0],s=n[1];if(r===2)return`M${Qe(i)}L${Qe(s)}`;let o="";for(let a=2,c=r-1;a<c;a++)i=n[a],s=n[a+1],o+=Bn(i,s);return e?`M${Bn(n[0],n[1])}Q${Qe(n[1])}${Bn(n[1],n[2])}T${o}${Bn(n[r-1],n[0])}${Bn(n[0],n[1])}Z`:`M${Qe(n[0])}Q${Qe(n[1])}${Bn(n[1],n[2])}${n.length>3?"T":""}${o}L${Qe(n[r-1])}`}function DR({scribble:n,zoom:e,color:r,opacity:i,className:s}){return n.points.length?f.jsx("svg",{className:s&&Me("tl-overlays__item",s),children:f.jsx("path",{className:"tl-scribble",d:R_(n.points,!1),stroke:r??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:i??n.opacity})}):null}function Ez({bounds:n,rotation:e}){const r=E.useRef(null);return Wa(r,n.x,n.y,1,e),E.useLayoutEffect(()=>{const i=r.current;i&&(i.style.width=W(Math.max(1,n.width))+"px",i.style.height=W(Math.max(1,n.height))+"px")},[n.width,n.height]),f.jsx("div",{ref:r,className:"tl-selection__bg",draggable:!1})}function Hne({bounds:n,rotation:e}){const r=Z(),i=E.useRef(null),s=ne("only selected shape",()=>r.getOnlySelectedShape(),[r]),o=s?r.getShapeUtil(s).expandSelectionOutlinePx(s):0;return Wa(i,n?.x,n?.y,1,e,{x:-o,y:-o}),n=n.clone().expandBy(o).zeroFix(),f.jsx("svg",{ref:i,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:f.jsx("rect",{className:Me("tl-selection__fg__outline"),width:W(n.width),height:W(n.height)})})}const Gne=()=>f.jsx("div",{className:"tl-shape-error-boundary"}),Kne=({shape:n,util:e})=>xf("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),Vne=({editor:n,id:e})=>{const r=ne("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:i}=Ct();return!r||r.isLocked?null:f.jsx(Il,{fallback:i,onError:s=>n.annotateError(s,{origin:"react.shapeIndicator",willCrashApp:!1}),children:f.jsx(Kne,{shape:r,util:n.getShapeUtil(r)},r.id)})},NR=E.memo(function({shapeId:e,className:r,color:i,hidden:s,opacity:o}){const a=Z(),c=E.useRef(null);return Rs("indicator transform",()=>{const l=c.current;if(!l)return;const u=a.getShapePageTransform(e);u&&l.style.setProperty("transform",u.toCssString())},[a,e]),E.useLayoutEffect(()=>{const l=c.current;l&&l.style.setProperty("display",s?"none":"block")},[s]),f.jsx("svg",{ref:c,className:Me("tl-overlays__item",r),children:f.jsx("g",{className:"tl-shape-indicator",stroke:i??"var(--color-selected)",opacity:o,children:f.jsx(Vne,{editor:a,id:e})})})}),Wne=()=>f.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),kz=E.memo(function(){const e=Z(),r=E.useRef(new Set),i=ne("should display selected ids",()=>{const a=r.current,c=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const l=e.getSelectedShapeIds();for(const u of l)c.add(u);if(e.isInAny("select.idle","select.editing_shape")){const u=e.getInstanceState();if(u.isHoveringCanvas&&!u.isCoarsePointer){const d=e.getHoveredShapeId();d&&c.add(d)}}}if(a.size!==c.size)return r.current=c,c;for(const l of c)if(!a.has(l))return r.current=c,c;return a},[e]),s=ne("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:o}=Ct();return o?s.map(({id:a})=>f.jsx(o,{shapeId:a,hidden:!i.has(a)},a+"_indicator")):null});function Yne({points:n,zoom:e}){const r=2.5/e,i=n.reduce((p,g)=>Math.min(p,g.x),1/0),s=n.reduce((p,g)=>Math.max(p,g.x),-1/0),o=n.reduce((p,g)=>Math.min(p,g.y),1/0),a=n.reduce((p,g)=>Math.max(p,g.y),-1/0),c=n.some(p=>p.x===i&&p.y===o);let l,u,d,h;return c?(l=i,u=o,d=s,h=a):(l=i,u=a,d=s,h=o),f.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[f.jsx("line",{x1:l,y1:u,x2:d,y2:h}),n.map((p,g)=>f.jsx("g",{transform:`translate(${p.x},${p.y})`,children:f.jsx("path",{className:"tl-snap-point",d:`M ${-r},${-r} L ${r},${r} M ${-r},${r} L ${r},${-r}`})},g))]})}function Xne({gaps:n,direction:e,zoom:r}){const i=3.5/r;let s=[-1/0,1/0],o=null;const a=e==="horizontal";for(const l of n){if(o=Ur(s[0],s[1],a?l.startEdge[0].y:l.startEdge[0].x,a?l.startEdge[1].y:l.startEdge[1].x),o)s=o;else continue;if(o=Ur(s[0],s[1],a?l.endEdge[0].y:l.endEdge[0].x,a?l.endEdge[1].y:l.endEdge[1].x),o)s=o;else continue}if(s===null)return null;const c=(s[0]+s[1])/2;return f.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:l,endEdge:u},d)=>f.jsx(E.Fragment,{children:a?f.jsxs(f.Fragment,{children:[f.jsx("line",{x1:l[0].x,y1:c-2*i,x2:l[1].x,y2:c+2*i}),f.jsx("line",{x1:u[0].x,y1:c-2*i,x2:u[1].x,y2:c+2*i}),f.jsx("line",{x1:l[0].x,y1:c,x2:u[0].x,y2:c}),f.jsx("line",{x1:(l[0].x+u[0].x)/2,y1:c-i,x2:(l[0].x+u[0].x)/2,y2:c+i})]}):f.jsxs(f.Fragment,{children:[f.jsx("line",{x1:c-2*i,y1:l[0].y,x2:c+2*i,y2:l[1].y}),f.jsx("line",{x1:c-2*i,y1:u[0].y,x2:c+2*i,y2:u[1].y}),f.jsx("line",{x1:c,y1:l[0].y,x2:c,y2:u[0].y}),f.jsx("line",{x1:c-i,y1:(l[0].y+u[0].y)/2,x2:c+i,y2:(l[0].y+u[0].y)/2})]})},d))})}function Zne({className:n,line:e,zoom:r}){return f.jsx("svg",{className:Me("tl-overlays__item",n),children:e.type==="points"?f.jsx(Yne,{...e,zoom:r}):e.type==="gaps"?f.jsx(Xne,{...e,zoom:r}):null})}function O_(){return f.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:f.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[f.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),f.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:f.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const Qne=()=>null;function Tz(n,e){const r=E.useRef(n);return e(n,r.current)?r.current:(r.current=n,n)}function rl(n){return Tz(n,FQ)}const Jne=(n,e)=>(n??=null,e??=null,n===e?!0:!n||!e?!1:eF(n,e));function wf(n){return Tz(n,Jne)}const Mz=E.createContext(null);function ere({overrides:n={},children:e}){const r=wf(n),i=E.useMemo(()=>({Background:$ee,SvgDefs:Qne,Brush:aS,ZoomBrush:aS,CollaboratorBrush:aS,Cursor:OR,CollaboratorCursor:OR,CollaboratorHint:zne,CollaboratorShapeIndicator:NR,Grid:$ne,Scribble:DR,SnapIndicator:Zne,Handles:Une,Handle:Bne,CollaboratorScribble:DR,ErrorFallback:jz,ShapeErrorFallback:Gne,ShapeIndicatorErrorFallback:Wne,Spinner:O_,SelectionBackground:Ez,SelectionForeground:Hne,ShapeIndicators:kz,ShapeIndicator:NR,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:vne,LoadingScreen:qne,...r}),[r]);return f.jsx(Mz.Provider,{value:i,children:e})}function Ct(){const n=E.useContext(Mz);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const D_={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function Az(){D_.hardReset()}function tre(){D_.refreshPage()}const nre="https://github.com/tldraw/tldraw/issues/new",jz=({error:n,editor:e})=>{const r=E.useRef(null),[i,s]=E.useState(!1),[o,a]=E.useState(!1),[c,l]=E.useState(!1);let u=null;try{u=Ct().Canvas??null}catch{}const d=n instanceof Error?n.message:String(n),h=n instanceof Error?n.stack:null,p=ne("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[g,y]=E.useState(null);E.useLayoutEffect(()=>{p!==null&&y(p);let S=r.current?.parentElement,w=!1;for(;S;){if(S.classList.contains("tl-theme__dark")||S.classList.contains("tl-theme__light")){w=!0;break}S=S.parentElement}if(w){y(null);return}typeof window<"u"&&"matchMedia"in window&&y(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),E.useEffect(()=>{if(o){const S=e?.timers.setTimeout(()=>{a(!1)},2e3);return()=>clearTimeout(S)}},[o,e]);const v=()=>{const S=document.createElement("textarea");S.value=h??d,document.body.appendChild(S),S.select(),document.execCommand("copy"),S.remove(),a(!0)},x=()=>{tre()},m=async()=>{Az()},b=new URL(nre);return b.searchParams.set("title",d),b.searchParams.set("labels","bug"),b.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??d}
\`\`\`

My browser: ${navigator.userAgent}`),f.jsxs("div",{ref:r,className:Me("tl-container tl-error-boundary",g===null?"":g?"tl-theme__dark":"tl-theme__light"),children:[f.jsx("div",{className:"tl-error-boundary__overlay"}),e&&f.jsx(sz,{onError:Sl,fallback:()=>null,children:f.jsx(bf.Provider,{value:e,children:f.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:u?f.jsx(u,{}):null})})}),f.jsx("div",{className:Me("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":i&&!c}),children:c?f.jsxs(f.Fragment,{children:[f.jsx("h2",{children:"Are you sure?"}),f.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),f.jsxs("div",{className:"tl-error-boundary__content__actions",children:[f.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),f.jsx("button",{className:"tl-error-boundary__reset",onClick:m,children:"Reset data"})]})]}):f.jsxs(f.Fragment,{children:[f.jsx("h2",{children:"Something's gone wrong."}),f.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",f.jsx("a",{href:b.toString(),children:"create a GitHub issue"})," or"," ",f.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),i&&f.jsxs(f.Fragment,{children:["Message:",f.jsx("h4",{children:f.jsx("code",{children:d})}),"Stack trace:",f.jsxs("div",{className:"tl-error-boundary__content__error",children:[f.jsx("pre",{children:f.jsx("code",{children:h??d})}),f.jsx("button",{onClick:v,children:o?"Copied!":"Copy"})]})]}),f.jsxs("div",{className:"tl-error-boundary__content__actions",children:[f.jsx("button",{onClick:()=>s(!i),children:i?"Hide details":"Show details"}),f.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[f.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),f.jsx("button",{className:"tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})};let rre=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");function kt(){return rre()}const Rz="TLDRAW_USER_DATA_v3",Oz=He({id:ze,name:ze.nullable().optional(),locale:ze.nullable().optional(),color:ze.nullable().optional(),colorScheme:yf("light","dark","system").optional(),animationSpeed:Oe.nullable().optional(),edgeScrollSpeed:Oe.nullable().optional(),isSnapMode:Ue.nullable().optional(),isWrapMode:Ue.nullable().optional(),isDynamicSizeMode:Ue.nullable().optional(),isPasteAtCursorMode:Ue.nullable().optional()}),$i={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},N_=Math.max(...Object.values($i));function ire(n){n.version<$i.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<$i.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<$i.MakeFieldsNullable,n.version<$i.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<$i.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<$i.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<$i.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<$i.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=N_}const _w=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function Dz(){return _w[Math.floor(Math.random()*_w.length)]}function sre(){return typeof window<"u"&&"matchMedia"in window?window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1:!1}const Ni=Object.freeze({name:"New User",locale:Aee(),color:Dz(),edgeScrollSpeed:1,animationSpeed:sre()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function uS(){return{id:kt(),color:Dz()}}function Nz(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return uS();const e=ft(n);ire(e);try{return Oz.validate(e.user)}catch{return uS()}}function ore(){const n=JSON.parse(m_(Rz)||"null")??null;return Nz(n)}const _f=Vt("globalUserData",null);function are(){y_(Rz,JSON.stringify({version:N_,user:_f.get()}))}function Lz(n){Oz.validate(n),_f.set(n),are(),cre()}const Fz=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;Fz?.addEventListener("message",n=>{const e=n.data;e?.type===$z&&e?.origin!==zz()&&_f.set(Nz(e.data))});let dS=null;function zz(){return dS===null&&(dS=kt()),dS}const $z="tldraw-user-preferences-change";function cre(){Fz?.postMessage({type:$z,origin:zz(),data:{user:Bz(),version:N_}})}function Bz(){let n=_f.get();return n||(n=ore(),Lz(n)),n}const lre=oe("defaultLocalStorageUserPrefs",()=>Bz());function Uz(n={}){return{userPreferences:n.userPreferences??lre,setUserPreferences:n.setUserPreferences??Lz}}var hS={exports:{}},LR;function ure(){return LR||(LR=1,(function(n){var e=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function s(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function o(l,u,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new s(d,h||l,p),y=r?r+u:u;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],g]:l._events[y].push(g):(l._events[y]=g,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],d,h;if(this._eventsCount===0)return u;for(h in d=this._events)e.call(d,h)&&u.push(r?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},c.prototype.listeners=function(u){var d=r?r+u:u,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,g=h.length,y=new Array(g);p<g;p++)y[p]=h[p].fn;return y},c.prototype.listenerCount=function(u){var d=r?r+u:u,h=this._events[d];return h?h.fn?1:h.length:0},c.prototype.emit=function(u,d,h,p,g,y){var v=r?r+u:u;if(!this._events[v])return!1;var x=this._events[v],m=arguments.length,b,S;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),m){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,h),!0;case 4:return x.fn.call(x.context,d,h,p),!0;case 5:return x.fn.call(x.context,d,h,p,g),!0;case 6:return x.fn.call(x.context,d,h,p,g,y),!0}for(S=1,b=new Array(m-1);S<m;S++)b[S-1]=arguments[S];x.fn.apply(x.context,b)}else{var w=x.length,I;for(S=0;S<w;S++)switch(x[S].once&&this.removeListener(u,x[S].fn,void 0,!0),m){case 1:x[S].fn.call(x[S].context);break;case 2:x[S].fn.call(x[S].context,d);break;case 3:x[S].fn.call(x[S].context,d,h);break;case 4:x[S].fn.call(x[S].context,d,h,p);break;default:if(!b)for(I=1,b=new Array(m-1);I<m;I++)b[I-1]=arguments[I];x[S].fn.apply(x[S].context,b)}}return!0},c.prototype.on=function(u,d,h){return o(this,u,d,h,!1)},c.prototype.once=function(u,d,h){return o(this,u,d,h,!0)},c.prototype.removeListener=function(u,d,h,p){var g=r?r+u:u;if(!this._events[g])return this;if(!d)return a(this,g),this;var y=this._events[g];if(y.fn)y.fn===d&&(!p||y.once)&&(!h||y.context===h)&&a(this,g);else{for(var v=0,x=[],m=y.length;v<m;v++)(y[v].fn!==d||p&&!y[v].once||h&&y[v].context!==h)&&x.push(y[v]);x.length?this._events[g]=x.length===1?x[0]:x:a(this,g)}return this},c.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&a(this,d)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,n.exports=c})(hS)),hS.exports}var dre=ure();const hre=rs(dre),ba="TLDRAW_TAB_ID_v2",Ns=globalThis.window;function fre(){return Ns?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Ns.navigator.platform)||Ns.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const lh=Ns?Ns[ba]??oF(ba)??"TLDRAW_INSTANCE_STATE_V1_"+kt():"<error>";Ns&&(Ns[ba]=lh,fre()?v_(ba,lh):aF(ba));Ns?.addEventListener("beforeunload",()=>{v_(ba,lh)});const qz={Initial:0},Cf=Math.max(...Object.values(qz));function pre(n){n.version<qz.Initial,n.version=Cf}const Hz=He({version:Oe,currentPageId:Cl,isFocusMode:Ue,exportBackground:Ue,isDebugMode:Ue,isToolLocked:Ue,isGridMode:Ue,pageStates:sn(He({pageId:Cl,camera:He({x:Oe,y:Oe,z:Oe}),selectedShapeIds:sn(wr),focusedGroupId:wr.nullable()}))});function gre(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==Cf&&(n=ft(n),pre(n));try{return Hz.validate(n)}catch(e){return console.warn(e),null}}function Gz(n){const e=n.query.ids("page");return oe("sessionStateSnapshot",()=>{const r=n.get(kn);if(!r)return null;const i=[...e.get()];return{version:Cf,currentPageId:r.currentPageId,exportBackground:r.exportBackground,isFocusMode:r.isFocusMode,isDebugMode:r.isDebugMode,isToolLocked:r.isToolLocked,isGridMode:r.isGridMode,pageStates:i.map(s=>{const o=n.get(Vr.createId(s)),a=n.get(hi.createId(s));return{pageId:s,camera:{x:a?.x??0,y:a?.y??0,z:a?.z??1},selectedShapeIds:o?.selectedShapeIds??[],focusedGroupId:o?.focusedGroupId??null}})}})}function Kz(n,e){const r=gre(e);if(!r)return;const i=n.schema.types.instance.create({id:kn,...jF(n.get(kn)),currentPageId:r.currentPageId,isDebugMode:r.isDebugMode,isFocusMode:r.isFocusMode,isToolLocked:r.isToolLocked,isGridMode:r.isGridMode,exportBackground:r.exportBackground}),s=n.allRecords().filter(o=>o.typeName==="instance_page_state"||o.typeName==="camera");n.atomic(()=>{n.remove(s.map(o=>o.id));for(const o of r.pageStates)n.put([hi.create({id:hi.createId(o.pageId),x:o.camera.x,y:o.camera.y,z:o.camera.z}),Vr.create({id:Vr.createId(o.pageId),pageId:o.pageId,selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId})]);n.put([i]),n.ensureStoreIsUsable()})}function mre(n){const e=[];for(const s of Object.values(n))s.typeName?.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const r=e.filter(s=>s.typeName==="instance"&&s.id!==kn)[0];if(!r)return null;const i={version:Cf,currentPageId:r.currentPageId,exportBackground:!!r.exportBackground,isFocusMode:!!r.isFocusMode,isDebugMode:!!r.isDebugMode,isToolLocked:!!r.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===r.id).map(s=>{const o=n[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return Hz.validate(i),i}catch{return null}}function L_(n,e){let r={};if("store"in e){const s=n.schema.migrateStoreSnapshot(e);if(s.type!=="success")throw new Error("Failed to migrate store snapshot: "+s.reason);r.document={schema:n.schema.serialize(),store:el(s.value,(o,{typeName:a})=>n.scopedTypes.document.has(a))}}else r=e;const i=jF(n.get(kn));n.atomic(()=>{r.document&&n.loadStoreSnapshot(r.document),i&&n.update(kn,s=>({...s,...i})),r.session&&Kz(n,r.session)})}const yre=new es;function Vz(n){const r=yre.get(n,Gz).get();if(!r)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:r}}function Wz(n){const e=[],r=new Set;for(const i of n){if(r.has(i.type))throw new Error(`Binding type "${i.type}" is defined more than once`);e.push(i),r.add(i.type)}return e}function $s({children:n,className:e="",...r}){return f.jsx("svg",{...r,className:Me("tl-svg-container",e),children:n})}function F_(n,e,r,i){const s=n.x-r.x,o=n.y-r.y,a=i.x-r.x,c=i.y-r.y,l=e.x-n.x,u=e.y-n.y,d=a*o-c*s,h=l*o-u*s,p=c*l-a*u;if(d===0||h===0||p===0)return null;if(p!==0){const g=d/p,y=h/p;if(0<=g&&g<=1&&0<=y&&y<=1)return k.AddXY(n,g*l,g*u)}return null}function cu(n,e,r,i){const s=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),o=2*((e.x-n.x)*(n.x-r.x)+(e.y-n.y)*(n.y-r.y)),a=r.x*r.x+r.y*r.y+n.x*n.x+n.y*n.y-2*(r.x*n.x+r.y*n.y)-i*i,c=o*o-4*s*a;if(c<0||c===0)return null;const l=Math.sqrt(c),u=(-o+l)/(2*s),d=(-o-l)/(2*s);if((u<0||u>1)&&(d<0||d>1))return null;const h=[];return 0<=u&&u<=1&&h.push(k.Lrp(n,e,u)),0<=d&&d<=1&&h.push(k.Lrp(n,e,d)),h.length===0?null:h}function vre(n,e,r){const i=[];let s;for(let o=0,a=r.length-1;o<a;o++)s=F_(n,e,r[o],r[o+1]),s&&i.push(s);return i.length===0?null:i}function z_(n,e,r){const i=[];let s;for(let o=1,a=r.length;o<a+1;o++)s=F_(n,e,r[o-1],r[o%r.length]),s&&i.push(s);return i.length===0?null:i}function xre(n,e,r,i){let s=r.x-n.x,o=r.y-n.y;const a=Math.sqrt(s*s+o*o),c=(a*a-i*i+e*e)/(2*a),l=Math.sqrt(e*e-c*c);return s/=a,o/=a,[new k(n.x+s*c-o*l,n.y+o*c+s*l),new k(n.x+s*c+o*l,n.y+o*c-s*l)]}function Cw(n,e,r){const i=[];let s,o,a;for(let c=0,l=r.length;c<l;c++)s=r[c],o=r[(c+1)%r.length],a=cu(s,o,n,e),a&&i.push(...a);return i.length===0?null:i}function FR(n,e,r){const i=[];let s,o,a;for(let c=1,l=r.length;c<l;c++)s=r[c-1],o=r[c],a=cu(s,o,n,e),a&&i.push(...a);return i.length===0?null:i}function Wu(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function $_(n,e,r,i){return Wu(n,r,i)!==Wu(e,r,i)&&Wu(n,e,r)!==Wu(n,e,i)}function zR(n,e){const r=new Map;let i,s,o,a;for(let c=0,l=n.length;c<l;c++)if(i=n[c],ar(i,e)){const u=fS(i);r.has(u)||r.set(u,i)}for(let c=0,l=e.length;c<l;c++)if(i=e[c],ar(i,n)){const u=fS(i);r.has(u)||r.set(u,i)}for(let c=0,l=n.length;c<l;c++){i=n[c],s=n[(c+1)%n.length];for(let u=0,d=e.length;u<d;u++){o=e[u],a=e[(u+1)%e.length];const h=F_(i,s,o,a);if(h!==null){const p=fS(h);r.has(p)||r.set(p,h)}}}return r.size===0?null:bre([...r.values()])}function fS(n){return`${n.x},${n.y}`}function bre(n){const e=k.Average(n);return n.sort((r,i)=>k.Angle(e,r)-k.Angle(e,i))}function Yz(n,e){let r,i,s,o;for(let a=0,c=n.length;a<c;a++){r=n[a],i=n[(a+1)%c];for(let l=0,u=e.length;l<u;l++)if(s=e[l],o=e[(l+1)%u],$_(r,i,s,o))return!0}return!1}function Sre(n,e){let r,i,s,o;for(let a=0,c=n.length;a<c;a++){r=n[a],i=n[(a+1)%c];for(let l=1,u=e.length;l<u;l++)if(s=e[l-1],o=e[l],$_(r,i,s,o))return!0}return!1}class Ki extends Hs{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{start:r,end:i}=e;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:r,end:i,u:s,ul:o}=this;if(o===0)return r;const a=k.Sub(e,r).dpr(s)/o,c=r.x+s.x*a;if(c<Math.min(r.x,i.x))return r.x<i.x?r:i;if(c>Math.max(r.x,i.x))return r.x>i.x?r:i;const l=r.y+s.y*a;return l<Math.min(r.y,i.y)?r.y<i.y?r:i:l>Math.max(r.y,i.y)?r.y>i.y?r:i:new k(c,l)}hitTestLineSegment(e,r,i=0){return $_(e,r,this.start,this.end)||this.distanceToLineSegment(e,r)<=i}getSvgPathData(e=!0){const{start:r,end:i}=this;return`${e?`M${r.toFixed()}`:""} L${i.toFixed()}`}}class Ya extends Hs{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});const{points:r}=e;this.points=r}_segments;get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let r=0,i=e.length-1;r<i;r++){const s=e[r],o=e[r+1];this._segments.push(new Ki({start:s,end:o}))}this.isClosed&&this._segments.push(new Ki({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,r)=>e+r.length,0)}getVertices(){return this.points}nearestPoint(e){const{segments:r}=this;let i=this.points[0],s=1/0,o,a;for(let c=0;c<r.length;c++)o=r[c].nearestPoint(e),a=k.Dist2(o,e),a<s&&(i=o,s=a);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(e,r,i=0){const{segments:s}=this;for(let o=0,a=s.length;o<a;o++)if(s[o].hitTestLineSegment(e,r,i))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce((r,i,s)=>s===0?`M ${i.x} ${i.y}`:`${r} L ${i.x} ${i.y}`,"")}}class Ot extends Ya{constructor(e){super({...e}),this.isClosed=!0}}class ns extends Ot{x;y;w;h;constructor(e){const{x:r=0,y:i=0,width:s,height:o}=e;super({...e,points:[new k(r,i),new k(r+s,i),new k(r+s,i+o),new k(r,i+o)]}),this.x=r,this.y=i,this.w=s,this.h=o}getBounds(){return new pe(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:e,y:r,w:i,h:s}=this;return`M${e},${r} h${i} v${s} h-${i}z`}}class Gs{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canBind(e){return!0}canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;canBeLaidOut=()=>!0;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;canReceiveNewChildrenOfType(e,r){return!1}canDropShapes(e,r){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}function wre(n,e,r={}){const{closed:i=!1,snap:s=1,start:o="outset",end:a="outset",lengthRatio:c=2,style:l="dashed"}=r;let u=0,d=0,h=1,p=0,g=0;switch(l){case"dashed":{h=1,u=Math.min(e*c,n/4);break}case"dotted":{h=100,u=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return i||(o==="outset"?(n+=u/2,g+=u/2):o==="skip"&&(n-=u,g-=u),a==="outset"?n+=u/2:a==="skip"&&(n-=u)),d=Math.floor(n/u/(2*h)),d-=d%s,d<3&&l==="dashed"?n/e<5?(u=n,d=1,p=0):(u=n*.333,p=n*.333):(d=Math.max(d,3),u=n/d/(2*h),i?(g=u/2,p=(n-d*u)/d):p=(n-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,p].join(" "),strokeDashoffset:g.toString()}}function $R({bounds:n,className:e}){const r=Z(),i=ne("zoom level",()=>r.getZoomLevel(),[r]);return f.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((s,o)=>{const{strokeDasharray:a,strokeDashoffset:c}=wre(s[0].dist(s[1]),1/i,{style:"dashed",lengthRatio:4});return f.jsx("line",{x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y,strokeDasharray:a,strokeDashoffset:c},o)})})}class _re extends Gs{static type="group";static props=HF;static migrations=GF;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){const r=this.editor.getSortedChildIdsForParent(e.id);return r.length===0?new ns({width:1,height:1,isFilled:!1}):new Qr({children:r.map(i=>{const s=this.editor.getShape(i),o=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(s).applyToPoints(o.vertices);return o.isClosed?new Ot({points:a,isFilled:!0}):new Ya({points:a})})})}component(e){const r=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),s=i.length>0&&i.some(c=>c!==e.id&&this.editor.isShapeOfType(this.editor.getShape(c),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!r&&(o||s))return null;const a=this.editor.getShapeGeometry(e).bounds;return f.jsx($s,{id:e.id,children:f.jsx($R,{className:"tl-group",bounds:a})})}indicator(e){const r=this.editor.getShapeGeometry(e).bounds;return f.jsx($R,{className:"",bounds:r})}onChildrenChange=e=>{const r=this.editor.getSortedChildIdsForParent(e.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,e.parentId),this.editor.deleteShapes([e.id]);return}}}const Xz=[_re],Cre=new Set(Xz.map(n=>n.type));function Zz(n){const e=[...Xz],r=new Set;for(const i of n){if(Cre.has(i.type))throw new Error(`Shape type "${i.type}" is a core shapes type and cannot be overridden`);if(r.has(i.type))throw new Error(`Shape type "${i.type}" is defined more than once`);e.push(i),r.add(i.type)}return e}const Pre={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function BR(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw wn(n)}}class Ire{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const r=this.get(e);if(r&&r.type!=="mixed")return r.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const r=new Set;for(const[i,s]of this){if(!BR(s,e.get(i)))return!1;r.add(i)}for(const[i,s]of e)if(!r.has(i)&&!BR(s,this.get(i)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Pw extends Ire{set(e,r){this.map.set(e,r)}applyValue(e,r){const i=this.get(e);if(!i){this.set(e,{type:"shared",value:r});return}switch(i.type){case"mixed":return;case"shared":i.value!==r&&this.set(e,{type:"mixed"});return;default:wn(i,"type")}}}function Ere(n,e,r){return bi(n).then(function(i){return i.arrayBuffer()}).then(function(i){return new File([i],e,{type:r})})}const kre="https://cdn.tldraw.com";function ks(){return`${kre}/${iz}`}function Tre(n,e){let r=n;const i=new Set(e);for(;i.has(r);)r=/^.*(\d+)$/.exec(r)?.[1]?r.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${r} 1`;return r}function Yu(n,e,r){if(r.length===0)return[];const i=new Map;for(const o of Be(r.map(a=>n.getShape(a)))){const{parentId:a}=o;i.has(a)||i.set(a,{children:Be(n.getSortedChildIdsForParent(a).map(c=>n.getShape(c))),moving:new Set}),i.get(a).moving.add(o)}const s=[];switch(e){case"toBack":{i.forEach(({moving:o,children:a})=>Mre(o,a,s));break}case"toFront":{i.forEach(({moving:o,children:a})=>Are(o,a,s));break}case"forward":{i.forEach(({moving:o,children:a})=>jre(o,a,s));break}case"backward":{i.forEach(({moving:o,children:a})=>Rre(o,a,s));break}}return s}function Mre(n,e,r){const i=e.length;if(n.size===i)return;let s,o;for(let a=0;a<i;a++){const c=e[a];if(n.has(c))s=c.index,n.delete(c);else{o=c.index;break}}if(n.size!==0){const a=Ma(s,o,n.size);r.push(...Array.from(n.values()).sort(bn).map((c,l)=>({...c,index:a[l]})))}}function Are(n,e,r){const i=e.length;if(n.size===i)return;let s,o;for(let a=i-1;a>-1;a--){const c=e[a];if(n.has(c))o=c.index,n.delete(c);else{s=c.index;break}}if(n.size!==0){const a=Ma(s,o,n.size);r.push(...Array.from(n.values()).sort(bn).map((c,l)=>({...c,index:a[l]})))}}function jre(n,e,r){const i=e.length;if(n.size===i)return;let s={name:"skipping"};for(let o=0;o<i;o++){const a=n.has(e[o]);switch(s.name){case"skipping":{if(!a)continue;s={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;const{selectIndex:c}=s;Ma(e[o].index,e[o+1]?.index,o-c).forEach((l,u)=>r.push({...e[c+u],index:l})),s={name:"skipping"};break}}}}function Rre(n,e,r){const i=e.length;if(n.size===i)return;let s={name:"skipping"};for(let o=i-1;o>-1;o--){const a=n.has(e[o]);switch(s.name){case"skipping":{if(!a)continue;s={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;Ma(e[o-1]?.index,e[o].index,s.selectIndex-o).forEach((c,l)=>{r.push({...e[o+l+1],index:c})}),s={name:"skipping"};break}}}}function Qz({editor:n}){const e=n.getSelectedShapes(),r=n.getSelectionRotation(),i=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:s}}=n;if(!i)return null;const o=i.center.clone().rotWith(i.point,r);return{selectionPageCenter:o,initialCursorAngle:o.angle(s),initialSelectionRotation:r,shapeSnapshots:e.map(a=>({shape:ft(a),initialPagePoint:n.getShapePageTransform(a.id).point()}))}}function kd({delta:n,editor:e,snapshot:r,stage:i}){const{selectionPageCenter:s,shapeSnapshots:o}=r;e.updateShapes(o.map(({shape:c,initialPagePoint:l})=>{const u=zn(c.parentId)?e.getShapePageTransform(c.parentId):de.Identity(),d=k.RotWith(l,s,n),h=de.applyToPoint(de.Inverse(u),d),p=Ds(c.rotation+n);return{id:c.id,type:c.type,x:h.x,y:h.y,rotation:p}}));const a=[];o.forEach(({shape:c})=>{const l=e.getShape(c.id);if(!l)return;const u=e.getShapeUtil(c);if(i==="start"||i==="one-off"){const h=u.onRotateStart?.(c);h&&a.push(h)}const d=u.onRotate?.(c,l);if(d&&a.push(d),i==="end"||i==="one-off"){const h=u.onRotateEnd?.(c,l);h&&a.push(h)}}),a.length>0&&e.updateShapes(a)}const Ore=n=>{const{store:e}=n,r=e.query.filterHistory("binding"),i=e.query.records("binding");function s(){const o=i.get(),a=new Map;for(const c of o){const{fromId:l,toId:u}=c,d=a.get(l);d?d.push(c):a.set(l,[c]);const h=a.get(u);h?h.push(c):a.set(u,[c])}return a}return oe("arrowBindingsIndex",(o,a)=>{if(go(o))return s();const c=o,l=r.getDiffSince(a);if(l===sr)return s();let u;function d(g){u??=new Map(c);const v=u.get(g.fromId)?.filter(b=>b.id!==g.id);v?.length?u.set(g.fromId,v):u.delete(g.fromId);const m=u.get(g.toId)?.filter(b=>b.id!==g.id);m?.length?u.set(g.toId,m):u.delete(g.toId)}function h(g){u??=new Map(c);let y=u.get(g);return y?y===c.get(g)&&(y=y.slice(0),u.set(g,y)):(y=[],u.set(g,y)),y}function p(g){h(g.fromId).push(g),h(g.toId).push(g)}for(const g of l){for(const y of jt(g.added))p(y);for(const[y,v]of jt(g.updated))d(y),p(v);for(const y of jt(g.removed))d(y)}return u??c})};function Dre(n,e,r){const i=n.getShapeMaskedPageBounds(e);return i===void 0?!0:!r.includes(i)}const Nre=n=>{function e(r){const i=r.getCurrentPageShapeIds(),s=r.getViewportPageBounds(),o=new Set;return i.forEach(a=>{Dre(r,a,s)&&o.add(a)}),o}return oe("getCulledShapes",r=>{if(go(r))return e(n);const i=e(n);if(r.size!==i.size)return i;for(const s of r)if(!i.has(s))return i;return r})},Lre=n=>{const e=n.query.ids("shape"),r=n.query.filterHistory("shape");function i(){const s={},o=e.get(),a=Array(o.size);return o.forEach(c=>a.push(n.get(c))),a.sort(bn),a.forEach(c=>{s[c.parentId]||(s[c.parentId]=[]),s[c.parentId].push(c.id)}),s}return oe("parentsToChildrenWithIndexes",(s,o)=>{if(go(s))return i();const a=r.getDiffSince(o);if(a===sr)return i();if(a.length===0)return s;let c=null;const l=h=>{c||(c={...s}),c[h]?c[h]===s[h]&&(c[h]=[...c[h]]):c[h]=[]},u=new Set;let d;for(let h=0,p=a.length;h<p;h++){d=a[h];for(const g of Object.values(d.added))ua(g)&&(l(g.parentId),c[g.parentId].push(g.id),u.add(c[g.parentId]));for(const[g,y]of Object.values(d.updated))if(ua(y)&&ua(g)){if(g.parentId!==y.parentId)l(g.parentId),l(y.parentId),c[g.parentId].splice(c[g.parentId].indexOf(y.id),1),c[y.parentId].push(y.id),u.add(c[y.parentId]);else if(g.index!==y.index){l(y.parentId);const v=c[y.parentId].indexOf(y.id);c[y.parentId][v]=y.id,u.add(c[y.parentId])}}for(const g of Object.values(d.removed))ua(g)&&(l(g.parentId),c[g.parentId].splice(c[g.parentId].indexOf(g.id),1))}for(const h of u){const p=Be(h.map(g=>n.get(g)));p.sort(bn),h.splice(0,h.length,...p.map(g=>g.id))}return c??s})},pS=(n,e,r)=>{for(;!Ln(r.parentId);){const i=n.get(r.parentId);if(!i)return!1;r=i}return r.parentId===e},Fre=(n,e)=>{const r=n.query.ids("shape");let i=null;function s(){const o=e();return i=o,new Set([...r.get()].filter(a=>pS(n,o,n.get(a))))}return oe("_shapeIdsInCurrentPage",(o,a)=>{if(go(o))return s();const c=e();if(c!==i)return s();const l=n.history.getDiffSince(a);if(l===sr)return s();const u=new Cd(o);for(const h of l){for(const p of Object.values(h.added))ua(p)&&pS(n,c,p)&&u.add(p.id);for(const[p,g]of Object.values(h.updated))ua(g)&&(pS(n,c,g)?u.add(g.id):u.remove(g.id));for(const p of Object.keys(h.removed))zn(p)&&u.remove(p)}const d=u.get();return d?Fc(d.value,d.diff):o})},Jz=E.createContext(null);function zre({context:n,editor:e,children:r}){return f.jsx(bf.Provider,{value:e,children:f.jsx(Jz.Provider,{value:n,children:r})})}function e$(){const n=E.useContext(Jz);return n?{isDarkMode:n.isDarkMode}:null}async function $re(n,e,r={}){const i=typeof e[0]=="string"?e:e.map(I=>I.id);if(i.length===0)return;if(!window.document)throw Error("No document");const{scale:s=1,background:o=!1,padding:a=n.options.defaultSvgPadding,preserveAspectRatio:c=!1}=r,l=r.darkMode??n.user.getIsDarkMode(),u=ds({isDarkMode:l}),d=n.getShapeAndDescendantIds(i),h=n.getUnorderedRenderingShapes(!1).filter(({id:I})=>d.has(I));let p=null;if(r.bounds)p=r.bounds;else for(const{id:I}of h){const C=n.getShapeMaskedPageBounds(I);C&&(p?p.union(C):p=C.clone())}if(!p)return;const g=i.length===1&&n.isShapeOfType(n.getShape(i[0]),"frame")?i[0]:null;g||p.expandBy(a);const y=p.width*s,v=p.height*s;try{document.body.focus?.()}catch{}const x=[],m=new Map,b={isDarkMode:l,addExportDef:I=>{if(m.has(I.key))return;const C=(async()=>{const _=await I.getElement();_&&x.push(f.jsx(E.Fragment,{children:_},x.length))})();m.set(I.key,C)}},S=(await Promise.all(h.map(async({id:I,opacity:C,index:_,backgroundIndex:P})=>{if(I===g)return[];const M=n.getShape(I);if(n.isShapeOfType(M,"group"))return[];const T=n.getShapeUtil(M);let A=await T.toSvg?.(M,b),R=await T.toBackgroundSvg?.(M,b);if(!A&&!R){const N=n.getShapePageBounds(M);A=f.jsx("rect",{width:N.w,height:N.h,fill:u.solid,stroke:u.grey.pattern,strokeWidth:1})}let O=n.getShapePageTransform(M).toCssString();"scale"in M.props&&M.props.scale!==1&&(O=`${O} scale(${M.props.scale}, ${M.props.scale})`),A&&(A=f.jsx("g",{transform:O,opacity:C,children:A},M.id)),R&&(R=f.jsx("g",{transform:O,opacity:C,children:R},`bg_${M.id}`));const j=n.getShapeMask(M.id);if(j){const N=`mask_${M.id.replace(":","_")}`;x.push(f.jsx("clipPath",{id:N,children:f.jsx("path",{d:`M${j.map(({x:F,y:z})=>`${F},${z}`).join("L")}Z`})},x.length)),A&&(A=f.jsx("g",{clipPath:`url(#${N})`,children:A},M.id)),R&&(R=f.jsx("g",{clipPath:`url(#${N})`,children:R},`bg_${M.id}`))}const D=[];return A&&D.push({zIndex:_,element:A}),R&&D.push({zIndex:P,element:R}),D}))).flat();return await Promise.all(m.values()),{jsx:f.jsx(zre,{editor:n,context:b,children:f.jsxs("svg",{preserveAspectRatio:c||void 0,direction:"ltr",width:y,height:v,viewBox:`${p.minX} ${p.minY} ${p.width} ${p.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:o?g?u.solid:u.background:"transparent"},children:[f.jsx("defs",{children:x}),S.sort((I,C)=>I.zIndex-C.zIndex).map(({element:I})=>I)]})}),width:y,height:v}}const Bre=40;class Ure{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,r=kt())=>{this._clickId=r,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===r){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};handlePointerEvent=e=>{switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=k.From(e.point),this._previousScreenPoint&&k.Dist2(this._previousScreenPoint,this._clickScreenPoint)>Bre**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=k.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&k.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}class qre{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){const{editor:r}=this,i=this.getEdgeScroll();if(i.x===0&&i.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>r.options.edgeScrollDelay){const s=r.options.edgeScrollEaseDuration>0?Wt.easeInCubic(Math.min(1,this._edgeScrollDuration/(r.options.edgeScrollDelay+r.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:i.x*s,y:i.y*s})}}getEdgeProximityFactors(e,r,i,s,o){const{editor:a}=this,c=a.options.edgeScrollDistance,l=i?a.options.coarsePointerWidth:0,u=e-l,d=e+l,h=s?0:c,p=o?r:r-c;return u<h?Math.min(1,(h-u)/c):d>p?-Math.min(1,(d-p)/c):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:r,y:i}}}=e,s=e.getViewportScreenBounds(),{isCoarsePointer:o,insets:[a,c,l,u]}=e.getInstanceState(),d=this.getEdgeProximityFactors(r,s.w,o,u,c),h=this.getEdgeProximityFactors(i,s.h,o,a,l);return{x:d,y:h}}moveCameraWhenCloseToEdge(e){const{editor:r}=this;if(!r.inputs.isDragging||r.inputs.isPanning||r.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const i=r.getViewportScreenBounds(),s=i.w<1e3?.612:1,o=i.h<1e3?.612:1,a=r.getZoomLevel(),c=r.user.getEdgeScrollSpeed()*r.options.edgeScrollSpeed,l=c*e.x*s/a,u=c*e.y*o/a,{x:d,y:h,z:p}=r.getCamera();r.setCamera(new k(d+l,h+u,p))}}class Hre{constructor(e){this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}class Gre{constructor(e,r){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(s,o)=>{s.isFocused!==o.isFocused&&(o.isFocused?this.focus():this.blur(),this.updateContainerClass())});const i=e.getInstanceState().isFocused;r!==i&&e.updateInstanceState({isFocused:!!r}),this.updateContainerClass()}disposeSideEffectListener;updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){this.disposeSideEffectListener?.()}}function yc(n){return Vre}class Kre{length=0;head=null;tail=this;push(e){return new B_(e,this)}toArray(){return Yi}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const Vre=new Kre;class B_{constructor(e,r){this.head=e,this.tail=r,this.length=r.length+1}length;push(e){return new B_(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const r=e.head;return e=e.tail,{value:r,done:!1}}else return{value:void 0,done:!0}}}}}class Wre{store;dispose;state="recording";pendingDiff=new Xre;stacks=Vt("HistoryManager.stacks",{undos:yc(),redos:yc()},{isEqual:(e,r)=>e.undos===r.undos&&e.redos===r.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??Sl,this.dispose=this.store.addHistoryInterceptor((r,i)=>{if(i==="user")switch(this.state){case"recording":this.pendingDiff.apply(r.changes),this.stacks.update(({undos:s})=>({undos:s,redos:yc()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(r.changes);break;case"paused":break;default:wn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:r,redos:i})=>({undos:r.push({type:"diff",diff:e}),redos:i}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch=(e,r)=>{const i=this.state;i!=="paused"&&r?.history&&(this.state=Yre[r.history]);try{if(this._isInBatch)return mi(e),this;this._isInBatch=!0;try{mi(e)}catch(s){throw this.annotateError(s),s}finally{this._isInBatch=!1}return this}finally{this.state=i}};_undo=({pushToRedoStack:e,toMark:r=void 0})=>{const i=this.state;this.state="paused";try{let{undos:s,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),c=pF(a),l=pw(a);e&&!c&&(o=o.push({type:"diff",diff:a}));let u=!1;if(c)for(;s.head?.type==="stop";){const d=s.head;if(s=s.tail,e&&(o=o.push(d)),d.id===r){u=!0;break}}if(!u)e:for(;s.head;){const d=s.head;switch(s=s.tail,e&&(o=o.push(d)),d.type){case"diff":tl(l,[pw(d.diff)]);break;case"stop":if(!r||d.id===r)break e;break;default:wn(d)}}this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:o})}finally{this.state=i}return this};undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>{const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:i}=this.stacks.get();if(i.length===0)return this;for(;i.head?.type==="stop";)r=r.push(i.head),i=i.tail;const s=Wd();for(;i.head;){const o=i.head;if(r=r.push(o),i=i.tail,o.type==="diff")tl(s,[o.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:i})}finally{this.state=e}return this};bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);squashToMark=e=>{let r=this.stacks.get().undos;const i=[];for(;r.head&&!(r.head.type==="stop"&&r.head.id===e);)r.head.type==="diff"&&i.push(r.head.diff),r=r.tail;if(!r.head||r.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(i.length===0)return this;const s=Wd();return tl(s,i.reverse()),this.stacks.update(({redos:o})=>({undos:r.push({type:"diff",diff:s}),redos:o})),this};mark=(e=kt())=>(mi(()=>{this.flushPendingDiff(),this.stacks.update(({undos:r,redos:i})=>({undos:r.push({type:"stop",id:e}),redos:i}))}),e);clear(){this.stacks.set({undos:yc(),redos:yc()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:r}=this.stacks.get();return{undos:e.toArray(),redos:r.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const Yre={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class Xre{diff=Wd();isEmptyAtom=Vt("PendingDiff.isEmpty",!0);clear(){const e=this.diff;return this.diff=Wd(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){tl(this.diff,[e]),this.isEmptyAtom.set(pF(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class Zre{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,r=kt())=>{const i={id:r,scribble:{id:r,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(r,i),i};reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop=e=>{const r=this.scribbleItems.get(e);if(!r)throw Error(`Scribble with id ${e} not found`);return r.delayRemaining=Math.min(r.delayRemaining,200),r.scribble.state="stopping",r};addPoint=(e,r,i)=>{const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:o}=s,a={x:r,y:i,z:.5};return(!o||k.Dist(o,a)>=1)&&(s.next=a),s};tick=e=>{this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(r=>{if(r.scribble.state==="starting"){const{next:l,prev:u}=r;l&&l!==u&&(r.prev=l,r.scribble.points.push(l)),r.scribble.points.length>8&&(r.scribble.state="active");return}r.delayRemaining>0&&(r.delayRemaining=Math.max(0,r.delayRemaining-e)),r.timeoutMs+=e,r.timeoutMs>=16&&(r.timeoutMs=0);const{delayRemaining:i,timeoutMs:s,prev:o,next:a,scribble:c}=r;switch(c.state){case"active":{a&&a!==o?(r.prev=a,c.points.push(a),i===0&&c.points.length>8&&c.points.shift()):s===0&&(c.points.length>1?c.points.shift():r.delayRemaining=c.delay);break}case"stopping":{if(r.delayRemaining===0&&s===0){if(c.points.length===1){this.scribbleItems.delete(r.id);return}c.shrink&&(c.size=Math.max(1,c.size*(1-c.shrink))),c.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:r})=>({...r,points:[...r.points]})).slice(-5)})})}}var Qre=Object.defineProperty,Jre=Object.getOwnPropertyDescriptor,Pf=(n,e,r,i)=>{for(var s=Jre(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&Qre(e,r,s),s};const je=n=>Math.round(n*10**8)/10**8;function Bi(n,e,r,i,s){const o=n.filter(c=>(i==="forward"?c.startNode.id===e:c.endNode.id===e)&&je(c.length)===je(r)&&Ur(c.breadthIntersection[0],c.breadthIntersection[1],s[0],s[1]));if(o.length===0)return[];const a=new Set;return o.forEach(c=>{const l=i==="forward"?c.endNode.id:c.startNode.id;if(!a.has(l)){a.add(l);const u=Bi(n,l,r,i,Ur(c.breadthIntersection[0],c.breadthIntersection[1],s[0],s[1]));o.push(...u)}}),o}function eie(n){n.sort((e,r)=>r.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const r=n[e];for(let i=e-1;i>=0;i--){const s=n[i];if(s.direction===r.direction&&r.gaps.every(o=>s.gaps.some(a=>je(o.startEdge[0].x)===je(a.startEdge[0].x)&&je(o.startEdge[0].y)===je(a.startEdge[0].y)&&je(o.startEdge[1].x)===je(a.startEdge[1].x)&&je(o.startEdge[1].y)===je(a.startEdge[1].y))&&s.gaps.some(a=>je(o.endEdge[0].x)===je(a.endEdge[0].x)&&je(o.endEdge[0].y)===je(a.endEdge[0].y)&&je(o.endEdge[1].x)===je(a.endEdge[1].x)&&je(o.endEdge[1].y)===je(a.endEdge[1].y)))){n.splice(e,1);break}}}}class lu{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",r=>{const i=e.getShapePageTransform(r.id);if(!i)return;const o=e.getShapeUtil(r).getBoundsSnapGeometry(r).points??e.getShapeGeometry(r).bounds.cornersAndCenter;if(!(!i||!o))return o.map((a,c)=>{const{x:l,y:u}=de.applyToPoint(i,a);return{x:l,y:u,id:`${r.id}:${c}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),r=this.manager.getSnappableShapes(),i=[];for(const s of r){const o=e.get(s);o&&i.push(...o)}return i}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Pr(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],r=[];let i,s;const o=this.getSnappableGapNodes().sort((c,l)=>c.pageBounds.minX-l.pageBounds.minX);for(let c=0;c<o.length;c++){i=o[c];for(let l=c+1;l<o.length;l++)s=o[l],i.pageBounds.maxX<s.pageBounds.minX&&mc(i.pageBounds.minY,i.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)&&e.push({startNode:i,endNode:s,startEdge:[new k(i.pageBounds.maxX,i.pageBounds.minY),new k(i.pageBounds.maxX,i.pageBounds.maxY)],endEdge:[new k(s.pageBounds.minX,s.pageBounds.minY),new k(s.pageBounds.minX,s.pageBounds.maxY)],length:s.pageBounds.minX-i.pageBounds.maxX,breadthIntersection:Ur(i.pageBounds.minY,i.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)})}const a=o.sort((c,l)=>c.pageBounds.minY-l.pageBounds.minY);for(let c=0;c<a.length;c++){i=a[c];for(let l=c+1;l<a.length;l++)s=a[l],i.pageBounds.maxY<s.pageBounds.minY&&mc(i.pageBounds.minX,i.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)&&r.push({startNode:i,endNode:s,startEdge:[new k(i.pageBounds.minX,i.pageBounds.maxY),new k(i.pageBounds.maxX,i.pageBounds.maxY)],endEdge:[new k(s.pageBounds.minX,s.pageBounds.minY),new k(s.pageBounds.maxX,s.pageBounds.minY)],length:s.pageBounds.minY-i.pageBounds.maxY,breadthIntersection:Ur(i.pageBounds.minX,i.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)})}return{horizontal:e,vertical:r}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:r,initialSelectionSnapPoints:i,dragDelta:s}){const o=this.manager.getSnapThreshold(),a=this.getSnappablePoints(),c=r.clone().translate(s),l=i.map(({x,y:m},b)=>({id:"selection:"+b,x:x+s.x,y:m+s.y})),u=a,d=[],h=[],p=new k(o,o);this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:u,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:c,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const g=new k(e==="x"?0:d[0]?.nudge??0,e==="y"?0:h[0]?.nudge??0);p.x=0,p.y=0,d.length=0,h.length=0,l.forEach(x=>{x.x+=g.x,x.y+=g.y}),c.translate(g),this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:u,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:c,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const y=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:h}),v=this.getGapSnapLines({selectionPageBounds:c,nearestSnapsX:d,nearestSnapsY:h});return this.manager.setIndicators([...v,...y]),{nudge:g}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:r,handle:i,isAspectRatioLocked:s,isResizingFromCenter:o}){const a=this.manager.getSnapThreshold(),{box:c,scaleX:l,scaleY:u}=pe.Resize(e,i,o?r.x*2:r.x,o?r.y*2:r.y,s);let d=i;l<0&&(d=one(d)),u<0&&(d=sne(d)),o&&(c.center=e.center);const h=d==="top"||d==="bottom",p=d==="left"||d==="right",g=UR(d,c),y=this.getSnappablePoints(),v=[],x=[],m=new k(a,a);this.collectPointSnaps({minOffset:m,nearestSnapsX:v,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:g});const b=new k(h?0:v[0]?.nudge??0,p?0:x[0]?.nudge??0);if(s&&ane(d)&&b.len()!==0){const _=v.length&&x.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":v.length?"x":"y",P=e.aspectRatio;_==="x"?(x.length=0,b.y=b.x/P,(d==="bottom_left"||d==="top_right")&&(b.y=-b.y)):(v.length=0,b.x=b.y*P,(d==="bottom_left"||d==="top_right")&&(b.x=-b.x))}const S=k.Add(r,b),{box:w}=pe.Resize(e,i,o?S.x*2:S.x,o?S.y*2:S.y,s);o&&(w.center=e.center);const I=UR("any",w);v.length=0,x.length=0,m.x=0,m.y=0,this.collectPointSnaps({minOffset:m,nearestSnapsX:v,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:I});const C=this.getPointSnapLines({nearestSnapsX:v,nearestSnapsY:x});return this.manager.setIndicators([...C]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:r,minOffset:i,nearestSnapsX:s,nearestSnapsY:o}){for(const a of e)for(const c of r){const l=k.Sub(a,c),u=Math.abs(l.x),d=Math.abs(l.y);je(u)<=je(i.x)&&(je(u)<je(i.x)&&(s.length=0),s.push({type:"points",points:{thisPoint:a,otherPoint:c},nudge:c.x-a.x}),i.x=u),je(d)<=je(i.y)&&(je(d)<je(i.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:a,otherPoint:c},nudge:c.y-a.y}),i.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:r,nearestSnapsX:i,nearestSnapsY:s}){const{horizontal:o,vertical:a}=this.getVisibleGaps();for(const c of o){if(!mc(c.breadthIntersection[0],c.breadthIntersection[1],e.minY,e.maxY))continue;const u=c.startEdge[0].x+c.length/2-e.center.x;if(c.length>e.width&&je(Math.abs(u))<=je(r.x)){je(Math.abs(u))<je(r.x)&&(i.length=0),r.x=Math.abs(u);const m={type:"gap_center",gap:c,nudge:u},b=i.find(({type:w})=>w==="gap_center"),S=b&&Ur(c.breadthIntersection[0],c.breadthIntersection[1],b.gap.breadthIntersection[0],b.gap.breadthIntersection[1]);b&&b.gap.length>c.length&&S?i[i.indexOf(b)]=m:(!b||!S)&&i.push(m)}const h=c.startNode.pageBounds.minX-c.length,p=e.maxX,g=h-p;je(Math.abs(g))<=je(r.x)&&(je(Math.abs(g))<je(r.x)&&(i.length=0),r.x=Math.abs(g),i.push({type:"gap_duplicate",gap:c,protrusionDirection:"left",nudge:g}));const y=c.endNode.pageBounds.maxX+c.length,v=e.minX,x=y-v;je(Math.abs(x))<=je(r.x)&&(je(Math.abs(x))<je(r.x)&&(i.length=0),r.x=Math.abs(x),i.push({type:"gap_duplicate",gap:c,protrusionDirection:"right",nudge:x}))}for(const c of a){if(!mc(c.breadthIntersection[0],c.breadthIntersection[1],e.minX,e.maxX))continue;const u=c.startEdge[0].y+c.length/2-e.center.y;if(c.length>e.height&&je(Math.abs(u))<=je(r.y)){je(Math.abs(u))<je(r.y)&&(s.length=0),r.y=Math.abs(u);const m={type:"gap_center",gap:c,nudge:u},b=s.find(({type:w})=>w==="gap_center"),S=b&&mc(b.gap.breadthIntersection[0],b.gap.breadthIntersection[1],c.breadthIntersection[0],c.breadthIntersection[1]);b&&b.gap.length>c.length&&S?s[s.indexOf(b)]=m:(!b||!S)&&s.push(m);continue}const h=c.startNode.pageBounds.minY-c.length,p=e.maxY,g=h-p;je(Math.abs(g))<=je(r.y)&&(je(Math.abs(g))<je(r.y)&&(s.length=0),r.y=Math.abs(g),s.push({type:"gap_duplicate",gap:c,protrusionDirection:"top",nudge:g}));const y=c.endNode.pageBounds.maxY+c.length,v=e.minY,x=y-v;je(Math.abs(x))<=je(r.y)&&(je(Math.abs(x))<je(r.y)&&(s.length=0),r.y=Math.abs(x),s.push({type:"gap_duplicate",gap:c,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:r}){const i={},s={};if(e.length>0){for(const o of e)if(o.type==="points"){const a=je(o.points.otherPoint.x);i[a]||(i[a]=[]),i[a].push(o.points)}}if(r.length>0){for(const o of r)if(o.type==="points"){const a=je(o.points.otherPoint.y);s[a]||(s[a]=[]),s[a].push(o.points)}}return Object.values(i).concat(Object.values(s)).map(o=>({id:kt(),type:"points",points:f_(o.map(a=>k.From(a.otherPoint)).concat(o.map(a=>k.From(a.thisPoint))),(a,c)=>a.equals(c))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:r,nearestSnapsY:i}){const{vertical:s,horizontal:o}=this.getVisibleGaps(),a={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},c=[];if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:d,startNode:h,endNode:p,length:g,endEdge:y}}=l;switch(l.type){case"gap_center":{const v=(g-e.width)/2,x=Ur(u[0],u[1],e.minY,e.maxY);c.push({type:"gaps",direction:"horizontal",id:kt(),gaps:[...Bi(o,h.id,v,"backward",x),{startEdge:d,endEdge:a.left},{startEdge:a.right,endEdge:y},...Bi(o,p.id,v,"forward",x)]});break}case"gap_duplicate":{const v=Ur(u[0],u[1],e.minY,e.maxY);c.push({type:"gaps",direction:"horizontal",id:kt(),gaps:l.protrusionDirection==="left"?[{startEdge:a.right,endEdge:d.map(x=>x.clone().addXY(-h.pageBounds.width,0))},{startEdge:d,endEdge:y},...Bi(o,p.id,g,"forward",v)]:[...Bi(o,h.id,g,"backward",v),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:a.left}]});break}}}if(i.length>0)for(const l of i){if(l.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:d,startNode:h,endNode:p,length:g,endEdge:y}}=l;switch(l.type){case"gap_center":{const v=(g-e.height)/2,x=Ur(u[0],u[1],e.minX,e.maxX);c.push({type:"gaps",direction:"vertical",id:kt(),gaps:[...Bi(s,h.id,v,"backward",x),{startEdge:d,endEdge:a.top},{startEdge:a.bottom,endEdge:y},...Bi(s,l.gap.endNode.id,v,"forward",x)]});break}case"gap_duplicate":{const v=Ur(u[0],u[1],e.minX,e.maxX);c.push({type:"gaps",direction:"vertical",id:kt(),gaps:l.protrusionDirection==="top"?[{startEdge:a.bottom,endEdge:d.map(x=>x.clone().addXY(0,-h.pageBounds.height))},{startEdge:d,endEdge:y},...Bi(s,p.id,g,"forward",v)]:[...Bi(s,h.id,g,"backward",v),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:a.top}]})}break}}return eie(c),c}}Pf([oe],lu.prototype,"getSnapPointsCache");Pf([oe],lu.prototype,"getSnappablePoints");Pf([oe],lu.prototype,"getSnappableGapNodes");Pf([oe],lu.prototype,"getVisibleGaps");function UR(n,e){const{minX:r,maxX:i,minY:s,maxY:o}=e,a=[];switch(n){case"top":case"left":case"top_left":case"any":a.push({id:"top_left",handle:"top_left",x:r,y:s})}switch(n){case"top":case"right":case"top_right":case"any":a.push({id:"top_right",handle:"top_right",x:i,y:s})}switch(n){case"bottom":case"right":case"bottom_right":case"any":a.push({id:"bottom_right",handle:"bottom_right",x:i,y:o})}switch(n){case"bottom":case"left":case"bottom_left":case"any":a.push({id:"bottom_left",handle:"bottom_left",x:r,y:o})}return a}var tie=Object.defineProperty,nie=Object.getOwnPropertyDescriptor,rie=(n,e,r,i)=>{for(var s=nie(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&tie(e,r,s),s};const iie=()=>null,sie=()=>[];class t${constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",r=>{const i=e.getShapeUtil(r).getHandleSnapGeometry(r);return{outline:i.outline===void 0?e.getShapeGeometry(r):i.outline,points:i.points??[],getSelfSnapOutline:i.getSelfSnapOutline??iie,getSelfSnapPoints:i.getSelfSnapPoints??sie}})}*iterateSnapPointsInPageSpace(e,r){const i=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(r);if(i&&i.length){const s=Pr(this.editor.getShapePageTransform(e));for(const o of i)yield s.applyToPoint(o)}for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const o=this.getSnapGeometryCache().get(s)?.points;if(!o||!o.length)continue;const a=Pr(this.editor.getShapePageTransform(s));for(const c of o)yield a.applyToPoint(c)}}*iterateSnapOutlines(e,r){const i=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(r);i&&(yield{shapeId:e,outline:i});for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const o=this.getSnapGeometryCache().get(s)?.outline;o&&(yield{shapeId:s,outline:o})}}getHandleSnapPosition({currentShapeId:e,handle:r,handleInPageSpace:i}){const s=this.manager.getSnapThreshold();let o=s,a=null;for(const u of this.iterateSnapPointsInPageSpace(e,r))k.DistMin(i,u,o)&&(o=k.Dist(i,u),a=u);if(a)return a;let c=s,l=null;for(const{shapeId:u,outline:d}of this.iterateSnapOutlines(e,r)){const h=Pr(this.editor.getShapePageTransform(u)),p=this.editor.getPointInShapeSpace(u,i),g=d.nearestPoint(p),y=h.applyToPoint(g);k.DistMin(i,y,c)&&(c=k.Dist(i,y),l=y)}return l||null}snapHandle({currentShapeId:e,handle:r}){const s=Pr(this.editor.getShapePageTransform(e)).applyToPoint(r),o=this.getHandleSnapPosition({currentShapeId:e,handle:r,handleInPageSpace:s});return o?(this.manager.setIndicators([{id:kt(),type:"points",points:[o]}]),{nudge:k.Sub(o,s)}):null}}rie([oe],t$.prototype,"getSnapGeometryCache");var oie=Object.defineProperty,aie=Object.getOwnPropertyDescriptor,U_=(n,e,r,i)=>{for(var s=aie(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&oie(e,r,s),s};class If{constructor(e){this.editor=e,this.shapeBounds=new lu(this),this.handles=new t$(this)}shapeBounds;handles;_snapIndicators=Vt("snapLines",void 0);getIndicators(){return this._snapIndicators.get()??Yi}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,r=e.getViewportPageBounds(),i=e.getSelectedShapeIds(),s=new Set,o=a=>{if(zn(a)){const l=e.getShape(a);l&&e.isShapeOfType(l,"frame")&&s.add(a)}const c=e.getSortedChildIdsForParent(a);for(const l of c){if(i.includes(l))continue;const u=e.getShape(l);if(!u||!e.getShapeUtil(u).canSnap(u))continue;const h=e.getShapePageBounds(l);if(h&&r.includes(h)){if(e.isShapeOfType(u,"group")){o(l);continue}s.add(l)}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),s}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}U_([oe],If.prototype,"getSnapThreshold");U_([oe],If.prototype,"getSnappableShapes");U_([oe],If.prototype,"getCurrentCommonAncestor");const cie=/\r?\n|\r/g;function qR(n){return n.replace(cie,`
`).split(`
`).map(e=>e||" ").join(`
`)}const lie={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},uie=/\s/;class die{constructor(e){this.editor=e;const r=this.editor.getContainer(),i=document.createElement("div");i.classList.add("tl-text"),i.classList.add("tl-text-measure"),i.tabIndex=-1,r.appendChild(i),this.baseElm=i,e.disposables.add(()=>{i.remove()})}baseElm;measureText=(e,r)=>{const i=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",i),i.setAttribute("dir","auto"),i.style.setProperty("unicode-bidi","plaintext"),i.style.setProperty("font-family",r.fontFamily),i.style.setProperty("font-style",r.fontStyle),i.style.setProperty("font-weight",r.fontWeight),i.style.setProperty("font-size",r.fontSize+"px"),i.style.setProperty("line-height",r.lineHeight*r.fontSize+"px"),i.style.setProperty("max-width",r.maxWidth===null?null:r.maxWidth+"px"),i.style.setProperty("min-width",r.minWidth===null?null:r.minWidth+"px"),i.style.setProperty("padding",r.padding),i.style.setProperty("overflow-wrap",r.disableOverflowWrapBreaking?"normal":"break-word"),i.textContent=qR(e);const s=i.scrollWidth,o=i.getBoundingClientRect();return i.remove(),{x:0,y:0,w:o.width,h:o.height,scrollWidth:s}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:r=!1}={}){const i=[],s=e.getBoundingClientRect(),o=-s.left,a=-s.top,c=new Range,l=e.childNodes[0];let u=0,d=null,h=null,p=0,g=0,y=!1;for(const v of e.childNodes)if(v.nodeType===Node.TEXT_NODE)for(const x of v.textContent??""){c.setStart(l,u),c.setEnd(l,u+x.length);const m=c.getClientRects(),b=m[m.length-1],S=b.top+a,w=b.left+o,I=b.right+o,C=w<g,_=uie.test(x);if(_!==h||S!==p||!d){if(d){if(r&&S!==p){y=!0;break}i.push(d)}d={box:{x:w,y:S,w:b.width,h:b.height},text:x},g=w}else C&&(d.box.x=w),d.box.w=C?d.box.w+b.width:I-d.box.x,d.text+=x;x===`
`&&(g=0),h=_,p=S,u+=x.length}return d&&i.push(d),{spans:i,didTruncate:y}}measureTextSpans(e,r){if(e==="")return[];const i=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",i);const s=Math.ceil(r.width-r.padding*2);i.setAttribute("dir","auto"),i.style.setProperty("unicode-bidi","plaintext"),i.style.setProperty("width",`${s}px`),i.style.setProperty("height","min-content"),i.style.setProperty("font-size",`${r.fontSize}px`),i.style.setProperty("font-family",r.fontFamily),i.style.setProperty("font-weight",r.fontWeight),i.style.setProperty("line-height",`${r.lineHeight*r.fontSize}px`),i.style.setProperty("text-align",lie[r.textAlign]);const o=r.overflow==="truncate-ellipsis"||r.overflow==="truncate-clip";o&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all"));const a=qR(e);i.textContent=a;const{spans:c,didTruncate:l}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:o});if(r.overflow==="truncate-ellipsis"&&l){i.textContent="";const u=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",`${s-u}px`),i.textContent=a;const d=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,h=d[d.length-1];return d.push({text:"",box:{x:Math.min(h.box.x+h.box.w,r.width-r.padding-u),y:h.box.y,w:u,h:h.box.h}}),d}return i.remove(),c}}const HR=lF;class hie{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}cancelRaf;isPaused=!0;now=0;start=()=>{this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=HR(this.tick),this.now=Date.now()};tick=()=>{if(this.isPaused)return;const e=Date.now(),r=e-this.now;this.now=e,this.updatePointerVelocity(r),this.editor.emit("frame",r),this.editor.emit("tick",r),this.cancelRaf=HR(this.tick)};dispose=()=>{this.isPaused=!0,this.cancelRaf?.()};prevPoint=new k;updatePointerVelocity=e=>{const{prevPoint:r,editor:{inputs:{currentScreenPoint:i,pointerVelocity:s}}}=this;if(e===0)return;const o=k.Sub(i,r);this.prevPoint=i.clone();const a=o.len(),c=a?o.div(a):new k(0,0),l=s.clone().lrp(c.mul(a/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),s.equals(l)||(this.editor.inputs.pointerVelocity=l)}}var fie=Object.defineProperty,pie=Object.getOwnPropertyDescriptor,Or=(n,e,r,i)=>{for(var s=pie(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&fie(e,r,s),s};class fr{constructor(e,r){if(this.user=e,this.inferDarkMode=r,typeof window>"u"||!("matchMedia"in window))return;const i=window.matchMedia("(prefers-color-scheme: dark)");i?.matches&&this.systemColorScheme.set("dark"),i?.addEventListener("change",s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}systemColorScheme=Vt("systemColorScheme","light");updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Ni.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Ni.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Ni.name}getLocale(){return this.user.userPreferences.get().locale??Ni.locale}getColor(){return this.user.userPreferences.get().color??Ni.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Ni.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Ni.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Ni.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Ni.isPasteAtCursorMode}}Or([oe],fr.prototype,"getUserPreferences");Or([oe],fr.prototype,"getIsDarkMode");Or([oe],fr.prototype,"getEdgeScrollSpeed");Or([oe],fr.prototype,"getAnimationSpeed");Or([oe],fr.prototype,"getId");Or([oe],fr.prototype,"getName");Or([oe],fr.prototype,"getLocale");Or([oe],fr.prototype,"getColor");Or([oe],fr.prototype,"getIsSnapMode");Or([oe],fr.prototype,"getIsWrapMode");Or([oe],fr.prototype,"getIsDynamicResizeMode");Or([oe],fr.prototype,"getIsPasteAtCursorMode");const gie={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},mie=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Ee{constructor(e,r){this.editor=e;const{id:i,children:s,initial:o,isLockable:a}=this.constructor;this.id=i,this._isActive=Vt("toolIsActive"+this.id,!1),this._current=Vt("toolState"+this.id,void 0),this._path=oe("toolPath"+this.id,()=>{const c=this.getCurrent();return this.id+(c?`.${c.getPath()}`:"")}),this.parent=r??{},this.parent?s&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(s().map(c=>[c.id,new c(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",s&&o&&(this.initial=o,this.children=Object.fromEntries(s().map(c=>[c.id,new c(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=a,this.performanceTracker=new KL}performanceTracker;static id;static initial;static children;static isLockable=!0;id;type;shapeType;initial;children;isLockable;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,r={})=>{const i=e.split(".");let s=this;for(let o=0;o<i.length;o++){const a=i[o],c=s.getCurrent(),l=s.children?.[a];if(!l)throw Error(`${s.id} - no child state exists with the id ${a}.`);if(c?.id!==l.id&&(c?.exit(r,a),s._current.set(l),l.enter(r,c?.id||"initial"),!l.getIsActive()))break;s=l}return this};handleEvent=e=>{const r=gie[e.name],i=this._current.__unsafe__getWithoutCapture();this[r]?.(e),this._isActive.__unsafe__getWithoutCapture()&&i&&i===this._current.__unsafe__getWithoutCapture()&&i.handleEvent(e)};enter=(e,r)=>{if(Dt.measurePerformance.get()&&mie.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,r),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,r)}};exit=(e,r)=>{Dt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,r),this.getIsActive()||this.getCurrent()?.exit(e,r)};_currentToolIdMask=Vt("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onLongPress;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onTick;onEnter;onExit}class yie extends Ee{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&r.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}var vie=Object.defineProperty,xie=Object.getOwnPropertyDescriptor,Pe=(n,e,r,i)=>{for(var s=xie(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&vie(e,r,s),s};class be extends hre{constructor({store:e,user:r,shapeUtils:i,bindingUtils:s,tools:o,getContainer:a,cameraOptions:c,initialState:l,autoFocus:u,inferDarkMode:d,options:h}){super(),this.options={...Pre,...h},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new Wre({store:e,annotateError:P=>{this.annotateError(P,{origin:"history.batch",willCrashApp:!0}),this.crash(P)}}),this.snaps=new If(this),this.timers=new nJ,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...yR,...c}),this.user=new fr(r??Uz(),d??!1),this.getContainer=a??(()=>document.body),this.textMeasure=new die(this),this._tickManager=new hie(this);class p extends yie{static initial=l??""}this.root=new p(this),this.root.children={};const g=Zz(i),y={},v={},x=new Map;for(const P of g){const M=new P(this);y[P.type]=M;const T=bF(P.props??{});v[P.type]=T;for(const A of T.keys())if(!x.has(A.id))x.set(A.id,A);else if(x.get(A.id)!==A)throw Error(`Multiple style props with id "${A.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=y,this.styleProps=v;const m=Wz(s),b={};for(const P of m){const M=new P(this);b[P.type]=M}this.bindingUtils=b;for(const P of[...o]){if(yi(this.root.children,P.id))throw Error(`Can't override tool with id "${P.id}"`);this.root.children[P.id]=new P(this,this.root)}this.environment=new Hre(this),this.scribbles=new Zre(this);const S=(P,M)=>{let T=null;const A=P.selectedShapeIds.filter(j=>!M.has(j));A.length!==P.selectedShapeIds.length&&(T||(T={...P}),T.selectedShapeIds=A);const R=P.erasingShapeIds.filter(j=>!M.has(j));R.length!==P.erasingShapeIds.length&&(T||(T={...P}),T.erasingShapeIds=R),P.hoveredShapeId&&M.has(P.hoveredShapeId)&&(T||(T={...P}),T.hoveredShapeId=null),P.editingShapeId&&M.has(P.editingShapeId)&&(T||(T={...P}),T.editingShapeId=null);const O=P.hintingShapeIds.filter(j=>!M.has(j));return O.length!==P.hintingShapeIds.length&&(T||(T={...P}),T.hintingShapeIds=O),P.focusedGroupId&&M.has(P.focusedGroupId)&&(T||(T={...P}),T.focusedGroupId=null),T};this.sideEffects=this.store.sideEffects;let w=new Map;const I=new Set,C=new Set;let _=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{I.clear();for(const P of C){C.delete(P);const M=this.getShape(P);if(!M)continue;const A=this.getShapeUtil(M).onChildrenChange?.(M);A?.length&&this.updateShapes(A)}if(_.size){const P=_;_=new Set;for(const M of P)this.getBindingUtil(M).onOperationComplete?.()}if(w.size){const P=w;w=new Map;for(const M of P.values())this.getBindingUtil(M.binding).onAfterDelete?.(M)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(P,M)=>{for(const T of this.getBindingsInvolvingShape(M))_.add(T.type),T.fromId===M.id&&this.getBindingUtil(T).onAfterChangeFromShape?.({binding:T,shapeBefore:P,shapeAfter:M}),T.toId===M.id&&this.getBindingUtil(T).onAfterChangeToShape?.({binding:T,shapeBefore:P,shapeAfter:M});if(P.parentId!==M.parentId){const T=A=>{const R=this.getShape(A);if(R)for(const O of this.getBindingsInvolvingShape(R))_.add(O.type),O.fromId===R.id&&this.getBindingUtil(O).onAfterChangeFromShape?.({binding:O,shapeBefore:R,shapeAfter:R}),O.toId===R.id&&this.getBindingUtil(O).onAfterChangeToShape?.({binding:O,shapeBefore:R,shapeAfter:R})};T(M.id),this.visitDescendants(M.id,T)}if(P.parentId!==M.parentId&&Ln(M.parentId)){const T=new Set([P.id]);this.visitDescendants(P.id,A=>{T.add(A)});for(const A of this.getPageStates()){if(A.pageId===M.parentId)continue;const R=S(A,T);R&&this.store.put([R])}}P.parentId&&zn(P.parentId)&&C.add(P.parentId),M.parentId!==P.parentId&&zn(M.parentId)&&C.add(M.parentId)},beforeDelete:P=>{if(I.has(P.id))return;P.parentId&&zn(P.parentId)&&C.add(P.parentId),I.add(P.id);const M=[];for(const R of this.getBindingsInvolvingShape(P)){_.add(R.type),M.push(R.id);const O=this.getBindingUtil(R);R.fromId===P.id?(O.onBeforeIsolateToShape?.({binding:R,removedShape:P}),O.onBeforeDeleteFromShape?.({binding:R,shape:P})):(O.onBeforeIsolateFromShape?.({binding:R,removedShape:P}),O.onBeforeDeleteToShape?.({binding:R,shape:P}))}M.length&&this.deleteBindings(M);const T=new Set([P.id]),A=Be(this.getPageStates().map(R=>S(R,T)));A.length&&this.store.put(A)}},binding:{beforeCreate:P=>{const M=this.getBindingUtil(P).onBeforeCreate?.({binding:P});return M||P},afterCreate:P=>{_.add(P.type),this.getBindingUtil(P).onAfterCreate?.({binding:P})},beforeChange:(P,M)=>{const T=this.getBindingUtil(M).onBeforeChange?.({bindingBefore:P,bindingAfter:M});return T||M},afterChange:(P,M)=>{_.add(M.type),this.getBindingUtil(M).onAfterChange?.({bindingBefore:P,bindingAfter:M})},beforeDelete:P=>{this.getBindingUtil(P).onBeforeDelete?.({binding:P})},afterDelete:P=>{this.getBindingUtil(P).onAfterDelete?.({binding:P}),_.add(P.type)}},page:{afterCreate:P=>{const M=hi.createId(P.id),T=Vr.createId(P.id);this.store.has(M)||this.store.put([hi.create({id:M})]),this.store.has(T)||this.store.put([Vr.create({id:T,pageId:P.id})])},afterDelete:(P,M)=>{if(this.getInstanceState()?.currentPageId===P.id){const R=this.getPages().find(O=>O.id!==P.id)?.id;R?this.store.put([{...this.getInstanceState(),currentPageId:R}]):M==="user"&&this.store.ensureStoreIsUsable()}const T=hi.createId(P.id),A=Vr.createId(P.id);this.store.remove([T,A])}},instance:{afterChange:(P,M,T)=>{if(!this.store.has(M.currentPageId)){const A=this.store.has(P.currentPageId)?P.currentPageId:this.getPages()[0]?.id;A?this.store.update(M.id,R=>({...R,currentPageId:A})):T==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(P,M)=>{if(P?.selectedShapeIds!==M?.selectedShapeIds){const T=M.selectedShapeIds.filter(R=>{let O=this.getShape(R)?.parentId;for(;zn(O);){if(M.selectedShapeIds.includes(O))return!1;O=this.getShape(O)?.parentId}return!0});let A=null;if(T.length>0){const R=this.findCommonAncestor(Be(T.map(O=>this.getShape(O))),O=>this.isShapeOfType(O,"group"));R&&(A=R)}else M?.focusedGroupId&&(A=M.focusedGroupId);(T.length!==M.selectedShapeIds.length||A!==M.focusedGroupId)&&this.store.put([{...M,selectedShapeIds:T,focusedGroupId:A??null}])}}}})),this._currentPageShapeIds=Fre(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=Lre(this.store),this.disposables.add(this.store.listen(P=>{this.emit("change",P)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),l&&this.root.children[l]===void 0)throw Error(`No state found for initialState "${l}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new qre(this),this.focusManager=new Gre(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new KL}options;store;root;disposables=new Set;isDisposed=!1;_tickManager;snaps;timers;user;textMeasure;environment;scribbles;sideEffects;edgeScrollManager;focusManager;getContainer;dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}shapeUtils;styleProps;getShapeUtil(e){const r=typeof e=="string"?e:e.type,i=Hn(this.shapeUtils,r);return gt(i,`No shape util found for type "${r}"`),i}bindingUtils;getBindingUtil(e){const r=typeof e=="string"?e:e.type,i=Hn(this.bindingUtils,r);return gt(i,`No binding util found for type "${r}"`),i}history;undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return this.history.mark(e),this}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}_shouldIgnoreShapeLock=!1;run(e,r){const i=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=r?.ignoreShapeLock??i;try{this.history.batch(e,r)}finally{this._shouldIgnoreShapeLock=i}return this}batch(e,r){return this.run(e,r)}annotateError(e,{origin:r,willCrashApp:i,tags:s,extras:o}){const a=this.createErrorAnnotations(r,i);return p_(e,{tags:{...a.tags,...s},extras:{...a.extras,...o}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,r){try{const i=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:r},extras:{}}}}_crashingError=null;getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const r=e.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return!0;const o=i.getCurrent();if(o?.id===s){if(r.length===0)return!0;i=o;continue}else return!1}return!1}isInAny(...e){return e.some(r=>this.isIn(r))}setCurrentTool(e,r={}){return this.root.transition(e,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){const r=e.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return i;const o=i.children?.[s];if(!o)return;i=o}return i}getDocumentSettings(){return this.store.get(yw)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(kn)}updateInstanceState(e,r){return this._updateInstanceState(e,{history:"ignore",...r}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState=(e,r)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},r)};_isChangingStyleTimeout=-1;getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){const r=new Set(this.getOpenMenus());return r.has(e)||(r.add(e),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(e){const r=new Set(this.getOpenMenus());return r.has(e)&&(r.delete(e),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}setCursor=e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this);getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Vr.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState=e=>{this.store.update(e.id??this.getCurrentPageState().id,r=>({...r,...e}))};getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return Be(e.map(r=>this.store.get(r)))}setSelectedShapes(e){return this.run(()=>{const r=e.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:i}=this.getCurrentPageState(),s=new Set(i);if(r.length===s.size&&r.every(o=>s.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:r}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const r=typeof e=="string"?e:e?.id??null,i=this.getShape(r);if(!i)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,o=>s.includes(o.id))}select(...e){const r=typeof e[0]=="string"?e:e.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...e){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(s=>!r.includes(s))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getSelectionPageBounds(){const e=this.getCurrentPageState().selectedShapeIds;return e.length===0?null:pe.Common(Be(e.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const e=this.getSelectedShapeIds();let r=!1,i=0;for(let s=0,o=e.length;s<o;s++){const a=this.getShapePageTransform(e[s]);if(a)if(r){if(a.rotation()!==i)return 0}else r=!0,i=a.rotation()}return i}getSelectionRotatedPageBounds(){const e=this.getSelectedShapeIds();if(e.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(e.length===1){const s=this.getShapeGeometry(e[0]).bounds.clone(),o=this.getShapePageTransform(e[0]);return s.point=o.applyToPoint(s.point),s}const i=pe.FromPoints(this.getSelectedShapeIds().flatMap(s=>{const o=this.getShapePageTransform(s);return o?o.applyToPoints(this.getShapeGeometry(s).bounds.corners):[]}).map(s=>s.rot(-r)));return i.point=i.point.rot(r),i}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:r,y:i}=this.pageToScreen(e.point),s=this.getZoomLevel();return new pe(r,i,e.width*s,e.height*s)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const r=typeof e=="string"?e:e?.id??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,i=>({...i,focusedGroupId:r}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const r=this.findShapeAncestor(e,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup(r?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const r=typeof e=="string"?e:e?.id??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{this._updateCurrentPageState({editingShapeId:r})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const r=typeof e=="string"?e:e?.id??null;return r===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:r})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return Be(e.map(r=>this.getShape(r)))}setHintingShapes(e){const r=typeof e[0]=="string"?e:e.map(i=>i.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:f_(r)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return Be(e.map(r=>this.getShape(r)))}setErasingShapes(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id);r.sort();const i=this.getErasingShapeIds();return this.run(()=>{if(r.length===i.length){for(let s=0;s<r.length;s++)if(r[s]!==i[s]){this._updateCurrentPageState({erasingShapeIds:r});break}}else this._updateCurrentPageState({erasingShapeIds:r})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const r=typeof e=="string"?e:e?.id??null;return r!==this.getCroppingShapeId()&&this.run(()=>{if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),s=this.getShapeUtil(i);i&&s.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}},{history:"ignore"}),this}_unsafe_getCameraId(){return hi.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const r=this.getCameraForFollowing();if(r)return{...e,...r}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const r=this.getCollaborators().find(h=>h.userId===e);if(!r)return null;const{w:i,h:s}=r.screenBounds,{x:o,y:a,z:c}=r.camera,l=new pe(-o,-a,i/c,s/c),u=this.getViewportScreenBounds().clone(),d=u.width/u.height;return u.width=l.width,u.height=u.width/d,u.height<l.height&&(u.height=l.height,u.width=u.height*d),u.center=l.center,u}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:r,zy:i}=KR(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(r,i);case"fit-max":return Math.min(r,i);case"fit-x":return r;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(r,i));case"fit-max-100":return Math.min(1,Math.min(r,i));case"fit-x-100":return Math.min(1,r);case"fit-y-100":return Math.min(1,i);default:throw wn(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:r,zy:i}=KR(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(r,i);case"fit-max":return Math.min(r,i);case"fit-x":return r;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(r,i));case"fit-max-100":return Math.min(1,Math.min(r,i));case"fit-x-100":return Math.min(1,r);case"fit-y-100":return Math.min(1,i);default:throw wn(e.constraints.baseZoom)}}_cameraOptions=Vt("camera options",yR);getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){const r=ft({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return r.zoomSteps?.length<1&&(r.zoomSteps=[1]),this._cameraOptions.set(r),this}getConstrainedCamera(e,r){const i=this.getCamera();let{x:s,y:o,z:a=i.z}=e;if(!r?.force){const c=this.getCameraOptions(),l=c.zoomSteps[0],u=rn(c.zoomSteps),d=this.getViewportScreenBounds();if(c.constraints){const{constraints:h}=c,p=Math.min(h.padding.y,d.w/2),g=Math.min(h.padding.x,d.h/2),y=pe.From(c.constraints.bounds),v=(d.w-g*2)/y.w,x=(d.h-p*2)/y.h,m=this.getBaseZoom(),b=u*m,S=l*m;if(r?.reset&&(a=this.getInitialZoom()),a<S||a>b){const{x:R,y:O,z:j}=i,D=-R+d.w/j/2,N=-O+d.h/j/2;a=Ht(a,S,b);const F=-R+d.w/a/2,z=-O+d.h/a/2;s=R+F-D,o=O+z-N}const w=g/a-y.x,I=p/a-y.y,C=(d.w-g*2)/a-y.w,_=(d.h-p*2)/a-y.h,P=w+C*h.origin.x,M=I+_*h.origin.y,T=typeof h.behavior=="string"?h.behavior:h.behavior.x,A=typeof h.behavior=="string"?h.behavior:h.behavior.y;if(r?.reset)s=P,o=M;else{switch(T){case"fixed":{s=P;break}case"contain":{a<v?s=P:s=Ht(s,w+C,w);break}case"inside":{a<v?s=Ht(s,w,(d.w-g)/a-y.w):s=Ht(s,w+C,w);break}case"outside":{s=Ht(s,g/a-y.w,(d.w-g)/a);break}case"free":break;default:throw wn(T)}switch(A){case"fixed":{o=M;break}case"contain":{a<x?o=M:o=Ht(o,I+_,I);break}case"inside":{a<x?o=Ht(o,I,(d.h-p)/a-y.h):o=Ht(o,I+_,I);break}case"outside":{o=Ht(o,p/a-y.h,(d.h-p)/a);break}case"free":break;default:throw wn(A)}}}else if(a>u||a<l){const{x:h,y:p,z:g}=i;a=Ht(a,l,u),s=h+(-h+d.w/a/2)-(-h+d.w/g/2),o=p+(-p+d.h/a/2)-(-p+d.h/g/2)}}return{x:s,y:o,z:a}}_setCamera(e,r){const i=this.getCamera(),{x:s,y:o,z:a}=this.getConstrainedCamera(e,r);return i.x===s&&i.y===o&&i.z===a?this:(mi(()=>{const c={...i,x:s,y:o,z:a};this.run(()=>{this.store.put([c])},{history:"ignore"});const{currentScreenPoint:l,currentPagePoint:u}=this.inputs,{screenBounds:d}=this.store.unsafeGetWithoutCapture(kn);if(l.x/a-s!==u.x||l.y/a-o!==u.y){const h={type:"pointer",target:"canvas",name:"pointer_move",point:k.AddXY(l,d.x,d.y),pointerId:vR.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};r?.immediate?this._flushEventForTick(h):this.dispatch(h)}this._tickCameraState()}),this)}setCamera(e,r){const{isLocked:i}=this._cameraOptions.__unsafe__getWithoutCapture();if(i&&!r?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const s=k.Cast(e);Number.isFinite(s.x)||(s.x=0),Number.isFinite(s.y)||(s.y=0),(s.z===void 0||!Number.isFinite(s.z))&&(e.z=this.getZoomLevel());const o=this.getConstrainedCamera(s,r);if(r?.animation){const{width:a,height:c}=this.getViewportScreenBounds();this._animateToViewport(new pe(-o.x,-o.y,a/o.z,c/o.z),r)}else this._setCamera(o,{...r,force:!0});return this}centerOnPoint(e,r){const{isLocked:i}=this.getCameraOptions();if(i&&!r?.force)return this;const{width:s,height:o}=this.getViewportPageBounds();return this.setCamera(new k(-(e.x-s/2),-(e.y-o/2),this.getCamera().z),r),this}zoomToFit(e){const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=pe.Common(Be(r.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(i,e),this}resetZoom(e=this.getViewportScreenCenter(),r){const{isLocked:i,constraints:s}=this.getCameraOptions();if(i&&!r?.force)return this;const o=this.getCamera(),{x:a,y:c,z:l}=o,{x:u,y:d}=e;let h=1;if(s){const p=this.getInitialZoom();l!==p&&(h=p)}return this.setCamera(new k(a+(u/h-u)-(u/l-u),c+(d/h-d)-(d/l-d),h),r),this}zoomIn(e=this.getViewportScreenCenter(),r){const{isLocked:i}=this.getCameraOptions();if(i&&!r?.force)return this;const{x:s,y:o,z:a}=this.getCamera(),{zoomSteps:c}=this.getCameraOptions();if(c!==null&&c.length>1){const l=this.getBaseZoom();let u=rn(c)*l;for(let d=1;d<c.length;d++){const h=c[d-1]*l,p=c[d]*l;if(!(p-a<=(p-h)/2)){u=p;break}}this.setCamera(new k(s+(e.x/u-e.x)-(e.x/a-e.x),o+(e.y/u-e.y)-(e.y/a-e.y),u),r)}return this}zoomOut(e=this.getViewportScreenCenter(),r){const{isLocked:i}=this.getCameraOptions();if(i&&!r?.force)return this;const{zoomSteps:s}=this.getCameraOptions();if(s!==null&&s.length>1){const o=this.getBaseZoom(),{x:a,y:c,z:l}=this.getCamera();let u=s[0]*o;for(let d=s.length-1;d>0;d--){const h=s[d-1]*o,p=s[d]*o;if(!(p-l>=(p-h)/2)){u=h;break}}this.setCamera(new k(a+(e.x/u-e.x)-(e.x/l-e.x),c+(e.y/u-e.y)-(e.y/l-e.y),u),r)}return this}zoomToSelection(e){const{isLocked:r}=this.getCameraOptions();if(r&&!e?.force)return this;const i=this.getSelectionPageBounds();return i&&this.zoomToBounds(i,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,r){const i=this._cameraOptions.__unsafe__getWithoutCapture();if(i.isLocked&&!r?.force)return this;const s=this.getViewportScreenBounds(),o=r?.inset??Math.min(Wee,s.width*.28),a=this.getBaseZoom(),c=i.zoomSteps[0],l=rn(i.zoomSteps);let u=Ht(Math.min((s.width-o)/e.w,(s.height-o)/e.h),c*a,l*a);return r?.targetZoom!==void 0&&(u=Math.min(r.targetZoom,u)),this.setCamera(new k(-e.x+(s.width-e.w*u)/2/u,-e.y+(s.height-e.h*u)/2/u,u),r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_viewportAnimation=null;_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:r,easing:i,duration:s,start:o,end:a}=this._viewportAnimation;if(r>s){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new k(-a.x,-a.y,this.getViewportScreenBounds().width/a.width));return}const c=s-r,l=i(1-c/s),u=o.minX+(a.minX-o.minX)*l,d=o.minY+(a.minY-o.minY)*l,h=o.maxX+(a.maxX-o.maxX)*l;this._setCamera(new k(-u,-d,this.getViewportScreenBounds().width/(h-u)),{force:!0})}_animateToViewport(e,r={animation:cS}){const{animation:i,...s}=r;if(!i)return;const{duration:o=0,easing:a=Wt.easeInOutCubic}=i,c=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||c===0?this._setCamera(new k(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...s}):(this._viewportAnimation={elapsed:0,duration:o/c,easing:a,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:r}=this.getCameraOptions();if(r&&!e?.force)return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:s,friction:o=this.options.cameraSlideFriction,direction:a,speedThreshold:c=.01}=e;let l=Math.min(s,1);const u=()=>{this.off("tick",d),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const d=h=>{const{x:p,y:g,z:y}=this.getCamera(),v=k.Mul(a,l*h/y);l*=1-o,l<c?u():this._setCamera(new k(p+v.x,g+v.y,y))};return this.on("tick",d),this}zoomToUser(e,r={animation:{duration:500}}){const i=this.getCollaborators().find(s=>s.userId===e);return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=i.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(i.currentPageId),r&&r.animation&&!s&&(r.animation=void 0),this.centerOnPoint(i.cursor,r);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],c=a.indexOf(e);c<0||(a.splice(c,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}_willSetInitialBounds=!0;updateViewportScreenBounds(e,r=!1){e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const i=[e.minY!==0,!Os(document.body.scrollWidth,e.maxX,1),!Os(document.body.scrollHeight,e.maxY,1),e.minX!==0],{screenBounds:s,insets:o}=this.getInstanceState();if(e.equals(s)&&i.every((c,l)=>c===o[l]))return this;const{_willSetInitialBounds:a}=this;if(this._willSetInitialBounds=!1,a)this.updateInstanceState({screenBounds:e.toJson(),insets:i}),this.setCamera(this.getCamera());else if(r&&!this.getInstanceState().followingUserId){const c=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:i}),this.centerOnPoint(c)}else this.updateInstanceState({screenBounds:e.toJson(),insets:i}),this._setCamera(k.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:r,w:i,h:s}=this.getInstanceState().screenBounds;return new pe(e,r,i,s)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new k(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:r}=this.getViewportScreenBounds(),{x:i,y:s,z:o}=this.getCamera();return new pe(-i,-s,e/o,r/o)}screenToPage(e){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(kn),{x:i,y:s,z:o=1}=this.getCamera();return new k((e.x-r.x)/o-i,(e.y-r.y)/o-s,e.z??.5)}pageToScreen(e){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(kn),{x:i,y:s,z:o=1}=this.getCamera();return new k((e.x+i)*o+r.x,(e.y+s)*o+r.y,e.z??.5)}pageToViewport(e){const{x:r,y:i,z:s=1}=this.getCamera();return new k((e.x+r)*s,(e.y+i)*s,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(i=>i.userId))].sort().map(i=>e.filter(o=>o.userId===i).sort((o,a)=>a.lastActivityTimestamp-o.lastActivityTimestamp)[0]):Yi}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(r=>r.currentPageId===e)}_isLockedOnFollowingUser=Vt("isLockedOnFollowingUser",!1);startFollowingUser(e){this.stopFollowingUser();const r=this._getCollaboratorsQuery().get().filter(o=>o.userId===e);if(!r.length)return console.warn("User not found"),this;const i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.some(o=>o.followingUserId===i))return this;const s=oe("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===e));return mi(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const o=$o("update current page",()=>{const l=s.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),a=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",c),this.off("stop-following",a)},c=()=>{if(!s.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const h=this.getViewportPageBounds(),p=Math.abs(d.minX-h.minX)+Math.abs(d.maxX-h.maxX),g=Math.abs(d.minY-h.minY)+Math.abs(d.maxY-h.maxY);if(p<this.options.followChaseViewportSnap&&g<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const y=Ht(u*.5,.1,.8),v=new pe($n(h.minX,d.minX,y),$n(h.minY,d.minY,y),$n(h.width,d.width,y),$n(h.height,d.height,y)),x=new k(-v.x,-v.y,this.getViewportScreenBounds().width/v.width);this.stopCameraAnimation(),this._setCamera(x)};this.once("stop-following",a),this.addListener("frame",c),c()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const r=[];let i=this.options.maxShapesPerPage*2,s=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),a=(l,u,d)=>{const h=this.getShape(l);if(!h)return;u*=h.opacity;let p=!1;const g=this.getShapeUtil(h);e&&(p=!d&&o.includes(l),p&&(u*=.32)),r.push({id:l,shape:h,util:g,index:i,backgroundIndex:s,opacity:u}),i+=1,s+=1;const y=this.getSortedChildIdsForParent(l);if(!y.length)return;let v=null;g.providesBackgroundForChildren(h)&&(v=s,s=i,i+=this.options.maxShapesPerPage);for(const x of y)a(x,u,d||p);v!==null&&(s=v)},c=e?[this.getCurrentPage()]:this.getPages();for(const l of c)for(const u of this.getSortedChildIdsForParent(l.id))a(u,1,!1);return r}_cameraState=Vt("camera state","idle");_cameraStateTimeoutRemaining=0;_decayCameraStateTimeout=e=>{this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))};_tickCameraState=()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))};getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(ZQ)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(bn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}_currentPageShapeIds;getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const r=typeof e=="string"?e:e.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(s=>s.id))}setCurrentPage(e){const r=typeof e=="string"?e:e.id;return this.store.has(r)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:r}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getInstanceState().isReadonly?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,i=>({...i,...e}))):this}createPage(e){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const r=this.getPages(),i=Tre(e.name??"Page 1",r.map(a=>a.name));let s=e.index;(!s||r.some(a=>a.index===s))&&(s=Hr(r[r.length-1].index));const o=ts.create({meta:{},...e,name:i,index:s});this.store.put([o])}),this}deletePage(e){const r=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;const i=this.getPages();if(i.length===1)return;const s=this.getPage(r);if(s){if(r===this.getCurrentPageId()){const o=i.findIndex(c=>c.id===r),a=i[o-1]??i[o+1];this.setCurrentPage(a.id)}this.store.remove([s.id])}}),this}duplicatePage(e,r=ts.createId()){if(this.getPages().length>=this.options.maxPages)return this;const i=typeof e=="string"?e:e.id,s=this.getPage(i);if(!s)return this;const o={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.run(()=>{const c=this.getPages(),l=wl(s.index,c[c.indexOf(s)+1]?.index);if(this.createPage({name:s.name+" Copy",id:r,index:l}),this.setCurrentPage(r),this.setCamera(o),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(e,r){const i=typeof e=="string"?e:e.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:i,name:r}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(r=>({...this.store.get(r.id),...r})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getInstanceState().isReadonly)return this;const r=typeof e[0]=="string"?e:e.map(i=>i.id);return r.length<=0?this:(this.run(()=>this.store.remove(r),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,r){if(!e)return null;const i=this.getAsset(e);if(!i)return null;const{screenScale:s=1,shouldResolveToOriginal:o=!1}=r,c=Math.max(.125,(d=>Math.pow(2,Math.ceil(Math.log2(d))))(s)),l="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(i,{screenScale:s||1,steppedScreenScale:c,dpr:u,networkEffectiveType:l,shouldResolveToOriginal:o})}async uploadAsset(e,r){return await this.store.props.assets.upload(e,r)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,r)=>e.props===r.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e))}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return de.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Ln(e.parentId))return this.getShapeLocalTransform(e);const r=this._getShapePageTransformCache().get(e.parentId)??de.Identity();return de.Compose(r,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const r=typeof e=="string"?e:e.id,i=this.getShape(r);return!i||Ln(i.parentId)?de.Identity():this._getShapePageTransformCache().get(i.parentId)??de.Identity()}getShapePageTransform(e){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r)??de.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const r=this._getShapePageTransformCache().get(e.id);return r?pe.FromPoints(de.applyToPoints(r,this.getShapeGeometry(e).vertices)):new pe})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const r=this._getShapeMaskCache().get(e.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(e.id);return i?`polygon(${de.applyToPoints(de.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Ln(e.parentId))return;const r=this.getShapeAncestors(e.id).filter(s=>this.isShapeOfType(s,"frame"));return r.length===0?void 0:r.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,o)=>{if(!(o&&s))return;const a=zR(s,o);return a?a.map(k.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const r=this._getShapePageBoundsCache().get(e.id);if(!r)return;const i=this._getShapeMaskCache().get(e.id);if(i){if(i.length===0)return;const{corners:s}=r;if(s.every((a,c)=>a&&k.Equals(a,i[c])))return r.clone();const o=zR(i,s);return o?pe.FromPoints(o):void 0}return r})}getShapeAncestors(e,r=[]){const i=typeof e=="string"?e:e.id,s=this.getShape(i);if(!s)return r;const o=s.parentId;if(Ln(o))return r.reverse(),r;const a=this.store.get(o);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(e,r){const i=typeof e=="string"?e:e.id,s=this.getShape(i);if(!s)return;const o=s.parentId;if(Ln(o))return;const a=this.getShape(o);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(e,r){const i=typeof e=="string"?e:e?.id,s=i&&this.getShape(i);return s?s.parentId===r?!0:this.hasAncestor(this.getShapeParent(s),r):!1}findCommonAncestor(e,r){if(e.length===0)return;const i=typeof e[0]=="string"?e:e.map(l=>l.id),s=Be(i.map(l=>this.getShape(l)));if(s.length===1){const l=s[0].parentId;return Ln(l)?void 0:r?this.findShapeAncestor(s[0],r)?.id:l}const[o,...a]=s;let c=this.getShapeParent(o);for(;c;){if(r&&!r(c)){c=this.getShapeParent(c);continue}if(a.every(l=>this.hasAncestor(l,c.id)))return c.id;c=this.getShapeParent(c)}}isShapeOrAncestorLocked(e){const r=typeof e=="string"?this.getShape(e):e;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}_notVisibleShapes(){return Nre(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),r=this.getSelectedShapeIds(),i=this.getEditingShapeId(),s=new Set(e);return i&&s.delete(i),r.forEach(o=>{s.delete(o)}),s}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(e?e=e.expand(i):e=i.clone())}),e}getSelectedShapeAtPoint(e){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,r={}){const i=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:o,margin:a=0,hitLocked:c=!1,hitLabels:l=!1,hitInside:u=!1,hitFrameInside:d=!1}=r;let h=1/0,p=null,g=1/0,y=null;const v=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(x=>{if(x.isLocked&&!c||this.isShapeOfType(x,"group"))return!1;const m=this.getShapeMask(x);return m&&!ar(e,m)?!1:o?o(x):!0});for(let x=v.length-1;x>=0;x--){const m=v[x],b=this.getShapeGeometry(m),S=b instanceof Qr,w=this.getPointInShapeSpace(m,e);if((this.isShapeOfType(m,"arrow")||this.isShapeOfType(m,"geo")&&m.props.fill==="none")&&m.props.text.trim()){for(const C of b.children)if(C.isLabel&&C.isPointInBounds(w))return m}if(this.isShapeOfType(m,"frame")){const C=b.distanceToPoint(w,u);if(Math.abs(C)<=a)return y||m;if(b.hitTestPoint(w,0,!0))return y||p||(d?m:void 0);continue}let I;if(S){let C=1/0;for(const _ of b.children){if(_.isLabel&&!l)continue;const P=_.distanceToPoint(w,u);P<C&&(C=P)}I=C}else a===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(w,a)?I=b.distanceToPoint(w,u):I=1/0;if(b.isClosed){if(I<=a){if(b.isFilled||S&&b.children[0].isFilled)return y||m;if(this.getShapePageBounds(m).contains(s))continue;if(Math.abs(I)<a)Math.abs(I)<g&&(g=Math.abs(I),y=m);else if(!y){const{area:C}=b;C<h&&(h=C,p=m)}}}else if(I<this.options.hitTestMargin/i)return m}return y||p||void 0}getShapesAtPoint(e,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,e,r))}isPointInShape(e,r,i={}){const{hitInside:s=!1,margin:o=0}=i,a=typeof e=="string"?e:e.id,c=this.getShapeMask(a);return c&&!ar(r,c)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(e,r),o,s)}getPointInShapeSpace(e,r){const i=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(e,r){const i=typeof e=="string"?e:e.id,s=this.getShape(i);if(!s)return new k(0,0);if(Ln(s.parentId))return k.From(r);const o=this.getShapePageTransform(s.parentId);return o?o.clone().invert().applyToPoint(r):k.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],r=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let i=0,s=r.length;i<s;i++)n$(this,r[i],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:r})=>!e.has(r))}isShapeOfType(e,r){const i=typeof e=="string"?this.getShape(e):e;return i?i.type===r:!1}getShape(e){const r=typeof e=="string"?e:e.id;if(zn(r))return this.store.get(r)}getShapeParent(e){const r=typeof e=="string"?e:e?.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!zn(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(e,r){return r?r.parentId===e.parentId?r:this.findShapeAncestor(r,s=>s.parentId===e.parentId):void 0}isShapeInPage(e,r=this.getCurrentPageId()){const i=typeof e=="string"?e:e.id,s=this.getShape(i);if(!s)return!1;let o=!1;if(s.parentId===r)o=!0;else{let a=this.getShape(s.parentId);e:for(;a;){if(a.parentId===r){o=!0;break e}a=this.getShape(a.parentId)}}return o}getAncestorPageId(e){const r=typeof e=="string"?e:e?.id,i=r&&this.getShape(r);if(i)return Ln(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}_parentIdsToChildIds;reparentShapes(e,r,i){const s=typeof e[0]=="string"?e:e.map(p=>p.id);if(s.length===0)return this;const o=[],a=Ln(r)?de.Identity():this.getShapePageTransform(r),c=a.rotation();let l=[];const u=Be(this.getSortedChildIdsForParent(r).map(p=>this.getShape(p)));if(i){const p=u.find(g=>g.index===i);if(p){const g=u[u.indexOf(p)+1];g?l=Ma(i,g.index,s.length):l=tS(i,s.length)}else{const g=u.sort(bn).find(y=>y.index>i);g?l=Ma(i,g.index,s.length):l=tS(i,s.length)}}else{const p=u.length&&u[u.length-1];l=p?tS(p.index,s.length):_l(s.length)}const d=a.clone().invert(),h=Be(s.map(p=>this.getShape(p)));return this.run(()=>{for(let p=0;p<h.length;p++){const g=h[p],y=this.getShapePageTransform(g);if(!y)continue;const v=y.point();if(!v)continue;const x=d.applyToPoint(v),m=y.rotation()-c;o.push({id:g.id,type:g.type,parentId:r,x:x.x,y:x.y,rotation:m,index:l[p]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const r=typeof e=="string"?e:e.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const s=this.getShape(i[i.length-1]);return Hr(s.index)}getSortedChildIdsForParent(e){const r=typeof e=="string"?e:e.id,i=this._parentIdsToChildIds.get()[r];return i||Yi}visitDescendants(e,r){const i=typeof e=="string"?e:e.id,s=this.getSortedChildIdsForParent(i);for(const o of s)r(o)!==!1&&this.visitDescendants(o,r);return this}getShapeAndDescendantIds(e){const r=new Set;for(const i of e.map(s=>this.getShape(s)).sort(bn))r.add(i.id),this.visitDescendants(i,s=>{r.add(s)});return r}getDroppingOverShape(e,r=[]){const i=this.getCurrentPageShapesSorted();for(let s=i.length-1;s>=0;s--){const o=i[s];if(this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,r)||r.find(c=>c.id===o.id||this.hasAncestor(o,c.id)))continue;const a=this.getShapeMaskedPageBounds(o.id);if(a&&a.containsPoint(e)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,e),0,!0))return o}}getOutermostSelectableShape(e,r){const i=typeof e=="string"?e:e.id,s=this.getShape(i);let o=s,a=s;const c=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&c?.id!==a.id&&!this.hasAncestor(c,a.id)&&(r?.(a)??!0))o=a;else if(c?.id===a.id)break;a=this.getShapeParent(a)}return o}_getBindingsIndexCache(){const e=Ore(this);return this.store.createComputedCache("bindingsIndex",r=>e.get().get(r.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,r){const i=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(i).filter(s=>s.fromId===i&&s.type===r)}getBindingsToShape(e,r){const i=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(i).filter(s=>s.toId===i&&s.type===r)}getBindingsInvolvingShape(e,r){const i=typeof e=="string"?e:e.id,s=this._getBindingsIndexCache().get(i)??Yi;return r?s.filter(o=>o.type===r):s}createBindings(e){const r=[];for(const i of e){const s=this.getShape(i.fromId),o=this.getShape(i.toId);if(!s||!o||!this.canBindShapes({fromShape:s,toShape:o,binding:i}))continue;const c=this.getBindingUtil(i.type).getDefaultProps(),l=this.store.schema.types.binding.create({...i,id:i.id??yo(),props:{...c,...i.props}});r.push(l)}return this.store.put(r),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const r=[];for(const i of e){if(!i)continue;const s=this.getBinding(i.id);if(!s)continue;const o=si(s,i);if(o===s)continue;const a=this.getShape(o.fromId),c=this.getShape(o.toId);!a||!c||this.canBindShapes({fromShape:a,toShape:c,binding:o})&&r.push(o)}return this.store.put(r),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:r=!1}={}){const i=e.map(s=>typeof s=="string"?s:s.id);return r?this.store.atomic(()=>{for(const s of i){const o=this.getBinding(s);if(!o)continue;const a=this.getBindingUtil(o);a.onBeforeIsolateFromShape?.({binding:o,removedShape:this.getShape(o.toId)}),a.onBeforeIsolateToShape?.({binding:o,removedShape:this.getShape(o.fromId)}),this.store.remove([s])}}):this.store.remove(i),this}deleteBinding(e,r){return this.deleteBindings([e],r)}canBindShapes({fromShape:e,toShape:r,binding:i}){const s=typeof e=="string"?e:e.type,o=typeof r=="string"?r:r.type,a=typeof i=="string"?i:i.type,c={fromShapeType:s,toShapeType:o,bindingType:a};return s===o?this.getShapeUtil(s).canBind(c):this.getShapeUtil(s).canBind(c)&&this.getShapeUtil(o).canBind(c)}rotateShapesBy(e,r){if((typeof e[0]=="string"?e:e.map(o=>o.id)).length<=0)return this;const s=Qz({editor:this});return s?(kd({delta:r,snapshot:s,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(e,r){let i=e;const s=this.getShapeUtil(e);return i=si(i,s.onTranslateStart?.(i)??void 0),i=si(i,{id:e.id,type:e.type,x:r.x,y:r.y}),i=si(i,s.onTranslate?.(e,i)??void 0),i=si(i,s.onTranslateEnd?.(e,i)??void 0),i}nudgeShapes(e,r){const i=typeof e[0]=="string"?e:e.map(o=>o.id);if(i.length<=0)return this;const s=[];for(const o of i){const a=this.getShape(o),c=k.From(r),l=this.getShapeParentTransform(a);l&&c.rot(-l.rotation()),s.push(this.getChangesToTranslateShape(a,c.add(a)))}return this.updateShapes(s),this}duplicateShapes(e,r){return this.run(()=>{const i=typeof e[0]=="string"?e:e.map(h=>h.id);if(i.length<=0)return this;const s=new Set(i),o=this.getShapeAndDescendantIds(i),a=[...o].reverse(),c=new Map;for(const h of o)c.set(h,it());const{shapesToCreate:l,bindingsToCreate:u}=GR(this,o,h=>{const p=[];for(const y of h){const v=this.getBinding(y);if(!v)continue;const x=yo();p.push({...v,id:x,fromId:Pr(c.get(v.fromId)),toId:Pr(c.get(v.toId))})}const g=[];for(const y of a){const v=Pr(c.get(y)),x=this.getShape(y);if(!x)continue;let m=0,b=0;if(r&&s.has(y)){const M=this.getShapeParentTransform(x),T=new k(r.x,r.y).rot(-M.rotation());m=T.x,b=T.y}const S=x.parentId,w=this.getSortedChildIdsForParent(S),I=w.indexOf(x.id),C=w[I+1],_=C?this.getShape(C):null,P=_?wl(x.index,_.index):Hr(x.index);g.push({...x,id:v,x:x.x+m,y:x.y+b,index:P,parentId:c.get(x.parentId)??x.parentId})}return{shapesToCreate:g,bindingsToCreate:p}});if(l.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Xu(this);return}if(this.createShapes(l),this.createBindings(u),this.setSelectedShapes(Be(i.map(h=>c.get(h)))),r!==void 0){const h=this.getSelectionPageBounds(),p=this.getViewportPageBounds();h&&!p.contains(h)&&this.centerOnPoint(h.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,r){const i=typeof e[0]=="string"?e:e.map(c=>c.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const s=this.getCurrentPageId();if(r===s)return this;if(!this.store.has(r))return this;const o=this.getContentFromCurrentPage(i);if(!o)return this;if(this.getPageShapeIds(r).size+o.shapes.length>this.options.maxShapesPerPage)return Xu(this,r),this;const a=this.getCamera().z;return this.run(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,s=!0;const o=[];for(const a of r){const c=this.getShape(a);c&&(o.push(c),c.isLocked?s=!1:i=!1)}return this.run(()=>{s?(this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Yu(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Yu(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Yu(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Yu(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(e,r){const i=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let s=Be(i.map(a=>this.getShape(a)));if(!s.length)return this;s=Be(s.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(c=>this.getShape(c)):a).flat());const o=pe.Common(Be(s.map(a=>this.getShapePageBounds(a)))).center;return this.run(()=>{for(const a of s){const c=this.getShapeGeometry(a).bounds,l=this.getShapePageTransform(a.id);l&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:c,initialPageTransform:l,initialShape:a,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(a).isAspectRatioLocked(a),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(e,r,i){const s=typeof e[0]=="string"?e:e.map(v=>v.id);if(this.getInstanceState().isReadonly)return this;const o=s.map(v=>this.getShape(v)).filter(v=>v?this.getShapeUtil(v).canBeLaidOut(v):!1),a=o.length;if(i===0&&a<3||a<2)return this;const c=Object.fromEntries(o.map(v=>[v.id,this.getShapePageBounds(v)]));let l,u,d,h;r==="horizontal"?(l="x",u="minX",d="maxX",h="width"):(l="y",u="minY",d="maxY",h="height");let p;if(i===0){const v=[];o.sort((m,b)=>c[m.id][u]-c[b.id][u]);for(let m=0;m<a-1;m++){const b=o[m],S=o[m+1],w=c[b.id],C=c[S.id][u]-w[d],_=v.find(P=>P.gap===C);_?_.count++:v.push({gap:C,count:1})}let x=0;v.forEach(m=>{m.count>x&&(x=m.count,p=m.gap)}),x===1&&(p=Math.max(0,v.reduce((m,b)=>m+b.gap*b.count,0)/(a-1)))}else p=i;const g=[];let y=c[o[0].id][d];return o.forEach((v,x)=>{if(x===0)return;const m={x:0,y:0};m[l]=y+p-c[v.id][l];const b=this.getShapeParent(v),S=b?k.Rot(m,-this.getShapePageTransform(b).decompose().rotation):m,w=this.getShapeUtil(v).onTranslateStart?.(v);g.push(w?{...w,[l]:v[l]+S[l]}:{id:v.id,type:v.type,[l]:v[l]+S[l]}),y+=c[v.id][h]+p}),this.updateShapes(g),this}packShapes(e,r){const i=typeof e[0]=="string"?e:e.map(C=>C.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=i.map(C=>this.getShape(C)).filter(C=>C?this.getShapeUtil(C).canBeLaidOut(C):!1),o={},a={};let c,l,u=0;for(let C=0;C<s.length;C++)c=s[C],l=this.getShapePageBounds(c),o[c.id]=l,a[c.id]=l.clone(),u+=l.width*l.height;const d=pe.Common(Be(Object.values(o))),h=d.width;s.sort((C,_)=>o[_.id].height-o[C.id].height);const p=Math.max(Math.ceil(Math.sqrt(u/.95)),h),g=[new pe(d.x,d.y,p,1/0)];let y=0,v=0,x,m;for(let C=0;C<s.length;C++){c=s[C],l=a[c.id];for(let _=g.length-1;_>=0;_--)if(x=g[_],!(l.width>x.width||l.height>x.height)){l.x=x.x,l.y=x.y,v=Math.max(v,l.maxY),y=Math.max(y,l.maxX),l.width===x.width&&l.height===x.height?(m=g.pop(),_<g.length&&(g[_]=m)):l.height===x.height?(x.x+=l.width+r,x.width-=l.width+r):l.width===x.width?(x.y+=l.height+r,x.height-=l.height+r):(g.push(new pe(x.x+(l.width+r),x.y,x.width-(l.width+r),l.height)),x.y+=l.height+r,x.height-=l.height+r);break}}const b=pe.Common(Object.values(a)),S=k.Sub(d.center,b.center);let w;const I=[];for(let C=0;C<s.length;C++){c=s[C],l=o[c.id],w=a[c.id];const _=k.Sub(w.point,l.point).add(S),P=this.getShapeParentTransform(c);P&&_.rot(-P.rotation());const M={id:c.id,type:c.type,x:c.x+_.x,y:c.y+_.y},T=this.getShapeUtil(c).onTranslateStart?.({...c,...M});T?I.push({...M,...T}):I.push(M)}return I.length&&this.updateShapes(I),this}alignShapes(e,r){const i=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=Be(i.map(l=>this.getShape(l))),o=Object.fromEntries(s.map(l=>[l.id,this.getShapePageBounds(l)])),a=pe.Common(Be(Object.values(o))),c=[];return s.forEach(l=>{const u=o[l.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const h=this.getShapeParent(l),p=h?k.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d;c.push(this.getChangesToTranslateShape(l,k.Add(l,p)))}),this.updateShapes(c),this}distributeShapes(e,r){const i=typeof e[0]=="string"?e:e.map(b=>b.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const s=i.length,o=Be(i.map(b=>this.getShape(b))),a=Object.fromEntries(o.map(b=>[b.id,this.getShapePageBounds(b)]));let c,l,u,d,h;r==="horizontal"?(c="x",l="minX",u="maxX",d="midX",h="width"):(c="y",l="minY",u="maxY",d="midY",h="height");const p=[],g=o.sort((b,S)=>a[b.id][l]-a[S.id][l])[0],y=o.sort((b,S)=>a[S.id][u]-a[b.id][u])[0],v=a[g.id][d],x=(a[y.id][d]-v)/(s-1),m=v+x;return o.filter(b=>b!==g&&b!==y).sort((b,S)=>a[b.id][d]-a[S.id][d]).forEach((b,S)=>{const w={x:0,y:0};w[c]=m+x*S-a[b.id][h]/2-a[b.id][c];const I=this.getShapeParent(b),C=I?k.Rot(w,-this.getShapePageTransform(I).rotation()):w;p.push(this.getChangesToTranslateShape(b,k.Add(b,C)))}),this.updateShapes(p),this}stretchShapes(e,r){const i=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=Be(i.map(l=>this.getShape(l))),o=Object.fromEntries(i.map(l=>[l,this.getShapeGeometry(l).bounds])),a=Object.fromEntries(i.map(l=>[l,this.getShapePageBounds(l)])),c=pe.Common(Be(Object.values(a)));switch(r){case"vertical":{this.run(()=>{for(const l of s){if(this.getShapePageTransform(l).rotation()%rt)continue;const d=o[l.id],h=a[l.id],p=new k(0,c.minY-h.minY),g=this.getShapeParentTransform(l);g&&p.rot(-g.rotation());const{x:y,y:v}=k.Add(p,l);this.updateShapes([{id:l.id,type:l.type,x:y,y:v}]);const x=new k(1,c.height/h.height);this.resizeShape(l.id,x,{initialBounds:d,scaleOrigin:new k(h.center.x,c.minY),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const l of s){const u=o[l.id],d=a[l.id];if(this.getShapePageTransform(l).rotation()%rt)continue;const p=new k(c.minX-d.minX,0),g=this.getShapeParentTransform(l);g&&p.rot(-g.rotation());const{x:y,y:v}=k.Add(p,l);this.updateShapes([{id:l.id,type:l.type,x:y,y:v}]);const x=new k(c.width/d.width,1);this.resizeShape(l.id,x,{initialBounds:u,scaleOrigin:new k(c.minX,d.center.y),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}}return this}resizeShape(e,r,i={}){const s=typeof e=="string"?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new k(1,r.y)),Number.isFinite(r.y)||(r=new k(r.x,1));const o=i.initialShape??this.getShape(s);if(!o)return this;const a=i.scaleOrigin??this.getShapePageBounds(s)?.center;if(!a)return this;const c=i.initialPageTransform?de.Cast(i.initialPageTransform):this.getShapePageTransform(s);if(!c)return this;const l=c.rotation();if(l==null)return this;const u=i.scaleAxisRotation??l,d=i.initialBounds??this.getShapeGeometry(s).bounds;if(!d)return this;const h=i.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!cz(l,u))return this._resizeUnalignedShape(s,r,{...i,initialBounds:d,scaleOrigin:a,scaleAxisRotation:u,initialPageTransform:c,isAspectRatioLocked:h,initialShape:o});const p=this.getShapeUtil(o);if(h&&(Math.abs(r.x)>Math.abs(r.y)?r=new k(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new k(Math.sign(r.x)*Math.abs(r.y),r.y)),p.onResize&&p.canResize(o)){const g=this._scalePagePoint(de.applyToPoint(c,new k(0,0)),a,r,u),y=this.getPointInParentSpace(o.id,g),v=new k(r.x,r.y),x=Os((l-u)%Math.PI,0);v.x=x?r.x:r.y,v.y=x?r.y:r.x;const m=de.applyToPoint(c,new k),{x:b,y:S}=this.getPointInParentSpace(o.id,m);let w=o;i.skipStartAndEndCallbacks||(w=si(o,p.onResizeStart?.(o)??void 0)),w=si(w,{id:s,type:o.type,x:y.x,y:y.y,...p.onResize({...o,x:b,y:S},{newPoint:y,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:v.x,scaleY:v.y,initialBounds:d,initialShape:o})}),i.skipStartAndEndCallbacks||(w=si(w,p.onResizeEnd?.(o,w)??void 0)),this.updateShapes([w])}else{const g=de.applyToPoint(c,d.center),y=this._scalePagePoint(g,a,r,u),v=this.getPointInParentSpace(o.id,g),x=this.getPointInParentSpace(o.id,y),m=k.Sub(x,v);this.updateShapes([{id:s,type:o.type,x:o.x+m.x,y:o.y+m.y}])}return this}_scalePagePoint(e,r,i,s){const o=k.RotWith(e,r,-s).sub(r),a=k.MulV(o,i);return k.Add(a,r).rotWith(r,s)}_resizeUnalignedShape(e,r,i){const{type:s}=i.initialShape,o=new k(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?o.x=Math.sign(r.x)*Math.abs(r.y):o.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(e,o,{initialShape:i.initialShape,initialBounds:i.initialBounds,isAspectRatioLocked:i.isAspectRatioLocked}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:x}=de.Decompose(i.initialPageTransform);x-=2*x,this.updateShapes([{id:e,type:s,rotation:x}])}const a=de.applyToPoint(i.initialPageTransform,i.initialBounds.center),c=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),l=this.getShapePageBounds(e),u=this.getShapePageTransform(e),d=l.center,h=u.point();if(!d||!h)return this;const p=k.Sub(c,d),g=k.Add(h,p),{x:y,y:v}=this.getPointInParentSpace(e,g);return this.updateShapes([{id:e,type:s,x:y,y:v}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(e.length<=0)return this;const r=this.getCurrentPageShapeIds();if(e.length+r.size>this.options.maxShapesPerPage)return Xu(this),this;const s=this.getFocusedGroupId();return this.run(()=>{const o=this.getCurrentPageShapesSorted(),a=e.map(d=>{if(d.id||(d={id:it(),...d}),!d.parentId||!(this.store.has(d.parentId)||e.some(h=>h.id===d.parentId))){let h=this.getFocusedGroupId();for(let g=o.length-1;g>=0;g--){const y=o[g];if(this.getShapeUtil(y).canReceiveNewChildrenOfType(y,d.type)&&this.isPointInShape(y,{x:d.x??0,y:d.y??0},{margin:0,hitInside:!0})){h=y.id;break}}const p=d.parentId;if(h===d.id&&(h=s),h!==p&&(d={...d},d.parentId=h,zn(h))){const g=this.getPointInShapeSpace(this.getShape(h),{x:d.x??0,y:d.y??0});d.x=g.x,d.y=g.y,d.rotation=-this.getShapePageTransform(h).rotation()+(d.rotation??0)}}return d}),c=new Map,l=[],{opacityForNextShape:u}=this.getInstanceState();for(const d of a){const h=this.getShapeUtil(d);let p=d.index;if(!p){const x=d.parentId??s;c.has(x)||c.set(x,this.getHighestIndexForParent(x)),p=c.get(x),c.set(x,Hr(p))}const g=h.getDefaultProps();for(const[x,m]of this.styleProps[d.type])g[m]=this.getStyleForNextShape(x);let y=this.store.schema.types.shape.create({...d,index:p,opacity:d.opacity??u,parentId:d.parentId??s,props:"props"in d?{...g,...d.props}:g});if(y.index===void 0)throw Error("no index!");const v=this.getShapeUtil(y).onBeforeCreate?.(y);v&&(y=v),l.push(y)}l.forEach(d=>{d.meta={...this.getInitialMetaForShape(d),...d.meta}}),this.store.put(l)}),this}animatingShapes=new Map;animateShape(e,r={animation:cS}){return this.animateShapes([e],r)}animateShapes(e,r={animation:cS}){if(!r.animation)return this;const{duration:i=500,easing:s=Wt.linear}=r.animation,o=kt();let a=i,c;const l=[];let u,d;for(let p=0,g=e.length;p<g;p++){if(u=e[p],!u)continue;const y=this.getShape(u.id);y&&(d={start:ft(y),end:si(ft(y),u)},l.push(d),this.animatingShapes.set(y.id,o))}const h=p=>{if(a-=p,a<0){const{animatingShapes:x}=this,m=e.filter(b=>b&&x.get(b.id)===o);m.length&&this.updateShapes(m),this.off("tick",h);return}c=s(1-a/i);const{animatingShapes:g}=this,y=[];let v;for(let x=0,m=l.length;x<m;x++){const{start:b,end:S}=l[x];v=g.get(b.id),v===o&&y.push({...S,x:b.x+(S.x-b.x)*c,y:b.y+(S.y-b.y)*c,opacity:b.opacity+(S.opacity-b.opacity)*c,rotation:b.rotation+(S.rotation-b.rotation)*c,props:this.getShapeUtil(S).getInterpolatedProps?.(b,S,c)??S.props})}this._updateShapes(y)};return this.on("tick",h),this}groupShapes(e,r={}){const{groupId:i=it(),select:s=!0}=r;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof e[0]=="string"?e:e.map(y=>y.id);if(o.length<=1)return this;const a=Be((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(y=>this.getShape(y))),c=a.sort(bn).map(y=>y.id),l=pe.Common(Be(a.map(y=>this.getShapePageBounds(y)))),{x:u,y:d}=l.point,h=this.findCommonAncestor(a)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=a.filter(y=>y.parentId===h).sort(bn),g=p[p.length-1]?.index;return this.run(()=>{this.createShapes([{id:i,type:"group",parentId:h,index:g,x:u,y:d,opacity:1,props:{}}]),this.reparentShapes(c,i),s&&this.select(i)}),this}ungroupShapes(e,r={}){if(this.getInstanceState().isReadonly)return this;const{select:i=!0}=r,s=typeof e[0]=="string"?e:e.map(l=>l.id),o=Be((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(l=>this.getShape(l)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const a=new Set,c=[];return o.forEach(l=>{this.isShapeOfType(l,"group")?c.push(l):a.add(l.id)}),c.length===0?this:(this.run(()=>{let l;for(let u=0,d=c.length;u<d;u++){l=c[u];const h=this.getSortedChildIdsForParent(l.id);for(let p=0,g=h.length;p<g;p++)a.add(h[p]);this.reparentShapes(h,l.parentId,l.index)}this.deleteShapes(c.map(u=>u.id)),i&&this.select(...a)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const r=Array(e.length);for(let i=0,s=e.length;i<s;i++){const o=e[i];if(!o)continue;const a=this.getShape(o.id);if(a){if(!this._shouldIgnoreShapeLock){if(a.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(a))continue}this.animatingShapes.delete(o.id),r.push(o)}}return this._updateShapes(r),this}_updateShapes=e=>{this.getInstanceState().isReadonly||this.run(()=>{const r=[];let i,s;for(let o=0,a=e.length;o<a;o++){const c=e[o];c&&(i=this.getShape(c.id),i&&(s=si(i,c),s!==i&&(s=this.getShapeUtil(i).onBeforeUpdate?.(i,s)??s,r.push(s))))}this.store.put(r)})};_getUnlockedShapeIds(e){return e.filter(r=>!this.getShape(r)?.isLocked)}deleteShapes(e){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const r=typeof e[0]=="string"?e:e.map(o=>o.id),i=this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r);if(i.length===0)return this;const s=new Set(i);for(const o of i)this.visitDescendants(o,a=>{s.add(a)});return this.run(()=>this.store.remove([...s]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,r){if(this.isShapeOfType(e,"group")){const i=this._parentIdsToChildIds.get()[e.id];if(!i)return;for(let s=0,o=i.length;s<o;s++)this._extractSharedStyles(this.getShape(i[s]),r)}else for(const[i,s]of this.styleProps[e.type])r.applyValue(i,Hn(e.props,s))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),r=new Pw;for(const i of e)this._extractSharedStyles(i,r);return r}getStyleForNextShape(e){const r=this.getInstanceState().stylesForNextShape[e.id];return r===void 0?e.defaultValue:r}getShapeStyleIfExists(e,r){const i=this.styleProps[e.type].get(r);if(i!==void 0)return Hn(e.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),r=new Pw;if(!e)return r;if(e.shapeType)for(const i of this.styleProps[e.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],r=s=>{const o=this.getShape(s);if(o)if(this.isShapeOfType(o,"group"))for(const a of this.getSortedChildIdsForParent(o.id))r(a);else e.push(o)};for(const s of this.getSelectedShapeIds())r(s);let i=null;for(const s of e)if(i===null)i=s.opacity;else if(i!==s.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,r){return this.updateInstanceState({opacityForNextShape:e},r),this}setOpacityForSelectedShapes(e){const r=this.getSelectedShapes();if(r.length>0){const i=[],s=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o);for(const c of a)s(this.getShape(c))}else i.push(o)};for(const o of r)s(o);this.updateShapes(i.map(o=>({id:o.id,type:o.type,opacity:e})))}return this}setStyleForNextShapes(e,r,i){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[e.id]:r}},i),this}setStyleForSelectedShapes(e,r){const i=this.getSelectedShapes();if(i.length>0){const s=[],o=a=>{if(this.isShapeOfType(a,"group")){const c=this.getSortedChildIdsForParent(a.id);for(const l of c)o(this.getShape(l))}else{const c=this.getShapeUtil(a),l=this.styleProps[a.type].get(e);if(l){const u={id:a.id,type:a.type,props:{[l]:r}};s.push({util:c,originalShape:a,updatePartial:u})}}};for(const a of i)o(a);this.updateShapes(s.map(({updatePartial:a})=>a))}return this}externalAssetContentHandlers={file:null,url:null};registerExternalAssetHandler(e,r){return this.externalAssetContentHandlers[e]=r,this}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}externalContentHandlers={text:null,files:null,embed:null,"svg-text":null,url:null};registerExternalContentHandler(e,r){return this.externalContentHandlers[e]=r,this}async putExternalContent(e){return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(!r||r.length===0)return;const i=this.getShapeAndDescendantIds(r);return GR(this,i,s=>{const o=[];for(const d of s){const h=this.getBinding(d);h&&o.push(h)}const a=[],c=[];for(const d of i){const h=this.getShape(d);if(!h)continue;if(!i.has(h.parentId)){const g=this.getShapePageTransform(h.id),y=g.point();c.push({...h,x:y.x,y:y.y,rotation:g.rotation(),parentId:this.getCurrentPageId()}),a.push(h.id)}else c.push(h)}const l=[],u=new Set;for(const d of c){if(!("assetId"in d.props))continue;const h=d.props.assetId;if(!h||u.has(h))continue;u.add(h);const p=this.getAsset(h);p&&l.push(p)}return{schema:this.store.schema.serialize(),shapes:c,rootShapeIds:a,bindings:o,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const r=[];return await Promise.allSettled(e.assets.map(async i=>{if((i.type==="image"||i.type==="video")&&!i.props.src?.startsWith("data:image")&&!i.props.src?.startsWith("http")){const s=ft(i),o=await this.store.props.assets.resolve(i,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});s.props.src=await mo.blobToDataUrl(await bi(o).then(a=>a.blob())),r.push(s)}else r.push(i)})),e.assets=r,e}putContentOntoCurrentPage(e,r={}){if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:s=!1,preservePosition:o=!1}=r;let{point:a=void 0}=r;const c=this.getCurrentPageId(),{rootShapeIds:l}=e,u=[],d=[],h=[],p={store:{...Object.fromEntries(e.assets.map(T=>[T.id,T])),...Object.fromEntries(e.shapes.map(T=>[T.id,T])),...Object.fromEntries(e.bindings?.map(T=>[T.id,T])??[])},schema:e.schema},g=this.store.schema.migrateStoreSnapshot(p);if(g.type==="error")throw Error("Could not put content: could not migrate content");for(const T of Object.values(g.value))switch(T.typeName){case"asset":{u.push(T);break}case"shape":{d.push(T);break}case"binding":{h.push(T);break}}const y=new Map(s?d.map(T=>[T.id,T.id]):d.map(T=>[T.id,it()])),v=new Map(s?h.map(T=>[T.id,T.id]):h.map(T=>[T.id,yo()]));let x=this.getCurrentPageId(),m=1/0,b=[];for(const T of this.getSelectedShapes()){if(m===0)break;const A=this.isShapeOfType(T,"frame"),R=this.getShapeAncestors(T);A&&R.push(T);const O=A?R.length+1:R.length;if(O<m)m=O,b=R,x=A?T.id:T.parentId;else if(O===m){if(b.length!==R.length)throw Error(`Ancestors: ${b.length} !== ${R.length}`);if(b.length===0){x=c;break}else{x=c;for(let j=0;j<b.length&&R[j]===b[j];j++)x=R[j].id}}}let S=!1;if(!Ln(x)){const T=this.getShape(x);if(T){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(T)))x=c;else if(l.length===1){const A=d.find(R=>R.id===l[0]);this.isShapeOfType(T,"frame")&&this.isShapeOfType(A,"frame")&&A.props.w===T?.props.w&&A.props.h===T?.props.h&&(S=!0)}}else x=c}S||(S=y.has(x)),S&&(x=this.getShape(x).parentId);let w=this.getHighestIndexForParent(x);const I=[],C=d.map(T=>{const A=y.get(T.id),R={...T,id:A};return l.includes(T.id)&&(R.parentId=c,I.push(R)),y.has(R.parentId)?R.parentId=y.get(T.parentId):(l.push(R.id),R.index=w,w=Hr(w)),R});if(C.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Xu(this),this;const _=h.map(T=>({...T,id:Pr(v.get(T.id)),fromId:Pr(y.get(T.fromId)),toId:Pr(y.get(T.toId))})),P=[],M=[];for(const T of u)this.store.has(T.id)||((T.type==="image"||T.type==="video")&&T.props.src?.startsWith("data:image")&&(M.push(ft(T)),T.props.src=null),P.push(T));return Promise.allSettled(M.map(async T=>{const A=await Ere(T.props.src,T.props.name,T.props.mimeType??"image/png"),R=await this.getAssetForExternalContent({type:"file",file:A});if(!R){this.deleteAssets([T.id]);return}this.updateAssets([{...R,id:T.id}])})),this.run(()=>{P.length>0&&this.createAssets(P),this.createShapes(C),this.createBindings(_),i&&this.select(...I.map(j=>j.id)),x!==c&&this.reparentShapes(I.map(j=>j.id),x);const T=C.map(j=>this.getShape(j.id)),A=pe.Common(T.map(j=>this.getShapePageBounds(j)));if(a===void 0)if(Ln(x)){const j=this.getViewportPageBounds();o||j.includes(pe.From(A))?a=A.center:a=j.center}else{const j=this.getShape(x);a=de.applyToPoint(this.getShapePageTransform(j),this.getShapeGeometry(j).bounds.center)}if(I.length===1){const j=I[0];if(this.isShapeOfType(j,"frame"))for(;this.getShapesAtPoint(a).some(D=>this.isShapeOfType(D,"frame")&&D.props.w===j.props.w&&D.props.h===j.props.h);)a.x+=A.w+16}const R=pe.Common(Be(I.map(({id:j})=>this.getShapePageBounds(j)))).center,O=k.Sub(a,R);this.updateShapes(I.map(({id:j})=>{const D=this.getShape(j),N=this.getShapeParentTransform(j).decompose().rotation,F=k.Rot(O,-N);return{id:D.id,type:D.type,x:D.x+F.x,y:D.y+F.y}}))}),this}async getSvgElement(e,r={}){const i=await $re(this,e,r);if(!i)return;const s=document.createDocumentFragment(),o=HB.createRoot(s);GB.flushSync(()=>{o.render(i.jsx)});const a=s.firstElementChild;return gt(a instanceof SVGSVGElement,"Expected an SVG element"),o.unmount(),{svg:a,width:i.width,height:i.height}}async getSvgString(e,r={}){const i=await this.getSvgElement(e,r);return i?{svg:new XMLSerializer().serializeToString(i.svg),width:i.width,height:i.height}:void 0}async getSvg(e,r={}){const i=await this.getSvgElement(e,r);if(i)return i.svg}inputs={originPagePoint:new k,originScreenPoint:new k,previousPagePoint:new k,previousScreenPoint:new k,currentPagePoint:new k,currentScreenPoint:new k,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new k};_updateInputsFromEvent(e){const{pointerVelocity:r,previousScreenPoint:i,previousPagePoint:s,currentScreenPoint:o,currentPagePoint:a}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(kn),{x:l,y:u,z:d}=zu(()=>this.getCamera()),h=e.point.x-c.x,p=e.point.y-c.y,g=e.point.z??.5;i.setTo(o),s.setTo(a),o.set(h,p);const y=h/d-l,v=p/d-u;isFinite(y)&&isFinite(v)&&a.set(y,v,g),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(r.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(a)),this.run(()=>{this.store.put([{id:nh,typeName:"pointer",x:a.x,y:a.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===vR.CAMERA_MOVE?this.store.unsafeGetWithoutCapture(nh)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return Vz(this.store)}loadSnapshot(e){return L_(this.store,e),this}_clickManager=new Ure(this);cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_prevCursor="default";_shiftKeyTimeout=-1;_setShiftKeyTimeout=()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})};_altKeyTimeout=-1;_setAltKeyTimeout=()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})};_ctrlKeyTimeout=-1;_setCtrlKeyTimeout=()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})};_restoreToolId="select";_pinchStart=1;_didPinch=!1;_selectedShapeIdsAtPointerDown=[];_longPressTimeout=-1;capturedPointerId=null;performanceTracker;performanceTrackerTimeout=-1;dispatch=e=>(this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this);_pendingEventsForNextTick=[];_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const r=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const i of r)this._flushEventForTick(i)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick=e=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!e.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!e.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!e.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:s,currentPagePoint:o}=r;r.isPointing||(r.isDragging=!1);const a=this.store.unsafeGetWithoutCapture(kn),c=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(i){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...c.selectedShapeIds]),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{z:u=1},delta:{x:d,y:h}}=e,{x:p,y:g}=k.SubXY(e.point,a.screenBounds.x,a.screenBounds.y);this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:y,y:v,z:x}=zu(()=>this.getCamera()),{panSpeed:m,zoomSpeed:b}=l;this._setCamera(new k(y+d*m/x-p/x+p/(u*b),v+h*m/x-g/x+g/(u*b),u*b),{immediate:!0});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(l.isLocked)return;if(this._updateInputsFromEvent(e),!this.getIsMenuOpen()){const{panSpeed:u,zoomSpeed:d,wheelBehavior:h}=l;if(h!=="none"){this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:p,y:g,z:y}=zu(()=>this.getCamera()),{x:v,y:x,z:m=0}=e.delta;let b=h;switch(r.ctrlKey&&(b=h==="pan"?"zoom":"pan"),b){case"zoom":{const{x:S,y:w}=this.inputs.currentScreenPoint;let I=m;h==="zoom"&&(Math.abs(x)>10?I=10*Math.sign(x)/100:I=x/100);const C=y+(I??0)*d*y;this._setCamera(new k(p+(S/C-S)-(S/y-S),g+(w/C-w)-(w/y-w),C),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new k(p+v*u/y,g+x*u/y,y),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(e);const{isPen:u}=e,{isPenMode:d}=a;switch(e.name){case"pointer_down":{if(d&&!u)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===xR&&(this.capturedPointerId=e.pointerId),r.buttons.add(e.button),r.isPointing=!0,r.isDragging=!1,!d&&u&&this.updateInstanceState({isPenMode:!0}),e.button===bR?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===Ku&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&d)return;const{x:h,y:p,z:g}=zu(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:y,previousScreenPoint:v}=this.inputs,{panSpeed:x}=l,m=k.Sub(y,v);this.setCamera(new k(h+m.x*x/g,p+m.y*x/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}r.isPointing&&!r.isDragging&&k.Dist2(s,o)*this.getZoomLevel()>(a.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/g&&(r.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(r.isDragging=!1,r.isPointing=!1,clearTimeout(this._longPressTimeout),r.buttons.delete(e.button),this.getIsMenuOpen()||a.isPenMode&&!u)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),r.isPanning){r.keys.has("Space")||(r.isPanning=!1);const h=this.inputs.pointerVelocity,p=Math.min(2,h.len());switch(e.button){case xR:{this.setCursor({type:"grab",rotation:0});break}case Ku:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:h})}else e.button===bR&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.name){case"key_down":{r.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=a.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{r.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(Ku)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===Ku?e.name="middle_click":e.button===A_&&(e.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(kn);if(e.isPen===u){const d=this._clickManager.handlePointerEvent(e);if(e.name!==d.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(e),this.emit("event",e),this};maybeTrackPerformance(e){Dt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}Pe([oe],be.prototype,"getCanUndo");Pe([oe],be.prototype,"getCanRedo");Pe([oe],be.prototype,"getPath");Pe([oe],be.prototype,"getCurrentTool");Pe([oe],be.prototype,"getCurrentToolId");Pe([oe],be.prototype,"getDocumentSettings");Pe([oe],be.prototype,"getInstanceState");Pe([oe],be.prototype,"getOpenMenus");Pe([oe],be.prototype,"getIsMenuOpen");Pe([oe],be.prototype,"getPageStates");Pe([oe],be.prototype,"_getPageStatesQuery");Pe([oe],be.prototype,"getCurrentPageState");Pe([oe],be.prototype,"_getCurrentPageStateId");Pe([oe],be.prototype,"getSelectedShapeIds");Pe([oe],be.prototype,"getSelectedShapes");Pe([oe],be.prototype,"getOnlySelectedShapeId");Pe([oe],be.prototype,"getOnlySelectedShape");Pe([oe],be.prototype,"getSelectionPageBounds");Pe([oe],be.prototype,"getSelectionRotation");Pe([oe],be.prototype,"getSelectionRotatedPageBounds");Pe([oe],be.prototype,"getSelectionRotatedScreenBounds");Pe([oe],be.prototype,"getFocusedGroupId");Pe([oe],be.prototype,"getFocusedGroup");Pe([oe],be.prototype,"getEditingShapeId");Pe([oe],be.prototype,"getEditingShape");Pe([oe],be.prototype,"getHoveredShapeId");Pe([oe],be.prototype,"getHoveredShape");Pe([oe],be.prototype,"getHintingShapeIds");Pe([oe],be.prototype,"getHintingShape");Pe([oe],be.prototype,"getErasingShapeIds");Pe([oe],be.prototype,"getErasingShapes");Pe([oe],be.prototype,"_unsafe_getCameraId");Pe([oe],be.prototype,"getCamera");Pe([oe],be.prototype,"getViewportPageBoundsForFollowing");Pe([oe],be.prototype,"getCameraForFollowing");Pe([oe],be.prototype,"getZoomLevel");Pe([oe],be.prototype,"getViewportScreenBounds");Pe([oe],be.prototype,"getViewportScreenCenter");Pe([oe],be.prototype,"getViewportPageBounds");Pe([oe],be.prototype,"_getCollaboratorsQuery");Pe([oe],be.prototype,"getCollaborators");Pe([oe],be.prototype,"getCollaboratorsOnCurrentPage");Pe([oe],be.prototype,"getRenderingShapes");Pe([oe],be.prototype,"_getAllPagesQuery");Pe([oe],be.prototype,"getPages");Pe([oe],be.prototype,"getCurrentPageId");Pe([oe],be.prototype,"getCurrentPageShapeIdsSorted");Pe([oe],be.prototype,"_getAllAssetsQuery");Pe([oe],be.prototype,"_getShapeGeometryCache");Pe([oe],be.prototype,"_getShapeHandlesCache");Pe([oe],be.prototype,"_getShapePageTransformCache");Pe([oe],be.prototype,"_getShapePageBoundsCache");Pe([oe],be.prototype,"_getShapeClipPathCache");Pe([oe],be.prototype,"_getShapeMaskCache");Pe([oe],be.prototype,"_getShapeMaskedPageBoundsCache");Pe([oe],be.prototype,"_notVisibleShapes");Pe([oe],be.prototype,"getCulledShapes");Pe([oe],be.prototype,"getCurrentPageBounds");Pe([oe],be.prototype,"getCurrentPageShapes");Pe([oe],be.prototype,"getCurrentPageShapesSorted");Pe([oe],be.prototype,"getCurrentPageRenderingShapesSorted");Pe([oe],be.prototype,"_getBindingsIndexCache");Pe([oe],be.prototype,"_getSelectionSharedStyles");Pe([oe({isEqual:(n,e)=>n.equals(e)})],be.prototype,"getSharedStyles");Pe([oe],be.prototype,"getSharedOpacity");Pe([oe],be.prototype,"getIsFocused");function Xu(n,e=n.getCurrentPageId()){const r=n.getPage(e).name;n.emit("max-shapes",{name:r,pageId:e,count:n.options.maxShapesPerPage})}function si(n,e){if(!e)return n;let r=null;const i=Object.entries(e);for(let s=0,o=i.length;s<o;s++){const[a,c]=i[s];if(c!==void 0&&!(a==="id"||a==="type"||a==="typeName")&&c!==n[a]){if(r||(r={...n}),a==="props"||a==="meta"){r[a]={...n[a]};for(const[l,u]of Object.entries(c))u!==void 0&&(r[a][l]=u);continue}r[a]=c}}return r||n}function n$(n,e,r){const i=n.getShape(e);if(!i)return;r.push(i);const s=n.getSortedChildIdsForParent(e);for(let o=0,a=s.length;o<a;o++)n$(n,s[o],r)}function GR(n,e,r){let i;if(n.run(()=>{const s=n.store.extractingChanges(()=>{const o=new Set,a=new Set;for(const c of e)if(n.getShape(c))for(const u of n.getBindingsInvolvingShape(c)){const d=e.has(u.fromId),h=e.has(u.toId);if(d&&h){o.add(u.id);continue}(!d||!h)&&a.add(u.id)}n.deleteBindings([...a],{isolateShapes:!0});try{i=js.ok(r(o))}catch(c){i=js.err(c)}});n.store.applyDiff(pw(s))},{history:"ignore"}),i.ok)return i.value;throw i.error}function KR(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:r,y:i}}=e.constraints,s=n.getViewportScreenBounds(),o=pe.From(e.constraints.bounds),a=(s.w-r*2)/o.w,c=(s.h-i*2)/o.h;return{zx:a,zy:c}}function uu(){const n=Z(),e=e$();return ne("isDarkMode",()=>e?.isDarkMode??n.user.getIsDarkMode(),[e,n])}const VR="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",WR="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Zu='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function bs(n,e,r,i,s,o=16,a=16){const c=(-r-e)*(Je/180),l=Math.sin(c),u=Math.cos(c),d=1*u-1*l,h=1*l+1*u;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+r} 16 16)${i?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${o} ${a}, pointer`}const bie=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],Sie={none:()=>"none","ew-resize":(n,e,r)=>bs(WR,n,0,e,r),"ns-resize":(n,e,r)=>bs(WR,n,90,e,r),"nesw-resize":(n,e,r)=>bs(VR,n,0,e,r),"nwse-resize":(n,e,r)=>bs(VR,n,90,e,r),"nwse-rotate":(n,e,r)=>bs(Zu,n,0,e,r),"nesw-rotate":(n,e,r)=>bs(Zu,n,90,e,r),"senw-rotate":(n,e,r)=>bs(Zu,n,180,e,r),"swne-rotate":(n,e,r)=>bs(Zu,n,270,e,r)};function tr(n,e=0,r="black"){return Sie[n](Hee(e),!1,r)}function wie(){const n=Z(),e=Jt(),r=uu();Rs("useCursor",()=>{const{type:i,rotation:s}=n.getInstanceState().cursor;if(bie.includes(i)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${i})`);return}e.style.setProperty("--tl-cursor",tr(i,s,r?"white":"black"))},[n,e,r])}function _ie(){const n=Z(),e=Jt(),r=uu(),i=ne(Dt.forceSrgb);nt.useEffect(()=>{r?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),i?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,i,r])}function r$(n){const e=E.useRef();return E.useLayoutEffect(()=>{e.current=n}),E.useDebugValue(n),E.useCallback((...r)=>{const i=e.current;return gt(i,"fn does not exist"),i(...r)},[])}function Cie(){const[n,e]=E.useState(0);E.useEffect(()=>e(r=>r+1),[])}const Pie=n=>n.props.src,Iie={upload:(n,e)=>mo.blobToDataUrl(e)};function Eie(n){return"schema"in n&&n.schema?n.schema:Mee({shapes:"shapeUtils"in n&&n.shapeUtils?YR(Zz(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?YR(Wz(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function El({initialData:n,defaultName:e="",id:r,assets:i=Iie,onMount:s,collaboration:o,...a}={}){const c=Eie(a),l=new S_({id:r,schema:c,initialData:n,props:{defaultName:e,assets:{upload:i.upload,resolve:i.resolve??Pie},onMount:u=>{gt(u instanceof be),s?.(u)},collaboration:o}});if(a.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");L_(l,a.snapshot)}return l}function YR(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const kie=(n,e)=>e.some(r=>n instanceof r);let XR,ZR;function Tie(){return XR||(XR=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Mie(){return ZR||(ZR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const i$=new WeakMap,Iw=new WeakMap,s$=new WeakMap,gS=new WeakMap,q_=new WeakMap;function Aie(n){const e=new Promise((r,i)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{r(Xi(n.result)),s()},a=()=>{i(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(r=>{r instanceof IDBCursor&&i$.set(r,n)}).catch(()=>{}),q_.set(e,n),e}function jie(n){if(Iw.has(n))return;const e=new Promise((r,i)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{r(),s()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Iw.set(n,e)}let Ew={get(n,e,r){if(n instanceof IDBTransaction){if(e==="done")return Iw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||s$.get(n);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Xi(n[e])},set(n,e,r){return n[e]=r,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Rie(n){Ew=n(Ew)}function Oie(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const i=n.call(mS(this),e,...r);return s$.set(i,e.sort?e.sort():[e]),Xi(i)}:Mie().includes(n)?function(...e){return n.apply(mS(this),e),Xi(i$.get(this))}:function(...e){return Xi(n.apply(mS(this),e))}}function Die(n){return typeof n=="function"?Oie(n):(n instanceof IDBTransaction&&jie(n),kie(n,Tie())?new Proxy(n,Ew):n)}function Xi(n){if(n instanceof IDBRequest)return Aie(n);if(gS.has(n))return gS.get(n);const e=Die(n);return e!==n&&(gS.set(n,e),q_.set(e,n)),e}const mS=n=>q_.get(n);function o$(n,e,{blocked:r,upgrade:i,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),c=Xi(a);return i&&a.addEventListener("upgradeneeded",l=>{i(Xi(a.result),l.oldVersion,l.newVersion,Xi(a.transaction),l)}),r&&a.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),c.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}function a$(n,{blocked:e}={}){const r=indexedDB.deleteDatabase(n);return e&&r.addEventListener("blocked",i=>e(i.oldVersion,i)),Xi(r).then(()=>{})}const Nie=["get","getKey","getAll","getAllKeys","count"],Lie=["put","add","delete","clear"],yS=new Map;function QR(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(yS.get(e))return yS.get(e);const r=e.replace(/FromIndex$/,""),i=e!==r,s=Lie.includes(r);if(!(r in(i?IDBIndex:IDBObjectStore).prototype)||!(s||Nie.includes(r)))return;const o=async function(a,...c){const l=this.transaction(a,s?"readwrite":"readonly");let u=l.store;return i&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),s&&l.done]))[0]};return yS.set(e,o),o}Rie(n=>({...n,get:(e,r,i)=>QR(e,r)||n.get(e,r,i),has:(e,r)=>!!QR(e,r)||n.has(e,r)}));const Fie="TLDRAW_DOCUMENT_v2",zie="TLDRAW_ASSET_STORE_v1",c$="TLDRAW_DB_NAME_INDEX_v2",Ve={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function l$(n){const e=Fie+n;return Bie(e),await o$(e,4,{upgrade(r){r.objectStoreNames.contains(Ve.Records)||r.createObjectStore(Ve.Records),r.objectStoreNames.contains(Ve.Schema)||r.createObjectStore(Ve.Schema),r.objectStoreNames.contains(Ve.SessionState)||r.createObjectStore(Ve.SessionState),r.objectStoreNames.contains(Ve.Assets)||r.createObjectStore(Ve.Assets)}})}async function $ie(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):H_(),r=zie+n;if(!e.find(p=>p===r))return;const s=await o$(r,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}}),o=s.transaction(["assets"],"readonly"),a=o.objectStore("assets"),c=await a.getAllKeys(),l=await Promise.all(c.map(async p=>[p,await a.get(p)]));await o.done;const u=await l$(n),d=u.transaction([Ve.Assets],"readwrite"),h=d.objectStore(Ve.Assets);for(const[p,g]of l)h.put(g,p);await d.done,s.close(),u.close(),await a$(r)}class kl{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){kl.connectedInstances.add(this),this.getDbPromise=(async()=>(await $ie(e),await l$(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Sl)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),kl.connectedInstances.delete(this))}tx(e,r,i){const s=(async()=>{gt(!this.isClosed,"db is closed");const a=(await this.getDb()).transaction(r,e),c=a.done.catch(l=>{if(!this.isClosed)throw l});try{return await i(a)}finally{this.isClosed?a.abort():await c}})();return this.pendingTransactionSet.add(s),s.finally(()=>this.pendingTransactionSet.delete(s)),s}async load({sessionId:e}={}){return await this.tx("readonly",[Ve.Records,Ve.Schema,Ve.SessionState],async r=>{const i=r.objectStore(Ve.Records),s=r.objectStore(Ve.Schema),o=r.objectStore(Ve.SessionState);let a=e?(await o.get(e))?.snapshot:null;return a||(a=(await o.getAll()).sort((u,d)=>u.updatedAt-d.updatedAt).pop()?.snapshot),{records:await i.getAll(),schema:await s.get(Ve.Schema),sessionStateSnapshot:a}})}async storeChanges({schema:e,changes:r,sessionId:i,sessionStateSnapshot:s}){await this.tx("readwrite",[Ve.Records,Ve.Schema,Ve.SessionState],async o=>{const a=o.objectStore(Ve.Records),c=o.objectStore(Ve.Schema),l=o.objectStore(Ve.SessionState);for(const[u,d]of Object.entries(r.added))await a.put(d,u);for(const[u,d]of Object.values(r.updated))await a.put(d,d.id);for(const u of Object.keys(r.removed))await a.delete(u);c.put(e.serialize(),Ve.Schema),s&&i?l.put({snapshot:s,updatedAt:Date.now(),id:i},i):(s||i)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:r,sessionId:i,sessionStateSnapshot:s}){await this.tx("readwrite",[Ve.Records,Ve.Schema,Ve.SessionState],async o=>{const a=o.objectStore(Ve.Records),c=o.objectStore(Ve.Schema),l=o.objectStore(Ve.SessionState);await a.clear();for(const[u,d]of Object.entries(r))await a.put(d,u);c.put(e.serialize(),Ve.Schema),s&&i?l.put({snapshot:s,updatedAt:Date.now(),id:i},i):(s||i)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Ve.SessionState],async e=>{const r=e.objectStore(Ve.SessionState),i=(await r.getAll()).sort((o,a)=>o.updatedAt-a.updatedAt);if(i.length<10){await e.done;return}const s=i.slice(0,i.length-10);for(const{id:o}of s)await r.delete(o)})}async getAsset(e){return await this.tx("readonly",[Ve.Assets],async r=>await r.objectStore(Ve.Assets).get(e))}async storeAsset(e,r){await this.tx("readwrite",[Ve.Assets],async i=>{await i.objectStore(Ve.Assets).put(r,e)})}}function H_(){const n=JSON.parse(m_(c$)||"[]")??[];return Array.isArray(n)?n:[]}function Bie(n){const e=new Set(H_());e.add(n),y_(c$,JSON.stringify([...e]))}function Uie(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function qie(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Hie=350,Gie=1e4,JR=Symbol("UPDATE_INSTANCE_STATE"),Kie=n=>n;class Vie{onmessage;constructor(e){}postMessage(e){}close(){}}const Wie=typeof BroadcastChannel>"u"?Vie:BroadcastChannel;class Yie{constructor(e,{persistenceKey:r,sessionId:i=lh,onLoad:s,onLoadError:o},a=new Wie(`tldraw-tab-sync-${r}`)){this.store=e,this.channel=a,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=r,this.sessionId=i,this.db=new kl(r),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=Gz(this.store),this.disposables.add(e.listen(({changes:c})=>{this.diffQueue.push(c),this.channel.postMessage(Kie({type:"diff",storeId:this.store.id,changes:c,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(JR),this.schedulePersist()},{scope:"session"})),this.connect(s,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(c=>c.scope==="document").map(c=>c.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,r){this.debug("connecting");let i;try{i=await this.db.load({sessionId:this.sessionId})}catch(s){r(s),qie();return}if(this.debug("loaded data from store",i,"didDispose",this.didDispose),!this.didDispose)try{if(i){const s=Object.fromEntries(i.records.map(c=>[c.id,c])),o=i.sessionStateSnapshot??mre(s),a=this.store.schema.migrateStoreSnapshot({store:s,schema:i.schema??this.store.schema.serializeEarliestVersion()});if(a.type==="error"){console.error("failed to migrate store",a),r(new Error(`Failed to migrate store: ${a.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(a.value).filter(c=>this.documentTypes.has(c.typeName)),"initialize")}),o&&Kz(this.store,o)}this.channel.onmessage=({data:s})=>{this.debug("got message",s);const o=s,a=this.store.schema.getMigrationsSince(o.schema);if(a.ok){if(a.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){r(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}o.type==="diff"&&(this.debug("applying diff"),mi(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;r(s);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?Gie:Hie))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(gt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const r=b_(e.filter(i=>i!==JR));await this.db.storeChanges({changes:r,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(r){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",r),Uie(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function u$(n){const e=E.useRef(n),[r,i]=E.useState(n);r!==e.current&&i(e.current);const s=E.useCallback(o=>{typeof o=="function"?e.current=o(e.current):e.current=o,i(e.current)},[]);return[r,s]}function Xie(n){const[e,r]=u$({status:"loading"});return n=wf(n),E.useEffect(()=>{const{persistenceKey:i,sessionId:s,...o}=n;if(!i){r({status:"not-synced",store:El(o)});return}r({status:"loading"});const a=new es,c={upload:async(h,p)=>(await d.db.storeAsset(h.id,p),h.id),resolve:async h=>h.props.src?h.props.src.startsWith("asset:")?await a.get(h,async()=>{const p=await d.db.getAsset(h.id);return p?URL.createObjectURL(p):null}):h.props.src:null,...o.assets},l=El({...o,assets:c});let u=!1;const d=new Yie(l,{sessionId:s,persistenceKey:i,onLoad(){u||r({store:l,status:"synced-local"})},onLoadError(h){u||r({status:"error",error:h})}});return()=>{u=!0,d.close()}},[n,r]),e}function Zie(){const n=Z(),e=Jt();E.useEffect(()=>{const r=o=>e.style.setProperty("--tl-zoom",o.toString()),i=WL(r,100),s=new Va("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?r(n.getZoomLevel()):i(n.getZoomLevel())});return s.attach(),s.execute(),()=>{s.detach(),i.cancel()}},[n,e])}function kw(n){const e=new ArrayBuffer(n.length),r=new Uint8Array(e);for(let i=0,s=n.length;i<s;i++)r[i]=n.charCodeAt(i);return e}function Qie(n){const e=atob(n),r=kw(e);return crypto.subtle.importKey("spki",new Uint8Array(r),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const Jie=5,Td={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},ese=Math.max(...Object.values(Td)),Uc={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},tse=Object.keys(Uc).length,Qu="sales@tldraw.com";class d${publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=Vt("license state","pending");constructor(e,r,i){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(i),this.publicKey=r||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,x_.enableLicensing.get()?this.getLicenseFromKey(e).then(s=>{const o=nse(s);this.state.set(o?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[r,i]=e.split("."),[s,o]=r.split("/");if(!s.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${s}'`);const a=await Qie(this.publicKey);let c;try{c=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},a,new Uint8Array(kw(atob(i))),new Uint8Array(kw(atob(o))))}catch(u){throw console.error(u),new Error("Could not perform signature validation")}if(!c)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(o))}catch{throw new Error("Could not parse object")}return l.length>tse&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[Uc.ID],hosts:l[Uc.HOSTS],flags:l[Uc.FLAGS],expiryDate:l[Uc.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let r=e.replace(/[\u200B-\u200D\uFEFF]/g,"");r=r.replace(/\r?\n|\r/g,"");try{const i=await this.extractLicenseKey(r),s=new Date(i.expiryDate),o=this.isFlagEnabled(i.flags,Td.ANNUAL_LICENSE),a=this.isFlagEnabled(i.flags,Td.PERPETUAL_LICENSE),c={license:i,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(i),expiryDate:s,isAnnualLicense:o,isAnnualLicenseExpired:o&&this.isAnnualLicenseExpired(s),isPerpetualLicense:a,isPerpetualLicenseExpired:a&&this.isPerpetualLicenseExpired(s),isInternalLicense:this.isFlagEnabled(i.flags,Td.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(c),c}catch(i){return this.outputInvalidLicenseKey(i.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const r=window.location.hostname.toLowerCase();return e.hosts.some(i=>{const s=i.toLowerCase().trim();return s===r||`www.${s}`===r||s===`www.${r}`||i==="*"?!0:i.includes("*")?new RegExp(i.replace(/\*/g,".*?")).test(r):!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+Jie+1)}isAnnualLicenseExpired(e){const r=this.getExpirationDateWithGracePeriod(e),i=new Date>=r;return!i&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${Qu} if you would like to renew your license.`]),i}isPerpetualLicenseExpired(e){const r=this.getExpirationDateWithGracePeriod(e),i={major:new Date(pR.major),minor:new Date(pR.minor)};return i.major>=r||i.minor>=r}isFlagEnabled(e,r){return(e&r)===r}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${Qu} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${Qu} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${Qu} if you would like to use tldraw on other domains.`]),e.license.flags>=ese*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){this.outputDelimiter();for(const r of e)console.log(`%c${r}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}function nse(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const h$=E.createContext({}),rse=()=>E.useContext(h$);function ise({licenseKey:n,children:e}){const[r]=E.useState(()=>new d$(n));return f.jsx(h$.Provider,{value:r,children:e})}const sse='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',ose=`${ks()}/watermarks/watermark-desktop.svg`,Ju=`data:image/svg+xml;utf8,${encodeURIComponent(sse)}`;let vS=null;async function ase(n){return n?Ju:(vS||(vS=Promise.race([(async()=>{try{const e=await bi(ose);if(!e.ok)return Ju;const r=await e.blob();return URL.createObjectURL(r)}catch{return Ju}})(),new Promise(e=>{setTimeout(()=>{e(Ju)},3e3)})])),vS)}const cse=nt.memo(function({forceLocal:e=!1}){const r=lz(),i=Z(),s=rse(),o=ne("show watermark",()=>x_.enableLicensing.get()&&i.getViewportScreenBounds().width>760&&s.state.get()==="unlicensed",[i,s]),a=ne("debug mode",()=>i.getInstanceState().isDebugMode,[i]),c=ne("is menu open",()=>i.getIsMenuOpen(),[i]),[l,u]=E.useState(null),d=e||s.isDevelopment;if(E.useEffect(()=>{if(!o)return;let g=!1;return(async()=>{const y=await ase(d);g||u(y)})(),()=>{g=!0}},[d,o]),!o||!l)return null;const h=d$.className,p=`url('${l}') center 100% / 100% no-repeat`;return f.jsxs(f.Fragment,{children:[f.jsx("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${h} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${c?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${h}[data-debug='true'] {
	bottom: 46px;
}

.${h} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${h}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${h}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),f.jsx("div",{className:h,"data-debug":a,draggable:!1,...r,children:f.jsx("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:Xt,style:{mask:p,WebkitMask:p}})})]})}),lse=[],use=[],dse=[],hse="tl-container",fse=E.memo(function({store:e,components:r,className:i,user:s,...o}){const[a,c]=nt.useState(null),l=E.useMemo(()=>s??Uz(),[s]),u=r?.ErrorFallback===void 0?jz:r?.ErrorFallback,d={...o,shapeUtils:o.shapeUtils??lse,bindingUtils:o.bindingUtils??use,tools:o.tools??dse,components:r};return f.jsx("div",{ref:c,"data-tldraw":iz,draggable:!1,className:Me(`${hse} tl-theme__light`,i),onPointerDown:Xt,tabIndex:-1,children:f.jsx(Il,{fallback:u,onError:h=>p_(h,{tags:{origin:"react.tldraw-before-app"}}),children:a&&f.jsx(ise,{licenseKey:o.licenseKey,children:f.jsx(Xee,{container:a,children:f.jsx(ere,{overrides:r,children:e?e instanceof S_?f.jsx(p$,{...d,store:e,user:l}):f.jsx(f$,{...d,store:e,user:l}):f.jsx(pse,{...d,store:e,user:l})})})})})})});function pse(n){const{defaultName:e,snapshot:r,initialData:i,shapeUtils:s,bindingUtils:o,persistenceKey:a,sessionId:c,user:l,assets:u}=n,d=Xie({shapeUtils:s,bindingUtils:o,initialData:i,persistenceKey:a,sessionId:c,defaultName:e,snapshot:r,assets:u});return f.jsx(f$,{...n,store:d,user:l})}const f$=E.memo(function({store:e,user:r,...i}){const s=Jt();E.useLayoutEffect(()=>{r.userPreferences.get().colorScheme==="dark"&&(s.classList.remove("tl-theme__light"),s.classList.add("tl-theme__dark"))},[s,r]);const{LoadingScreen:o}=Ct();switch(e.status){case"error":throw e.error;case"loading":return o?f.jsx(o,{}):null}return f.jsx(p$,{...i,store:e.store,user:r})}),xS=()=>document.location.search.includes("tldraw_preserve_focus");function p$({onMount:n,children:e,store:r,tools:i,shapeUtils:s,bindingUtils:o,user:a,initialState:c,autoFocus:l=!0,inferDarkMode:u,cameraOptions:d,options:h,licenseKey:p}){const{ErrorFallback:g}=Ct(),y=Jt(),[v,x]=u$(null),m=E.useRef({autoFocus:l&&!xS(),inferDarkMode:u,initialState:c,cameraOptions:d});E.useLayoutEffect(()=>{m.current={autoFocus:l&&!xS(),inferDarkMode:u,initialState:c,cameraOptions:d}},[l,u,c,d]),E.useLayoutEffect(()=>{const{autoFocus:w,inferDarkMode:I,initialState:C,cameraOptions:_}=m.current,P=new be({store:r,shapeUtils:s,bindingUtils:o,tools:i,getContainer:()=>y,user:a,initialState:C,autoFocus:w,inferDarkMode:I,cameraOptions:_,options:h,licenseKey:p});return x(P),()=>{P.dispose()}},[o,y,h,s,r,i,a,x,p]),E.useLayoutEffect(()=>{v&&d&&v.setCameraOptions(d)},[v,d]);const b=E.useSyncExternalStore(E.useCallback(w=>v?(v.on("crash",w),()=>v.off("crash",w)):()=>{},[v]),()=>v?.getCrashingError()??null);E.useEffect(function(){if(!v)return;function I(){v&&v.focus()}function C(){v&&v.blur()}if(l&&xS())return v.getContainer().addEventListener("pointerdown",I),document.body.addEventListener("pointerdown",C),()=>{v.getContainer()?.removeEventListener("pointerdown",I),document.body.removeEventListener("pointerdown",C)}},[v,l]);const{Canvas:S}=Ct();return v?f.jsx(Il,{fallback:g,onError:w=>v.annotateError(w,{origin:"react.tldraw",willCrashApp:!0}),children:b?f.jsx(mse,{crashingError:b}):f.jsx(bf.Provider,{value:v,children:f.jsxs(gse,{onMount:n,children:[e??(S?f.jsx(S,{}):null),f.jsx(cse,{})]})})}):null}function gse({children:n,onMount:e}){return Zie(),wie(),_ie(),Cie(),m$(r=>{const i=r.store.props.onMount(r),s=e?.(r);return()=>{i?.(),s?.()}}),n}function mse({crashingError:n}){throw n}function G_({children:n}){return f.jsx("div",{className:"tl-loading",children:n})}function g$({children:n}){return f.jsx("div",{className:"tl-loading",children:n})}function m$(n){const e=Z(),r=r$(i=>{let s;return i.run(()=>{s=n?.(i),i.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,s});nt.useLayoutEffect(()=>{if(e)return r?.(e)},[e,r])}function To({children:n,className:e="",...r}){return f.jsx("div",{...r,className:Me("tl-html-container",e),children:n})}class yse{constructor(e){this.editor=e}static props;static migrations;static type}function K_(n,e,r={}){const{newPoint:i,handle:s,scaleX:o,scaleY:a}=e,{minWidth:c=1,maxWidth:l=1/0,minHeight:u=1,maxHeight:d=1/0}=r;let h=n.props.w*o,p=n.props.h*a;const g=new k(0,0);if(h>0){if(h<c){switch(s){case"top_left":case"left":case"bottom_left":{g.x=h-c;break}case"top":case"bottom":{g.x=(h-c)/2;break}default:g.x=0}h=c}}else if(g.x=h,h=-h,h<c){switch(s){case"top_left":case"left":case"bottom_left":{g.x=-h;break}default:g.x=-c}h=c}if(p>0){if(p<u){switch(s){case"top_left":case"top":case"top_right":{g.y=p-u;break}case"right":case"left":{g.y=(p-u)/2;break}default:g.y=0}p=u}}else if(g.y=p,p=-p,p<u){switch(s){case"top_left":case"top":case"top_right":{g.y=-p;break}default:g.y=-u}p=u}const{x:y,y:v}=g.rot(n.rotation).add(i);return{...n,x:y,y:v,props:{w:Math.min(l,h),h:Math.min(d,p)}}}class Xa extends Gs{getGeometry(e){return new ns({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,r)=>K_(e,r);getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,r,i){return{...r.props,w:$n(e.props.w,r.props.w,i),h:$n(e.props.h,r.props.h,i)}}}let vse=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}},xse=class extends Ee{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,i=this.parent.shapeType,s=it();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:i,x:r.x,y:r.y,props:{w:1,h:1}}]).select(s),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const r=this.parent.shapeType,i=it();this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:e.x,y:e.y}]);const s=this.editor.getShape(i);if(!s){this.cancel();return}let{w:o,h:a}=s.props;const c=new k(o/2,a/2),l=this.editor.getShapeParentTransform(s);l&&c.rot(-l.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),o*=u,a*=u,c.mul(u));const d=ft(s);d.x=s.x-c.x,d.y=s.y-c.y,d.props.w=o,d.props.h=a,"scale"in s.props&&(d.props.scale=u),this.editor.updateShape(d),this.editor.setSelectedShapes([i]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};class bse extends Ee{static id="box";static initial="idle";static children=()=>[vse,xse];onCreate}function Ef(n){const e=Z();return ne("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function ai(n){const e=Z();return E.useMemo(function(){const s=u=>{if(u.isKilled)return;if(u.button===A_){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Gn(u)});return}if(u.button!==0)return;const d=ah(u.currentTarget);function h(){d.removeEventListener("pointerup",h),su(d,u)}iu(d,u),d.addEventListener("pointerup",h),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Gn(u)}),Xt(u)};let o,a;function c(u){u.isKilled||u.button===0&&(u.clientX===o&&u.clientY===a||(o=u.clientX,a=u.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Gn(u)})))}return{onPointerDown:s,onPointerMove:c,onPointerUp:u=>{u.isKilled||u.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Gn(u)})}}},[e,n])}function Sse(n){const[e,r]=E.useState(()=>({store:El(n),opts:n}));if(!eF(e.opts,n)){const i={store:El(n),opts:n};return r(i),i.store}return e.store}const wse=20,_se=8;function V_(n,e=wse){return Math.max(_se,Math.ceil(n/e))}class da extends Hs{_center;radius;start;end;largeArcFlag;sweepFlag;measure;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});const{center:r,sweepFlag:i,largeArcFlag:s,start:o,end:a}=e;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=k.Angle(r,o),this.angleEnd=k.Angle(r,a),this.radius=k.Dist(r,o),this.measure=Gee(this.angleStart,this.angleEnd,i,s),this.start=o,this.end=a,this.sweepFlag=i,this.largeArcFlag=s,this._center=r}nearestPoint(e){const{_center:r,measure:i,radius:s,angleEnd:o,angleStart:a,start:c,end:l}=this,u=bw(i,a,o,r.angle(e));if(u<=0)return c;if(u>=1)return l;const d=r.clone().add(e.clone().sub(r).uni().mul(s));let h,p=1/0,g;for(const y of[c,l,d])g=k.Dist2(e,y),g<p&&(h=y,p=g);if(!h)throw Error("nearest point not found");return h}hitTestLineSegment(e,r){const{_center:i,radius:s,measure:o,angleStart:a,angleEnd:c}=this,l=cu(e,r,i,s);return l===null?!1:l.some(u=>{const d=bw(o,a,c,i.angle(u));return d>=0&&d<=1})}getVertices(){const{_center:e,measure:r,length:i,radius:s,angleStart:o}=this,a=[];for(let c=0,l=V_(Math.abs(i));c<l+1;c++){const u=c/l*r,d=o+u;a.push(ko(e,s,d))}return a}getSvgPathData(e=!0){const{start:r,end:i,radius:s,largeArcFlag:o,sweepFlag:a}=this;return`${e?`M${r.toFixed()}`:""} A${s} ${s} 0 ${o} ${a} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class W_ extends Hs{constructor(e){super({isClosed:!0,...e}),this.config=e;const{x:r=0,y:i=0,radius:s}=e;this.x=r,this.y=i,this._center=new k(s+r,s+i),this.radius=s}_center;radius;x;y;getBounds(){return new pe(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:e,radius:r}=this,i=rt*r,s=[];for(let o=0,a=V_(i);o<a;o++){const c=o/a*rt;s.push(ko(e,r,c))}return s}nearestPoint(e){const{_center:r,radius:i}=this;return r.equals(e)?k.AddXY(r,i,0):r.clone().add(e.clone().sub(r).uni().mul(i))}hitTestLineSegment(e,r,i=0){const{_center:s,radius:o}=this;return cu(e,r,s,o+i)!==null}getSvgPathData(){const{_center:e,radius:r}=this;return`M${e.x+r},${e.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class vn extends Ya{a;b;c;d;constructor(e){const{start:r,cp1:i,cp2:s,end:o}=e;super({...e,points:[r,o]}),this.a=r,this.b=i,this.c=s,this.d=o}getVertices(){const e=[],{a:r,b:i,c:s,d:o}=this;for(let a=0,c=10;a<=c;a++){const l=a/c;e.push(new k((1-l)*(1-l)*(1-l)*r.x+3*((1-l)*(1-l))*l*i.x+3*(1-l)*(l*l)*s.x+l*l*l*o.x,(1-l)*(1-l)*(1-l)*r.y+3*((1-l)*(1-l))*l*i.y+3*(1-l)*(l*l)*s.y+l*l*l*o.y))}return e}midPoint(){return vn.GetAtT(this,.5)}nearestPoint(e){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(e),s=k.Dist2(o,e),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(e=!0){const{a:r,b:i,c:s,d:o}=this;return`${e?`M ${r.toFixed()} `:""} C${i.toFixed()} ${s.toFixed()} ${o.toFixed()}`}static GetAtT(e,r){const{a:i,b:s,c:o,d:a}=e;return new k((1-r)*(1-r)*(1-r)*i.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*o.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*i.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*o.y+r*r*r*a.y)}getLength(e=32){let r,i=this.a,s=0;for(let o=1;o<=e;o++)r=vn.GetAtT(this,o/e),s+=k.Dist(i,r),i=r;return s}}class Cse extends Hs{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{points:r}=e;this.points=r}_segments;get segments(){if(!this._segments){this._segments=[];const{points:e}=this,r=e.length,i=r-2,s=1.25;for(let o=0;o<r-1;o++){const a=o===0?e[0]:e[o-1],c=e[o],l=e[o+1],u=o===i?l:e[o+2],d=c,h=o===0?a:new k(c.x+(l.x-a.x)/6*s,c.y+(l.y-a.y)/6*s),p=o===i?l:new k(l.x-(u.x-c.x)/6*s,l.y-(u.y-c.y)/6*s),g=l;this._segments.push(new vn({start:d,cp1:h,cp2:p,end:g}))}}return this._segments}getLength(){return this.segments.reduce((e,r)=>e+r.length,0)}getVertices(){const e=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(e),s=k.Dist2(o,e),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,r){return this.segments.some(i=>i.hitTestLineSegment(e,r))}getSvgPathData(){let e=this.segments.reduce((r,i,s)=>r+i.getSvgPathData(s===0),"");return this.isClosed&&(e+="Z"),e}}class Pse extends Hs{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:r,height:i}=e;this.w=r,this.h=i}w;h;_edges;get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let r=0,i=e.length;r<i;r++){const s=e[r],o=e[(r+1)%i];this._edges.push(new Ki({start:s,end:o}))}}return this._edges}getVertices(){const e=Math.max(1,this.w),r=Math.max(1,this.h),i=e/2,s=r/2,o=Math.pow(i-s,2)/Math.pow(i+s,2),a=Je*(i+s)*(1+3*o/(10+Math.sqrt(4-3*o))),c=V_(a),l=rt/c,u=Math.cos(l),d=Math.sin(l);let h=0,p=1,g=0,y=1;const v=Array(c);for(let x=0;x<c;x++)v[x]=new k(i+i*p,s+s*h),g=d*p+u*h,y=u*p-d*h,h=g,p=y;return v}nearestPoint(e){let r,i=1/0,s,o;for(const a of this.edges)o=a.nearestPoint(e),s=k.Dist2(o,e),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,r){return this.edges.some(i=>i.hitTestLineSegment(e,r))}getBounds(){return new pe(0,0,this.w,this.h)}getLength(){const{w:e,h:r}=this,i=e/2,s=r/2,o=Math.max(0,i),a=Math.max(0,s);return oz(o,a)}getSvgPathData(e=!1){const{w:r,h:i}=this,s=r/2,o=i/2,a=Math.max(0,s),c=Math.max(0,o);return`${e?`M${s-a},${o}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class Ise extends Hs{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:r,height:i}=e;if(this.w=r,this.h=i,i>r){const s=r/2;this.a=new da({start:new k(0,s),end:new k(r,s),center:new k(r/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new Ki({start:new k(r,s),end:new k(r,i-s)}),this.c=new da({start:new k(r,i-s),end:new k(0,i-s),center:new k(r/2,i-s),sweepFlag:1,largeArcFlag:1}),this.d=new Ki({start:new k(0,i-s),end:new k(0,s)})}else{const s=i/2;this.a=new da({start:new k(s,i),end:new k(s,0),center:new k(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new Ki({start:new k(s,0),end:new k(r-s,0)}),this.c=new da({start:new k(r-s,0),end:new k(r-s,i),center:new k(r-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new Ki({start:new k(r-s,i),end:new k(s,i)})}}w;h;a;b;c;d;nearestPoint(e){let r,i=1/0,s,o;const{a,b:c,c:l,d:u}=this;for(const d of[a,c,l,u])o=d.nearestPoint(e),s=k.Dist2(o,e),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,r){const{a:i,b:s,c:o,d:a}=this;return[i,s,o,a].some(c=>c.hitTestLineSegment(e,r))}getVertices(){const{a:e,b:r,c:i,d:s}=this;return[e,r,i,s].reduce((o,a)=>(o.push(...a.vertices),o),[])}getBounds(){return new pe(0,0,this.w,this.h)}getLength(){const{h:e,w:r}=this;return e>r?(Je*(r/2)+(e-r))*2:(Je*(e/2)+(r-e))*2}getSvgPathData(){const{a:e,b:r,c:i,d:s}=this;return[e,r,i,s].map((o,a)=>o.getSvgPathData(a===0)).join(" ")+" Z"}}async function Ese({shouldReload:n=!0}={}){JQ();for(const e of kl.connectedInstances)await e.close();await Promise.all(H_().map(e=>a$(e))),QQ(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=Ese);function kse(n,e="_blank"){D_.openWindow(n,e)}function Tse({children:n}){const e=Z();return ne("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const i=e.getOnlySelectedShape();return i&&e.isShapeOfType(i,"note")}return!1},[e])?f.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:Mse}=Math,Sa=Mse+1e-4;function y$(n,e={}){const{size:r=16,smoothing:i=.5}=e;if(n.length===0||r<=0)return{left:[],right:[]};const s=n[0],o=n[n.length-1],a=o.runningLength,c=Math.pow(r*i,2),l=[],u=[];let d=n[0].vector,h=n[0].point,p=h,g=h,y=p,v=!1,x;for(let m=0;m<n.length;m++){x=n[m];const{point:b,vector:S}=n[m],w=x.vector.dpr(d),I=(m<n.length-1?n[m+1]:n[m]).vector,C=m<n.length-1?I.dpr(x.vector):1,_=w<0&&!v,P=C!==null&&C<.2;if(_||P){if(C>-.62&&a-x.runningLength>x.radius){const T=d.clone().mul(x.radius);d.clone().cpr(I)<0?(g=k.Add(b,T),y=k.Sub(b,T)):(g=k.Sub(b,T),y=k.Add(b,T)),l.push(g),u.push(y)}else{const T=d.clone().mul(x.radius).per(),A=k.Sub(x.input,T);for(let R=1/13,O=0;O<1;O+=R)g=k.RotWith(A,x.input,Sa*O),l.push(g),y=k.RotWith(A,x.input,Sa+Sa*-O),u.push(y)}h=g,p=y,P&&(v=!0);continue}if(v=!1,x===s||x===o){const T=k.Per(S).mul(x.radius);l.push(k.Sub(b,T)),u.push(k.Add(b,T));continue}const M=k.Lrp(I,S,C).per().mul(x.radius);g=k.Sub(b,M),(m<=1||k.Dist2(h,g)>c)&&(l.push(g),h=g),y=k.Add(b,M),(m<=1||k.Dist2(p,y)>c)&&(u.push(y),p=y),d=S}return{left:l,right:u}}function Y_(n,e={}){const{size:r=16,start:i={},end:s={},last:o=!1}=e,{cap:a=!0}=i,{cap:c=!0}=s;if(n.length===0||r<=0)return[];const l=n[0],u=n[n.length-1],d=u.runningLength,h=i.taper===!1?0:i.taper===!0?Math.max(r,d):i.taper,p=s.taper===!1?0:s.taper===!0?Math.max(r,d):s.taper,{left:g,right:y}=y$(n,e),v=l.point,x=n.length>1?n[n.length-1].point:k.AddXY(l.point,1,1);if(n.length===1&&(!(h||p)||o)){const w=k.Add(v,k.Sub(v,x).uni().per().mul(-l.radius)),I=[];for(let C=1/13,_=C;_<=1;_+=C)I.push(k.RotWith(w,v,Sa*2*_));return I}const m=[];if(!(h||p&&n.length===1))if(a)for(let w=1/8,I=w;I<=1;I+=w){const C=k.RotWith(y[0],v,Sa*I);m.push(C)}else{const w=k.Sub(g[0],y[0]),I=k.Mul(w,.5),C=k.Mul(w,.51);m.push(k.Sub(v,I),k.Sub(v,C),k.Add(v,C),k.Add(v,I))}const b=[],S=u.vector.clone().per().neg();if(p||h&&n.length===1)b.push(x);else if(c){const w=k.Add(x,k.Mul(S,u.radius));for(let I=1/29,C=I;C<1;C+=I)b.push(k.RotWith(w,x,Sa*3*C))}else b.push(k.Add(x,k.Mul(S,u.radius)),k.Add(x,k.Mul(S,u.radius*.99)),k.Sub(x,k.Mul(S,u.radius*.99)),k.Sub(x,k.Mul(S,u.radius)));return g.concat(b,y.reverse(),m)}const Ase=.025,jse=.01;function _i(n,e={}){const{streamline:r=.5,size:i=16,simulatePressure:s=!1}=e;if(n.length===0)return[];const o=.15+(1-r)*.85;let a=n.map(k.From),c=0;if(!s){let x=a[0];for(;x&&!(x.z>=Ase);)a.shift(),x=a[0]}if(!s){let x=a[a.length-1];for(;x&&!(x.z>=jse);)a.pop(),x=a[a.length-1]}if(a.length===0)return[{point:k.From(n[0]),input:k.From(n[0]),pressure:s?.5:.15,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let l=a[1];for(;l&&!(k.Dist2(l,a[0])>(i/3)**2);)a[0].z=Math.max(a[0].z,l.z),a.splice(1,1),l=a[1];const u=a.pop();for(l=a[a.length-1];l&&!(k.Dist2(l,u)>(i/3)**2);)a.pop(),l=a[a.length-1],c++;a.push(u);const d=e.last||!e.simulatePressure||a.length>1&&k.Dist2(a[a.length-1],a[a.length-2])<i**2||c>0;if(a.length===2&&e.simulatePressure){const x=a[1];a=a.slice(0,-1);for(let m=1;m<5;m++){const b=k.Lrp(a[0],x,m/4);b.z=(a[0].z+(x.z-a[0].z))*m/4,a.push(b)}}const h=[{point:a[0],input:a[0],pressure:s?.5:a[0].z,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let p=0,g=h[0],y,v;d&&r>0&&a.push(a[a.length-1].clone());for(let x=1,m=a.length;x<m;x++)y=!o||e.last&&x===m-1?a[x].clone():a[x].clone().lrp(g.point,1-o),!g.point.equals(y)&&(v=k.Dist(y,g.point),p+=v,!(x<4&&p<i)&&(g={input:a[x],point:y,pressure:s?.5:a[x].z,vector:k.Sub(g.point,y).uni(),distance:v,runningLength:p,radius:1},h.push(g)));if(h[1]?.vector&&(h[0].vector=h[1].vector.clone()),p<1){const x=Math.max(.5,...h.map(m=>m.pressure));h.forEach(m=>m.pressure=x)}return h}const{min:Ss}=Math,bS=.275;function kf(n,e){const{size:r=16,thinning:i=.5,simulatePressure:s=!0,easing:o=x=>x,start:a={},end:c={}}=e,{easing:l=Wt.easeOutQuad}=a,{easing:u=Wt.easeOutCubic}=c,d=n[n.length-1].runningLength;let h,p=n[0].pressure,g;if(!s&&d<r){const x=n.reduce((m,b)=>Math.max(m,b.pressure),.5);return n.forEach(m=>{m.pressure=x,m.radius=r*o(.5-i*(.5-m.pressure))}),n}else{let x;for(let m=0,b=n.length;m<b&&(g=n[m],!(g.runningLength>r*5));m++){const S=Ss(1,g.distance/r);if(s){const w=Ss(1,1-S);x=Ss(1,p+(w-p)*(S*bS))}else x=Ss(1,p+(g.pressure-p)*.5);p=p+(x-p)*.5}for(let m=0;m<n.length;m++){if(g=n[m],i){let{pressure:b}=g;const S=Ss(1,g.distance/r);if(s){const w=Ss(1,1-S);b=Ss(1,p+(w-p)*(S*bS))}else b=Ss(1,p+(b-p)*(S*bS));g.radius=r*o(.5-i*(.5-b)),p=b}else g.radius=r/2;h===void 0&&(h=g.radius)}}const y=a.taper===!1?0:a.taper===!0?Math.max(r,d):a.taper,v=c.taper===!1?0:c.taper===!0?Math.max(r,d):c.taper;if(y||v)for(let x=0;x<n.length;x++){g=n[x];const{runningLength:m}=g,b=m<y?l(m/y):1,S=d-m<v?u((d-m)/v):1;g.radius=Math.max(.01,g.radius*Math.min(b,S))}return n}function Rse(n,e={}){return Y_(kf(_i(n,e),e),e)}function eO({scribble:n,zoom:e,color:r,opacity:i,className:s}){if(!n.points.length)return null;const o=Rse(n.points,{size:n.size/e,start:{taper:n.taper,easing:Wt.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let a;if(o.length<4){const c=n.size/e/2,{x:l,y:u}=n.points[n.points.length-1];a=`M ${l-c},${u} a ${c},${c} 0 1,0 ${c*2},0 a ${c},${c} 0 1,0 ${-c*2},0`}else a=R_(o);return f.jsx("svg",{className:s&&Me("tl-overlays__item",s),children:f.jsx("path",{className:"tl-scribble",d:a,fill:r??`var(--color-${n.color})`,opacity:i??n.opacity})})}const Ose=({bounds:n,rotation:e})=>{const r=Z();return ne("should display",()=>r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[r])?f.jsx(Ez,{bounds:n,rotation:e}):null};function hs(){const n=Z();return ne("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function Dse({size:n,width:e,height:r,hideAlternateHandles:i}){const s=W(n/3),o=s/2;return f.jsxs("svg",{className:"tl-overlays__item",children:[f.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${W(0-o)},${W(n)} 
						${W(0-o)},${W(0-o)} 
						${W(n)},${W(0-o)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),f.jsx("line",{className:Me("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:W(e/2-n),y1:W(0-o),x2:W(e/2+n),y2:W(0-o),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),f.jsx("polyline",{className:Me("tl-corner-crop-handle",{"tl-hidden":i}),points:`
						${W(e-n)},${W(0-o)} 
						${W(e+o)},${W(0-o)} 
						${W(e+o)},${W(n)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),f.jsx("line",{className:Me("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:W(e+o),y1:W(r/2-n),x2:W(e+o),y2:W(r/2+n),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),f.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${W(e+o)},${W(r-n)} 
						${W(e+o)},${W(r+o)}
						${W(e-n)},${W(r+o)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),f.jsx("line",{className:Me("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:W(e/2-n),y1:W(r+o),x2:W(e/2+n),y2:W(r+o),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),f.jsx("polyline",{className:Me("tl-corner-crop-handle",{"tl-hidden":i}),points:`
						${W(0+n)},${W(r+o)} 
						${W(0-o)},${W(r+o)}
						${W(0-o)},${W(r-n)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),f.jsx("line",{className:Me("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:W(0-o),y1:W(r/2-n),x2:W(0-o),y2:W(r/2+n),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Nse=Qt(function({bounds:e,rotation:r}){const i=Z(),s=E.useRef(null),o=hs(),a=ai("top"),c=ai("right"),l=ai("bottom"),u=ai("left"),d=ai("top_left"),h=ai("top_right"),p=ai("bottom_right"),g=ai("bottom_left"),y=!i.getIsMenuOpen()&&i.getInstanceState().cursor.type==="default",v=i.getInstanceState().isCoarsePointer,x=i.getOnlySelectedShape(),m=x&&i.isShapeOrAncestorLocked(x),b=x?i.getShapeUtil(x).expandSelectionOutlinePx(x):0;if(Wa(s,e?.x,e?.y,1,i.getSelectionRotation(),{x:-b,y:-b}),!e)return null;e=e.clone().expandBy(b).zeroFix();const S=i.getZoomLevel(),w=i.getInstanceState().isChangingStyle,I=e.width,C=e.height,_=8/S,P=I<_*2,M=C<_*2,T=I<_*4,A=C<_*4,R=I<_*5,O=C<_*5,j=v?1.75:1,D=6/S*j,N=(T?D/2:D)*(j*.75),F=(A?D/2:D)*(j*.75),z=(x?!i.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!w;let $=z&&i.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||z&&i.isIn("select.resizing")&&x&&i.isShapeOfType(x,"text");x&&$&&i.environment.isFirefox&&i.isShapeOfType(x,"embed")&&($=!1);const G=i.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!w&&!o,X=i.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!o,ee=!v&&!(P||M)&&(X||G)&&(x?!i.getShapeUtil(x).hideRotateHandle(x):!0)&&!m,re=v&&(!T||!A)&&(X||G)&&(x?!i.getShapeUtil(x).hideRotateHandle(x):!0)&&!m,B=X&&(x?i.getShapeUtil(x).canResize(x)&&!i.getShapeUtil(x).hideResizeHandles(x):!0)&&!G&&!m,U=P||M,Q=P&&M,K=R||O,Y=B||G,V=!ee,ie=!X||!re,ae=!X||!Y,ye=!X||!Y||U,he=!X||!Y||U,xe=!X||!Y||Q&&!G;let fe=!0,me=!0;if(G)fe=K,me=K;else if(B){fe=U||Q||v;const lt=v&&x&&x.type==="text";me=fe&&!lt}const we=Math.min(24/S,C-F*3),st=X&&v&&x&&i.isShapeOfType(x,"text")&&we*S>=4;return f.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:f.jsxs("g",{ref:s,children:[$&&f.jsx("rect",{className:"tl-selection__fg__outline",width:W(I),height:W(C)}),f.jsx(ed,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:D,corner:"top_left_rotate",cursor:y?tr("nwse-rotate",r):void 0,isHidden:V}),f.jsx(ed,{"data-testid":"selection.rotate.top-right",cx:I+D*3,cy:0,targetSize:D,corner:"top_right_rotate",cursor:y?tr("nesw-rotate",r):void 0,isHidden:V}),f.jsx(ed,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+D*3,targetSize:D,corner:"bottom_left_rotate",cursor:y?tr("swne-rotate",r):void 0,isHidden:V}),f.jsx(ed,{"data-testid":"selection.rotate.bottom-right",cx:I+D*3,cy:C+D*3,targetSize:D,corner:"bottom_right_rotate",cursor:y?tr("senw-rotate",r):void 0,isHidden:V}),f.jsx(Fse,{"data-testid":"selection.rotate.mobile",cx:T?-D*1.5:I/2,cy:T?C/2:-D*1.5,size:_,isHidden:ie}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":fe}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:W(0-(A?F*2:F)),width:W(I),height:W(Math.max(1,F*2)),style:y?{cursor:tr("ns-resize",r)}:void 0,...a}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":me}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:W(I-(T?0:N)),y:0,height:W(C),width:W(Math.max(1,N*2)),style:y?{cursor:tr("ew-resize",r)}:void 0,...c}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":fe}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:W(C-(A?0:F)),width:W(I),height:W(Math.max(1,F*2)),style:y?{cursor:tr("ns-resize",r)}:void 0,...l}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":me}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:W(0-(T?N*2:N)),y:0,height:W(C),width:W(Math.max(1,N*2)),style:y?{cursor:tr("ew-resize",r)}:void 0,...u}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":ae}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:W(0-(T?N*2:N*1.5)),y:W(0-(A?F*2:F*1.5)),width:W(N*3),height:W(F*3),style:y?{cursor:tr("nwse-resize",r)}:void 0,...d}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":ye}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:W(I-(T?0:N*1.5)),y:W(0-(A?F*2:F*1.5)),width:W(N*3),height:W(F*3),style:y?{cursor:tr("nesw-resize",r)}:void 0,...h}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":xe}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:W(I-(T?N:N*1.5)),y:W(C-(A?F:F*1.5)),width:W(N*3),height:W(F*3),style:y?{cursor:tr("nwse-resize",r)}:void 0,...p}),f.jsx("rect",{className:Me("tl-transparent",{"tl-hidden":he}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:W(0-(T?N*3:N*1.5)),y:W(C-(A?0:F*1.5)),width:W(N*3),height:W(F*3),style:y?{cursor:tr("nesw-resize",r)}:void 0,...g}),B&&f.jsxs(f.Fragment,{children:[f.jsx("rect",{"data-testid":"selection.resize.top-left",className:Me("tl-corner-handle",{"tl-hidden":ae}),"aria-label":"top_left handle",x:W(0-_/2),y:W(0-_/2),width:W(_),height:W(_)}),f.jsx("rect",{"data-testid":"selection.resize.top-right",className:Me("tl-corner-handle",{"tl-hidden":ye}),"aria-label":"top_right handle",x:W(I-_/2),y:W(0-_/2),width:W(_),height:W(_)}),f.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Me("tl-corner-handle",{"tl-hidden":xe}),"aria-label":"bottom_right handle",x:W(I-_/2),y:W(C-_/2),width:W(_),height:W(_)}),f.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Me("tl-corner-handle",{"tl-hidden":he}),"aria-label":"bottom_left handle",x:W(0-_/2),y:W(C-_/2),width:W(_),height:W(_)})]}),st&&f.jsxs(f.Fragment,{children:[f.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:W(0-_/4),y:W(C/2-we/2),rx:_/4,width:W(_/2),height:W(we)}),f.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:_/4,x:W(I-_/4),y:W(C/2-we/2),width:W(_/2),height:W(we)})]}),G&&f.jsx(Dse,{size:_,width:I,height:C,hideAlternateHandles:K})]})})}),ed=function({cx:e,cy:r,targetSize:i,corner:s,cursor:o,isHidden:a,"data-testid":c}){const l=ai(s);return f.jsx("rect",{className:Me("tl-transparent","tl-rotate-corner",{"tl-hidden":a}),"data-testid":c,"aria-label":`${s} target`,pointerEvents:"all",x:W(e-i*3),y:W(r-i*3),width:W(Math.max(1,i*3)),height:W(Math.max(1,i*3)),cursor:o,...l})},Lse=Math.sqrt(Math.PI),Fse=function({cx:e,cy:r,size:i,isHidden:s,"data-testid":o}){const a=ai("mobile_rotate"),c=Z(),l=ne("zoom level",()=>c.getZoomLevel(),[c]),u=Math.max(14*(1/l),20/Math.max(1,l));return f.jsxs("g",{children:[f.jsx("circle",{"data-testid":o,pointerEvents:"all",className:Me("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:e,cy:r,r:u,...a}),f.jsx("circle",{className:Me("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:e,cy:r,r:i/Lse})]})};function zse(){const n=Z();return ne("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?f.jsx(kz,{}):null}function Tw(n,e,r){const{arrowheadStart:i,arrowheadEnd:s}=e.props,o=ha(n,e,r),a=o.start.clone(),c=o.end.clone(),l=k.Med(a,c);if(k.Equals(a,c))return{bindings:r,isStraight:!0,start:{handle:a,point:a,arrowhead:e.props.arrowheadStart},end:{handle:c,point:c,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const u=k.Sub(c,a).uni(),d=uh(n,e,"start"),h=uh(n,e,"end"),p=n.getShapePageTransform(e);tO(c,o.start,p,h),tO(a,o.end,p,d);let g=0,y=0,v=0,x=0,m=fa*e.props.scale;const b=d&&h&&d.shape===h.shape,S=d&&h?X_(n,d.shape.id,h.shape.id):"safe";S==="safe"&&d&&h&&!b&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(c.clone().add(u.clone().mul(fa*e.props.scale))):h.didIntersect||h.isClosed&&c.setTo(a.clone().sub(u.clone().mul(fa*e.props.scale))));const w=k.Sub(c,a),I=k.Len(w)?w.uni():k.From(w),C=!k.Equals(I,u);b||(S!=="start-contains-end"&&d&&i!=="none"&&!d.isExact&&(v=Ts[e.props.size]/2+("size"in d.shape.props?Ts[d.shape.props.size]/2:0),g=(dh+v)*e.props.scale,m+=v*e.props.scale),S!=="end-contains-start"&&h&&s!=="none"&&!h.isExact&&(x=Ts[e.props.size]/2+("size"in h.shape.props?Ts[h.shape.props.size]/2:0),y=(dh+x)*e.props.scale,m+=x*e.props.scale));const _=a.clone().add(I.clone().mul(g*(C?-1:1))),P=c.clone().sub(I.clone().mul(y*(C?-1:1)));k.DistMin(_,P,m)&&(g!==0&&y!==0?(g*=-1.5,y*=-1.5):g!==0?g*=-1:y!==0&&(y*=-1)),a.add(I.clone().mul(g*(C?-1:1))),c.sub(I.clone().mul(y*(C?-1:1))),C?(d&&h&&c.setTo(k.Add(a,I.clone().mul(-fa*e.props.scale))),l.setTo(k.Med(o.start,o.end))):l.setTo(k.Med(a,c));const M=k.Dist(a,c);return{bindings:r,isStraight:!0,start:{handle:o.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:o.end,point:c,arrowhead:e.props.arrowheadEnd},middle:l,isValid:M>0,length:M}}function tO(n,e,r,i){if(i===void 0||i.isExact)return;const s=de.applyToPoint(r,e),o=de.applyToPoint(r,n),a=de.applyToPoint(de.Inverse(i.transform),s),c=de.applyToPoint(de.Inverse(i.transform),o),l=i.isClosed,d=(l?z_:vre)(a,c,i.outline);let h;if(d!==null&&(h=d.sort((y,v)=>k.Dist2(y,a)-k.Dist2(v,a))[0]??(l?void 0:c)),h===void 0)return;const p=de.applyToPoint(i.transform,h),g=de.applyToPoint(de.Inverse(r),p);n.setTo(g),i.didIntersect=!0}function $se(n,e,r){const{arrowheadEnd:i,arrowheadStart:s}=e.props,o=e.props.bend;if(Math.abs(o)>Math.abs(e.props.bend*(Gse*e.props.scale)))return Tw(n,e,r);const a=ha(n,e,r),c=k.Med(a.start,a.end),l=k.Sub(a.end,a.start),u=k.Len(l)?l.uni():k.From(l),d=k.Add(c,u.per().mul(-o)),h=uh(n,e,"start"),p=uh(n,e,"end"),g=a.start.clone(),y=a.end.clone(),v=d.clone();if(k.Equals(g,y))return{bindings:r,isStraight:!0,start:{handle:g,point:g,arrowhead:e.props.arrowheadStart},end:{handle:y,point:y,arrowhead:e.props.arrowheadEnd},middle:v,isValid:!1,length:0};const x=e.props.bend<0,m=x?ru:az,b=nO(g,y,v),S=k.Angle(b.center,g),w=k.Angle(b.center,y),I=m(S,w);if(b.length===0||b.size===0||!mR(b.length)||!mR(b.size))return Tw(n,e,r);const C=g.clone(),_=y.clone(),P=v.clone(),M=n.getShapePageTransform(e);let T=0,A=0,R=fa*e.props.scale;if(h&&!h.isExact){const G=de.applyToPoint(M,C),X=de.applyToPoint(M,b.center),ee=de.applyToPoint(M,_),re=de.Inverse(h.transform),B=de.applyToPoint(re,G),U=de.applyToPoint(re,X),Q=de.applyToPoint(re,ee),{isClosed:K}=h,Y=K?Cw:FR;let V,ie=Y(U,b.radius,h.outline);if(ie){const ae=U.angle(B),ye=U.angle(Q),he=m(ae,ye);ie=ie.filter(fe=>m(ae,U.angle(fe))<=he);const xe=he*.25;ie.sort(K?(fe,me)=>Math.abs(m(ae,U.angle(fe))-xe)<Math.abs(m(ae,U.angle(me))-xe)?-1:1:(fe,me)=>m(ae,U.angle(fe))<m(ae,U.angle(me))?-1:1),V=ie[0]??(K?void 0:B)}else V=K?void 0:B;if(V&&(C.setTo(n.getPointInShapeSpace(e,de.applyToPoint(h.transform,V))),h.didIntersect=!0,s!=="none")){const ae=Ts[e.props.size]/2+("size"in h.shape.props?Ts[h.shape.props.size]/2:0);T=(dh+ae)*e.props.scale,R+=ae*e.props.scale}}if(p&&!p.isExact){const G=de.applyToPoint(M,C),X=de.applyToPoint(M,_),ee=de.applyToPoint(M,b.center),re=de.Inverse(p.transform),B=de.applyToPoint(re,G),U=de.applyToPoint(re,ee),Q=de.applyToPoint(re,X),K=p.isClosed,Y=K?Cw:FR;let V,ie=Y(U,b.radius,p.outline);if(ie){const ae=U.angle(B),ye=U.angle(Q),he=m(ae,ye),xe=he*.75;ie=ie.filter(fe=>m(ae,U.angle(fe))<=he),ie.sort(K?(fe,me)=>Math.abs(m(ae,U.angle(fe))-xe)<Math.abs(m(ae,U.angle(me))-xe)?-1:1:(fe,me)=>m(ae,U.angle(fe))<m(ae,U.angle(me))?-1:1),ie[0]?V=ie[0]:V=K?void 0:Q}else V=K?void 0:Q;if(V&&(_.setTo(n.getPointInShapeSpace(e,de.applyToPoint(p.transform,V))),p.didIntersect=!0,i!=="none")){const ae=Ts[e.props.size]/2+("size"in p.shape.props?Ts[p.shape.props.size]/2:0);A=(dh+ae)*e.props.scale,R+=ae*e.props.scale}}let O=k.Angle(b.center,C),j=k.Angle(b.center,_),D=m(O,j),N=D*b.radius;const F=C.clone(),z=_.clone();if(T!==0&&F.setTo(b.center).add(k.FromAngle(O+D*(T/N*(x?1:-1))).mul(b.radius)),A!==0&&z.setTo(b.center).add(k.FromAngle(j+D*(A/N*(x?-1:1))).mul(b.radius)),k.DistMin(F,z,R)&&(T!==0&&A!==0?(T*=-1.5,A*=-1.5):T!==0?T*=-2:A!==0&&(A*=-2)),T!==0&&C.setTo(b.center).add(k.FromAngle(O+D*(T/N*(x?1:-1))).mul(b.radius)),A!==0&&_.setTo(b.center).add(k.FromAngle(j+D*(A/N*(x?-1:1))).mul(b.radius)),h&&p&&!h.isExact&&!p.isExact){O=k.Angle(b.center,C),j=k.Angle(b.center,_),D=m(O,j),N=D*b.radius;const G=X_(n,h.shape.id,p.shape.id);G==="double-bound"&&N<30?(C.setTo(g),_.setTo(y),P.setTo(v)):G==="safe"&&(h&&!h.didIntersect&&C.setTo(g),(p&&!p.didIntersect||m(S,O)>m(S,j))&&_.setTo(b.center).add(k.FromAngle(O+D*(Math.min(.9,fa*e.props.scale/N)*(x?1:-1))).mul(b.radius)))}Bse(b.center,b.radius,C,_,P,I,x),C.equals(_)&&(C.setTo(P.clone().addXY(1,1)),_.setTo(P.clone().subXY(1,1))),g.setTo(C),y.setTo(_),v.setTo(P);const $=nO(g,y,v);return{bindings:r,isStraight:!1,start:{point:g,handle:a.start,arrowhead:e.props.arrowheadStart},end:{point:y,handle:a.end,arrowhead:e.props.arrowheadEnd},middle:v,handleArc:b,bodyArc:$,isValid:$.length!==0&&isFinite($.center.x)&&isFinite($.center.y)}}function nO(n,e,r){const i=M_(n,e,r),s=k.Dist(i,n),o=+k.Clockwise(n,r,e),a=((n.y-e.y)**2+(n.x-e.x)**2)**.5,c=((e.y-r.y)**2+(e.x-r.x)**2)**.5,l=((r.y-n.y)**2+(r.x-n.x)**2)**.5,u=Math.acos((c*c+l*l-a*a)/(2*c*l))*2,d=+(Je>u),h=(rt-u)*(o?1:-1),p=h*s;return{center:i,radius:s,size:h,length:p,largeArcFlag:d,sweepFlag:o}}function Bse(n,e,r,i,s,o,a){const c=k.Angle(n,r),l=k.Angle(n,i);let u=ru(c,l);if(a||(u=rt-u),s.setTo(n).add(k.FromAngle(c+u*(.5*(a?1:-1))).mul(e)),u>o){s.rotWith(n,Je);const d=i.clone();i.setTo(r),r.setTo(d)}}const Use=8;function qse(n){return Math.abs(n.props.bend)<Use*n.props.scale}function uh(n,e,r){const i=n.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===r);if(!i)return;const s=n.getShape(i.toId);if(!s)return;const o=n.getShapePageTransform(s),a=n.getShapeGeometry(s),c=a instanceof Qr?a.children[0].vertices:a.vertices;return{shape:s,transform:o,isClosed:a.isClosed,isExact:i.props.isExact,didIntersect:!1,outline:c}}function rO(n,e,r,i){const s=n.getShape(r.toId);if(s){const{point:o,size:a}=n.getShapeGeometry(s).bounds,c=k.Add(o,k.MulV(r.props.isPrecise||i?r.props.normalizedAnchor:{x:.5,y:.5},a)),l=de.applyToPoint(n.getShapePageTransform(s),c);return de.applyToPoint(de.Inverse(e),l)}else return new k(0,0)}function Un(n,e){const r=n.getBindingsFromShape(e,"arrow");return{start:r.find(i=>i.props.terminal==="start"),end:r.find(i=>i.props.terminal==="end")}}const Hse=vJ("arrow info",(n,e)=>{const r=Un(n,e);return qse(e)?Tw(n,e,r):$se(n,e,r)});function fi(n,e){const r=typeof e=="string"?e:e.id;return Hse.get(n,r)}function ha(n,e,r){const i=n.getShapePageTransform(e),s=X_(n,r.start?.toId,r.end?.toId),o=r.start?rO(n,i,r.start,s==="double-bound"||s==="start-contains-end"):k.From(e.props.start),a=r.end?rO(n,i,r.end,s==="double-bound"||s==="end-contains-start"):k.From(e.props.end);return{start:o,end:a}}function vc(n,e,r,i){const s=typeof e=="string"?e:e.id,o=typeof r=="string"?r:r.id,a=n.getBindingsFromShape(s,"arrow").filter(l=>l.props.terminal===i.terminal);a.length>1&&n.deleteBindings(a.slice(1));const c=a[0];c?n.updateBinding({...c,toId:o,props:i}):n.createBinding({type:"arrow",fromId:s,toId:o,props:i})}function Md(n,e,r){const i=n.getBindingsFromShape(e,"arrow").filter(s=>s.props.terminal===r);n.deleteBindings(i)}const fa=10,dh=10,Gse=10,Ts={s:2,m:3.5,l:5,xl:10};function X_(n,e,r){if(!e||!r)return"safe";if(e===r)return"double-bound";const i=n.getShapePageBounds(e),s=n.getShapePageBounds(r);if(i&&s){if(i.contains(s))return"start-contains-end";if(s.contains(i))return"end-contains-start"}return"safe"}class Kse extends yse{static type="arrow";static props=kF;static migrations=TF;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){SS(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){SS(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){SS(this.editor,e)}onAfterChangeToShape({binding:e}){v$(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const r=this.editor.getShape(e.fromId);r&&hh({editor:this.editor,arrow:r,terminal:e.props.terminal})}}function v$(n,e){const r=n.getShape(e);if(!r)return;const i=Un(n,r),{start:s,end:o}=i,a=s?n.getShape(s.toId):void 0,c=o?n.getShape(o.toId):void 0,l=n.getAncestorPageId(r);if(!l)return;let u;if(a&&c)u=n.findCommonAncestor([a,c])??l;else if(a||c){const x=(a||c)?.parentId;x&&x===r.parentId?u=r.parentId:u=l}else return;u&&u!==r.parentId&&n.reparentShapes([e],u);const d=n.getShape(e);if(!d)throw Error("no reparented arrow");const h=n.getShapeNearestSibling(d,a),p=n.getShapeNearestSibling(d,c);let g;if(h&&p)g=h.index>p.index?h:p;else if(h&&!p)g=h;else if(p&&!h)g=p;else return;let y;const v=n.getSortedChildIdsForParent(g.parentId).map(x=>n.getShape(x)).filter(x=>x.index>g.index);if(v.length){const x=v.find(m=>m.type!=="arrow");if(d.index>g.index&&(!x||d.index<x.index))return;y=wl(g.index,v[0].index)}else y=Hr(g.index);y!==d.index&&n.updateShapes([{id:e,type:"arrow",index:y}])}function SS(n,e){const r=Un(n,e);for(const i of["start","end"]){const s=r[i];if(!s)continue;const o=n.getShape(s.toId),a=n.getAncestorPageId(e)===n.getAncestorPageId(o);(!o||!a)&&hh({editor:n,arrow:e,terminal:i,unbind:!0})}v$(n,e.id)}function hh({editor:n,arrow:e,terminal:r,unbind:i=!1,useHandle:s=!1}){const o=fi(n,e);if(!o)throw new Error("expected arrow info");const a=s?o.start.handle:o.start.point,c=s?o.end.handle:o.end.point,l=r==="start"?a:c,u={id:e.id,type:"arrow",props:{[r]:{x:l.x,y:l.y},bend:e.props.bend}};if(!o.isStraight){const d=r==="start"?a:o.start.handle,h=r==="end"?c:o.end.handle,p=k.Med(d,h),g=k.Sub(d,h).per().uni().mul(o.handleArc.radius*2*Math.sign(e.props.bend)),y=cu(o.handleArc.center,k.Add(p,g),o.handleArc.center,o.handleArc.radius);gt(y?.length===1);const v=k.Dist(p,y[0])*Math.sign(e.props.bend);Os(v,u.props.bend)||(u.props.bend=v)}n.updateShape(u),i&&Md(n,e,r)}const x$=[Kse],cn={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Yt={s:2,m:3.5,l:5,xl:10},Aa={s:18,m:24,l:36,xl:44},Zi={s:18,m:22,l:26,xl:32},Vse={s:18,m:20,l:24,xl:28},vi={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Wse=20,Yse=4.25,_r=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Xse(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function iO(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),r.push.apply(r,i)}return r}function rr(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?iO(Object(r),!0).forEach((function(i){Zse(n,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):iO(Object(r)).forEach((function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(r,i))}))}return n}function Zse(n,e,r){return e=ooe(e),e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function Qse(n,e){if(n==null)return{};var r={},i=Object.keys(n),s,o;for(o=0;o<i.length;o++)s=i[o],!(e.indexOf(s)>=0)&&(r[s]=n[s]);return r}function Jse(n,e){if(n==null)return{};var r=Qse(n,e),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(s=0;s<o.length;s++)i=o[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(r[i]=n[i])}return r}function sO(n,e){return toe(n)||Xse(n,e)||b$(n,e)||ioe()}function td(n){return eoe(n)||noe(n)||b$(n)||roe()}function eoe(n){if(Array.isArray(n))return Mw(n)}function toe(n){if(Array.isArray(n))return n}function noe(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function b$(n,e){if(n){if(typeof n=="string")return Mw(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mw(n,e)}}function Mw(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=n[r];return i}function roe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ioe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function soe(n,e){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ooe(n){var e=soe(n,"string");return typeof e=="symbol"?e:String(e)}function il(n){var e=n.sizes.shift(),r=Math.max(Math.ceil(e[0]),1),i=Math.max(Math.ceil(e[1]),1),s=[r-1,i-1,1,1],o=Date.now(),a=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,c,l;a?(c=new OffscreenCanvas(1,1),l=new OffscreenCanvas(r,i)):(c=document.createElement("canvas"),c.width=1,c.height=1,l=document.createElement("canvas"),l.width=r,l.height=i);var u=c.getContext("2d"),d=l.getContext("2d");d&&(d.fillRect.apply(d,s),u.drawImage(l,r-1,i-1,1,1,0,0,1,1));var h=u&&u.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-o;return[c,l].forEach((function(g){g.height=0,g.width=0})),a?(postMessage({width:r,height:i,benchmark:p,isTestPass:h}),!h&&n.sizes.length&&il(n)):h?n.onSuccess(r,i,p):(n.onError(r,i,p),n.sizes.length&&il(n)),h}var wS={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},aoe=["onError","onSuccess"],pa={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},xc={};function _S(n){var e=n.width===n.height,r=n.height===1,i=n.width===1,s=[];if(!n.width||!n.height)n.sizes.forEach((function(d){var h=e||r?d:1,p=e||i?d:1;s.push([h,p])}));else for(var o=n.min||pa.min,a=n.step||pa.step,c=Math.max(n.width,n.height);c>=o;){var l=e||r?c:1,u=e||i?c:1;s.push([l,u]),c-=a}return s}function nd(n){var e=window&&"HTMLCanvasElement"in window,r=window&&"OffscreenCanvas"in window,i=Date.now(),s=n.onError,o=n.onSuccess,a=Jse(n,aoe),c=null;if(!e)return!1;if(n.useWorker&&r){var l=`
            var canvasTest = `.concat(il.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),u=new Blob([l],{type:"application/javascript"}),d=URL.createObjectURL(u);c=new Worker(d),URL.revokeObjectURL(d),c.onmessage=function(h){var p=h.data,g=p.width,y=p.height,v=p.benchmark,x=p.isTestPass;x?(xc[i].onSuccess(g,y,v),delete xc[i]):xc[i].onError(g,y,v)}}if(n.usePromise)return new Promise((function(h,p){var g=rr(rr({},n),{},{onError:function(m,b,S){var w;if(n.sizes.length===0)w=!0;else{var I=n.sizes.slice(-1),C=sO(I,1),_=sO(C[0],2),P=_[0],M=_[1];w=m===P&&b===M}s(m,b,S),w&&p({width:m,height:b,benchmark:S})},onSuccess:function(m,b,S){o(m,b,S),h({width:m,height:b,benchmark:S})}});if(c){var y=g.onError,v=g.onSuccess;xc[i]={onError:y,onSuccess:v},c.postMessage(a)}else il(g)}));if(c)xc[i]={onError:s,onSuccess:o},c.postMessage(a);else return il(n)}var CS={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=_S({width:e.max,height:e.max,min:e.min,step:e.step,sizes:td(wS.area)}),i=rr(rr(rr({},pa),e),{},{sizes:r});return nd(i)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=_S({width:1,height:e.max,min:e.min,step:e.step,sizes:td(wS.height)}),i=rr(rr(rr({},pa),e),{},{sizes:r});return nd(i)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=_S({width:e.max,height:1,min:e.min,step:e.step,sizes:td(wS.width)}),i=rr(rr(rr({},pa),e),{},{sizes:r});return nd(i)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=rr(rr({},pa),e);return r.sizes=td(r.sizes),r.width&&r.height&&(r.sizes=[[r.width,r.height]]),nd(r)}};let PS=null;function coe(){return PS||(PS=loe()),PS}async function loe(){const n=await CS.maxWidth({usePromise:!0}),e=await CS.maxHeight({usePromise:!0}),r=await CS.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:r.width*r.height}}const oO=8192,uoe=4096*4096;async function doe(n,e){if(n<=oO&&e<=oO&&n*e<=uoe)return[n,e];const{maxWidth:r,maxHeight:i,maxArea:s}=await coe(),o=n/e;if(n>r&&(n=r,e=n/o),e>i&&(e=i,n=e*o),n*e>s){const a=Math.sqrt(s/(n*e));n*=a,e*=a}return[n,e]}function hoe(n,e){const r=n.w/e.w,i=n.h/e.h;return r<=1&&i<=1?n:r>i?{w:n.w/r,h:n.h/r}:{w:n.w/i,h:n.h/i}}function foe(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function poe(n){const e=new URL(n).host.replace("www.","");for(const r of nu)if(S$(r.hostnames,e)){const i=r.fromEmbedUrl(n);if(i)return{definition:r,url:i,embedUrl:n}}}const goe=n=>n.split("*").map(e=>foe(e)).join(".+"),S$=(n,e)=>!!n.find(r=>{const i=new RegExp(goe(r));return e.match(i)});function moe(n){const e=new URL(n).host.replace("www.","");for(const r of nu)if(S$(r.hostnames,e)){const i=r.toEmbedUrl(n);if(i)return{definition:r,embedUrl:i,url:n}}}function w$(n){return moe(n)??poe(n)}function Ms(n){try{return w$(n)}catch(e){console.error(e)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const ga="  ";class tn{static insertTextFirefox(e,r){e.setRangeText(r,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:r,inputType:"insertText",isComposing:!1}))}static insert(e,r){const i=e.ownerDocument,s=i.activeElement;s!==e&&e.focus(),i.execCommand("insertText",!1,r)||tn.insertTextFirefox(e,r),s===i.body?e.blur():s instanceof HTMLElement&&s!==e&&s.focus()}static set(e,r){e.select(),tn.insert(e,r)}static getSelection(e){const{selectionStart:r,selectionEnd:i}=e;return e.value.slice(r||void 0,i||void 0)}static wrapSelection(e,r,i){const{selectionStart:s,selectionEnd:o}=e,a=tn.getSelection(e);tn.insert(e,r+a+(i??r)),e.selectionStart=(s||0)+r.length,e.selectionEnd=(o||0)+r.length}static replace(e,r,i){let s=0;e.value.replace(r,(...o)=>{const a=s+o[o.length-2],c=o[0].length;e.selectionStart=a,e.selectionEnd=a+c;const l=typeof i=="string"?i:i(...o);return tn.insert(e,l),e.selectionStart=a,s+=l.length-c,l})}static findLineEnd(e,r){const i=e.lastIndexOf(`
`,r-1)+1;return e.charAt(i)!=="	"?r:i+1}static indent(e){const{selectionStart:r,selectionEnd:i,value:s}=e,o=s.slice(r,i),a=/\n/g.exec(o)?.length;if(a&&a>0){const c=s.lastIndexOf(`
`,r-1)+1,l=e.value.slice(c,i-1),u=l.replace(/^|\n/g,`$&${ga}`),d=u.length-l.length;e.setSelectionRange(c,i-1),tn.insert(e,u),e.setSelectionRange(r+1,i+d)}else tn.insert(e,ga)}static unindent(e){const{selectionStart:r,selectionEnd:i,value:s}=e,o=s.lastIndexOf(`
`,r-1)+1,a=tn.findLineEnd(s,i),c=e.value.slice(o,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-l.length;e.setSelectionRange(o,a),tn.insert(e,l);const d=/\t| {1,2}/.exec(s.slice(o,r)),h=d?d[0].length:0,p=r-h;e.setSelectionRange(r-h,Math.max(p,i-u))}static indentCE(e){const r=window.getSelection(),i=e.innerText,s=rd(e)??0,o=rd(e)??0,a=i.slice(s,o),c=/\n/g.exec(a)?.length;if(c&&c>0){const l=i.lastIndexOf(`
`,s-1)+1,u=i.slice(l,o-1),h=u.replace(/^|\n/g,`$&${ga}`).length-u.length;r&&r.setBaseAndExtent(e,s+1,e,o+h)}else{const l=window.getSelection();e.innerText=i.slice(0,s)+ga+i.slice(s),l?.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){const r=window.getSelection(),i=e.innerText,s=rd(e)??0,o=rd(e)??0,a=i.lastIndexOf(`
`,s-1)+1,c=tn.findLineEnd(i,o),l=i.slice(a,c),u=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-u.length;if(r){r.setBaseAndExtent(e,a,e,c);const h=/\t| {1,2}/.exec(i.slice(a,s)),p=h?h[0].length:0,g=s-p;r.setBaseAndExtent(e,s-p,e,Math.max(g,o-d))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(tn.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(tn.fixNewLines,`
`).split(`
`).map(r=>r||" ").join(`
`)}}function rd(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let r=0;if(e.rangeCount!==0){const i=e.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(n),s.setEnd(i.endContainer,i.endOffset),r=s.toString().length}return r}const yoe=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function _$(n){return yoe.test(n)}function voe(n){return n.replace(/\t/g,ga)}function xoe(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let r=1/0;for(const i of e)if(i.trim().length>0){const s=i.length-i.trimStart().length;r=Math.min(r,s)}return e.map(i=>i.slice(r)).join(`
`)}function boe(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Soe(n){return boe(xoe(voe(n)))}function woe(n,{maxImageDimension:e,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s},{toasts:o,msg:a}){n.registerExternalAssetHandler("file",async({file:c})=>{const l=c.name;let u=c;const d=i.includes(u.type),h=s.includes(u.type);!d&&!h&&o.addToast({title:a("assets.files.type-not-allowed"),severity:"error"}),gt(d||h,`File type not allowed: ${u.type}`),u.size>r&&o.addToast({title:a("assets.files.size-too-big"),severity:"error"}),gt(u.size<=r,`File size too big: ${(u.size/1024).toFixed()}kb > ${(r/1024).toFixed()}kb`),u.type==="video/quicktime"&&(u=new File([u],u.name,{type:"video/mp4"}));let p=d?await di.getImageSize(u):await di.getVideoSize(u);const g=await di.isAnimated(u)||h,y=zQ(await u.arrayBuffer());if(isFinite(e)){const m=hoe(p,{w:e,h:e});p!==m&&di.isStaticImageType(u.type)&&(p=m)}const x={id:uo.createId(y),type:d?"image":"video",typeName:"asset",props:{name:l,src:"",w:p.w,h:p.h,fileSize:u.size,mimeType:u.type,isAnimated:g}};return x.props.src=await n.uploadAsset(x,u),uo.create(x)}),n.registerExternalAssetHandler("url",async({url:c})=>{let l;try{const d=await(await bi(c,{method:"GET",mode:"no-cors"})).text(),h=new DOMParser().parseFromString(d,"text/html");l={image:h.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:h.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??h.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:h.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??c,description:h.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""},l.image.startsWith("http")||(l.image=new URL(l.image,c).href),l.favicon.startsWith("http")||(l.favicon=new URL(l.favicon,c).href)}catch(u){console.error(u),o.addToast({title:a("assets.url.failed"),severity:"error"}),l={image:"",favicon:"",title:"",description:""}}return{id:uo.createId(uw(c)),typeName:"asset",type:"bookmark",props:{src:c,description:l.description,image:l.image,favicon:l.favicon,title:l.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:c,text:l})=>{const u=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=new DOMParser().parseFromString(l,"image/svg+xml").querySelector("svg");if(!d)throw new Error("No <svg/> element present");let h=parseFloat(d.getAttribute("width")||"0"),p=parseFloat(d.getAttribute("height")||"0");if(!(h&&p)){document.body.appendChild(d);const y=d.getBoundingClientRect();document.body.removeChild(d),h=y.width,p=y.height}const g=await n.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});if(!g)throw Error("Could not create an asset");aO(n,[g],u)}),n.registerExternalContentHandler("embed",({point:c,url:l,embed:u})=>{const d=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:h,height:p}=u,g=it(),y={id:g,type:"embed",x:d.x-(h||450)/2,y:d.y-(p||450)/2,props:{w:h,h:p,url:l}};n.createShapes([y]).select(g)}),n.registerExternalContentHandler("files",async({point:c,files:l})=>{const u=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=new k(u.x,u.y),h=[];await Promise.all(l.map(async(p,g)=>{if(p.size>r)return o.addToast({title:a("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(p.size/1024).toFixed()}kb > ${(r/1024).toFixed()}kb`),null;if(!p.type)throw new Error("No mime type");if(!i.concat(s).includes(p.type))return o.addToast({title:a("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${p.name} not loaded - Extension not allowed.`),null;try{const y=await n.getAssetForExternalContent({type:"file",file:p});if(!y)throw Error("Could not create an asset");h[g]=y}catch(y){return o.addToast({title:a("assets.files.upload-failed"),severity:"error"}),console.error(y),null}})),aO(n,Be(h),d)}),n.registerExternalContentHandler("text",async({point:c,text:l})=>{const u=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=n.getShapeUtil("text").getDefaultProps(),h=Soe(l),p=n.getOnlySelectedShape();if(p&&"text"in p.props){n.updateShapes([{id:p.id,type:p.type,props:{text:h}}]);return}let g,y,v,x="middle";const m=h.split(`
`).length>1,b=_$(h);m&&(x=m?b?"end":"start":"middle");const S=n.textMeasure.measureText(h,{...cn,fontFamily:vi[d.font],fontSize:Aa[d.size],maxWidth:null}),w=Math.min(m?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(S.w>w){const I=n.textMeasure.measureText(h,{...cn,fontFamily:vi[d.font],fontSize:Aa[d.size],maxWidth:w});g=I.w,y=I.h,v=!1,x=b?"end":"start"}else g=S.w,y=S.h,v=!0;u.y-y/2<n.getViewportPageBounds().minY+40&&(u.y=n.getViewportPageBounds().minY+40+y/2),n.createShapes([{id:it(),type:"text",x:u.x-g/2,y:u.y-y/2,props:{text:h,textAlign:x,autoSize:v,w:g}}])}),n.registerExternalContentHandler("url",async({point:c,url:l})=>{const u=Ms(l);if(u)return n.putExternalContent({type:"embed",url:u.url,point:c,embed:u.definition});const d=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=uo.createId(uw(l)),p=_oe(n,l,d);let g=n.getAsset(h),y=!1;if(!g){y=!0;try{const v=await n.getAssetForExternalContent({type:"url",url:l});if(!v)throw Error("Could not create an asset");g=v}catch{o.addToast({title:a("assets.url.failed"),severity:"error"});return}}n.run(()=>{y&&n.createAssets([g]),n.updateShapes([{id:p.id,type:p.type,props:{assetId:g.id}}])})})}async function aO(n,e,r){if(!e.length)return[];const i=k.From(r),s=[];for(let o=0;o<e.length;o++){const a=e[o];switch(a.type){case"bookmark":{s.push({id:it(),type:"bookmark",x:i.x,y:i.y,opacity:1,props:{assetId:a.id,url:a.props.src}}),i.x+=300;break}case"image":{s.push({id:it(),type:"image",x:i.x,y:i.y,opacity:1,props:{assetId:a.id,w:a.props.w,h:a.props.h}}),i.x+=a.props.w;break}case"video":s.push({id:it(),type:"video",x:i.x,y:i.y,opacity:1,props:{assetId:a.id,w:a.props.w,h:a.props.h}}),i.x+=a.props.w}}return n.run(()=>{const o=e.filter(a=>!n.getAsset(a.id));o.length&&n.createAssets(o),n.createShapes(s).select(...s.map(a=>a.id)),C$(n,r)}),s.map(o=>o.id)}function C$(n,e){const r=n.getViewportPageBounds();let i=n.getSelectionPageBounds();if(i){const s=i.center.sub(e);n.updateShapes(n.getSelectedShapes().map(o=>{const a=n.getShapeParentTransform(o).decompose().rotation,c=k.Rot(s,-a);return{id:o.id,type:o.type,x:o.x-c.x,y:o.y-c.y}}))}i=n.getSelectionPageBounds(),i&&!r.contains(i)&&n.zoomToSelection()}function _oe(n,e,r){const i={id:it(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([i]).select(i.id),C$(n,r)}),n.getShape(i.id)}let Coe=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:r}))}}},Poe=class extends Ee{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){const{originPagePoint:e}=this.editor.inputs,r=it();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShape({id:r,type:"arrow",x:e.x,y:e.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(r);if(!i)throw Error("expected shape");const s=this.editor.getShapeHandles(i);if(!s)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=s.find(u=>u.id==="start"),l=o.onHandleDrag?.(i,{handle:{...c,x:0,y:0},isPrecise:!0,initial:a});l&&this.editor.updateShapes([l]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const r=this.editor.getShapeHandles(e);if(!r)throw Error("expected handles for arrow");{const i=this.editor.getShapeUtil("arrow"),s=this.shape,o=r.find(c=>c.id==="start"),a=i.onHandleDrag?.(e,{handle:{...o,x:0,y:0},isPrecise:this.didTimeout,initial:s});a&&this.editor.updateShapes([a])}{const i=this.editor.getShapeUtil("arrow"),s=this.shape,o=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),a=r.find(l=>l.id==="end"),c=i.onHandleDrag?.(this.editor.getShape(e),{handle:{...a,x:o.x,y:o.y},isPrecise:!1,initial:s});c&&this.editor.updateShapes([c])}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}};class Ioe extends Ee{static id="arrow";static initial="idle";static children=()=>[Coe,Poe];shapeType="arrow"}class P$ extends Ee{static id="drawing";info={};initialShape;shapeType=this.parent.id==="highlight"?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{const{inputs:e}=this.editor;if(this.isPen&&!e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?k.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())};onKeyDown=e=>{if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()};onKeyUp=e=>{if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()};onExit=()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return this.shapeType!=="highlight"}getIsClosed(e,r,i){if(!this.canClose())return!1;const s=Yt[r],o=e[0].points[0],a=e[e.length-1],c=a.points[a.points.length-1];return o!==c&&this.currentLineLength>s*4*i&&k.DistMin(o,c,s*2*i)}startShape(){const{inputs:{originPagePoint:e,isPen:r}}=this.editor;this.markId="draw start "+kt(),this.editor.mark(this.markId);const{z:i=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||i>0&&i<.5||i>.5&&i<1;const s=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=rn(a.props.segments);if(!c)throw Error("Expected a previous segment!");const l=rn(c.points);if(!l)throw Error("Expected a previous point!");const{x:u,y:d}=this.editor.getPointInShapeSpace(a,e).toFixed(),h={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+s.toFixed(2)},{x:u,y:d,z:+s.toFixed(2)}]},p=de.applyToPoint(this.editor.getShapePageTransform(a.id),l);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const g=[...a.props.segments,h];this.currentLineLength<Yt[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const y={id:a.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(y.props.isClosed=this.getIsClosed(g,a.props.size,a.props.scale)),this.editor.updateShapes([y]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const o=it();this.editor.createShapes([{id:o,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:e}=this,{inputs:r}=this.editor;if(!e)return;const{id:i,props:{size:s,scale:o}}=e,a=this.editor.getShape(i);if(!a)return;const{segments:c}=a.props,{x:l,y:u,z:d}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),h=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,p={x:l,y:u,z:h};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(k.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const v=rn(c);if(!v)throw Error("Expected a previous segment!");const x=rn(v.points);if(!x)throw Error("Expected a previous last point!");let m;const b=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(v.type==="straight"){this.currentLineLength+=k.Dist(x,b),m={type:"straight",points:[{...x},b]};const w=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=de.applyToPoint(w,x)}else m={type:"straight",points:[b,p]};const S={id:i,type:this.shapeType,props:{segments:[...c,m]}};this.canClose()&&(S.props.isClosed=this.getIsClosed(c,s,o)),this.editor.updateShapes([S])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(k.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const v=c.slice(),x=v[v.length-1],m=rn(x.points);if(!m)throw Error("No previous point!");const b={type:"free",points:[...k.PointsBetween(m,p,6).map(I=>({x:Hi(I.x),y:Hi(I.y),z:Hi(I.z)}))]},S=[...v,b];this.currentLineLength<Yt[a.props.size]*4&&(this.currentLineLength=this.getLineLength(S));const w={id:i,type:this.shapeType,props:{segments:S}};this.canClose()&&(w.props.isClosed=this.getIsClosed(S,s,o)),this.editor.updateShapes([w])}break}case"straight":{const g=c.slice(),y=g[g.length-1],{pagePointWhereCurrentSegmentChanged:v}=this,{ctrlKey:x,currentPagePoint:m}=this.editor.inputs;if(!v)throw Error("We should have a point where the segment changed");let b,S=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(S=!x,this.didJustShiftClickToExtendPreviousShapeLine=!1):S=!x;let w=this.editor.getPointInShapeSpace(a,m).toFixed().toJson(),I=!1,C;if((this.editor.user.getIsSnapMode()?!x:x)&&g.length>2){let M,T=8/this.editor.getZoomLevel();for(let A=0,R=c.length-2;A<R;A++){const O=c[A];if(!O)break;if(O.type==="free")continue;const j=O.points[0],D=rn(O.points);if(!(j&&D))continue;const N=k.NearestPointOnLineSegment(j,D,w);if(k.DistMin(N,w,T)){M=N.toFixed().toJson(),T=k.Dist(N,w),C=O;break}}M&&(I=!0,w=M)}if(I&&C){const M=this.editor.getShapePageTransform(a),T=C.points[0],A=rn(C.points);if(!A)throw Error("Expected a last point!");const R=de.applyToPoint(M,T),O=de.applyToPoint(M,A),j=de.applyToPoint(M,w);this.editor.snaps.setIndicators([{id:kt(),type:"points",points:[R,j,O]}])}else{if(this.editor.snaps.clearIndicators(),S){const M=k.Angle(v,m),A=oh(M,24)-M;b=k.RotWith(m,v,A)}else b=m;w=this.editor.getPointInShapeSpace(a,b).toFixed().toJson()}this.currentLineLength+=k.Dist(y.points[0],w),g[g.length-1]={...y,type:"straight",points:[y.points[0],w]};const P={id:i,type:this.shapeType,props:{segments:g}};this.canClose()&&(P.props.isClosed=this.getIsClosed(c,s,o)),this.editor.updateShapes([P]);break}case"free":{const g=c.slice(),y=g[g.length-1],v=[...y.points];if(v.length&&this.mergeNextPoint){const{z:m}=v[v.length-1];v[v.length-1]={x:p.x,y:p.y,z:m?Math.max(m,p.z):p.z}}else this.currentLineLength+=k.Dist(v[v.length-1],p),v.push(p);g[g.length-1]={...y,points:v},this.currentLineLength<Yt[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const x={id:i,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(x.props.isClosed=this.getIsClosed(g,s,o)),this.editor.updateShapes([x]),v.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const m=it(),b=this.editor.getShape(i).props;this.editor.createShapes([{id:m,type:this.shapeType,x:Hi(r.currentPagePoint.x),y:Hi(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:b.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=ft(this.editor.getShape(m)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let r=0;for(const i of e)for(let s=0;s<i.points.length-1;s++){const o=i.points[s],a=i.points[s+1];r+=k.Dist2(a,o)}return Math.sqrt(r)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}let I$=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};class Eoe extends Ee{static id="draw";static initial="idle";static isLockable=!1;static children=()=>[I$,P$];shapeType="draw";onExit=()=>{const e=this.children.drawing;e.initialShape=void 0}}class koe extends bse{static id="frame";static initial="idle";shapeType="frame";onCreate=e=>{if(!e)return;const r=this.editor.getShapePageBounds(e),i=[],s=this.editor.getShapeAncestors(e).map(o=>o.id);this.editor.getSortedChildIdsForParent(e.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===e.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&r.contains(c)&&Toe(a,s,e)&&i.push(a.id)}),this.editor.reparentShapes(i,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}function Toe(n,e,r){return e.includes(n.id)?!1:n.parentId===r.parentId}let Moe=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:r}))}};onCancel=()=>{this.editor.setCurrentTool("select")}},Aoe=class extends Ee{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,i=it();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:"geo",x:r.x,y:r.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Wr),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(i).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){const{originPagePoint:e}=this.editor.inputs,r=it();this.markId=`creating:${r}`,this.editor.mark(this.markId);const i=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,s=this.editor.getStyleForNextShape(Wr),o=s==="star"?{w:200,h:190}:s==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:r,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Wr),scale:i,...o}}]);const a=this.editor.getShape(r);if(!a)return;const{w:c,h:l}=a.props,u=new k(c/2,l/2).mul(i),d=this.editor.getShapeParentTransform(a);d&&u.rot(-d.rotation()),this.editor.select(r),this.editor.updateShape({id:a.id,type:"geo",x:a.x-u.x,y:a.y-u.y,props:{geo:this.editor.getStyleForNextShape(Wr),w:c*i,h:l*i}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};class joe extends Ee{static id="geo";static initial="idle";static children=()=>[Moe,Aoe];shapeType="geo"}class Roe extends Ee{static id="highlight";static initial="idle";static children=()=>[I$,P$];static isLockable=!1;shapeType="highlight";onExit=()=>{const e=this.children.drawing;e.initialShape=void 0}}let Ooe=class extends Ee{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}};const cO=2;let Doe=class extends Ee{static id="pointing";shape={};markId;onEnter=e=>{const{inputs:r}=this.editor,{currentPagePoint:i}=r;this.markId=void 0;const s=e.shapeId&&this.editor.getShape(e.shapeId);if(s&&r.shiftKey){this.markId=`creating:${s.id}`,this.editor.mark(this.markId),this.shape=s;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(p=>p.type==="vertex").sort(bn),c=a[a.length-1],l=a[a.length-2],u=de.applyToPoint(this.editor.getShapeParentTransform(this.shape),new k(this.shape.x,this.shape.y)),d=k.Sub(i,u).addXY(.1,.1),h=ft(this.shape.props.points);if(k.DistMin(c,l,cO)||k.DistMin(d,c,cO))h[c.id]={id:c.id,index:c.index,x:d.x,y:d.y};else{const p=Hr(c.index);h[p]={id:p,index:p,x:d.x,y:d.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:h}}])}else{const o=it();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=rn(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};class Noe extends Ee{static id="line";static initial="idle";static children=()=>[Ooe,Doe];shapeType="line"}let Loe=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};function dt(n,e){const r=new Set;for(const s of e){const o=n.getShape(s);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&r.add(o);const a=n.getShape(o.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&r.add(a)}const i=new Map;for(const s of r){const o=E$(n,s);o.length&&i.set(s,o)}for(const[s,o]of i){const a=n.getShapeUtil(s),c=Be(o.map(l=>n.getShape(l)));a.onDragShapesOut?.(s,c)}}function E$(n,e){const r=n.getSortedChildIdsForParent(e.id);if(r.length===0)return[];const i=n.getShapePageBounds(e);if(!i)return[];let s,o,a;const c=[];for(const l of r){const u=n.getShapePageBounds(l);if(!u)continue;if(!i.includes(u)){c.push(l);continue}s??=n.getShapeGeometry(e),o??=n.getShapePageTransform(e),a??=o.applyToPoints(s.vertices);const d=n.getShapePageTransform(l).clone().invert().applyToPoints(a),{vertices:h,isClosed:p}=n.getShapeGeometry(l);if(!h.some(g=>ar(g,d))){if(p){if(Yz(d,h))continue}else if(Sre(d,h))continue;c.push(l)}}return c}function fh(n,e,r=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),r&&n.emit("select-all-text",{shapeId:e.id}),k$(n)}const Foe=16;function k$(n){const e=n.getSelectionPageBounds(),r=n.getViewportPageBounds();if(e&&!r.contains(e)){const i=e.clone().expandBy(Foe/n.getZoomLevel()).expand(r),s=r.clone().translate({x:(i.center.x-r.center.x)*2,y:(i.center.y-r.center.y)*2});n.zoomToBounds(s,{animation:{duration:n.options.animationMediumMs},inset:0})}}const zoe=0,ot=200,Tf=new k(ot/2,ot/2),T$=10,$oe=n=>[[["a1"],new k(ot*.5,ot*-.5-n.options.adjacentShapeMargin)],[["a2"],new k(ot*1.5+n.options.adjacentShapeMargin,ot*.5)],[["a3"],new k(ot*.5,ot*1.5+n.options.adjacentShapeMargin)],[["a4"],new k(ot*-.5-n.options.adjacentShapeMargin,ot*.5)]];function Boe(n,e){if(e===1)return $oe(n);const r=ot*e,i=n.options.adjacentShapeMargin*e;return[[["a1"],new k(r*.5,r*-.5-i)],[["a2"],new k(r*1.5+i,r*.5)],[["a3"],new k(r*.5,r*1.5+i)],[["a4"],new k(r*-.5-i,r*.5)]]}function M$(n,e,r,i,s,o){return Object.fromEntries(Boe(n,o).map(([a,c],l)=>{const u=c.clone();return l===0&&s?u.y-=s:l===2&&i&&(u.y+=i),[a,u.rot(r).add(e)]}))}function A$(n,e,r,i){const s=new Set(n.getSelectedShapeIds()),o=(ot+n.options.adjacentShapeMargin+i)**2,a=new Map,c=[];for(const d of n.getCurrentPageShapes()){if(!n.isShapeOfType(d,"note")||r!==d.props.scale||s.has(d.id))continue;const h=n.getShapePageTransform(d.id);e===h.rotation()&&(a.set(d,n.getShapePageBounds(d).center),c.push(...Object.values(M$(n,h.point(),e,d.props.growY,i,r))))}const l=c.length;let u;for(const[d,h]of a)for(let p=0;p<l;p++)u=c[p],u&&(k.Dist2(h,u)>o||n.isPointInShape(d,u)&&(c[p]=void 0));return Be(c)}function j$(n,e,r,i,s=!1){let o;const a=n.getCurrentPageShapesSorted(),c=(ot+n.options.adjacentShapeMargin**2)**e.props.scale;for(let l=a.length-1;l>=0;l--){const u=a[l];if(u.type==="note"&&u.id!==e.id){const d=n.getShapePageBounds(u);if(d&&k.Dist2(d.center,r)<c&&n.isPointInShape(u,r)){o=u;break}}}if(n.complete(),!o||s){n.mark("creating note shape");const l=it();n.createShape({id:l,type:"note",x:r.x,y:r.y,rotation:i,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const u=n.getShape(l);if(!u)return;const d=n.getPointInParentSpace(u,k.Sub(r,k.Rot(Tf.clone().mul(u.props.scale),i)));n.updateShape({id:l,type:"note",x:d.x,y:d.y}),o=n.getShape(l)}return k$(n),o}let Uoe=class extends Ee{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{const{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){const r=it();this.markId=`creating:${r}`,e.mark(this.markId);const i=this.editor.inputs.originPagePoint.clone(),s=lO(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=uO(this.editor,r,i)}};onPointerMove=e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const r=it(),i=this.editor.inputs.originPagePoint.clone(),s=lO(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=uO(this.editor,r,i)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};function lO(n,e,r){let i=T$/n.getZoomLevel(),s;for(const o of A$(n,0,r,0)){const a=k.Sub(e,o),c=a.len();c<i&&(i=c,s=a)}return s}function uO(n,e,r){n.createShape({id:e,type:"note",x:r.x,y:r.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const i=n.getShape(e),s=n.getShapeGeometry(i).bounds;return n.updateShapes([{id:e,type:"note",x:i.x-s.width/2,y:i.y-s.height/2}]),n.getShape(e)}class qoe extends Ee{static id="note";static initial="idle";static children=()=>[Loe,Uoe];shapeType="note"}function Hoe(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let r;const i=n.getOutermostSelectableShape(e);return i===e||i.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(i.id)?r=e:r=i,n.setHoveredShape(r.id)}const Vi=GL(Hoe,32);let Goe=class extends Ee{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":Vi(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onExit=()=>{Vi.cancel()};onKeyDown=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:r}))}};onCancel=()=>{this.editor.setCurrentTool("select")}},Koe=class extends Ee{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:r}}=this.editor,i=it();this.markId=`creating:${i}`,this.editor.mark(this.markId);const s=this.createTextShape(i,r,!1);if(!s){this.cancel();return}this.shape=this.editor.getShape(s),this.editor.select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(s.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");const e=it(),{currentPagePoint:r}=this.editor.inputs;this.createTextShape(e,r,!0)&&(this.editor.select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.getCurrent()?.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,r,i){this.editor.createShape({id:e,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:i,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(e);if(!s){this.cancel();return}const o=this.editor.getShapePageBounds(s),a=new k;if(i)switch(s.props.textAlign){case"start":{a.x=0;break}case"middle":{a.x=-o.width/2;break}case"end":{a.x=-o.width;break}}else a.x=0;if(a.y=-o.height/2,zn(s.parentId)){const c=this.editor.getShapeParentTransform(s);a.rot(-c.rotation())}return this.editor.updateShape({...s,x:s.x+a.x,y:s.y+a.y}),s}};class Voe extends Ee{static id="text";static initial="idle";static children=()=>[Goe,Koe];static isLockable=!1;shapeType="text"}const Woe=[Voe,Eoe,joe,qoe,Noe,koe,Ioe,Roe];function Dr(){return ds({isDarkMode:uu()})}function Mf(n){return{key:`${Si.id}:${n}`,getElement:async()=>{const e=Yoe(n);if(!e)return null;const r=e.$$_url,i=e.$$_fontface;if(!r||!i)return null;const s=await(await bi(r)).blob(),o=await mo.blobToDataUrl(s),a=i.replace(r,o);return f.jsx("style",{children:a})}}}function Yoe(n){const e=CF[n];for(const r of document.fonts)if(e.includes(r.family))return r;return null}function Z_(n){return{key:`${Si.id}:${n}`,getElement:async()=>n!=="pattern"?null:f.jsx(Xoe,{})}}function Xoe(){const n=Dr(),e=8/12;return f.jsxs(f.Fragment,{children:[f.jsxs("mask",{id:"hash_pattern_mask",children:[f.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),f.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[f.jsx("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),f.jsx("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),f.jsx("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),f.jsx("pattern",{id:ph(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:f.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:"url(#hash_pattern_mask)"})})]})}function Q_(){return{key:`${Si.id}:pattern`,component:eae}}const qc=8,dO=(n,e,r)=>new Promise((i,s)=>{const o=qc*e*n,a=document.createElement("canvas");a.width=o,a.height=o;const c=a.getContext("2d");if(!c)return;c.fillStyle=r?Jd.darkMode.solid:Jd.lightMode.solid,c.fillRect(0,0,o,o),c.globalCompositeOperation="destination-out",c.lineCap="round",c.lineWidth=1.25*e*n;const l=8/12,u=d=>d*e*n;c.beginPath(),c.moveTo(u(l*1),u(l*3)),c.lineTo(u(l*3),u(l*1)),c.moveTo(u(l*5),u(l*7)),c.lineTo(u(l*7),u(l*5)),c.moveTo(u(l*9),u(l*11)),c.lineTo(u(l*11),u(l*9)),c.stroke(),a.toBlob(d=>{!d||Dt.throwToBlob.get()?s():i(d)})}),hO=(n,e)=>{const r=document.createElement("canvas");r.width=n[0],r.height=n[1];const i=r.getContext("2d");return i?(e(i),r.toDataURL()):""};let IS=null;function Zoe(){return IS||(IS={white:hO([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:hO([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),IS}function R$(n){return Math.ceil(Math.log2(Math.max(1,n)))}function ph(n,e){const r=R$(n);return`tldraw_hash_pattern_${e}_${r}`}function O$(n){const e=[],i=R$(n);for(let s=0;s<=i;s++)e.push(Math.pow(2,s));return e}function Qoe(n){const e=Zoe();return O$(n).flatMap(r=>[{zoom:r,url:e.white,theme:"light"},{zoom:r,url:e.black,theme:"dark"}])}function Joe(){const n=Z(),e=ne("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),r=ne("maxZoom",()=>Math.ceil(rn(n.getCameraOptions().zoomSteps)),[n]),[i,s]=E.useState(!1),[o,a]=E.useState(()=>Qoe(r));return E.useEffect(()=>{const l=Promise.all(O$(r).flatMap(d=>[dO(e,d,!1).then(h=>({zoom:d,theme:"light",url:URL.createObjectURL(h)})),dO(e,d,!0).then(h=>({zoom:d,theme:"dark",url:URL.createObjectURL(h)}))]));let u=!1;return l.then(d=>{u||(a(d),s(!0))}),()=>{u=!0,s(!1),l.then(d=>{for(const{url:h}of d)URL.revokeObjectURL(h)})}},[e,r]),{defs:f.jsx(f.Fragment,{children:o.map(l=>{const u=ph(l.zoom,l.theme);return f.jsx("pattern",{id:u,width:qc,height:qc,patternUnits:"userSpaceOnUse",children:f.jsx("image",{href:l.url,width:qc,height:qc})},u)})}),isReady:i}}function eae(){const n=Z(),e=E.useRef(null),{defs:r,isReady:i}=Joe();return E.useEffect(()=>{if(i&&n.environment.isSafari){const s=D$(e.current);s&&n.timers.requestAnimationFrame(()=>{s.style.display="none",n.timers.requestAnimationFrame(()=>{s.style.display=""})})}},[n,i]),f.jsx("g",{ref:e,"data-testid":i?"ready-pattern-fill-defs":void 0,children:r})}function D$(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?D$(n.parentElement):null}const mn=nt.memo(function({theme:e,d:r,color:i,fill:s,scale:o}){switch(s){case"none":return null;case"solid":return f.jsx("path",{fill:e[i].semi,d:r});case"semi":return f.jsx("path",{fill:e.solid,d:r});case"fill":return f.jsx("path",{fill:e[i].fill,d:r});case"pattern":return f.jsx(tae,{theme:e,color:i,fill:s,d:r,scale:o})}});function tae({d:n,color:e,theme:r}){const i=Z(),s=e$(),o=ne("zoomLevel",()=>i.getZoomLevel(),[i]),a=i.getZoomLevel()<=.18;return f.jsxs(f.Fragment,{children:[f.jsx("path",{fill:r[e].pattern,d:n}),f.jsx("path",{fill:s?`url(#${ph(1,r.id)})`:a?r[e].semi:`url(#${ph(o,r.id)})`,d:n})]})}function nae(n){return n.replace(/\s/g,"")}function Aw(n,e,r){const{padding:i=0}=r;if(e.length===0)return null;const s=pe.From(e[0].box);for(const{box:u}of e)s.union(u);const o=i+(r.offsetX??0),a=(r.offsetY??0)+r.fontSize/2+(r.verticalTextAlign==="start"?i:r.verticalTextAlign==="end"?r.height-i-s.height:(Math.ceil(r.height)-s.height)/2);let c=null;const l=[];for(const{text:u,box:d}of e)c!==null&&d.y>c&&l.push(f.jsx("tspan",{alignmentBaseline:"mathematical",x:o,y:d.y+a,children:`
`},l.length)),l.push(f.jsx("tspan",{alignmentBaseline:"mathematical",x:d.x+o,y:d.y+a,unicodeBidi:"plaintext",children:nae(u)},l.length)),c=d.y;return f.jsx("text",{fontSize:r.fontSize,fontFamily:r.fontFamily,fontStyle:r.fontStyle,fontWeight:r.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:r.stroke,strokeWidth:r.strokeWidth,fill:r.fill,children:l})}function rae(n,e,r,i){if((n==="start-legacy"||n==="end-legacy")&&r.length!==0){const s=pe.From(r[0].box);for(const{box:o}of r)s.union(o);if(n==="start-legacy")return(i-2*e-s.width)/2;if(n==="end-legacy")return-(i-2*e-s.width)/2}}function iae(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Af({fontSize:n,font:e,align:r,verticalAlign:i,text:s,labelColor:o,bounds:a,padding:c=16,stroke:l=!0}){const u=Z(),d=Dr(),h={fontSize:n,fontFamily:CF[e],textAlign:r,verticalTextAlign:i,width:Math.ceil(a.width),height:Math.ceil(a.height),padding:c,lineHeight:cn.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:o,stroke:void 0,strokeWidth:void 0},p=u.textMeasure.measureTextSpans(s,h),g=rae(r,c,p,a.width);g&&(h.offsetX=g),h.offsetX+=a.x,h.offsetY+=a.y;const y=Aw(u,p,h);let v=null;return l&&(h.fill=d.background,h.stroke=d.background,h.strokeWidth=2,v=Aw(u,p,h)),f.jsxs(f.Fragment,{children:[v,y]})}const sae=E.forwardRef(function({isEditing:e,text:r,handleFocus:i,handleChange:s,handleKeyDown:o,handleBlur:a,handleInputPointerDown:c,handleDoubleClick:l},u){return f.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:r,onFocus:i,onChange:s,onKeyDown:o,onBlur:a,onTouchEnd:Xt,onContextMenu:e?Xt:void 0,onPointerDown:c,onDoubleClick:l,onDragStart:We})});function oae(n,e,r){const i=Z(),s=E.useRef(null),o=ne("isEditing",()=>i.getEditingShapeId()===n,[i]),a=ne("isEditingAnything",()=>!!i.getEditingShapeId(),[i]);E.useEffect(()=>{function d({shapeId:h}){h===n&&s.current?.select()}return i.on("select-all-text",d),()=>{i.off("select-all-text",d)}},[i,n,o]),E.useEffect(()=>{o&&(document.activeElement!==s.current&&s.current?.focus(),i.getInstanceState().isCoarsePointer&&s.current?.select(),i.environment.isSafari&&(s.current?.blur(),s.current?.focus()))},[i,o]);const c=E.useCallback(d=>{if(i.getEditingShapeId()===n)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&i.complete();break}}},[i,n]),l=E.useCallback(d=>{if(i.getEditingShapeId()!==n)return;let h=tn.normalizeText(d.currentTarget.value);const p=h.replace(/\t/g,ga);if(p!==h){const g=d.currentTarget.selectionStart;d.currentTarget.value=p,d.currentTarget.selectionStart=g+(p.length-h.length),d.currentTarget.selectionEnd=g+(p.length-h.length),h=p}i.updateShape({id:n,type:e,props:{text:h}})},[i,n,e]),u=E.useCallback(d=>{i.dispatch({...Gn(d),type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(n)}),Xt(d)},[i,n]);return{rInput:s,handleFocus:Sl,handleBlur:Sl,handleKeyDown:c,handleChange:l,handleInputPointerDown:u,handleDoubleClick:Xt,isEmpty:r.trim().length===0,isEditing:o,isEditingAnything:a}}const jf=nt.memo(function({id:e,type:r,text:i,labelColor:s,font:o,fontSize:a,lineHeight:c,align:l,verticalAlign:u,wrap:d,isSelected:h,padding:p=0,onKeyDown:g,classNamePrefix:y,style:v,textWidth:x,textHeight:m}){const{rInput:b,isEmpty:S,isEditing:w,isEditingAnything:I,...C}=oae(e,r,i),[_,P]=E.useState(i);E.useEffect(()=>{w||P(i)},[w,i]);const M=tn.normalizeTextForDom(i),T=M.length>0,A=iae(l);if(!w&&!T)return null;const R=y||"tl-text";return f.jsx("div",{className:`${R}-label tl-text-wrapper`,"data-font":o,"data-align":l,"data-hastext":!S,"data-isediting":w,"data-iseditinganything":I,"data-textwrap":!!d,"data-isselected":h,style:{justifyContent:l==="middle"||A?"center":l,alignItems:u==="middle"?"center":u,padding:p,...v},children:f.jsxs("div",{className:`${R}-label__inner tl-text-content__wrapper`,style:{fontSize:a,lineHeight:Math.floor(a*c)+"px",minHeight:Math.floor(a*c)+"px",minWidth:Math.ceil(x||0),color:s,width:x?Math.ceil(x):void 0,height:m?Math.ceil(m):void 0},children:[f.jsx("div",{className:`${R} tl-text tl-text-content`,dir:"auto",children:M.split(`
`).map((O,j)=>f.jsx("div",{dir:"auto",children:O},j))}),(I||h)&&f.jsx(sae,{ref:b,text:i,isEditing:w,...C,handleKeyDown:g??C.handleKeyDown},_)]})})});function li(n,e,r={}){const{closed:i=!1,snap:s=1,start:o="outset",end:a="outset",lengthRatio:c=2,style:l="dashed"}=r;let u=0,d=0,h=1,p=0,g=0;switch(l){case"dashed":{h=1,u=Math.min(e*c,n/4);break}case"dotted":{h=100,u=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return i||(o==="outset"?(n+=u/2,g+=u/2):o==="skip"&&(n-=u,g-=u),a==="outset"?n+=u/2:a==="skip"&&(n-=u)),d=Math.floor(n/u/(2*h)),d-=d%s,d<3&&l==="dashed"?n/e<4?(u=n,d=1,p=0):(u=n*(1/3),p=n*(1/3)):(u=n/d/(2*h),i?(g=u/2,p=(n-d*u)/d):p=(n-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,p].join(" "),strokeDashoffset:g.toString()}}const fO=new WeakMap;function J_(n,e){const r=fO.get(e);if(r)return r;const i=fi(n,e);let s=0,o=0;const a=i.isStraight?new Ki({start:k.From(i.start.point),end:k.From(i.end.point)}):new da({center:k.Cast(i.handleArc.center),start:k.Cast(i.start.point),end:k.Cast(i.end.point),sweepFlag:i.bodyArc.sweepFlag,largeArcFlag:i.bodyArc.largeArcFlag});if(e.props.text.trim()){const l=a.bounds,u=jw(e),{w:d,h}=n.textMeasure.measureText(e.props.text,{...cn,fontFamily:vi[e.props.font],fontSize:u,maxWidth:null});if(s=d,o=h,l.width>l.height){s=Math.max(Math.min(d,64),Math.min(l.width-64,d));const{w:p,h:g}=n.textMeasure.measureText(e.props.text,{...cn,fontFamily:vi[e.props.font],fontSize:u,maxWidth:s});s=p,o=g}if(s>16*u){s=16*u;const{w:p,h:g}=n.textMeasure.measureText(e.props.text,{...cn,fontFamily:vi[e.props.font],fontSize:u,maxWidth:s});s=p,o=g}}const c=new k(s,o).addScalar(Yse*2*e.props.scale);return fO.set(e,c),c}function N$(n){const e=Yt[n.props.size];return(Wse+(e-Yt.s)*2+(e===Yt.xl?20:0))*n.props.scale}function aae(n,e,r){const i=J_(n,e),s=N$(e),o=k.Nudge(r.start.point,r.end.point,s),a=k.Nudge(r.end.point,r.start.point,s),c=z_(o,a,pe.FromCenter(r.middle,i).corners);if(!c||c.length!==2)return{start:.5,end:.5};let[l,u]=c;k.Dist2(l,o)>k.Dist2(u,o)&&([u,l]=c);const d=o.add(k.Sub(r.middle,l)),h=a.add(k.Sub(r.middle,u)),p=k.Dist(r.start.point,d)/r.length,g=k.Dist(r.start.point,h)/r.length;return{start:p,end:g}}function cae(n,e,r){const i=J_(n,e),s=N$(e),o=Math.sign(e.props.bend),a=s/r.handleArc.radius*o,c=k.Angle(r.bodyArc.center,r.start.point)-a,l=k.Angle(r.bodyArc.center,r.end.point)+a,u=ko(r.bodyArc.center,r.bodyArc.radius,c),d=ko(r.bodyArc.center,r.bodyArc.radius,l),h=[],p=pO(r.bodyArc.center,r.bodyArc.radius,c,l,o,pe.FromCenter(u,i).corners);h.push(new Ot({points:pe.FromCenter(u,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const g=pO(r.bodyArc.center,r.bodyArc.radius,c,l,o,pe.FromCenter(d,i).corners);h.push(new Ot({points:pe.FromCenter(d,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const _ of[...p??[],...g??[],u,d])h.push(new W_({x:_.x-3,y:_.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const y=(p&&gO(r.start.point,p))??r.middle,v=(g&&gO(r.end.point,g))??r.middle,x=k.Angle(r.bodyArc.center,r.start.point),m=k.Angle(r.bodyArc.center,r.end.point),b=k.Angle(r.bodyArc.center,y),S=k.Angle(r.bodyArc.center,v);if(Is(x,b,o)>Is(x,S,o))return{start:.5,end:.5,dbg:h};const w=Is(x,m,o),I=Is(x,b,o)/w,C=Is(x,S,o)/w;return{start:I,end:C,dbg:h}}function Ad(n,e){let r;const i=[],s=fi(n,e),o=!!s.bindings.start,a=!!s.bindings.end,c=s.start.arrowhead!=="none",l=s.end.arrowhead!=="none";if(s.isStraight){const d=aae(n,e,s);let h=Ht(e.props.labelPosition,c||o?d.start:0,l||a?d.end:1);h=h>=.48&&h<=.52?.5:h,r=k.Lrp(s.start.point,s.end.point,h)}else{const d=cae(n,e,s);d.dbg&&i.push(...d.dbg);let h=Ht(e.props.labelPosition,c||o?d.start:0,l||a?d.end:1);h=h>=.48&&h<=.52?.5:h;const p=lae(k.Angle(s.bodyArc.center,s.start.point),k.Angle(s.bodyArc.center,s.end.point),Math.sign(e.props.bend),h);r=ko(s.bodyArc.center,s.bodyArc.radius,p)}const u=J_(n,e);return{box:pe.FromCenter(r,u),debugGeom:i}}function pO(n,e,r,i,s,o){const a=Cw(n,e,o),c=Is(r,i,s);return a?.filter(l=>{const u=Is(r,k.Angle(n,l),s);return u>=0&&u<=c})}function gO(n,e){let r=null,i=-1/0;for(const s of e){const o=k.Dist2(n,s);o>i&&(r=s,i=o)}return r}function lae(n,e,r,i){const s=Is(n,e,r);return n+s*i*r*-1}function jw(n){return Vse[n.props.size]*n.props.scale}function uae(n,e,r){const i=e==="end"?n.end.point:n.start.point,s=e==="end"?n.start.point:n.end.point,o=n.isStraight?k.Dist(s,i):Math.abs(n.bodyArc.length),a=Math.max(Math.min(o/5,r*3),r);let c;if(n.isStraight)c=k.Nudge(i,s,a);else{const l=xre(i,a,n.handleArc.center,n.handleArc.radius);c=e==="end"?n.handleArc.sweepFlag?l[0]:l[1]:n.handleArc.sweepFlag?l[1]:l[0]}return k.IsNaN(c)&&(c=n.start.point),{point:i,int:c}}function dae({point:n,int:e}){const r=k.RotWith(e,n,Je/6),i=k.RotWith(e,n,-Je/6);return`M ${r.x} ${r.y} L ${n.x} ${n.y} L ${i.x} ${i.y}`}function hae({point:n,int:e}){const r=k.RotWith(e,n,Je/6),i=k.RotWith(e,n,-Je/6);return`M ${r.x} ${r.y} L ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function fae({point:n,int:e}){const r=k.Sub(e,n).div(2),i=k.Add(n,k.Rot(r,pt)),s=k.Sub(n,k.Rot(r,pt));return`M ${i.x} ${i.y} L ${e.x} ${e.y} L ${s.x} ${s.y} Z`}function pae({point:n,int:e}){const r=k.Lrp(n,e,.45),i=k.Dist(r,n);return`M ${r.x-i},${r.y}
  a ${i},${i} 0 1,0 ${i*2},0
  a ${i},${i} 0 1,0 -${i*2},0 `}function gae({point:n,int:e}){const r=k.Lrp(n,e,.75),i=k.RotWith(r,n,Je/4),s=k.RotWith(r,n,-Je/4),o=k.Lrp(i,s,.5);return o.add(k.Sub(o,n)),`M ${o.x} ${o.y} L ${i.x} ${i.y} ${n.x} ${n.y} L ${s.x} ${s.y} Z`}function mae({int:n,point:e}){const r=k.Lrp(e,n,.85),i=k.Sub(r,e).div(2),s=k.Add(e,k.Rot(i,pt)),o=k.Sub(e,k.Rot(i,pt)),a=k.Add(r,k.Rot(i,pt)),c=k.Sub(r,k.Rot(i,pt));return`M ${s.x} ${s.y} L ${a.x} ${a.y} L ${c.x} ${c.y} L ${o.x} ${o.y} Z`}function yae({int:n,point:e}){const r=k.Sub(n,e).div(2),i=k.Add(e,k.Rot(r,pt)),s=k.Sub(e,k.Rot(r,pt));return`M ${i.x} ${i.y} L ${s.x} ${s.y}`}function gh(n,e,r){const i=e==="end"?n.end.arrowhead:n.start.arrowhead;if(i==="none")return;const s=uae(n,e,r);if(s){switch(i){case"bar":return yae(s);case"square":return mae(s);case"diamond":return gae(s);case"dot":return pae(s);case"inverted":return fae(s);case"arrow":return dae(s);case"triangle":return hae(s)}return""}}function vae(n){const{start:e,end:r,handleArc:{radius:i,largeArcFlag:s,sweepFlag:o}}=n;return`M${e.handle.x},${e.handle.y} A${i} ${i} 0 ${s} ${o} ${r.handle.x},${r.handle.y}`}function L$(n){const{start:e,end:r,bodyArc:{radius:i,largeArcFlag:s,sweepFlag:o}}=n;return`M${e.point.x},${e.point.y} A${i} ${i} 0 ${s} ${o} ${r.point.x},${r.point.y}`}function F$(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function xae(n){return F$(n.start.handle,n.end.handle)}function z$(n){return F$(n.start.point,n.end.point)}let bae=0;class Sae extends Gs{static type="arrow";static props=IF;static migrations=EF;canEdit=()=>!0;canBind({toShapeType:e}){return e!=="arrow"}canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;canBeLaidOut=e=>{const r=Un(this.editor,e);return!r.start&&!r.end};getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const r=fi(this.editor,e),i=[],s=r.isStraight?new Ki({start:k.From(r.start.point),end:k.From(r.end.point)}):new da({center:k.Cast(r.handleArc.center),start:k.Cast(r.start.point),end:k.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(e.props.text.trim()){const a=Ad(this.editor,e);i.push(...a.debugGeom),o=new ns({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Qr({children:[...o?[s,o]:[s],...i]})}getHandles(e){const r=fi(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}onHandleDrag=(e,{handle:r,isPrecise:i})=>{const s=r.id,o=Un(this.editor,e);if(s==="middle"){const{start:I,end:C}=ha(this.editor,e,o),_=k.Sub(C,I),P=k.Per(_),M=k.Med(C,I),T=k.Sub(M,P),A=k.Add(M,P),R=k.NearestPointOnLineSegment(T,A,r,!1);let O=k.Dist(R,M);return k.Clockwise(R,C,M)&&(O*=-1),{id:e.id,type:e.type,props:{bend:O}}}const a={id:e.id,type:"arrow",props:{}},c=o[s],u=o[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Md(this.editor,e,s),a.props[s]={x:r.x,y:r.y},a;const d=this.editor.getShapePageTransform(e.id).applyToPoint(r),h=this.editor.getShapeAtPoint(d,{hitInside:!0,hitFrameInside:!0,margin:0,filter:I=>!I.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:I,binding:"arrow"})});if(!h)return Md(this.editor,e,s),a.props[s]={x:r.x,y:r.y},a;const p=this.editor.getShapeGeometry(h),g=pe.ZeroFix(p.bounds),v=this.editor.getShapePageTransform(a.id).applyToPoint(r),x=this.editor.getPointInShapeSpace(h,v);let m=i;m||(!c||c&&h.id!==c.toId)&&(m=this.editor.inputs.pointerVelocity.len()<.5),i||(p.isClosed||(m=!0),u&&h.id===u.toId&&u.props.isPrecise&&(m=!0));const b={x:(x.x-g.minX)/g.width,y:(x.y-g.minY)/g.height};m&&k.Dist(x,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(b.x=.5,b.y=.5);const S={terminal:s,normalizedAnchor:b,isPrecise:m,isExact:this.editor.inputs.altKey};vc(this.editor,e,h.id,S),this.editor.setHintingShapes([h.id]);const w=Un(this.editor,e);return w.start&&w.end&&w.start.toId===w.end.toId&&k.Equals(w.start.props.normalizedAnchor,w.end.props.normalizedAnchor)&&vc(this.editor,e,w.end.toId,{...w.end.props,normalizedAnchor:{x:w.end.props.normalizedAnchor.x+.05,y:w.end.props.normalizedAnchor.y}}),a};onTranslateStart=e=>{const r=Un(this.editor,e),i=ha(this.editor,e,r),s=this.editor.getShapePageTransform(e.id),o=this.editor.getSelectedShapeIds();if(!(r.start&&(o.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(o.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){yO.set(e,{pagePosition:s.applyToPoint(e),terminalBindings:tu(i,(a,c)=>{const l=r[a];return l?{binding:l,shapePosition:c,pagePosition:s.applyToPoint(c)}:null})}),r.start&&(hh({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),r.end&&hh({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=r[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}};onTranslate=(e,r)=>{const i=yO.get(e);if(!i)return;const s=this.editor.getShapePageTransform(r.id),o=k.Sub(s.applyToPoint(r),i.pagePosition);for(const a of Object.values(i.terminalBindings)){if(!a)continue;const c=k.Add(a.pagePosition,k.Mul(o,.5)),l=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:u,binding:"arrow"})});if(l?.id===a.binding.toId){const u=pe.ZeroFix(this.editor.getShapeGeometry(l).bounds),d=this.editor.getPointInShapeSpace(l,c),h={x:(d.x-u.minX)/u.width,y:(d.y-u.minY)/u.height};vc(this.editor,r,l.id,{...a.binding.props,normalizedAnchor:h,isPrecise:!0})}else Md(this.editor,r,a.binding.props.terminal)}};_resizeInitialBindings=new es;onResize=(e,r)=>{const{scaleX:i,scaleY:s}=r,o=this._resizeInitialBindings.get(e,()=>Un(this.editor,e)),a=ha(this.editor,e,o),{start:c,end:l}=ft(e.props);let{bend:u}=e.props;o.start||(c.x=a.start.x*i,c.y=a.start.y*s),o.end||(l.x=a.end.x*i,l.y=a.end.y*s);const d=Math.abs(i),h=Math.abs(s),p=o?.start?k.From(o.start.props.normalizedAnchor):null,g=o?.end?k.From(o.end.props.normalizedAnchor):null;return i<0&&s>=0?(u!==0&&(u*=-1,u*=Math.max(d,h)),p&&(p.x=1-p.x),g&&(g.x=1-g.x)):i>=0&&s<0?(u!==0&&(u*=-1,u*=Math.max(d,h)),p&&(p.y=1-p.y),g&&(g.y=1-g.y)):i>=0&&s>=0?u!==0&&(u*=Math.max(d,h)):i<0&&s<0&&(u!==0&&(u*=Math.max(d,h)),p&&(p.x=1-p.x,p.y=1-p.y),g&&(g.x=1-g.x,g.y=1-g.y)),o.start&&p&&vc(this.editor,e,o.start.toId,{...o.start.props,normalizedAnchor:p.toJson()}),o.end&&g&&vc(this.editor,e,o.end.toId,{...o.end.props,normalizedAnchor:g.toJson()}),{props:{start:c,end:l,bend:u}}};onDoubleClickHandle=(e,r)=>{switch(r.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}};component(e){const r=Dr(),i=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly;if(!fi(this.editor,e)?.isValid)return null;const a=Ad(this.editor,e),c=e.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===e.id||e.props.text;return f.jsxs(f.Fragment,{children:[f.jsx($s,{id:e.id,style:{minWidth:50,minHeight:50},children:f.jsx(mO,{shape:e,shouldDisplayHandles:s&&i?.id===e.id})}),u&&f.jsx(jf,{id:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:jw(e),lineHeight:cn.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:r[e.props.labelColor].solid,textWidth:a.box.w,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(e){const r=Ef(e.id),i=fi(this.editor,e);if(!i)return null;const{start:s,end:o}=ha(this.editor,e,i?.bindings),a=this.editor.getShapeGeometry(e),c=a.bounds,l=e.props.text.trim()?a.children[1]:null;if(k.Equals(s,o))return null;const u=Yt[e.props.size]*e.props.scale,d=i.start.arrowhead&&gh(i,"start",u),h=i.end.arrowhead&&gh(i,"end",u),p=i.isStraight?z$(i):L$(i),g=d&&i.start.arrowhead!=="arrow"||h&&i.end.arrowhead!=="arrow"||!!l,y=(e.id+"_clip").replace(":","_");return r&&l?f.jsx("rect",{x:W(l.x),y:W(l.y),width:l.w,height:l.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale}):f.jsxs("g",{children:[g&&f.jsx("defs",{children:f.jsxs("mask",{id:y,children:[f.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.w+200,height:c.h+200,fill:"white"}),l&&f.jsx("rect",{x:W(l.x),y:W(l.y),width:l.w,height:l.h,fill:"black",rx:3.5*e.props.scale,ry:3.5*e.props.scale}),d&&f.jsx("path",{d,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&f.jsx("path",{d:h,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),f.jsxs("g",{...g?{mask:`url(#${y})`}:void 0,children:[g&&f.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),f.jsx("path",{d:p})]}),d&&f.jsx("path",{d}),h&&f.jsx("path",{d:h}),l&&f.jsx("rect",{x:W(l.x),y:W(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{const{id:r,type:i,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])};toSvg(e,r){r.addExportDef(Z_(e.props.fill)),e.props.text&&r.addExportDef(Mf(e.props.font));const i=ds(r),s=1/e.props.scale;return f.jsxs("g",{transform:`scale(${s})`,children:[f.jsx(mO,{shape:e,shouldDisplayHandles:!1}),f.jsx(Af,{fontSize:jw(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:i[e.props.labelColor].solid,bounds:Ad(this.editor,e).box,padding:4*e.props.scale})]})}getCanvasSvgDefs(){return[Q_(),{key:"arrow:dot",component:_ae},{key:"arrow:cross",component:Cae}]}getInterpolatedProps(e,r,i){return{...r.props,start:{x:$n(e.props.start.x,r.props.start.x,i),y:$n(e.props.start.y,r.props.start.y,i)},end:{x:$n(e.props.end.x,r.props.end.x,i),y:$n(e.props.end.y,r.props.end.y,i)},bend:$n(e.props.bend,r.props.bend,i),labelPosition:$n(e.props.labelPosition,r.props.labelPosition,i)}}}function wae(n,e){const r=fi(n,e);return r.isStraight?k.Dist(r.start.handle,r.end.handle):Math.abs(r.handleArc.length)}const mO=Qt(function({shape:e,shouldDisplayHandles:r}){const i=Z(),s=Dr(),o=fi(i,e),a=pe.ZeroFix(i.getShapeGeometry(e).bounds),c=Un(i,e),l=nt.useMemo(()=>i.environment.isSafari?bae+=1:0,[e]);if(!o?.isValid)return null;const u=Yt[e.props.size]*e.props.scale,d=o.start.arrowhead&&gh(o,"start",u),h=o.end.arrowhead&&gh(o,"end",u),p=o.isStraight?z$(o):L$(o);let g=null;if(r){const w=2/i.getZoomLevel(),{strokeDasharray:I,strokeDashoffset:C}=li(wae(i,e),w,{end:"skip",start:"skip",lengthRatio:2.5});g=c.start||c.end?f.jsx("path",{className:"tl-arrow-hint",d:o.isStraight?xae(o):vae(o),strokeDasharray:I,strokeDashoffset:C,strokeWidth:w,markerStart:c.start?c.start.props.isExact?"":c.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:c.end?c.end.props.isExact?"":c.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:y,strokeDashoffset:v}=li(o.isStraight?o.length:Math.abs(o.bodyArc.length),u,{style:e.props.dash}),x=Ad(i,e),m=!(o.start.arrowhead==="none"||o.start.arrowhead==="arrow"),b=!(o.end.arrowhead==="none"||o.end.arrowhead==="arrow"),S=(e.id+"_clip_"+l).replace(":","_");return f.jsxs(f.Fragment,{children:[f.jsx("defs",{children:f.jsxs("mask",{id:S,children:[f.jsx("rect",{x:W(-100+a.minX),y:W(-100+a.minY),width:W(a.width+200),height:W(a.height+200),fill:"white"}),e.props.text.trim()&&f.jsx("rect",{x:x.box.x,y:x.box.y,width:x.box.w,height:x.box.h,fill:"black",rx:4,ry:4}),d&&m&&f.jsx("path",{d,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&b&&f.jsx("path",{d:h,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),f.jsxs("g",{fill:"none",stroke:s[e.props.color].solid,strokeWidth:u,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[g,f.jsxs("g",{mask:`url(#${S})`,children:[f.jsx("rect",{x:W(a.minX-100),y:W(a.minY-100),width:W(a.width+200),height:W(a.height+200),opacity:0}),f.jsx("path",{d:p,strokeDasharray:y,strokeDashoffset:v})]}),d&&m&&e.props.fill!=="none"&&f.jsx(mn,{theme:s,d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),h&&b&&e.props.fill!=="none"&&f.jsx(mn,{theme:s,d:h,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&f.jsx("path",{d}),h&&f.jsx("path",{d:h})]})]})}),yO=new WeakMap;function _ae(){return f.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:f.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Cae(){return f.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[f.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),f.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const vO="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function ja({url:n,zoomLevel:e}){return f.jsx("a",{className:Me("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Xt,onPointerUp:Xt,title:n,draggable:!1,children:f.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${vO}") center 100% / 100% no-repeat`,WebkitMask:`url("${vO}") center 100% / 100% no-repeat`}})})}const xO="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Pae=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function eC(n){return Pae.map(r=>{const{offsetX:i,offsetY:s,blur:o,spread:a,color:c}=r,l=new k(i,s),{x:u,y:d}=l.rot(-n);return`${u}px ${d}px ${o}px ${a}px ${c}`}).join(", ")}const Iae=300,$$=320,Eae=46,kae=101;class Tae extends Xa{static type="bookmark";static props=RF;static migrations=OF;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:Iae,h:$$,assetId:null}}component(e){const r=e.props.assetId?this.editor.getAsset(e.props.assetId):null,i=this.editor.getShapePageTransform(e).rotation(),s=Mae(e);return f.jsx(To,{children:f.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:eC(i),maxHeight:e.props.h},children:[(!r||r.props.image)&&f.jsxs("div",{className:"tl-bookmark__image_container",children:[r?f.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:r?.props.image,alt:r?.props.title||""}):f.jsx("div",{className:"tl-bookmark__placeholder"}),r?.props.image&&f.jsx(ja,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),f.jsxs("div",{className:"tl-bookmark__copy_container",children:[r?.props.title?f.jsx("h2",{className:"tl-bookmark__heading",children:r.props.title}):null,r?.props.description&&r?.props.image?f.jsx("p",{className:"tl-bookmark__description",children:r.props.description}):null,f.jsxs("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Xt,onPointerUp:Xt,onClick:Xt,children:[r?.props.favicon?f.jsx("img",{className:"tl-bookmark__favicon",src:r?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${s}`}):f.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${xO}") center 100% / 100% no-repeat`,WebkitMask:`url("${xO}") center 100% / 100% no-repeat`}}),f.jsx("span",{children:s})]})]})]})})}indicator(e){return f.jsx("rect",{width:W(e.props.w),height:W(e.props.h),rx:"6",ry:"6"})}onBeforeCreate=e=>bO(this.editor,e);onBeforeUpdate=(e,r)=>{if(e.props.url!==r.props.url)if(lr.isValid(r.props.url))Aae(this.editor,r);else return{...r,props:{...r.props,url:e.props.url}};if(e.props.assetId!==r.props.assetId)return bO(this.editor,r)}}function bO(n,e){const r=e.props.assetId?n.getAsset(e.props.assetId):null;let i=$$;return r&&(r.props.image||(r.props.title?i=kae:i=Eae)),{...e,props:{...e.props,h:i}}}const Mae=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function Aae(n,e){const{url:r}=e.props,i=uo.createId(uw(r));n.getAsset(i)?e.props.assetId!==i&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:i}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),jae(n,e))}const jae=WL(async(n,e)=>{if(n.isDisposed)return;const{url:r}=e.props,i=await n.getAssetForExternalContent({type:"url",url:r});i&&n.run(()=>{n.createAssets([i]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:i.id}}])})},500);function Mo(n,e=!1){const r=n.length;if(r<2)return"";let i=n[0].point,s=n[1].point;if(r===2)return`M${Qe(i)}L${Qe(s)}`;let o="";for(let a=2,c=r-1;a<c;a++)i=n[a].point,s=n[a+1].point,o+=Bn(i,s);return e?`M${Bn(n[0].point,n[1].point)}Q${Qe(n[1].point)}${Bn(n[1].point,n[2].point)}T${o}${Bn(n[r-1].point,n[0].point)}${Bn(n[0].point,n[1].point)}Z`:`M${Qe(n[0].point)}Q${Qe(n[1].point)}${Bn(n[1].point,n[2].point)}${n.length>3?"T":""}${o}L${Qe(n[r-1].point)}`}function Rae(n,e={}){const{start:r={},end:i={}}=e,{cap:s=!0}=r,{cap:o=!0}=i;gt(!r.taper&&!i.taper,"cap taper not supported here"),gt(!r.easing&&!i.easing,"cap easing not supported here"),gt(s&&o,"cap must be true");const a=_i(n,e);kf(a,e);const c=Oae(a);let l="";for(const u of c)l+=Nae(u,e);return l}function Oae(n){if(n.length<=2)return[n];const e=[];let r=[n[0]],i=k.Sub(n[1].point,n[0].point).uni(),s,o,a,c,l;for(let u=1,d=n.length;u<d-1;u++){if(a=n[u-1],c=n[u],l=n[u+1],s=k.Sub(l.point,c.point).uni(),o=k.Dpr(i,s),i=s,o<-.8){const h={...c,point:c.input};r.push(h),e.push(ES(r)),r=[h];continue}if(r.push(c),!(o>.7)&&(k.Dist2(a.point,c.point)+k.Dist2(c.point,l.point))/((a.radius+c.radius+l.radius)/3)**2<1.5){r.push(c),e.push(ES(r)),r=[c];continue}}return r.push(n[n.length-1]),e.push(ES(r)),e}function ES(n){const e=n[0];let r;for(;n.length>2&&(r=n[1],k.Dist2(e.point,r.point)<((e.radius+r.radius)/2*.5)**2);)n.splice(1,1);const i=n[n.length-1];let s;for(;n.length>2&&(s=n[n.length-2],k.Dist2(i.point,s.point)<((i.radius+s.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:k.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:k.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function Dae(n,e,r){return"M "+n+" "+e+" m -"+r+", 0 a "+r+","+r+" 0 1,1 "+r*2+",0 a "+r+","+r+" 0 1,1 -"+r*2+",0"}function Nae(n,e={}){if(n.length===0)return"";if(n.length===1)return Dae(n[0].point.x,n[0].point.y,n[0].radius);const{left:r,right:i}=y$(n,e);i.reverse();let s=`M${Qe(r[0])}T`;for(let o=1;o<r.length;o++)s+=Bn(r[o-1],r[o]);{const o=n[n.length-1],a=o.radius,c=o.vector.clone().per().neg(),l=k.Add(o.point,k.Mul(c,a)),u=k.Add(o.point,k.Mul(c,-a));s+=`${Qe(l)}A${W(a)},${W(a)} 0 0 1 ${Qe(u)}T`}for(let o=1;o<i.length;o++)s+=Bn(i[o-1],i[o]);{const o=n[0],a=o.radius,c=o.vector.clone().per(),l=k.Add(o.point,k.Mul(c,a)),u=k.Add(o.point,k.Mul(c,-a));s+=`${Qe(l)}A${W(a)},${W(a)} 0 0 1 ${Qe(u)}Z`}return s}const Lae=n=>n*.65+Uee(n*Je/2)*.35,Fae=n=>({size:n,thinning:.5,streamline:Ta(n,[9,16],[.64,.74],!0),smoothing:.62,easing:Wt.easeOutSine,simulatePressure:!0}),zae=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Lae}),SO=n=>({size:n,thinning:0,streamline:Ta(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Wt.linear}),$ae=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Wt.linear});function tC({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Wt.easeOutSine,last:e}}function Rw(n,e,r,i){const s=n.isComplete||r;return i?n.isPen?{...$ae(e),last:s}:{...SO(e),last:s}:n.dash==="draw"?n.isPen?{...zae(e),last:s}:{...Fae(e),last:s}:{...SO(e),last:s}}function Ra(n){const e=[];for(const r of n)if(r.type==="free"||r.points.length<2)e.push(...r.points.map(k.Cast));else{const i=Math.max(4,Math.floor(k.Dist(r.points[0],r.points[1])/16));e.push(...k.PointsBetween(r.points[0],r.points[1],i))}return e}function Bae(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class Uae extends Gs{static type="draw";static props=NF;static migrations=LF;hideResizeHandles=e=>kS(e);hideRotateHandle=e=>kS(e);hideSelectionBoundsFg=e=>kS(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const r=Ra(e.props.segments),i=(Yt[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const o=pe.FromPoints(r);if(o.width<i*2&&o.height<i*2)return new W_({x:-i,y:-i,radius:i,isFilled:!0})}const s=_i(r,Rw(e.props,i,e.props.isPen,!0)).map(o=>o.point);return e.props.isClosed?new Ot({points:s,isFilled:e.props.fill!=="none"}):new Ya({points:s})}component(e){return f.jsx($s,{id:e.id,children:f.jsx(wO,{shape:e,zoomLevel:this.editor.getZoomLevel()})})}indicator(e){const r=Ra(e.props.segments);let i=(Yt[e.props.size]+1)*e.props.scale;const s=this.editor.getZoomLevel();!(s<.5&&s<1.5/i)&&!e.props.isPen&&e.props.dash==="draw"&&r.length===1&&(i+=ti(e.id)()*(i/6));const a=e.props.isComplete||rn(e.props.segments)?.type==="straight",c=Rw(e.props,i,a,!0),l=_i(r,c),u=l.length>1?Mo(l,e.props.isClosed):B$(r[0],i);return f.jsx("path",{d:u})}toSvg(e,r){r.addExportDef(Z_(e.props.fill));const i=1/e.props.scale;return f.jsx("g",{transform:`scale(${i})`,children:f.jsx(wO,{shape:e,zoomLevel:1})})}getCanvasSvgDefs(){return[Q_()]}onResize=(e,r)=>{const{scaleX:i,scaleY:s}=r,o=[];for(const a of e.props.segments)o.push({...a,points:a.points.map(({x:c,y:l,z:u})=>({x:Hi(i*c),y:Hi(s*l),z:u}))});return{props:{segments:o}}};expandSelectionOutlinePx(e){const r=e.props.dash==="draw"?1.6:1;return Yt[e.props.size]*r/2*e.props.scale}}function B$(n,e){const r=(e+1)*.5;return`M ${n.x} ${n.y} m -${r}, 0 a ${r},${r} 0 1,0 ${r*2},0 a ${r},${r} 0 1,0 -${r*2},0`}function kS(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function wO({shape:n,zoomLevel:e}){const r=Dr(),i=Ra(n.props.segments),s=n.props.isComplete||rn(n.props.segments)?.type==="straight";let o=(Yt[n.props.size]+1)*n.props.scale;const a=e<.5&&e<1.5/o;!a&&!n.props.isPen&&n.props.dash==="draw"&&i.length===1&&(o+=ti(n.id)()*(o/6));const c=Rw(n.props,o,s,a);if(!a&&n.props.dash==="draw")return f.jsxs(f.Fragment,{children:[n.props.isClosed&&n.props.fill&&i.length>1?f.jsx(mn,{d:Mo(_i(i,c),n.props.isClosed),theme:r,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,f.jsx("path",{d:Rae(i,c),strokeLinecap:"round",fill:r[n.props.color].solid})]});const l=_i(i,c),u=l.length<2,d=u?B$(i[0],0):Mo(l,n.props.isClosed);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{d,theme:r,color:n.props.color,fill:u||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),f.jsx("path",{d,strokeLinecap:"round",fill:u?r[n.props.color].solid:"none",stroke:r[n.props.color].solid,strokeWidth:o,strokeDasharray:u?"none":Bae(n,o),strokeDashoffset:"0"})]})}function qae(n,e,r={}){const{newPoint:i,handle:s,scaleX:o,scaleY:a}=e,{minWidth:c=1,maxWidth:l=1/0,minHeight:u=1,maxHeight:d=1/0}=r;let h=n.props.w*o,p=n.props.h*a;const g=new k(0,0);if(h>0){if(h<c){switch(s){case"top_left":case"left":case"bottom_left":{g.x=h-c;break}case"top":case"bottom":{g.x=(h-c)/2;break}default:g.x=0}h=c}}else if(g.x=h,h=-h,h<c){switch(s){case"top_left":case"left":case"bottom_left":{g.x=-h;break}default:g.x=-c}h=c}if(p>0){if(p<u){switch(s){case"top_left":case"top":case"top_right":{g.y=p-u;break}case"right":case"left":{g.y=(p-u)/2;break}default:g.y=0}p=u}}else if(g.y=p,p=-p,p<u){switch(s){case"top_left":case"top":case"top_right":{g.y=-p;break}default:g.y=-u}p=u}const{x:y,y:v}=g.rot(n.rotation).add(i);return{x:y,y:v,props:{w:Math.min(l,h),h:Math.min(d,p)}}}const Hae=n=>Object.entries(n).filter(([e,r])=>r).map(([e])=>e).join(" ");class Gae extends Xa{static type="embed";static props=FF;static migrations=zF;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canResize=e=>!!Ms(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>Ms(e.props.url)?.definition.isAspectRatioLocked??!1;onResize=(e,r)=>{const i=this.isAspectRatioLocked(e),s=Ms(e.props.url);let o=s?.definition.minWidth??200,a=s?.definition.minHeight??200;if(i){const c=e.props.w/e.props.h;c>1?o*=c:a/=c}return qae(e,r,{minWidth:o,minHeight:a})};component(e){const{w:r,h:i,url:s}=e.props,o=Ef(e.id),a=E.useMemo(()=>w$(s),[s]),c=ne("is hovering",()=>{const{editingShapeId:p,hoveredShapeId:g}=this.editor.getCurrentPageState();if(p&&g!==p){const y=this.editor.getShape(p);if(y&&this.editor.isShapeOfType(y,"embed"))return!0}return!1},[]),l=this.editor.getShapePageTransform(e).rotation(),u=o||c;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&a?.definition.type==="tldraw")return null;if(a?.definition.type==="github_gist"){const p=a.url.split("/").pop();if(!p)throw Error("No gist id!");return f.jsx(To,{className:"tl-embed-container",id:e.id,children:f.jsx(Kae,{id:p,width:W(r),height:W(i),isInteractive:u,pageRotation:l})})}const h=Hae({..._ee,...a?.definition.overridePermissions??{}});return f.jsx(To,{className:"tl-embed-container",id:e.id,children:a?.definition?f.jsx("iframe",{className:"tl-embed",sandbox:h,src:a.embedUrl,width:W(r),height:W(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:eC(l),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor}}):null})}indicator(e){const r=E.useMemo(()=>Ms(e.props.url),[e.props.url]);return f.jsx("rect",{width:W(e.props.w),height:W(e.props.h),rx:r?.definition.overrideOutlineRadius??8,ry:r?.definition.overrideOutlineRadius??8})}}function Kae({id:n,file:e,isInteractive:r,width:i,height:s,style:o,pageRotation:a}){return f.jsx("iframe",{className:"tl-embed",draggable:!1,width:W(i),height:W(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:r?"all":"none",zIndex:r?"":"-1",boxShadow:eC(a)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const Vae=E.forwardRef(({id:n,name:e,isEditing:r},i)=>{const s=Z(),o=E.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Xt(l),l.currentTarget.blur(),s.setEditingShape(null))},[s]),a=E.useCallback(l=>{const u=s.getShape(n);if(!u)return;const d=u.props.name,h=l.currentTarget.value.trim();d!==h&&s.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,s]),c=E.useCallback(l=>{const u=s.getShape(n);if(!u)return;const d=u.props.name,h=l.currentTarget.value;d!==h&&s.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,s]);return f.jsxs("div",{className:`tl-frame-label ${r?"tl-frame-label__editing":""}`,children:[f.jsx("input",{className:"tl-frame-name-input",ref:i,style:{display:r?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:a,onChange:c}),U$(e,"Frame")+""]})}),Wae=function({id:e,name:r,width:i,height:s}){const o=Z(),a=ne("shape rotation",()=>Ds(o.getShapePageTransform(e).rotation()),[o,e]),c=Ef(e),l=E.useRef(null),u=E.useCallback(y=>{const v=Gn(y);y.preventDefault(),o.getEditingShapeId()!==e&&o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...v})},[o,e]);E.useEffect(()=>{const y=l.current;y&&c&&(y.focus(),y.select())},[l,c]);const h=((a+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(h)];let g;switch(p){case"top":g="";break;case"right":g=`translate(${W(i)}px, 0px) rotate(90deg)`;break;case"bottom":g=`translate(${W(i)}px, ${W(s)}px) rotate(180deg)`;break;case"left":g=`translate(0px, ${W(s)}px) rotate(270deg)`;break}return f.jsx("div",{className:"tl-frame-heading",style:{overflow:c?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?i:s)}px + var(--space-5))`,bottom:"100%",transform:`${g} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:u,children:f.jsx("div",{className:"tl-frame-heading-hit-area",children:f.jsx(Vae,{ref:l,id:e,name:r,isEditing:c})})})};function U$(n,e){return n.match(/^\s*$/)?e:n}class Yae extends Xa{static type="frame";static props=$F;static migrations=BF;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new ns({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const r=this.editor.getShapeGeometry(e).bounds,i=Dr(),s=ne("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const a=o?.info;return a?a.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return f.jsxs(f.Fragment,{children:[f.jsx($s,{children:f.jsx("rect",{className:Me("tl-frame__body",{"tl-frame__creating":s}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),s?null:f.jsx(Wae,{id:e.id,name:e.props.name,width:r.width,height:r.height})]})}toSvg(e,r){const i=ds({isDarkMode:r.isDarkMode}),a=((Ds(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,c=Math.floor(a);let l;switch(c){case 0:l="";break;case 3:l=`translate(${W(e.props.w)}, 0) rotate(90)`;break;case 2:l=`translate(${W(e.props.w)}, ${W(e.props.h)}) rotate(180)`;break;case 1:l=`translate(0, ${W(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const u={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(U$(e.props.name,"Frame")+"",u),h=d[0],p=rn(d),g=p.box.w+p.box.x-h.box.x,y=Aw(this.editor,d,{offsetY:-u.height-2,...u});return f.jsxs(f.Fragment,{children:[f.jsx("rect",{width:e.props.w,height:e.props.h,fill:i.solid,stroke:i.black.solid,strokeWidth:1,rx:1,ry:1}),f.jsxs("g",{transform:l,children:[f.jsx("rect",{x:-8,y:-u.height-4,width:g+16,height:u.height,fill:i.background,rx:4,ry:4}),y]})]})}indicator(e){const r=this.editor.getShapeGeometry(e).bounds;return f.jsx("rect",{width:W(r.width),height:W(r.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,r)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,r)=>!e.isLocked;onDragShapesOver=(e,r)=>{r.every(i=>i.parentId===e.id)||this.editor.reparentShapes(r,e.id)};onDragShapesOut=(e,r)=>{const i=this.editor.getShape(e.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())};onResize=(e,r)=>K_(e,r)}function _O(n,e){return n>e?(Je*(e/2)+(n-e))*2:(Je*(n/2)+(e-n))*2}function q$(n,e){return nC(n,e).map((r,i)=>r.getSvgPathData(i===0)).join(" ")+" Z"}function Xae(n,e,r,i){const s=n/4,o=e/4,a=ti(i),c=r*.75,l=b=>b.addXY(a()*c,a()*c),u=new k(n/2,e),d=new k(0,o*1.2),h=new k(n/2,o*.9),p=new k(n,o*1.2),g=l(new k(n/2,e)),y=l(new k(0,o*1.2)),v=l(new k(n/2,o*.9)),x=l(new k(n,o*1.2));return[new vn({start:u,cp1:new k(s*1.5,o*3),cp2:new k(0,o*2.5),end:d}),new vn({start:d,cp1:new k(0,-o*.32),cp2:new k(s*1.85,-o*.32),end:h}),new vn({start:h,cp1:new k(s*2.15,-o*.32),cp2:new k(n,-o*.32),end:p}),new vn({start:p,cp1:new k(n,o*2.5),cp2:new k(s*2.5,o*3),end:g}),new vn({start:g,cp1:new k(s*1.5,o*3),cp2:new k(0,o*2.5),end:y}),new vn({start:y,cp1:new k(0,-o*.32),cp2:new k(s*1.85,-o*.32),end:v}),new vn({start:v,cp1:new k(s*2.15,-o*.32),cp2:new k(n,-o*.32),end:x}),new vn({start:x,cp1:new k(n,o*2.5),cp2:new k(s*2.5,o*3),end:u})].map((b,S)=>b.getSvgPathData(S===0)).join(" ")+" Z"}function nC(n,e){const r=n/4,i=e/4;return[new vn({start:new k(n/2,e),cp1:new k(r*1.5,i*3),cp2:new k(0,i*2.5),end:new k(0,i*1.2)}),new vn({start:new k(0,i*1.2),cp1:new k(0,-i*.32),cp2:new k(r*1.85,-i*.32),end:new k(n/2,i*.9)}),new vn({start:new k(n/2,i*.9),cp1:new k(r*2.15,-i*.32),cp2:new k(n,-i*.32),end:new k(n,i*1.2)}),new vn({start:new k(n,i*1.2),cp1:new k(n,i*2.5),cp2:new k(r*2.5,i*3),end:new k(n/2,e)})]}function Zae(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function Qae(n,e,r,i){const s=ti(n),o=e/2,a=r/2,c=oz(o,a),l=[],u=rt*s(),d=rt+pt/2+Math.abs(s())*pt,h=Math.max(16,c/10);for(let p=0;p<h;p++){const g=p/(h-1),y=u+g*d,v=Math.cos(y),x=Math.sin(y);l.push(new k(o*v+e*.5+.05*s(),a*x+r/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?Wt.easeInOutSine(g):Wt.easeInExpo(g)))/2)))}return _i(l,Zae(i))}function Jae(n,e,r,i){return Mo(Qae(n,e,r,i))}function Ow(n){let e="M";const r=n.length;let i,s,o;for(let a=0,c=r;a<c;a+=3)i=n[a],s=n[a+1],o=n[a+2],e+=`${Qe(i)}L${Qe(s)}Q${Qe(o)}`;return e+=`${Qe(n[0])}`,e}function Dw(n,e,r,i,s){const o=[],a=ti(n);let c=e[0],l;const u=e.length;for(let d=0,h=u*s;d<h;d++){l=k.AddXY(e[(d+1)%u],a()*r,a()*r);const p=k.Sub(l,c),g=k.Len(p),y=k.Div(p,g).mul(Math.min(g/4,i));o.push(k.Add(c,y),k.Add(l,y.neg()),l),c=l}return o}function ece(n,e,r){const i=Math.min(n,e)/2,s=Math.max(n,e)-i*2,a=(Math.PI*(i*2)+2*s)/r,c=n>e?[{type:"straight",start:new k(i,0),delta:new k(1,0)},{type:"arc",center:new k(n-i,i),startAngle:-Je/2},{type:"straight",start:new k(n-i,e),delta:new k(-1,0)},{type:"arc",center:new k(i,i),startAngle:Je/2}]:[{type:"straight",start:new k(n,i),delta:new k(0,1)},{type:"arc",center:new k(i,e-i),startAngle:0},{type:"straight",start:new k(0,e-i),delta:new k(0,-1)},{type:"arc",center:new k(i,i),startAngle:Je}];let l=0;const u=[];for(let d=0;d<r;d++){const h=c[0];h.type==="straight"?u.push(k.Add(h.start,k.Mul(h.delta,l))):u.push(ko(h.center,i,h.startAngle+l/i)),l+=a;let p=h.type==="straight"?s:Je*i;for(;l>p;)l-=p,c.push(c.shift()),p=c[0].type==="straight"?s:Je*i}return u}const tce={s:50,m:70,l:100,xl:130},nce=.2;function Rf(n,e,r,i){const s=ti(r),o=_O(n,e),a=Math.max(Math.ceil(o/tce[i]),6,Math.ceil(o/Math.min(n,e))),c=o/a*nce,l=Math.max(n-c*2,1),u=Math.max(e-c*2,1),h=_O(l,u)/a,p=(n-l)/2,g=(e-u)/2,y=ece(l,u,a).map(S=>S.addXY(p,g)),v=n<20?0:c*.3,x=e<20?0:c*.3,m=y.slice(0);for(let S=0;S<Math.floor(a/2);S++)m[S]=k.AddXY(m[S],s()*v,s()*x),m[a-S-1]=k.AddXY(m[a-S-1],s()*v,s()*x);const b=[];for(let S=0;S<m.length;S++){const w=S===m.length-1?0:S+1,I=m[S],C=m[w],_=y[S],P=y[w],M=k.Dist(_,P),T=h-M,R=k.Dist(I,C)/M,O=(Math.max(p,g)+T)*R,j=k.Lrp(_,P,.5).add(k.Sub(P,_).uni().per().mul(O));j.x<0?j.x=0:j.x>n&&(j.x=n),j.y<0?j.y=0:j.y>e&&(j.y=e);const D=M_(I,C,j),N=k.Dist(D||k.Average([I,C]),I);b.push({leftPoint:I,rightPoint:C,arcPoint:j,center:D,radius:N})}return b}function rce(n,e,r,i){const s=[],o=Rf(n,e,r,i);for(const{center:a,radius:c,leftPoint:l,rightPoint:u}of o)s.push(...Kee(l,u,a,c,10));return s}function Nw(n,e,r,i){const s=Rf(n,e,r,i);let o=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:c,radius:l,center:u}of s){if(u===null){o+=` L${c.toFixed()}`;continue}const d=k.Clockwise(a,c,u)?"0":"1";o+=` A${W(l)},${W(l)} 0 ${d},1 ${c.toFixed()}`}return o+=" Z",o}const ice={s:.5,m:.7,l:.9,xl:1.6};function sce(n,e,r,i){const s=ti(r),o=ice[i],a=Rf(n,e,r,i),u=a.reduce((g,y)=>g+k.Dist2(y.leftPoint,y.rightPoint),0)/a.length>(o*15)**2?g=>g.addXY(s()*o*2,s()*o*2):g=>g;let d=`M${a[0].leftPoint.toFixed()}`,h=u(a[0].leftPoint),p=`M${h.toFixed()}`;for(const{leftPoint:g,center:y,rightPoint:v,radius:x,arcPoint:m}of a){if(y===null){d+=` L${v.toFixed()}`;const _=u(v);p+=` L${_.toFixed()}`,h=_;continue}const b=k.Clockwise(g,v,y)?"0":"1";d+=` A${W(x)},${W(x)} 0 ${b},1 ${v.toFixed()}`;const S=u(v),w=u(m),I=M_(h,S,w);if(!Number.isFinite(I.x)||!Number.isFinite(I.y)){p+=` L${S.toFixed()}`,h=S;continue}const C=Math.abs(k.Dist(I,h));p+=` A${W(C)},${W(C)} 0 ${b},1 ${S.toFixed()}`,h=S}return d+p+" Z"}function Lw(n,e){switch(n.geo){case"x-box":return oce(n.w,n.h,e,n.dash);case"check-box":return ace(n.w,n.h);default:return}}function oce(n,e,r,i){const s=i==="draw"?.62:0;if(i==="dashed")return[[new k(0,0),new k(n/2,e/2)],[new k(n,e),new k(n/2,e/2)],[new k(0,e),new k(n/2,e/2)],[new k(n,0),new k(n/2,e/2)]];const o=c=>Math.max(0,Math.min(n,c)),a=c=>Math.max(0,Math.min(e,c));return[[new k(o(r*s),a(r*s)),new k(o(n-r*s),a(e-r*s))],[new k(o(r*s),a(e-r*s)),new k(o(n-r*s),a(r*s))]]}function ace(n,e){const r=Math.min(n,e)*.82,i=(n-r)/2,s=(e-r)/2,o=c=>Math.max(0,Math.min(n,c)),a=c=>Math.max(0,Math.min(e,c));return[[new k(o(i+r*.25),a(s+r*.52)),new k(o(i+r*.45),a(s+r*.82))],[new k(o(i+r*.45),a(s+r*.82)),new k(o(i+r*.82),a(s+r*.22))]]}function CO({shape:n,shouldScale:e}){const r=e?n.props.scale:1,i=Z(),s=Dr(),{id:o,props:a}=n,{w:c,color:l,fill:u,dash:d,growY:h,size:p}=a,g=Yt[p]*r,y=a.h+h;switch(a.geo){case"cloud":if(d==="solid"){const v=Nw(c,y,o,p);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:v,color:l,fill:u,scale:r}),f.jsx("path",{d:v,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}else if(d==="draw"){const v=sce(c,y,o,p);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:v,color:l,fill:u,scale:r}),f.jsx("path",{d:v,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}else{const v=Nw(c,y,o,p),x=Rf(c,y,o,p);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:v,color:l,fill:u,scale:r}),f.jsx("g",{strokeWidth:g,stroke:s[l].solid,fill:"none",pointerEvents:"all",children:x.map(({leftPoint:m,rightPoint:b,center:S,radius:w},I)=>{const C=S?w*Ds(Ds(k.Angle(S,b))-Ds(k.Angle(S,m))):k.Dist(m,b),{strokeDasharray:_,strokeDashoffset:P}=li(C,g,{style:d,start:"outset",end:"outset"});return f.jsx("path",{d:S?`M${m.x},${m.y}A${w},${w},0,0,1,${b.x},${b.y}`:`M${m.x},${m.y}L${b.x},${b.y}`,strokeDasharray:_,strokeDashoffset:P},I)})})]})}case"ellipse":{const v=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=v.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const m=v.length,{strokeDasharray:b,strokeDashoffset:S}=li(m<64?m*2:m,g,{style:d,snap:4,closed:!0});return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:x,color:l,fill:u,scale:r}),f.jsx("path",{d:x,strokeWidth:g,fill:"none",stroke:s[l].solid,strokeDasharray:b,strokeDashoffset:S})]})}else{const b=(e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:b,color:l,fill:u,scale:r}),f.jsx("path",{d:b,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}}case"oval":{const v=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=v.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const m=v.getLength(),{strokeDasharray:b,strokeDashoffset:S}=li(m<64?m*2:m,g,{style:d,snap:4,start:"outset",end:"outset",closed:!0});return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:x,color:l,fill:u,scale:r}),f.jsx("path",{d:x,strokeWidth:g,fill:"none",stroke:s[l].solid,strokeDasharray:b,strokeDashoffset:S})]})}else return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:x,color:l,fill:u,scale:r}),f.jsx("path",{d:x,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}case"heart":if(d==="dashed"||d==="dotted"||d==="solid"){const v=q$(c,y),x=nC(c,y);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:v,color:l,fill:u,scale:r}),x.map((m,b)=>{const{strokeDasharray:S,strokeDashoffset:w}=li(m.length,g,{style:d,snap:1,start:"outset",end:"outset",closed:!0});return f.jsx("path",{d:m.getSvgPathData(),strokeWidth:g,fill:"none",stroke:s[l].solid,strokeDasharray:S,strokeDashoffset:w,pointerEvents:"all"},`curve_${b}`)})]})}else{const v=Xae(c,y,g,n.id);return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:v,color:l,fill:u,scale:r}),f.jsx("path",{d:v,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}default:{const v=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=v instanceof Qr?v.children[0].vertices:v.vertices,m=Lw(n.props,g);if(d==="solid"){let b="M"+x[0]+"L"+x.slice(1)+"Z";if(m)for(const[S,w]of m)b+=`M${S.x},${S.y}L${w.x},${w.y}`;return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:b,color:l,fill:u,scale:r}),f.jsx("path",{d:b,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}else if(d==="dashed"||d==="dotted"){const b="M"+x[0]+"L"+x.slice(1)+"Z";return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:b,color:l,fill:u,scale:r}),f.jsxs("g",{strokeWidth:g,stroke:s[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(x.length)).map((S,w)=>{const I=k.ToFixed(x[w]),C=k.ToFixed(x[(w+1)%x.length]),_=k.Dist(I,C),{strokeDasharray:P,strokeDashoffset:M}=li(_,g,{style:d,start:"outset",end:"outset"});return f.jsx("line",{x1:I.x,y1:I.y,x2:C.x,y2:C.y,strokeDasharray:P,strokeDashoffset:M},w)}),m&&m.map(([S,w],I)=>{const C=k.Dist(S,w),{strokeDasharray:_,strokeDashoffset:P}=li(C,g,{style:d,start:"skip",end:"skip",snap:d==="dotted"?4:void 0});return f.jsx("path",{d:`M${S.x},${S.y}L${w.x},${w.y}`,stroke:s[l].solid,strokeWidth:g,fill:"none",strokeDasharray:_,strokeDashoffset:P},`line_fg_${I}`)})]})]})}else if(d==="draw"){let b=Ow(Dw(o,x,g/3,g*2,2));if(m)for(const[w,I]of m)b+=`M${w.toFixed()}L${I.toFixed()}`;const S=Ow(Dw(o,x,0,g*2,1));return f.jsxs(f.Fragment,{children:[f.jsx(mn,{theme:s,d:S,color:l,fill:u,scale:r}),f.jsx("path",{d:b,stroke:s[l].solid,strokeWidth:g,fill:"none"})]})}}}}const PO=51;class cce extends Xa{static type="geo";static props=UF;static migrations=qF;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const r=Math.max(1,e.props.w),i=Math.max(1,e.props.h+e.props.growY),s=r/2,o=i/2,a=e.props.fill!=="none";let c;switch(e.props.geo){case"cloud":{c=new Ot({points:rce(r,i,e.id,e.props.size),isFilled:a});break}case"triangle":{c=new Ot({points:[new k(s,0),new k(r,i),new k(0,i)],isFilled:a});break}case"diamond":{c=new Ot({points:[new k(s,0),new k(r,o),new k(s,i),new k(0,o)],isFilled:a});break}case"pentagon":{c=new Ot({points:oS(r,i,5),isFilled:a});break}case"hexagon":{c=new Ot({points:oS(r,i,6),isFilled:a});break}case"octagon":{c=new Ot({points:oS(r,i,8),isFilled:a});break}case"ellipse":{c=new Pse({width:r,height:i,isFilled:a});break}case"oval":{c=new Ise({width:r,height:i,isFilled:a});break}case"star":{const b=rt/5/2,S=Math.floor(5/4)*2,w=10-S,I=0,C=Math.floor(5/2)*2,_=Math.cos(-pt+S*b)*r/2,P=Math.cos(-pt+w*b)*r/2,M=Math.sin(-pt+I*b)*i/2,T=Math.sin(-pt+C*b)*i/2,A=r-Math.abs(_-P),R=i-Math.abs(T-M),O=r/2+P-(r/2-_),j=i/2+M-(i/2-T),D=1,N=(r-O)/2,F=(i-j)/2,z=(r+A)/2,$=(i+R)/2,G=z*D/2,X=$*D/2;c=new Ot({points:Array.from(Array(10)).map((ee,re)=>{const B=-pt+re*b;return new k(N+(re%2?G:z)*Math.cos(B),F+(re%2?X:$)*Math.sin(B))}),isFilled:a});break}case"rhombus":{const m=Math.min(r*.38,i*.38);c=new Ot({points:[new k(m,0),new k(r,0),new k(r-m,i),new k(0,i)],isFilled:a});break}case"rhombus-2":{const m=Math.min(r*.38,i*.38);c=new Ot({points:[new k(0,0),new k(r-m,0),new k(r,i),new k(m,i)],isFilled:a});break}case"trapezoid":{const m=Math.min(r*.38,i*.38);c=new Ot({points:[new k(m,0),new k(r-m,0),new k(r,i),new k(0,i)],isFilled:a});break}case"arrow-right":{const m=Math.min(r,i)*.38,b=i*.16;c=new Ot({points:[new k(0,b),new k(r-m,b),new k(r-m,0),new k(r,i/2),new k(r-m,i),new k(r-m,i-b),new k(0,i-b)],isFilled:a});break}case"arrow-left":{const m=Math.min(r,i)*.38,b=i*.16;c=new Ot({points:[new k(m,0),new k(m,b),new k(r,b),new k(r,i-b),new k(m,i-b),new k(m,i),new k(0,i/2)],isFilled:a});break}case"arrow-up":{const m=r*.16,b=Math.min(r,i)*.38;c=new Ot({points:[new k(r/2,0),new k(r,b),new k(r-m,b),new k(r-m,i),new k(m,i),new k(m,b),new k(0,b)],isFilled:a});break}case"arrow-down":{const m=r*.16,b=Math.min(r,i)*.38;c=new Ot({points:[new k(m,0),new k(r-m,0),new k(r-m,i-b),new k(r,i-b),new k(r/2,i),new k(0,i-b),new k(m,i-b)],isFilled:a});break}case"check-box":case"x-box":case"rectangle":{c=new ns({width:r,height:i,isFilled:a});break}case"heart":{const b=nC(r,i).reduce((S,w)=>(S.push(...w.vertices),S),[]);c=new Ot({points:b,isFilled:a});break}default:wn(e.props.geo)}const l=id(this.editor,e),u=r/e.props.scale,d=i/e.props.scale,h=Math.min(100,u/2),p=Math.min(Zi[e.props.size]*cn.lineHeight+_r*2,d/2),g=Math.min(u,Math.max(l.w,Math.min(h,Math.max(1,u-8)))),y=Math.min(d,Math.max(l.h,Math.min(p,Math.max(1,d-8)))),v=Lw(e.props,Yt[e.props.size]*e.props.scale),x=v?v.map(m=>new Ya({points:m})):[];return new Qr({children:[c,new ns({x:e.props.align==="start"?0:e.props.align==="end"?(u-g)*e.props.scale:(u-g)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(d-y)*e.props.scale:(d-y)/2*e.props.scale,width:g*e.props.scale,height:y*e.props.scale,isFilled:!0,isLabel:!0}),...x]})}getHandleSnapGeometry(e){const r=this.getGeometry(e),i=r.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:i,points:[...i.getVertices(),r.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:i,points:[r.bounds.center]};default:wn(e.props.geo)}}onEditEnd=e=>{const{id:r,type:i,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])};component(e){const{id:r,type:i,props:s}=e,{fill:o,font:a,align:c,verticalAlign:l,size:u,text:d}=s,h=Dr(),p=this.editor.getEditingShapeId()!==null,g=ne("isGeoOnlySelected",()=>e.id===this.editor.getOnlySelectedShapeId(),[]),y=p||e.props.text;return f.jsxs(f.Fragment,{children:[f.jsx($s,{id:r,children:f.jsx(CO,{shape:e,shouldScale:!0})}),y&&f.jsx(To,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+s.growY},children:f.jsx(jf,{id:r,type:i,font:a,fontSize:Zi[u]*e.props.scale,lineHeight:cn.lineHeight,padding:_r*e.props.scale,fill:o,align:c,verticalAlign:l,text:d,isSelected:g,labelColor:h[s.labelColor].solid,wrap:!0})}),e.props.url&&f.jsx(ja,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:r,props:i}=e,{w:s,size:o}=i,a=i.h+i.growY,c=Yt[o],l=this.editor.getShapeGeometry(e);switch(i.geo){case"ellipse":return i.dash==="draw"?f.jsx("path",{d:Jae(r,s,a,c)}):f.jsx("path",{d:l.getSvgPathData(!0)});case"heart":return f.jsx("path",{d:q$(s,a)});case"oval":return f.jsx("path",{d:l.getSvgPathData(!0)});case"cloud":return f.jsx("path",{d:Nw(s,a,r,o)});default:{const u=this.editor.getShapeGeometry(e),d=u instanceof Qr?u.children[0].vertices:u.vertices;let h;if(i.dash==="draw"){const g=Dw(r,d,0,c*2*e.props.scale,1);h=Ow(g)}else h="M"+d[0]+"L"+d.slice(1)+"Z";const p=Lw(e.props,c);if(p)for(const[g,y]of p)h+=`M${g.x},${g.y}L${y.x},${y.y}`;return f.jsx("path",{d:h})}}}toSvg(e,r){const i={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},s=i.props;r.addExportDef(Z_(s.fill));let o;if(s.text){r.addExportDef(Mf(s.font));const a=ds(r),c=new pe(0,0,s.w,s.h+s.growY);o=f.jsx(Af,{fontSize:Zi[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:a[s.labelColor].solid,bounds:c,padding:16})}return f.jsxs(f.Fragment,{children:[f.jsx(CO,{shouldScale:!1,shape:i}),o]})}getCanvasSvgDefs(){return[Q_()]}onResize=(e,{handle:r,newPoint:i,scaleX:s,scaleY:o,initialShape:a})=>{const c=a.props.w/a.props.scale,l=a.props.h/a.props.scale,u=a.props.growY/a.props.scale;let d=c*s,h=(l+u)*o,p=0,g=0;const y=PO;if(e.props.text.trim()){let w=Math.max(Math.abs(d),y),I=Math.max(Math.abs(h),y);w<y&&I===y&&(w=y),w===y&&I<y&&(I=y);const C=id(this.editor,{...e,props:{...e.props,w:w*e.props.scale,h:I*e.props.scale}}),_=Math.max(Math.abs(d),C.w)*Math.sign(d),P=Math.max(Math.abs(h),C.h)*Math.sign(h);p=Math.abs(_)-Math.abs(d),g=Math.abs(P)-Math.abs(h),d=_,h=P}const v=d*e.props.scale,x=h*e.props.scale,m=new k(0,0);s<0&&(m.x+=v),(r==="left"||r==="top_left"||r==="bottom_left")&&(m.x+=s<0?p:-p),o<0&&(m.y+=x),(r==="top"||r==="top_left"||r==="top_right")&&(m.y+=o<0?g:-g);const{x:b,y:S}=m.rot(e.rotation).add(i);return{x:b,y:S,props:{w:Math.max(Math.abs(v),1),h:Math.max(Math.abs(x),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const r=e.props.h/e.props.scale,i=id(this.editor,e).h;let s=null;if(i>r?s=i-r:e.props.growY&&(s=0),s!==null)return{...e,props:{...e.props,growY:s*e.props.scale}}};onBeforeUpdate=(e,r)=>{const i=e.props.text,s=r.props.text;if(i===s&&e.props.font===r.props.font&&e.props.size===r.props.size)return;if(i&&!s)return{...r,props:{...r.props,growY:0}};const o=e.props.w/e.props.scale,a=e.props.h/e.props.scale,c=e.props.growY/e.props.scale,l=id(this.editor,r);if(!i&&s&&s.length===1){let d=Math.max(o,l.w),h=Math.max(a,l.h);const p=PO;return o<p&&a<p&&(d=Math.max(d,p),h=Math.max(h,p),d=Math.max(d,h),h=Math.max(d,h)),{...r,props:{...r.props,w:d*r.props.scale,h:h*r.props.scale,growY:0}}}let u=null;if(l.h>a?u=l.h-a:c&&(u=0),u!==null){const d=r.props.w/r.props.scale;return{...r,props:{...r.props,growY:u*r.props.scale,w:Math.max(d,l.w)*r.props.scale}}}if(l.w>o)return{...r,props:{...r.props,w:l.w*r.props.scale}}};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}}function id(n,e){const{text:r,font:i,size:s,w:o}=e.props;if(!r)return{w:0,h:0};const a=n.textMeasure.measureText("w",{...cn,fontFamily:vi[i],fontSize:Zi[s],maxWidth:100}),c={s:2,m:3.5,l:5,xl:10},l=n.textMeasure.measureText(r,{...cn,fontFamily:vi[i],fontSize:Zi[s],minWidth:a.w,maxWidth:Math.max(0,Math.ceil(a.w+c[s]),Math.ceil(o/e.props.scale-_r*2))});return{w:l.w+_r*2,h:l.h+_r*2}}function lce(){const[n,e]=E.useState(!1);return E.useEffect(()=>{const i=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");e(i&&s.matches);const o=()=>e(i&&s.matches);return s.addEventListener("change",o),()=>s.removeEventListener("change",o)},[]),ne(Dt.forceSrgb)||!n?"srgb":"p3"}const IO=.35,EO=.82;class uce extends Gs{static type="highlight";static props=KF;static migrations=VF;hideResizeHandles=e=>sd(e);hideRotateHandle=e=>sd(e);hideSelectionBoundsFg=e=>sd(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const r=oo(e);if(sd(e))return new W_({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:s}=kO(e,r,!0),o=tC({strokeWidth:s,showAsComplete:!0});return kf(i,o),new Ot({points:Y_(i,o),isFilled:!0})}component(e){const r=TS(this.editor,e),i=oo(e);return f.jsx($s,{id:e.id,children:f.jsx(od,{shape:e,forceSolid:r,strokeWidth:i,opacity:IO})})}backgroundComponent(e){const r=TS(this.editor,e),i=oo(e);return f.jsx($s,{id:e.id,children:f.jsx(od,{shape:e,forceSolid:r,strokeWidth:i,opacity:EO})})}indicator(e){const r=TS(this.editor,e),i=oo(e),{strokePoints:s,sw:o}=kO(e,i,r),a=Ra(e.props.segments);let c;return s.length<2?c=hce(a[0],o):c=Mo(s,!1),f.jsx("path",{d:c})}toSvg(e){const r=oo(e),i=r<1.5,s=1/e.props.scale;return f.jsx("g",{transform:`scale(${s})`,children:f.jsx(od,{forceSolid:i,strokeWidth:r,shape:e,opacity:IO})})}toBackgroundSvg(e){const r=oo(e),i=r<1.5,s=1/e.props.scale;return f.jsx("g",{transform:`scale(${s})`,children:f.jsx(od,{forceSolid:i,strokeWidth:r,shape:e,opacity:EO})})}onResize=(e,r)=>{const{scaleX:i,scaleY:s}=r,o=[];for(const a of e.props.segments)o.push({...a,points:a.points.map(({x:c,y:l,z:u})=>({x:i*c,y:s*l,z:u}))});return{props:{segments:o}}}}function dce(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function hce(n,e){const r=e/2;return`M ${n.x} ${n.y} m -${r}, 0 a ${r},${r} 0 1,0 ${r*2},0 a ${r},${r} 0 1,0 -${r*2},0`}function kO(n,e,r){const i=Ra(n.props.segments),s=n.props.isComplete||rn(n.props.segments)?.type==="straight";let o=e;!r&&!n.props.isPen&&i.length===1&&(o+=ti(n.id)()*(e/6));const a=tC({strokeWidth:o,showAsComplete:s});return{strokePoints:_i(i,a),sw:o}}function oo(n){return Aa[n.props.size]*1.12*n.props.scale}function sd(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function od({strokeWidth:n,forceSolid:e,shape:r,opacity:i}){const s=Dr(),o=Ra(r.props.segments);let a=n;!e&&!r.props.isPen&&o.length===1&&(a+=ti(r.id)()*(a/6));const c=tC({strokeWidth:a,showAsComplete:r.props.isComplete||rn(r.props.segments)?.type==="straight"}),l=_i(o,c),u=l.length>1?Mo(l,!1):dce(r.props.segments[0].points[0]),d=lce(),h=s[r.props.color].highlight[d];return f.jsx("path",{d:u,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:a,opacity:i})}function TS(n,e){return ne("forceSolid",()=>{const r=oo(e),i=n.getZoomLevel();return r/i<1.5},[n])}function H$(){return f.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[f.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),f.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),f.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function G$(n,e,r){const i=Z(),[s,o]=E.useState(null),a=e?i.getAsset(e):null,l=i.getCulledShapes().has(n),u=E.useRef(!1);E.useEffect(()=>{s&&(u.current=!0)},[s]);const d=a&&"w"in a.props?r/a.props.w:1,h=ne("zoom level",()=>i.getZoomLevel()*d,[i,d]);return E.useEffect(()=>{if(l)return;let p=!1;const g=i.timers.setTimeout(async()=>{const y=await i.resolveAssetUrl(e,{screenScale:h});p||o(y)},u.current?500:0);return()=>{clearTimeout(g),p=!0}},[e,a?.props.src,l,h,i]),{asset:a,url:s}}function K$(){const[n,e]=E.useState(!1);return E.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-reduced-motion: reduce)"),i=()=>{e(r.matches)};return i(),r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),n}async function fce(n){const r=await(await bi(n)).blob();return mo.blobToDataUrl(r)}class pce extends Xa{static type="image";static props=WF;static migrations=YF;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize=(e,r)=>{let i=K_(e,r);const{flipX:s,flipY:o}=r.initialShape.props;return i={...i,props:{...i.props,flipX:r.scaleX<0!==s,flipY:r.scaleY<0!==o}},i};isAnimated(e){const r=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return r?"mimeType"in r.props&&di.isAnimatedImageType(r?.props.mimeType)||"isAnimated"in r.props&&r.props.isAnimated:!1}component(e){const r=this.editor.getCroppingShapeId()===e.id,i=K$(),[s,o]=E.useState(""),[a,c]=E.useState(""),l=e.id===this.editor.getOnlySelectedShapeId(),{asset:u,url:d}=G$(e.id,e.props.assetId,e.props.w);if(E.useEffect(()=>{if(d){let y=!1;const v=ka();return v.onload=()=>{y||c(d)},v.src=d,()=>{y=!0}}},[d,e]),E.useEffect(()=>{if(d&&this.isAnimated(e)){let y=!1;const v=ka();return v.onload=()=>{if(y)return;const x=document.createElement("canvas");x.width=v.width,x.height=v.height;const m=x.getContext("2d");m&&(m.drawImage(v,0,0),o(x.toDataURL()),c(d))},v.crossOrigin="anonymous",v.src=d,()=>{y=!0}}},[i,d,e]),u?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");const h=l&&r&&this.editor.isIn("select.crop"),p=i&&(u?.props.mimeType?.includes("video")||this.isAnimated(e)),g=TO(e);return u?.props.src?a?f.jsxs(f.Fragment,{children:[h&&f.jsx("div",{style:g,children:f.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||p?s:a,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),f.jsxs(To,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[f.jsxs("div",{className:"tl-image-container",style:g,children:[f.jsx("img",{className:Me("tl-image",{"tl-flip-x":e.props.flipX&&!e.props.flipY,"tl-flip-y":e.props.flipY&&!e.props.flipX,"tl-flip-xy":e.props.flipY&&e.props.flipX}),crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||p?s:a,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(e)&&!e.props.playing&&f.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),e.props.url&&f.jsx(ja,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:f.jsxs(To,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:u?"transparent":"var(--color-low)",border:u?"none":"1px solid var(--color-low-border)"},children:[f.jsx("div",{className:"tl-image-container",style:g,children:u?null:f.jsx(H$,{})}),"url"in e.props&&e.props.url&&f.jsx(ja,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:f.jsx("rect",{width:W(e.props.w),height:W(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let i=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!i)return null;(i.startsWith("blob:")||i.startsWith("http")||i.startsWith("/")||i.startsWith("./"))&&(i=await fce(i)||"");const s=TO(e),o=e.props.crop;if(s.transform&&o){const{transform:a,width:c,height:l}=s,u=(o.bottomRight.x-o.topLeft.x)*c,d=(o.bottomRight.y-o.topLeft.y)*l,h=[new k(0,0),new k(u,0),new k(u,d),new k(0,d)],p=`cropClipPath_${e.id.replace(":","_")}`;return f.jsxs(f.Fragment,{children:[f.jsx("defs",{children:f.jsx("clipPath",{id:p,children:f.jsx("polygon",{points:h.map(g=>`${g.x},${g.y}`).join(" ")})})}),f.jsx("g",{clipPath:`url(#${p})`,children:f.jsx("image",{href:i,width:c,height:l,style:{transform:a}})})]})}else return f.jsx("image",{href:i,width:e.props.w,height:e.props.h})}onDoubleClick=e=>{const r=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;!r||!(r.props.src&&this.isAnimated(e))||this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{const r=e.props;if(!r||this.editor.getCroppingShapeId()!==e.id)return;const i=ft(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},s=1/(i.bottomRight.x-i.topLeft.x)*e.props.w,o=1/(i.bottomRight.y-i.topLeft.y)*e.props.h,a=new k(i.topLeft.x*s,i.topLeft.y*o).rot(e.rotation),c={id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:s,h:o}};this.editor.updateShapes([c])}}function TO(n){const e=n.props.crop,r=e?.topLeft;if(!r)return{width:n.props.w,height:n.props.h};const i=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,s=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,o=-r.x*i,a=-r.y*s;return{transform:`translate(${o}px, ${a}px)`,width:i,height:s}}function V$(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function W$(n,e,r){const i=e.vertices,s=V$(r);return _i(i,s)}function gce(n,e,r){const i=V$(r);return Y_(kf(W$(n,e,r),i),i)}function mce(n,e,r){const i=gce(n,e,r);return R_(i)}function yce(n,e,r){if(n.props.dash==="draw"){const i=W$(n,e,r);return Mo(i)}return e.getSvgPathData()}function Y$(n,e,r){let i=`M ${Qe(e[0])}L`,s=`M ${Qe(e[0])}L`;const o=r/3,a=r*2,c=ti(n);let l=e[0],u,d=e[0],h;const p=e.length;for(let g=0,y=p-1;g<y;g++){u=e[g+1],h=k.AddXY(e[g+1],c()*o,c()*o);const v=k.Sub(u,l),x=k.Len(v),m=k.Div(v,x).mul(Math.min(x/4,a)),b=k.Add(l,m),S=k.Add(u,m.neg()),w=k.Sub(h,d),I=k.Len(w),C=k.Div(w,I).mul(Math.min(I/4,a)),_=k.Add(d,C),P=k.Add(h,C.neg());g===y-1?(i+=`${Qe(b)}L ${Qe(u)}`,s+=`${Qe(_)}L ${Qe(h)}`):(i+=`${Qe(b)}L ${Qe(S)}Q ${Qe(u)}`,s+=`${Qe(_)}L ${Qe(P)}Q ${Qe(h)}`,l=u,d=h)}return[i,i+s]}const vce=new es;class xce extends Gs{static type="line";static props=XF;static migrations=ZF;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){const[e,r]=_l(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[r]:{id:r,index:r,x:.1,y:.1}},scale:1}}getGeometry(e){return Gc(e)}getHandles(e){return vce.get(e.props,()=>{const r=Gc(e),i=Hc(e),s=i.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<i.length-1;o++){const a=wl(i[o].index,i[o+1].index),l=r.segments[o].midPoint();s.push({id:a,type:"create",index:a,x:l.x,y:l.y,canSnap:!0})}return s.sort(bn)})}onResize=(e,r)=>{const{scaleX:i,scaleY:s}=r;return{props:{points:tu(e.props.points,(o,{id:a,index:c,x:l,y:u})=>({id:a,index:c,x:l*i,y:u*s}))}}};onHandleDrag=(e,{handle:r})=>{if(r.type==="vertex")return{...e,props:{...e.props,points:{...e.props.points,[r.id]:{id:r.id,index:r.index,x:r.x,y:r.y}}}}};component(e){return f.jsx($s,{id:e.id,children:f.jsx(MO,{shape:e})})}indicator(e){const r=Yt[e.props.size]*e.props.scale,i=Gc(e),{dash:s}=e.props;let o;if(e.props.spline==="line"){const a=i.points;if(s==="solid"||s==="dotted"||s==="dashed")o="M"+a[0]+"L"+a.slice(1);else{const[c]=Y$(e.id,a,r);o=c}}else o=yce(e,i,r);return f.jsx("path",{d:o})}toSvg(e){return f.jsx(MO,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const r=Hc(e);return{points:r,getSelfSnapPoints:i=>{const s=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===i.id);return r.filter((o,a)=>Math.abs(a-s)>1).map(k.From)},getSelfSnapOutline:i=>{const s=this.getHandles(e).filter(a=>a.type==="vertex").findIndex(a=>a.id===i.id),o=Gc(e).segments.filter((a,c)=>c!==s-1&&c!==s);return o.length?new Qr({children:o}):null}}}getInterpolatedProps(e,r,i){const s=Hc(e),o=Hc(r),a=[],c=[];let l=sF;if(s.length>o.length)for(let u=0;u<s.length;u++)a[u]={...s[u]},o[u]===void 0?c[u]={...o[o.length-1],id:l}:c[u]={...o[u],id:l},l=Hr(l);else if(o.length>s.length)for(let u=0;u<o.length;u++)c[u]={...o[u]},s[u]===void 0?a[u]={...s[s.length-1],id:l}:a[u]={...s[u],id:l},l=Hr(l);else for(let u=0;u<o.length;u++)a[u]=s[u],c[u]=o[u];return{...r.props,points:Object.fromEntries(a.map((u,d)=>{const h=c[d];return[u.id,{...u,x:$n(u.x,h.x,i),y:$n(u.y,h.y,i)}]}))}}}function Hc(n){return Object.values(n.props.points).sort(bn)}function Gc(n){const e=Hc(n).map(k.From);switch(n.props.spline){case"cubic":return new Cse({points:e});case"line":return new Ya({points:e})}}function MO({shape:n,shouldScale:e=!1}){const r=Dr(),i=Gc(n),{dash:s,color:o,size:a}=n.props,c=1/n.props.scale,l=e?c:1,u=Yt[a]*n.props.scale;if(n.props.spline==="line"){if(s==="solid"){const d=i.points,h="M"+d[0]+"L"+d.slice(1);return f.jsx("path",{d:h,stroke:r[o].solid,strokeWidth:u,fill:"none",transform:`scale(${l})`})}if(s==="dashed"||s==="dotted")return f.jsx("g",{stroke:r[o].solid,strokeWidth:u,transform:`scale(${l})`,children:i.segments.map((d,h)=>{const{strokeDasharray:p,strokeDashoffset:g}=li(d.length,u,{style:s,start:h>0?"outset":"none",end:h<i.segments.length-1?"outset":"none"});return f.jsx("path",{strokeDasharray:p,strokeDashoffset:g,d:d.getSvgPathData(!0),fill:"none"},h)})});if(s==="draw"){const d=i.points,[h,p]=Y$(n.id,d,u);return f.jsx("path",{d:p,stroke:r[o].solid,strokeWidth:u,fill:"none",transform:`scale(${l})`})}}if(n.props.spline==="cubic"){const d=i.getSvgPathData();if(s==="solid")return f.jsx("path",{strokeWidth:u,stroke:r[o].solid,fill:"none",d,transform:`scale(${l})`});if(s==="dashed"||s==="dotted")return f.jsx("g",{stroke:r[o].solid,strokeWidth:u,transform:`scale(${l})`,children:i.segments.map((h,p)=>{const{strokeDasharray:g,strokeDashoffset:y}=li(h.length,u,{style:s,start:p>0?"outset":"none",end:p<i.segments.length-1?"outset":"none"});return f.jsx("path",{strokeDasharray:g,strokeDashoffset:y,d:h.getSvgPathData(),fill:"none"},p)})});if(s==="draw")return f.jsx("path",{d:mce(n,i,u),strokeWidth:1,stroke:r[o].solid,fill:r[o].solid,transform:`scale(${l})`})}}const X$=E.createContext(null);function bce({assetUrls:n,children:e}){return E.useEffect(()=>{for(const r of Object.values(n.icons)){const i=ka();i.src=r,i.decode()}for(const r of Object.values(n.embedIcons)){const i=ka();i.src=r,i.decode()}},[n]),f.jsx(X$.Provider,{value:n,children:e})}function rC(){const n=E.useContext(X$);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const Fw={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Sce=new Set(["ar","fa","he","ur","ku"]),Qo={locale:"en",label:"English",messages:Fw,dir:"ltr"};async function wce(n,e){if(!(await bi(e.translations.en)).ok)return console.warn("No main translations found."),Qo;if(n==="en")return Qo;const i=Pl.find(a=>a.locale===n);if(!i)return console.warn(`No translation found for locale ${n}`),Qo;const o=await(await bi(e.translations[i.locale])).json();if(!o)return console.warn(`No messages found for locale ${n}`),Qo;for(const a in Qo.messages)o[a];return{locale:n,label:i.label,dir:Sce.has(i.locale)?"rtl":"ltr",messages:{...Qo.messages,...o}}}const Z$=E.createContext(null);function Q$(){const n=E.useContext(Z$);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}const _ce=Qt(function({overrides:e,children:r}){const s=Z().user.getLocale(),o=rC(),[a,c]=E.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...Fw,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:Fw});return E.useEffect(()=>{let l=!1;async function u(){const d=await wce(s,o);d&&!l&&(e&&e[s]?c({...d,messages:{...d.messages,...e[s]}}):c(d))}return u(),()=>{l=!0}},[o,s,e]),f.jsx(Z$.Provider,{value:a,children:r})});function Ge(){const n=Q$();return E.useCallback(function(r){return n.messages[r]??r},[n])}class Cce extends Gs{static type="note";static props=QF;static migrations=JF;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!1;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:r,labelWidth:i}=J$(this.editor,e),{scale:s}=e.props,o=r*s,a=i*s,c=ot*s,l=ad(e);return new Qr({children:[new ns({width:c,height:l,isFilled:!0}),new ns({x:e.props.align==="start"?0:e.props.align==="end"?c-a:(c-a)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?l-o:(l-o)/2,width:a,height:o,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:r}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*r<.25)return[];const o=ad(e),a=ot*r,c=zoe/s*r;return s*r<.5?[{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+c}]:[{id:"top",index:"a1",type:"clone",x:a/2,y:-c},{id:"right",index:"a2",type:"clone",x:a+c,y:o/2},{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+c},{id:"left",index:"a4",type:"clone",x:-c,y:o/2}]}component(e){const{id:r,type:i,props:{scale:s,color:o,font:a,size:c,align:l,text:u,verticalAlign:d,fontSizeAdjustment:h}}=e,p=Ece(r),g=Dr(),y=ot*s,v=ad(e),x=ne("shape rotation",()=>this.editor.getShapePageTransform(r)?.rotation()??0,[this.editor]),m=ne("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),b=e.id===this.editor.getOnlySelectedShapeId();return f.jsxs(f.Fragment,{children:[f.jsx("div",{id:r,className:"tl-note__container",style:{width:y,height:v,backgroundColor:g[o].note.fill,borderBottom:m?`${3*s}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:m?"none":kce(e.id,x,s)},children:f.jsx(jf,{id:r,type:i,font:a,fontSize:(h||Zi[c])*s,lineHeight:cn.lineHeight,align:l,verticalAlign:d,text:u,isNote:!0,isSelected:b,labelColor:g[o].note.text,wrap:!0,padding:16*s,onKeyDown:p})}),"url"in e.props&&e.props.url&&f.jsx(ja,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{scale:r}=e.props;return f.jsx("rect",{rx:r,width:W(ot*r),height:W(ad(e))})}toSvg(e,r){e.props.text&&r.addExportDef(Mf(e.props.font));const i=ds({isDarkMode:r.isDarkMode}),s=Tce(e);return f.jsxs(f.Fragment,{children:[f.jsx("rect",{x:5,y:5,rx:1,width:ot-10,height:s.h,fill:"rgba(0,0,0,.1)"}),f.jsx("rect",{rx:1,width:ot,height:s.h,fill:i[e.props.color].note.fill}),f.jsx(Af,{fontSize:e.props.fontSizeAdjustment||Zi[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:i[e.props.color].note.text,bounds:s,stroke:!1})]})}onBeforeCreate=e=>AO(this.editor,e);onBeforeUpdate=(e,r)=>{if(!(e.props.text===r.props.text&&e.props.font===r.props.font&&e.props.size===r.props.size))return AO(this.editor,r)};onEditEnd=e=>{const{id:r,type:i,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])}}function AO(n,e){const{labelHeight:r,fontSizeAdjustment:i}=J$(n,e),s=Math.max(0,r-ot);if(s!==e.props.growY||i!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:s,fontSizeAdjustment:i}}}function Pce(n,e){const{text:r}=e.props;if(!r)return{labelHeight:Zi[e.props.size]*cn.lineHeight+_r*2,labelWidth:100,fontSizeAdjustment:0};const i=Zi[e.props.size];let s=0,o=0,a=ot,c=ot;const l=1;do{s=Math.min(i,i-o);const u=n.textMeasure.measureText(r,{...cn,fontFamily:vi[e.props.font],fontSize:s,maxWidth:ot-_r*2-l,disableOverflowWrapBreaking:!0});if(a=u.h+_r*2,c=u.w+_r*2,s<=14){const d=n.textMeasure.measureText(r,{...cn,fontFamily:vi[e.props.font],fontSize:s,maxWidth:ot-_r*2-l});a=d.h+_r*2,c=d.w+_r*2;break}if(u.scrollWidth.toFixed(0)===u.w.toFixed(0))break}while(o++<50);return{labelHeight:a,labelWidth:c,fontSizeAdjustment:s}}const Ice=new es;function J$(n,e){return Ice.get(e,()=>Pce(n,e))}function Ece(n){const e=Z(),r=Q$();return E.useCallback(i=>{const s=e.getShape(n);if(!s)return;const o=i.key==="Tab",a=(i.metaKey||i.ctrlKey)&&i.key==="Enter";if(o||a){i.preventDefault();const c=e.getShapePageTransform(n),l=c.rotation(),u=!!(r.dir==="rtl"||_$(s.props.text)),d=(ot+e.options.adjacentShapeMargin+(a&&!i.shiftKey?s.props.growY:0))*s.props.scale,h=new k(o?i.shiftKey!=u?-1:1:0,a?i.shiftKey?-1:1:0).mul(d).add(Tf.clone().mul(s.props.scale)).rot(l).add(c.point()),p=j$(e,s,h,l);p&&(e.mark("editing adjacent shape"),fh(e,p,!0))}},[n,e,r.dir])}function ad(n){return(ot+n.props.growY)*n.props.scale}function kce(n,e,r){const i=ti(n),s=Math.abs(i())+.5,o=Math.cos(e),a=5*r,c=4*r,l=6*r,u=7*r;return`0px ${a-s}px ${a}px -${a}px rgba(15, 23, 31, .6),
	0px ${(c+s*u)*Math.max(0,o)}px ${l+s*u}px -${c+s*l}px rgba(15, 23, 31, ${(.3+s*.1).toFixed(2)}), 
	0px ${48*r}px ${10*r}px -${10*r}px inset rgba(15, 23, 44, ${((.022+i()*.005)*((1+o)/2)).toFixed(2)})`}function Tce(n){return new pe(0,0,ot,ot+n.props.growY)}function Mce(n,{initialBounds:e,scaleX:r,scaleY:i,newPoint:s}){const o=Math.max(.01,Math.min(Math.abs(r),Math.abs(i))),a=new k(0,0);r<0&&(a.x=-(e.width*o)),i<0&&(a.y=-(e.height*o));const{x:c,y:l}=k.Add(s,a.rot(n.rotation));return{x:c,y:l,props:{scale:o*n.props.scale}}}const Ace=new es;class jce extends Gs{static type="text";static props=ez;static migrations=tz;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return Ace.get(e.props,r=>jO(this.editor,r))}getGeometry(e){const{scale:r}=e.props,{width:i,height:s}=this.getMinDimensions(e);return new ns({width:i*r,height:s*r,isFilled:!0,isLabel:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){const{id:r,props:{font:i,size:s,text:o,color:a,scale:c,textAlign:l}}=e,{width:u,height:d}=this.getMinDimensions(e),h=e.id===this.editor.getOnlySelectedShapeId(),p=Dr(),g=Rce(r);return f.jsx(jf,{id:r,classNamePrefix:"tl-text-shape",type:"text",font:i,fontSize:Aa[s],lineHeight:cn.lineHeight,align:l,verticalAlign:"middle",text:o,labelColor:p[a].solid,isSelected:h,textWidth:u,textHeight:d,style:{transform:`scale(${c})`,transformOrigin:"top left"},wrap:!0,onKeyDown:g})}indicator(e){const r=this.editor.getShapeGeometry(e).bounds,i=Z();return e.props.autoSize&&i.getEditingShapeId()===e.id?null:f.jsx("rect",{width:W(r.width),height:W(r.height)})}toSvg(e,r){e.props.text&&r.addExportDef(Mf(e.props.font));const i=this.editor.getShapeGeometry(e).bounds,s=i.width/(e.props.scale??1),o=i.height/(e.props.scale??1),a=ds(r);return f.jsx(Af,{fontSize:Aa[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:a[e.props.color].solid,bounds:new pe(0,0,s,o),padding:0})}onResize=(e,r)=>{const{newPoint:i,initialBounds:s,initialShape:o,scaleX:a,handle:c}=r;if(r.mode==="scale_shape"||c!=="right"&&c!=="left")return{id:e.id,type:e.type,...Mce(e,r)};{const l=Math.max(1,Math.abs(s.width*a)),{x:u,y:d}=a<0?k.Sub(i,k.FromAngle(e.rotation).mul(l)):i;return{id:e.id,type:e.type,x:u,y:d,props:{w:l/o.props.scale,autoSize:!1}}}};onEditEnd=e=>{const{id:r,type:i,props:{text:s}}=e,o=e.props.text.trimEnd();o.length===0?this.editor.deleteShapes([e.id]):o!==e.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])};onBeforeUpdate=(e,r)=>{if(!r.props.autoSize)return;const i=e.props.size!==r.props.size||e.props.textAlign!==r.props.textAlign||e.props.font!==r.props.font||e.props.scale!==1&&r.props.scale===1,s=e.props.text!==r.props.text;if(!i&&!s)return;const o=this.getMinDimensions(e),a=jO(this.editor,r.props),c=o.width*e.props.scale,l=o.height*e.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.textAlign){case"middle":{h=new k((u-c)/2,s?0:(d-l)/2);break}case"end":{h=new k(u-c,s?0:(d-l)/2);break}default:{if(s)break;h=new k(0,(d-l)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:g}=r;return{...r,x:p-h.x,y:g-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}}}function jO(n,e){const{font:r,text:i,autoSize:s,size:o,w:a}=e,c=s?16:Math.max(16,a),l=Aa[o],u=s?null:Math.floor(Math.max(c,a)),d=n.textMeasure.measureText(i,{...cn,fontFamily:vi[r],fontSize:l,maxWidth:u});return s&&(d.w+=1),{width:Math.max(c,d.w),height:Math.max(l,d.h)}}function Rce(n){const e=Z();return E.useCallback(r=>{if(e.getEditingShapeId()===n)switch(r.key){case"Enter":{(r.ctrlKey||r.metaKey)&&e.complete();break}case"Tab":{We(r),r.shiftKey?tn.unindent(r.currentTarget):tn.indent(r.currentTarget);break}}},[e,n])}class Oce extends Xa{static type="video";static props=nz;static migrations=rz;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:r}=this,i=r.getShapeGeometry(e).bounds.w*r.getZoomLevel()>=110,{asset:s,url:o}=G$(e.id,e.props.assetId,e.props.w),{time:a,playing:c}=e.props,l=Ef(e.id),u=K$(),d=E.useRef(null),h=E.useCallback(m=>{const b=m.currentTarget;b&&r.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:b.currentTime}}])},[e.id,r]),p=E.useCallback(m=>{const b=m.currentTarget;b&&r.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:b.currentTime}}])},[e.id,r]),g=E.useCallback(m=>{const b=m.currentTarget;b&&l&&r.updateShapes([{type:"video",id:e.id,props:{time:b.currentTime}}])},[l,e.id,r]),[y,v]=E.useState(!1),x=E.useCallback(m=>{const b=m.currentTarget;b&&(a!==b.currentTime&&(b.currentTime=a),c||b.pause(),v(!0))},[c,a]);return E.useEffect(()=>{const m=d.current;m&&(y&&!l&&a!==m.currentTime&&(m.currentTime=a),l&&document.activeElement!==m&&m.focus())},[l,y,a]),E.useEffect(()=>{if(u){const m=d.current;if(!m)return;m.pause(),m.currentTime=0}},[d,u]),f.jsxs(f.Fragment,{children:[f.jsx(To,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:s?"transparent":"var(--color-low)",border:s?"none":"1px solid var(--color-low-border)"},children:f.jsx("div",{className:"tl-counter-scaled",children:f.jsx("div",{className:"tl-video-container",children:s?.props.src?o?f.jsx("video",{ref:d,style:l?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:l&&i,onPlay:h,onPause:p,onTimeUpdate:g,onLoadedData:x,hidden:!y,children:f.jsx("source",{src:o})}):null:f.jsx(H$,{})})})}),"url"in e.props&&e.props.url&&f.jsx(ja,{url:e.props.url,zoomLevel:r.getZoomLevel()})]})}indicator(e){return f.jsx("rect",{width:W(e.props.w),height:W(e.props.h)})}toSvg(e){return f.jsx("image",{href:Dce(e.id),width:e.props.w,height:e.props.h})}}function Dce(n){const e=n.split(":")[1],r=document.querySelector(`.tl-video-shape-${e}`);if(r){const i=document.createElement("canvas");return i.width=r.videoWidth,i.height=r.videoHeight,i.getContext("2d").drawImage(r,0,0),i.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const e4=[jce,Tae,Uae,cce,Cce,xce,Yae,Sae,uce,Gae,pce,Oce];function Nce(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,r)=>{if(e.croppingShapeId!==r.croppingShapeId){const i=n.isIn("select.crop");!e.croppingShapeId&&r.croppingShapeId?i||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!r.croppingShapeId&&i&&n.setCurrentTool("select.idle")}e.editingShapeId!==r.editingShapeId&&(!e.editingShapeId&&r.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!r.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))}}})}class Lce extends Ee{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const o=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(o)}return!1}).map(s=>s.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()};pushPointToScribble=()=>{const{x:e,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,r)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){const{editor:e,excludedShapeIds:r}=this,i=e.getErasingShapeIds(),s=e.getZoomLevel(),o=e.getCurrentPageShapes(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=e;this.pushPointToScribble();const l=new Set(i),u=this.editor.options.hitTestMargin/s;for(const d of o){if(e.isShapeOfType(d,"group"))continue;const h=e.getShapeMask(d.id);if(h&&!ar(a,h))continue;const p=e.getShapeGeometry(d),g=e.getShapePageTransform(d);if(!p||!g)continue;const y=g.clone().invert(),v=y.applyToPoint(c),x=y.applyToPoint(a),{bounds:m}=p;m.minX-u>Math.max(v.x,x.x)||m.minY-u>Math.max(v.y,x.y)||m.maxX+u<Math.min(v.x,x.x)||m.maxY+u<Math.min(v.y,x.y)||p.hitTestLineSegment(v,x,u)&&l.add(e.getOutermostSelectableShape(d).id)}this.editor.setErasingShapes([...l].filter(d=>!r.has(d)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}let Fce=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}},zce=class extends Ee{static id="pointing";onEnter=()=>{const e=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:i}}=this.editor,s=new Set,o=s.size;for(let a=r.length,c=a-1;c>=0;c--){const l=r[c];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,i,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const u=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(u,"frame")&&s.size>o)break;s.add(u.id)}}this.editor.setErasingShapes([...s])};onLongPress=e=>{this.startErasing(e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startErasing(e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}};class $ce extends Ee{static id="eraser";static initial="idle";static isLockable=!1;static children=()=>[Fce,zce,Lce];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class Bce extends Ee{static id="dragging";initialCamera=new k;onEnter=()=>{this.initialCamera=k.From(this.editor.getCamera()),this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.parent.transition("idle")};onComplete=()=>{this.complete()};update(){const{initialCamera:e,editor:r}=this,{currentScreenPoint:i,originScreenPoint:s}=r.inputs,o=k.Sub(i,s).div(r.getZoomLevel());o.len2()!==0&&r.setCamera(e.clone().add(o))}complete(){const{editor:e}=this,{pointerVelocity:r}=e.inputs,i=Math.min(r.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:r}),this.parent.transition("idle")}}let Uce=class extends Ee{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}},qce=class extends Ee{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})};onLongPress=()=>{this.startDragging()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startDragging()};startDragging(){this.parent.transition("dragging")}onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle")}};class Hce extends Ee{static id="hand";static initial="idle";static isLockable=!1;static children=()=>[Uce,qce,Bce];onDoubleClick=e=>{if(e.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{animation:{duration:220,easing:Wt.easeOutQuint}})}};onTripleClick=e=>{if(e.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{animation:{duration:320,easing:Wt.easeOutQuint}})}};onQuadrupleClick=e=>{if(e.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({animation:{duration:400,easing:Wt.easeOutQuint}}):this.editor.resetZoom(i,{animation:{duration:320,easing:Wt.easeOutQuint}})}}}let Gce=class extends Ee{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}};class Kce extends Ee{static id="lasering";scribbleId="id";onEnter=()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};pushPointToScribble=()=>{const{x:e,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,r)};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class Vce extends Ee{static id="laser";static initial="idle";static children=()=>[Gce,Kce];static isLockable=!1;onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class Wce extends Ee{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;initialStartShape=null;onEnter=e=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=({elapsed:e})=>{const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:r,isWrapMode:i}=this,{inputs:{originPagePoint:s,currentPagePoint:o,shiftKey:a,ctrlKey:c}}=e,l=new Set(a?this.initialSelectedShapeIds:[]),u=i?!c:c,d=pe.FromPoints([s,o]),{corners:h}=d;let p,g,y,v,x,m;const b=e.getCurrentPageShapes(),S=e.getCurrentPageId();e:for(let C=0,_=b.length;C<_;C++){if(y=b[C],r.has(y.id)||l.has(y.id)||(v=e.getShapePageBounds(y),!v))continue e;if(d.contains(v)){this.handleHit(y,o,S,l,h);continue e}if(u||e.isShapeOfType(y,"frame"))continue e;if(d.collides(v)){if(x=e.getShapePageTransform(y),!x)continue e;m=x.clone().invert().applyToPoints(h);const P=e.getShapeGeometry(y);t:for(let M=0;M<4;M++)if(p=m[M],g=m[(M+1)%4],P.hitTestLineSegment(p,g,0)){this.handleHit(y,o,S,l,h);break t}}}e.getInstanceState().isCoarsePointer;const w=e.getInstanceState().brush;(!w||!d.equals(w))&&e.updateInstanceState({brush:{...d.toJson()}});const I=e.getSelectedShapeIds();(I.length!==l.size||I.some(C=>!l.has(C)))&&e.setSelectedShapes(Array.from(l))}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,r,i,s,o){if(e.parentId===i){s.add(e.id);return}const a=this.editor.getOutermostSelectableShape(e),c=this.editor.getShapeMask(a.id);c&&!Yz(c,o)&&!ar(r,c)||s.add(a.id)}}const Oa={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Yce extends Ee{static id="pointing_resize_handle";info={};updateCursor(){const e=this.editor.getSelectedShapes(),r=Oa[this.info.handle];this.editor.setCursor({type:r,rotation:e.length===1?this.editor.getSelectionRotation():0})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startResizing()};onLongPress=()=>{this.startResizing()};startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}const vr=8;class t4 extends Ee{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=Oa[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){const{shape:e,cursorHandleOffset:r}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;const s=e.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=o.clone().sub(a).rot(-e.rotation),l=s.crop??this.getDefaultCrop(),u=ft(l),d=new k(e.x,e.y),h=new k(0,0),p=1/(l.bottomRight.x-l.topLeft.x)*s.w,g=1/(l.bottomRight.y-l.topLeft.y)*s.h;let y=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<vr)break;y=!0,u.topLeft.y=u.topLeft.y+c.y/g,g*(u.bottomRight.y-u.topLeft.y)<vr?(u.topLeft.y=u.bottomRight.y-vr/g,h.y=(u.topLeft.y-l.topLeft.y)*g):u.topLeft.y<=0?(u.topLeft.y=0,h.y=(u.topLeft.y-l.topLeft.y)*g):h.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<vr)break;y=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+c.y/g),g*(u.bottomRight.y-u.topLeft.y)<vr&&(u.bottomRight.y=u.topLeft.y+vr/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(p<vr)break;y=!0,u.topLeft.x=u.topLeft.x+c.x/p,p*(u.bottomRight.x-u.topLeft.x)<vr?(u.topLeft.x=u.bottomRight.x-vr/p,h.x=(u.topLeft.x-l.topLeft.x)*p):u.topLeft.x<=0?(u.topLeft.x=0,h.x=(u.topLeft.x-l.topLeft.x)*p):h.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(p<vr)break;y=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+c.x/p),p*(u.bottomRight.x-u.topLeft.x)<vr&&(u.bottomRight.x=u.topLeft.x+vr/p);break}}if(!y)return;d.add(h.rot(e.rotation));const v={id:e.id,type:e.type,x:d.x,y:d.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*p,h:(u.bottomRight.y-u.topLeft.y)*g}};this.editor.updateShapes([v]),this.updateCursor()}complete(){this.updateShapes(),dt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),o=k.RotWith(s.getHandlePoint(this.info.handle),s.point,e),a=k.Sub(r,o);return{shape:i,cursorHandleOffset:a}}}function n4(n,e=!1){const r=n.getZoomLevel(),{inputs:{currentPagePoint:i}}=n;return n.getShapeAtPoint(i,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/r,renderingOnly:!0})??n.getSelectedShapeAtPoint(i)}function r4(n,e,r){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:i}=e.props;if(!i)return;const s=n.inputs.shiftKey?Math.abs(r.x)<Math.abs(r.y)?"x":"y":null;s==="x"?r.x=0:s==="y"&&(r.y=0),r.rot(-e.rotation);const o=1/(i.bottomRight.x-i.topLeft.x)*e.props.w,a=1/(i.bottomRight.y-i.topLeft.y)*e.props.h,c=i.bottomRight.y-i.topLeft.y,l=i.bottomRight.x-i.topLeft.x,u=ft(i);return u.topLeft.x=Math.min(1-l,Math.max(0,u.topLeft.x-r.x/o)),u.topLeft.y=Math.min(1-c,Math.max(0,u.topLeft.y-r.y/a)),u.bottomRight.x=u.topLeft.x+l,u.bottomRight.y=u.topLeft.y+c,{id:e.id,type:e.type,props:{crop:u}}}let Xce=class extends Ee{static id="idle";onEnter=()=>{this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=n4(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||e.phase!=="up")return;const r=this.editor.getCroppingShapeId();if(!r)return;const i=this.editor.getShape(r);if(!i)return;const s=this.editor.getShapeUtil(i);if(s){if(e.target==="selection"){s.onDoubleClickEdge?.(i);return}this.cancel(),this.editor.root.handleEvent(e)}};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:r}}}=this,i=r.has("ShiftLeft"),s=new k(0,0);if(r.has("ArrowLeft")&&(s.x+=1),r.has("ArrowRight")&&(s.x-=1),r.has("ArrowUp")&&(s.y+=1),r.has("ArrowDown")&&(s.y-=1),s.equals(new k(0,0)))return;i&&s.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const a=r4(this.editor,o,s);a&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([a]))}};class Zce extends Ee{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}}class i4 extends Ee{static id="pointing_crop_handle";info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const i=Oa[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startCropping()};onLongPress=()=>{this.startCropping()};startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class Qce extends Ee{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}};onKeyUp=e=>{switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,s=i.clone().sub(r),o=r4(this.editor,e,s);o&&this.editor.updateShapes([o])}}class Jce extends Ee{static id="crop";static initial="idle";static children=()=>[Xce,Qce,Zce,i4,t4];markId="";onEnter=()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)};didCancel=!1;onExit=()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)};onCancel=()=>{this.didCancel=!0}}class ele extends Ee{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{const{shape:r,isCreating:i,handle:s}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=ft(s),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[s.index]:{id:s.index,index:s.index,x:s.x,y:s.y}}}});const l=this.editor.getShapeHandles(r).find(u=>u.index===s.index);this.initialHandle=ft(l)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(r).sort(bn),a=o.findIndex(c=>c.id===e.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<o.length;c++){const l=o[c];if(l.type==="vertex"&&l.id!=="middle"&&l.id!==e.handle.id){this.initialAdjacentHandle=l;break}}if(!this.initialAdjacentHandle)for(let c=o.length-1;c>=0;c--){const l=o[c];if(l.type==="vertex"&&l.id!=="middle"&&l.id!==e.handle.id){this.initialAdjacentHandle=l;break}}if(this.editor.isShapeOfType(r,"arrow")){const c=Un(this.editor,r)[e.handle.id];this.isPrecise=!1,c?(this.editor.setHintingShapes([c.toId]),this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.update(),this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})};complete(){this.editor.snaps.clearIndicators(),dt(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){const{editor:e,shapeId:r,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:o,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:p,altKey:g,pointerVelocity:y}}=e,v=this.info.shape,x=e.getShape(r);if(!x)return;const m=e.getShapeUtil(x);let b=d.clone().sub(i).rot(-o).add(s);if(h&&a&&s.id!=="middle"){const C=k.Angle(a,b),P=oh(C,24)-C;b=k.RotWith(b,a,P)}e.snaps.clearIndicators();let S={...s,x:b.x,y:b.y};if(s.canSnap&&(l?!p:p)){if(!e.getShapePageTransform(x.id))throw Error("Expected a page transform");const _=u.handles.snapHandle({currentShapeId:r,handle:S});_&&(_.nudge.rot(-e.getShapeParentTransform(x).rotation()),b.add(_.nudge),S={...s,x:b.x,y:b.y})}const w=m.onHandleDrag?.(x,{handle:S,isPrecise:this.isPrecise||g,initial:v}),I={id:x.id,type:x.type,...w};if(s.type==="vertex"&&this.editor.isShapeOfType(x,"arrow")){const C=Un(e,x)[s.id];C?c[0]!==C.toId&&(e.setHintingShapes([C.toId]),this.pointingId=C.toId,this.isPrecise=y.len()<.5||g,this.isPreciseId=this.isPrecise?C.toId:null,this.resetExactTimeout()):c.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}w&&e.updateShapes([I])}}function s4(n){return n.isLabel?[n]:n instanceof Qr?n.children.filter(e=>e.isLabel):[]}class tle extends Ee{static id="editing_shape";hitShapeForPointerUp=null;onEnter=()=>{const e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,Vi(this.editor),this.editor.select(e)};onExit=()=>{const{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null),Vi.cancel();const r=this.editor.getShape(e);this.editor.getShapeUtil(r).onEditEnd?.(r)};onPointerMove=e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{Vi(this.editor);return}}};onPointerDown=e=>{switch(this.hitShapeForPointerUp=null,e.target){case"shape":{const{shape:r}=e,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),o=s4(s),a=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(a&&!c){const l=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(l,0)&&a.hitTestPoint(l)){if(r.id===i.id)return;this.hitShapeForPointerUp=r,this.editor.mark("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e));else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onPointerUp=e=>{const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getInstanceState().isReadonly&&!i.canEditInReadOnly(r)){this.parent.transition("pointing_shape",e);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),Vi(this.editor)}};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}}function RO(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function mh(n){const e=n.getSelectedShapeIds(),{shiftKey:r,altKey:i,currentPagePoint:s}=n.inputs,o=n.getShapeAtPoint(s,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:a=>!a.isLocked});if(o){const a=n.getOutermostSelectableShape(o);if(r&&!i)n.cancelDoubleClick(),e.includes(a.id)?(n.mark("deselecting shape"),n.deselect(a)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,a.id]));else{let c;a===o||a.id===n.getFocusedGroupId()||e.includes(a.id)?c=o:c=a,c&&!e.includes(c.id)&&(n.mark("selecting shape"),n.select(c.id))}}else{if(r)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const a=n.getFocusedGroupId();if(zn(a)){const c=n.getShape(a);n.isPointInShape(c,s,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const nle=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let rle=class extends Ee{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),Vi(this.editor),this.editor.setCursor({type:"default",rotation:0})};onExit=()=>{Vi.cancel()};onPointerMove=()=>{Vi(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;const r=e.ctrlKey&&RO(this.editor);if(e.ctrlKey&&!r){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const i=n4(this.editor);if(i&&!i.isLocked){this.onPointerDown({...e,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&OO(this.editor,a)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:i}=e;if(this.isOverArrowLabelTest(i)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{r?this.parent.transition("crop.pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const i=this.editor.getHoveredShape();if(i&&!this.editor.getSelectedShapeIds().includes(i.id)&&!i.isLocked){this.onPointerDown({...e,shape:i,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}};onDoubleClick=e=>{if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),s=this.editor.getFocusedGroupId();if(i){if(this.editor.isShapeOfType(i,"group")){mh(this.editor);return}else{const o=this.editor.getShape(i.parentId);if(o&&this.editor.isShapeOfType(o,"group")&&!(s&&o.id===s)){mh(this.editor);return}}this.onDoubleClick({...e,shape:i,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const r=this.editor.getOnlySelectedShape();if(r){const i=this.editor.getShapeUtil(r);if(!this.canInteractWithShapeInReadOnly(r))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const s=i.onDoubleClickEdge?.(r);if(s){this.editor.mark("double click edge"),this.editor.updateShapes([s]),dt(this.editor,[r.id]);return}}if(i.canCrop(r)&&!this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(r)&&this.startEditingShape(r,e,!0)}break}case"shape":{const{shape:r}=e,i=this.editor.getShapeUtil(r);if(r.type!=="video"&&r.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(i.onDoubleClick){const s=i.onDoubleClick?.(r);if(s){this.editor.updateShapes([s]);return}else if(i.canCrop(r)&&!this.editor.isShapeOrAncestorLocked(r)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(r)?this.startEditingShape(r,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:r,handle:i}=e,o=this.editor.getShapeUtil(r).onDoubleClickHandle?.(r,i);o?this.editor.updateShapes([o]):this.shouldStartEditingShape(r)&&this.startEditingShape(r,e,!0)}}};onRightClick=e=>{switch(e.target){case"canvas":{const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(i){this.onRightClick({...e,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&OO(this.editor,a)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:r}=this.editor.getCurrentPageState(),{shape:i}=e,s=this.editor.getOutermostSelectableShape(i,o=>!r.includes(o.id));!r.includes(s.id)&&!this.editor.findShapeAncestor(s,o=>r.includes(o.id))&&(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(Dt.editOnType.get()&&!nle.includes(e.key)&&!e.altKey&&!e.ctrlKey){const r=this.editor.getOnlySelectedShape();if(r&&this.editor.isShapeOfType(r,"note")&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}};onKeyUp=e=>{switch(e.code){case"Enter":{const r=this.editor.getSelectedShapes();if(r.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(r.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const i=this.editor.getOnlySelectedShape();if(i&&this.shouldStartEditingShape(i)){this.startEditingShape(i,{...e,target:"shape",shape:i},!0);return}RO(this.editor)&&this.parent.transition("crop",e);break}}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,r,i){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),fh(this.editor,e,i),this.parent.transition("editing_shape",r))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;isOverArrowLabelTest(e){if(!e)return!1;const r=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const i=this.editor.getShapeGeometry(e).children[1];if(i&&ar(r,i.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const r=it(),{x:i,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:r,type:"text",x:i,y:s,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(r);if(!o)return;const a=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!a.canEditInReadOnly(o)||(this.editor.setEditingShape(r),this.editor.select(r),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:r}}}=this,i=r.has("ShiftLeft"),s=new k(0,0);if(r.has("ArrowLeft")&&(s.x-=1),r.has("ArrowRight")&&(s.x+=1),r.has("ArrowUp")&&(s.y-=1),r.has("ArrowDown")&&(s.y+=1),s.equals(new k(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),a=this.editor.getInstanceState().isGridMode?i?o*ole:o:i?ile:sle,c=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(c,s.mul(a)),dt(this.editor,c)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}};const ile=10,sle=1,ole=5;function OO(n,e){const r=n.getSelectionRotatedPageBounds();if(!r)return!1;const i=n.getSelectionRotation();return i?ar(e,r.corners.map(s=>k.RotWith(s,r.point,i))):r.containsPoint(e)}class ale extends Ee{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter=e=>{const{shape:r}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=r.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,o);this._labelDragOffset=k.Sub(s.center,a),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};_labelDragOffset=new k(0,0);onPointerMove=()=>{const{isDragging:e}=this.editor.inputs;if(!e)return;const r=this.editor.getShape(this.shapeId);if(!r)return;const i=fi(this.editor,r),s=this.editor.getShapeGeometry(r),o=s.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),c=o.nearestPoint(k.Add(a,this._labelDragOffset));let l;if(i.isStraight){const u=k.Dist(i.start.point,i.end.point);l=1-k.Dist(i.end.point,c)/u}else{const{_center:u,measure:d,angleEnd:h,angleStart:p}=s.children[0];l=bw(d,p,h,u.angle(c))}isNaN(l)&&(l=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:l}})};onPointerUp=()=>{const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class cle extends Ee{static id="pointing_canvas";onEnter=()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{mh(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle")};complete(){this.parent.transition("idle")}}class lle extends Ee{static id="pointing_handle";info={};onEnter=e=>{this.info=e;const{shape:r}=e;if(this.editor.isShapeOfType(r,"arrow")){const i=Un(this.editor,r)[e.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})};onPointerUp=()=>{const{shape:e,handle:r}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:i}=this,s=DO(i,e,r,!1);if(s){fh(i,s,!0);return}}this.parent.transition("idle",this.info)};onPointerMove=()=>{const{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()};onLongPress=()=>{this.startDraggingHandle()};startDraggingHandle(){const{editor:e}=this;if(e.getInstanceState().isReadonly)return;const{shape:r,handle:i}=this.info;if(e.isShapeOfType(r,"note")){const s=DO(e,r,i,!0);if(s){const o=e.getPointInParentSpace(s,e.inputs.originPagePoint).sub(k.Rot(Tf.clone().mul(r.props.scale),s.rotation));e.updateShape({...s,x:o.x,y:o.y}),e.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{fh(e,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}function DO(n,e,r,i){const s=n.getShapePageTransform(e.id),o=s.point(),a=s.rotation(),l=M$(n,o,a,e.props.growY,0,e.props.scale)[r.index];if(l)return j$(n,e,l,a,i)}class ule extends Ee{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:Oa[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter=e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startRotating()};onLongPress=()=>{this.startRotating()};startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class dle extends Ee{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{mh(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}onDoubleClick=e=>{const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(i)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class hle extends Ee{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didSelectOnEnter=!1;onEnter=e=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o,shiftKey:a,altKey:c}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;const l=this.editor.getOutermostSelectableShape(e.shape),u=this.editor.findShapeAncestor(l,d=>r.includes(d.id));if(this.editor.getShapeUtil(e.shape).onClick||l.id===s||r.includes(l.id)||u||r.length>1&&i?.containsPoint(o)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=l;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(l.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,l.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([l.id]))};onPointerUp=e=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o,shiftKey:a}}=this.editor,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,l=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(l){const u=this.editor.getShapeUtil(l);if(u.onClick){const d=u.onClick?.(l);if(d){this.editor.mark("shape on click"),this.editor.updateShapes([d]),this.parent.transition("idle",e);return}}if(l.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const u=this.editor.getOutermostSelectableShape(c,d=>!r.includes(d.id));if(r.includes(u.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(r.includes(l.id)){if(r.length===1){const d=this.editor.getShapeUtil(l).getGeometry(l),h=s4(d),p=h.length===1?h[0]:void 0;if(p){const g=this.editor.getPointInShapeSpace(l,o);if(p.bounds.containsPoint(g,0)&&p.hitTestPoint(g)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);const y=this.editor.getShapeUtil(l);this.editor.getInstanceState().isReadonly&&!y.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l);else if(a){const d=this.editor.getShapeAncestors(u);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(h=>!d.find(p=>p.id===h)),u.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([u.id])}this.parent.transition("idle",e)};onDoubleClick=()=>{this.isDoubleClick=!0};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",e))}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class fle extends Ee{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter=e=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()};onTick=({elapsed:e})=>{const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(dt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,r=[];e.forEach(({shape:i})=>{const o=this.editor.getShapeUtil(i).onResizeStart?.(i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,r=[];e.forEach(({shape:i})=>{const s=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i).onResizeEnd?.(i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:e,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:l,canShapesDeform:u}=this.snapshot;let d=r||!u;if(s.size===1){const _=[...s.values()][0];this.editor.isShapeOfType(_.shape,"text")&&(d=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:_}=this.editor.getDocumentSettings();p.snapToGrid(_)}const y=this.info.handle,v=NO(y,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!h:h)&&l%pt===0){const{nudge:_}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:k.Sub(p,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:NO(y,l),isAspectRatioLocked:d,isResizingFromCenter:e});p.add(_)}const m=k.RotWith(e?o.center:o.getHandlePoint(v),o.point,l),b=k.Sub(p,m).rot(-l),S=k.Sub(g,m).rot(-l),w=k.DivV(b,S);Number.isFinite(w.x)||(w.x=1),Number.isFinite(w.y)||(w.y=1);const I=y==="top"||y==="bottom",C=y==="left"||y==="right";d?C?w.y=Math.abs(w.x):I?w.x=Math.abs(w.y):Math.abs(w.x)>Math.abs(w.y)?w.y=Math.abs(w.x)*(w.y<0?-1:1):w.x=Math.abs(w.y)*(w.x<0?-1:1):(I&&(w.x=1),C&&(w.y=1)),this.info.isCreating||this.updateCursor({dragHandle:y,isFlippedX:w.x<0,isFlippedY:w.y<0,rotation:l});for(const _ of s.keys()){const P=s.get(_);this.editor.resizeShape(_,w,{initialShape:P.shape,initialBounds:P.bounds,initialPageTransform:P.pageTransform,dragHandle:y,mode:c.length===1&&_===c[0]?"resize_bounds":"scale_shape",scaleOrigin:m,isAspectRatioLocked:d,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:_,children:P}of i){if(!P.length)continue;const M=s.get(_).shape,T=this.editor.getShape(_);if(!(M&&T))continue;const A=T.x-M.x,R=T.y-M.y,O=new k(A,R).rot(-M.rotation);if(O.x!==0||O.y!==0)for(const j of P)this.editor.updateShape({id:j.id,type:j.type,x:j.x-O.x,y:j.y-O.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:_}of i)if(_.length)for(const P of _)this.editor.updateShape({id:P.id,type:P.type,x:P.x,y:P.y})}}updateCursor({dragHandle:e,isFlippedX:r,isFlippedY:i,rotation:s}){const o={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{o.type="nwse-resize",r!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",r!==i&&(o.type="nwse-resize");break}}o.rotation=s,this.editor.setCursor(o)}onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()};_createSnapshot=()=>{const e=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),o=k.RotWith(s.getHandlePoint(this.info.handle),s.point,r),a=k.Sub(i,o),c=new Map,l=[];e.forEach(d=>{const h=this.editor.getShape(d);if(h){if(h.type==="frame"&&l.push({id:d,children:Be(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),c.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&e.length===1)return;this.editor.visitDescendants(h.id,p=>{const g=this.editor.getShape(p);if(g&&(c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...c.values()].some(d=>!cz(d.pageRotation,r)||d.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:s,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:e,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:l}};_createShapeSnapshot=e=>{const r=this.editor.getShapePageTransform(e),i=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:r,pageRotation:de.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(e)}}}const MS=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function NO(n,e){e=e%rt;const r=Math.round(e/(Je/4)),i=MS.indexOf(n);return MS[(i+r)%MS.length]}const LO=Math.PI/180;class ple extends Ee{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=Qz({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});kd({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Oa[this.info.handle],rotation:i+this.snapshot.initialSelectionRotation})};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});kd({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Oa[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{kd({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),dt(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};_getRotationFromPointerPosition({snapToNearestDegree:e}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:o}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:c}=this.snapshot;if(!i)return c;const u=i.center.clone().rotWith(i.point,r).angle(o)-a;let d=c+u;if(s)d=oh(d,24);else if(e&&(d=Math.round(d/LO)*LO,this.editor.getInstanceState().isCoarsePointer)){const h=oh(d,4),p=Id(d,h);Math.abs(p)<qee(5)&&(d=h)}return d-c}}class gle extends Ee{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{const{x:e,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,r)};updateScribbleSelection(e){const{editor:r}=this,i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:s,originPagePoint:o,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:u}=this;e&&this.pushPointToScribble();const d=i;let h,p,g,y;const v=0;for(let b=0,S=d.length;b<S;b++){if(h=d[b],r.isShapeOfType(h,"group")||l.has(h.id)||r.isShapeOrAncestorLocked(h)||(p=r.getShapeGeometry(h),r.isShapeOfType(h,"frame")&&p.bounds.containsPoint(r.getPointInShapeSpace(h,o))))continue;const w=r.getShapePageTransform(h);if(!p||!w)continue;const I=w.clone().invert();g=I.applyToPoint(a),y=I.applyToPoint(c);const{bounds:C}=p;if(!(C.minX-v>Math.max(g.x,y.x)||C.minY-v>Math.max(g.y,y.y)||C.maxX+v<Math.min(g.x,y.x)||C.maxY+v<Math.min(g.y,y.y))&&p.hitTestLineSegment(g,y,v)){const _=this.editor.getOutermostSelectableShape(h),P=this.editor.getShapeMask(_.id);if(P&&z_(a,c,P)!==null&&!ar(c,P))continue;l.add(_.id)}}const x=r.getSelectedShapeIds(),m=new Set(s?[...l,...u]:[...l]);(x.length!==m.size||x.some(b=>!m.has(b)))&&this.editor.setSelectedShapes(Array.from(m))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}const mle=20,yle=100;class vle{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,r){this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,s=>s.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,mle,r):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,yle,r))}setDragTimer(e,r,i){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,i)}),this.droppingNodeTimer=null},r)}handleDrag(e,r,i){r=Be(r.map(l=>this.editor.getShape(l.id)));const s=this.editor.getDroppingOverShape(e,r)?.id??null;if(s===this.prevDroppingShapeId){this.hintParents(r);return}const{prevDroppingShapeId:o}=this,a=o&&this.editor.getShape(o),c=s&&this.editor.getShape(s);a&&this.editor.getShapeUtil(a).onDragShapesOut?.(a,r),c&&this.editor.getShapeUtil(c).onDragShapesOver?.(c,r),this.hintParents(r),i?.(),this.prevDroppingShapeId=s}hintParents(e){const r=new Map;for(const s of e){const o=this.editor.findShapeAncestor(s,a=>a.type!=="group");o&&(r.has(o.id)||r.set(o.id,[]),r.get(o.id).push(s.id))}const i=[];for(const[s,o]of r){const a=this.editor.getShape(s);a&&E$(this.editor,a).length<o.length&&i.push(a.id)}this.editor.setHintingShapes(i)}dropShapes(e){const{prevDroppingShapeId:r}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),r){const i=this.editor.getShape(r);if(!i)return;this.editor.getShapeUtil(i).onDropShapesOver?.(i,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}}class xle extends Ee{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>{};dragAndDropManager=new vle(this.editor);onEnter=e=>{const{isCreating:r=!1,onCreate:i=()=>{}}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=FO(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()};onTick=({elapsed:e})=>{const{editor:r}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),r.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=FO(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),dt(this.editor,this.snapshot.movingShapes.map(e=>e.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,r=[];e.forEach(i=>{const o=this.editor.getShapeUtil(i).onTranslateStart?.(i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const i=k.Average(e.map(o=>this.editor.getShapePageTransform(o.id).point())),s=k.Sub(i,this.selectionSnapshot.averagePagePoint);k.IsNaN(s)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(o=>o.id),offset:{x:s.x,y:s.y}}})}const r=[];e.forEach(i=>{const s=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i).onTranslateEnd?.(i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),ble({editor:this.editor,snapshot:e});const{movingShapes:r}=e,i=[];r.forEach(s=>{const o=this.editor.getShape(s.id),c=this.editor.getShapeUtil(s).onTranslate?.(s,o);c&&i.push(c)}),i.length>0&&this.editor.updateShapes(i)}updateParentTransforms=()=>{const{editor:e,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const s=e.getShape(i.shape.id);if(!s)return null;const o=Ln(s.parentId)?null:de.Inverse(e.getShapePageTransform(s.parentId));i.parentTransform=o})}}function FO(n){const e=[],r=[],i=n.getSelectedShapeIds(),s=Be(i.map(h=>{const p=n.getShape(h);if(!p)return null;e.push(p);const g=n.getShapePageTransform(h),y=g.point(),v=g.rotation();r.push(y);const x=ts.isId(p.parentId)?null:de.Inverse(n.getShapePageTransform(p.parentId));return{shape:p,pagePoint:y,pageRotation:v,parentTransform:x}})),o=n.getOnlySelectedShape();let a=[];if(o)a=n.snaps.shapeBounds.getSnapPoints(o.id);else{const h=n.getSelectionPageBounds();h&&(a=h.cornersAndCenter.map((p,g)=>({id:"selection:"+g,x:p.x,y:p.y})))}let c,l;const{originPagePoint:u}=n.inputs,d=s.filter(h=>n.isShapeOfType(h.shape,"note")&&n.isPointInShape(h.shape,u));if(d.length!==0)if(d.length===1)l=d[0];else{const h=n.getCurrentPageShapesSorted();l=d.map(p=>({snapshot:p,index:h.findIndex(g=>g.id===p.shape.id)})).sort((p,g)=>g.index-p.index)[0]?.snapshot}return l&&(c=A$(n,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:k.Average(r),movingShapes:e,shapeSnapshots:s,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:a,noteAdjacentPositions:c,noteSnapshot:l}}function ble({editor:n,snapshot:e}){const{inputs:r}=n,{noteSnapshot:i,noteAdjacentPositions:s,initialPageBounds:o,initialSnapPoints:a,shapeSnapshots:c,averagePagePoint:l}=e,u=n.getInstanceState().isGridMode,d=n.getDocumentSettings().gridSize,h=k.Sub(r.currentPagePoint,r.originPagePoint),p=n.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;if(p==="x"?h.x=0:p==="y"&&(h.y=0),n.snaps.clearIndicators(),(n.user.getIsSnapMode()?!r.ctrlKey:r.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:x}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:o,lockedAxis:p,initialSelectionSnapPoints:a});h.add(x)}else if(i&&s){const{scale:x}=i.shape.props,m=i.pagePoint.clone().add(h).add(Tf.clone().mul(x).rot(i.pageRotation));let b=T$/n.getZoomLevel(),S=new k(0,0);for(const w of s){const I=k.Sub(m,w),C=I.len();C<b&&(b=C,S=I)}h.sub(S)}const y=k.Add(l,h);u&&!r.ctrlKey&&y.snapToGrid(d);const v=k.Sub(y,l);n.updateShapes(Be(c.map(({shape:x,pagePoint:m,parentTransform:b})=>{const S=k.Add(m,v),w=b?de.applyToPoint(b,S):S;return{id:x.id,type:x.type,x:w.x,y:w.y}})))}class Sle extends Ee{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children=()=>[Jce,t4,rle,cle,hle,xle,Wce,gle,i4,dle,Yce,tle,fle,ple,ule,ale,lle,ele];cleanUpDuplicateProps=()=>{const e=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const i=new Set(r.duplicateProps.shapeIds);e.length===i.size&&e.every(s=>i.has(s))||this.editor.updateInstanceState({duplicateProps:null})};onEnter=()=>{this.reactor=$o("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})};onExit=()=>{this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class wle extends Ee{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}}class _le extends Ee{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class Cle extends Ee{static id="zoom_brushing";info={};zoomBrush=new pe;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){const{inputs:{originPagePoint:e,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(pe.FromPoints([e,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,r=8/this.editor.getZoomLevel();if(e.width<r&&e.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class Ple extends Ee{static id="zoom";static initial="idle";static children=()=>[wle,Cle,_le];static isLockable=!1;info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),e.code==="KeyZ"&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}const Ile=[$ce,Hce,Vce,Ple,Sle],o4=()=>{},a4=E.createContext(null);function Ele({onEvent:n,children:e}){return f.jsx(a4.Provider,{value:n??o4,children:e})}function un(){return E.useContext(a4)??o4}const c4=E.createContext(null);function kle({children:n}){const e=Z(),r=un(),[i,s]=E.useState([]),o=E.useCallback(u=>{const d=u.id??kt();return s(h=>[...h.filter(p=>p.id!==u.id),{...u,id:d}]),r("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d},[e,r]),a=E.useCallback((u,d)=>(s(h=>h.map(p=>p.id===u?{...p,...d}:p)),r("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u),[e,r]),c=E.useCallback(u=>(s(d=>d.filter(h=>h.id===u?(h.onClose?.(),!1):!0)),r("close-menu",{source:"dialog",id:u}),e.deleteOpenMenu(u),u),[e,r]),l=E.useCallback(()=>{s(u=>(u.forEach(d=>{d.onClose?.(),r("close-menu",{source:"dialog",id:d.id}),e.deleteOpenMenu(d.id)}),[]))},[e,r]);return f.jsx(c4.Provider,{value:{dialogs:i,addDialog:o,removeDialog:c,clearDialogs:l,updateDialog:a},children:n})}function Bo(){const n=E.useContext(c4);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const Tle=({id:n,component:e,onClose:r})=>{const{removeDialog:i}=Bo(),s=Jt(),o=E.useCallback(a=>{if(!a){if(r)try{r()}catch(c){console.warn(c)}i(n)}},[n,r,i]);return f.jsx(tU,{onOpenChange:o,defaultOpen:!0,children:f.jsx(nU,{container:s,children:f.jsx(rU,{dir:"ltr",className:"tlui-dialog__overlay",onClick:a=>{a.target===a.currentTarget&&o(!1)},children:f.jsx(iU,{dir:"ltr",className:"tlui-dialog__content",children:f.jsx(e,{onClose:()=>o(!1)})})})})})};function Mle(){const{dialogs:n}=Bo();return n.map(e=>f.jsx(Tle,{...e},e.id))}const Ale=nt.memo(Mle);function jle(){const n=Z(),e=ne("follow",()=>n.getInstanceState().followingUserId,[n]);return e?f.jsx(Rle,{userId:e}):null}function Rle({userId:n}){const e=Sf(n);return e?f.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}const l4=E.createContext(null);function Ole({children:n}){const[e,r]=E.useState([]),i=E.useCallback(a=>{const c=a.id??kt();return r(l=>[...l.filter(u=>u.id!==a.id),{...a,id:c}]),c},[]),s=E.useCallback(a=>(r(c=>c.filter(l=>l.id!==a)),a),[]),o=E.useCallback(()=>{r(()=>[])},[]);return f.jsx(KB,{children:f.jsx(l4.Provider,{value:{toasts:e,addToast:i,removeToast:s,clearToasts:o},children:n})})}function ri(){const n=E.useContext(l4);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}const Ae=E.forwardRef(function({children:e,disabled:r,type:i,...s},o){return f.jsx("button",{ref:o,type:"button",draggable:!1,disabled:r,...s,className:Me("tlui-button",`tlui-button__${i}`,s.className),children:e})});function Lt({children:n}){return f.jsx("span",{className:"tlui-button__label",children:n})}const Ci=E.memo(function({small:e,invertIcon:r,icon:i,color:s,className:o,...a}){const c=rC(),l=c.icons[i]??c.icons["question-mark-circle"],u=E.useRef(null);return E.useLayoutEffect(()=>{l||console.error(`Icon not found: ${i}. Add it to the assetUrls.icons object.`),u?.current&&(u.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[u,l,i]),i==="none"?f.jsx("div",{className:Me("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},o)}):f.jsx("div",{...a,ref:u,className:Me("tlui-icon",{"tlui-icon__small":e},o),style:{color:s,mask:`url(${l}) center 100% / 100% no-repeat`,transform:r?"scale(-1, 1)":void 0}})}),Dle={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function Nle({toast:n}){const{removeToast:e}=ri(),r=Ge(),i=a=>{a||e(n.id)},s=n.actions&&n.actions.length>0,o=n.icon||n.severity&&Dle[n.severity];return f.jsxs(WB,{onOpenChange:i,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,"data-severity":n.severity,children:[o&&f.jsx("div",{className:"tlui-toast__icon",children:f.jsx(Ci,{icon:o})}),f.jsxs("div",{className:"tlui-toast__main",children:[f.jsxs("div",{className:"tlui-toast__content",children:[n.title&&f.jsx(YB,{className:"tlui-toast__title",children:n.title}),n.description&&f.jsx(XB,{className:"tlui-toast__description",children:n.description})]}),n.actions&&f.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((a,c)=>f.jsx(ZB,{altText:a.label,asChild:!0,onClick:a.onClick,children:f.jsx(Ae,{type:a.type,children:f.jsx(Lt,{children:a.label})})},c)),f.jsx(WC,{asChild:!0,children:f.jsx(Ae,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:f.jsx(Lt,{children:n.closeLabel??r("toast.close")})})})]})]}),!s&&f.jsx(WC,{asChild:!0,children:f.jsx(Ae,{type:"normal",className:"tlui-toast__close",children:f.jsx(Lt,{children:n.closeLabel??r("toast.close")})})})]})}function Lle(){const{toasts:n}=ri();return n.map(e=>f.jsx(Nle,{toast:e},e.id))}const Fle=E.memo(Lle);function zle(){const n=Z(),{toasts:e}=ri(),[r,i]=E.useState(!1);return E.useEffect(()=>{let s=-1;return e.length?i(!0):s=n.timers.setTimeout(()=>{i(!1)},1e3),()=>{clearTimeout(s)}},[e.length,i,n]),r?f.jsx(VB,{className:"tlui-toast__viewport"}):null}function qe({icon:n,small:e,invertIcon:r}){return f.jsx(Ci,{className:"tlui-button__icon",icon:n,small:e,invertIcon:r})}const AS=[0,390,428,468,580,640,840,1023];var Rt=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(Rt||{});let zw={fonts:{draw:`${ks()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${ks()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${ks()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${ks()}/fonts/IBMPlexMono-Medium.woff2`}};function u4(n){return E.useMemo(()=>n?{fonts:{...zw.fonts,...n?.fonts}}:zw,[n])}const $le=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let bc={...zw,icons:Object.fromEntries($le.map(n=>[n,`${ks()}/icons/icon/${n}.svg`])),translations:Object.fromEntries(Pl.map(n=>[n.locale,`${ks()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(nu.map(n=>[n.type,`${ks()}/embed-icons/${n.type}.png`]))};function Ble(n){return n?{fonts:Object.assign({...bc.fonts},{...n?.fonts}),icons:Object.assign({...bc.icons},{...n?.icons}),embedIcons:Object.assign({...bc.embedIcons},{...n?.embedIcons}),translations:Object.assign({...bc.translations},{...n?.translations})}:bc}function Of({className:n,children:e}){return f.jsx("div",{className:Me("tlui-dialog__header",n),children:e})}function Df({className:n,children:e}){return f.jsx(sU,{dir:"ltr",className:Me("tlui-dialog__header__title",n),children:e})}function Nf(){return f.jsx("div",{className:"tlui-dialog__header__close",children:f.jsx(oU,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:f.jsx(Ae,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:f.jsx(qe,{small:!0,icon:"cross-2"})})})})}function Tl({className:n,children:e,style:r}){return f.jsx("div",{className:Me("tlui-dialog__body",n),style:r,children:e})}function iC({className:n,children:e}){return f.jsx("div",{className:Me("tlui-dialog__footer",n),children:e})}const Lf=E.forwardRef(function({className:e,label:r,icon:i,iconLeft:s,autoSelect:o=!1,autoFocus:a=!1,defaultValue:c,placeholder:l,onComplete:u,onValueChange:d,onCancel:h,onFocus:p,onBlur:g,shouldManuallyMaintainScrollPositionWhenFocused:y=!1,children:v,value:x},m){const b=Z(),S=E.useRef(null);E.useImperativeHandle(m,()=>S.current);const w=Ge(),I=E.useRef(c??""),C=E.useRef(c??""),[_,P]=E.useState(!1),M=E.useCallback(O=>{P(!0);const j=O.currentTarget;C.current=j.value,b.timers.requestAnimationFrame(()=>{o&&j.select()}),p?.()},[o,p,b.timers]),T=E.useCallback(O=>{const j=O.currentTarget.value;C.current=j,d?.(j)},[d]),A=E.useCallback(O=>{switch(O.key){case"Enter":{O.currentTarget.blur(),Xt(O),u?.(O.currentTarget.value);break}case"Escape":{O.currentTarget.value=I.current,O.currentTarget.blur(),Xt(O),h?.(O.currentTarget.value);break}}},[u,h]),R=E.useCallback(O=>{P(!1);const j=O.currentTarget.value;g?.(j)},[g]);return E.useEffect(()=>{if(!b.environment.isIos)return;const O=window.visualViewport;if(_&&y&&O){const j=()=>{S.current?.scrollIntoView({block:"center"})};return O.addEventListener("resize",j),O.addEventListener("scroll",j),b.timers.requestAnimationFrame(()=>{S.current?.scrollIntoView({block:"center"})}),()=>{O.removeEventListener("resize",j),O.removeEventListener("scroll",j)}}},[b,_,y]),f.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[v,r&&f.jsx("label",{children:w(r)}),s&&f.jsx(Ci,{icon:s,className:"tlui-icon-left",small:!0}),f.jsx("input",{ref:S,className:Me("tlui-input",e),type:"text",defaultValue:c,onKeyUp:A,onChange:T,onFocus:M,onBlur:R,autoFocus:a,placeholder:l,value:x}),i&&f.jsx(Ci,{icon:i,small:!!r})]})}),d4=Qt(function({onClose:e}){const r=Z(),i=Ge(),s=rC(),[o,a]=E.useState(null),[c,l]=E.useState(""),[u,d]=E.useState(null),[h,p]=E.useState(!1),g=E.useRef(-1);return f.jsxs(f.Fragment,{children:[f.jsxs(Of,{children:[f.jsx(Df,{children:o?`${i("embed-dialog.title")}  ${o.title}`:i("embed-dialog.title")}),f.jsx(Nf,{})]}),o?f.jsxs(f.Fragment,{children:[f.jsxs(Tl,{className:"tlui-embed-dialog__enter",children:[f.jsx(Lf,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:y=>{l(y);const v=Ms(y);d(v&&v.definition.type===o.type?v:null),p(!1),clearTimeout(g.current),g.current=r.timers.setTimeout(()=>p(!v),320)}}),c===""?f.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[f.jsx("span",{children:i("embed-dialog.instruction")})," ",o.instructionLink&&f.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:o.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",f.jsx(Ci,{icon:"external-link",small:!0})]})]}):f.jsx("div",{className:"tlui-embed-dialog__warning",children:h?i("embed-dialog.invalid-url"):""})]}),f.jsxs(iC,{className:"tlui-dialog__footer__actions",children:[f.jsx(Ae,{type:"normal",onClick:()=>{a(null),d(null),l("")},children:f.jsx(Lt,{children:i("embed-dialog.back")})}),f.jsx("div",{className:"tlui-embed__spacer"}),f.jsx(Ae,{type:"normal",onClick:e,children:f.jsx(Lt,{children:i("embed-dialog.cancel")})}),f.jsx(Ae,{type:"primary",disabled:!u,onClick:()=>{u&&(r.putExternalContent({type:"embed",url:c,point:r.getViewportPageBounds().center,embed:u.definition}),e())},children:f.jsx(Lt,{children:i("embed-dialog.create")})})]})]}):f.jsx(f.Fragment,{children:f.jsx(Tl,{className:"tlui-embed-dialog__list",children:nu.map(y=>f.jsxs(Ae,{type:"menu",onClick:()=>a(y),children:[f.jsx(Lt,{children:y.title}),f.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${s.embedIcons[y.type]})`}})]},y.type))})})]})});function h4(){const n=Z(),e=E.useRef();return E.useEffect(()=>{const r=window.document.createElement("input");r.type="file",r.accept=VQ,r.multiple=!0,e.current=r;async function i(s){const o=s.target.files;!o||o.length===0||(n.mark("insert media"),await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",i),()=>{e.current=void 0,r.removeEventListener("change",i)}},[n]),E.useCallback(()=>{e.current?.click()},[e])}const f4=E.createContext(null);function Ule({overrides:n,children:e}){const r=Z(),i=un(),{addDialog:s}=Bo(),o=h4(),a=E.useMemo(()=>{const c=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(u){r.setCurrentTool("select"),i("select-tool",{source:u,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(u){r.setCurrentTool("hand"),i("select-tool",{source:u,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(u){r.setCurrentTool("eraser"),i("select-tool",{source:u,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(u){r.setCurrentTool("draw"),i("select-tool",{source:u,id:"draw"})}},...[...Wr.values].map(u=>({id:u,label:`tool.${u}`,meta:{geo:u},kbd:u==="rectangle"?"r":u==="ellipse"?"o":void 0,icon:"geo-"+u,onSelect(d){r.run(()=>{r.setStyleForNextShapes(Wr,u),r.setCurrentTool("geo"),i("select-tool",{source:d,id:`geo-${u}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(u){r.setCurrentTool("arrow"),i("select-tool",{source:u,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(u){r.setCurrentTool("line"),i("select-tool",{source:u,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(u){r.setCurrentTool("frame"),i("select-tool",{source:u,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(u){r.setCurrentTool("text"),i("select-tool",{source:u,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(u){o(),i("select-tool",{source:u,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(u){r.setCurrentTool("note"),i("select-tool",{source:u,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(u){r.setCurrentTool("laser"),i("select-tool",{source:u,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(u){s({component:d4}),i("select-tool",{source:u,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(u){r.setCurrentTool("highlight"),i("select-tool",{source:u,id:"highlight"})}}];c.push();const l=Object.fromEntries(c.map(u=>[u.id,u]));return n?n(r,l,{insertMedia:o}):l},[n,r,i,o,s]);return f.jsx(f4.Provider,{value:a,children:e})}function Ff(){const n=E.useContext(f4);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const p4=nt.createContext(null);function qle({forceMobile:n=!1,children:e}){const r=Z(),i=ne("breakpoint",()=>{const{width:s}=r.getViewportScreenBounds(),o=n?Rt.MOBILE_SM:AS.length-1;for(let a=0;a<o;a++)if(s>AS[a]&&s<=AS[a+1])return a;return o},[r]);return f.jsx(p4.Provider,{value:i,children:e})}function jn(){const n=E.useContext(p4);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}function Hle(){const{addToast:n,removeToast:e,clearToasts:r}=ri(),{addDialog:i,clearDialogs:s,removeDialog:o,updateDialog:a}=Bo(),l=jn()<Rt.TABLET_SM,u=Ge();return E.useMemo(()=>({addToast:n,removeToast:e,clearToasts:r,addDialog:i,clearDialogs:s,removeDialog:o,updateDialog:a,msg:u,isMobile:l}),[i,n,s,r,u,o,e,a,l])}function Gle(n,e){const r={};for(const i of n)if(i.translations)for(const[s,o]of Wn(i.translations)){let a=r[s];a||(a=r[s]={}),Object.assign(a,o)}return{actions:(i,s)=>{for(const o of n)o.actions&&(s=o.actions(i,s,e));return s},tools:(i,s,o)=>{for(const a of n)a.tools&&(s=a.tools(i,s,{...e,...o}));return s},translations:r}}function g4(n){return E.useMemo(()=>n,n)}function Kle(n){const e=g4(n==null?[]:Array.isArray(n)?n:[n]);return E.useMemo(()=>{const r={};for(const i of e)if(i.translations)for(const[s,o]of Wn(i.translations)){let a=r[s];a||(a=r[s]={}),Object.assign(a,o)}return r},[e])}function Vle(n){const e=Hle(),r=g4(n==null?[]:Array.isArray(n)?n:[n]);return E.useMemo(()=>Gle(r,e),[r,e])}function Wle(n,e){const r=Be(e.map(s=>n.getShape(s)).filter(s=>s&&n.isShapeOfType(s,"frame")));if(!r.length)return;const i=[];n.run(()=>{r.map(s=>{const o=n.getSortedChildIdsForParent(s.id);o.length&&(n.reparentShapes(o,s.parentId,s.index),i.push(...o))}),n.setSelectedShapes(i),n.deleteShapes(e)})}const Yle=50;function Xle(n,e,r={}){const i=n.getShape(e);if(!i)return;const s=n.getSortedChildIdsForParent(i.id),o=Be(s.map(g=>n.getShape(g)));if(!o.length)return;const a=pe.FromPoints(o.flatMap(g=>{const y=n.getShapeGeometry(g.id);return n.getShapeLocalTransform(g).applyToPoints(y.vertices)})),{padding:c=Yle}=r,l=a.w+2*c,u=a.h+2*c,d=c-a.minX,h=c-a.minY;if(d===0&&h===0&&i.props.w===l&&i.props.h===u)return;const p=new k(d,h).rot(i.rotation);n.run(()=>{const g=s.map(y=>{const v=n.getShape(y);return{id:v.id,type:v.type,x:v.x+d,y:v.y+h}});g.push({id:i.id,type:i.type,x:i.x-p.x,y:i.y-p.y,props:{w:l,h:u}}),n.updateShapes(g)})}function zO(n){return lr.isValid(n)?{isValid:!0,hasProtocol:!0}:lr.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Zle=Qt(function({onClose:e}){const i=Z().getOnlySelectedShape();return i&&"url"in i.props&&typeof i.props.url=="string"?f.jsx(Qle,{onClose:e,selectedShape:i}):null}),Qle=Qt(function({onClose:e,selectedShape:r}){const i=Z(),s=Ge(),o=E.useRef(null);E.useEffect(()=>{i.timers.requestAnimationFrame(()=>o.current?.focus())},[i]);const a=E.useRef(r.props.url),[c,l]=E.useState(()=>{const y=zO(r.props.url),v=y.isValid===!0?y.hasProtocol?r.props.url:"https://"+r.props.url:"https://";return{actual:v,safe:v,valid:!0}}),u=E.useCallback(y=>{const v=y.replace(/https?:\/\/(https?:\/\/)/,(b,S)=>S),x=zO(v),m=x.isValid===!0?x.hasProtocol?v:"https://"+v:"https://";l({actual:v,safe:m,valid:x.isValid})},[]),d=E.useCallback(()=>{const y=i.getOnlySelectedShape();y&&(i.updateShapes([{id:y.id,type:y.type,props:{url:""}}]),e())},[i,e]),h=E.useCallback(()=>{const y=i.getOnlySelectedShape();y&&(y&&"url"in y.props&&y.props.url!==c.safe&&i.updateShapes([{id:y.id,type:y.type,props:{url:c.safe}}]),e())},[i,e,c]),p=E.useCallback(()=>{e()},[e]);if(!r)return e(),null;const g=a.current&&!c.valid;return f.jsxs(f.Fragment,{children:[f.jsxs(Of,{children:[f.jsx(Df,{children:s("edit-link-dialog.title")}),f.jsx(Nf,{})]}),f.jsx(Tl,{children:f.jsxs("div",{className:"tlui-edit-link-dialog",children:[f.jsx(Lf,{ref:o,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:c.actual,onValueChange:u,onComplete:h,onCancel:p}),f.jsx("div",{children:c.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),f.jsxs(iC,{className:"tlui-dialog__footer__actions",children:[f.jsx(Ae,{type:"normal",onClick:p,onTouchEnd:p,children:f.jsx(Lt,{children:s("edit-link-dialog.cancel")})}),g?f.jsx(Ae,{type:"danger",onTouchEnd:d,onClick:d,children:f.jsx(Lt,{children:s("edit-link-dialog.clear")})}):f.jsx(Ae,{type:"primary",disabled:!c.valid,onTouchEnd:h,onClick:h,children:f.jsx(Lt,{children:s("edit-link-dialog.save")})})]})]})});var jS={exports:{}},$O;function Jle(){return $O||($O=1,(function(n){var e=(function(){var r=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function a(l,u){if(!o[l]){o[l]={};for(var d=0;d<l.length;d++)o[l][l.charAt(d)]=d}return o[l][u]}var c={compressToBase64:function(l){if(l==null)return"";var u=c._compress(l,6,function(d){return i.charAt(d)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:c._decompress(l.length,32,function(u){return a(i,l.charAt(u))})},compressToUTF16:function(l){return l==null?"":c._compress(l,15,function(u){return r(u+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:c._decompress(l.length,16384,function(u){return l.charCodeAt(u)-32})},compressToUint8Array:function(l){for(var u=c.compress(l),d=new Uint8Array(u.length*2),h=0,p=u.length;h<p;h++){var g=u.charCodeAt(h);d[h*2]=g>>>8,d[h*2+1]=g%256}return d},decompressFromUint8Array:function(l){if(l==null)return c.decompress(l);for(var u=new Array(l.length/2),d=0,h=u.length;d<h;d++)u[d]=l[d*2]*256+l[d*2+1];var p=[];return u.forEach(function(g){p.push(r(g))}),c.decompress(p.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":c._compress(l,6,function(u){return s.charAt(u)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),c._decompress(l.length,32,function(u){return a(s,l.charAt(u))}))},compress:function(l){return c._compress(l,16,function(u){return r(u)})},_compress:function(l,u,d){if(l==null)return"";var h,p,g={},y={},v="",x="",m="",b=2,S=3,w=2,I=[],C=0,_=0,P;for(P=0;P<l.length;P+=1)if(v=l.charAt(P),Object.prototype.hasOwnProperty.call(g,v)||(g[v]=S++,y[v]=!0),x=m+v,Object.prototype.hasOwnProperty.call(g,x))m=x;else{if(Object.prototype.hasOwnProperty.call(y,m)){if(m.charCodeAt(0)<256){for(h=0;h<w;h++)C=C<<1,_==u-1?(_=0,I.push(d(C)),C=0):_++;for(p=m.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1}else{for(p=1,h=0;h<w;h++)C=C<<1|p,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=0;for(p=m.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete y[m]}else for(p=g[m],h=0;h<w;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1;b--,b==0&&(b=Math.pow(2,w),w++),g[x]=S++,m=String(v)}if(m!==""){if(Object.prototype.hasOwnProperty.call(y,m)){if(m.charCodeAt(0)<256){for(h=0;h<w;h++)C=C<<1,_==u-1?(_=0,I.push(d(C)),C=0):_++;for(p=m.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1}else{for(p=1,h=0;h<w;h++)C=C<<1|p,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=0;for(p=m.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete y[m]}else for(p=g[m],h=0;h<w;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1;b--,b==0&&(b=Math.pow(2,w),w++)}for(p=2,h=0;h<w;h++)C=C<<1|p&1,_==u-1?(_=0,I.push(d(C)),C=0):_++,p=p>>1;for(;;)if(C=C<<1,_==u-1){I.push(d(C));break}else _++;return I.join("")},decompress:function(l){return l==null?"":l==""?null:c._decompress(l.length,32768,function(u){return l.charCodeAt(u)})},_decompress:function(l,u,d){var h=[],p=4,g=4,y=3,v="",x=[],m,b,S,w,I,C,_,P={val:d(0),position:u,index:1};for(m=0;m<3;m+=1)h[m]=m;for(S=0,I=Math.pow(2,2),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;switch(S){case 0:for(S=0,I=Math.pow(2,8),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;_=r(S);break;case 1:for(S=0,I=Math.pow(2,16),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;_=r(S);break;case 2:return""}for(h[3]=_,b=_,x.push(_);;){if(P.index>l)return"";for(S=0,I=Math.pow(2,y),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;switch(_=S){case 0:for(S=0,I=Math.pow(2,8),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;h[g++]=r(S),_=g-1,p--;break;case 1:for(S=0,I=Math.pow(2,16),C=1;C!=I;)w=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=d(P.index++)),S|=(w>0?1:0)*C,C<<=1;h[g++]=r(S),_=g-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,y),y++),h[_])v=h[_];else if(_===g)v=b+b.charAt(0);else return null;x.push(v),h[g++]=b+v.charAt(0),p--,b=v,p==0&&(p=Math.pow(2,y),y++)}}};return c})();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(jS)),jS.exports}var eue=Jle();const m4=rs(eue);async function tue(n,e,r){const{elements:i,files:s}=e,o={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},a=new Map,c=new Map,l=n.getCurrentPageId(),u=new Map,d=[],h=new Set;i.forEach(m=>{if(u.set(m.id,it()),m.boundElements!==null)for(const b of m.boundElements)b.type==="text"&&h.add(b.id)});let p=sF;for(const m of i){if(h.has(m.id))continue;const b=u.get(m.id),S={id:b,typeName:"shape",parentId:l,index:p,x:m.x,y:m.y,rotation:0,isLocked:m.locked,opacity:nue(m.opacity),meta:{}};switch(m.angle!==0&&c.set(b,m.angle),m.groupIds&&m.groupIds.length>0?a.has(m.groupIds[0])?a.get(m.groupIds[0])?.push(b):a.set(m.groupIds[0],[b]):d.push(b),m.type){case"rectangle":case"ellipse":case"diamond":{let w="",I="middle";if(m.boundElements!==null){for(const _ of m.boundElements)if(_.type==="text"){const P=i.find(M=>M.id===_.id);P&&(w=P.text,I=cue[P.textAlign])}}const C=m.backgroundColor==="transparent"?m.strokeColor:m.backgroundColor;o.shapes.push({...S,type:"geo",props:{geo:m.type,url:m.link??"",w:m.width,h:m.height,size:cd[m.strokeWidth]??"draw",color:Sc[C]??"black",text:w,align:I,dash:ld(m),fill:due(m)}});break}case"freedraw":{o.shapes.push({...S,type:"draw",props:{dash:ld(m),size:cd[m.strokeWidth],color:Sc[m.strokeColor]??"black",segments:[{type:"free",points:m.points.map(([w,I,C=.5])=>({x:w,y:I,z:C}))}]}});break}case"line":{if(m.points.slice().length<2)break;const I=_l(m.points.length);o.shapes.push({...S,type:"line",props:{dash:ld(m),size:cd[m.strokeWidth],color:Sc[m.strokeColor]??"black",spline:m.roundness?"cubic":"line",points:{...Object.fromEntries(m.points.map(([C,_],P)=>{const M=I[P];return[M,{id:M,index:M,x:C,y:_}]}))}}});break}case"arrow":{let w="";if(m.boundElements!==null){for(const M of m.boundElements)if(M.type==="text"){const T=i.find(A=>A.id===M.id);T&&(w=T.text)}}const I=m.points[0],C=m.points[m.points.length-1],_=u.get(m.startBinding?.elementId),P=u.get(m.endBinding?.elementId);o.shapes.push({...S,type:"arrow",props:{text:w,bend:uue(m,I,C),dash:ld(m),size:cd[m.strokeWidth]??"m",color:Sc[m.strokeColor]??"black",start:{x:I[0],y:I[1]},end:{x:C[0],y:C[1]},arrowheadEnd:BO[m.endArrowhead]??"none",arrowheadStart:BO[m.startArrowhead]??"none"}}),_&&o.bindings.push({id:yo(),typeName:"binding",type:"arrow",fromId:b,toId:_,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),P&&o.bindings.push({id:yo(),typeName:"binding",type:"arrow",fromId:b,toId:P,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:w,scale:I}=iue(m.fontSize);o.shapes.push({...S,type:"text",props:{size:w,scale:I,font:sue[m.fontFamily]??"draw",color:Sc[m.strokeColor]??"black",text:m.text,textAlign:lue[m.textAlign]}});break}case"image":{const w=s[m.fileId];if(!w)break;const I=uo.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:m.width,h:m.height,fileSize:w.size,name:m.id??"Untitled",isAnimated:!1,mimeType:w.mimeType,src:w.dataURL},meta:{}}),o.shapes.push({...S,type:"image",props:{w:m.width,h:m.height,assetId:I}})}}p=Hr(p)}const g=r??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(o,{point:g,select:!1,preserveIds:!0});for(const m of a.values())if(m.length>1){n.groupShapes(m);const b=n.getShape(m[0]);b?.parentId&&zn(b.parentId)&&d.push(b.parentId)}for(const[m,b]of c)n.select(m),n.rotateShapesBy([m],b);const y=Be(d.map(m=>n.getShape(m))),v=pe.Common(y.map(m=>n.getShapePageBounds(m))),x=n.getViewportPageBounds().center;n.updateShapes(y.map(m=>{const b={x:(m.x??0)-(v.x+v.w/2),y:(m.y??0)-(v.y+v.h/2)};return{id:m.id,type:m.type,x:x.x+b.x,y:x.y+b.y}})),n.setSelectedShapes(d)}const nue=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},cd={1:"s",2:"m",3:"l",4:"xl"},rue={16:"s",20:"m",28:"l",36:"xl"};function iue(n){const e=rue[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const sue={1:"draw",2:"sans",3:"mono"},Sc={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},oue={solid:"draw",dashed:"dashed",dotted:"dotted"},aue={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},cue={left:"start",center:"middle",right:"end"},lue={left:"start",center:"middle",right:"end"},BO={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function uue(n,e,r){let i=0;if(n.points.length>2){const s=new k(e[0],e[1]),o=new k(r[0],r[1]),a=new k(n.points[1][0],n.points[1][1]),c=k.Sub(o,s),l=k.Per(c),u=k.Med(o,s),d=k.Sub(u,l),h=k.Add(u,l),p=k.NearestPointOnLineSegment(d,h,a,!1);i=k.Dist(p,u),k.Clockwise(p,o,u)&&(i*=-1)}return i}const ld=n=>{let e=oue[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},due=n=>n.backgroundColor==="transparent"?"none":aue[n.fillStyle]??"solid";async function hue(n,e,r,i){const o=(await Promise.all(e.map(async a=>await(await bi(a)).blob()))).map(a=>new File([a],"tldrawFile",{type:a.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:o,point:r,ignoreParent:!1,sources:i}),e.forEach(a=>URL.revokeObjectURL(a))}function fue(n,e,r){const i=n.getSelectionPageBounds();n.mark("paste"),n.putContentOntoCurrentPage(e,{point:r,select:!0});const s=n.getSelectionPageBounds();i&&s&&i?.collides(s)&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function $w(n,e,r,i){return n.mark("paste"),await n.putExternalContent({type:"url",point:r,url:e,sources:i})}function pue(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const gue=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},mue=n=>{const e=n.split(/[\n\s]/);for(const r of e)try{const i=new URL(r);if(!(i.protocol==="http:"||i.protocol==="https:"))return}catch{return}return _z(e)},yue=n=>/^<svg/.test(n),vue=["input","select","textarea"];function RS(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||vue.indexOf(e.tagName.toLowerCase())>-1)}const xue=n=>n.types.find(e=>e.match(/^image\//)),OS=(n,e,r,i)=>{const s=mue(e);if(s)for(const o of s)$w(n,o,r);else gue(e)?$w(n,e,r):yue(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:r,sources:i})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:r,sources:i}))},bue=async(n,e,r)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const i=[];for(const s of Object.values(e.items))switch(s.kind){case"file":{i.push({type:"file",source:new Promise(o=>o(s.getAsFile()))});break}case"string":{s.type==="text/html"?i.push({type:"html",source:new Promise(o=>s.getAsString(o))}):s.type==="text/plain"?i.push({type:"text",source:new Promise(o=>s.getAsString(o))}):i.push({type:s.type,source:new Promise(o=>s.getAsString(o))});break}}v4(n,i,r)},y4=async(n,e,r)=>{const i=[];for(const s of e){if(xue(s))for(const o of s.types)o.match(/^image\//)&&i.push({type:"blob",source:s.getType(o)});s.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const o=await s.getType("text/html");return await mo.blobToText(o)})()}),s.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const o=await s.getType("text/uri-list");return await mo.blobToText(o)})()}),s.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const o=await s.getType("text/plain");return await mo.blobToText(o)})()})}return await v4(n,i,r)};async function v4(n,e,r){const i=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(i.length){const a=(await Promise.all(i.map(c=>c.source))).filter(Boolean).map(c=>URL.createObjectURL(c));return await hue(n,a,r)}const s=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(a=>{const c=o;if(c.type==="file"){a({type:"error",data:null,reason:"unexpected file"});return}c.source.then(l=>{const u=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(u)try{const d=m4.decompressFromBase64(u);if(d===null){a({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(d);if(h.type!=="application/tldraw"&&a({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){a({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}a({type:"tldraw",data:h.data});return}}catch{a({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(c.type==="html"){a({type:"text",data:l,subtype:"html"});return}if(c.type==="url"){a({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){a({type:"excalidraw",data:d});return}else{a({type:"text",data:l,subtype:"json"});return}}catch{a({type:"text",data:l,subtype:"text"});return}}a({type:"error",data:l,reason:"unhandled case"})})})));for(const o of s)if(o.type==="tldraw"){fue(n,o.data,r);return}for(const o of s)if(o.type==="excalidraw"){tue(n,o.data,r);return}for(const o of s)if(o.type==="text"&&o.subtype==="html"){const c=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(c&&Array.from(c.children).filter(u=>u.nodeType===1).length===1&&c.firstElementChild&&c.firstElementChild.tagName==="A"&&c.firstElementChild.hasAttribute("href")&&c.firstElementChild.getAttribute("href")!==""){const u=c.firstElementChild.getAttribute("href");OS(n,u,r,s);return}if(!s.some(u=>u.type==="text"&&u.subtype!=="html")&&o.data.trim()){OS(n,pue(o.data),r,s);return}}for(const o of s)if(o.type==="text"&&o.subtype==="url"){$w(n,o.data,r,s);return}for(const o of s)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){OS(n,o.data,r,s);return}}const yh=async n=>{const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const r=m4.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(s=>n.isShapeOfType(s,"text")||n.isShapeOfType(s,"geo")||n.isShapeOfType(s,"arrow")?s.props.text:n.isShapeOfType(s,"bookmark")||n.isShapeOfType(s,"embed")?s.props.url:null).filter(rJ);if(navigator.clipboard?.write){const s=new Blob([`<div data-tldraw>${r}</div>`],{type:"text/html"});let o=i.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${r}</div>`)}};function Sue(){const n=Z(),e=un(),r=E.useCallback(async function(a){n.getSelectedShapeIds().length!==0&&(await yh(n),e("copy",{source:a}))},[n,e]),i=E.useCallback(async function(a){n.getSelectedShapeIds().length!==0&&(await yh(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:a}))},[n,e]),s=E.useCallback(async function(a,c,l){n.getEditingShapeId()===null&&(Array.isArray(a)&&a[0]instanceof ClipboardItem?(y4(n,a,l),e("paste",{source:"menu"})):navigator.clipboard.read().then(u=>{s(u,c,l)}))},[n,e]);return{copy:r,cut:i,paste:s}}function wue(){const n=Z(),e=un(),r=ne("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);E.useEffect(()=>{if(!r)return;const i=async l=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||RS(n)||(We(l),await yh(n),e("copy",{source:"kbd"}))};async function s(l){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||RS(n)||(We(l),await yh(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const a=l=>{l.button===1&&(o=!0,n.timers.requestAnimationFrame(()=>{o=!1}))},c=l=>{if(o){Xt(l);return}if(n.getEditingShapeId()!==null||RS(n))return;let u,d=!1;n.inputs.shiftKey&&(d=!0),n.user.getIsPasteAtCursorMode()&&(d=!d),d&&(u=n.inputs.currentPagePoint),l.clipboardData&&!n.inputs.shiftKey?bue(n,l.clipboardData,u):navigator.clipboard.read().then(h=>{Array.isArray(h)&&h[0]instanceof ClipboardItem&&y4(n,h,u)}),We(l),e("paste",{source:"kbd"})};return document.addEventListener("copy",i),document.addEventListener("cut",s),document.addEventListener("paste",c),document.addEventListener("pointerup",a),()=>{document.removeEventListener("copy",i),document.removeEventListener("cut",s),document.removeEventListener("paste",c),document.removeEventListener("pointerup",a)}},[n,e,r])}async function x4(n,e,r){const{type:i,quality:s,scale:o,width:a,height:c}=r;let[l,u]=await doe(a*o,c*o);l=Math.floor(l),u=Math.floor(u);const d=l/a,h=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(y=>{const v=ka();v.crossOrigin="anonymous",v.onload=async()=>{n.environment.isSafari&&await new Promise(b=>n.timers.setTimeout(b,250));const x=document.createElement("canvas"),m=x.getContext("2d");x.width=l,x.height=u,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(v,0,0,l,u),URL.revokeObjectURL(h),y(x)},v.onerror=()=>{y(null)},v.src=h});if(!p)return null;const g=await new Promise(y=>p.toBlob(v=>{(!v||Dt.throwToBlob.get())&&y(null),y(v)},"image/"+i,s));if(!g)return null;if(i==="png"){const y=new DataView(await g.arrayBuffer());return ui.setPhysChunk(y,d,{type:"image/"+i})}else return g}async function b4(n,e,r){const i=await n.getSvgString(e?.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...r});if(!i)throw new Error("Could not construct SVG.");return i}async function Bw(n,e,r,i={}){switch(r){case"svg":return(await b4(n,e,i))?.svg;case"json":{const s=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(s)}default:wn(r)}}async function sC({editor:n,ids:e,format:r,opts:i={}}){switch(r){case"svg":return new Blob([await Bw(n,e,"svg",i)],{type:"text/plain"});case"json":return new Blob([await Bw(n,e,"json",i)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await b4(n,e,i);if(!s)throw new Error("Could not construct image.");const o=await x4(n,s.svg,{type:r,quality:1,scale:2,width:s.width,height:s.height});if(!o)throw new Error("Could not construct image.");return o}default:wn(r)}}const _ue={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Cue(n,e,r,i={}){return{blobPromise:sC({editor:n,ids:e,format:r,opts:i}),mimeType:_ue[r]}}function Pue(n,e,r="svg",i={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:s,mimeType:o}=Cue(n,e,r,i);return window.navigator.clipboard.write([new ClipboardItem({[o]:s})]).catch(a=>(console.error(a),s.then(c=>window.navigator.clipboard.write([new ClipboardItem({[o]:c})]))))}switch(r){case"json":case"svg":return Iue(async()=>Bw(n,e,r,i));case"jpeg":case"png":throw new Error("Copy not supported");default:wn(r)}}async function Iue(n){await navigator.clipboard?.writeText?.(await n())}function Eue(){const n=Z(),{addToast:e}=ri(),r=Ge();return E.useCallback((i,s="svg")=>{Pue(n,i,s).catch(()=>{e({id:"copy-fail",severity:"warning",title:r("toast.error.copy-fail.title"),description:r("toast.error.copy-fail.desc")})})},[n,e,r])}async function kue(n,e,r="png",i,s={}){if(!i&&(i=`shapes at ${UO()}`,e.length===1)){const c=n.getShape(e[0]);n.isShapeOfType(c,"frame")?i=c.props.name??"frame":i=`${c.id.replace(/:/,"_")} at ${UO()}`}i+=`.${r}`;const o=await sC({editor:n,ids:e,format:r,opts:s}),a=new File([o],i,{type:o.type});Tue(a)}function UO(){const n=new Date,e=String(n.getFullYear()).slice(2),r=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),s=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0");return`${e}-${r}-${i} ${s}.${o}.${a}`}function Tue(n){const e=document.createElement("a"),r=URL.createObjectURL(n);e.href=r,e.download=n.name,e.click(),URL.revokeObjectURL(r)}function Mue(){const n=Z(),{addToast:e}=ri(),r=Ge();return E.useCallback((i,s="png",o)=>{kue(n,i,s,o,{scale:1,background:n.getInstanceState().exportBackground}).catch(a=>{console.error(a.message),e({id:"export-fail",title:r("toast.error.export-fail.title"),description:r("toast.error.export-fail.desc"),severity:"error"})})},[n,e,r])}async function Aue(n,e,r){const i=Be(e.map(c=>{const l=n.getShape(c);if(!(!l||n.getShapeUtil(l.type).toSvg===void 0))return l}));if(i.length===0)return;if(i.length===1){const c=i[0];if(!c||n.isShapeOfType(c,"image"))return}const s=[];if(r!==void 0){const c=i.map(l=>({shape:l,bounds:n.getShapeMaskedPageBounds(l).clone().expandBy(r)}));for(let l=0;l<c.length;l++){const u=c[l];if(l===0){s[0]={shapes:[u.shape],bounds:u.bounds};continue}let d=!1;for(const h of s)if(h.bounds.includes(u.bounds)){h.shapes.push(u.shape),h.bounds.expand(u.bounds),d=!0;break}d||s.push({shapes:[u.shape],bounds:u.bounds})}}else{const c=pe.Common(i.map(l=>n.getShapeMaskedPageBounds(l)));s.push({shapes:i,bounds:c})}const o=n.options.flattenImageBoundsPadding;for(const c of s){r!==void 0&&c.bounds.expandBy(-r);const l=await n.getSvgString(c.shapes,{padding:o});if(!l?.svg)continue;const u=new Blob([l.svg],{type:"image/svg+xml"}),d=await n.getAssetForExternalContent({type:"file",file:new File([u],"asset.svg",{type:"image/svg+xml"})});d&&(c.asset=d)}const a=[];return mi(()=>{for(const c of s){const{asset:l,bounds:u,shapes:d}=c;if(!l)continue;const h=n.findCommonAncestor(d)??n.getCurrentPageId();if(!h)continue;let p="a1";for(const m of d)if(m.parentId===h){m.index>p&&(p=m.index);break}let g,y,v;if(zn(h)){const m=n.getShape(h);if(!m)continue;const b=n.getPointInShapeSpace(m,{x:u.x,y:u.y});v=n.getShapePageTransform(h).rotation(),b.sub(new k(o,o).rot(-v)),g=b.x,y=b.y}else g=u.x-o,y=u.y-o,v=0;n.deleteShapes(d),n.createAssets([{...l,id:l.id}]);const x=it();n.createShape({id:x,type:"image",index:p,parentId:h,x:g,y,rotation:-v,props:{assetId:l.id,w:u.w+o*2,h:u.h+o*2}}),a.push(x)}}),a}function zf(){return Z().store.props.collaboration!==void 0}function jue(){const n=Z();return ne("sync status",()=>n.store.props.collaboration?.status?n.store.props.collaboration.status.get():null,[n])}function Rue(){const n=Z(),e=E.useRef(null),r=E.useRef(null);return E.useCallback(async function(){const s=document.createElement("div"),o=document.createElement("style"),a=(m,b)=>{m&&(m.innerHTML=""),b&&document.head.contains(b)&&document.head.removeChild(b),m&&document.body.contains(m)&&document.body.removeChild(m)};a(e.current,r.current),e.current=s,r.current=o;const c=`tl-print-surface-${kt()}`;s.className=c,o.innerHTML=`
			.${c} {
				display: none;
			}

			.${c} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${c} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${c}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${c}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${c}__item__header {
					display: none;
				}

				.${c}__item__footer {
					display: none;
					text-align: right;
				}

				.${c}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(o),document.body.appendChild(s)},u=()=>{n.once("tick",()=>{a(s,o)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",u);function d(m,b,S){try{s.innerHTML+=`<div class="${c}__item">
        <div class="${c}__item__header">
          ${m.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${c}__item__main">
          ${S}
        </div>
        <div class="${c}__item__footer ${c}__item__footer__${b?"":"hide"}">
          ${b??""}
        </div>
      </div>`}catch(w){console.error(w)}}function h(){n.environment.isChromeForIos?(l(),window.print()):n.environment.isSafari?(l(),document.execCommand("print",!1)):window.print()}const p=n.getSelectedShapeIds(),g=n.getCurrentPageId(),y=n.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const m=await n.getSvgString(p,x);if(m){const b=y.find(S=>S.id===g);d(`tldraw  ${b?.name}`,null,m.svg),h()}}else{const m=n.getCurrentPage(),b=await n.getSvgString(n.getSortedChildIdsForParent(m.id),x);b&&(d(`tldraw  ${m.name}`,null,b.svg),h())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",u)},[n])}const S4=E.createContext(null);function Oue(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function Jo(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function Due({overrides:n,children:e}){const r=Z(),i=zf(),{addDialog:s,clearDialogs:o}=Bo(),{clearToasts:a,addToast:c}=ri(),l=Ge(),u=h4(),d=Rue(),{cut:h,copy:p,paste:g}=Sue(),y=Eue(),v=Mue(),x=l("document.default-name"),m=un(),b=E.useMemo(()=>{function S(){return r.isIn("select")||(r.complete(),r.setCurrentTool("select")),!1}function w(){return r.isIn("select")&&r.getSelectedShapeIds().length>0}const I=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(_){w()&&(S()||(m("edit-link",{source:_}),r.mark("edit-link"),s({component:Zle})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(_){m("insert-embed",{source:_}),s({component:d4})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(_){m("insert-media",{source:_}),u()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(_){m("undo",{source:_}),r.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(_){m("redo",{source:_}),r.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"svg",source:_}),v(P,"svg",Jo(r,x)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"png",source:_}),v(P,"png",Jo(r,x)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"json",source:_}),v(P,"json",Jo(r,x)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-all-as",{format:"svg",source:_}),v(Array.from(r.getCurrentPageShapeIds()),"svg",Jo(r,x)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(_){const P=Array.from(r.getCurrentPageShapeIds().values());P.length!==0&&(m("export-all-as",{format:"png",source:_}),v(P,"png",Jo(r,x)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(_){const P=Array.from(r.getCurrentPageShapeIds().values());P.length!==0&&(m("export-all-as",{format:"json",source:_}),v(P,"json",Jo(r,x)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"svg",source:_}),y(P,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"png",source:_}),y(P,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(_){let P=r.getSelectedShapeIds();P.length===0&&(P=Array.from(r.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"json",source:_}),y(P,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(_){if(!w()||S())return;m("toggle-auto-size",{source:_}),r.mark("toggling auto size");const P=r.getSelectedShapes().filter(M=>r.isShapeOfType(M,"text")&&M.props.autoSize===!1);r.updateShapes(P.map(M=>({id:M.id,type:M.type,props:{...M.props,w:8,autoSize:!0}}))),dt(r,P.map(M=>M.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(_){m("open-embed-link",{source:_});const P=r.getSelectedShapeIds(),M="No embed shapes selected";if(P.length!==1){console.error(M);return}const T=r.getShape(P[0]);if(!T||!r.isShapeOfType(T,"embed")){console.error(M);return}kse(T.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(_){if(r.root.getCurrent()?.id!=="zoom"&&(m("zoom-tool",{source:_}),!(r.inputs.shiftKey||r.inputs.ctrlKey))){const P=r.root.getCurrent();P&&P.getCurrent()?.id==="idle"&&r.setCurrentTool("zoom",{onInteractionEnd:P.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(_){w()&&(S()||r.run(()=>{m("convert-to-bookmark",{source:_});const P=r.getSelectedShapes(),M=[],T=[];for(const A of P){if(!A||!r.isShapeOfType(A,"embed")||!A.props.url)continue;const R=new k(A.x,A.y);R.rot(-A.rotation),R.add(new k(A.props.w/2-300/2,A.props.h/2-320/2)),R.rot(A.rotation);const O={id:it(),type:"bookmark",rotation:A.rotation,x:R.x,y:R.y,opacity:1,props:{url:A.props.url}};M.push(O),T.push(A.id)}r.mark("convert shapes to bookmark"),r.deleteShapes(T),r.createShapes(M)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(_){w()&&(S()||(m("convert-to-embed",{source:_}),r.run(()=>{const P=r.getSelectedShapeIds(),M=Be(P.map(R=>r.getShape(R))),T=[],A=[];for(const R of M){if(!r.isShapeOfType(R,"bookmark"))continue;const{url:O}=R.props,j=Ms(R.props.url);if(!j||!j.definition)continue;const{width:D,height:N}=j.definition,F=new k(R.x,R.y);F.rot(-R.rotation),F.add(new k(R.props.w/2-D/2,R.props.h/2-N/2)),F.rot(R.rotation);const z={id:it(),type:"embed",x:F.x,y:F.y,rotation:R.rotation,props:{url:O,w:D,h:N}};T.push(z),A.push(R.id)}r.mark("convert shapes to embed"),r.deleteShapes(A),r.createShapes(T)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(_){if(!w()||S())return;m("duplicate-shapes",{source:_});const P=r.getInstanceState();let M,T;if(P.duplicateProps)M=P.duplicateProps.shapeIds,T=P.duplicateProps.offset;else{M=r.getSelectedShapeIds();const A=pe.Common(Be(M.map(R=>r.getShapePageBounds(R))));T=r.getCameraOptions().isLocked?{x:r.options.adjacentShapeMargin,y:r.options.adjacentShapeMargin}:{x:A.width+r.options.adjacentShapeMargin,y:0}}r.mark("duplicate shapes"),r.duplicateShapes(M,T),P.duplicateProps&&r.updateInstanceState({duplicateProps:{...P.duplicateProps,shapeIds:r.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(_){w()&&(S()||(m("ungroup-shapes",{source:_}),r.mark("ungroup"),r.ungroupShapes(r.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(_){if(!w()||S())return;m("group-shapes",{source:_});const P=r.getOnlySelectedShape();P&&r.isShapeOfType(P,"group")?(r.mark("ungroup"),r.ungroupShapes(r.getSelectedShapeIds())):(r.mark("group"),r.groupShapes(r.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(_){if(!w())return;m("remove-frame",{source:_});const P=r.getSelectedShapes();P.length>0&&P.every(M=>r.isShapeOfType(M,"frame"))&&(r.mark("remove-frame"),Wle(r,P.map(M=>M.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(_){if(!w())return;m("fit-frame-to-content",{source:_});const P=r.getOnlySelectedShape();P&&r.isShapeOfType(P,"frame")&&(r.mark("fit-frame-to-content"),Xle(r,P.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"left",source:_}),r.mark("align left");const P=r.getSelectedShapeIds();r.alignShapes(P,"left"),dt(r,P)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"center-horizontal",source:_}),r.mark("align center horizontal");const P=r.getSelectedShapeIds();r.alignShapes(P,"center-horizontal"),dt(r,P)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"right",source:_}),r.mark("align right");const P=r.getSelectedShapeIds();r.alignShapes(P,"right"),dt(r,P)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"center-vertical",source:_}),r.mark("align center vertical");const P=r.getSelectedShapeIds();r.alignShapes(P,"center-vertical"),dt(r,P)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"top",source:_}),r.mark("align top");const P=r.getSelectedShapeIds();r.alignShapes(P,"top"),dt(r,P)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(_){if(!w()||S())return;m("align-shapes",{operation:"bottom",source:_}),r.mark("align bottom");const P=r.getSelectedShapeIds();r.alignShapes(P,"bottom"),dt(r,P)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(_){if(!w()||S())return;m("distribute-shapes",{operation:"horizontal",source:_}),r.mark("distribute horizontal");const P=r.getSelectedShapeIds();r.distributeShapes(P,"horizontal"),dt(r,P)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(_){if(!w()||S())return;m("distribute-shapes",{operation:"vertical",source:_}),r.mark("distribute vertical");const P=r.getSelectedShapeIds();r.distributeShapes(P,"vertical"),dt(r,P)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(_){if(!w()||S())return;m("stretch-shapes",{operation:"horizontal",source:_}),r.mark("stretch horizontal");const P=r.getSelectedShapeIds();r.stretchShapes(P,"horizontal"),dt(r,P)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(_){if(!w()||S())return;m("stretch-shapes",{operation:"vertical",source:_}),r.mark("stretch vertical");const P=r.getSelectedShapeIds();r.stretchShapes(P,"vertical"),dt(r,P)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(_){if(!w()||S())return;m("flip-shapes",{operation:"horizontal",source:_}),r.mark("flip horizontal");const P=r.getSelectedShapeIds();r.flipShapes(P,"horizontal"),dt(r,P)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(_){if(!w()||S())return;m("flip-shapes",{operation:"vertical",source:_}),r.mark("flip vertical");const P=r.getSelectedShapeIds();r.flipShapes(P,"vertical"),dt(r,P)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(_){if(!w()||S())return;m("pack-shapes",{source:_}),r.mark("pack");const P=r.getSelectedShapeIds();r.packShapes(P,r.options.adjacentShapeMargin),dt(r,P)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(_){if(!w()||S())return;m("stack-shapes",{operation:"vertical",source:_}),r.mark("stack-vertical");const P=r.getSelectedShapeIds();r.stackShapes(P,"vertical",16),dt(r,P)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(_){if(!w()||S())return;m("stack-shapes",{operation:"horizontal",source:_}),r.mark("stack-horizontal");const P=r.getSelectedShapeIds();r.stackShapes(P,"horizontal",16),dt(r,P)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(_){w()&&(S()||(m("reorder-shapes",{operation:"toFront",source:_}),r.mark("bring to front"),r.bringToFront(r.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(_){w()&&(S()||(m("reorder-shapes",{operation:"forward",source:_}),r.mark("bring forward"),r.bringForward(r.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(_){w()&&(S()||(m("reorder-shapes",{operation:"backward",source:_}),r.mark("send backward"),r.sendBackward(r.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(_){w()&&(S()||(m("reorder-shapes",{operation:"toBack",source:_}),r.mark("send to back"),r.sendToBack(r.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(_){w()&&(S()||(r.mark("cut"),h(_)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(_){w()&&(S()||p(_))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(_){navigator.clipboard?.read().then(P=>{g(P,_,_==="context-menu"?r.inputs.currentPagePoint:void 0)}).catch(()=>{c({title:l("action.paste-error-title"),description:l("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(_){r.run(()=>{S()||(m("select-all-shapes",{source:_}),r.mark("select all kbd"),r.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(_){w()&&(S()||(m("select-none-shapes",{source:_}),r.mark("select none"),r.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(_){w()&&(S()||(m("delete-shapes",{source:_}),r.mark("delete"),r.deleteShapes(r.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(_){if(!w()||S())return;m("rotate-cw",{source:_}),r.mark("rotate-cw");const P=r.getSelectionRotation()%(pt/2),M=Os(P,0)||Os(P,pt/2),T=r.getSelectedShapeIds();r.rotateShapesBy(T,pt/2-(M?0:P)),dt(r,T)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(_){if(!w()||S())return;m("rotate-ccw",{source:_}),r.mark("rotate-ccw");const P=r.getSelectionRotation()%(pt/2),M=Os(P,0),T=r.getSelectedShapeIds();r.rotateShapesBy(T,M?-(pt/2):-P),dt(r,T)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(_){m("zoom-in",{source:_}),r.zoomIn(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(_){m("zoom-out",{source:_}),r.zoomOut(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(_){m("reset-zoom",{source:_}),r.resetZoom(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(_){m("zoom-to-fit",{source:_}),r.zoomToFit({animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(_){w()&&(S()||(m("zoom-to-selection",{source:_}),r.zoomToSelection({animation:{duration:r.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(_){m("toggle-snap-mode",{source:_}),r.user.updateUserPreferences({isSnapMode:!r.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(_){const P=r.user.getIsDarkMode()?"light":"dark";m("color-scheme",{source:_,value:P}),r.user.updateUserPreferences({colorScheme:P})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(_){m("toggle-wrap-mode",{source:_}),r.user.updateUserPreferences({isWrapMode:!r.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(_){m("toggle-dynamic-size-mode",{source:_}),r.user.updateUserPreferences({isDynamicSizeMode:!r.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(_){m("toggle-paste-at-cursor",{source:_}),r.user.updateUserPreferences({isPasteAtCursorMode:!r.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(_){m("toggle-reduce-motion",{source:_}),r.user.updateUserPreferences({animationSpeed:r.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(_){m("toggle-edge-scrolling",{source:_}),r.user.updateUserPreferences({edgeScrollSpeed:r.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(_){m("toggle-transparent",{source:_}),r.updateInstanceState({exportBackground:!r.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(_){m("toggle-tool-lock",{source:_}),r.updateInstanceState({isToolLocked:!r.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(_){m("unlock-all",{source:_});const P=[];for(const M of r.getCurrentPageShapes())M.isLocked&&P.push({id:M.id,type:M.type,isLocked:!1});P.length>0&&r.updateShapes(P)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(_){r.timers.requestAnimationFrame(()=>{r.run(()=>{m("toggle-focus-mode",{source:_}),o(),a(),r.updateInstanceState({isFocusMode:!r.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(_){m("toggle-grid-mode",{source:_}),r.updateInstanceState({isGridMode:!r.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(_){m("toggle-debug-mode",{source:_}),r.updateInstanceState({isDebugMode:!r.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(_){m("print",{source:_}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(_){m("exit-pen-mode",{source:_}),r.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(_){m("stop-following",{source:_}),r.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(_){m("zoom-to-content",{source:_});const P=r.getSelectionPageBounds()??r.getCurrentPageBounds();P&&r.zoomToBounds(P,{targetZoom:Math.min(1,r.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(_){r.mark("locking"),m("toggle-lock",{source:_}),r.toggleLock(r.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(_){const P=ts.createId(),M=r.getSelectedShapeIds();r.run(()=>{r.mark("move_shapes_to_page"),r.createPage({name:l("page-menu.new-page-initial-name"),id:P}),r.moveShapesToPage(M,P)}),m("move-to-new-page",{source:_})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(_){const P=ur;r.run(()=>{r.mark("change-color"),r.isIn("select")&&r.setStyleForSelectedShapes(P,"white"),r.setStyleForNextShapes(P,"white")}),m("set-style",{source:_,id:P.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(_){const P=Eo;r.run(()=>{r.mark("change-fill"),r.isIn("select")&&r.setStyleForSelectedShapes(P,"fill"),r.setStyleForNextShapes(P,"fill")}),m("set-style",{source:_,id:P.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async _=>{const P=r.getSelectedShapeIds();if(P.length===0)return;r.mark("flattening to image"),m("flatten-to-image",{source:_});const M=await Aue(r,P,r.options.flattenImageBoundsExpand);M?.length&&r.setSelectedShapes(M)}}];i&&I.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(_){m("open-cursor-chat",{source:_}),!r.getInstanceState().isCoarsePointer&&r.timers.requestAnimationFrame(()=>{r.updateInstanceState({isChatting:!0})})}});const C=Oue(I);return n?n(r,C,void 0):C},[r,m,n,s,c,u,v,y,h,p,g,o,a,d,l,x,i]);return f.jsx(S4.Provider,{value:b,children:e})}function Ie(){const n=E.useContext(S4);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Ml(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}function sl(n,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(n?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}function Nue(n){const e=Lue(n),r=E.forwardRef((i,s)=>{const{children:o,...a}=i,c=E.Children.toArray(o),l=c.find(zue);if(l){const u=l.props.children,d=c.map(h=>h===l?E.Children.count(u)>1?E.Children.only(null):E.isValidElement(u)?u.props.children:null:h);return f.jsx(e,{...a,ref:s,children:E.isValidElement(u)?E.cloneElement(u,void 0,d):null})}return f.jsx(e,{...a,ref:s,children:o})});return r.displayName=`${n}.Slot`,r}function Lue(n){const e=E.forwardRef((r,i)=>{const{children:s,...o}=r;if(E.isValidElement(s)){const a=Bue(s),c=$ue(o,s.props);return s.type!==E.Fragment&&(c.ref=i?kh(i,a):a),E.cloneElement(s,c)}return E.Children.count(s)>1?E.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var Fue=Symbol("radix.slottable");function zue(n){return E.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===Fue}function $ue(n,e){const r={...e};for(const i in e){const s=n[i],o=e[i];/^on[A-Z]/.test(i)?s&&o?r[i]=(...c)=>{const l=o(...c);return s(...c),l}:s&&(r[i]=s):i==="style"?r[i]={...s,...o}:i==="className"&&(r[i]=[s,o].filter(Boolean).join(" "))}return{...n,...r}}function Bue(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?n.props.ref:n.props.ref||n.ref)}var Uue=Th[" useInsertionEffect ".trim().toString()]||Mh;function que({prop:n,defaultProp:e,onChange:r=()=>{},caller:i}){const[s,o,a]=Hue({defaultProp:e,onChange:r}),c=n!==void 0,l=c?n:s;{const d=E.useRef(n!==void 0);E.useEffect(()=>{const h=d.current;h!==c&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=c},[c,i])}const u=E.useCallback(d=>{if(c){const h=Gue(d)?d(n):d;h!==n&&a.current?.(h)}else o(d)},[c,n,o,a]);return[l,u]}function Hue({defaultProp:n,onChange:e}){const[r,i]=E.useState(n),s=E.useRef(r),o=E.useRef(e);return Uue(()=>{o.current=e},[e]),E.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,i,o]}function Gue(n){return typeof n=="function"}var $f="Popover",[w4]=Fl($f,[Ah]),du=Ah(),[Kue,Ks]=w4($f),_4=n=>{const{__scopePopover:e,children:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!1}=n,c=du(e),l=E.useRef(null),[u,d]=E.useState(!1),[h,p]=que({prop:i,defaultProp:s??!1,onChange:o,caller:$f});return f.jsx(c1,{...c,children:f.jsx(Kue,{scope:e,contentId:dl(),triggerRef:l,open:h,onOpenChange:p,onOpenToggle:E.useCallback(()=>p(g=>!g),[p]),hasCustomAnchor:u,onCustomAnchorAdd:E.useCallback(()=>d(!0),[]),onCustomAnchorRemove:E.useCallback(()=>d(!1),[]),modal:a,children:r})})};_4.displayName=$f;var C4="PopoverAnchor",Vue=E.forwardRef((n,e)=>{const{__scopePopover:r,...i}=n,s=Ks(C4,r),o=du(r),{onCustomAnchorAdd:a,onCustomAnchorRemove:c}=s;return E.useEffect(()=>(a(),()=>c()),[a,c]),f.jsx(l1,{...o,...i,ref:e})});Vue.displayName=C4;var P4="PopoverTrigger",I4=E.forwardRef((n,e)=>{const{__scopePopover:r,...i}=n,s=Ks(P4,r),o=du(r),a=dr(e,s.triggerRef),c=f.jsx(Xn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":A4(s.open),...i,ref:a,onClick:sl(n.onClick,s.onOpenToggle)});return s.hasCustomAnchor?c:f.jsx(l1,{asChild:!0,...o,children:c})});I4.displayName=P4;var oC="PopoverPortal",[Wue,Yue]=w4(oC,{forceMount:void 0}),E4=n=>{const{__scopePopover:e,forceMount:r,children:i,container:s}=n,o=Ks(oC,e);return f.jsx(Wue,{scope:e,forceMount:r,children:f.jsx(La,{present:r||o.open,children:f.jsx(YD,{asChild:!0,container:s,children:i})})})};E4.displayName=oC;var Da="PopoverContent",k4=E.forwardRef((n,e)=>{const r=Yue(Da,n.__scopePopover),{forceMount:i=r.forceMount,...s}=n,o=Ks(Da,n.__scopePopover);return f.jsx(La,{present:i||o.open,children:o.modal?f.jsx(Zue,{...s,ref:e}):f.jsx(Que,{...s,ref:e})})});k4.displayName=Da;var Xue=Nue("PopoverContent.RemoveScroll"),Zue=E.forwardRef((n,e)=>{const r=Ks(Da,n.__scopePopover),i=E.useRef(null),s=dr(e,i),o=E.useRef(!1);return E.useEffect(()=>{const a=i.current;if(a)return eN(a)},[]),f.jsx(tN,{as:Xue,allowPinchZoom:!0,children:f.jsx(T4,{...n,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:sl(n.onCloseAutoFocus,a=>{a.preventDefault(),o.current||r.triggerRef.current?.focus()}),onPointerDownOutside:sl(n.onPointerDownOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;o.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:sl(n.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),Que=E.forwardRef((n,e)=>{const r=Ks(Da,n.__scopePopover),i=E.useRef(!1),s=E.useRef(!1);return f.jsx(T4,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{n.onCloseAutoFocus?.(o),o.defaultPrevented||(i.current||r.triggerRef.current?.focus(),o.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:o=>{n.onInteractOutside?.(o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const a=o.target;r.triggerRef.current?.contains(a)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),T4=E.forwardRef((n,e)=>{const{__scopePopover:r,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:d,...h}=n,p=Ks(Da,r),g=du(r);return nN(),f.jsx(rN,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:o,children:f.jsx(XD,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:d,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>p.onOpenChange(!1),children:f.jsx(ZD,{"data-state":A4(p.open),role:"dialog",id:p.contentId,...g,...h,ref:e,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),M4="PopoverClose",Jue=E.forwardRef((n,e)=>{const{__scopePopover:r,...i}=n,s=Ks(M4,r);return f.jsx(Xn.button,{type:"button",...i,ref:e,onClick:sl(n.onClick,()=>s.onOpenChange(!1))})});Jue.displayName=M4;var ede="PopoverArrow",tde=E.forwardRef((n,e)=>{const{__scopePopover:r,...i}=n,s=du(r);return f.jsx(QD,{...s,...i,ref:e})});tde.displayName=ede;function A4(n){return n?"open":"closed"}var aC=_4,cC=I4,lC=E4,uC=k4;function fs(n,e){const r=Z(),i=E.useRef(!1),s=un(),o=E.useCallback(c=>{i.current=c,r.run(()=>{c?(r.complete(),r.addOpenMenu(n)):r.updateInstanceState({openMenus:r.getOpenMenus().filter(l=>!l.startsWith(n))}),e?.(c)})},[r,n,e]),a=ne("is menu open",()=>r.getOpenMenus().includes(n),[r,n]);return E.useEffect(()=>(i.current&&(s("open-menu",{source:"unknown",id:n}),r.addOpenMenu(n)),()=>{i.current&&(r.deleteOpenMenu(n),r.getOpenMenus().forEach(c=>{c.startsWith(n)&&(s("close-menu",{source:"unknown",id:n}),r.deleteOpenMenu(c))}),i.current=!1)}),[r,n,s]),[a,o]}function dC({id:n,children:e,onOpenChange:r,open:i}){const[s,o]=fs(n,r);return f.jsx(aC,{onOpenChange:o,open:i||s,children:f.jsx("div",{className:"tlui-popover",children:e})})}function hC({children:n}){return f.jsx(cC,{asChild:!0,dir:"ltr",children:n})}function fC({side:n,children:e,align:r="center",sideOffset:i=8,alignOffset:s=0}){const o=Jt();return f.jsx(lC,{container:o,children:f.jsx(uC,{className:"tlui-popover__content",side:n,sideOffset:i,align:r,alignOffset:s,dir:"ltr",children:e})})}const j4=E.createContext(null);function Bf(){const n=E.useContext(j4);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function Mr({type:n,sourceId:e,children:r}){return f.jsx(j4.Provider,{value:{type:n,sourceId:e},children:r})}function nde(n){return n.getSelectedShapeIds().map(i=>n.getShape(i)).filter(i=>{if(!i)return!1;if(n.isShapeOfType(i,"arrow")){const s=Un(n,i);if(s.start||s.end)return!1}return!0})}const R4=()=>{const n=Z();return ne("threeStackableItems",()=>nde(n).length>2,[n])},ps=()=>{const n=Z();return ne("isInSelectState",()=>n.isIn("select"),[n])},O4=()=>{const n=Z();return ne("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const r of e)if(n.isShapeOfType(r,"arrow")){const i=Un(n,r);if(i.start&&!e.some(s=>s.id===i.start.toId)||i.end&&!e.some(s=>s.id===i.end.toId))return!1}return!0},[n])},D4=()=>{const n=Z();return ne("allowUngroup",()=>n.getSelectedShapeIds().some(e=>n.getShape(e)?.type==="group"),[n])},rde=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function N4(n,e){const r=Z();return ne("selectedShapes",()=>r.getSelectedShapes().length>=n,[r,n,e])}function Rn(n,e){const r=Z();return ne("selectedShapes",()=>{const i=r.getSelectedShapes().filter(s=>!r.isShapeOrAncestorLocked(s)).length;return n===void 0?i:i>=n},[r])}function ide(){const n=Z();return ne("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function L4(){const n=Z();return ne("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function sde(){const n=Z();return ne("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function F4(){const n=Z();return ne("useCanRedo",()=>n.getCanRedo(),[n])}function z4(){const n=Z();return ne("useCanUndo",()=>n.getCanUndo(),[n])}function wc(n,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(n?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}function Nt(n,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(n?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}function ode(n){const e=ade(n),r=E.forwardRef((i,s)=>{const{children:o,...a}=i,c=E.Children.toArray(o),l=c.find(lde);if(l){const u=l.props.children,d=c.map(h=>h===l?E.Children.count(u)>1?E.Children.only(null):E.isValidElement(u)?u.props.children:null:h);return f.jsx(e,{...a,ref:s,children:E.isValidElement(u)?E.cloneElement(u,void 0,d):null})}return f.jsx(e,{...a,ref:s,children:o})});return r.displayName=`${n}.Slot`,r}function ade(n){const e=E.forwardRef((r,i)=>{const{children:s,...o}=r;if(E.isValidElement(s)){const a=dde(s),c=ude(o,s.props);return s.type!==E.Fragment&&(c.ref=i?kh(i,a):a),E.cloneElement(s,c)}return E.Children.count(s)>1?E.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var cde=Symbol("radix.slottable");function lde(n){return E.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===cde}function ude(n,e){const r={...e};for(const i in e){const s=n[i],o=e[i];/^on[A-Z]/.test(i)?s&&o?r[i]=(...c)=>{const l=o(...c);return s(...c),l}:s&&(r[i]=s):i==="style"?r[i]={...s,...o}:i==="className"&&(r[i]=[s,o].filter(Boolean).join(" "))}return{...n,...r}}function dde(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?n.props.ref:n.props.ref||n.ref)}var Uw=["Enter"," "],hde=["ArrowDown","PageUp","Home"],$4=["ArrowUp","PageDown","End"],fde=[...hde,...$4],pde={ltr:[...Uw,"ArrowRight"],rtl:[...Uw,"ArrowLeft"]},gde={ltr:["ArrowLeft"],rtl:["ArrowRight"]},hu="Menu",[Al,mde,yde]=uN(hu),[Uo,Uf]=Fl(hu,[yde,Ah,dN]),fu=Ah(),B4=dN(),[U4,Vs]=Uo(hu),[vde,pu]=Uo(hu),q4=n=>{const{__scopeMenu:e,open:r=!1,children:i,dir:s,onOpenChange:o,modal:a=!0}=n,c=fu(e),[l,u]=E.useState(null),d=E.useRef(!1),h=jh(o),p=iN(s);return E.useEffect(()=>{const g=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",g,{capture:!0}),()=>{document.removeEventListener("keydown",g,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),f.jsx(c1,{...c,children:f.jsx(U4,{scope:e,open:r,onOpenChange:h,content:l,onContentChange:u,children:f.jsx(vde,{scope:e,onClose:E.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:p,modal:a,children:i})})})};q4.displayName=hu;var xde="MenuAnchor",pC=E.forwardRef((n,e)=>{const{__scopeMenu:r,...i}=n,s=fu(r);return f.jsx(l1,{...s,...i,ref:e})});pC.displayName=xde;var gC="MenuPortal",[bde,H4]=Uo(gC,{forceMount:void 0}),G4=n=>{const{__scopeMenu:e,forceMount:r,children:i,container:s}=n,o=Vs(gC,e);return f.jsx(bde,{scope:e,forceMount:r,children:f.jsx(La,{present:r||o.open,children:f.jsx(YD,{asChild:!0,container:s,children:i})})})};G4.displayName=gC;var Tr="MenuContent",[Sde,mC]=Uo(Tr),K4=E.forwardRef((n,e)=>{const r=H4(Tr,n.__scopeMenu),{forceMount:i=r.forceMount,...s}=n,o=Vs(Tr,n.__scopeMenu),a=pu(Tr,n.__scopeMenu);return f.jsx(Al.Provider,{scope:n.__scopeMenu,children:f.jsx(La,{present:i||o.open,children:f.jsx(Al.Slot,{scope:n.__scopeMenu,children:a.modal?f.jsx(wde,{...s,ref:e}):f.jsx(_de,{...s,ref:e})})})})}),wde=E.forwardRef((n,e)=>{const r=Vs(Tr,n.__scopeMenu),i=E.useRef(null),s=dr(e,i);return E.useEffect(()=>{const o=i.current;if(o)return eN(o)},[]),f.jsx(yC,{...n,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Nt(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),_de=E.forwardRef((n,e)=>{const r=Vs(Tr,n.__scopeMenu);return f.jsx(yC,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Cde=ode("MenuContent.ScrollLock"),yC=E.forwardRef((n,e)=>{const{__scopeMenu:r,loop:i=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:a,disableOutsidePointerEvents:c,onEntryFocus:l,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:g,disableOutsideScroll:y,...v}=n,x=Vs(Tr,r),m=pu(Tr,r),b=fu(r),S=B4(r),w=mde(r),[I,C]=E.useState(null),_=E.useRef(null),P=dr(e,_,x.onContentChange),M=E.useRef(0),T=E.useRef(""),A=E.useRef(0),R=E.useRef(null),O=E.useRef("right"),j=E.useRef(0),D=y?tN:E.Fragment,N=y?{as:Cde,allowPinchZoom:!0}:void 0,F=$=>{const G=T.current+$,X=w().filter(K=>!K.disabled),ee=document.activeElement,re=X.find(K=>K.ref.current===ee)?.textValue,B=X.map(K=>K.textValue),U=Nde(B,G,re),Q=X.find(K=>K.textValue===U)?.ref.current;(function K(Y){T.current=Y,window.clearTimeout(M.current),Y!==""&&(M.current=window.setTimeout(()=>K(""),1e3))})(G),Q&&setTimeout(()=>Q.focus())};E.useEffect(()=>()=>window.clearTimeout(M.current),[]),nN();const z=E.useCallback($=>O.current===R.current?.side&&Fde($,R.current?.area),[]);return f.jsx(Sde,{scope:r,searchRef:T,onItemEnter:E.useCallback($=>{z($)&&$.preventDefault()},[z]),onItemLeave:E.useCallback($=>{z($)||(_.current?.focus(),C(null))},[z]),onTriggerLeave:E.useCallback($=>{z($)&&$.preventDefault()},[z]),pointerGraceTimerRef:A,onPointerGraceIntentChange:E.useCallback($=>{R.current=$},[]),children:f.jsx(D,{...N,children:f.jsx(rN,{asChild:!0,trapped:s,onMountAutoFocus:Nt(o,$=>{$.preventDefault(),_.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:a,children:f.jsx(XD,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:g,children:f.jsx(gU,{asChild:!0,...S,dir:m.dir,orientation:"vertical",loop:i,currentTabStopId:I,onCurrentTabStopIdChange:C,onEntryFocus:Nt(l,$=>{m.isUsingKeyboardRef.current||$.preventDefault()}),preventScrollOnEntryFocus:!0,children:f.jsx(ZD,{role:"menu","aria-orientation":"vertical","data-state":l6(x.open),"data-radix-menu-content":"",dir:m.dir,...b,...v,ref:P,style:{outline:"none",...v.style},onKeyDown:Nt(v.onKeyDown,$=>{const X=$.target.closest("[data-radix-menu-content]")===$.currentTarget,ee=$.ctrlKey||$.altKey||$.metaKey,re=$.key.length===1;X&&($.key==="Tab"&&$.preventDefault(),!ee&&re&&F($.key));const B=_.current;if($.target!==B||!fde.includes($.key))return;$.preventDefault();const Q=w().filter(K=>!K.disabled).map(K=>K.ref.current);$4.includes($.key)&&Q.reverse(),Ode(Q)}),onBlur:Nt(n.onBlur,$=>{$.currentTarget.contains($.target)||(window.clearTimeout(M.current),T.current="")}),onPointerMove:Nt(n.onPointerMove,jl($=>{const G=$.target,X=j.current!==$.clientX;if($.currentTarget.contains(G)&&X){const ee=$.clientX>j.current?"right":"left";O.current=ee,j.current=$.clientX}}))})})})})})})});K4.displayName=Tr;var Pde="MenuGroup",vC=E.forwardRef((n,e)=>{const{__scopeMenu:r,...i}=n;return f.jsx(Xn.div,{role:"group",...i,ref:e})});vC.displayName=Pde;var Ide="MenuLabel",V4=E.forwardRef((n,e)=>{const{__scopeMenu:r,...i}=n;return f.jsx(Xn.div,{...i,ref:e})});V4.displayName=Ide;var vh="MenuItem",qO="menu.itemSelect",qf=E.forwardRef((n,e)=>{const{disabled:r=!1,onSelect:i,...s}=n,o=E.useRef(null),a=pu(vh,n.__scopeMenu),c=mC(vh,n.__scopeMenu),l=dr(e,o),u=E.useRef(!1),d=()=>{const h=o.current;if(!r&&h){const p=new CustomEvent(qO,{bubbles:!0,cancelable:!0});h.addEventListener(qO,g=>i?.(g),{once:!0}),QB(h,p),p.defaultPrevented?u.current=!1:a.onClose()}};return f.jsx(W4,{...s,ref:l,disabled:r,onClick:Nt(n.onClick,d),onPointerDown:h=>{n.onPointerDown?.(h),u.current=!0},onPointerUp:Nt(n.onPointerUp,h=>{u.current||h.currentTarget?.click()}),onKeyDown:Nt(n.onKeyDown,h=>{const p=c.searchRef.current!=="";r||p&&h.key===" "||Uw.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});qf.displayName=vh;var W4=E.forwardRef((n,e)=>{const{__scopeMenu:r,disabled:i=!1,textValue:s,...o}=n,a=mC(vh,r),c=B4(r),l=E.useRef(null),u=dr(e,l),[d,h]=E.useState(!1),[p,g]=E.useState("");return E.useEffect(()=>{const y=l.current;y&&g((y.textContent??"").trim())},[o.children]),f.jsx(Al.ItemSlot,{scope:r,disabled:i,textValue:s??p,children:f.jsx(mU,{asChild:!0,...c,focusable:!i,children:f.jsx(Xn.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...o,ref:u,onPointerMove:Nt(n.onPointerMove,jl(y=>{i?a.onItemLeave(y):(a.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Nt(n.onPointerLeave,jl(y=>a.onItemLeave(y))),onFocus:Nt(n.onFocus,()=>h(!0)),onBlur:Nt(n.onBlur,()=>h(!1))})})})}),Ede="MenuCheckboxItem",Y4=E.forwardRef((n,e)=>{const{checked:r=!1,onCheckedChange:i,...s}=n;return f.jsx(e6,{scope:n.__scopeMenu,checked:r,children:f.jsx(qf,{role:"menuitemcheckbox","aria-checked":xh(r)?"mixed":r,...s,ref:e,"data-state":SC(r),onSelect:Nt(s.onSelect,()=>i?.(xh(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Y4.displayName=Ede;var X4="MenuRadioGroup",[kde,Tde]=Uo(X4,{value:void 0,onValueChange:()=>{}}),Z4=E.forwardRef((n,e)=>{const{value:r,onValueChange:i,...s}=n,o=jh(i);return f.jsx(kde,{scope:n.__scopeMenu,value:r,onValueChange:o,children:f.jsx(vC,{...s,ref:e})})});Z4.displayName=X4;var Q4="MenuRadioItem",J4=E.forwardRef((n,e)=>{const{value:r,...i}=n,s=Tde(Q4,n.__scopeMenu),o=r===s.value;return f.jsx(e6,{scope:n.__scopeMenu,checked:o,children:f.jsx(qf,{role:"menuitemradio","aria-checked":o,...i,ref:e,"data-state":SC(o),onSelect:Nt(i.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});J4.displayName=Q4;var xC="MenuItemIndicator",[e6,Mde]=Uo(xC,{checked:!1}),t6=E.forwardRef((n,e)=>{const{__scopeMenu:r,forceMount:i,...s}=n,o=Mde(xC,r);return f.jsx(La,{present:i||xh(o.checked)||o.checked===!0,children:f.jsx(Xn.span,{...s,ref:e,"data-state":SC(o.checked)})})});t6.displayName=xC;var Ade="MenuSeparator",n6=E.forwardRef((n,e)=>{const{__scopeMenu:r,...i}=n;return f.jsx(Xn.div,{role:"separator","aria-orientation":"horizontal",...i,ref:e})});n6.displayName=Ade;var jde="MenuArrow",r6=E.forwardRef((n,e)=>{const{__scopeMenu:r,...i}=n,s=fu(r);return f.jsx(QD,{...s,...i,ref:e})});r6.displayName=jde;var bC="MenuSub",[Rde,i6]=Uo(bC),s6=n=>{const{__scopeMenu:e,children:r,open:i=!1,onOpenChange:s}=n,o=Vs(bC,e),a=fu(e),[c,l]=E.useState(null),[u,d]=E.useState(null),h=jh(s);return E.useEffect(()=>(o.open===!1&&h(!1),()=>h(!1)),[o.open,h]),f.jsx(c1,{...a,children:f.jsx(U4,{scope:e,open:i,onOpenChange:h,content:u,onContentChange:d,children:f.jsx(Rde,{scope:e,contentId:dl(),triggerId:dl(),trigger:c,onTriggerChange:l,children:r})})})};s6.displayName=bC;var Kc="MenuSubTrigger",o6=E.forwardRef((n,e)=>{const r=Vs(Kc,n.__scopeMenu),i=pu(Kc,n.__scopeMenu),s=i6(Kc,n.__scopeMenu),o=mC(Kc,n.__scopeMenu),a=E.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:l}=o,u={__scopeMenu:n.__scopeMenu},d=E.useCallback(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return E.useEffect(()=>d,[d]),E.useEffect(()=>{const h=c.current;return()=>{window.clearTimeout(h),l(null)}},[c,l]),f.jsx(pC,{asChild:!0,...u,children:f.jsx(W4,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":l6(r.open),...n,ref:kh(e,s.onTriggerChange),onClick:h=>{n.onClick?.(h),!(n.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Nt(n.onPointerMove,jl(h=>{o.onItemEnter(h),!h.defaultPrevented&&!n.disabled&&!r.open&&!a.current&&(o.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{r.onOpenChange(!0),d()},100))})),onPointerLeave:Nt(n.onPointerLeave,jl(h=>{d();const p=r.content?.getBoundingClientRect();if(p){const g=r.content?.dataset.side,y=g==="right",v=y?-5:5,x=p[y?"left":"right"],m=p[y?"right":"left"];o.onPointerGraceIntentChange({area:[{x:h.clientX+v,y:h.clientY},{x,y:p.top},{x:m,y:p.top},{x:m,y:p.bottom},{x,y:p.bottom}],side:g}),window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(h),h.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Nt(n.onKeyDown,h=>{const p=o.searchRef.current!=="";n.disabled||p&&h.key===" "||pde[i.dir].includes(h.key)&&(r.onOpenChange(!0),r.content?.focus(),h.preventDefault())})})})});o6.displayName=Kc;var a6="MenuSubContent",c6=E.forwardRef((n,e)=>{const r=H4(Tr,n.__scopeMenu),{forceMount:i=r.forceMount,...s}=n,o=Vs(Tr,n.__scopeMenu),a=pu(Tr,n.__scopeMenu),c=i6(a6,n.__scopeMenu),l=E.useRef(null),u=dr(e,l);return f.jsx(Al.Provider,{scope:n.__scopeMenu,children:f.jsx(La,{present:i||o.open,children:f.jsx(Al.Slot,{scope:n.__scopeMenu,children:f.jsx(yC,{id:c.contentId,"aria-labelledby":c.triggerId,...s,ref:u,align:"start",side:a.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{a.isUsingKeyboardRef.current&&l.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:Nt(n.onFocusOutside,d=>{d.target!==c.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Nt(n.onEscapeKeyDown,d=>{a.onClose(),d.preventDefault()}),onKeyDown:Nt(n.onKeyDown,d=>{const h=d.currentTarget.contains(d.target),p=gde[a.dir].includes(d.key);h&&p&&(o.onOpenChange(!1),c.trigger?.focus(),d.preventDefault())})})})})})});c6.displayName=a6;function l6(n){return n?"open":"closed"}function xh(n){return n==="indeterminate"}function SC(n){return xh(n)?"indeterminate":n?"checked":"unchecked"}function Ode(n){const e=document.activeElement;for(const r of n)if(r===e||(r.focus(),document.activeElement!==e))return}function Dde(n,e){return n.map((r,i)=>n[(e+i)%n.length])}function Nde(n,e,r){const s=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,o=r?n.indexOf(r):-1;let a=Dde(n,Math.max(o,0));s.length===1&&(a=a.filter(u=>u!==r));const l=a.find(u=>u.toLowerCase().startsWith(s.toLowerCase()));return l!==r?l:void 0}function Lde(n,e){const{x:r,y:i}=n;let s=!1;for(let o=0,a=e.length-1;o<e.length;a=o++){const c=e[o],l=e[a],u=c.x,d=c.y,h=l.x,p=l.y;d>i!=p>i&&r<(h-u)*(i-d)/(p-d)+u&&(s=!s)}return s}function Fde(n,e){if(!e)return!1;const r={x:n.clientX,y:n.clientY};return Lde(r,e)}function jl(n){return e=>e.pointerType==="mouse"?n(e):void 0}var u6=q4,d6=pC,h6=G4,f6=K4,p6=vC,g6=V4,m6=qf,y6=Y4,v6=Z4,x6=J4,b6=t6,S6=n6,w6=r6,_6=s6,C6=o6,P6=c6,zde=Th[" useInsertionEffect ".trim().toString()]||Mh;function $de({prop:n,defaultProp:e,onChange:r=()=>{},caller:i}){const[s,o,a]=Bde({defaultProp:e,onChange:r}),c=n!==void 0,l=c?n:s;{const d=E.useRef(n!==void 0);E.useEffect(()=>{const h=d.current;h!==c&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=c},[c,i])}const u=E.useCallback(d=>{if(c){const h=Ude(d)?d(n):d;h!==n&&a.current?.(h)}else o(d)},[c,n,o,a]);return[l,u]}function Bde({defaultProp:n,onChange:e}){const[r,i]=E.useState(n),s=E.useRef(r),o=E.useRef(e);return zde(()=>{o.current=e},[e]),E.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,i,o]}function Ude(n){return typeof n=="function"}var wC="ContextMenu",[qde]=Fl(wC,[Uf]),In=Uf(),[Hde,I6]=qde(wC),E6=n=>{const{__scopeContextMenu:e,children:r,onOpenChange:i,dir:s,modal:o=!0}=n,[a,c]=E.useState(!1),l=In(e),u=jh(i),d=E.useCallback(h=>{c(h),u(h)},[u]);return f.jsx(Hde,{scope:e,open:a,onOpenChange:d,modal:o,children:f.jsx(u6,{...l,dir:s,open:a,onOpenChange:d,modal:o,children:r})})};E6.displayName=wC;var k6="ContextMenuTrigger",T6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,disabled:i=!1,...s}=n,o=I6(k6,r),a=In(r),c=E.useRef({x:0,y:0}),l=E.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...c.current})}),u=E.useRef(0),d=E.useCallback(()=>window.clearTimeout(u.current),[]),h=p=>{c.current={x:p.clientX,y:p.clientY},o.onOpenChange(!0)};return E.useEffect(()=>d,[d]),E.useEffect(()=>void(i&&d()),[i,d]),f.jsxs(f.Fragment,{children:[f.jsx(d6,{...a,virtualRef:l}),f.jsx(Xn.span,{"data-state":o.open?"open":"closed","data-disabled":i?"":void 0,...s,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:i?n.onContextMenu:wc(n.onContextMenu,p=>{d(),h(p),p.preventDefault()}),onPointerDown:i?n.onPointerDown:wc(n.onPointerDown,ud(p=>{d(),u.current=window.setTimeout(()=>h(p),700)})),onPointerMove:i?n.onPointerMove:wc(n.onPointerMove,ud(d)),onPointerCancel:i?n.onPointerCancel:wc(n.onPointerCancel,ud(d)),onPointerUp:i?n.onPointerUp:wc(n.onPointerUp,ud(d))})]})});T6.displayName=k6;var Gde="ContextMenuPortal",_C=n=>{const{__scopeContextMenu:e,...r}=n,i=In(e);return f.jsx(h6,{...i,...r})};_C.displayName=Gde;var M6="ContextMenuContent",A6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=I6(M6,r),o=In(r),a=E.useRef(!1);return f.jsx(f6,{...o,...i,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:c=>{n.onCloseAutoFocus?.(c),!c.defaultPrevented&&a.current&&c.preventDefault(),a.current=!1},onInteractOutside:c=>{n.onInteractOutside?.(c),!c.defaultPrevented&&!s.modal&&(a.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});A6.displayName=M6;var Kde="ContextMenuGroup",j6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(p6,{...s,...i,ref:e})});j6.displayName=Kde;var Vde="ContextMenuLabel",Wde=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(g6,{...s,...i,ref:e})});Wde.displayName=Vde;var Yde="ContextMenuItem",R6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(m6,{...s,...i,ref:e})});R6.displayName=Yde;var Xde="ContextMenuCheckboxItem",O6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(y6,{...s,...i,ref:e})});O6.displayName=Xde;var Zde="ContextMenuRadioGroup",Qde=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(v6,{...s,...i,ref:e})});Qde.displayName=Zde;var Jde="ContextMenuRadioItem",ehe=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(x6,{...s,...i,ref:e})});ehe.displayName=Jde;var the="ContextMenuItemIndicator",nhe=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(b6,{...s,...i,ref:e})});nhe.displayName=the;var rhe="ContextMenuSeparator",ihe=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(S6,{...s,...i,ref:e})});ihe.displayName=rhe;var she="ContextMenuArrow",ohe=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(w6,{...s,...i,ref:e})});ohe.displayName=she;var D6="ContextMenuSub",N6=n=>{const{__scopeContextMenu:e,children:r,onOpenChange:i,open:s,defaultOpen:o}=n,a=In(e),[c,l]=$de({prop:s,defaultProp:o??!1,onChange:i,caller:D6});return f.jsx(_6,{...a,open:c,onOpenChange:l,children:r})};N6.displayName=D6;var ahe="ContextMenuSubTrigger",L6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(C6,{...s,...i,ref:e})});L6.displayName=ahe;var che="ContextMenuSubContent",F6=E.forwardRef((n,e)=>{const{__scopeContextMenu:r,...i}=n,s=In(r);return f.jsx(P6,{...s,...i,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});F6.displayName=che;function ud(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var lhe=E6,uhe=T6,dhe=_C,hhe=A6,fhe=O6;const z6=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,phe=z6?"":"Ctrl",ghe=z6?"":"Alt";function $6(n){return n.split(",")[0].split("").map(e=>{const r=e.replace(/\$/g,phe).replace(/\?/g,ghe).replace(/!/g,"");return r[0].toUpperCase()+r.slice(1)})}function qw(n){return" "+$6(n).join("")}function mhe(n){return f.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:f.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[f.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),f.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:f.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function bh(n,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(n?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}var yhe=Th[" useInsertionEffect ".trim().toString()]||Mh;function B6({prop:n,defaultProp:e,onChange:r=()=>{},caller:i}){const[s,o,a]=vhe({defaultProp:e,onChange:r}),c=n!==void 0,l=c?n:s;{const d=E.useRef(n!==void 0);E.useEffect(()=>{const h=d.current;h!==c&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=c},[c,i])}const u=E.useCallback(d=>{if(c){const h=xhe(d)?d(n):d;h!==n&&a.current?.(h)}else o(d)},[c,n,o,a]);return[l,u]}function vhe({defaultProp:n,onChange:e}){const[r,i]=E.useState(n),s=E.useRef(r),o=E.useRef(e);return yhe(()=>{o.current=e},[e]),E.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,i,o]}function xhe(n){return typeof n=="function"}var Hf="DropdownMenu",[bhe]=Fl(Hf,[Uf]),En=Uf(),[She,U6]=bhe(Hf),q6=n=>{const{__scopeDropdownMenu:e,children:r,dir:i,open:s,defaultOpen:o,onOpenChange:a,modal:c=!0}=n,l=En(e),u=E.useRef(null),[d,h]=B6({prop:s,defaultProp:o??!1,onChange:a,caller:Hf});return f.jsx(She,{scope:e,triggerId:dl(),triggerRef:u,contentId:dl(),open:d,onOpenChange:h,onOpenToggle:E.useCallback(()=>h(p=>!p),[h]),modal:c,children:f.jsx(u6,{...l,open:d,onOpenChange:h,dir:i,modal:c,children:r})})};q6.displayName=Hf;var H6="DropdownMenuTrigger",G6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,disabled:i=!1,...s}=n,o=U6(H6,r),a=En(r);return f.jsx(d6,{asChild:!0,...a,children:f.jsx(Xn.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...s,ref:kh(e,o.triggerRef),onPointerDown:bh(n.onPointerDown,c=>{!i&&c.button===0&&c.ctrlKey===!1&&(o.onOpenToggle(),o.open||c.preventDefault())}),onKeyDown:bh(n.onKeyDown,c=>{i||(["Enter"," "].includes(c.key)&&o.onOpenToggle(),c.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(c.key)&&c.preventDefault())})})})});G6.displayName=H6;var whe="DropdownMenuPortal",K6=n=>{const{__scopeDropdownMenu:e,...r}=n,i=En(e);return f.jsx(h6,{...i,...r})};K6.displayName=whe;var V6="DropdownMenuContent",W6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=U6(V6,r),o=En(r),a=E.useRef(!1);return f.jsx(f6,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...i,ref:e,onCloseAutoFocus:bh(n.onCloseAutoFocus,c=>{a.current||s.triggerRef.current?.focus(),a.current=!1,c.preventDefault()}),onInteractOutside:bh(n.onInteractOutside,c=>{const l=c.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;(!s.modal||d)&&(a.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});W6.displayName=V6;var _he="DropdownMenuGroup",Y6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(p6,{...s,...i,ref:e})});Y6.displayName=_he;var Che="DropdownMenuLabel",Phe=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(g6,{...s,...i,ref:e})});Phe.displayName=Che;var Ihe="DropdownMenuItem",X6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(m6,{...s,...i,ref:e})});X6.displayName=Ihe;var Ehe="DropdownMenuCheckboxItem",Z6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(y6,{...s,...i,ref:e})});Z6.displayName=Ehe;var khe="DropdownMenuRadioGroup",The=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(v6,{...s,...i,ref:e})});The.displayName=khe;var Mhe="DropdownMenuRadioItem",Ahe=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(x6,{...s,...i,ref:e})});Ahe.displayName=Mhe;var jhe="DropdownMenuItemIndicator",Rhe=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(b6,{...s,...i,ref:e})});Rhe.displayName=jhe;var Ohe="DropdownMenuSeparator",Dhe=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(S6,{...s,...i,ref:e})});Dhe.displayName=Ohe;var Nhe="DropdownMenuArrow",Lhe=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(w6,{...s,...i,ref:e})});Lhe.displayName=Nhe;var Fhe=n=>{const{__scopeDropdownMenu:e,children:r,open:i,onOpenChange:s,defaultOpen:o}=n,a=En(e),[c,l]=B6({prop:i,defaultProp:o??!1,onChange:s,caller:"DropdownMenuSub"});return f.jsx(_6,{...a,open:c,onOpenChange:l,children:r})},zhe="DropdownMenuSubTrigger",Q6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(C6,{...s,...i,ref:e})});Q6.displayName=zhe;var $he="DropdownMenuSubContent",J6=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:r,...i}=n,s=En(r);return f.jsx(P6,{...s,...i,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});J6.displayName=$he;var CC=q6,PC=G6,Gf=K6,IC=W6,Bhe=Y6,Uhe=X6,qhe=Z6,Hhe=Fhe,Ghe=Q6,Khe=J6;function Ao({id:n,children:e,modal:r=!1,debugOpen:i=!1}){const[s,o]=fs(n);return f.jsx(CC,{open:i||s,dir:"ltr",modal:r,onOpenChange:o,children:e})}function jo({children:n,...e}){return f.jsx(PC,{dir:"ltr",asChild:!0,onTouchEnd:r=>We(r),...e,children:n})}function Ro({side:n="bottom",align:e="start",sideOffset:r=8,alignOffset:i=8,children:s}){const o=Jt();return f.jsx(Gf,{container:o,children:f.jsx(IC,{className:"tlui-menu",side:n,sideOffset:r,align:e,alignOffset:i,collisionPadding:4,children:s})})}function Vhe({id:n,children:e}){const[r,i]=fs(n);return f.jsx(Hhe,{open:r,onOpenChange:i,children:e})}function Whe({id:n,label:e,title:r,disabled:i}){return f.jsx(Ghe,{dir:"ltr",asChild:!0,disabled:i,children:f.jsxs(Ae,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:i,title:r,children:[f.jsx(Lt,{children:e}),f.jsx(qe,{icon:"chevron-right",small:!0})]})})}function Yhe({id:n,alignOffset:e=-1,sideOffset:r=-4,size:i="small",children:s}){const o=Jt();return f.jsx(Gf,{container:o,children:f.jsx(Khe,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:r,collisionPadding:4,"data-size":i,children:s})})}function Xhe({children:n}){return f.jsx(Bhe,{dir:"ltr",className:"tlui-menu__group",children:n})}function Rl({noClose:n,children:e}){return f.jsx(Uhe,{dir:"ltr",asChild:!0,onClick:n?We:void 0,children:e})}function ol({children:n,visibleOnMobileLayout:e=!1}){const r=jn();return!e&&r<Rt.MOBILE?null:f.jsx("kbd",{className:"tlui-kbd",children:$6(n).map((i,s)=>f.jsx("span",{children:i},s))})}function te({disabled:n=!1,spinner:e=!1,readonlyOk:r=!1,id:i,kbd:s,label:o,icon:a,onSelect:c,noClose:l,isSelected:u}){const{type:d,sourceId:h}=Bf(),p=Ge(),[g,y]=E.useState(!1);if(hs()&&!r)return null;const x=Ml(o,d),m=s?qw(s):void 0,b=x?p(x):void 0,S=b&&m?`${b} ${m}`:b;switch(d){case"menu":return f.jsx(Rl,{children:f.jsxs(Ae,{type:"menu","data-testid":`${h}.${i}`,disabled:n,title:S,onClick:w=>{l&&We(w),g?y(!1):c(h)},children:[f.jsx(Lt,{children:b}),s&&f.jsx(ol,{children:s})]})});case"context-menu":return n?null:f.jsxs(R6,{dir:"ltr",title:S,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${i}`,onSelect:w=>{l&&We(w),g?y(!1):c(h)},children:[f.jsx("span",{className:"tlui-button__label",draggable:!1,children:b}),s&&f.jsx(ol,{children:s}),e&&f.jsx(mhe,{})]});case"panel":return f.jsxs(Ae,{"data-testid":`${h}.${i}`,type:"menu",title:S,disabled:n,onClick:()=>c(h),children:[f.jsx(Lt,{children:b}),a&&f.jsx(qe,{icon:a})]});case"small-icons":case"icons":return f.jsx(Ae,{"data-testid":`${h}.${i}`,type:"icon",title:S,disabled:n,onClick:()=>c(h),children:f.jsx(qe,{icon:a,small:d==="small-icons"})});case"keyboard-shortcuts":return s?f.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${i}`,children:[f.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:b}),f.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:f.jsx(ol,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return f.jsxs(Ae,{type:"low",onClick:()=>c(h),children:[f.jsx(qe,{icon:a}),f.jsx(Lt,{children:b})]});case"toolbar":return f.jsx(Ae,{type:"tool","data-testid":`tools.${i}`,"aria-label":x,"data-value":i,onClick:()=>c("toolbar"),title:S,onTouchStart:w=>{We(w),c("toolbar")},role:"radio","aria-checked":u?"true":"false",children:f.jsx(qe,{icon:a})});case"toolbar-overflow":return f.jsx(Rl,{"aria-label":o,children:f.jsx(Ae,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{c("toolbar")},"data-testid":`tools.more.${i}`,title:S,role:"radio","aria-checked":u?"true":"false","data-value":i,children:f.jsx(qe,{icon:a})})});default:throw wn(d)}}function Zhe(){return f.jsxs(f.Fragment,{children:[f.jsx(Qhe,{}),f.jsx(Jhe,{}),f.jsx(efe,{}),f.jsx(tfe,{}),f.jsx(nfe,{}),f.jsx(sfe,{}),f.jsx(ofe,{}),f.jsx(afe,{})]})}function Qhe(){const n=Ie(),e=Rn(2),r=ps(),i=e&&r;return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n["align-left"],disabled:!i}),f.jsx(te,{...n["align-center-horizontal"],disabled:!i}),f.jsx(te,{...n["align-right"],disabled:!i}),f.jsx(te,{...n["stretch-horizontal"],disabled:!i}),f.jsx(te,{...n["align-top"],disabled:!i}),f.jsx(te,{...n["align-center-vertical"],disabled:!i}),f.jsx(te,{...n["align-bottom"],disabled:!i}),f.jsx(te,{...n["stretch-vertical"],disabled:!i})]})}function Jhe(){const n=Ie(),e=Rn(3),r=ps(),i=e&&r;return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n["distribute-horizontal"],disabled:!i}),f.jsx(te,{...n["distribute-vertical"],disabled:!i})]})}function efe(){const n=Ie(),e=R4(),r=ps(),i=e&&r;return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n["stack-horizontal"],disabled:!i}),f.jsx(te,{...n["stack-vertical"],disabled:!i})]})}function tfe(){const n=Ie(),e=Rn(1),r=ps(),i=e&&r;return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n["send-to-back"],disabled:!i}),f.jsx(te,{...n["send-backward"],disabled:!i}),f.jsx(te,{...n["bring-forward"],disabled:!i}),f.jsx(te,{...n["bring-to-front"],disabled:!i})]})}function nfe(){return jn()<Rt.TABLET_SM?f.jsx(rfe,{}):f.jsx(ife,{})}function rfe(){const n=Ie(),e=Z(),r=ne("zoom is 1",()=>e.getZoomLevel()===1,[e]);return f.jsx(te,{...n["zoom-to-100"],disabled:r})}function ife(){const n=Ie(),e=Rn(1),r=ps(),i=e&&r;return f.jsx(te,{...n["rotate-ccw"],disabled:!i})}function sfe(){const n=Ie(),e=Rn(1),r=ps(),i=e&&r;return f.jsx(te,{...n["rotate-cw"],disabled:!i})}function ofe(){const n=Ie(),e=L4(),r=ps(),i=e&&r;return f.jsx(te,{...n["edit-link"],disabled:!i})}function afe(){const n=O4(),e=D4();return n?f.jsx(HO,{}):e?f.jsx(cfe,{}):f.jsx(HO,{})}function HO(){const n=Ie(),e=Rn(2),r=ps(),i=e&&r;return f.jsx(te,{...n.group,disabled:!i})}function cfe(){const n=Ie();return f.jsx(te,{...n.ungroup})}const lfe=E.memo(function({children:e}){const r=Ge(),i=jn(),s=hs(),o=Z(),a=ne("should display quick actions when in readonly",()=>o.isInAny("hand","zoom"),[o]),c=e??f.jsx(Zhe,{});if(!(s&&!a))return f.jsxs(dC,{id:"actions-menu",children:[f.jsx(hC,{children:f.jsx(Ae,{type:"icon","data-testid":"actions-menu.button",title:r("actions-menu.title"),children:f.jsx(qe,{icon:"dots-vertical",small:!0})})}),f.jsx(fC,{side:i>=Rt.TABLET?"bottom":"top",sideOffset:6,children:f.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:f.jsx(Mr,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function Qn({id:n,kbd:e,label:r,readonlyOk:i,onSelect:s,toggle:o=!1,disabled:a=!1,checked:c=!1}){const{type:l,sourceId:u}=Bf(),d=hs(),h=Ge();if(d&&!i)return null;const p=Ml(r,l),g=p?h(p):void 0;switch(l){case"menu":return f.jsxs(qhe,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:g,onSelect:y=>{s?.(u),We(y)},disabled:a,checked:c,children:[f.jsx(Ci,{small:!0,icon:o?c?"toggle-on":"toggle-off":c?"check":"none"}),g&&f.jsx("span",{className:"tlui-button__label",draggable:!1,children:g}),e&&f.jsx(ol,{children:e})]});case"context-menu":return f.jsxs(fhe,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:g,onSelect:y=>{s(u),We(y)},disabled:a,checked:c,children:[f.jsx(Ci,{small:!0,icon:o?c?"toggle-on":"toggle-off":c?"check":"none"}),g&&f.jsx("span",{className:"tlui-button__label",draggable:!1,children:g}),e&&f.jsx(ol,{children:e})]},n);default:return null}}function Fe({id:n,label:e,children:r}){const{type:i,sourceId:s}=Bf(),o=Ge(),a=Ml(e,i),c=a?o(a):void 0;switch(i){case"panel":return f.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${n}`,children:r});case"menu":return f.jsx(Xhe,{"data-testid":`${s}-group.${n}`,children:r});case"context-menu":return f.jsx(j6,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${n}`,children:r});case"keyboard-shortcuts":return f.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${n}`,children:[f.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:c}),f.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:r})]});default:return r}}function On({id:n,disabled:e=!1,label:r,size:i="small",children:s}){const{type:o,sourceId:a}=Bf(),c=Jt(),l=Ge(),u=r?typeof r=="string"?r:r[o]??r.default:void 0,d=u?l(u):void 0;switch(o){case"menu":return f.jsxs(Vhe,{id:`${a}-sub.${n}`,children:[f.jsx(Whe,{id:`${a}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:e,label:d,title:d}),f.jsx(Yhe,{id:`${a}-sub.${d?d.toLowerCase()+"-content":""}`,size:i,children:s})]});case"context-menu":return e?null:f.jsxs(ufe,{id:`${a}-sub.${n}`,children:[f.jsx(L6,{dir:"ltr",disabled:e,asChild:!0,children:f.jsxs(Ae,{"data-testid":`${a}-sub-trigger.${n}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[f.jsx(Lt,{children:d}),f.jsx(qe,{icon:"chevron-right",small:!0})]})}),f.jsx(_C,{container:c,children:f.jsx(F6,{"data-testid":`${a}-sub-content.${n}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":i,children:s})})]});default:return s}}function ufe({id:n,children:e}){const[r,i]=fs(n);return f.jsx(N6,{open:r,onOpenChange:i,children:e})}function e8(){const n=Ie();return ide()?f.jsx(te,{...n["toggle-auto-size"]}):null}function t8(){const n=Ie();return L4()?f.jsx(te,{...n["edit-link"]}):null}function dfe(){const n=Ie();return Rn(1)?f.jsx(te,{...n.duplicate}):null}function n8(){const n=Ie(),e=Z();return ne("should display flatten option",()=>{if(e.getSelectedShapeIds().length===0)return!1;const s=e.getOnlySelectedShape();return!(s&&e.isShapeOfType(s,"image"))},[e])?f.jsx(te,{...n["flatten-to-image"]}):null}function r8(){const n=Ie();return O4()?f.jsx(te,{...n.group}):null}function i8(){const n=Ie();return D4()?f.jsx(te,{...n.ungroup}):null}function s8(){const n=Z(),e=Ie();return ne("allow unframe",()=>{const i=n.getSelectedShapes();return i.length===0?!1:i.every(s=>n.isShapeOfType(s,"frame"))},[n])?f.jsx(te,{...e["remove-frame"]}):null}function o8(){const n=Z(),e=Ie();return ne("allow fit frame to content",()=>{const i=n.getOnlySelectedShape();return i?n.isShapeOfType(i,"frame")&&n.getSortedChildIdsForParent(i).length>0:!1},[n])?f.jsx(te,{...e["fit-frame-to-content"]}):null}function a8(){const n=Z(),e=Ie();return ne("selected shapes",()=>n.getSelectedShapes().length>0,[n])?f.jsx(te,{...e["toggle-lock"]}):null}function EC(){const n=Ie(),e=Z(),r=ne("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return f.jsx(Qn,{...n["toggle-transparent"],checked:r,toggle:!0})}function hfe(){const n=Z(),e=Ie(),r=ne("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return f.jsx(te,{...e["unlock-all"],disabled:!r})}function c8(){const n=Z(),e=ne("zoomed to 100",()=>n.getZoomLevel()===1,[n]),r=Ie();return f.jsx(te,{...r["zoom-to-100"],noClose:!0,disabled:e})}function l8(){const n=Z(),e=ne("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]),r=Ie();return f.jsx(te,{...r["zoom-to-fit"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function u8(){const n=Z(),e=ne("has shapes",()=>n.getSelectedShapeIds().length>0,[n]),r=Ie();return f.jsx(te,{...r["zoom-to-selection"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function d8(){return f.jsxs(Fe,{id:"clipboard",children:[f.jsx(pfe,{}),f.jsx(gfe,{}),f.jsx(mfe,{}),f.jsx(dfe,{}),f.jsx(yfe,{})]})}function ffe(){const n=Z(),e=Ie(),r=ne("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return f.jsxs(On,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!r,children:[f.jsxs(Fe,{id:"copy-as-group",children:[f.jsx(te,{...e["copy-as-svg"]}),!!window.navigator.clipboard?.write&&f.jsx(te,{...e["copy-as-png"]}),f.jsx(te,{...e["copy-as-json"]})]}),f.jsx(Fe,{id:"copy-as-bg",children:f.jsx(EC,{})})]})}function pfe(){const n=Ie(),e=Rn(1);return f.jsx(te,{...n.cut,disabled:!e})}function gfe(){const n=Ie(),e=N4(1);return f.jsx(te,{...n.copy,disabled:!e})}function mfe(){const n=Ie(),e=rde;return f.jsx(te,{...n.paste,disabled:!e})}function h8(){const n=Z(),e=Ie();return ne("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?f.jsxs(Fe,{id:"conversions",children:[f.jsx(ffe,{}),f.jsxs(On,{id:"export-as",label:"context-menu.export-as",size:"small",children:[f.jsxs(Fe,{id:"export-as-group",children:[f.jsx(te,{...e["export-as-svg"]}),f.jsx(te,{...e["export-as-png"]}),f.jsx(te,{...e["export-as-json"]})]}),f.jsx(Fe,{id:"export-as-bg",children:f.jsx(EC,{})})]})]}):null}function f8(){const n=Ie(),e=Z(),r=ne("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return f.jsx(te,{...n["select-all"],disabled:!r})}function yfe(){const n=Ie(),e=Rn(1);return f.jsx(te,{...n.delete,disabled:!e})}function vfe(){return N4(1)?f.jsxs(On,{id:"edit",label:"context-menu.edit",size:"small",children:[f.jsx(r8,{}),f.jsx(i8,{}),f.jsx(n8,{}),f.jsx(t8,{}),f.jsx(o8,{}),f.jsx(s8,{}),f.jsx(g8,{}),f.jsx(p8,{}),f.jsx(e8,{}),f.jsx(a8,{})]}):null}function xfe(){const n=Rn(2),e=sde(),r=Ie();return n||e?f.jsxs(On,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&f.jsxs(Fe,{id:"align",children:[f.jsx(te,{...r["align-left"]}),f.jsx(te,{...r["align-center-horizontal"]}),f.jsx(te,{...r["align-right"]}),f.jsx(te,{...r["align-top"]}),f.jsx(te,{...r["align-center-vertical"]}),f.jsx(te,{...r["align-bottom"]})]}),f.jsx(bfe,{}),n&&f.jsxs(Fe,{id:"stretch",children:[f.jsx(te,{...r["stretch-horizontal"]}),f.jsx(te,{...r["stretch-vertical"]})]}),(n||e)&&f.jsxs(Fe,{id:"flip",children:[f.jsx(te,{...r["flip-horizontal"]}),f.jsx(te,{...r["flip-vertical"]})]}),f.jsx(Sfe,{})]}):null}function bfe(){const n=Ie();return Rn(3)?f.jsxs(Fe,{id:"distribute",children:[f.jsx(te,{...n["distribute-horizontal"]}),f.jsx(te,{...n["distribute-vertical"]})]}):null}function Sfe(){const n=Ie(),e=Rn(2),r=R4();return e?f.jsxs(Fe,{id:"order",children:[f.jsx(te,{...n.pack}),r&&f.jsx(te,{...n["stack-horizontal"]}),r&&f.jsx(te,{...n["stack-vertical"]})]}):null}function wfe(){const n=Ie();return Rn(1)?f.jsx(On,{id:"reorder",label:"context-menu.reorder",size:"small",children:f.jsxs(Fe,{id:"reorder",children:[f.jsx(te,{...n["bring-to-front"]}),f.jsx(te,{...n["bring-forward"]}),f.jsx(te,{...n["send-backward"]}),f.jsx(te,{...n["send-to-back"]})]})}):null}function _fe(){const n=Z(),e=ne("pages",()=>n.getPages(),[n]),r=ne("current page id",()=>n.getCurrentPageId(),[n]),{addToast:i}=ri(),s=Ie(),o=un();return Rn(1)?f.jsxs(On,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[f.jsx(Fe,{id:"pages",children:e.map(c=>f.jsx(te,{id:c.id,disabled:r===c.id,label:c.name,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),c.id);const l=n.getPage(c.id);l&&i({title:"Changed Page",description:`Moved to ${l.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(r)}}]}),o("move-to-page",{source:"context-menu"})}},c.id))}),f.jsx(Fe,{id:"new-page",children:f.jsx(te,{...s["move-to-new-page"]})})]}):null}function p8(){const n=Z(),e=Ie();return ne("oneEmbedSelected",()=>{const i=n.getOnlySelectedShape();return i?!!(n.isShapeOfType(i,"embed")&&i.props.url&&!n.isShapeOrAncestorLocked(i)):!1},[n])?f.jsx(te,{...e["convert-to-bookmark"]}):null}function g8(){const n=Z(),e=Ie();return ne("oneEmbeddableBookmarkSelected",()=>{const i=n.getOnlySelectedShape();return i?!!(n.isShapeOfType(i,"bookmark")&&i.props.url&&Ms(i.props.url)&&!n.isShapeOrAncestorLocked(i)):!1},[n])?f.jsx(te,{...e["convert-to-embed"]}):null}function Cfe(){const n=Ie(),e=Z(),r=ne("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return f.jsx(Qn,{...n["toggle-snap-mode"],checked:r})}function Pfe(){const n=Ie(),e=Z(),r=ne("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return f.jsx(Qn,{...n["toggle-tool-lock"],checked:r})}function Ife(){const n=Ie(),e=Z(),r=ne("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return f.jsx(Qn,{...n["toggle-grid"],checked:r})}function Efe(){const n=Ie(),e=Z(),r=ne("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return f.jsx(Qn,{...n["toggle-wrap-mode"],checked:r})}function kfe(){const n=Ie(),e=Z(),r=ne("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return f.jsx(Qn,{...n["toggle-focus-mode"],checked:r})}function Tfe(){const n=Ie(),e=Z(),r=ne("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return f.jsx(Qn,{...n["toggle-edge-scrolling"],checked:r===1})}function Mfe(){const n=Ie(),e=Z(),r=ne("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return f.jsx(Qn,{...n["toggle-reduce-motion"],checked:r===0})}function Afe(){const n=Ie(),e=Z(),r=ne("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return f.jsx(Qn,{...n["toggle-debug-mode"],checked:r})}function jfe(){const n=Ie(),e=Z(),r=ne("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return f.jsx(Qn,{...n["toggle-dynamic-size-mode"],checked:r})}function Rfe(){const n=Ie(),e=Z(),r=ne("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return f.jsx(Qn,{...n["toggle-paste-at-cursor"],checked:r})}function Ofe(){const n=Z(),e=Ie();return ne("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?f.jsx(te,{...e["open-cursor-chat"]}):null}function Dfe(){const n=Z(),e=zf();return ne("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n])?f.jsxs(f.Fragment,{children:[e&&f.jsx(Ofe,{}),f.jsxs(Fe,{id:"modify",children:[f.jsx(vfe,{}),f.jsx(xfe,{}),f.jsx(wfe,{}),f.jsx(_fe,{})]}),f.jsx(d8,{}),f.jsx(h8,{}),f.jsx(Fe,{id:"select-all",children:f.jsx(f8,{})})]}):null}const Nfe=E.memo(function({children:e}){const r=Z(),{Canvas:i}=Ct(),s=E.useCallback(u=>{if(u){if(r.getInstanceState().isCoarsePointer){const d=r.getSelectedShapes(),{inputs:{currentPagePoint:h}}=r,p=r.getShapesAtPoint(h);if(!r.getSelectedShapes().length||!p.some(g=>d.includes(g))){const g=p.filter(y=>r.isShapeOrAncestorLocked(y));g.length&&r.select(...g.map(y=>y.id))}}}else{const d=r.getOnlySelectedShape();d&&r.isShapeOrAncestorLocked(d)&&r.setSelectedShapes([])}},[r]),o=Jt(),[a,c]=fs("context menu",s),l=e??f.jsx(Dfe,{});return f.jsxs(lhe,{dir:"ltr",onOpenChange:c,modal:!1,children:[f.jsx(uhe,{onContextMenu:void 0,dir:"ltr",children:i?f.jsx(i,{}):null}),a&&f.jsx(dhe,{container:o,children:f.jsx(hhe,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:We,children:f.jsx(Mr,{type:"context-menu",sourceId:"context-menu",children:l})})})]})}),Lfe=2e3,Ffe=5e3,zfe=Qt(function(){const e=Z(),{isChatting:r,chatMessage:i}=e.getInstanceState(),s=E.useRef(-1),[o,a]=E.useState("");return E.useEffect(()=>{if(!r&&i||r){const l=r?Ffe:Lfe;s.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),a(""),e.focus()},l)}return()=>{clearTimeout(s.current)}},[e,i,r]),r?f.jsx(Bfe,{value:o,setValue:a,chatMessage:i}):i.trim()?f.jsx($fe,{chatMessage:i}):null});function m8(n){const e=Z();E.useLayoutEffect(()=>{if(!n.current)return;const{x:i,y:s}=e.inputs.currentScreenPoint;n.current?.style.setProperty("transform",`translate(${i}px, ${s}px)`);function o(a){const{minX:c,minY:l}=e.getViewportScreenBounds();n.current?.style.setProperty("transform",`translate(${a.clientX-c}px, ${a.clientY-l}px)`)}return window.addEventListener("pointermove",o),()=>{window.removeEventListener("pointermove",o)}},[n,e])}const $fe=({chatMessage:n})=>{const e=Z(),r=E.useRef(null);return m8(r),f.jsx("div",{ref:r,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},Bfe=Qt(function({chatMessage:e,value:r,setValue:i}){const s=Z(),o=Ge(),a=E.useRef(null),c=e||o("cursor-chat.type-to-chat");m8(a),E.useLayoutEffect(()=>{const p=a.current;if(!p)return;const g=s.textMeasure.measureText(r||c,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",g.w+"px")},[s,r,c]),E.useLayoutEffect(()=>{const p=s.timers.requestAnimationFrame(()=>{a.current?.focus()});return()=>{cancelAnimationFrame(p)}},[s]);const l=E.useCallback(()=>{s.updateInstanceState({isChatting:!1}),s.focus()},[s]),u=E.useCallback(p=>{const{value:g}=p.target;i(g.slice(0,64)),s.updateInstanceState({chatMessage:g})},[s,i]),d=E.useCallback(p=>{const g=a.current;if(!g)return;const{value:y}=g;switch(p.key){case"Enter":{if(We(p),p.stopPropagation(),!y){l();return}i("");break}case"Escape":{We(p),p.stopPropagation(),l();break}}},[l,i]),h=E.useCallback(p=>{p.stopPropagation()},[]);return f.jsx("input",{ref:a,className:"tl-cursor-chat",style:{backgroundColor:s.user.getColor()},onBlur:l,onChange:u,onKeyDown:d,onPaste:h,value:r,placeholder:c,spellCheck:!1})});function Hw({checked:n}){return f.jsx(Ci,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function Ufe(){const n=Z(),{addToast:e}=ri(),{addDialog:r}=Bo(),[i,s]=nt.useState(!1);return f.jsxs(f.Fragment,{children:[f.jsxs(Fe,{id:"items",children:[f.jsx(te,{id:"add-toast",onSelect:()=>{e({id:kt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:kt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:kt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:kt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),f.jsx(te,{id:"show-dialog",label:"Show dialog",onSelect:()=>{r({component:({onClose:o})=>f.jsx(Gfe,{displayDontShowAgain:!0,onCancel:()=>o(),onContinue:()=>o()}),onClose:()=>{}})}}),f.jsx(te,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Kfe(n,100)}),f.jsx(te,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{const o=n.getSelectedShapes(),a=o.length===0?n.getRenderingShapes():o;window.alert(`Shapes ${a.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(i)throw Error("oh no!");return null})(),f.jsx(te,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),f.jsx(te,{id:"hard-reset",onSelect:Az,label:"Hard reset"})]}),f.jsxs(Fe,{id:"flags",children:[f.jsx(qfe,{}),f.jsx(Hfe,{})]})]})}function qfe(){const n=Object.values(Dt);return n.length?f.jsx(On,{id:"debug flags",label:"Debug Flags",children:f.jsx(Fe,{id:"debug flags",children:n.map(e=>f.jsx(y8,{flag:e},e.name))})}):null}function Hfe(){const n=Object.values(x_);return n.length?f.jsx(On,{id:"feature flags",label:"Feature Flags",children:f.jsx(Fe,{id:"feature flags",children:n.map(e=>f.jsx(y8,{flag:e},e.name))})}):null}function Gfe({title:n="title",body:e="hello hello hello",cancel:r="Cancel",confirm:i="Continue",displayDontShowAgain:s=!1,onCancel:o,onContinue:a}){const[c,l]=nt.useState(!1);return f.jsxs(f.Fragment,{children:[f.jsxs(Of,{children:[f.jsx(Df,{children:n}),f.jsx(Nf,{})]}),f.jsx(Tl,{style:{maxWidth:350},children:e}),f.jsxs(iC,{className:"tlui-dialog__footer__actions",children:[s&&f.jsxs(Ae,{type:"normal",onClick:()=>l(!c),style:{marginRight:"auto"},children:[f.jsx(Hw,{checked:c}),f.jsx(Lt,{children:"Dont show again"})]}),f.jsx(Ae,{type:"normal",onClick:o,children:f.jsx(Lt,{children:r})}),f.jsx(Ae,{type:"primary",onClick:async()=>a(),children:f.jsx(Lt,{children:i})})]})]})}const y8=Qt(function({flag:e,onChange:r}){const i=e.get();return f.jsx(Qn,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,s=>`${s[0]} ${s[1].toLowerCase()}`).replace(/^[a-z]/,s=>s.toUpperCase()),checked:i,onSelect:()=>{e.set(!i),r?.(!i)}})});let GO=0;function Kfe(n,e){const r=Array(e),i=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)GO++,r[s]={id:it("box"+GO),type:"geo",x:s%i*132,y:Math.floor(s/i)*132};n.run(()=>{n.createShapes(r).setSelectedShapes(r.map(s=>s.id))})}function Vfe({children:n}){const e=n??f.jsx(Ufe,{});return f.jsxs(Ao,{id:"debug",children:[f.jsx(jo,{children:f.jsx(Ae,{type:"icon",title:"Debug menu",children:f.jsx(qe,{icon:"dots-horizontal"})})}),f.jsx(Ro,{side:"top",align:"end",alignOffset:0,children:f.jsx(Mr,{type:"menu",sourceId:"debug-panel",children:e})})]})}const Wfe=E.memo(function(){const{DebugMenu:e}=Ys();return f.jsxs("div",{className:"tlui-debug-panel",children:[f.jsx(Xfe,{}),f.jsx(Zfe,{}),e&&f.jsx(e,{})]})});function Yfe(n=!0){const[e,r]=E.useState(0),i=Z();E.useEffect(()=>{if(!n)return;const s=()=>r(o=>o+1);return i.on("tick",s),()=>{i.off("tick",s)}},[i,n])}const Xfe=Qt(function(){Yfe();const e=Z(),r=e.getPath(),i=e.getHoveredShape(),s=e.getOnlySelectedShape(),o=r==="select.idle"||!r.includes("select.")?i:s,a=o&&r.includes("select.")?` / ${o.type||""}${"geo"in o.props?" / "+o.props.geo:""} / [${k.ToInt(e.getPointInShapeSpace(o,e.inputs.currentPagePoint))}]`:"",c=r.startsWith("select.")&&!r.includes(".idle")?` / [${k.ToInt(e.inputs.originPagePoint)}]  [${k.ToInt(e.inputs.currentPagePoint)}] = ${k.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return f.jsx("div",{className:"tlui-debug-panel__current-state",children:`${r}${a}${c}`})});function Zfe(){const n=Z(),e=ne("show_fps",()=>Dt.showFps.get(),[Dt]),r=E.useRef(null);return E.useEffect(()=>{if(!e)return;const i=250;let s=0,o=-1,a=performance.now(),c=0,l=0,u=!1;function d(){if(l++,c=performance.now()-a,c>i){const h=Math.round(l*(i/c)*(1e3/i));h>s&&(s=h);const p=s*.75;(h<p&&!u||h>=p&&u)&&(u=!u),r.current.innerHTML=`FPS ${h.toString()}`,r.current.className="tlui-debug-panel__fps"+(u?" tlui-debug-panel__fps__slow":""),c-=i,l=0,a=performance.now()}o=n.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(o)}},[e,n]),e?f.jsx("div",{ref:r}):null}const Qfe=E.memo(function(){const e=jn(),{MainMenu:r,QuickActions:i,ActionsMenu:s,PageMenu:o}=Ys();return!r&&!o&&e<6?null:f.jsx("div",{className:"tlui-menu-zone",children:f.jsxs("div",{className:"tlui-buttons__horizontal",children:[r&&f.jsx(r,{}),o&&f.jsx(o,{}),e<6?null:f.jsxs(f.Fragment,{children:[i&&f.jsx(i,{}),s&&f.jsx(s,{})]})]})})});function Jfe(){const n=Z(),e=Ie(),[r,i]=E.useState(!1),s=E.useRef(!1);return Rs("toggle showback to content",()=>{const o=s.current,a=n.getCurrentPageShapeIds();let c=!1;a.size&&(c=a.size===n.getCulledShapes().size),o!==c&&(i(c),s.current=c)},[n]),r?f.jsx(te,{...e["back-to-content"],onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),i(!1)}}):null}function epe(){const n=Z(),e=Ie();return ne("is pen mode",()=>n.getInstanceState().isPenMode,[n])?f.jsx(te,{...e["exit-pen-mode"]}):null}function tpe(){const n=Z(),e=Ie();return ne("is following user",()=>!!n.getInstanceState().followingUserId,[n])?f.jsx(te,{...e["stop-following"]}):null}function npe(){return f.jsxs(f.Fragment,{children:[f.jsx(epe,{}),f.jsx(Jfe,{}),f.jsx(tpe,{})]})}function rpe({children:n}){const e=n??f.jsx(npe,{});return f.jsx("div",{className:"tlui-helper-buttons",children:f.jsx(Mr,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function ipe(){const n=Ie(),e=Ff(),r=zf();return f.jsxs(f.Fragment,{children:[f.jsxs(Fe,{label:"shortcuts-dialog.tools",id:"tools",children:[f.jsx(te,{...n["toggle-tool-lock"]}),f.jsx(te,{...n["insert-media"]}),f.jsx(te,{...e.select}),f.jsx(te,{...e.draw}),f.jsx(te,{...e.eraser}),f.jsx(te,{...e.hand}),f.jsx(te,{...e.rectangle}),f.jsx(te,{...e.ellipse}),f.jsx(te,{...e.arrow}),f.jsx(te,{...e.line}),f.jsx(te,{...e.text}),f.jsx(te,{...e.frame}),f.jsx(te,{...e.note}),f.jsx(te,{...e.laser})]}),f.jsxs(Fe,{label:"shortcuts-dialog.preferences",id:"preferences",children:[f.jsx(te,{...n["toggle-dark-mode"]}),f.jsx(te,{...n["toggle-focus-mode"]}),f.jsx(te,{...n["toggle-grid"]})]}),f.jsxs(Fe,{label:"shortcuts-dialog.edit",id:"edit",children:[f.jsx(te,{...n.undo}),f.jsx(te,{...n.redo}),f.jsx(te,{...n.cut}),f.jsx(te,{...n.copy}),f.jsx(te,{...n.paste}),f.jsx(te,{...n["select-all"]}),f.jsx(te,{...n.delete}),f.jsx(te,{...n.duplicate})]}),f.jsxs(Fe,{label:"shortcuts-dialog.view",id:"view",children:[f.jsx(te,{...n["zoom-in"]}),f.jsx(te,{...n["zoom-out"]}),f.jsx(te,{...n["zoom-to-100"]}),f.jsx(te,{...n["zoom-to-fit"]}),f.jsx(te,{...n["zoom-to-selection"]})]}),f.jsxs(Fe,{label:"shortcuts-dialog.transform",id:"transform",children:[f.jsx(te,{...n["bring-to-front"]}),f.jsx(te,{...n["bring-forward"]}),f.jsx(te,{...n["send-backward"]}),f.jsx(te,{...n["send-to-back"]}),f.jsx(te,{...n.group}),f.jsx(te,{...n.ungroup}),f.jsx(te,{...n["flip-horizontal"]}),f.jsx(te,{...n["flip-vertical"]}),f.jsx(te,{...n["align-top"]}),f.jsx(te,{...n["align-center-vertical"]}),f.jsx(te,{...n["align-bottom"]}),f.jsx(te,{...n["align-left"]}),f.jsx(te,{...n["align-center-horizontal"]}),f.jsx(te,{...n["align-right"]})]}),r&&f.jsx(Fe,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:f.jsx(te,{...n["open-cursor-chat"]})})]})}const spe=E.memo(function({children:e}){const r=Ge(),i=jn(),s=e??f.jsx(ipe,{});return f.jsxs(f.Fragment,{children:[f.jsxs(Of,{className:"tlui-shortcuts-dialog__header",children:[f.jsx(Df,{children:r("shortcuts-dialog.title")}),f.jsx(Nf,{})]}),f.jsx(Tl,{className:Me("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":i<=Rt.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":i<=Rt.TABLET}),children:f.jsx(Mr,{type:"keyboard-shortcuts",sourceId:"kbd",children:s})}),f.jsx("div",{className:"tlui-dialog__scrim"})]})}),ope=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function ape(){const n=Z(),e=un(),r=ne("colorScheme",()=>n.user.getUserPreferences().colorScheme??n.user.getIsDarkMode()?"dark":"light",[n]);return f.jsx(On,{id:"help menu color-scheme",label:"menu.theme",children:f.jsx(Fe,{id:"languages",children:ope.map(({colorScheme:i,label:s})=>f.jsx(Qn,{id:`color-scheme-${i}`,label:s,checked:i===r,onSelect:()=>{n.user.updateUserPreferences({colorScheme:i}),e("color-scheme",{source:"menu",value:i})}},i))})})}function v8(){const n=Z(),e=un(),r=ne("locale",()=>n.user.getLocale(),[n]);return f.jsx(On,{id:"help menu language",label:"menu.language",children:f.jsx(Fe,{id:"languages",children:Pl.map(({locale:i,label:s})=>f.jsx(Qn,{id:`language-${i}`,title:i,label:s,checked:i===r,onSelect:()=>{n.user.updateUserPreferences({locale:i}),e("change-language",{source:"menu",locale:i})}},i))})})}function cpe(){return f.jsxs(f.Fragment,{children:[f.jsx(v8,{}),f.jsx(x8,{})]})}function x8(){const{KeyboardShortcutsDialog:n}=Ys(),{addDialog:e}=Bo();return n?f.jsx(te,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{e({component:n})}}):null}function lpe(){return f.jsxs(f.Fragment,{children:[f.jsx(dpe,{}),f.jsx(gpe,{}),f.jsx(upe,{}),f.jsx(mpe,{}),f.jsx(vpe,{}),f.jsx(ype,{})]})}function upe(){const n=Ie();return f.jsxs(On,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[f.jsxs(Fe,{id:"export-all-as-group",children:[f.jsx(te,{...n["export-all-as-svg"]}),f.jsx(te,{...n["export-all-as-png"]}),f.jsx(te,{...n["export-all-as-json"]})]}),f.jsx(Fe,{id:"export-all-as-bg",children:f.jsx(EC,{})})]})}function dpe(){const n=Z(),e=ne("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return f.jsxs(On,{id:"edit",label:"menu.edit",disabled:!e,children:[f.jsx(ppe,{}),f.jsx(d8,{}),f.jsx(h8,{}),f.jsx(hpe,{}),f.jsx(fpe,{}),f.jsx(Fe,{id:"select-all",children:f.jsx(f8,{})})]})}function hpe(){return f.jsxs(Fe,{id:"misc",children:[f.jsx(r8,{}),f.jsx(i8,{}),f.jsx(t8,{}),f.jsx(e8,{}),f.jsx(s8,{}),f.jsx(o8,{}),f.jsx(g8,{}),f.jsx(p8,{}),f.jsx(n8,{})]})}function fpe(){return f.jsxs(Fe,{id:"lock",children:[f.jsx(a8,{}),f.jsx(hfe,{})]})}function ppe(){const n=Ie(),e=z4(),r=F4();return f.jsxs(Fe,{id:"undo-redo",children:[f.jsx(te,{...n.undo,disabled:!e}),f.jsx(te,{...n.redo,disabled:!r})]})}function gpe(){const n=Ie();return f.jsx(On,{id:"view",label:"menu.view",children:f.jsxs(Fe,{id:"view-actions",children:[f.jsx(te,{...n["zoom-in"]}),f.jsx(te,{...n["zoom-out"]}),f.jsx(c8,{}),f.jsx(l8,{}),f.jsx(u8,{})]})})}function mpe(){const n=Ie();return f.jsxs(Fe,{id:"extras",children:[f.jsx(te,{...n["insert-embed"]}),f.jsx(te,{...n["insert-media"]})]})}function ype(){function n(e){window.open(e,"_blank")}return f.jsx(Fe,{id:"help",children:f.jsx(On,{id:"help",label:"menu.help",children:f.jsxs(Fe,{id:"help-actions",children:[f.jsx(x8,{}),f.jsx(te,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{n("https://tldraw.dev")}})]})})})}function vpe(){return f.jsx(Fe,{id:"preferences",children:f.jsxs(On,{id:"preferences",label:"menu.preferences",children:[f.jsxs(Fe,{id:"preferences-actions",children:[f.jsx(Cfe,{}),f.jsx(Pfe,{}),f.jsx(Ife,{}),f.jsx(Efe,{}),f.jsx(kfe,{}),f.jsx(Tfe,{}),f.jsx(Mfe,{}),f.jsx(jfe,{}),f.jsx(Rfe,{}),f.jsx(Afe,{})]}),f.jsx(Fe,{id:"color-scheme",children:f.jsx(ape,{})}),f.jsx(Fe,{id:"language",children:f.jsx(v8,{})})]})})}const xpe=E.memo(function({children:e}){const r=Jt(),[i,s]=fs("main menu"),o=Ge(),a=e??f.jsx(lpe,{});return f.jsxs(CC,{dir:"ltr",open:i,onOpenChange:s,modal:!1,children:[f.jsx(PC,{asChild:!0,dir:"ltr",children:f.jsx(Ae,{type:"icon","data-testid":"main-menu.button",title:o("menu.title"),children:f.jsx(qe,{icon:"menu",small:!0})})}),f.jsx(Gf,{container:r,children:f.jsx(IC,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:f.jsx(Mr,{type:"menu",sourceId:"main-menu",children:a})})})]})}),DS={};function _c(n){if(DS[n])return DS[n];const r=document.createElement("canvas").getContext("2d");r.fillStyle=n,r.fillRect(0,0,1,1);const[i,s,o,a]=r.getImageData(0,0,1,1).data,c=new Float32Array([i/255,s/255,o/255,a/255]);return DS[n]=c,c}const jd=10,b8=24*jd+12+48;function ra(n,{center:e,radius:r,numArcSegments:i=20,startAngle:s=0,endAngle:o=rt,offset:a=0}){const c=(o-s)/i;let l=a;for(let u=s;u<o;u+=c)n[l++]=e.x,n[l++]=e.y,n[l++]=e.x+Math.cos(u)*r,n[l++]=e.y+Math.sin(u)*r,n[l++]=e.x+Math.cos(u+c)*r,n[l++]=e.y+Math.sin(u+c)*r;return n}function ia(n,e,r,i,s,o){n[e++]=r,n[e++]=i,n[e++]=r,n[e++]=i+o,n[e++]=r+s,n[e++]=i,n[e++]=r+s,n[e++]=i,n[e++]=r,n[e++]=i+o,n[e++]=r+s,n[e++]=i+o}function bpe(n,e,r){const i=jd;r=Math.min(r,Math.min(e.w,e.h)/2);const s=pe.ExpandBy(e,-r);if(s.w<=0||s.h<=0)return ra(n,{center:e.center,radius:r,numArcSegments:jd*4}),jd*4*6;let o=0;return ia(n,o,s.minX,s.minY,s.w,s.h),o+=12,ia(n,o,s.minX,e.minY,s.w,r),o+=12,ia(n,o,s.maxX,s.minY,r,s.h),o+=12,ia(n,o,s.minX,s.maxY,s.w,r),o+=12,ia(n,o,e.minX,s.minY,r,s.h),o+=12,ra(n,{numArcSegments:i,offset:o,center:s.point,radius:r,startAngle:Je,endAngle:Je*1.5}),o+=i*6,ra(n,{numArcSegments:i,offset:o,center:k.Add(s.point,new k(s.w,0)),radius:r,startAngle:Je*1.5,endAngle:rt}),o+=i*6,ra(n,{numArcSegments:i,offset:o,center:k.Add(s.point,s.size),radius:r,startAngle:0,endAngle:pt}),o+=i*6,ra(n,{numArcSegments:i,offset:o,center:k.Add(s.point,new k(0,s.h)),radius:r,startAngle:pt,endAngle:Je}),b8}function Spe(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const r=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,i=e.createShader(e.VERTEX_SHADER);if(!i)throw new Error("Failed to create vertex shader");if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const s=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,o=e.createShader(e.FRAGMENT_SHADER);if(!o)throw new Error("Failed to create fragment shader");if(e.shaderSource(o,s),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const a=e.createProgram();if(!a)throw new Error("Failed to create program");if(e.attachShader(a,i),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(a);const c=e.getAttribLocation(a,"shapeVertexPosition");if(c<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(c);const l=e.getUniformLocation(a,"canvasPageBounds"),u=e.getUniformLocation(a,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:dd(e,1024),unselectedShapes:dd(e,4096),viewport:dd(e,b8),collaborators:dd(e,1024),prepareTriangles(p,g){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,g),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(u,p)},setCanvasPageBounds(p){e.uniform4fv(l,p)}}}function dd(n,e){const r=n.createBuffer();if(!r)throw new Error("Failed to create buffer");return{buffer:r,vertices:new Float32Array(e)}}function KO(n,e,r){let i=n.vertices.length;for(;i<e+r.length;)i*=2;if(i!=n.vertices.length){const s=new Float32Array(i);s.set(n.vertices),n.vertices=s}n.vertices.set(r,e)}var wpe=Object.defineProperty,_pe=Object.getOwnPropertyDescriptor,Ws=(n,e,r,i)=>{for(var s=_pe(e,r),o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,r,s)||s);return s&&wpe(e,r,s),s};class gs{constructor(e,r,i){this.editor=e,this.elem=r,this.container=i,this.gl=Spe(r),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",s=>{const o=e.getShapeMaskedPageBounds(s.id);if(!o)return null;const a=new Float32Array(12);return ia(a,0,o.x,o.y,o.w,o.h),a}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),$o("minimap render",this.render))}disposables=[];close=()=>this.disposables.forEach(e=>e());gl;shapeGeometryCache;_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:_c(e.getPropertyValue("--color-text-3").trim()),selectFill:_c(e.getPropertyValue("--color-selected").trim()),viewportFill:_c(e.getPropertyValue("--color-muted-1").trim()),background:_c(e.getPropertyValue("--color-low").trim())}}colors;updateColors(){this.colors=this._getColors()}id=kt();getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),r=this.editor.getCurrentPageBounds();return r?pe.Expand(r,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),r=this.editor.pageToScreen(e.point),i=this.editor.pageToScreen(new k(e.maxX,e.maxY));return new pe(r.x,r.y,i.x-r.x,i.y-r.y)}_getCanvasBoundingRect(){const{x:e,y:r,width:i,height:s}=this.elem.getBoundingClientRect();return new pe(e,r,i,s)}canvasBoundingClientRect=Vt("canvasBoundingClientRect",new pe);getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const r=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(r)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),r=this.getDpr();return new k(e.width*r,e.height*r)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}originPagePoint=new k;originPageCenter=new k;isInViewport=!1;getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),r=this.getContentPageBounds(),i=e.width/e.height;let s=r.width,o=s/i;o<r.height&&(o=r.height,s=o*i);const a=new pe(0,0,s,o);return a.center=r.center,a}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:r,w:i,h:s}=this.getCanvasPageBounds();return new Float32Array([e,r,i,s])}getMinimapPagePoint=(e,r)=>{const i=this.getCanvasPageBounds(),s=this.getCanvasScreenBounds();let o=e-s.x,a=r-s.y;return o*=i.width/s.width,a*=i.height/s.height,o+=i.minX,a+=i.minY,new k(o,a,1)};minimapScreenPointToPagePoint=(e,r,i=!1,s=!1)=>{const{editor:o}=this,a=o.getViewportPageBounds();let{x:c,y:l}=this.getMinimapPagePoint(e,r);if(s){const u=this.editor.getCurrentPageBounds()??new pe,d=u.minX-a.width/2,h=u.maxX+a.width/2,p=u.minY-a.height/2,g=u.maxY+a.height/2,y=Math.max(0,d+a.width-c),v=Math.max(0,-(h-a.width-c)),x=Math.max(0,p+a.height-l),m=Math.max(0,-(g-a.height-l));c+=(y-v)/2,l+=(x-m)/2,c=Ht(c,d,h),l=Ht(l,p,g)}if(i){const{originPagePoint:u}=this,d=Math.abs(c-u.x),h=Math.abs(l-u.y);d>h?l=u.y:c=u.x}return new k(c,l)};render=()=>{const e=this.gl.context,r=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=r.x,this.elem.height=r.y,e.viewport(0,0,r.x,r.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const i=new Set(this.editor.getSelectedShapeIds()),s=this.colors;let o=0,a=0;const c=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,u=c.length;l<u;l++){const d=c[l],h=this.shapeGeometryCache.get(d);if(!h)continue;const p=h.length;i.has(d)?(KO(this.gl.selectedShapes,o,h),o+=p):(KO(this.gl.unselectedShapes,a,h),a+=p)}this.drawShapes(this.gl.unselectedShapes,a,s.shapeFill),this.drawShapes(this.gl.selectedShapes,o,s.selectFill),this.drawViewport(),this.drawCollaborators()};drawShapes(e,r,i){this.gl.prepareTriangles(e,r),this.gl.setFillColor(i),this.gl.drawTriangles(r)}drawViewport(){const e=this.editor.getViewportPageBounds(),r=bpe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,r),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(r),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(r),this.gl.drawTrianglesTransparently(r),this.gl.drawTrianglesTransparently(r))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const r=20,i=r*6,s=i*e.length;this.gl.collaborators.vertices.length<s&&(this.gl.collaborators.vertices=new Float32Array(s));const o=this.gl.collaborators.vertices;let a=0;const c=this.getZoom();for(const{cursor:l}of e)ra(o,{center:k.From(l),radius:3*c,offset:a,numArcSegments:r}),a+=i;this.gl.prepareTriangles(this.gl.collaborators,s),a=0;for(const{color:l}of e)this.gl.setFillColor(_c(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,a/2,i/2),a+=i}}Ws([oe],gs.prototype,"getDpr");Ws([oe],gs.prototype,"getContentPageBounds");Ws([oe],gs.prototype,"getContentScreenBounds");Ws([oe],gs.prototype,"getCanvasSize");Ws([oe],gs.prototype,"getCanvasClientPosition");Ws([oe],gs.prototype,"getCanvasPageBounds");Ws([oe],gs.prototype,"getZoom");Ws([oe],gs.prototype,"getCanvasPageBoundsArray");function Cpe(){const n=Z(),e=Jt(),r=E.useRef(null),i=E.useRef(!1),s=E.useRef();E.useEffect(()=>{try{const d=new gs(n,r.current,e);return s.current=d,s.current.close}catch(d){n.annotateError(d,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw d})}},[n,e]);const o=E.useCallback(d=>{if(!n.getCurrentPageShapeIds().size||!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),p=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.originPagePoint.setTo(p),s.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(h,{animation:{duration:n.options.animationMediumMs}})},[n]),a=E.useCallback(d=>{if(!s.current)return;const h=d.currentTarget;if(iu(h,d),!n.getCurrentPageShapeIds().size)return;i.current=!0,s.current.isInViewport=!1;const p=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),g=n.getViewportPageBounds(),y=s.current.getContentPageBounds();if(new pe(y.x-g.width/2,y.y-g.height/2,y.width+g.width,y.height+g.height).containsPoint(p)&&!g.containsPoint(p)){s.current.isInViewport=g.containsPoint(p);const m=k.Sub(g.center,g.point),b=k.Add(p,m);s.current.originPagePoint.setTo(b),s.current.originPageCenter.setTo(p),n.centerOnPoint(p,{animation:{duration:n.options.animationMediumMs}})}else{const m=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.isInViewport=g.containsPoint(m),s.current.originPagePoint.setTo(m),s.current.originPageCenter.setTo(g.center)}function x(m){h&&su(h,m),i.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[n]),c=E.useCallback(d=>{if(!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(i.current){if(s.current.isInViewport){const v=s.current.originPagePoint.clone().sub(s.current.originPageCenter);n.centerOnPoint(k.Sub(h,v));return}n.centerOnPoint(h)}const p=s.current.getMinimapPagePoint(d.clientX,d.clientY),g=n.pageToScreen(p),y={type:"pointer",target:"canvas",name:"pointer_move",...Gn(d),point:g,isPen:n.getInstanceState().isPenMode};n.dispatch(y)},[n]),l=E.useCallback(d=>{const h=xz(d);n.dispatch({type:"wheel",name:"wheel",delta:h,point:new k(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey})},[n]),u=uu();return E.useEffect(()=>{n.timers.setTimeout(()=>{s.current?.updateColors(),s.current?.render()})},[u,n]),f.jsx("div",{className:"tlui-minimap",children:f.jsx("canvas",{role:"img","aria-label":"minimap",ref:r,className:"tlui-minimap__canvas",onDoubleClick:o,onPointerMove:c,onPointerDown:a,onWheel:l})})}function Ppe(n,e){const[r,i]=nt.useState(e);nt.useLayoutEffect(()=>{const o=m_(n);if(o)try{i(JSON.parse(o))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const s=nt.useCallback(o=>{i(a=>{const c=typeof o=="function"?o(a):o;return y_(n,JSON.stringify(c)),c})},[n]);return[r,s]}const Ipe=E.memo(function(){const e=Ie(),r=Ge(),i=jn(),[s,o]=Ppe("minimap",!0),a=E.useCallback(()=>{o(u=>!u)},[o]),{ZoomMenu:c,Minimap:l}=Ys();return i<Rt.MOBILE?null:f.jsxs("div",{className:"tlui-navigation-panel",children:[f.jsx("div",{className:"tlui-buttons__horizontal",children:c&&i<Rt.TABLET?f.jsx(c,{}):s?f.jsxs(f.Fragment,{children:[c&&f.jsx(c,{}),l&&f.jsx(Ae,{type:"icon","data-testid":"minimap.toggle-button",title:r("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:f.jsx(qe,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):f.jsxs(f.Fragment,{children:[f.jsx(Ae,{type:"icon","data-testid":"minimap.zoom-out",title:`${r(Ml(e["zoom-out"].label))} ${qw(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:f.jsx(qe,{icon:"minus"})}),c&&f.jsx(c,{}),f.jsx(Ae,{type:"icon","data-testid":"minimap.zoom-in",title:`${r(Ml(e["zoom-in"].label))} ${qw(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:f.jsx(qe,{icon:"plus"})}),l&&f.jsx(Ae,{type:"icon","data-testid":"minimap.toggle-button",title:r("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:f.jsx(qe,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),l&&i>=Rt.TABLET&&!s&&f.jsx(l,{})]})}),Epe=function({name:e,id:r,isCurrentPage:i}){const s=Z(),o=un(),a=E.useRef(null),c=E.useCallback(()=>{s.mark("rename page")},[s]),l=E.useCallback(u=>{s.renamePage(r,u||"New Page"),o("rename-page",{source:"page-menu"})},[s,r,o]);return f.jsx(Lf,{className:"tlui-page-menu__item__input",ref:u=>a.current=u,defaultValue:e,onValueChange:l,onFocus:c,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:i,autoSelect:!0})},Gw=(n,e,r,i,s)=>{let o;const a=n.getPages(),c=r>i?a[i-1]:a[i],l=r>i?a[i]:a[i+1];c&&!l?o=Hr(c.index):!c&&l?o=XQ(a[0].index):o=wl(c.index,l.index),o!==a[r].index&&(n.mark("moving page"),n.updatePage({id:e,index:o}),s("move-page",{source:"page-menu"}))},VO=Qt(function({index:e,listSize:r,item:i,onRename:s}){const o=Z(),a=Ge(),c=o.getPages(),l=un(),u=E.useCallback(()=>{o.mark("creating page");const g=ts.createId();o.duplicatePage(i.id,g),l("duplicate-page",{source:"page-menu"})},[o,i,l]),d=E.useCallback(()=>{Gw(o,i.id,e,e-1,l)},[o,i,e,l]),h=E.useCallback(()=>{Gw(o,i.id,e,e+1,l)},[o,i,e,l]),p=E.useCallback(()=>{o.mark("deleting page"),o.deletePage(i.id),l("delete-page",{source:"page-menu"})},[o,i,l]);return f.jsxs(Ao,{id:`page item submenu ${e}`,children:[f.jsx(jo,{children:f.jsx(Ae,{type:"icon",title:a("page-menu.submenu.title"),children:f.jsx(qe,{icon:"dots-vertical"})})}),f.jsx(Ro,{alignOffset:0,side:"right",sideOffset:-4,children:f.jsxs(Mr,{type:"menu",sourceId:"page-menu",children:[f.jsxs(Fe,{id:"modify",children:[s&&f.jsx(te,{id:"rename",label:"page-menu.submenu.rename",onSelect:s}),f.jsx(te,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:u,disabled:c.length>=o.options.maxPages}),e>0&&f.jsx(te,{id:"move-up",onSelect:d,label:"page-menu.submenu.move-up"}),e<r-1&&f.jsx(te,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),r>1&&f.jsx(Fe,{id:"delete",children:f.jsx(te,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),kpe=E.memo(function(){const e=Z(),r=un(),i=Ge(),s=jn(),o=E.useCallback(()=>m(!1),[]),[a,c]=fs("page-menu",o),l=36,u=E.useRef(null),d=ne("pages",()=>e.getPages(),[e]),h=ne("currentPage",()=>e.getCurrentPage(),[e]),p=ne("currentPageId",()=>e.getCurrentPageId(),[e]),g=hs(),y=ne("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),v=ne("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[x,m]=E.useState(!1),b=E.useCallback(()=>{g||m(O=>!O)},[g]),S=E.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,I]=E.useState(Object.fromEntries(d.map((O,j)=>[O.id,{y:j*l,offsetY:0,isSelected:!1}])));E.useLayoutEffect(()=>{I(Object.fromEntries(d.map((O,j)=>[O.id,{y:j*l,offsetY:0,isSelected:!1}])))},[l,d]),E.useEffect(()=>{a&&e.timers.requestAnimationFrame(()=>{const O=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(O){const j=u.current;if(!j)return;const D=O.offsetTop,N=j.scrollTop;D<N&&j.scrollTo({top:D});const F=D+l,z=j.scrollTop+j.offsetHeight;F>z&&j.scrollTo({top:F-j.offsetHeight})}})},[l,p,a,e]);const C=E.useCallback(O=>{const{clientY:j,currentTarget:D}=O,{dataset:{id:N,index:F}}=D;if(!N||!F)return;const z=S.current;iu(O.currentTarget,O),z.status="pointing",z.pointing={id:N,index:+F};const G=w[N].y;z.startY=j,z.startIndex=Math.max(0,Math.min(Math.round(G/l),d.length-1))},[l,d.length,w]),_=E.useCallback(O=>{const j=S.current;if(j.status==="pointing"){const{clientY:D}=O,N=D-j.startY;Math.abs(N)>5&&(j.status="dragging")}if(j.status==="dragging"){const{clientY:D}=O,N=D-j.startY,F=w[j.pointing.id],{startIndex:z,pointing:$}=j,G=F.y+N,X=Math.max(0,Math.min(Math.round(G/l),d.length-1)),ee={...w};if(ee[$.id]={y:F.y,offsetY:N,isSelected:!0},X!==j.dragIndex){j.dragIndex=X;for(let re=0;re<d.length;re++){const B=d[re];if(B.id===j.pointing.id)continue;let{y:U}=ee[B.id];X===z?U=re*l:X<z?X<=re&&re<z?U=(re+1)*l:U=re*l:X>z&&(X>=re&&re>z?U=(re-1)*l:U=re*l),U!==ee[B.id].y&&(ee[B.id]={y:U,offsetY:0,isSelected:!0})}}I(ee)}},[l,d,w]),P=E.useCallback(O=>{const j=S.current;if(j.status==="dragging"){const{id:D,index:N}=j.pointing;Gw(e,D,N,j.dragIndex,r)}su(O.currentTarget,O),j.status="idle"},[e,r]),M=E.useCallback(O=>{const j=S.current;O.key==="Escape"&&(j.status==="dragging"&&I(Object.fromEntries(d.map((D,N)=>[D.id,{y:N*l,offsetY:0,isSelected:!1}]))),j.status="idle")},[l,d]),T=E.useCallback(()=>{g||(e.run(()=>{e.mark("creating page");const O=ts.createId();e.createPage({name:i("page-menu.new-page-initial-name"),id:O}),e.setCurrentPage(O),m(!0)}),r("new-page",{source:"page-menu"}))},[e,i,g,r]),A=E.useCallback(O=>{e.setCurrentPage(O),r("change-page",{source:"page-menu"})},[e,r]),R=E.useCallback((O,j)=>{e.renamePage(O,j),r("rename-page",{source:"page-menu"})},[e,r]);return f.jsxs(dC,{id:"pages",onOpenChange:c,open:a,children:[f.jsx(hC,{"data-testid":"main.page-menu",children:f.jsxs(Ae,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[f.jsx("div",{className:"tlui-page-menu__name",children:h.name}),f.jsx(qe,{icon:"chevron-down",small:!0})]})}),f.jsx(fC,{side:"bottom",align:"start",sideOffset:6,children:f.jsxs("div",{className:"tlui-page-menu__wrapper",children:[f.jsxs("div",{className:"tlui-page-menu__header",children:[f.jsx("div",{className:"tlui-page-menu__header__title",children:i("page-menu.title")}),!g&&f.jsxs("div",{className:"tlui-buttons__horizontal",children:[f.jsx(Ae,{type:"icon","data-testid":"page-menu.edit",title:i(x?"page-menu.edit-done":"page-menu.edit-start"),onClick:b,children:f.jsx(qe,{icon:x?"check":"edit"})}),f.jsx(Ae,{type:"icon","data-testid":"page-menu.create",title:i(y?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:y,onClick:T,children:f.jsx(qe,{icon:"plus"})})]})]}),f.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*d.length+4},ref:u,children:d.map((O,j)=>{const D=w[O.id]??{offsetY:0};return x?f.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:O.id===h.id?888:j,transform:`translate(0px, ${D.y+D.offsetY}px)`},children:[f.jsx(Ae,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:C,onPointerUp:P,onPointerMove:_,onKeyDown:M,"data-id":O.id,"data-index":j,children:f.jsx(qe,{icon:"drag-handle-dots"})}),s<Rt.TABLET_SM&&v?f.jsxs(Ae,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const N=window.prompt("Rename page",O.name);N&&N!==O.name&&R(O.id,N)},onDoubleClick:b,children:[f.jsx(Hw,{checked:O.id===h.id}),f.jsx(Lt,{children:O.name})]}):f.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:f.jsx(Epe,{id:O.id,name:O.name,isCurrentPage:O.id===h.id})}),!g&&f.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":x,children:f.jsx(VO,{index:j,item:O,listSize:d.length})})]},O.id+"_editing"):f.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[f.jsxs(Ae,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>A(O.id),onDoubleClick:b,title:i("page-menu.go-to-page"),children:[f.jsx(Hw,{checked:O.id===h.id}),f.jsx(Lt,{children:O.name})]}),!g&&f.jsx("div",{className:"tlui-page_menu__item__submenu",children:f.jsx(VO,{index:j,item:O,listSize:d.length,onRename:()=>{if(e.environment.isIos){const N=window.prompt("Rename page",O.name);N&&N!==O.name&&R(O.id,N)}else m(!0),p!==O.id&&A(O.id)}})})]},O.id)})})]})})]})});function Tpe(){const n=Ie(),e=Z(),r=z4(),i=F4(),s=Rn(1),o=hs(),a=ne("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]),c=ps(),l=s&&c;if(!(o&&!a))return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n.undo,disabled:!r}),f.jsx(te,{...n.redo,disabled:!i}),f.jsx(te,{...n.delete,disabled:!l}),f.jsx(te,{...n.duplicate,disabled:!l})]})}const Mpe=E.memo(function({children:e}){const r=e??f.jsx(Tpe,{});return f.jsx(Mr,{type:"small-icons",sourceId:"quick-actions",children:r})});function Ape({userId:n}){const e=Sf(n);return e?f.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const jpe=Qt(function({userId:e}){const r=Z(),i=Ge(),s=un(),o=Sf(e),a=E.useCallback(()=>{r.getInstanceState().followingUserId===e?(r.stopFollowingUser(),s("stop-following",{source:"people-menu"})):(r.startFollowingUser(e),s("start-following",{source:"people-menu"}))},[r,e,s]),c=o?.followingUserId===r.user.getId(),l=r.getInstanceState().followingUserId===e;return o?f.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[f.jsxs(Ae,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>r.zoomToUser(e),onDoubleClick:a,children:[f.jsx(Ci,{icon:"color",color:o.color}),f.jsx("div",{className:"tlui-people-menu__name",children:o.userName??"New User"})]}),f.jsx(Ae,{type:"icon",className:"tlui-people-menu__item__follow",title:i(c?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:a,disabled:c,"data-active":l||c,children:f.jsx(qe,{icon:c?"leading":l?"following":"follow"})})]}):null});function Rpe({count:n}){return f.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const Ope=Qt(function(){const e=Z(),r=Jt(),i=Ge(),s=un(),o=E.useRef(!1),[a,c]=E.useState(!1),l=E.useCallback(v=>{c(v)},[]),u=e.user.getColor(),d=E.useCallback(v=>{e.user.updateUserPreferences({color:v}),s("set-color",{source:"people-menu"})},[e,s]),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:g,handleButtonPointerUp:y}=nt.useMemo(()=>{const v=()=>{o.current=!1,window.removeEventListener("pointerup",v)};return{handleButtonClick:w=>{const{id:I}=w.currentTarget.dataset;I&&u!==I&&d(I)},handleButtonPointerDown:w=>{const{id:I}=w.currentTarget.dataset;I&&(d(I),o.current=!0,window.addEventListener("pointerup",v))},handleButtonPointerEnter:w=>{if(!o.current)return;const{id:I}=w.currentTarget.dataset;I&&d(I)},handleButtonPointerUp:w=>{const{id:I}=w.currentTarget.dataset;I&&d(I)}}},[u,d]);return f.jsxs(aC,{onOpenChange:l,open:a,children:[f.jsx(cC,{dir:"ltr",asChild:!0,children:f.jsx(Ae,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:i("people-menu.change-color"),children:f.jsx(qe,{icon:"color"})})}),f.jsx(lC,{container:r,children:f.jsx(uC,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:f.jsx("div",{className:"tlui-buttons__grid",children:_w.map(v=>f.jsx(Ae,{type:"icon","data-id":v,"data-testid":v,"aria-label":v,"data-state":u===v?"hinted":void 0,title:v,className:"tlui-button-grid__button",style:{color:v},onPointerEnter:g,onPointerDown:p,onPointerUp:y,onClick:h,children:f.jsx(qe,{icon:"color"})},v))})})})]})});function Dpe(){const n=Z(),e=un(),r=ne("userName",()=>n.user.getName(),[]),i=Ge(),s=E.useRef(r),o=E.useRef(r),[a,c]=E.useState(!1),l=E.useCallback(()=>{c(h=>!h)},[]),u=E.useCallback(h=>{o.current=h,n.user.updateUserPreferences({name:h})},[n]),d=E.useCallback(()=>{s.current!==o.current&&(e("change-user-name",{source:"people-menu"}),s.current=o.current)},[e]);return f.jsxs("div",{className:"tlui-people-menu__user",children:[f.jsx(Ope,{}),a?f.jsx(Lf,{className:"tlui-people-menu__user__input",defaultValue:r,onValueChange:u,onComplete:l,onCancel:l,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{a||c(!0)},children:r}),r==="New User"?f.jsx("div",{className:"tlui-people-menu__user__label",children:i("people-menu.user")}):null]}),f.jsx(Ae,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:i("people-menu.change-name"),onClick:l,children:f.jsx(qe,{icon:a?"check":"edit"})})]})}const Npe=Qt(function({children:e}){const r=Ge(),i=Jt(),s=Z(),o=Cz(),a=ne("user",()=>s.user.getColor(),[s]),c=ne("user",()=>s.user.getName(),[s]),[l,u]=fs("people menu");return f.jsxs(aC,{onOpenChange:u,open:l,children:[f.jsx(cC,{dir:"ltr",asChild:!0,children:f.jsxs("button",{className:"tlui-people-menu__avatars-button",title:r("people-menu.title"),children:[o.length>5&&f.jsx(Rpe,{count:o.length-5}),f.jsxs("div",{className:"tlui-people-menu__avatars",children:[o.slice(-5).map(d=>f.jsx(Ape,{userId:d},d)),f.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:a},children:c==="New User"?"":c[0]??""})]})]})}),f.jsx(lC,{container:i,children:f.jsx(uC,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:f.jsxs("div",{className:"tlui-people-menu__wrapper",children:[f.jsx("div",{className:"tlui-people-menu__section",children:f.jsx(Dpe,{})}),o.length>0&&f.jsx("div",{className:"tlui-people-menu__section",children:o.map(d=>f.jsx(jpe,{userId:d},d+"_presence"))}),e]})})})]})});function Lpe(){return f.jsx("div",{className:"tlui-share-zone",draggable:!1,children:f.jsx(Npe,{})})}const Fpe=Object.freeze([ur,Io,Eo,wi]);function S8(n=Fpe){const e=Z();return ne("getRelevantStyles",()=>{const r=new Pw(e.getSharedStyles()),i=!!e.root.getCurrent()?.shapeType,s=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(r.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of n)r.applyValue(o,e.getStyleForNextShape(o));return i||s||r.size>0?r:null},[e])}const kr={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},ho=E.memo(function(e){const{uiType:r,items:i,title:s,style:o,value:a,onValueChange:c,theme:l}=e,u=Z(),d=Ge(),h=E.useRef(!1),p=E.useRef(null),{handleButtonClick:g,handleButtonPointerDown:y,handleButtonPointerEnter:v,handleButtonPointerUp:x}=E.useMemo(()=>{const m=()=>{h.current=!1,window.removeEventListener("pointerup",m);const C=p.current;C&&["TEXTAREA","INPUT"].includes(C.nodeName)&&C.focus(),p.current=null};return{handleButtonClick:C=>{const{id:_}=C.currentTarget.dataset;a.type==="shared"&&a.value===_||(u.mark("point picker item"),c(o,_))},handleButtonPointerDown:C=>{const{id:_}=C.currentTarget.dataset;u.mark("point picker item"),c(o,_),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",m)},handleButtonPointerEnter:C=>{if(!h.current)return;const{id:_}=C.currentTarget.dataset;c(o,_)},handleButtonPointerUp:C=>{const{id:_}=C.currentTarget.dataset;a.type==="shared"&&a.value===_||c(o,_)}}},[a,u,c,o]);return f.jsx("div",{"data-testid":`style.${r}`,className:Me("tlui-buttons__grid"),children:i.map(m=>f.jsx(Ae,{type:"icon","data-id":m.value,"data-testid":`style.${r}.${m.value}`,"aria-label":m.value,"data-state":a.type==="shared"&&a.value===m.value?"hinted":void 0,title:s+"  "+d(`${r}-style.${m.value}`),className:Me("tlui-button-grid__button"),style:o===ur?{color:l[m.value].solid}:void 0,onPointerEnter:v,onPointerDown:y,onPointerUp:x,onClick:g,children:f.jsx(qe,{icon:m.icon})},m.value))})});function ma(n,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(n?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}var zpe=Th[" useInsertionEffect ".trim().toString()]||Mh;function $pe({prop:n,defaultProp:e,onChange:r=()=>{},caller:i}){const[s,o,a]=Bpe({defaultProp:e,onChange:r}),c=n!==void 0,l=c?n:s;{const d=E.useRef(n!==void 0);E.useEffect(()=>{const h=d.current;h!==c&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=c},[c,i])}const u=E.useCallback(d=>{if(c){const h=Upe(d)?d(n):d;h!==n&&a.current?.(h)}else o(d)},[c,n,o,a]);return[l,u]}function Bpe({defaultProp:n,onChange:e}){const[r,i]=E.useState(n),s=E.useRef(r),o=E.useRef(e);return zpe(()=>{o.current=e},[e]),E.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,i,o]}function Upe(n){return typeof n=="function"}var w8=["PageUp","PageDown"],_8=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C8={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Za="Slider",[Kw,qpe,Hpe]=uN(Za),[P8]=Fl(Za,[Hpe]),[Gpe,Kf]=P8(Za),I8=E.forwardRef((n,e)=>{const{name:r,min:i=0,max:s=100,step:o=1,orientation:a="horizontal",disabled:c=!1,minStepsBetweenThumbs:l=0,defaultValue:u=[i],value:d,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:g=!1,form:y,...v}=n,x=E.useRef(new Set),m=E.useRef(0),S=a==="horizontal"?Kpe:Vpe,[w=[],I]=$pe({prop:d,defaultProp:u,onChange:A=>{[...x.current][m.current]?.focus(),h(A)}}),C=E.useRef(w);function _(A){const R=Qpe(w,A);T(A,R)}function P(A){T(A,m.current)}function M(){const A=C.current[m.current];w[m.current]!==A&&p(w)}function T(A,R,{commit:O}={commit:!1}){const j=nge(o),D=rge(Math.round((A-i)/o)*o+i,j),N=sN(D,[i,s]);I((F=[])=>{const z=Xpe(F,N,R);if(tge(z,l*o)){m.current=z.indexOf(N);const $=String(z)!==String(F);return $&&O&&p(z),$?z:F}else return F})}return f.jsx(Gpe,{scope:n.__scopeSlider,name:r,disabled:c,min:i,max:s,valueIndexToChangeRef:m,thumbs:x.current,values:w,orientation:a,form:y,children:f.jsx(Kw.Provider,{scope:n.__scopeSlider,children:f.jsx(Kw.Slot,{scope:n.__scopeSlider,children:f.jsx(S,{"aria-disabled":c,"data-disabled":c?"":void 0,...v,ref:e,onPointerDown:ma(v.onPointerDown,()=>{c||(C.current=w)}),min:i,max:s,inverted:g,onSlideStart:c?void 0:_,onSlideMove:c?void 0:P,onSlideEnd:c?void 0:M,onHomeKeyDown:()=>!c&&T(i,0,{commit:!0}),onEndKeyDown:()=>!c&&T(s,w.length-1,{commit:!0}),onStepKeyDown:({event:A,direction:R})=>{if(!c){const D=w8.includes(A.key)||A.shiftKey&&_8.includes(A.key)?10:1,N=m.current,F=w[N],z=o*D*R;T(F+z,N,{commit:!0})}}})})})})});I8.displayName=Za;var[E8,k8]=P8(Za,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Kpe=E.forwardRef((n,e)=>{const{min:r,max:i,dir:s,inverted:o,onSlideStart:a,onSlideMove:c,onSlideEnd:l,onStepKeyDown:u,...d}=n,[h,p]=E.useState(null),g=dr(e,S=>p(S)),y=E.useRef(void 0),v=iN(s),x=v==="ltr",m=x&&!o||!x&&o;function b(S){const w=y.current||h.getBoundingClientRect(),I=[0,w.width],_=kC(I,m?[r,i]:[i,r]);return y.current=w,_(S-w.left)}return f.jsx(E8,{scope:n.__scopeSlider,startEdge:m?"left":"right",endEdge:m?"right":"left",direction:m?1:-1,size:"width",children:f.jsx(T8,{dir:v,"data-orientation":"horizontal",...d,ref:g,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:S=>{const w=b(S.clientX);a?.(w)},onSlideMove:S=>{const w=b(S.clientX);c?.(w)},onSlideEnd:()=>{y.current=void 0,l?.()},onStepKeyDown:S=>{const I=C8[m?"from-left":"from-right"].includes(S.key);u?.({event:S,direction:I?-1:1})}})})}),Vpe=E.forwardRef((n,e)=>{const{min:r,max:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...u}=n,d=E.useRef(null),h=dr(e,d),p=E.useRef(void 0),g=!s;function y(v){const x=p.current||d.current.getBoundingClientRect(),m=[0,x.height],S=kC(m,g?[i,r]:[r,i]);return p.current=x,S(v-x.top)}return f.jsx(E8,{scope:n.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:f.jsx(T8,{"data-orientation":"vertical",...u,ref:h,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const x=y(v.clientY);o?.(x)},onSlideMove:v=>{const x=y(v.clientY);a?.(x)},onSlideEnd:()=>{p.current=void 0,c?.()},onStepKeyDown:v=>{const m=C8[g?"from-bottom":"from-top"].includes(v.key);l?.({event:v,direction:m?-1:1})}})})}),T8=E.forwardRef((n,e)=>{const{__scopeSlider:r,onSlideStart:i,onSlideMove:s,onSlideEnd:o,onHomeKeyDown:a,onEndKeyDown:c,onStepKeyDown:l,...u}=n,d=Kf(Za,r);return f.jsx(Xn.span,{...u,ref:e,onKeyDown:ma(n.onKeyDown,h=>{h.key==="Home"?(a(h),h.preventDefault()):h.key==="End"?(c(h),h.preventDefault()):w8.concat(_8).includes(h.key)&&(l(h),h.preventDefault())}),onPointerDown:ma(n.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(p)?p.focus():i(h)}),onPointerMove:ma(n.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&s(h)}),onPointerUp:ma(n.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),o(h))})})}),M8="SliderTrack",A8=E.forwardRef((n,e)=>{const{__scopeSlider:r,...i}=n,s=Kf(M8,r);return f.jsx(Xn.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...i,ref:e})});A8.displayName=M8;var Vw="SliderRange",j8=E.forwardRef((n,e)=>{const{__scopeSlider:r,...i}=n,s=Kf(Vw,r),o=k8(Vw,r),a=E.useRef(null),c=dr(e,a),l=s.values.length,u=s.values.map(p=>D8(p,s.min,s.max)),d=l>1?Math.min(...u):0,h=100-Math.max(...u);return f.jsx(Xn.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...i,ref:c,style:{...n.style,[o.startEdge]:d+"%",[o.endEdge]:h+"%"}})});j8.displayName=Vw;var Ww="SliderThumb",R8=E.forwardRef((n,e)=>{const r=qpe(n.__scopeSlider),[i,s]=E.useState(null),o=dr(e,c=>s(c)),a=E.useMemo(()=>i?r().findIndex(c=>c.ref.current===i):-1,[r,i]);return f.jsx(Wpe,{...n,ref:o,index:a})}),Wpe=E.forwardRef((n,e)=>{const{__scopeSlider:r,index:i,name:s,...o}=n,a=Kf(Ww,r),c=k8(Ww,r),[l,u]=E.useState(null),d=dr(e,b=>u(b)),h=l?a.form||!!l.closest("form"):!0,p=JB(l),g=a.values[i],y=g===void 0?0:D8(g,a.min,a.max),v=Zpe(i,a.values.length),x=p?.[c.size],m=x?Jpe(x,y,c.direction):0;return E.useEffect(()=>{if(l)return a.thumbs.add(l),()=>{a.thumbs.delete(l)}},[l,a.thumbs]),f.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${y}% + ${m}px)`},children:[f.jsx(Kw.ItemSlot,{scope:n.__scopeSlider,children:f.jsx(Xn.span,{role:"slider","aria-label":n["aria-label"]||v,"aria-valuemin":a.min,"aria-valuenow":g,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...o,ref:d,style:g===void 0?{display:"none"}:n.style,onFocus:ma(n.onFocus,()=>{a.valueIndexToChangeRef.current=i})})}),h&&f.jsx(O8,{name:s??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:g},i)]})});R8.displayName=Ww;var Ype="RadioBubbleInput",O8=E.forwardRef(({__scopeSlider:n,value:e,...r},i)=>{const s=E.useRef(null),o=dr(s,i),a=yU(e);return E.useEffect(()=>{const c=s.current;if(!c)return;const l=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==e&&d){const h=new Event("input",{bubbles:!0});d.call(c,e),c.dispatchEvent(h)}},[a,e]),f.jsx(Xn.input,{style:{display:"none"},...r,ref:o,defaultValue:e})});O8.displayName=Ype;function Xpe(n=[],e,r){const i=[...n];return i[r]=e,i.sort((s,o)=>s-o)}function D8(n,e,r){const o=100/(r-e)*(n-e);return sN(o,[0,100])}function Zpe(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Qpe(n,e){if(n.length===1)return 0;const r=n.map(s=>Math.abs(s-e)),i=Math.min(...r);return r.indexOf(i)}function Jpe(n,e,r){const i=n/2,o=kC([0,50],[0,i]);return(i-o(e)*r)*r}function ege(n){return n.slice(0,-1).map((e,r)=>n[r+1]-e)}function tge(n,e){if(e>0){const r=ege(n);return Math.min(...r)>=e}return!0}function kC(n,e){return r=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const i=(e[1]-e[0])/(n[1]-n[0]);return e[0]+i*(r-n[0])}}function nge(n){return(String(n).split(".")[1]||"").length}function rge(n,e){const r=Math.pow(10,e);return Math.round(n*r)/r}var ige=I8,sge=A8,oge=j8,age=R8;const cge=E.memo(function(e){const{title:r,steps:i,value:s,label:o,onValueChange:a}=e,c=Z(),l=Ge(),u=E.useCallback(p=>{a(p[0])},[a]),d=E.useCallback(()=>{c.mark("click slider")},[c]),h=E.useCallback(()=>{s&&a(s)},[s,a]);return f.jsx("div",{className:"tlui-slider__container",children:f.jsxs(ige,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:i,step:1,value:s?[s]:void 0,onPointerDown:d,onValueChange:u,onPointerUp:h,title:r+"  "+l(o),children:[f.jsx(sge,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&f.jsx(oge,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&f.jsx(age,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function lge({label:n,uiTypeA:e,uiTypeB:r,labelA:i,labelB:s,itemsA:o,itemsB:a,styleA:c,styleB:l,valueA:u,valueB:d,onValueChange:h}){const p=Ge(),g=E.useMemo(()=>o.find(v=>u.type==="shared"&&u.value===v.value)?.icon??"mixed",[o,u]),y=E.useMemo(()=>a.find(v=>d.type==="shared"&&d.value===v.value)?.icon??"mixed",[a,d]);return u===void 0&&d===void 0?null:f.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[f.jsx("div",{title:p(n),className:"tlui-style-panel__double-select-picker-label",children:p(n)}),f.jsxs("div",{className:"tlui-buttons__horizontal",children:[f.jsxs(Ao,{id:`style panel ${e} A`,children:[f.jsx(jo,{children:f.jsx(Ae,{type:"icon","data-testid":`style.${e}`,title:p(i)+"  "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${u.value}`)),children:f.jsx(qe,{icon:g,small:!0,invertIcon:!0})})}),f.jsx(Ro,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:o.map((v,x)=>f.jsx(Rl,{"data-testid":`style.${e}.${v.value}`,children:f.jsx(Ae,{type:"icon",onClick:()=>h(c,v.value),title:`${p(i)}  ${p(`${e}-style.${v.value}`)}`,children:f.jsx(qe,{icon:v.icon,invertIcon:!0})},v.value)},x))})})]}),f.jsxs(Ao,{id:`style panel ${r}`,children:[f.jsx(jo,{children:f.jsx(Ae,{type:"icon","data-testid":`style.${r}`,title:p(s)+"  "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${r}-style.${d.value}`)),children:f.jsx(qe,{icon:y,small:!0})})}),f.jsx(Ro,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:a.map(v=>f.jsx(Rl,{children:f.jsx(Ae,{type:"icon",title:`${p(s)}  ${p(`${r}-style.${v.value}`)}`,"data-testid":`style.${r}.${v.value}`,onClick:()=>h(l,v.value),children:f.jsx(qe,{icon:v.icon})})},v.value))})})]})]})]})}const uge=E.memo(lge);function dge({id:n,label:e,uiType:r,style:i,items:s,type:o,value:a,onValueChange:c}){const l=Ge(),u=Z(),d=E.useMemo(()=>s.find(g=>a.type==="shared"&&g.value===a.value)?.icon,[s,a]),h=a.type==="mixed"?l("style-panel.mixed"):l(`${r}-style.${a.value}`),p=e?l(e):"";return f.jsxs(Ao,{id:`style panel ${n}`,children:[f.jsx(jo,{children:f.jsxs(Ae,{type:o,"data-testid":`style.${r}`,title:h,children:[f.jsx(Lt,{children:p}),f.jsx(qe,{icon:d??"mixed"})]})}),f.jsx(Ro,{side:"left",align:"center",alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:s.map(g=>f.jsx(Rl,{children:f.jsx(Ae,{type:"icon","data-testid":`style.${r}.${g.value}`,title:l(`${r}-style.${g.value}`),onClick:()=>{u.mark("select style dropdown item"),c(i,g.value)},children:f.jsx(qe,{icon:g.icon})})},g.value))})})]})}const TC=E.memo(dge);function hge({styles:n}){const e=uu();if(!n)return null;const r=n.get(Wr),i=n.get(th),s=n.get(eh),o=n.get(sh),a=n.get(Si),c=r===void 0,l=i===void 0&&s===void 0,u=o===void 0,d=a===void 0,h=ds({isDarkMode:e});return f.jsxs(f.Fragment,{children:[f.jsx(fge,{theme:h,styles:n}),!d&&f.jsx(pge,{theme:h,styles:n}),!(c&&l&&u)&&f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[f.jsx(gge,{styles:n}),f.jsx(yge,{styles:n}),f.jsx(mge,{styles:n})]})]})}function gu(){const n=Z(),e=un();return nt.useMemo(()=>(function(i,s){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(i,s),n.setStyleForNextShapes(i,s),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:i.id,value:s})}),[n,e])}function fge({styles:n,theme:e}){const r=Ge(),i=Z(),s=gu(),o=n.get(ur),a=n.get(Eo),c=n.get(Io),l=n.get(wi),u=a!==void 0||c!==void 0||l!==void 0;return f.jsxs(f.Fragment,{children:[f.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[o===void 0?null:f.jsx(ho,{title:r("style-panel.color"),uiType:"color",style:ur,items:kr.color,value:o,onValueChange:s,theme:e}),f.jsx(vge,{})]}),u&&f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:f.jsx(ho,{title:r("style-panel.fill"),uiType:"fill",style:Eo,items:kr.fill,value:a,onValueChange:s,theme:e}),c===void 0?null:f.jsx(ho,{title:r("style-panel.dash"),uiType:"dash",style:Io,items:kr.dash,value:c,onValueChange:s,theme:e}),l===void 0?null:f.jsx(ho,{title:r("style-panel.size"),uiType:"size",style:wi,items:kr.size,value:l,onValueChange:(d,h)=>{s(d,h);const p=i.getSelectedShapeIds();p.length>0&&dt(i,p)},theme:e})]})]})}function pge({theme:n,styles:e}){const r=Ge(),i=gu(),s=e.get(Si),o=e.get(vw),a=e.get(rh),c=e.get(ih);return s===void 0&&a===void 0?null:f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[s===void 0?null:f.jsx(ho,{title:r("style-panel.font"),uiType:"font",style:Si,items:kr.font,value:s,onValueChange:i,theme:n}),o===void 0?null:f.jsxs("div",{className:"tlui-style-panel__row",children:[f.jsx(ho,{title:r("style-panel.align"),uiType:"align",style:vw,items:kr.textAlign,value:o,onValueChange:i,theme:n}),f.jsx("div",{className:"tlui-style-panel__row__extra-button",children:f.jsx(Ae,{type:"icon",title:r("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:f.jsx(qe,{icon:"vertical-align-middle"})})})]}),a===void 0?null:f.jsxs("div",{className:"tlui-style-panel__row",children:[f.jsx(ho,{title:r("style-panel.align"),uiType:"align",style:rh,items:kr.horizontalAlign,value:a,onValueChange:i,theme:n}),f.jsx("div",{className:"tlui-style-panel__row__extra-button",children:c===void 0?f.jsx(Ae,{type:"icon",title:r("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:f.jsx(qe,{icon:"vertical-align-middle"})}):f.jsx(TC,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:ih,items:kr.verticalAlign,value:c,onValueChange:i})})]})]})}function gge({styles:n}){const e=gu(),r=n.get(Wr);return r===void 0?null:f.jsx(TC,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Wr,items:kr.geo,value:r,onValueChange:e})}function mge({styles:n}){const e=gu(),r=n.get(sh);return r===void 0?null:f.jsx(TC,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:sh,items:kr.spline,value:r,onValueChange:e})}function yge({styles:n}){const e=gu(),r=n.get(th),i=n.get(eh);return!r||!i?null:f.jsx(uge,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:eh,itemsA:kr.arrowheadStart,valueA:i,uiTypeB:"arrowheadEnd",styleB:th,itemsB:kr.arrowheadEnd,valueB:r,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Cc=[.1,.25,.5,.75,1];function vge(){const n=Z(),e=ne("opacity",()=>n.getSharedOpacity(),[n]),r=un(),i=Ge(),s=nt.useCallback(a=>{const c=Cc[a];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(c),n.setOpacityForNextShapes(c),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[n,r]);if(e===void 0)return null;const o=e.type==="mixed"?-1:Cc.indexOf(LQ(Cc,a=>Math.abs(a-e.value)));return f.jsx(cge,{"data-testid":"style.opacity",value:o>=0?o:Cc.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:s,steps:Cc.length-1,title:i("style-panel.opacity")})}const xge=E.memo(function({isMobile:e,children:r}){const i=Z(),s=S8(),o=E.useCallback(()=>{e||i.updateInstanceState({isChangingStyle:!1})},[i,e]),a=r??f.jsx(hge,{styles:s});return f.jsx("div",{className:Me("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:o,children:a})});function bge(){const n=Z(),e=Ge(),i=S8()?.get(ur),s=ds({isDarkMode:n.user.getIsDarkMode()}),o=(i?.type==="shared"?s[i.value]:s.black).solid,a=ne("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),c=E.useCallback(u=>{u||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:l}=Ys();return l?f.jsxs(dC,{id:"mobile style menu",onOpenChange:c,children:[f.jsx(hC,{children:f.jsx(Ae,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":o},title:e("style-panel.title"),disabled:a,children:f.jsx(qe,{icon:a?"blob":i?.type==="mixed"?"mixed":"blob"})})}),f.jsx(fC,{side:"top",align:"end",children:l&&f.jsx(l,{isMobile:!0})})]}):null}function Sge(){return f.jsxs(f.Fragment,{children:[f.jsx(_ge,{}),f.jsx(Cge,{}),f.jsx(Pge,{}),f.jsx(Ige,{}),f.jsx(Ege,{}),f.jsx(kge,{}),f.jsx(Tge,{}),f.jsx(Mge,{}),f.jsx(Age,{}),f.jsx(jge,{}),f.jsx(Oge,{}),f.jsx(Rge,{}),f.jsx(Lge,{}),f.jsx($ge,{}),f.jsx(Dge,{}),f.jsx(zge,{}),f.jsx(Fge,{}),f.jsx(Nge,{}),f.jsx(Bge,{}),f.jsx(Uge,{}),f.jsx(qge,{}),f.jsx(Hge,{}),f.jsx(Gge,{}),f.jsx(Kge,{}),f.jsx(Vge,{}),f.jsx(Wge,{}),f.jsx(Xge,{}),f.jsx(Yge,{})]})}function wge(n){const e=Z(),r=n.meta?.geo;return ne("is tool selected",()=>{const i=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(Wr);return r?i==="geo"&&s===r:i===n.id},[e,n.id,r])}function ct({tool:n}){const e=Ff(),r=wge(e[n]);return f.jsx(te,{...e[n],isSelected:r})}function _ge(){return f.jsx(ct,{tool:"select"})}function Cge(){return f.jsx(ct,{tool:"hand"})}function Pge(){return f.jsx(ct,{tool:"draw"})}function Ige(){return f.jsx(ct,{tool:"eraser"})}function Ege(){return f.jsx(ct,{tool:"arrow"})}function kge(){return f.jsx(ct,{tool:"text"})}function Tge(){return f.jsx(ct,{tool:"note"})}function Mge(){const n=Ff();return f.jsx(te,{...n.asset})}function Age(){return f.jsx(ct,{tool:"rectangle"})}function jge(){return f.jsx(ct,{tool:"ellipse"})}function Rge(){return f.jsx(ct,{tool:"diamond"})}function Oge(){return f.jsx(ct,{tool:"triangle"})}function Dge(){return f.jsx(ct,{tool:"rhombus"})}function Nge(){return f.jsx(ct,{tool:"heart"})}function Lge(){return f.jsx(ct,{tool:"hexagon"})}function Fge(){return f.jsx(ct,{tool:"cloud"})}function zge(){return f.jsx(ct,{tool:"star"})}function $ge(){return f.jsx(ct,{tool:"oval"})}function Bge(){return f.jsx(ct,{tool:"x-box"})}function Uge(){return f.jsx(ct,{tool:"check-box"})}function qge(){return f.jsx(ct,{tool:"arrow-left"})}function Hge(){return f.jsx(ct,{tool:"arrow-up"})}function Gge(){return f.jsx(ct,{tool:"arrow-down"})}function Kge(){return f.jsx(ct,{tool:"arrow-right"})}function Vge(){return f.jsx(ct,{tool:"line"})}function Wge(){return f.jsx(ct,{tool:"highlight"})}function Yge(){return f.jsx(ct,{tool:"frame"})}function Xge(){return f.jsx(ct,{tool:"laser"})}const NS=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function LS(n,e,r,i){n.addEventListener?n.addEventListener(e,r,i):n.attachEvent&&n.attachEvent("on".concat(e),r)}function Pc(n,e,r,i){n.removeEventListener?n.removeEventListener(e,r,i):n.detachEvent&&n.detachEvent("on".concat(e),r)}function N8(n,e){const r=e.slice(0,e.length-1);for(let i=0;i<r.length;i++)r[i]=n[r[i].toLowerCase()];return r}function L8(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let r=e.lastIndexOf("");for(;r>=0;)e[r-1]+=",",e.splice(r,1),r=e.lastIndexOf("");return e}function Zge(n,e){const r=n.length>=e.length?n:e,i=n.length>=e.length?e:n;let s=!0;for(let o=0;o<r.length;o++)i.indexOf(r[o])===-1&&(s=!1);return s}const Ol={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":NS?173:189,"=":NS?61:187,";":NS?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Xr={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},Vc={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},nn={16:!1,18:!1,17:!1,91:!1},Mt={};for(let n=1;n<20;n++)Ol["f".concat(n)]=111+n;let bt=[],al=null,F8="all";const Ui=new Map,Qa=n=>Ol[n.toLowerCase()]||Xr[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Qge=n=>Object.keys(Ol).find(e=>Ol[e]===n),Jge=n=>Object.keys(Xr).find(e=>Xr[e]===n);function z8(n){F8=n||"all"}function Dl(){return F8||"all"}function eme(){return bt.slice(0)}function tme(){return bt.map(n=>Qge(n)||Jge(n)||String.fromCharCode(n))}function nme(){const n=[];return Object.keys(Mt).forEach(e=>{Mt[e].forEach(r=>{let{key:i,scope:s,mods:o,shortcut:a}=r;n.push({scope:s,shortcut:a,mods:o,keys:i.split("+").map(c=>Qa(c))})})}),n}function rme(n){const e=n.target||n.srcElement,{tagName:r}=e;let i=!0;const s=r==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(s||r==="TEXTAREA"||r==="SELECT")&&!e.readOnly)&&(i=!1),i}function ime(n){return typeof n=="string"&&(n=Qa(n)),bt.indexOf(n)!==-1}function sme(n,e){let r,i;n||(n=Dl());for(const s in Mt)if(Object.prototype.hasOwnProperty.call(Mt,s))for(r=Mt[s],i=0;i<r.length;)r[i].scope===n?r.splice(i,1).forEach(a=>{let{element:c}=a;return MC(c)}):i++;Dl()===n&&z8(e||"all")}function ome(n){let e=n.keyCode||n.which||n.charCode;n.key&&n.key.toLowerCase()==="capslock"&&(e=Qa(n.key));const r=bt.indexOf(e);if(r>=0&&bt.splice(r,1),n.key&&n.key.toLowerCase()==="meta"&&bt.splice(0,bt.length),(e===93||e===224)&&(e=91),e in nn){nn[e]=!1;for(const i in Xr)Xr[i]===e&&(Kn[i]=!1)}}function $8(n){if(typeof n>"u")Object.keys(Mt).forEach(s=>{Array.isArray(Mt[s])&&Mt[s].forEach(o=>hd(o)),delete Mt[s]}),MC(null);else if(Array.isArray(n))n.forEach(s=>{s.key&&hd(s)});else if(typeof n=="object")n.key&&hd(n);else if(typeof n=="string"){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];let[s,o]=r;typeof s=="function"&&(o=s,s=""),hd({key:n,scope:s,method:o,splitKey:"+"})}}const hd=n=>{let{key:e,scope:r,method:i,splitKey:s="+"}=n;L8(e).forEach(a=>{const c=a.split(s),l=c.length,u=c[l-1],d=u==="*"?"*":Qa(u);if(!Mt[d])return;r||(r=Dl());const h=l>1?N8(Xr,c):[],p=[];Mt[d]=Mt[d].filter(g=>{const v=(i?g.method===i:!0)&&g.scope===r&&Zge(g.mods,h);return v&&p.push(g.element),!v}),p.forEach(g=>MC(g))})};function WO(n,e,r,i){if(e.element!==i)return;let s;if(e.scope===r||e.scope==="all"){s=e.mods.length>0;for(const o in nn)Object.prototype.hasOwnProperty.call(nn,o)&&(!nn[o]&&e.mods.indexOf(+o)>-1||nn[o]&&e.mods.indexOf(+o)===-1)&&(s=!1);(e.mods.length===0&&!nn[16]&&!nn[18]&&!nn[17]&&!nn[91]||s||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(bt),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function YO(n,e){const r=Mt["*"];let i=n.keyCode||n.which||n.charCode;if(n.key&&n.key.toLowerCase()==="capslock"||!Kn.filter.call(this,n))return;if((i===93||i===224)&&(i=91),bt.indexOf(i)===-1&&i!==229&&bt.push(i),["metaKey","ctrlKey","altKey","shiftKey"].forEach(c=>{const l=Vc[c];n[c]&&bt.indexOf(l)===-1?bt.push(l):!n[c]&&bt.indexOf(l)>-1?bt.splice(bt.indexOf(l),1):c==="metaKey"&&n[c]&&(bt=bt.filter(u=>u in Vc||u===i))}),i in nn){nn[i]=!0;for(const c in Xr)if(Object.prototype.hasOwnProperty.call(Xr,c)){const l=Vc[Xr[c]];Kn[c]=n[l]}if(!r)return}for(const c in nn)Object.prototype.hasOwnProperty.call(nn,c)&&(nn[c]=n[Vc[c]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(bt.indexOf(17)===-1&&bt.push(17),bt.indexOf(18)===-1&&bt.push(18),nn[17]=!0,nn[18]=!0);const s=Dl();if(r)for(let c=0;c<r.length;c++)r[c].scope===s&&(n.type==="keydown"&&r[c].keydown||n.type==="keyup"&&r[c].keyup)&&WO(n,r[c],s,e);if(!(i in Mt))return;const o=Mt[i],a=o.length;for(let c=0;c<a;c++)if((n.type==="keydown"&&o[c].keydown||n.type==="keyup"&&o[c].keyup)&&o[c].key){const l=o[c],{splitKey:u}=l,d=l.key.split(u),h=[];for(let p=0;p<d.length;p++)h.push(Qa(d[p]));h.sort().join("")===bt.sort().join("")&&WO(n,l,s,e)}}function Kn(n,e,r){bt=[];const i=L8(n);let s=[],o="all",a=document,c=0,l=!1,u=!0,d="+",h=!1,p=!1;for(r===void 0&&typeof e=="function"&&(r=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(a=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(h=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(o=e),p&&$8(n,o);c<i.length;c++)n=i[c].split(d),s=[],n.length>1&&(s=N8(Xr,n)),n=n[n.length-1],n=n==="*"?"*":Qa(n),n in Mt||(Mt[n]=[]),Mt[n].push({keyup:l,keydown:u,scope:o,mods:s,shortcut:i[c],method:r,key:i[c],splitKey:d,element:a});if(typeof a<"u"&&window){if(!Ui.has(a)){const g=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return YO(v,a)},y=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;YO(v,a),ome(v)};Ui.set(a,{keydownListener:g,keyupListenr:y,capture:h}),LS(a,"keydown",g,h),LS(a,"keyup",y,h)}if(!al){const g=()=>{bt=[]};al={listener:g,capture:h},LS(window,"focus",g,h)}}}function ame(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Mt).forEach(r=>{Mt[r].filter(s=>s.scope===e&&s.shortcut===n).forEach(s=>{s&&s.method&&s.method()})})}function MC(n){const e=Object.values(Mt).flat();if(e.findIndex(i=>{let{element:s}=i;return s===n})<0){const{keydownListener:i,keyupListenr:s,capture:o}=Ui.get(n)||{};i&&s&&(Pc(n,"keyup",s,o),Pc(n,"keydown",i,o),Ui.delete(n))}if((e.length<=0||Ui.size<=0)&&(Object.keys(Ui).forEach(s=>{const{keydownListener:o,keyupListenr:a,capture:c}=Ui.get(s)||{};o&&a&&(Pc(s,"keyup",a,c),Pc(s,"keydown",o,c),Ui.delete(s))}),Ui.clear(),Object.keys(Mt).forEach(s=>delete Mt[s]),al)){const{listener:s,capture:o}=al;Pc(window,"focus",s,o),al=null}}const FS={getPressedKeyString:tme,setScope:z8,getScope:Dl,deleteScope:sme,getPressedKeyCodes:eme,getAllKeyCodes:nme,isPressed:ime,filter:rme,trigger:ame,unbind:$8,keyMap:Ol,modifier:Xr,modifierMap:Vc};for(const n in FS)Object.prototype.hasOwnProperty.call(FS,n)&&(Kn[n]=FS[n]);if(typeof window<"u"){const n=window.hotkeys;Kn.noConflict=e=>(e&&window.hotkeys===Kn&&(window.hotkeys=n),Kn),window.hotkeys=Kn}const XO=["copy","cut","paste","asset"];function cme(){const n=Z(),e=hs(),r=Ie(),i=Ff(),s=ne("is focused",()=>n.getInstanceState().isFocused,[n]);E.useEffect(()=>{if(!s)return;const o=new Array,a=(l,u)=>{Kn(l,{element:document.body},u),o.push(()=>{Kn.unbind(l,u)})},c=(l,u)=>{Kn(l,{element:document.body,keyup:!0,keydown:!1},u),o.push(()=>{Kn.unbind(l,u)})};for(const l of Object.values(r))l.kbd&&(e&&!l.readonlyOk||XO.includes(l.id)||a(ZO(l.kbd),u=>{Wc(n)||(We(u),l.onSelect("kbd"))}));for(const l of Object.values(i))!l.kbd||!l.readonlyOk&&n.getInstanceState().isReadonly||XO.includes(l.id)||a(ZO(l.kbd),u=>{Wc(n)||(We(u),l.onSelect("kbd"))});return a(",",l=>{if(Wc(n)||n.inputs.keys.has("Comma"))return;We(l),n.focus(),n.inputs.keys.add("Comma");const{x:u,y:d,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_down",point:{x:u,y:d,z:h},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),c(",",l=>{if(Wc(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:u,y:d,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:h},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),()=>{o.forEach(l=>l())}},[r,i,e,n,s])}function ZO(n){return lme(n).map(e=>{let r="";const i=e.split("");return i.length===1?r=i[0]:i[0]==="!"?r=`shift+${i[1]}`:i[0]==="?"?i.length===3&&i[1]==="!"?r=`alt+shift+${i[2]}`:r=`alt+${i[1]}`:i[0]==="$"?i[1]==="!"?r=`cmd+shift+${i[2]},ctrl+shift+${i[2]}`:i[1]==="?"?r=`cmd++${i[2]},ctrl+alt+${i[2]}`:r=`cmd+${i[1]},ctrl+${i[1]}`:r=e,r}).join(",")}function lme(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let r=e.lastIndexOf("");for(;r>=0;)e[r-1]+=",",e.splice(r,1),r=e.lastIndexOf("");return e}function Wc(n){return n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError()}const ume=E.createContext(!1);function dme({children:n}){const e=Z(),r=Iz(),i=jn(),s=Ge(),o=Math.min(8,5+i),[a,c]=E.useState(0),l=E.useRef(null),[u,d]=E.useState(null),h=E.useMemo(()=>{const g=u?`:not([data-value="${u}"])`:"";return`
			#${r}_main > *:nth-child(n + ${o+(u?1:2)})${g} {
				display: none;
			}
			#${r}_more > *:nth-child(-n + ${o}) {
				display: none;
			}
        `},[u,r,o]),p=r$(()=>{if(!l.current)return;const g=Array.from(l.current.children);c(g.length),g.findIndex(x=>x.getAttribute("data-value")===u)<=o&&d(null);const v=Array.from(l.current.children).findIndex(x=>x.getAttribute("aria-checked")==="true");v!==-1&&v>=o&&d(g[v].getAttribute("data-value"))});return E.useLayoutEffect(()=>{p()}),E.useLayoutEffect(()=>{if(!l.current)return;const g=new MutationObserver(p);return g.observe(l.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{g.disconnect()}},[p]),E.useEffect(()=>{const g=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[y,v]of g)Kn(y,x=>{if(Wc(e))return;We(x);const b=Array.from(l.current?.children??[]).filter(S=>!(S instanceof HTMLElement)||S.tagName.toLowerCase()!=="button"?!1:!!(S.offsetWidth||S.offsetHeight))[v];b&&b.click()});return()=>{Kn.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),f.jsxs(f.Fragment,{children:[f.jsx("style",{children:h}),f.jsxs("div",{className:Me("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":i<Rt.TABLET_SM}),role:"radiogroup",children:[f.jsx("div",{id:`${r}_main`,ref:l,className:"tlui-toolbar__tools__list",children:f.jsx(Mr,{type:"toolbar",sourceId:"toolbar",children:n})}),a>o+1&&f.jsx(ume.Provider,{value:!0,children:f.jsxs(Ao,{id:"toolbar overflow",modal:!1,children:[f.jsx(jo,{children:f.jsx(Ae,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:f.jsx(qe,{icon:"chevron-up"})})}),f.jsx(Ro,{side:"top",align:"center",children:f.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${r}_more`,children:f.jsx(Mr,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function hme({activeToolId:n}){const e=Z(),r=jn(),i=Ge(),s=ne("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),o=ne("current tool",()=>e.getCurrentTool(),[e]);return!n||!o.isLockable?null:f.jsx(Ae,{type:"normal",title:i("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Me("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":r<Rt.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!s}),children:f.jsx(qe,{icon:s?"lock":"unlock",small:!0})})}const fme=E.memo(function({children:e}){const r=Z(),i=jn(),s=hs(),o=ne("current tool id",()=>r.getCurrentToolId(),[r]),{ActionsMenu:a,QuickActions:c}=Ys();return f.jsx("div",{className:"tlui-toolbar",children:f.jsxs("div",{className:"tlui-toolbar__inner",children:[f.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&f.jsxs("div",{className:"tlui-toolbar__extras",children:[i<Rt.TABLET&&f.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&f.jsx(c,{}),a&&f.jsx(a,{})]}),f.jsx(hme,{activeToolId:o})]}),f.jsx(dme,{children:e??f.jsx(Sge,{})})]}),i<Rt.TABLET_SM&&!s&&f.jsx("div",{className:"tlui-toolbar__tools",children:f.jsx(bge,{})})]})})});function pme(){const n=Ge();return f.jsxs("div",{className:Me("tlui-offline-indicator"),children:[n("status.offline"),f.jsx(Ci,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function gme({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:r=148,marginBetweenZones:i=12,squeezeAmount:s=52,children:o}){const a=E.useRef(null),c=jn(),l=E.useCallback(()=>{const u=a.current;if(!u)return;const d=u.parentElement.parentElement,h=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),g=d.offsetWidth,y=h.offsetWidth,v=p.offsetWidth,x=u.offsetWidth-e;let m=(g-x)/2;g%2!==0&&(m-=.5);const b=y+i,S=u.offsetLeft,w=Math.min(g-v-y-2*i,n),I=Math.max(m,b)-S;p.offsetWidth>r&&c<=6?u.style.setProperty("max-width",w-s+"px"):u.style.setProperty("max-width",w+"px"),u.style.setProperty("transform",`translate(${I}px, 0px)`)},[c,e,i,n,s,r]);return E.useLayoutEffect(()=>{const u=a.current;if(!u)return;const d=u.parentElement.parentElement,h=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),g=new ResizeObserver(l);return g.observe(h),g.observe(p),g.observe(d),g.observe(u),l(),()=>{g.disconnect()}},[l]),E.useLayoutEffect(()=>{l()}),f.jsx("div",{ref:a,className:"tlui-top-panel__container",children:o})}function mme(){const n=jue()==="offline";return f.jsx(gme,{children:n&&f.jsx(pme,{})})}function yme(){const n=Ie();return f.jsxs(f.Fragment,{children:[f.jsx(te,{...n["zoom-in"],noClose:!0}),f.jsx(te,{...n["zoom-out"],noClose:!0}),f.jsx(c8,{}),f.jsx(l8,{}),f.jsx(u8,{})]})}const vme=E.memo(function({children:e}){const r=Jt(),[i,s]=fs("zoom menu"),o=e??f.jsx(yme,{});return f.jsxs(CC,{dir:"ltr",open:i,onOpenChange:s,modal:!1,children:[f.jsx(PC,{asChild:!0,dir:"ltr",children:f.jsx(xme,{})}),f.jsx(Gf,{container:r,children:f.jsx(IC,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:f.jsx(Mr,{type:"menu",sourceId:"zoom-menu",children:o})})})]})}),xme=E.forwardRef(function(e,r){const i=Z(),s=jn(),o=ne("zoom",()=>i.getZoomLevel(),[i]),a=Ge(),c=E.useCallback(()=>{i.resetZoom(i.getViewportScreenCenter(),{animation:{duration:i.options.animationMediumMs}})},[i]);return f.jsx(Ae,{ref:r,...e,type:"icon",title:`${a("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:s<Rt.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:c,icon:s<Rt.MOBILE?"zoom-in":void 0,children:s<Rt.MOBILE?null:f.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(o*100),"%"]})})}),B8=E.createContext(null);function bme({overrides:n={},children:e}){const r=wf(n),i=zf();return f.jsx(B8.Provider,{value:E.useMemo(()=>({ContextMenu:Nfe,ActionsMenu:lfe,HelpMenu:null,ZoomMenu:vme,MainMenu:xpe,Minimap:Cpe,StylePanel:xge,PageMenu:kpe,NavigationPanel:Ipe,Toolbar:fme,KeyboardShortcutsDialog:spe,QuickActions:Mpe,HelperButtons:rpe,DebugPanel:Wfe,DebugMenu:Vfe,MenuPanel:Qfe,SharePanel:i?Lpe:null,CursorChatBubble:i?zfe:null,TopPanel:i?mme:null,...r}),[r,i]),children:e})}function Ys(){const n=E.useContext(B8);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}function Sme({overrides:n,components:e,assetUrls:r,onUiEvent:i,forceMobile:s,children:o}){return f.jsx(bce,{assetUrls:Ble(r),children:f.jsx(_ce,{overrides:Kle(n),children:f.jsx(Ele,{onEvent:i,children:f.jsx(Ole,{children:f.jsx(kle,{children:f.jsx(qle,{forceMobile:s,children:f.jsx(bme,{overrides:e,children:f.jsx(wme,{overrides:n,children:o})})})})})})})})}function wme({overrides:n,children:e}){const r=Vle(n);return f.jsx(Due,{overrides:r.actions,children:f.jsx(Ule,{overrides:r.tools,children:e})})}function _me(){const n=Z(),{addToast:e}=ri();E.useEffect(()=>{function r({name:i,count:s}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${i} (${s}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",r),()=>{n.removeListener("max-shapes",r)}},[n,e])}const Cme=nt.memo(function({renderDebugMenuItems:e,children:r,hideUi:i,components:s,...o}){return f.jsx(Sme,{...o,components:s,children:f.jsx(Pme,{hideUi:i,renderDebugMenuItems:e,children:r})})}),Pme=nt.memo(function({children:e,hideUi:r,...i}){return f.jsxs(f.Fragment,{children:[e,r?null:f.jsx(Ime,{...i})]})}),Ime=nt.memo(function(){const e=Z(),r=Ge(),i=jn(),s=hs(),o=ne("focus",()=>e.getInstanceState().isFocusMode,[e]),a=ne("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:c,TopPanel:l,MenuPanel:u,StylePanel:d,Toolbar:h,HelpMenu:p,NavigationPanel:g,HelperButtons:y,DebugPanel:v,CursorChatBubble:x}=Ys();cme(),wue(),_me();const{"toggle-focus-mode":m}=Ie();return f.jsxs("div",{className:Me("tlui-layout",{"tlui-layout__mobile":i<Rt.TABLET_SM}),"data-breakpoint":i,children:[o?f.jsx("div",{className:"tlui-layout__top",children:f.jsx(Ae,{type:"icon",className:"tlui-focus-button",title:r("focus-mode.toggle-focus-mode"),onClick:()=>m.onSelect("menu"),children:f.jsx(qe,{icon:"dot"})})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"tlui-layout__top",children:[f.jsxs("div",{className:"tlui-layout__top__left",children:[u&&f.jsx(u,{}),y&&f.jsx(y,{})]}),f.jsx("div",{className:"tlui-layout__top__center",children:l&&f.jsx(l,{})}),f.jsxs("div",{className:"tlui-layout__top__right",children:[c&&f.jsx(c,{}),d&&i>=Rt.TABLET_SM&&!s&&f.jsx(d,{})]})]}),f.jsxs("div",{className:"tlui-layout__bottom",children:[f.jsxs("div",{className:"tlui-layout__bottom__main",children:[g&&f.jsx(g,{}),h&&f.jsx(h,{}),p&&f.jsx(p,{})]}),a&&v&&f.jsx(v,{})]})]}),f.jsx(Fle,{}),f.jsx(Ale,{}),f.jsx(zle,{}),f.jsx(jle,{}),x&&f.jsx(x,{})]})});async function Eme(n,e){const{url:r,style:i="normal",weight:s="500",display:o,featureSettings:a,stretch:c,unicodeRange:l,variant:u,format:d}=e,h={style:i,weight:s,display:o,featureSettings:a,stretch:c,unicodeRange:l,variant:u},p=new FontFace(n,`url(${r})`,h);return await p.load(),document.fonts.add(p),p.$$_url=r,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${r}") format("${d}")
}`,p}const fd=(n,e)=>{const[r,i]=E.useState(2);return E.useEffect(()=>{let s=!1;return i(2),Eme(n,e).then(()=>{s||i(0)}).catch(o=>{s||(console.error(o),i(1))}),()=>{s=!0}},[n,e]),r};function kme(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function U8(n){const e=E.useMemo(()=>kme(n),[n]),r=[fd("tldraw_draw",e.draw),fd("tldraw_serif",e.serif),fd("tldraw_sans",e.sansSerif),fd("tldraw_mono",e.monospace)];return{error:r.some(i=>i===1),done:!r.some(i=>i===2)}}function Tme(n){const{children:e,maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:o,onMount:a,components:c={},shapeUtils:l=[],bindingUtils:u=[],tools:d=[],...h}=n,p=wf(c),g=E.useMemo(()=>({Scribble:eO,ShapeIndicators:zse,CollaboratorScribble:eO,SelectionForeground:Nse,SelectionBackground:Ose,Handles:Tse,...p}),[p]),y=rl(l),v=E.useMemo(()=>[...e4,...y],[y]),x=rl(u),m=E.useMemo(()=>[...x$,...x],[x]),b=rl(d),S=E.useMemo(()=>[...Ile,...Woe,...b],[b]),w=u4(h.assetUrls),{done:I,error:C}=U8(w);return C?f.jsx(g$,{children:"Could not load assets. Please refresh the page."}):I?f.jsx(fse,{initialState:"select",...h,components:g,shapeUtils:v,bindingUtils:m,tools:S,children:f.jsxs(Cme,{...h,components:g,children:[f.jsx(Mme,{maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:o,onMount:a}),e]})}):f.jsx(G_,{children:f.jsx(O_,{})})}function Mme({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:r=g_,acceptedVideoMimeTypes:i=QL,onMount:s}){const o=Z(),a=ri(),c=Ge();m$(()=>{const d=[];return d.push(Nce(o)),woe(o,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i},{toasts:a,msg:c}),d.push(o.store.props.onMount(o)),d.push(s?.(o)),()=>{d.forEach(h=>h?.())}});const{Canvas:l}=Ct(),{ContextMenu:u}=Ys();return u?f.jsx(u,{}):l?f.jsx(l,{}):null}E.memo(function(e){const[r,i]=E.useState(null),[s,o]=E.useState(null),a=rl(e.shapeUtils??[]),c=E.useMemo(()=>[...e4,...a],[a]),l=rl(e.bindingUtils??[]),u=E.useMemo(()=>[...x$,...l],[l]),d=Sse({snapshot:e.snapshot,shapeUtils:c}),h=u4(),{done:p,error:g}=U8(h),{pageId:y,bounds:v,scale:x,background:m,padding:b,darkMode:S,preserveAspectRatio:w,format:I="svg",licenseKey:C}=e;return E.useLayoutEffect(()=>{if(!s||!d||!p)return;let _=!1;const P=document.createElement("div");s.appendChild(P),s.classList.add("tl-container","tl-theme__light");const M=new be({store:d,shapeUtils:c,bindingUtils:u,tools:[],getContainer:()=>P,licenseKey:C});y&&M.setCurrentPage(y);const T=M.getCurrentPageShapeIds();async function A(){const R=await M.getSvgString([...T],{bounds:v,scale:x,background:m,padding:b,darkMode:S,preserveAspectRatio:w});if(R&&!_){if(I==="svg"){if(!_){const O=new Blob([R.svg],{type:"image/svg+xml"}),j=URL.createObjectURL(O);i(j)}}else if(I==="png"){const O=await x4(M,R.svg,{type:I,quality:1,scale:2,width:R.width,height:R.height});if(O&&!_){const j=URL.createObjectURL(O);i(j)}}}M.dispose()}return A(),()=>{_=!0}},[I,s,d,c,u,y,v,x,m,b,S,w,p,g,C]),g?f.jsx(g$,{children:"Could not load assets."}):p?f.jsx("div",{ref:o,style:{position:"relative",width:"100%",height:"100%"},children:r&&f.jsx("img",{src:r,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):f.jsx(G_,{children:f.jsx(O_,{})})});E.memo(function({children:e}){const r=Ge(),i=jn(),s=e??f.jsx(cpe,{});return i<Rt.MOBILE?null:f.jsx("div",{className:"tlui-help-menu",children:f.jsxs(Ao,{id:"help menu",children:[f.jsx(jo,{children:f.jsx(Ae,{type:"help",title:r("help-menu.title"),"data-testid":"help-menu.button",children:f.jsx(qe,{icon:"question-mark",small:!0})})}),f.jsx(Ro,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:f.jsx(Mr,{type:"menu",sourceId:"help-menu",children:s})})]})})});const Ame=He({schemaVersion:_n(1),storeVersion:Pd,recordVersions:Qd(ze,He({version:Pd,subTypeVersions:Qd(ze,Pd).optional(),subTypeKey:ze.optional()}))}),jme=He({schemaVersion:_n(2),sequences:Qd(ze,Pd)});He({tldrawFileFormatVersion:IJ,schema:EJ("schemaVersion",{1:Ame,2:jme}),records:sn(He({id:ze,typeName:ze}).allowUnknownProperties())});function Rme({className:n,initialSnapshot:e,initialTitle:r="Untitled",hideToolbar:i=!1,externalCommand:s,onStatusChange:o,onImportMermaid:a}){const c=E.useMemo(()=>El(),[]),l=E.useRef(null),u=E.useRef(!1),[d,h]=E.useState(r),[p,g]=E.useState(!1),[y,v]=E.useState(!1),[x,m]=E.useState(!1),[b,S]=E.useState(!1),[w,I]=E.useState(""),C=E.useRef(!1),_=E.useRef(0),{toast:P}=Eh(),M=E.useCallback(()=>{const N=l.current;if(!N){v(!1),m(!1);return}const F=N?.getCanUndo,z=N?.getCanRedo,$=N?.history?.getNumUndos,G=N?.history?.getNumRedos,X=typeof F=="function"?!!F.call(N):typeof $=="function"?$.call(N.history)>0:!1,ee=typeof z=="function"?!!z.call(N):typeof G=="function"?G.call(N.history)>0:!1;v(X),m(ee)},[]);E.useEffect(()=>{if(e){C.current=!0;try{L_(c,e);const N=l.current;typeof N?.clearHistory=="function"?N.clearHistory():u.current=!0,g(!1),M()}catch(N){console.error("Failed to load tldraw snapshot:",N)}finally{C.current=!1}}},[e,c,M]),E.useEffect(()=>c.listen(()=>{C.current||(g(!0),M())},{source:"user",scope:"document"}),[c,M]);const T=E.useCallback(async()=>{const N=Vz(c),F=Z1(d),z=`Brain Canvas/${F}`,$=`${z}.md`,G=`${z}.tldraw.json`,X=Q1({mode:"freehand",title:F,snapshotPath:G});try{await Cr.obsidian.saveFile(G,JSON.stringify(N,null,2)),await Cr.obsidian.saveFile($,X),g(!1),P({title:"Freehand map saved",description:$})}catch(ee){P({title:"Save failed",description:String(ee),variant:"destructive"})}},[c,d,P]),A=E.useCallback(N=>{if(l.current=N,N.user.updateUserPreferences({colorScheme:"dark"}),u.current){u.current=!1;const F=l.current?.clearHistory;typeof F=="function"&&F.call(l.current)}M()},[M]),R=E.useCallback(()=>{const N=l.current,F=N?.undo;typeof F=="function"&&F.call(N),M()},[M]),O=E.useCallback(()=>{const N=l.current,F=N?.redo;typeof F=="function"&&F.call(N),M()},[M]),j=E.useCallback(async()=>{const N=l.current;if(!N){P({title:"Export failed",description:"Editor not ready",variant:"destructive"});return}const F=Array.from(N.getCurrentPageShapeIds());if(F.length===0){P({title:"Nothing to export",description:"Add shapes to the canvas first",variant:"destructive"});return}try{const z=await sC({editor:N,ids:F,format:"png",opts:{scale:1,background:!0}}),$=URL.createObjectURL(z),G=document.createElement("a");G.href=$,G.download=`${(d||"concept-map").replace(/[/\\?%*:|"<>]/g,"-")}.png`,G.click(),URL.revokeObjectURL($),P({title:"PNG exported"})}catch(z){P({title:"Export failed",description:String(z),variant:"destructive"})}},[d,P]),D=E.useCallback(()=>{const N=w.trim();N&&a&&(a(N),S(!1),I(""))},[w,a]);return E.useEffect(()=>{o?.({mode:"freehand",isDirty:p,nodeCount:0,edgeCount:0,canUndo:y,canRedo:x,supportsMermaid:!1,supportsDraw:!0,selectedLabels:[]})},[o,p,y,x]),E.useEffect(()=>{if(!(!s||s.target!=="freehand")&&s.id!==_.current)switch(_.current=s.id,s.type){case"save":T();break;case"export_png":j();break;case"undo":R();break;case"redo":O();break}},[s,T,j,R,O]),f.jsxs("div",{className:Kt("flex flex-col h-full",n),children:[!i&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-primary/20 bg-black/40 shrink-0 flex-wrap",children:[f.jsx(aU,{value:d,onChange:N=>h(N.target.value),placeholder:"Map title...",className:"h-7 min-w-[120px] text-xs font-terminal bg-black/40 border-primary/20 rounded-none flex-1 max-w-[180px]"}),f.jsx("div",{className:"w-px h-4 bg-primary/20"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:R,disabled:!y,title:"Undo",children:f.jsx(bN,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:O,disabled:!x,title:"Redo",children:f.jsx(xN,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-primary/20"}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:j,title:"Export PNG",children:[f.jsx(Oh,{className:"w-3 h-3 mr-1"}),"PNG"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:T,title:"Save to vault",children:[f.jsx(Rh,{className:"w-3 h-3 mr-1"}),"Save"]}),a&&f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>S(!0),title:"Import Mermaid",children:[f.jsx(pN,{className:"w-3 h-3 mr-1"}),"Import"]}),f.jsxs("div",{className:"flex items-center gap-1 text-xs font-terminal text-muted-foreground ml-auto",children:[f.jsx("span",{className:Kt("w-1.5 h-1.5 rounded-full shrink-0",p?"bg-destructive":"bg-success")}),p?"Unsaved":"Saved"]})]}),b&&f.jsxs("div",{className:"shrink-0 px-3 py-2 border-b border-primary/20 bg-black/40 flex flex-col gap-2",children:[f.jsx("p",{className:"font-arcade text-xs text-primary",children:"PASTE MERMAID  SWITCH TO STRUCTURED"}),f.jsx("textarea",{value:w,onChange:N=>I(N.target.value),placeholder:`graph TD
  A[Topic] --> B[Subtopic]`,className:"min-h-[60px] w-full px-2 py-1.5 font-mono text-xs bg-black/60 border border-primary/30 rounded-none text-foreground placeholder:text-muted-foreground resize-y",rows:3}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(De,{size:"sm",className:"rounded-none font-terminal text-xs",onClick:D,disabled:!w.trim(),children:"Import & switch"}),f.jsx(De,{size:"sm",variant:"outline",className:"rounded-none font-terminal text-xs border-primary/30",onClick:()=>{S(!1),I("")},children:"Cancel"})]})]}),f.jsx("div",{className:"flex-1 min-h-0 bg-black/80 border border-primary/20",children:f.jsx(Tme,{store:c,onMount:A,inferDarkMode:!1})})]})}const QO=["rectangle","circle","diamond","hexagon"],JO=u1,Ome="polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",Dme="polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)",Nme={rectangle:{width:200,height:72},circle:{width:110,height:110},diamond:{width:130,height:130},hexagon:{width:180,height:96}};function pd(n){return{...Nme[n]}}function Lme({shape:n,className:e,children:r}){return n==="circle"?f.jsx("div",{className:Kt("w-full h-full rounded-full",e),children:f.jsx("div",{className:"w-full h-full flex items-center justify-center p-3",children:r})}):n==="diamond"?f.jsx("div",{className:Kt("w-full h-full",e),style:{clipPath:Ome},children:f.jsx("div",{className:"w-full h-full flex items-center justify-center p-3",children:r})}):n==="hexagon"?f.jsx("div",{className:Kt("w-full h-full",e),style:{clipPath:Dme},children:f.jsx("div",{className:"w-full h-full flex items-center justify-center p-3",children:r})}):f.jsx("div",{className:Kt("w-full h-full rounded-md",e),children:f.jsx("div",{className:"w-full h-full flex items-center justify-center px-3 py-2",children:r})})}function Fme({data:n,selected:e,id:r}){const{label:i,colorIdx:s=0,shape:o="rectangle"}=n,a=JO[s]||JO[0],[c,l]=E.useState(!1),[u,d]=E.useState(i),h=E.useCallback(()=>{if(l(!1),u.trim()&&u!==i){const y=new CustomEvent("mindmap:node-label",{detail:{id:r,label:u.trim()}});window.dispatchEvent(y)}},[u,i,r]),p=E.useCallback(y=>{y.key==="Enter"&&h(),y.key==="Escape"&&(d(i),l(!1))},[h,i]),g="!bg-primary !border-primary !w-2 !h-2";return f.jsxs(f.Fragment,{children:[f.jsx(l5,{isVisible:!!e,minWidth:o==="rectangle"?110:80,minHeight:o==="rectangle"?48:80,keepAspectRatio:o!=="rectangle",lineClassName:"!border-primary",handleClassName:"!bg-primary !border-primary !w-2 !h-2"}),f.jsx(Sn,{type:"target",position:Ce.Top,className:g}),f.jsx(Sn,{type:"target",position:Ce.Left,className:g}),f.jsx(Lme,{shape:o,className:Kt("w-full h-full border-2 font-terminal text-xs text-center min-w-[60px]",e?"border-primary text-primary ring-1 ring-primary":`${a.border} ${a.text}`,a.bg),children:c?f.jsx("input",{autoFocus:!0,value:u,onChange:y=>d(y.target.value),onBlur:h,onKeyDown:p,className:"bg-transparent border-b border-primary text-center text-xs font-terminal outline-none w-full"}):f.jsx("span",{onDoubleClick:()=>{d(i),l(!0)},children:i})}),f.jsx(Sn,{type:"source",position:Ce.Bottom,className:g}),f.jsx(Sn,{type:"source",position:Ce.Right,className:g})]})}function zme({data:n,selected:e}){const{src:r}=n,i="!bg-primary !border-primary !w-2 !h-2";return f.jsxs(f.Fragment,{children:[f.jsx(l5,{isVisible:!!e,minWidth:50,minHeight:50,keepAspectRatio:!0,lineClassName:"!border-primary",handleClassName:"!bg-primary !border-primary !w-2 !h-2"}),f.jsx(Sn,{type:"target",position:Ce.Top,className:i}),f.jsx(Sn,{type:"target",position:Ce.Left,className:i}),f.jsx("img",{src:r,alt:"pasted",className:Kt("w-full h-full object-contain border-2 rounded-md",e?"border-primary ring-1 ring-primary":"border-secondary/50"),draggable:!1}),f.jsx(Sn,{type:"source",position:Ce.Bottom,className:i}),f.jsx(Sn,{type:"source",position:Ce.Right,className:i})]})}const $me={mindmapShape:Fme,mindmapImage:zme},zS={type:"smoothstep",style:{stroke:"hsl(var(--primary))",strokeWidth:2},markerEnd:{type:Ls.ArrowClosed,color:"hsl(var(--primary))"}},eD={rectangle:vU,circle:pU,diamond:CU,hexagon:gN},oi="h-6 px-1.5 text-xs font-terminal";function Bme({onSeedMap:n,onAddNode:e,onDeleteSelected:r,onSetNodeColor:i,onSetEdgeColor:s,onSetShape:o,onAutoLayout:a,onToggleDirection:c,direction:l,drawMode:u,onToggleDraw:d,onExportPng:h,onSaveToVault:p,nodeCount:g,edgeCount:y,isDirty:v}){const[x,m]=E.useState(null);return f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-secondary/30 bg-black/40 shrink-0 flex-wrap",children:[f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:n,title:"Seed from curriculum",children:f.jsx(jU,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsxs("div",{className:"relative",children:[f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:()=>m(x==="add"?null:"add"),title:"Add node",children:f.jsx(Dh,{className:"w-3 h-3"})}),x==="add"&&f.jsx("div",{className:"absolute top-full left-0 mt-1 p-1 bg-black border-2 border-primary/50 z-50 space-y-0.5 min-w-[120px]",children:QO.map(b=>{const S=eD[b];return f.jsxs("button",{onClick:()=>{e(b),m(null)},className:"flex items-center gap-2 w-full px-2 py-1 text-xs font-terminal text-secondary-foreground hover:bg-primary/20",children:[f.jsx(S,{className:"w-3 h-3"}),b]},b)})})]}),f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:r,title:"Delete selected",children:f.jsx(JD,{className:"w-3 h-3"})}),f.jsxs("div",{className:"relative",children:[f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:()=>m(x==="color"?null:"color"),title:"Color selected",children:f.jsx(vN,{className:"w-3 h-3"})}),x==="color"&&f.jsxs("div",{className:"absolute top-full left-0 mt-1 p-2 bg-black border-2 border-primary/50 z-50 space-y-2 min-w-[160px]",children:[f.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"NODE COLORS"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:u1.map((b,S)=>f.jsx("button",{onClick:()=>{i(S),m(null)},className:Kt("w-5 h-5 border-2 rounded-none",b.border,b.bg),title:b.name},b.name))}),f.jsx("p",{className:"font-terminal text-xs text-muted-foreground pt-1",children:"EDGE COLORS"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:cN.map(b=>f.jsx("button",{onClick:()=>{s(b.stroke),m(null)},className:"w-5 h-5 border-2 border-secondary/50 rounded-none",style:{backgroundColor:b.stroke},title:b.name},b.name))})]})]}),f.jsxs("div",{className:"relative",children:[f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:()=>m(x==="shape"?null:"shape"),title:"Change shape",children:f.jsx(gN,{className:"w-3 h-3"})}),x==="shape"&&f.jsx("div",{className:"absolute top-full left-0 mt-1 p-1 bg-black border-2 border-primary/50 z-50 space-y-0.5 min-w-[120px]",children:QO.map(b=>{const S=eD[b];return f.jsxs("button",{onClick:()=>{o(b),m(null)},className:"flex items-center gap-2 w-full px-2 py-1 text-xs font-terminal text-secondary-foreground hover:bg-primary/20",children:[f.jsx(S,{className:"w-3 h-3"}),b]},b)})})]}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:a,title:"Auto layout",children:f.jsx(yN,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:c,title:`Direction: ${l}`,children:l==="TB"?f.jsx(fN,{className:"w-3 h-3"}):f.jsx(hN,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:Kt(oi,u&&"bg-primary/20 text-primary"),onClick:d,title:"Draw mode",children:f.jsx(cU,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-secondary/30"}),f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:h,title:"Export PNG",children:f.jsx(Oh,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:oi,onClick:p,title:"Save to vault",children:f.jsx(Rh,{className:"w-3 h-3"})}),f.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs font-terminal text-muted-foreground",children:[f.jsxs("span",{children:[g,"N / ",y,"E"]}),f.jsx("span",{className:Kt("w-2 h-2 rounded-full",v?"bg-destructive":"bg-success")}),f.jsx("span",{children:v?"Unsaved":"Saved"})]})]})}function Ume({active:n,strokes:e,onStrokeAdd:r,penColor:i="#ef4444",penWidth:s=2}){const o=E.useRef(null),a=E.useRef(!1),c=E.useRef([]),l=E.useCallback(()=>{const p=o.current;if(!p)return;const g=p.getContext("2d");if(!g)return;g.clearRect(0,0,p.width,p.height);for(const v of e)if(!(v.points.length<2)){g.beginPath(),g.strokeStyle=v.color,g.lineWidth=v.width,g.lineCap="round",g.lineJoin="round",g.moveTo(v.points[0][0],v.points[0][1]);for(let x=1;x<v.points.length;x++)g.lineTo(v.points[x][0],v.points[x][1]);g.stroke()}const y=c.current;if(y.length>=2){g.beginPath(),g.strokeStyle=i,g.lineWidth=s,g.lineCap="round",g.lineJoin="round",g.moveTo(y[0][0],y[0][1]);for(let v=1;v<y.length;v++)g.lineTo(y[v][0],y[v][1]);g.stroke()}},[e,i,s]);E.useEffect(()=>{const p=o.current;if(!p)return;const g=p.parentElement;if(!g)return;const y=new ResizeObserver(()=>{const v=g.getBoundingClientRect();p.width=v.width,p.height=v.height,l()});return y.observe(g),()=>y.disconnect()},[l]),E.useEffect(()=>{l()},[l]);const u=E.useCallback(p=>{if(!n)return;a.current=!0;const g=o.current?.getBoundingClientRect();g&&(c.current=[[p.clientX-g.left,p.clientY-g.top]],p.target.setPointerCapture(p.pointerId))},[n]),d=E.useCallback(p=>{if(!a.current)return;const g=o.current?.getBoundingClientRect();g&&(c.current.push([p.clientX-g.left,p.clientY-g.top]),l())},[l]),h=E.useCallback(()=>{if(!a.current)return;a.current=!1;const p=c.current;p.length>=2&&r({points:[...p],color:i,width:s}),c.current=[]},[r,i,s]);return f.jsx("canvas",{ref:o,className:"absolute inset-0",style:{zIndex:n?10:0,pointerEvents:n?"auto":"none",cursor:n?"crosshair":"default"},onPointerDown:u,onPointerMove:d,onPointerUp:h})}const qme={course:6,module:4,lo:3},tD={course:"rectangle",module:"rectangle",lo:"rectangle"};function Hme({hideToolbar:n=!1,externalCommand:e,onStatusChange:r}){const[i,s,o]=t5([]),[a,c,l]=n5([]),[u,d]=E.useState("LR"),[h,p]=E.useState(0),[g,y]=E.useState(!1),[v,x]=E.useState(!1),[m,b]=E.useState([]),[S,w]=E.useState(!1),[I,C]=E.useState(""),_=E.useRef(null),P=E.useRef(!1),M=E.useRef(0),{toast:T}=Eh(),[A,R]=E.useState(new Set),[O,j]=E.useState(new Set),[D,N]=E.useState(!0),{data:F=[]}=Ip({queryKey:["courses"],queryFn:()=>Cr.courses.getActive()}),z=F.map(se=>se.id).sort(),{data:$=[]}=Ip({queryKey:["modules","all",z],queryFn:async()=>(await Promise.all(F.map(ve=>Cr.modules.getByCourse(ve.id)))).flat(),enabled:F.length>0}),{data:G=[]}=Ip({queryKey:["learningObjectives","all",z,D],queryFn:async()=>(await Promise.all(F.map(ve=>Cr.learningObjectives.getByCourse(ve.id)))).flat(),enabled:F.length>0&&D});E.useEffect(()=>{F.length>0&&!P.current&&(P.current=!0,R(new Set(F.map(se=>se.id))))},[F]);const X=E.useMemo(()=>{const se=[],ve=[],Se=new Map;for(const ke of $){const Ne=Se.get(ke.courseId)??[];Ne.push(ke),Se.set(ke.courseId,Ne)}const Ke=new Map;for(const ke of G){if(ke.moduleId==null)continue;const Ne=Ke.get(ke.moduleId)??[];Ne.push(ke),Ke.set(ke.moduleId,Ne)}for(const ke of F){if(!A.has(ke.id))continue;const Ne=`course-${ke.id}`;se.push({id:Ne,name:ke.name,type:"course"});const ut=Se.get(ke.id)??[];for(const Xe of ut){if(O.size>0&&!O.has(Xe.id))continue;const J=`module-${Xe.id}`;if(se.push({id:J,name:Xe.name,type:"module"}),ve.push({source:Ne,target:J}),D){const le=Ke.get(Xe.id)??[];for(const ge of le){const Le=`lo-${ge.id}`;se.push({id:Le,name:`${ge.loCode}: ${ge.title}`,type:"lo"}),ve.push({source:J,target:Le})}}}}return{nodes:se,links:ve}},[F,$,G,A,O,D]),ee=se=>{R(ve=>{const Se=new Set(ve);return Se.has(se)?Se.delete(se):Se.add(se),Se})},re=se=>{j(ve=>{const Se=new Set(ve);return Se.has(se)?Se.delete(se):Se.add(se),Se})},B=E.useCallback(se=>{y(!0),o(se)},[o]),U=E.useCallback(se=>{y(!0),l(se)},[l]),Q=E.useCallback(se=>{y(!0),c(ve=>P1(se,ve))},[c]);E.useEffect(()=>{const se=ve=>{const{id:Se,label:Ke}=ve.detail;s(ke=>ke.map(Ne=>Ne.id===Se?{...Ne,data:{...Ne.data,label:Ke}}:Ne)),y(!0)};return window.addEventListener("mindmap:node-label",se),()=>window.removeEventListener("mindmap:node-label",se)},[s]);const K=E.useCallback(()=>{const{nodes:se,links:ve}=X;if(se.length===0){T({title:"No data",description:"Select courses first",variant:"destructive"});return}const Se=new Set(i.filter(ge=>!ge.id.startsWith("course-")&&!ge.id.startsWith("module-")&&!ge.id.startsWith("lo-")).map(ge=>ge.id)),Ke=i.filter(ge=>Se.has(ge.id)),ke=a.filter(ge=>Se.has(ge.source)||Se.has(ge.target)),Ne=se.map(ge=>({id:ge.id,type:"mindmapShape",position:{x:0,y:0},data:(()=>{const Le=tD[ge.type]??"rectangle";return{label:ge.name,colorIdx:qme[ge.type]??0,shape:Le}})(),style:pd(tD[ge.type]??"rectangle")})),ut=ve.map((ge,Le)=>({id:`seed-e-${Le}`,source:ge.source,target:ge.target,...zS})),Xe=[...Ne,...Ke],J=[...ut,...ke],le=lo(Xe,J,{direction:u});s(le),c(J),p(Xe.length),y(!0),T({title:"Map seeded",description:`${se.length} curriculum nodes`})},[X,i,a,u,s,c,T]),Y=E.useCallback(se=>{const ve=`mm-${h+1}`;p(Ke=>Ke+1);const Se={id:ve,type:"mindmapShape",position:{x:Math.random()*300+50,y:Math.random()*200+50},data:{label:`Node ${h+1}`,colorIdx:0,shape:se},style:pd(se)};s(Ke=>[...Ke,Se]),y(!0)},[h,s]),V=E.useCallback(()=>{s(se=>se.filter(ve=>!ve.selected)),c(se=>se.filter(ve=>!ve.selected)),y(!0)},[s,c]),ie=E.useCallback(se=>{s(ve=>ve.map(Se=>Se.selected?{...Se,data:{...Se.data,colorIdx:se}}:Se)),y(!0)},[s]),ae=E.useCallback(se=>{c(ve=>ve.map(Se=>Se.selected?{...Se,style:{...Se.style,stroke:se,strokeWidth:2.5},markerEnd:{type:Ls.ArrowClosed,color:se}}:Se)),y(!0)},[c]),ye=E.useCallback(se=>{s(ve=>ve.map(Se=>Se.selected&&Se.type==="mindmapShape"?{...Se,data:{...Se.data,shape:se},style:pd(se)}:Se)),y(!0)},[s]),he=E.useCallback(()=>{const se=lo(i,a,{direction:u});s(se),y(!0)},[i,a,u,s]),xe=E.useCallback(()=>{const se=u==="TB"?"LR":"TB";d(se);const ve=lo(i,a,{direction:se});s(ve),y(!0)},[u,i,a,s]),fe=E.useCallback(se=>{const ve=se.clipboardData?.items;if(ve)for(const Se of ve){if(!Se.type.startsWith("image/"))continue;const Ke=Se.getAsFile();if(!Ke)continue;const ke=new FileReader;ke.onload=()=>{const Ne=`mm-img-${h+1}`;p(Xe=>Xe+1);const ut={id:Ne,type:"mindmapImage",position:{x:Math.random()*300+50,y:Math.random()*200+50},data:{src:ke.result},style:{width:200,height:150}};s(Xe=>[...Xe,ut]),y(!0)},ke.readAsDataURL(Ke);break}},[h,s]),me=E.useCallback(async()=>{if(_.current)try{const se=_.current.querySelector(".react-flow__viewport");if(!se)return;const ve=await aN(se,{backgroundColor:"#000",quality:1}),Se=document.createElement("a");Se.download="mind-map.png",Se.href=ve,Se.click(),T({title:"PNG exported"})}catch(se){T({title:"Export failed",description:String(se),variant:"destructive"})}},[T]),we=E.useCallback(()=>{if(i.length===0){T({title:"Nothing to export",description:"Add nodes first",variant:"destructive"});return}const se=new Map;i.forEach((ke,Ne)=>{se.set(ke.id,`N${Ne+1}`)});const ve=i.map(ke=>({...ke,id:se.get(ke.id)||ke.id,data:{...ke.data,label:String(ke.data?.label||ke.id)}})),Se=a.filter(ke=>se.has(ke.source)&&se.has(ke.target)).map(ke=>({...ke,source:se.get(ke.source)||ke.source,target:se.get(ke.target)||ke.target})),Ke=Jc(ve,Se,u);navigator.clipboard.writeText(Ke),T({title:"Mermaid copied to clipboard"})},[i,a,u,T]),st=E.useCallback(se=>{const ve=se.trim();if(!ve)return;const Se=lL(ve),Ke=Se.nodes.map((Xe,J)=>({...Xe,id:`mm-import-${J+1}`,type:"mindmapShape",data:{label:String(Xe.data?.label||Xe.id),colorIdx:0,shape:"rectangle"},style:pd("rectangle")})),ke=new Map;Se.nodes.forEach((Xe,J)=>{ke.set(Xe.id,`mm-import-${J+1}`)});const Ne=Se.edges.map((Xe,J)=>{const le=ke.get(Xe.source),ge=ke.get(Xe.target);return!le||!ge?null:{id:`mm-import-e-${J+1}`,source:le,target:ge,...zS}}).filter(Xe=>Xe!==null),ut=lo(Ke,Ne,{direction:Se.direction});d(Se.direction),s(ut),c(Ne),p(Ke.length),y(!0),T({title:"Mermaid imported",description:`${Ke.length} nodes`})},[s,c,T]),lt=E.useCallback(async()=>{const se=Z1(i[0]?.data?.label||"Untitled Canvas"),ve=`Brain Canvas/${se}`,Se=`${ve}.md`,Ke=`${ve}.layout.json`,ke=`${ve}.strokes.json`,Ne=new Map;i.forEach((Re,hn)=>Ne.set(Re.id,`N${hn+1}`));const ut=i.map(Re=>({...Re,id:Ne.get(Re.id)||Re.id,data:{...Re.data,label:String(Re.data?.label||Re.id)}})),Xe=a.filter(Re=>Ne.has(Re.source)&&Ne.has(Re.target)).map(Re=>({...Re,source:Ne.get(Re.source)||Re.source,target:Ne.get(Re.target)||Re.target})),J=Jc(ut,Xe,u),le=JSON.stringify({nodes:i.map(Re=>({id:Re.id,type:Re.type,position:Re.position,data:Re.data,style:Re.style})),edges:a.map(Re=>({id:Re.id,source:Re.source,target:Re.target,style:Re.style,markerEnd:Re.markerEnd})),meta:{direction:u,updated:new Date().toISOString()}},null,2),ge=JSON.stringify({strokes:m,updated:new Date().toISOString()},null,2),Le=Q1({mode:"mindmap",title:se,mermaid:J,layoutPath:Ke,strokesPath:ke});try{await Cr.obsidian.saveFile(Ke,le),await Cr.obsidian.saveFile(ke,ge),await Cr.obsidian.saveFile(Se,Le),T({title:"Saved to vault",description:Se}),y(!1)}catch(Re){T({title:"Save failed",description:String(Re),variant:"destructive"})}},[i,a,m,u,T]),Ut=E.useCallback(se=>{b(ve=>[...ve,se]),y(!0)},[]);E.useEffect(()=>{r?.({mode:"mindmap",isDirty:g,nodeCount:i.length,edgeCount:a.length,canUndo:!1,canRedo:!1,supportsMermaid:!0,supportsDraw:!0,selectedLabels:i.filter(se=>se.selected).map(se=>String(se.data?.label||se.id))})},[r,g,i,a]),E.useEffect(()=>{if(!(!e||e.target!=="mindmap")&&e.id!==M.current)switch(M.current=e.id,e.type){case"save":lt();break;case"export_png":me();break;case"export_mermaid":we();break;case"import_mermaid":{const se=typeof e.payload=="string"?e.payload.trim():"";se?(st(se),C(se),w(!1)):w(!0);break}case"add_node":Y("rectangle");break;case"delete_selected":V();break;case"auto_layout":he();break;case"toggle_direction":xe();break;case"toggle_draw":x(se=>!se);break}},[e,lt,me,we,st,Y,V,he,xe]);const Bt=$.filter(se=>A.has(se.courseId));return f.jsxs("div",{className:"flex h-full",onPaste:fe,children:[f.jsx("div",{className:"w-[160px] shrink-0 border-r border-secondary/30 bg-black/60",children:f.jsx(oN,{className:"h-full",children:f.jsxs("div",{className:"p-3 space-y-4",children:[f.jsxs("div",{children:[f.jsx("div",{className:"font-arcade text-xs text-primary mb-2",children:"COURSES"}),F.map(se=>f.jsxs("label",{className:"flex items-center gap-2 py-1 cursor-pointer",children:[f.jsx(sa,{checked:A.has(se.id),onCheckedChange:()=>ee(se.id),className:"border-cyan-500 data-[state=checked]:bg-cyan-500"}),f.jsx("span",{className:"font-terminal text-xs text-cyan-300",children:se.name})]},se.id))]}),Bt.length>0&&f.jsxs("div",{children:[f.jsx("div",{className:"font-arcade text-xs text-yellow-400 mb-2",children:"MODULES"}),f.jsxs("label",{className:"flex items-center gap-2 py-1 cursor-pointer mb-1",children:[f.jsx(sa,{checked:O.size===0,onCheckedChange:()=>j(new Set),className:"border-yellow-500 data-[state=checked]:bg-yellow-500"}),f.jsx("span",{className:"font-terminal text-xs text-yellow-200",children:"All Modules"})]}),Bt.map(se=>f.jsxs("label",{className:"flex items-center gap-2 py-0.5 cursor-pointer",children:[f.jsx(sa,{checked:O.size===0||O.has(se.id),onCheckedChange:()=>re(se.id),className:"border-yellow-500 data-[state=checked]:bg-yellow-500"}),f.jsx("span",{className:"font-terminal text-xs text-yellow-100 truncate",children:se.name})]},se.id))]}),f.jsx("div",{children:f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[f.jsx(sa,{checked:D,onCheckedChange:se=>N(!!se),className:"border-green-500 data-[state=checked]:bg-green-500"}),f.jsx("span",{className:"font-terminal text-xs text-green-300",children:"Show LOs"})]})}),f.jsxs("div",{className:"pt-2 border-t border-secondary/30 space-y-1",children:[f.jsx("div",{className:"font-arcade text-xs text-muted-foreground mb-1",children:"LEGEND"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-sm border-2 border-cyan-400 bg-cyan-400/15"}),f.jsx("span",{className:"font-terminal text-xs text-cyan-300",children:"Course"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-sm border border-yellow-400 bg-yellow-400/12"}),f.jsx("span",{className:"font-terminal text-xs text-yellow-300",children:"Module"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-sm border border-green-400 bg-green-400/8"}),f.jsx("span",{className:"font-terminal text-xs text-green-300",children:"LO"})]})]}),f.jsx("div",{className:"pt-2 border-t border-secondary/30",children:f.jsxs(De,{size:"sm",variant:"outline",className:"w-full h-7 text-xs font-terminal border-primary/50 text-primary",onClick:K,children:["Seed Map (",X.nodes.length,")"]})})]})})}),f.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[!n&&f.jsx(Bme,{onSeedMap:K,onAddNode:Y,onDeleteSelected:V,onSetNodeColor:ie,onSetEdgeColor:ae,onSetShape:ye,onAutoLayout:he,onToggleDirection:xe,direction:u,drawMode:v,onToggleDraw:()=>x(se=>!se),onExportPng:me,onSaveToVault:lt,nodeCount:i.length,edgeCount:a.length,isDirty:g}),S&&f.jsxs("div",{className:"shrink-0 px-3 py-2 border-b border-primary/20 bg-black/40 flex flex-col gap-2",children:[f.jsx("p",{className:"font-arcade text-xs text-primary",children:"PASTE MERMAID TO IMPORT"}),f.jsx("textarea",{value:I,onChange:se=>C(se.target.value),placeholder:`graph LR
  A[Course] --> B[Module]`,className:"min-h-[64px] w-full px-2 py-1.5 font-mono text-xs bg-black/60 border border-primary/30 rounded-none text-foreground placeholder:text-muted-foreground resize-y",rows:4}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(De,{size:"sm",className:"rounded-none font-terminal text-xs",disabled:!I.trim(),onClick:()=>{st(I),w(!1)},children:"Import"}),f.jsx(De,{size:"sm",variant:"outline",className:"rounded-none font-terminal text-xs border-primary/30",onClick:()=>w(!1),children:"Cancel"})]})]}),f.jsxs("div",{className:"flex-1 min-h-0 relative",ref:_,children:[f.jsx(Ume,{active:v,strokes:m,onStrokeAdd:Ut}),f.jsxs(e5,{nodes:i,edges:a,onNodesChange:B,onEdgesChange:U,onConnect:Q,nodeTypes:$me,defaultEdgeOptions:zS,fitView:!0,className:"bg-black/80",proOptions:{hideAttribution:!0},children:[f.jsx(i5,{color:"hsl(var(--primary) / 0.1)",gap:20}),f.jsx(o5,{className:"!bg-black !border-primary [&_button]:!bg-black/80 [&_button]:!border-primary/50 [&_button]:!text-primary"}),f.jsx(c5,{className:"!bg-black/80 !border-primary",nodeColor:"hsl(var(--primary))",maskColor:"rgba(0,0,0,0.5)"})]}),i.length===0&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center font-terminal text-xs text-muted-foreground pointer-events-none",children:'Select courses & click "Seed Map", or add nodes manually'})]})]})]})}function Gme(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function Kme(n,e,r){return e=eye(e),e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function nD(n,e){return Yme(n)||Gme(n,e)||q8(n,e)||Qme()}function Vme(n){return Wme(n)||Xme(n)||q8(n)||Zme()}function Wme(n){if(Array.isArray(n))return Yw(n)}function Yme(n){if(Array.isArray(n))return n}function Xme(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function q8(n,e){if(n){if(typeof n=="string")return Yw(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yw(n,e)}}function Yw(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=n[r];return i}function Zme(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jme(n,e){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function eye(n){var e=Jme(n,"string");return typeof e=="symbol"?e:String(e)}var tye=function(e,r){var i=new Set(r);return Object.assign.apply(Object,[{}].concat(Vme(Object.entries(e).filter(function(s){var o=nD(s,1),a=o[0];return!i.has(a)}).map(function(s){var o=nD(s,2),a=o[0],c=o[1];return Kme({},a,c)}))))};function Xw(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function nye(n){if(Array.isArray(n))return n}function rye(n){if(Array.isArray(n))return Xw(n)}function iye(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function sye(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e!==0)for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function oye(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aye(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cye(n,e){return nye(n)||sye(n,e)||H8(n,e)||oye()}function rD(n){return rye(n)||iye(n)||H8(n)||aye()}function H8(n,e){if(n){if(typeof n=="string")return Xw(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xw(n,e):void 0}}function lye(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.wrapperElementType,i=r===void 0?"div":r,s=e.nodeMapper,o=s===void 0?function(d){return d}:s,a=e.methodNames,c=a===void 0?[]:a,l=e.initPropNames,u=l===void 0?[]:l;return E.forwardRef(function(d,h){var p=E.useRef(),g=E.useMemo(function(){var x=Object.fromEntries(u.filter(function(m){return d.hasOwnProperty(m)}).map(function(m){return[m,d[m]]}));return n(x)},[]);iD(function(){g(o(p.current))},E.useLayoutEffect),iD(function(){return g._destructor instanceof Function?g._destructor:void 0});var y=E.useCallback(function(x){for(var m=arguments.length,b=new Array(m>1?m-1:0),S=1;S<m;S++)b[S-1]=arguments[S];return g[x]instanceof Function?g[x].apply(g,b):void 0},[g]),v=E.useRef({});return Object.keys(tye(d,[].concat(rD(c),rD(u)))).filter(function(x){return v.current[x]!==d[x]}).forEach(function(x){return y(x,d[x])}),v.current=d,E.useImperativeHandle(h,function(){return Object.fromEntries(c.map(function(x){return[x,function(){for(var m=arguments.length,b=new Array(m),S=0;S<m;S++)b[S]=arguments[S];return y.apply(void 0,[x].concat(b))}]}))},[y]),nt.createElement(i,{ref:p})})}function iD(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.useEffect,r=E.useRef(),i=E.useRef(!1),s=E.useRef(!1),o=E.useState(0),a=cye(o,2);a[0];var c=a[1];i.current&&(s.current=!0),e(function(){return i.current||(r.current=n(),i.current=!0),c(function(l){return l+1}),function(){s.current&&r.current&&r.current()}},[])}class sD extends Map{constructor(e,r=hye){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[i,s]of e)this.set(i,s)}get(e){return super.get(oD(this,e))}has(e){return super.has(oD(this,e))}set(e,r){return super.set(uye(this,e),r)}delete(e){return super.delete(dye(this,e))}}function oD({_intern:n,_key:e},r){const i=e(r);return n.has(i)?n.get(i):r}function uye({_intern:n,_key:e},r){const i=e(r);return n.has(i)?n.get(i):(n.set(i,r),r)}function dye({_intern:n,_key:e},r){const i=e(r);return n.has(i)&&(r=n.get(i),n.delete(i)),r}function hye(n){return n!==null&&typeof n=="object"?n.valueOf():n}function aD(n,e){let r;if(e===void 0)for(const i of n)i!=null&&(r<i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function cD(n,e){let r;if(e===void 0)for(const i of n)i!=null&&(r>i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function fye(n,e){let r=0;for(let i of n)(i=+i)&&(r+=i);return r}var pye=typeof global=="object"&&global&&global.Object===Object&&global,gye=typeof self=="object"&&self&&self.Object===Object&&self,G8=pye||gye||Function("return this")(),Sh=G8.Symbol,K8=Object.prototype,mye=K8.hasOwnProperty,yye=K8.toString,Ic=Sh?Sh.toStringTag:void 0;function vye(n){var e=mye.call(n,Ic),r=n[Ic];try{n[Ic]=void 0;var i=!0}catch{}var s=yye.call(n);return i&&(e?n[Ic]=r:delete n[Ic]),s}var xye=Object.prototype,bye=xye.toString;function Sye(n){return bye.call(n)}var wye="[object Null]",_ye="[object Undefined]",lD=Sh?Sh.toStringTag:void 0;function Cye(n){return n==null?n===void 0?_ye:wye:lD&&lD in Object(n)?vye(n):Sye(n)}function Pye(n){return n!=null&&typeof n=="object"}var Iye="[object Symbol]";function Eye(n){return typeof n=="symbol"||Pye(n)&&Cye(n)==Iye}var kye=/\s/;function Tye(n){for(var e=n.length;e--&&kye.test(n.charAt(e)););return e}var Mye=/^\s+/;function Aye(n){return n&&n.slice(0,Tye(n)+1).replace(Mye,"")}function wh(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var uD=NaN,jye=/^[-+]0x[0-9a-f]+$/i,Rye=/^0b[01]+$/i,Oye=/^0o[0-7]+$/i,Dye=parseInt;function dD(n){if(typeof n=="number")return n;if(Eye(n))return uD;if(wh(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=wh(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=Aye(n);var r=Rye.test(n);return r||Oye.test(n)?Dye(n.slice(2),r?2:8):jye.test(n)?uD:+n}var $S=function(){return G8.Date.now()},Nye="Expected a function",Lye=Math.max,Fye=Math.min;function V8(n,e,r){var i,s,o,a,c,l,u=0,d=!1,h=!1,p=!0;if(typeof n!="function")throw new TypeError(Nye);e=dD(e)||0,wh(r)&&(d=!!r.leading,h="maxWait"in r,o=h?Lye(dD(r.maxWait)||0,e):o,p="trailing"in r?!!r.trailing:p);function g(C){var _=i,P=s;return i=s=void 0,u=C,a=n.apply(P,_),a}function y(C){return u=C,c=setTimeout(m,e),d?g(C):a}function v(C){var _=C-l,P=C-u,M=e-_;return h?Fye(M,o-P):M}function x(C){var _=C-l,P=C-u;return l===void 0||_>=e||_<0||h&&P>=o}function m(){var C=$S();if(x(C))return b(C);c=setTimeout(m,v(C))}function b(C){return c=void 0,p&&i?g(C):(i=s=void 0,a)}function S(){c!==void 0&&clearTimeout(c),u=0,i=l=s=c=void 0}function w(){return c===void 0?a:b($S())}function I(){var C=$S(),_=x(C);if(i=arguments,s=this,l=C,_){if(c===void 0)return y(l);if(h)return clearTimeout(c),c=setTimeout(m,e),g(l)}return c===void 0&&(c=setTimeout(m,e)),a}return I.cancel=S,I.flush=w,I}var zye="Expected a function";function $ye(n,e,r){var i=!0,s=!0;if(typeof n!="function")throw new TypeError(zye);return wh(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),V8(n,e,{leading:i,maxWait:e,trailing:s})}var vo=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-vo.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?vo.Bounce.In(n*2)*.5:vo.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Yc=function(){return performance.now()},W8=(function(){function n(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(r){return e._tweens[r]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(){for(var e,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];for(var s=0,o=r;s<o.length;s++){var a=o[s];(e=a._group)===null||e===void 0||e.remove(a),a._group=this,this._tweens[a.getId()]=a,this._tweensAddedDuringUpdate[a.getId()]=a}},n.prototype.remove=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var i=0,s=e;i<s.length;i++){var o=s[i];o._group=void 0,delete this._tweens[o.getId()],delete this._tweensAddedDuringUpdate[o.getId()]}},n.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},n.prototype.update=function(e,r){e===void 0&&(e=Yc()),r===void 0&&(r=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var o=this._tweens[i[s]],a=!r;o&&o.update(e,a)===!1&&!r&&this.remove(o)}i=Object.keys(this._tweensAddedDuringUpdate)}},n})(),Zw={Linear:function(n,e){var r=n.length-1,i=r*e,s=Math.floor(i),o=Zw.Utils.Linear;return e<0?o(n[0],n[1],i):e>1?o(n[r],n[r-1],r-i):o(n[s],n[s+1>r?r:s+1],i-s)},Utils:{Linear:function(n,e,r){return(e-n)*r+n}}},Y8=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),Qw=new W8,hD=(function(){function n(e,r){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=vo.Linear.None,this._interpolationFunction=Zw.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Y8.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof r=="object"?(this._group=r,r.add(this)):r===!0&&(this._group=Qw,Qw.add(this))}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,r){if(r===void 0&&(r=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=r<0?0:r,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,r){if(e===void 0&&(e=Yc()),r===void 0&&(r=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||r){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var o in this._valuesEnd)s[o]=this._valuesEnd[o];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,r)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,r,i,s,o){for(var a in i){var c=e[a],l=Array.isArray(c),u=l?"array":typeof c,d=!l&&Array.isArray(i[a]);if(!(u==="undefined"||u==="function")){if(d){var h=i[a];if(h.length===0)continue;for(var p=[c],g=0,y=h.length;g<y;g+=1){var v=this._handleRelativeValue(c,h[g]);if(isNaN(v)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}p.push(v)}d&&(i[a]=p)}if((u==="object"||l)&&c&&!d){r[a]=l?[]:{};var x=c;for(var m in x)r[a][m]=x[m];s[a]=l?[]:{};var h=i[a];if(!this._isDynamic){var b={};for(var m in h)b[m]=h[m];i[a]=h=b}this._setupProperties(x,r[a],h,s[a],o)}else(typeof r[a]>"u"||o)&&(r[a]=c),l||(r[a]*=1),d?s[a]=i[a].slice().reverse():s[a]=r[a]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},n.prototype.pause=function(e){return e===void 0&&(e=Yc()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},n.prototype.resume=function(e){return e===void 0&&(e=Yc()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},n.prototype.stopChainedTweens=function(){for(var e=0,r=this._chainedTweens.length;e<r;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},n.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=vo.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=Zw.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,r){var i=this,s;if(e===void 0&&(e=Yc()),r===void 0&&(r=n.autoStartOnUpdate),this._isPaused)return!0;var o;if(!this._goToEnd&&!this._isPlaying)if(r)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,c=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),l=this._duration+this._repeat*c,u=function(){if(i._duration===0||a>l)return 1;var v=Math.trunc(a/c),x=a-v*c,m=Math.min(x/i._duration,1);return m===0&&a===i._duration?1:m},d=u(),h=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||a>=this._duration)if(this._repeat>0){var p=Math.min(Math.trunc((a-this._duration)/c)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(o in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[o]=="string"&&(this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(this._valuesEnd[o])),this._yoyo&&this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=c*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,y=this._chainedTweens.length;g<y;g++)this._chainedTweens[g].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,r,i,s){for(var o in i)if(r[o]!==void 0){var a=r[o]||0,c=i[o],l=Array.isArray(e[o]),u=Array.isArray(c),d=!l&&u;d?e[o]=this._interpolationFunction(c,s):typeof c=="object"&&c?this._updateProperties(e[o],a,c,s):(c=this._handleRelativeValue(a,c),typeof c=="number"&&(e[o]=a+(c-a)*s))}},n.prototype._handleRelativeValue=function(e,r){return typeof r!="string"?r:r.charAt(0)==="+"||r.charAt(0)==="-"?e+parseFloat(r):parseFloat(r)},n.prototype._swapEndStartRepeatValues=function(e){var r=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=r},n.autoStartOnUpdate=!1,n})();Y8.nextId;var Pi=Qw;Pi.getAll.bind(Pi);Pi.removeAll.bind(Pi);Pi.add.bind(Pi);Pi.remove.bind(Pi);Pi.update.bind(Pi);function fD(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function Bye(n){if(Array.isArray(n))return n}function Uye(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function qye(n,e,r){return Object.defineProperty(n,"prototype",{writable:!1}),n}function Hye(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e!==0)for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function Gye(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kye(n,e){return Bye(n)||Hye(n,e)||Vye(n,e)||Gye()}function Vye(n,e){if(n){if(typeof n=="string")return fD(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fD(n,e):void 0}}var Wye=qye(function n(e,r){var i=r.default,s=i===void 0?null:i,o=r.triggerUpdate,a=o===void 0?!0:o,c=r.onChange,l=c===void 0?function(u,d){}:c;Uye(this,n),this.name=e,this.defaultVal=s,this.triggerUpdate=a,this.onChange=l});function AC(n){var e=n.stateInit,r=e===void 0?function(){return{}}:e,i=n.props,s=i===void 0?{}:i,o=n.methods,a=o===void 0?{}:o,c=n.aliases,l=c===void 0?{}:c,u=n.init,d=u===void 0?function(){}:u,h=n.update,p=h===void 0?function(){}:h,g=Object.keys(s).map(function(y){return new Wye(y,s[y])});return function y(){for(var v=arguments.length,x=new Array(v),m=0;m<v;m++)x[m]=arguments[m];var b=!!(this instanceof y&&this.constructor),S=b?x.shift():void 0,w=x[0],I=w===void 0?{}:w,C=Object.assign({},r instanceof Function?r(I):r,{initialised:!1}),_={};function P(A){return M(A,I),T(),P}var M=function(R,O){d.call(P,R,C,O),C.initialised=!0},T=V8(function(){C.initialised&&(p.call(P,C,_),_={})},1);return g.forEach(function(A){P[A.name]=R(A);function R(O){var j=O.name,D=O.triggerUpdate,N=D===void 0?!1:D,F=O.onChange,z=F===void 0?function(X,ee){}:F,$=O.defaultVal,G=$===void 0?null:$;return function(X){var ee=C[j];if(!arguments.length)return ee;var re=X===void 0?G:X;return C[j]=re,z.call(P,re,C,ee),!_.hasOwnProperty(j)&&(_[j]=ee),N&&T(),P}}}),Object.keys(a).forEach(function(A){P[A]=function(){for(var R,O=arguments.length,j=new Array(O),D=0;D<O;D++)j[D]=arguments[D];return(R=a[A]).call.apply(R,[P,C].concat(j))}}),Object.entries(l).forEach(function(A){var R=Kye(A,2),O=R[0],j=R[1];return P[O]=P[j]}),P.resetProps=function(){return g.forEach(function(A){P[A.name](A.defaultVal)}),P},P.resetProps(),C._rerender=T,b&&S&&P(S),P}}var tt=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});function _h(n){"@babel/helpers - typeof";return _h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_h(n)}var Yye=/^\s+/,Xye=/\s+$/;function Te(n,e){if(n=n||"",e=e||{},n instanceof Te)return n;if(!(this instanceof Te))return new Te(n,e);var r=Zye(n);this._originalInput=n,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||r.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}Te.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),r,i,s,o,a,c;return r=e.r/255,i=e.g/255,s=e.b/255,r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),s<=.03928?c=s/12.92:c=Math.pow((s+.055)/1.055,2.4),.2126*o+.7152*a+.0722*c},setAlpha:function(e){return this._a=X8(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=gD(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=gD(this._r,this._g,this._b),r=Math.round(e.h*360),i=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?"hsv("+r+", "+i+"%, "+s+"%)":"hsva("+r+", "+i+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var e=pD(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=pD(this._r,this._g,this._b),r=Math.round(e.h*360),i=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?"hsl("+r+", "+i+"%, "+s+"%)":"hsla("+r+", "+i+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return mD(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return tve(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(St(this._r,255)*100)+"%",g:Math.round(St(this._g,255)*100)+"%",b:Math.round(St(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(St(this._r,255)*100)+"%, "+Math.round(St(this._g,255)*100)+"%, "+Math.round(St(this._b,255)*100)+"%)":"rgba("+Math.round(St(this._r,255)*100)+"%, "+Math.round(St(this._g,255)*100)+"%, "+Math.round(St(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:fve[mD(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var r="#"+yD(this._r,this._g,this._b,this._a),i=r,s=this._gradientType?"GradientType = 1, ":"";if(e){var o=Te(e);i="#"+yD(o._r,o._g,o._b,o._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+r+",endColorstr="+i+")"},toString:function(e){var r=!!e;e=e||this._format;var i=!1,s=this._a<1&&this._a>=0,o=!r&&s&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return o?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return Te(this.toString())},_applyModification:function(e,r){var i=e.apply(null,[this].concat([].slice.call(r)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(sve,arguments)},brighten:function(){return this._applyModification(ove,arguments)},darken:function(){return this._applyModification(ave,arguments)},desaturate:function(){return this._applyModification(nve,arguments)},saturate:function(){return this._applyModification(rve,arguments)},greyscale:function(){return this._applyModification(ive,arguments)},spin:function(){return this._applyModification(cve,arguments)},_applyCombination:function(e,r){return e.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(dve,arguments)},complement:function(){return this._applyCombination(lve,arguments)},monochromatic:function(){return this._applyCombination(hve,arguments)},splitcomplement:function(){return this._applyCombination(uve,arguments)},triad:function(){return this._applyCombination(vD,[3])},tetrad:function(){return this._applyCombination(vD,[4])}};Te.fromRatio=function(n,e){if(_h(n)=="object"){var r={};for(var i in n)n.hasOwnProperty(i)&&(i==="a"?r[i]=n[i]:r[i]=Xc(n[i]));n=r}return Te(n,e)};function Zye(n){var e={r:0,g:0,b:0},r=1,i=null,s=null,o=null,a=!1,c=!1;return typeof n=="string"&&(n=yve(n)),_h(n)=="object"&&(Li(n.r)&&Li(n.g)&&Li(n.b)?(e=Qye(n.r,n.g,n.b),a=!0,c=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Li(n.h)&&Li(n.s)&&Li(n.v)?(i=Xc(n.s),s=Xc(n.v),e=eve(n.h,i,s),a=!0,c="hsv"):Li(n.h)&&Li(n.s)&&Li(n.l)&&(i=Xc(n.s),o=Xc(n.l),e=Jye(n.h,i,o),a=!0,c="hsl"),n.hasOwnProperty("a")&&(r=n.a)),r=X8(r),{ok:a,format:n.format||c,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:r}}function Qye(n,e,r){return{r:St(n,255)*255,g:St(e,255)*255,b:St(r,255)*255}}function pD(n,e,r){n=St(n,255),e=St(e,255),r=St(r,255);var i=Math.max(n,e,r),s=Math.min(n,e,r),o,a,c=(i+s)/2;if(i==s)o=a=0;else{var l=i-s;switch(a=c>.5?l/(2-i-s):l/(i+s),i){case n:o=(e-r)/l+(e<r?6:0);break;case e:o=(r-n)/l+2;break;case r:o=(n-e)/l+4;break}o/=6}return{h:o,s:a,l:c}}function Jye(n,e,r){var i,s,o;n=St(n,360),e=St(e,100),r=St(r,100);function a(u,d,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(d-u)*6*h:h<1/2?d:h<2/3?u+(d-u)*(2/3-h)*6:u}if(e===0)i=s=o=r;else{var c=r<.5?r*(1+e):r+e-r*e,l=2*r-c;i=a(l,c,n+1/3),s=a(l,c,n),o=a(l,c,n-1/3)}return{r:i*255,g:s*255,b:o*255}}function gD(n,e,r){n=St(n,255),e=St(e,255),r=St(r,255);var i=Math.max(n,e,r),s=Math.min(n,e,r),o,a,c=i,l=i-s;if(a=i===0?0:l/i,i==s)o=0;else{switch(i){case n:o=(e-r)/l+(e<r?6:0);break;case e:o=(r-n)/l+2;break;case r:o=(n-e)/l+4;break}o/=6}return{h:o,s:a,v:c}}function eve(n,e,r){n=St(n,360)*6,e=St(e,100),r=St(r,100);var i=Math.floor(n),s=n-i,o=r*(1-e),a=r*(1-s*e),c=r*(1-(1-s)*e),l=i%6,u=[r,a,o,o,c,r][l],d=[c,r,r,a,o,o][l],h=[o,o,c,r,r,a][l];return{r:u*255,g:d*255,b:h*255}}function mD(n,e,r,i){var s=[Yr(Math.round(n).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(r).toString(16))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function tve(n,e,r,i,s){var o=[Yr(Math.round(n).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(r).toString(16)),Yr(Z8(i))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function yD(n,e,r,i){var s=[Yr(Z8(i)),Yr(Math.round(n).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(r).toString(16))];return s.join("")}Te.equals=function(n,e){return!n||!e?!1:Te(n).toRgbString()==Te(e).toRgbString()};Te.random=function(){return Te.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function nve(n,e){e=e===0?0:e||10;var r=Te(n).toHsl();return r.s-=e/100,r.s=Vf(r.s),Te(r)}function rve(n,e){e=e===0?0:e||10;var r=Te(n).toHsl();return r.s+=e/100,r.s=Vf(r.s),Te(r)}function ive(n){return Te(n).desaturate(100)}function sve(n,e){e=e===0?0:e||10;var r=Te(n).toHsl();return r.l+=e/100,r.l=Vf(r.l),Te(r)}function ove(n,e){e=e===0?0:e||10;var r=Te(n).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(e/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(e/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(e/100)))),Te(r)}function ave(n,e){e=e===0?0:e||10;var r=Te(n).toHsl();return r.l-=e/100,r.l=Vf(r.l),Te(r)}function cve(n,e){var r=Te(n).toHsl(),i=(r.h+e)%360;return r.h=i<0?360+i:i,Te(r)}function lve(n){var e=Te(n).toHsl();return e.h=(e.h+180)%360,Te(e)}function vD(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var r=Te(n).toHsl(),i=[Te(n)],s=360/e,o=1;o<e;o++)i.push(Te({h:(r.h+o*s)%360,s:r.s,l:r.l}));return i}function uve(n){var e=Te(n).toHsl(),r=e.h;return[Te(n),Te({h:(r+72)%360,s:e.s,l:e.l}),Te({h:(r+216)%360,s:e.s,l:e.l})]}function dve(n,e,r){e=e||6,r=r||30;var i=Te(n).toHsl(),s=360/r,o=[Te(n)];for(i.h=(i.h-(s*e>>1)+720)%360;--e;)i.h=(i.h+s)%360,o.push(Te(i));return o}function hve(n,e){e=e||6;for(var r=Te(n).toHsv(),i=r.h,s=r.s,o=r.v,a=[],c=1/e;e--;)a.push(Te({h:i,s,v:o})),o=(o+c)%1;return a}Te.mix=function(n,e,r){r=r===0?0:r||50;var i=Te(n).toRgb(),s=Te(e).toRgb(),o=r/100,a={r:(s.r-i.r)*o+i.r,g:(s.g-i.g)*o+i.g,b:(s.b-i.b)*o+i.b,a:(s.a-i.a)*o+i.a};return Te(a)};Te.readability=function(n,e){var r=Te(n),i=Te(e);return(Math.max(r.getLuminance(),i.getLuminance())+.05)/(Math.min(r.getLuminance(),i.getLuminance())+.05)};Te.isReadable=function(n,e,r){var i=Te.readability(n,e),s,o;switch(o=!1,s=vve(r),s.level+s.size){case"AAsmall":case"AAAlarge":o=i>=4.5;break;case"AAlarge":o=i>=3;break;case"AAAsmall":o=i>=7;break}return o};Te.mostReadable=function(n,e,r){var i=null,s=0,o,a,c,l;r=r||{},a=r.includeFallbackColors,c=r.level,l=r.size;for(var u=0;u<e.length;u++)o=Te.readability(n,e[u]),o>s&&(s=o,i=Te(e[u]));return Te.isReadable(n,i,{level:c,size:l})||!a?i:(r.includeFallbackColors=!1,Te.mostReadable(n,["#fff","#000"],r))};var Jw=Te.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},fve=Te.hexNames=pve(Jw);function pve(n){var e={};for(var r in n)n.hasOwnProperty(r)&&(e[n[r]]=r);return e}function X8(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function St(n,e){gve(n)&&(n="100%");var r=mve(n);return n=Math.min(e,Math.max(0,parseFloat(n))),r&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Vf(n){return Math.min(1,Math.max(0,n))}function nr(n){return parseInt(n,16)}function gve(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function mve(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Yr(n){return n.length==1?"0"+n:""+n}function Xc(n){return n<=1&&(n=n*100+"%"),n}function Z8(n){return Math.round(parseFloat(n)*255).toString(16)}function xD(n){return nr(n)/255}var $r=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",r="(?:"+e+")|(?:"+n+")",i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",s="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{CSS_UNIT:new RegExp(r),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function Li(n){return!!$r.CSS_UNIT.exec(n)}function yve(n){n=n.replace(Yye,"").replace(Xye,"").toLowerCase();var e=!1;if(Jw[n])n=Jw[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=$r.rgb.exec(n))?{r:r[1],g:r[2],b:r[3]}:(r=$r.rgba.exec(n))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=$r.hsl.exec(n))?{h:r[1],s:r[2],l:r[3]}:(r=$r.hsla.exec(n))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=$r.hsv.exec(n))?{h:r[1],s:r[2],v:r[3]}:(r=$r.hsva.exec(n))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=$r.hex8.exec(n))?{r:nr(r[1]),g:nr(r[2]),b:nr(r[3]),a:xD(r[4]),format:e?"name":"hex8"}:(r=$r.hex6.exec(n))?{r:nr(r[1]),g:nr(r[2]),b:nr(r[3]),format:e?"name":"hex"}:(r=$r.hex4.exec(n))?{r:nr(r[1]+""+r[1]),g:nr(r[2]+""+r[2]),b:nr(r[3]+""+r[3]),a:xD(r[4]+""+r[4]),format:e?"name":"hex8"}:(r=$r.hex3.exec(n))?{r:nr(r[1]+""+r[1]),g:nr(r[2]+""+r[2]),b:nr(r[3]+""+r[3]),format:e?"name":"hex"}:!1}function vve(n){var e,r;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),r=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),r!=="small"&&r!=="large"&&(r="small"),{level:e,size:r}}function e1(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function xve(n){if(Array.isArray(n))return e1(n)}function Q8(n,e,r){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:r;throw new TypeError("Private element is not present on this object")}function bve(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Sve(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function xr(n,e){return n.get(Q8(n,e))}function bD(n,e,r){bve(n,e),e.set(n,r)}function SD(n,e,r){return n.set(Q8(n,e),r),r}function wve(n,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,kve(i.key),i)}}function _ve(n,e,r){return e&&wve(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Cve(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Pve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ive(n){return xve(n)||Cve(n)||Tve(n)||Pve()}function Eve(n,e){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function kve(n){var e=Eve(n,"string");return typeof e=="symbol"?e:e+""}function Tve(n,e){if(n){if(typeof n=="string")return e1(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e1(n,e):void 0}}var Mve=123,Ave=function(e){return"#".concat(Math.min(e,Math.pow(2,24)).toString(16).padStart(6,"0"))},J8=function(e,r,i){return(e<<16)+(r<<8)+i},jve=function(e){var r=Te(e).toRgb(),i=r.r,s=r.g,o=r.b;return J8(i,s,o)},wD=function(e,r){return e*Mve%Math.pow(2,r)},io=new WeakMap,Fi=new WeakMap,Rve=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6;Sve(this,n),bD(this,io,void 0),bD(this,Fi,void 0),SD(Fi,this,e),this.reset()}return _ve(n,[{key:"reset",value:function(){SD(io,this,["__reserved for background__"])}},{key:"register",value:function(r){if(xr(io,this).length>=Math.pow(2,24-xr(Fi,this)))return null;var i=xr(io,this).length,s=wD(i,xr(Fi,this)),o=Ave(i+(s<<24-xr(Fi,this)));return xr(io,this).push(r),o}},{key:"lookup",value:function(r){if(!r)return null;var i=typeof r=="string"?jve(r):J8.apply(void 0,Ive(r));if(!i)return null;var s=i&Math.pow(2,24-xr(Fi,this))-1,o=i>>24-xr(Fi,this)&Math.pow(2,xr(Fi,this))-1;return wD(s,xr(Fi,this))!==o||s>=xr(io,this).length?null:xr(io,this)[s]}}])})(),mu,wt,eB,tB,ao,_D,nB,rB,iB,jC,t1,n1,Nl={},sB=[],Ove=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Wf=Array.isArray;function pi(n,e){for(var r in e)n[r]=e[r];return n}function RC(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Dve(n,e,r){var i,s,o,a={};for(o in e)o=="key"?i=e[o]:o=="ref"?s=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?mu.call(arguments,2):r),typeof n=="function"&&n.defaultProps!=null)for(o in n.defaultProps)a[o]===void 0&&(a[o]=n.defaultProps[o]);return cl(n,a,i,s,null)}function cl(n,e,r,i,s){var o={type:n,props:e,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++eB,__i:-1,__u:0};return s==null&&wt.vnode!=null&&wt.vnode(o),o}function Yf(n){return n.children}function Rd(n,e){this.props=n,this.context=e}function Na(n,e){if(e==null)return n.__?Na(n.__,n.__i+1):null;for(var r;e<n.__k.length;e++)if((r=n.__k[e])!=null&&r.__e!=null)return r.__e;return typeof n.type=="function"?Na(n):null}function oB(n){var e,r;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((r=n.__k[e])!=null&&r.__e!=null){n.__e=n.__c.base=r.__e;break}return oB(n)}}function CD(n){(!n.__d&&(n.__d=!0)&&ao.push(n)&&!Ch.__r++||_D!=wt.debounceRendering)&&((_D=wt.debounceRendering)||nB)(Ch)}function Ch(){for(var n,e,r,i,s,o,a,c=1;ao.length;)ao.length>c&&ao.sort(rB),n=ao.shift(),c=ao.length,n.__d&&(r=void 0,i=void 0,s=(i=(e=n).__v).__e,o=[],a=[],e.__P&&((r=pi({},i)).__v=i.__v+1,wt.vnode&&wt.vnode(r),OC(e.__P,r,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,o,s??Na(i),!!(32&i.__u),a),r.__v=i.__v,r.__.__k[r.__i]=r,lB(o,r,a),i.__e=i.__=null,r.__e!=s&&oB(r)));Ch.__r=0}function aB(n,e,r,i,s,o,a,c,l,u,d){var h,p,g,y,v,x,m,b=i&&i.__k||sB,S=e.length;for(l=Nve(r,e,b,l,S),h=0;h<S;h++)(g=r.__k[h])!=null&&(p=g.__i==-1?Nl:b[g.__i]||Nl,g.__i=h,x=OC(n,g,p,s,o,a,c,l,u,d),y=g.__e,g.ref&&p.ref!=g.ref&&(p.ref&&DC(p.ref,null,g),d.push(g.ref,g.__c||y,g)),v==null&&y!=null&&(v=y),(m=!!(4&g.__u))||p.__k===g.__k?l=cB(g,l,n,m):typeof g.type=="function"&&x!==void 0?l=x:y&&(l=y.nextSibling),g.__u&=-7);return r.__e=v,l}function Nve(n,e,r,i,s){var o,a,c,l,u,d=r.length,h=d,p=0;for(n.__k=new Array(s),o=0;o<s;o++)(a=e[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=n.__k[o]=cl(null,a,null,null,null):Wf(a)?a=n.__k[o]=cl(Yf,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=n.__k[o]=cl(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):n.__k[o]=a,l=o+p,a.__=n,a.__b=n.__b+1,c=null,(u=a.__i=Lve(a,r,l,h))!=-1&&(h--,(c=r[u])&&(c.__u|=2)),c==null||c.__v==null?(u==-1&&(s>d?p--:s<d&&p++),typeof a.type!="function"&&(a.__u|=4)):u!=l&&(u==l-1?p--:u==l+1?p++:(u>l?p--:p++,a.__u|=4))):n.__k[o]=null;if(h)for(o=0;o<d;o++)(c=r[o])!=null&&(2&c.__u)==0&&(c.__e==i&&(i=Na(c)),dB(c,c));return i}function cB(n,e,r,i){var s,o;if(typeof n.type=="function"){for(s=n.__k,o=0;s&&o<s.length;o++)s[o]&&(s[o].__=n,e=cB(s[o],e,r,i));return e}n.__e!=e&&(i&&(e&&n.type&&!e.parentNode&&(e=Na(n)),r.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Lve(n,e,r,i){var s,o,a,c=n.key,l=n.type,u=e[r],d=u!=null&&(2&u.__u)==0;if(u===null&&c==null||d&&c==u.key&&l==u.type)return r;if(i>(d?1:0)){for(s=r-1,o=r+1;s>=0||o<e.length;)if((u=e[a=s>=0?s--:o++])!=null&&(2&u.__u)==0&&c==u.key&&l==u.type)return a}return-1}function PD(n,e,r){e[0]=="-"?n.setProperty(e,r??""):n[e]=r==null?"":typeof r!="number"||Ove.test(e)?r:r+"px"}function gd(n,e,r,i,s){var o,a;e:if(e=="style")if(typeof r=="string")n.style.cssText=r;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)r&&e in r||PD(n.style,e,"");if(r)for(e in r)i&&r[e]==i[e]||PD(n.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(iB,"$1")),a=e.toLowerCase(),e=a in n||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+o]=r,r?i?r.u=i.u:(r.u=jC,n.addEventListener(e,o?n1:t1,o)):n.removeEventListener(e,o?n1:t1,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&r==1?"":r))}}function ID(n){return function(e){if(this.l){var r=this.l[e.type+n];if(e.t==null)e.t=jC++;else if(e.t<r.u)return;return r(wt.event?wt.event(e):e)}}}function OC(n,e,r,i,s,o,a,c,l,u){var d,h,p,g,y,v,x,m,b,S,w,I,C,_,P,M,T,A=e.type;if(e.constructor!==void 0)return null;128&r.__u&&(l=!!(32&r.__u),o=[c=e.__e=r.__e]),(d=wt.__b)&&d(e);e:if(typeof A=="function")try{if(m=e.props,b="prototype"in A&&A.prototype.render,S=(d=A.contextType)&&i[d.__c],w=d?S?S.props.value:d.__:i,r.__c?x=(h=e.__c=r.__c).__=h.__E:(b?e.__c=h=new A(m,w):(e.__c=h=new Rd(m,w),h.constructor=A,h.render=zve),S&&S.sub(h),h.state||(h.state={}),h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),b&&h.__s==null&&(h.__s=h.state),b&&A.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=pi({},h.__s)),pi(h.__s,A.getDerivedStateFromProps(m,h.__s))),g=h.props,y=h.state,h.__v=e,p)b&&A.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),b&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(b&&A.getDerivedStateFromProps==null&&m!==g&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(m,w),e.__v==r.__v||!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(m,h.__s,w)===!1){for(e.__v!=r.__v&&(h.props=m,h.state=h.__s,h.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(R){R&&(R.__=e)}),I=0;I<h._sb.length;I++)h.__h.push(h._sb[I]);h._sb=[],h.__h.length&&a.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(m,h.__s,w),b&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(g,y,v)})}if(h.context=w,h.props=m,h.__P=n,h.__e=!1,C=wt.__r,_=0,b){for(h.state=h.__s,h.__d=!1,C&&C(e),d=h.render(h.props,h.state,h.context),P=0;P<h._sb.length;P++)h.__h.push(h._sb[P]);h._sb=[]}else do h.__d=!1,C&&C(e),d=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++_<25);h.state=h.__s,h.getChildContext!=null&&(i=pi(pi({},i),h.getChildContext())),b&&!p&&h.getSnapshotBeforeUpdate!=null&&(v=h.getSnapshotBeforeUpdate(g,y)),M=d,d!=null&&d.type===Yf&&d.key==null&&(M=uB(d.props.children)),c=aB(n,Wf(M)?M:[M],e,r,i,s,o,a,c,l,u),h.base=e.__e,e.__u&=-161,h.__h.length&&a.push(h),x&&(h.__E=h.__=null)}catch(R){if(e.__v=null,l||o!=null)if(R.then){for(e.__u|=l?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;o[o.indexOf(c)]=null,e.__e=c}else{for(T=o.length;T--;)RC(o[T]);r1(e)}else e.__e=r.__e,e.__k=r.__k,R.then||r1(e);wt.__e(R,e,r)}else o==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):c=e.__e=Fve(r.__e,e,r,i,s,o,a,l,u);return(d=wt.diffed)&&d(e),128&e.__u?void 0:c}function r1(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(r1)}function lB(n,e,r){for(var i=0;i<r.length;i++)DC(r[i],r[++i],r[++i]);wt.__c&&wt.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(o){o.call(s)})}catch(o){wt.__e(o,s.__v)}})}function uB(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:Wf(n)?n.map(uB):pi({},n)}function Fve(n,e,r,i,s,o,a,c,l){var u,d,h,p,g,y,v,x=r.props||Nl,m=e.props,b=e.type;if(b=="svg"?s="http://www.w3.org/2000/svg":b=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(u=0;u<o.length;u++)if((g=o[u])&&"setAttribute"in g==!!b&&(b?g.localName==b:g.nodeType==3)){n=g,o[u]=null;break}}if(n==null){if(b==null)return document.createTextNode(m);n=document.createElementNS(s,b,m.is&&m),c&&(wt.__m&&wt.__m(e,o),c=!1),o=null}if(b==null)x===m||c&&n.data==m||(n.data=m);else{if(o=o&&mu.call(n.childNodes),!c&&o!=null)for(x={},u=0;u<n.attributes.length;u++)x[(g=n.attributes[u]).name]=g.value;for(u in x)if(g=x[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=g;else if(!(u in m)){if(u=="value"&&"defaultValue"in m||u=="checked"&&"defaultChecked"in m)continue;gd(n,u,null,g,s)}}for(u in m)g=m[u],u=="children"?p=g:u=="dangerouslySetInnerHTML"?d=g:u=="value"?y=g:u=="checked"?v=g:c&&typeof g!="function"||x[u]===g||gd(n,u,g,x[u],s);if(d)c||h&&(d.__html==h.__html||d.__html==n.innerHTML)||(n.innerHTML=d.__html),e.__k=[];else if(h&&(n.innerHTML=""),aB(e.type=="template"?n.content:n,Wf(p)?p:[p],e,r,i,b=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,a,o?o[0]:r.__k&&Na(r,0),c,l),o!=null)for(u=o.length;u--;)RC(o[u]);c||(u="value",b=="progress"&&y==null?n.removeAttribute("value"):y!=null&&(y!==n[u]||b=="progress"&&!y||b=="option"&&y!=x[u])&&gd(n,u,y,x[u],s),u="checked",v!=null&&v!=n[u]&&gd(n,u,v,x[u],s))}return n}function DC(n,e,r){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){wt.__e(s,r)}}function dB(n,e,r){var i,s;if(wt.unmount&&wt.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||DC(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){wt.__e(o,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&dB(i[s],e,r||typeof n.type!="function");r||RC(n.__e),n.__c=n.__=n.__e=void 0}function zve(n,e,r){return this.constructor(n,r)}function $ve(n,e,r){var i,s,o,a;e==document&&(e=document.documentElement),wt.__&&wt.__(n,e),s=(i=!1)?null:e.__k,o=[],a=[],OC(e,n=e.__k=Dve(Yf,null,[n]),s||Nl,Nl,e.namespaceURI,s?null:e.firstChild?mu.call(e.childNodes):null,o,s?s.__e:e.firstChild,i,a),lB(o,n,a)}function hB(n,e,r){var i,s,o,a,c=pi({},n.props);for(o in n.type&&n.type.defaultProps&&(a=n.type.defaultProps),e)o=="key"?i=e[o]:o=="ref"?s=e[o]:c[o]=e[o]===void 0&&a!=null?a[o]:e[o];return arguments.length>2&&(c.children=arguments.length>3?mu.call(arguments,2):r),cl(n.type,c,i||n.key,s||n.ref,null)}mu=sB.slice,wt={__e:function(n,e,r,i){for(var s,o,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(n)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),a=s.__d),a)return s.__E=s}catch(c){n=c}throw n}},eB=0,tB=function(n){return n!=null&&n.constructor===void 0},Rd.prototype.setState=function(n,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=pi({},this.state),typeof n=="function"&&(n=n(pi({},r),this.props)),n&&pi(r,n),n!=null&&this.__v&&(e&&this._sb.push(e),CD(this))},Rd.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),CD(this))},Rd.prototype.render=Yf,ao=[],nB=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,rB=function(n,e){return n.__v.__b-e.__v.__b},Ch.__r=0,iB=/(PointerCapture)$|Capture$/i,jC=0,t1=ID(!1),n1=ID(!0);function ED(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function Bve(n){if(Array.isArray(n))return n}function Uve(n,e,r){return(e=Wve(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function qve(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e!==0)for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function Hve(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kD(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,i)}return r}function Gve(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kD(Object(r),!0).forEach(function(i){Uve(n,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):kD(Object(r)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(r,i))})}return n}function Kve(n,e){return Bve(n)||qve(n,e)||Yve(n,e)||Hve()}function Vve(n,e){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Wve(n){var e=Vve(n,"string");return typeof e=="symbol"?e:e+""}function Ph(n){"@babel/helpers - typeof";return Ph=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ph(n)}function Yve(n,e){if(n){if(typeof n=="string")return ED(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ED(n,e):void 0}}var i1=function(e){if(Ph(e)!=="object")return e;var r=hB(e);if(r.props){var i;r.props=Gve({},r.props),r!=null&&(i=r.props)!==null&&i!==void 0&&i.children&&(r.props.children=Array.isArray(r.props.children)?r.props.children.map(i1):i1(r.props.children))}return r},Xve=function(e){return tB(hB(e))},Zve=function(e,r){delete r.__k,$ve(i1(e),r)};function Qve(n,e){e===void 0&&(e={});var r=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}var Jve=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;Qve(Jve);var e0e=AC({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.style,o=s===void 0?{}:s,a=!!e&&Ph(e)==="object"&&!!e.node&&typeof e.node=="function",c=xn(a?e.node():e);c.style("position")==="static"&&c.style("position","relative"),r.tooltipEl=c.append("div").attr("class","float-tooltip-kap"),Object.entries(o).forEach(function(u){var d=Kve(u,2),h=d[0],p=d[1];return r.tooltipEl.style(h,p)}),r.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));r.mouseInside=!1,c.on("mousemove.".concat(l),function(u){r.mouseInside=!0;var d=Sr(u),h=c.node(),p=h.offsetWidth,g=h.offsetHeight,y=[r.offsetX===null||r.offsetX===void 0?"-".concat(d[0]/p*100,"%"):typeof r.offsetX=="number"?"calc(-50% + ".concat(r.offsetX,"px)"):r.offsetX,r.offsetY===null||r.offsetY===void 0?g>130&&g-d[1]<100?"calc(-100% - 6px)":"21px":typeof r.offsetY=="number"?r.offsetY<0?"calc(-100% - ".concat(Math.abs(r.offsetY),"px)"):"".concat(r.offsetY,"px"):r.offsetY];r.tooltipEl.style("left",d[0]+"px").style("top",d[1]+"px").style("transform","translate(".concat(y.join(","),")")),r.content&&r.tooltipEl.style("display","inline")}),c.on("mouseover.".concat(l),function(){r.mouseInside=!0,r.content&&r.tooltipEl.style("display","inline")}),c.on("mouseout.".concat(l),function(){r.mouseInside=!1,r.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):Xve(e.content)?(e.tooltipEl.text(""),Zve(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function t0e(n,e,r){var i,s=1;n==null&&(n=0),e==null&&(e=0),r==null&&(r=0);function o(){var a,c=i.length,l,u=0,d=0,h=0;for(a=0;a<c;++a)l=i[a],u+=l.x||0,d+=l.y||0,h+=l.z||0;for(u=(u/c-n)*s,d=(d/c-e)*s,h=(h/c-r)*s,a=0;a<c;++a)l=i[a],u&&(l.x-=u),d&&(l.y-=d),h&&(l.z-=h)}return o.initialize=function(a){i=a},o.x=function(a){return arguments.length?(n=+a,o):n},o.y=function(a){return arguments.length?(e=+a,o):e},o.z=function(a){return arguments.length?(r=+a,o):r},o.strength=function(a){return arguments.length?(s=+a,o):s},o}function n0e(n){const e=+this._x.call(null,n);return fB(this.cover(e),e,n)}function fB(n,e,r){if(isNaN(e))return n;var i,s=n._root,o={data:r},a=n._x0,c=n._x1,l,u,d,h,p;if(!s)return n._root=o,n;for(;s.length;)if((d=e>=(l=(a+c)/2))?a=l:c=l,i=s,!(s=s[h=+d]))return i[h]=o,n;if(u=+n._x.call(null,s.data),e===u)return o.next=s,i?i[h]=o:n._root=o,n;do i=i?i[h]=new Array(2):n._root=new Array(2),(d=e>=(l=(a+c)/2))?a=l:c=l;while((h=+d)==(p=+(u>=l)));return i[p]=s,i[h]=o,n}function r0e(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,r=new Float64Array(e);let i=1/0,s=-1/0;for(let o=0,a;o<e;++o)isNaN(a=+this._x.call(null,n[o]))||(r[o]=a,a<i&&(i=a),a>s&&(s=a));if(i>s)return this;this.cover(i).cover(s);for(let o=0;o<e;++o)fB(this,r[o],n[o]);return this}function i0e(n){if(isNaN(n=+n))return this;var e=this._x0,r=this._x1;if(isNaN(e))r=(e=Math.floor(n))+1;else{for(var i=r-e||1,s=this._root,o,a;e>n||n>=r;)switch(a=+(n<e),o=new Array(2),o[a]=s,s=o,i*=2,a){case 0:r=e+i;break;case 1:e=r-i;break}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._x1=r,this}function s0e(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function o0e(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Qi(n,e,r){this.node=n,this.x0=e,this.x1=r}function a0e(n,e){var r,i=this._x0,s,o,a=this._x1,c=[],l=this._root,u,d;for(l&&c.push(new Qi(l,i,a)),e==null?e=1/0:(i=n-e,a=n+e);u=c.pop();)if(!(!(l=u.node)||(s=u.x0)>a||(o=u.x1)<i))if(l.length){var h=(s+o)/2;c.push(new Qi(l[1],h,o),new Qi(l[0],s,h)),(d=+(n>=h))&&(u=c[c.length-1],c[c.length-1]=c[c.length-1-d],c[c.length-1-d]=u)}else{var p=Math.abs(n-+this._x.call(null,l.data));p<e&&(e=p,i=n-p,a=n+p,r=l.data)}return r}function c0e(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,r=this._root,i,s,o,a=this._x0,c=this._x1,l,u,d,h,p;if(!r)return this;if(r.length)for(;;){if((d=l>=(u=(a+c)/2))?a=u:c=u,e=r,!(r=r[h=+d]))return this;if(!r.length)break;e[h+1&1]&&(i=e,p=h)}for(;r.data!==n;)if(s=r,!(r=r.next))return this;return(o=r.next)&&delete r.next,s?(o?s.next=o:delete s.next,this):e?(o?e[h]=o:delete e[h],(r=e[0]||e[1])&&r===(e[1]||e[0])&&!r.length&&(i?i[p]=r:this._root=r),this):(this._root=o,this)}function l0e(n){for(var e=0,r=n.length;e<r;++e)this.remove(n[e]);return this}function u0e(){return this._root}function d0e(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function h0e(n){var e=[],r,i=this._root,s,o,a;for(i&&e.push(new Qi(i,this._x0,this._x1));r=e.pop();)if(!n(i=r.node,o=r.x0,a=r.x1)&&i.length){var c=(o+a)/2;(s=i[1])&&e.push(new Qi(s,c,a)),(s=i[0])&&e.push(new Qi(s,o,c))}return this}function f0e(n){var e=[],r=[],i;for(this._root&&e.push(new Qi(this._root,this._x0,this._x1));i=e.pop();){var s=i.node;if(s.length){var o,a=i.x0,c=i.x1,l=(a+c)/2;(o=s[0])&&e.push(new Qi(o,a,l)),(o=s[1])&&e.push(new Qi(o,l,c))}r.push(i)}for(;i=r.pop();)n(i.node,i.x0,i.x1);return this}function p0e(n){return n[0]}function g0e(n){return arguments.length?(this._x=n,this):this._x}function pB(n,e){var r=new NC(e??p0e,NaN,NaN);return n==null?r:r.addAll(n)}function NC(n,e,r){this._x=n,this._x0=e,this._x1=r,this._root=void 0}function TD(n){for(var e={data:n.data},r=e;n=n.next;)r=r.next={data:n.data};return e}var Jn=pB.prototype=NC.prototype;Jn.copy=function(){var n=new NC(this._x,this._x0,this._x1),e=this._root,r,i;if(!e)return n;if(!e.length)return n._root=TD(e),n;for(r=[{source:e,target:n._root=new Array(2)}];e=r.pop();)for(var s=0;s<2;++s)(i=e.source[s])&&(i.length?r.push({source:i,target:e.target[s]=new Array(2)}):e.target[s]=TD(i));return n};Jn.add=n0e;Jn.addAll=r0e;Jn.cover=i0e;Jn.data=s0e;Jn.extent=o0e;Jn.find=a0e;Jn.remove=c0e;Jn.removeAll=l0e;Jn.root=u0e;Jn.size=d0e;Jn.visit=h0e;Jn.visitAfter=f0e;Jn.x=g0e;function m0e(n){const e=+this._x.call(null,n),r=+this._y.call(null,n);return gB(this.cover(e,r),e,r,n)}function gB(n,e,r,i){if(isNaN(e)||isNaN(r))return n;var s,o=n._root,a={data:i},c=n._x0,l=n._y0,u=n._x1,d=n._y1,h,p,g,y,v,x,m,b;if(!o)return n._root=a,n;for(;o.length;)if((v=e>=(h=(c+u)/2))?c=h:u=h,(x=r>=(p=(l+d)/2))?l=p:d=p,s=o,!(o=o[m=x<<1|v]))return s[m]=a,n;if(g=+n._x.call(null,o.data),y=+n._y.call(null,o.data),e===g&&r===y)return a.next=o,s?s[m]=a:n._root=a,n;do s=s?s[m]=new Array(4):n._root=new Array(4),(v=e>=(h=(c+u)/2))?c=h:u=h,(x=r>=(p=(l+d)/2))?l=p:d=p;while((m=x<<1|v)===(b=(y>=p)<<1|g>=h));return s[b]=o,s[m]=a,n}function y0e(n){var e,r,i=n.length,s,o,a=new Array(i),c=new Array(i),l=1/0,u=1/0,d=-1/0,h=-1/0;for(r=0;r<i;++r)isNaN(s=+this._x.call(null,e=n[r]))||isNaN(o=+this._y.call(null,e))||(a[r]=s,c[r]=o,s<l&&(l=s),s>d&&(d=s),o<u&&(u=o),o>h&&(h=o));if(l>d||u>h)return this;for(this.cover(l,u).cover(d,h),r=0;r<i;++r)gB(this,a[r],c[r],n[r]);return this}function v0e(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var r=this._x0,i=this._y0,s=this._x1,o=this._y1;if(isNaN(r))s=(r=Math.floor(n))+1,o=(i=Math.floor(e))+1;else{for(var a=s-r||1,c=this._root,l,u;r>n||n>=s||i>e||e>=o;)switch(u=(e<i)<<1|n<r,l=new Array(4),l[u]=c,c=l,a*=2,u){case 0:s=r+a,o=i+a;break;case 1:r=s-a,o=i+a;break;case 2:s=r+a,i=o-a;break;case 3:r=s-a,i=o-a;break}this._root&&this._root.length&&(this._root=c)}return this._x0=r,this._y0=i,this._x1=s,this._y1=o,this}function x0e(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function b0e(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Tn(n,e,r,i,s){this.node=n,this.x0=e,this.y0=r,this.x1=i,this.y1=s}function S0e(n,e,r){var i,s=this._x0,o=this._y0,a,c,l,u,d=this._x1,h=this._y1,p=[],g=this._root,y,v;for(g&&p.push(new Tn(g,s,o,d,h)),r==null?r=1/0:(s=n-r,o=e-r,d=n+r,h=e+r,r*=r);y=p.pop();)if(!(!(g=y.node)||(a=y.x0)>d||(c=y.y0)>h||(l=y.x1)<s||(u=y.y1)<o))if(g.length){var x=(a+l)/2,m=(c+u)/2;p.push(new Tn(g[3],x,m,l,u),new Tn(g[2],a,m,x,u),new Tn(g[1],x,c,l,m),new Tn(g[0],a,c,x,m)),(v=(e>=m)<<1|n>=x)&&(y=p[p.length-1],p[p.length-1]=p[p.length-1-v],p[p.length-1-v]=y)}else{var b=n-+this._x.call(null,g.data),S=e-+this._y.call(null,g.data),w=b*b+S*S;if(w<r){var I=Math.sqrt(r=w);s=n-I,o=e-I,d=n+I,h=e+I,i=g.data}}return i}function w0e(n){if(isNaN(d=+this._x.call(null,n))||isNaN(h=+this._y.call(null,n)))return this;var e,r=this._root,i,s,o,a=this._x0,c=this._y0,l=this._x1,u=this._y1,d,h,p,g,y,v,x,m;if(!r)return this;if(r.length)for(;;){if((y=d>=(p=(a+l)/2))?a=p:l=p,(v=h>=(g=(c+u)/2))?c=g:u=g,e=r,!(r=r[x=v<<1|y]))return this;if(!r.length)break;(e[x+1&3]||e[x+2&3]||e[x+3&3])&&(i=e,m=x)}for(;r.data!==n;)if(s=r,!(r=r.next))return this;return(o=r.next)&&delete r.next,s?(o?s.next=o:delete s.next,this):e?(o?e[x]=o:delete e[x],(r=e[0]||e[1]||e[2]||e[3])&&r===(e[3]||e[2]||e[1]||e[0])&&!r.length&&(i?i[m]=r:this._root=r),this):(this._root=o,this)}function _0e(n){for(var e=0,r=n.length;e<r;++e)this.remove(n[e]);return this}function C0e(){return this._root}function P0e(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function I0e(n){var e=[],r,i=this._root,s,o,a,c,l;for(i&&e.push(new Tn(i,this._x0,this._y0,this._x1,this._y1));r=e.pop();)if(!n(i=r.node,o=r.x0,a=r.y0,c=r.x1,l=r.y1)&&i.length){var u=(o+c)/2,d=(a+l)/2;(s=i[3])&&e.push(new Tn(s,u,d,c,l)),(s=i[2])&&e.push(new Tn(s,o,d,u,l)),(s=i[1])&&e.push(new Tn(s,u,a,c,d)),(s=i[0])&&e.push(new Tn(s,o,a,u,d))}return this}function E0e(n){var e=[],r=[],i;for(this._root&&e.push(new Tn(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var s=i.node;if(s.length){var o,a=i.x0,c=i.y0,l=i.x1,u=i.y1,d=(a+l)/2,h=(c+u)/2;(o=s[0])&&e.push(new Tn(o,a,c,d,h)),(o=s[1])&&e.push(new Tn(o,d,c,l,h)),(o=s[2])&&e.push(new Tn(o,a,h,d,u)),(o=s[3])&&e.push(new Tn(o,d,h,l,u))}r.push(i)}for(;i=r.pop();)n(i.node,i.x0,i.y0,i.x1,i.y1);return this}function k0e(n){return n[0]}function T0e(n){return arguments.length?(this._x=n,this):this._x}function M0e(n){return n[1]}function A0e(n){return arguments.length?(this._y=n,this):this._y}function mB(n,e,r){var i=new LC(e??k0e,r??M0e,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function LC(n,e,r,i,s,o){this._x=n,this._y=e,this._x0=r,this._y0=i,this._x1=s,this._y1=o,this._root=void 0}function MD(n){for(var e={data:n.data},r=e;n=n.next;)r=r.next={data:n.data};return e}var Dn=mB.prototype=LC.prototype;Dn.copy=function(){var n=new LC(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,r,i;if(!e)return n;if(!e.length)return n._root=MD(e),n;for(r=[{source:e,target:n._root=new Array(4)}];e=r.pop();)for(var s=0;s<4;++s)(i=e.source[s])&&(i.length?r.push({source:i,target:e.target[s]=new Array(4)}):e.target[s]=MD(i));return n};Dn.add=m0e;Dn.addAll=y0e;Dn.cover=v0e;Dn.data=x0e;Dn.extent=b0e;Dn.find=S0e;Dn.remove=w0e;Dn.removeAll=_0e;Dn.root=C0e;Dn.size=P0e;Dn.visit=I0e;Dn.visitAfter=E0e;Dn.x=T0e;Dn.y=A0e;function j0e(n){const e=+this._x.call(null,n),r=+this._y.call(null,n),i=+this._z.call(null,n);return yB(this.cover(e,r,i),e,r,i,n)}function yB(n,e,r,i,s){if(isNaN(e)||isNaN(r)||isNaN(i))return n;var o,a=n._root,c={data:s},l=n._x0,u=n._y0,d=n._z0,h=n._x1,p=n._y1,g=n._z1,y,v,x,m,b,S,w,I,C,_,P;if(!a)return n._root=c,n;for(;a.length;)if((w=e>=(y=(l+h)/2))?l=y:h=y,(I=r>=(v=(u+p)/2))?u=v:p=v,(C=i>=(x=(d+g)/2))?d=x:g=x,o=a,!(a=a[_=C<<2|I<<1|w]))return o[_]=c,n;if(m=+n._x.call(null,a.data),b=+n._y.call(null,a.data),S=+n._z.call(null,a.data),e===m&&r===b&&i===S)return c.next=a,o?o[_]=c:n._root=c,n;do o=o?o[_]=new Array(8):n._root=new Array(8),(w=e>=(y=(l+h)/2))?l=y:h=y,(I=r>=(v=(u+p)/2))?u=v:p=v,(C=i>=(x=(d+g)/2))?d=x:g=x;while((_=C<<2|I<<1|w)===(P=(S>=x)<<2|(b>=v)<<1|m>=y));return o[P]=a,o[_]=c,n}function R0e(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,r=new Float64Array(e),i=new Float64Array(e),s=new Float64Array(e);let o=1/0,a=1/0,c=1/0,l=-1/0,u=-1/0,d=-1/0;for(let h=0,p,g,y,v;h<e;++h)isNaN(g=+this._x.call(null,p=n[h]))||isNaN(y=+this._y.call(null,p))||isNaN(v=+this._z.call(null,p))||(r[h]=g,i[h]=y,s[h]=v,g<o&&(o=g),g>l&&(l=g),y<a&&(a=y),y>u&&(u=y),v<c&&(c=v),v>d&&(d=v));if(o>l||a>u||c>d)return this;this.cover(o,a,c).cover(l,u,d);for(let h=0;h<e;++h)yB(this,r[h],i[h],s[h],n[h]);return this}function O0e(n,e,r){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(r=+r))return this;var i=this._x0,s=this._y0,o=this._z0,a=this._x1,c=this._y1,l=this._z1;if(isNaN(i))a=(i=Math.floor(n))+1,c=(s=Math.floor(e))+1,l=(o=Math.floor(r))+1;else{for(var u=a-i||1,d=this._root,h,p;i>n||n>=a||s>e||e>=c||o>r||r>=l;)switch(p=(r<o)<<2|(e<s)<<1|n<i,h=new Array(8),h[p]=d,d=h,u*=2,p){case 0:a=i+u,c=s+u,l=o+u;break;case 1:i=a-u,c=s+u,l=o+u;break;case 2:a=i+u,s=c-u,l=o+u;break;case 3:i=a-u,s=c-u,l=o+u;break;case 4:a=i+u,c=s+u,o=l-u;break;case 5:i=a-u,c=s+u,o=l-u;break;case 6:a=i+u,s=c-u,o=l-u;break;case 7:i=a-u,s=c-u,o=l-u;break}this._root&&this._root.length&&(this._root=d)}return this._x0=i,this._y0=s,this._z0=o,this._x1=a,this._y1=c,this._z1=l,this}function D0e(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function N0e(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function at(n,e,r,i,s,o,a){this.node=n,this.x0=e,this.y0=r,this.z0=i,this.x1=s,this.y1=o,this.z1=a}function L0e(n,e,r,i){var s,o=this._x0,a=this._y0,c=this._z0,l,u,d,h,p,g,y=this._x1,v=this._y1,x=this._z1,m=[],b=this._root,S,w;for(b&&m.push(new at(b,o,a,c,y,v,x)),i==null?i=1/0:(o=n-i,a=e-i,c=r-i,y=n+i,v=e+i,x=r+i,i*=i);S=m.pop();)if(!(!(b=S.node)||(l=S.x0)>y||(u=S.y0)>v||(d=S.z0)>x||(h=S.x1)<o||(p=S.y1)<a||(g=S.z1)<c))if(b.length){var I=(l+h)/2,C=(u+p)/2,_=(d+g)/2;m.push(new at(b[7],I,C,_,h,p,g),new at(b[6],l,C,_,I,p,g),new at(b[5],I,u,_,h,C,g),new at(b[4],l,u,_,I,C,g),new at(b[3],I,C,d,h,p,_),new at(b[2],l,C,d,I,p,_),new at(b[1],I,u,d,h,C,_),new at(b[0],l,u,d,I,C,_)),(w=(r>=_)<<2|(e>=C)<<1|n>=I)&&(S=m[m.length-1],m[m.length-1]=m[m.length-1-w],m[m.length-1-w]=S)}else{var P=n-+this._x.call(null,b.data),M=e-+this._y.call(null,b.data),T=r-+this._z.call(null,b.data),A=P*P+M*M+T*T;if(A<i){var R=Math.sqrt(i=A);o=n-R,a=e-R,c=r-R,y=n+R,v=e+R,x=r+R,s=b.data}}return s}const F0e=(n,e,r,i,s,o)=>Math.sqrt((n-i)**2+(e-s)**2+(r-o)**2);function z0e(n,e,r,i){const s=[],o=n-i,a=e-i,c=r-i,l=n+i,u=e+i,d=r+i;return this.visit((h,p,g,y,v,x,m)=>{if(!h.length)do{const b=h.data;F0e(n,e,r,this._x(b),this._y(b),this._z(b))<=i&&s.push(b)}while(h=h.next);return p>l||g>u||y>d||v<o||x<a||m<c}),s}function $0e(n){if(isNaN(p=+this._x.call(null,n))||isNaN(g=+this._y.call(null,n))||isNaN(y=+this._z.call(null,n)))return this;var e,r=this._root,i,s,o,a=this._x0,c=this._y0,l=this._z0,u=this._x1,d=this._y1,h=this._z1,p,g,y,v,x,m,b,S,w,I,C;if(!r)return this;if(r.length)for(;;){if((b=p>=(v=(a+u)/2))?a=v:u=v,(S=g>=(x=(c+d)/2))?c=x:d=x,(w=y>=(m=(l+h)/2))?l=m:h=m,e=r,!(r=r[I=w<<2|S<<1|b]))return this;if(!r.length)break;(e[I+1&7]||e[I+2&7]||e[I+3&7]||e[I+4&7]||e[I+5&7]||e[I+6&7]||e[I+7&7])&&(i=e,C=I)}for(;r.data!==n;)if(s=r,!(r=r.next))return this;return(o=r.next)&&delete r.next,s?(o?s.next=o:delete s.next,this):e?(o?e[I]=o:delete e[I],(r=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&r===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!r.length&&(i?i[C]=r:this._root=r),this):(this._root=o,this)}function B0e(n){for(var e=0,r=n.length;e<r;++e)this.remove(n[e]);return this}function U0e(){return this._root}function q0e(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function H0e(n){var e=[],r,i=this._root,s,o,a,c,l,u,d;for(i&&e.push(new at(i,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();)if(!n(i=r.node,o=r.x0,a=r.y0,c=r.z0,l=r.x1,u=r.y1,d=r.z1)&&i.length){var h=(o+l)/2,p=(a+u)/2,g=(c+d)/2;(s=i[7])&&e.push(new at(s,h,p,g,l,u,d)),(s=i[6])&&e.push(new at(s,o,p,g,h,u,d)),(s=i[5])&&e.push(new at(s,h,a,g,l,p,d)),(s=i[4])&&e.push(new at(s,o,a,g,h,p,d)),(s=i[3])&&e.push(new at(s,h,p,c,l,u,g)),(s=i[2])&&e.push(new at(s,o,p,c,h,u,g)),(s=i[1])&&e.push(new at(s,h,a,c,l,p,g)),(s=i[0])&&e.push(new at(s,o,a,c,h,p,g))}return this}function G0e(n){var e=[],r=[],i;for(this._root&&e.push(new at(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();){var s=i.node;if(s.length){var o,a=i.x0,c=i.y0,l=i.z0,u=i.x1,d=i.y1,h=i.z1,p=(a+u)/2,g=(c+d)/2,y=(l+h)/2;(o=s[0])&&e.push(new at(o,a,c,l,p,g,y)),(o=s[1])&&e.push(new at(o,p,c,l,u,g,y)),(o=s[2])&&e.push(new at(o,a,g,l,p,d,y)),(o=s[3])&&e.push(new at(o,p,g,l,u,d,y)),(o=s[4])&&e.push(new at(o,a,c,y,p,g,h)),(o=s[5])&&e.push(new at(o,p,c,y,u,g,h)),(o=s[6])&&e.push(new at(o,a,g,y,p,d,h)),(o=s[7])&&e.push(new at(o,p,g,y,u,d,h))}r.push(i)}for(;i=r.pop();)n(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this}function K0e(n){return n[0]}function V0e(n){return arguments.length?(this._x=n,this):this._x}function W0e(n){return n[1]}function Y0e(n){return arguments.length?(this._y=n,this):this._y}function X0e(n){return n[2]}function Z0e(n){return arguments.length?(this._z=n,this):this._z}function vB(n,e,r,i){var s=new FC(e??K0e,r??W0e,i??X0e,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?s:s.addAll(n)}function FC(n,e,r,i,s,o,a,c,l){this._x=n,this._y=e,this._z=r,this._x0=i,this._y0=s,this._z0=o,this._x1=a,this._y1=c,this._z1=l,this._root=void 0}function AD(n){for(var e={data:n.data},r=e;n=n.next;)r=r.next={data:n.data};return e}var dn=vB.prototype=FC.prototype;dn.copy=function(){var n=new FC(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,r,i;if(!e)return n;if(!e.length)return n._root=AD(e),n;for(r=[{source:e,target:n._root=new Array(8)}];e=r.pop();)for(var s=0;s<8;++s)(i=e.source[s])&&(i.length?r.push({source:i,target:e.target[s]=new Array(8)}):e.target[s]=AD(i));return n};dn.add=j0e;dn.addAll=R0e;dn.cover=O0e;dn.data=D0e;dn.extent=N0e;dn.find=L0e;dn.findAllWithinRadius=z0e;dn.remove=$0e;dn.removeAll=B0e;dn.root=U0e;dn.size=q0e;dn.visit=H0e;dn.visitAfter=G0e;dn.x=V0e;dn.y=Y0e;dn.z=Z0e;function Wi(n){return function(){return n}}function qi(n){return(n()-.5)*1e-6}function Q0e(n){return n.index}function jD(n,e){var r=n.get(e);if(!r)throw new Error("node not found: "+e);return r}function J0e(n){var e=Q0e,r=p,i,s=Wi(30),o,a,c,l,u,d,h=1;n==null&&(n=[]);function p(m){return 1/Math.min(l[m.source.index],l[m.target.index])}function g(m){for(var b=0,S=n.length;b<h;++b)for(var w=0,I,C,_,P=0,M=0,T=0,A,R;w<S;++w)I=n[w],C=I.source,_=I.target,P=_.x+_.vx-C.x-C.vx||qi(d),c>1&&(M=_.y+_.vy-C.y-C.vy||qi(d)),c>2&&(T=_.z+_.vz-C.z-C.vz||qi(d)),A=Math.sqrt(P*P+M*M+T*T),A=(A-o[w])/A*m*i[w],P*=A,M*=A,T*=A,_.vx-=P*(R=u[w]),c>1&&(_.vy-=M*R),c>2&&(_.vz-=T*R),C.vx+=P*(R=1-R),c>1&&(C.vy+=M*R),c>2&&(C.vz+=T*R)}function y(){if(a){var m,b=a.length,S=n.length,w=new Map(a.map((C,_)=>[e(C,_,a),C])),I;for(m=0,l=new Array(b);m<S;++m)I=n[m],I.index=m,typeof I.source!="object"&&(I.source=jD(w,I.source)),typeof I.target!="object"&&(I.target=jD(w,I.target)),l[I.source.index]=(l[I.source.index]||0)+1,l[I.target.index]=(l[I.target.index]||0)+1;for(m=0,u=new Array(S);m<S;++m)I=n[m],u[m]=l[I.source.index]/(l[I.source.index]+l[I.target.index]);i=new Array(S),v(),o=new Array(S),x()}}function v(){if(a)for(var m=0,b=n.length;m<b;++m)i[m]=+r(n[m],m,n)}function x(){if(a)for(var m=0,b=n.length;m<b;++m)o[m]=+s(n[m],m,n)}return g.initialize=function(m,...b){a=m,d=b.find(S=>typeof S=="function")||Math.random,c=b.find(S=>[1,2,3].includes(S))||2,y()},g.links=function(m){return arguments.length?(n=m,y(),g):n},g.id=function(m){return arguments.length?(e=m,g):e},g.iterations=function(m){return arguments.length?(h=+m,g):h},g.strength=function(m){return arguments.length?(r=typeof m=="function"?m:Wi(+m),v(),g):r},g.distance=function(m){return arguments.length?(s=typeof m=="function"?m:Wi(+m),x(),g):s},g}const exe=1664525,txe=1013904223,RD=4294967296;function nxe(){let n=1;return()=>(n=(exe*n+txe)%RD)/RD}var OD=3;function BS(n){return n.x}function DD(n){return n.y}function rxe(n){return n.z}var ixe=10,sxe=Math.PI*(3-Math.sqrt(5)),oxe=Math.PI*20/(9+Math.sqrt(221));function axe(n,e){e=e||2;var r=Math.min(OD,Math.max(1,Math.round(e))),i,s=1,o=.001,a=1-Math.pow(o,1/300),c=0,l=.6,u=new Map,d=y1(g),h=zl("tick","end"),p=nxe();n==null&&(n=[]);function g(){y(),h.call("tick",i),s<o&&(d.stop(),h.call("end",i))}function y(m){var b,S=n.length,w;m===void 0&&(m=1);for(var I=0;I<m;++I)for(s+=(c-s)*a,u.forEach(function(C){C(s)}),b=0;b<S;++b)w=n[b],w.fx==null?w.x+=w.vx*=l:(w.x=w.fx,w.vx=0),r>1&&(w.fy==null?w.y+=w.vy*=l:(w.y=w.fy,w.vy=0)),r>2&&(w.fz==null?w.z+=w.vz*=l:(w.z=w.fz,w.vz=0));return i}function v(){for(var m=0,b=n.length,S;m<b;++m){if(S=n[m],S.index=m,S.fx!=null&&(S.x=S.fx),S.fy!=null&&(S.y=S.fy),S.fz!=null&&(S.z=S.fz),isNaN(S.x)||r>1&&isNaN(S.y)||r>2&&isNaN(S.z)){var w=ixe*(r>2?Math.cbrt(.5+m):r>1?Math.sqrt(.5+m):m),I=m*sxe,C=m*oxe;r===1?S.x=w:r===2?(S.x=w*Math.cos(I),S.y=w*Math.sin(I)):(S.x=w*Math.sin(I)*Math.cos(C),S.y=w*Math.cos(I),S.z=w*Math.sin(I)*Math.sin(C))}(isNaN(S.vx)||r>1&&isNaN(S.vy)||r>2&&isNaN(S.vz))&&(S.vx=0,r>1&&(S.vy=0),r>2&&(S.vz=0))}}function x(m){return m.initialize&&m.initialize(n,p,r),m}return v(),i={tick:y,restart:function(){return d.restart(g),i},stop:function(){return d.stop(),i},numDimensions:function(m){return arguments.length?(r=Math.min(OD,Math.max(1,Math.round(m))),u.forEach(x),i):r},nodes:function(m){return arguments.length?(n=m,v(),u.forEach(x),i):n},alpha:function(m){return arguments.length?(s=+m,i):s},alphaMin:function(m){return arguments.length?(o=+m,i):o},alphaDecay:function(m){return arguments.length?(a=+m,i):+a},alphaTarget:function(m){return arguments.length?(c=+m,i):c},velocityDecay:function(m){return arguments.length?(l=1-m,i):1-l},randomSource:function(m){return arguments.length?(p=m,u.forEach(x),i):p},force:function(m,b){return arguments.length>1?(b==null?u.delete(m):u.set(m,x(b)),i):u.get(m)},find:function(){var m=Array.prototype.slice.call(arguments),b=m.shift()||0,S=(r>1?m.shift():null)||0,w=(r>2?m.shift():null)||0,I=m.shift()||1/0,C=0,_=n.length,P,M,T,A,R,O;for(I*=I,C=0;C<_;++C)R=n[C],P=b-R.x,M=S-(R.y||0),T=w-(R.z||0),A=P*P+M*M+T*T,A<I&&(O=R,I=A);return O},on:function(m,b){return arguments.length>1?(h.on(m,b),i):h.on(m)}}}function cxe(){var n,e,r,i,s,o=Wi(-30),a,c=1,l=1/0,u=.81;function d(y){var v,x=n.length,m=(e===1?pB(n,BS):e===2?mB(n,BS,DD):e===3?vB(n,BS,DD,rxe):null).visitAfter(p);for(s=y,v=0;v<x;++v)r=n[v],m.visit(g)}function h(){if(n){var y,v=n.length,x;for(a=new Array(v),y=0;y<v;++y)x=n[y],a[x.index]=+o(x,y,n)}}function p(y){var v=0,x,m,b=0,S,w,I,C,_=y.length;if(_){for(S=w=I=C=0;C<_;++C)(x=y[C])&&(m=Math.abs(x.value))&&(v+=x.value,b+=m,S+=m*(x.x||0),w+=m*(x.y||0),I+=m*(x.z||0));v*=Math.sqrt(4/_),y.x=S/b,e>1&&(y.y=w/b),e>2&&(y.z=I/b)}else{x=y,x.x=x.data.x,e>1&&(x.y=x.data.y),e>2&&(x.z=x.data.z);do v+=a[x.data.index];while(x=x.next)}y.value=v}function g(y,v,x,m,b){if(!y.value)return!0;var S=[x,m,b][e-1],w=y.x-r.x,I=e>1?y.y-r.y:0,C=e>2?y.z-r.z:0,_=S-v,P=w*w+I*I+C*C;if(_*_/u<P)return P<l&&(w===0&&(w=qi(i),P+=w*w),e>1&&I===0&&(I=qi(i),P+=I*I),e>2&&C===0&&(C=qi(i),P+=C*C),P<c&&(P=Math.sqrt(c*P)),r.vx+=w*y.value*s/P,e>1&&(r.vy+=I*y.value*s/P),e>2&&(r.vz+=C*y.value*s/P)),!0;if(y.length||P>=l)return;(y.data!==r||y.next)&&(w===0&&(w=qi(i),P+=w*w),e>1&&I===0&&(I=qi(i),P+=I*I),e>2&&C===0&&(C=qi(i),P+=C*C),P<c&&(P=Math.sqrt(c*P)));do y.data!==r&&(_=a[y.data.index]*s/P,r.vx+=w*_,e>1&&(r.vy+=I*_),e>2&&(r.vz+=C*_));while(y=y.next)}return d.initialize=function(y,...v){n=y,i=v.find(x=>typeof x=="function")||Math.random,e=v.find(x=>[1,2,3].includes(x))||2,h()},d.strength=function(y){return arguments.length?(o=typeof y=="function"?y:Wi(+y),h(),d):o},d.distanceMin=function(y){return arguments.length?(c=y*y,d):Math.sqrt(c)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(u=y*y,d):Math.sqrt(u)},d}function lxe(n,e,r,i){var s,o,a=Wi(.1),c,l;typeof n!="function"&&(n=Wi(+n)),e==null&&(e=0),r==null&&(r=0),i==null&&(i=0);function u(h){for(var p=0,g=s.length;p<g;++p){var y=s[p],v=y.x-e||1e-6,x=(y.y||0)-r||1e-6,m=(y.z||0)-i||1e-6,b=Math.sqrt(v*v+x*x+m*m),S=(l[p]-b)*c[p]*h/b;y.vx+=v*S,o>1&&(y.vy+=x*S),o>2&&(y.vz+=m*S)}}function d(){if(s){var h,p=s.length;for(c=new Array(p),l=new Array(p),h=0;h<p;++h)l[h]=+n(s[h],h,s),c[h]=isNaN(l[h])?0:+a(s[h],h,s)}}return u.initialize=function(h,...p){s=h,o=p.find(g=>[1,2,3].includes(g))||2,d()},u.strength=function(h){return arguments.length?(a=typeof h=="function"?h:Wi(+h),d(),u):a},u.radius=function(h){return arguments.length?(n=typeof h=="function"?h:Wi(+h),d(),u):n},u.x=function(h){return arguments.length?(e=+h,u):e},u.y=function(h){return arguments.length?(r=+h,u):r},u.z=function(h){return arguments.length?(i=+h,u):i},u}const{abs:Ec,cos:zi,sin:ea,acos:uxe,atan2:kc,sqrt:ws,pow:br}=Math;function Tc(n){return n<0?-br(-n,1/3):br(n,1/3)}const xB=Math.PI,md=2*xB,_s=xB/2,dxe=1e-6,US=Number.MAX_SAFE_INTEGER||9007199254740991,qS=Number.MIN_SAFE_INTEGER||-9007199254740991,hxe={x:0,y:0,z:0},ue={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(n,e){const r=e(n);let i=r.x*r.x+r.y*r.y;return typeof r.z<"u"&&(i+=r.z*r.z),ws(i)},compute:function(n,e,r){if(n===0)return e[0].t=0,e[0];const i=e.length-1;if(n===1)return e[i].t=1,e[i];const s=1-n;let o=e;if(i===0)return e[0].t=n,e[0];if(i===1){const c={x:s*o[0].x+n*o[1].x,y:s*o[0].y+n*o[1].y,t:n};return r&&(c.z=s*o[0].z+n*o[1].z),c}if(i<4){let c=s*s,l=n*n,u,d,h,p=0;i===2?(o=[o[0],o[1],o[2],hxe],u=c,d=s*n*2,h=l):i===3&&(u=c*s,d=c*n*3,h=s*l*3,p=n*l);const g={x:u*o[0].x+d*o[1].x+h*o[2].x+p*o[3].x,y:u*o[0].y+d*o[1].y+h*o[2].y+p*o[3].y,t:n};return r&&(g.z=u*o[0].z+d*o[1].z+h*o[2].z+p*o[3].z),g}const a=JSON.parse(JSON.stringify(e));for(;a.length>1;){for(let c=0;c<a.length-1;c++)a[c]={x:a[c].x+(a[c+1].x-a[c].x)*n,y:a[c].y+(a[c+1].y-a[c].y)*n},typeof a[c].z<"u"&&(a[c].z=a[c].z+(a[c+1].z-a[c].z)*n);a.splice(a.length-1,1)}return a[0].t=n,a[0]},computeWithRatios:function(n,e,r,i){const s=1-n,o=r,a=e;let c=o[0],l=o[1],u=o[2],d=o[3],h;if(c*=s,l*=n,a.length===2)return h=c+l,{x:(c*a[0].x+l*a[1].x)/h,y:(c*a[0].y+l*a[1].y)/h,z:i?(c*a[0].z+l*a[1].z)/h:!1,t:n};if(c*=s,l*=2*s,u*=n*n,a.length===3)return h=c+l+u,{x:(c*a[0].x+l*a[1].x+u*a[2].x)/h,y:(c*a[0].y+l*a[1].y+u*a[2].y)/h,z:i?(c*a[0].z+l*a[1].z+u*a[2].z)/h:!1,t:n};if(c*=s,l*=1.5*s,u*=3*s,d*=n*n*n,a.length===4)return h=c+l+u+d,{x:(c*a[0].x+l*a[1].x+u*a[2].x+d*a[3].x)/h,y:(c*a[0].y+l*a[1].y+u*a[2].y+d*a[3].y)/h,z:i?(c*a[0].z+l*a[1].z+u*a[2].z+d*a[3].z)/h:!1,t:n}},derive:function(n,e){const r=[];for(let i=n,s=i.length,o=s-1;s>1;s--,o--){const a=[];for(let c=0,l;c<o;c++)l={x:o*(i[c+1].x-i[c].x),y:o*(i[c+1].y-i[c].y)},e&&(l.z=o*(i[c+1].z-i[c].z)),a.push(l);r.push(a),i=a}return r},between:function(n,e,r){return e<=n&&n<=r||ue.approximately(n,e)||ue.approximately(n,r)},approximately:function(n,e,r){return Ec(n-e)<=(r||dxe)},length:function(n){const r=ue.Tvalues.length;let i=0;for(let s=0,o;s<r;s++)o=.5*ue.Tvalues[s]+.5,i+=ue.Cvalues[s]*ue.arcfn(o,n);return .5*i},map:function(n,e,r,i,s){const o=r-e,a=s-i,c=n-e,l=c/o;return i+a*l},lerp:function(n,e,r){const i={x:e.x+n*(r.x-e.x),y:e.y+n*(r.y-e.y)};return e.z!==void 0&&r.z!==void 0&&(i.z=e.z+n*(r.z-e.z)),i},pointToString:function(n){let e=n.x+"/"+n.y;return typeof n.z<"u"&&(e+="/"+n.z),e},pointsToString:function(n){return"["+n.map(ue.pointToString).join(", ")+"]"},copy:function(n){return JSON.parse(JSON.stringify(n))},angle:function(n,e,r){const i=e.x-n.x,s=e.y-n.y,o=r.x-n.x,a=r.y-n.y,c=i*a-s*o,l=i*o+s*a;return kc(c,l)},round:function(n,e){const r=""+n,i=r.indexOf(".");return parseFloat(r.substring(0,i+1+e))},dist:function(n,e){const r=n.x-e.x,i=n.y-e.y;return ws(r*r+i*i)},closest:function(n,e){let r=br(2,63),i,s;return n.forEach(function(o,a){s=ue.dist(e,o),s<r&&(r=s,i=a)}),{mdist:r,mpos:i}},abcratio:function(n,e){if(e!==2&&e!==3)return!1;if(typeof n>"u")n=.5;else if(n===0||n===1)return n;const r=br(n,e)+br(1-n,e),i=r-1;return Ec(i/r)},projectionratio:function(n,e){if(e!==2&&e!==3)return!1;if(typeof n>"u")n=.5;else if(n===0||n===1)return n;const r=br(1-n,e),i=br(n,e)+r;return r/i},lli8:function(n,e,r,i,s,o,a,c){const l=(n*i-e*r)*(s-a)-(n-r)*(s*c-o*a),u=(n*i-e*r)*(o-c)-(e-i)*(s*c-o*a),d=(n-r)*(o-c)-(e-i)*(s-a);return d==0?!1:{x:l/d,y:u/d}},lli4:function(n,e,r,i){const s=n.x,o=n.y,a=e.x,c=e.y,l=r.x,u=r.y,d=i.x,h=i.y;return ue.lli8(s,o,a,c,l,u,d,h)},lli:function(n,e){return ue.lli4(n,n.c,e,e.c)},makeline:function(n,e){return new vt(n.x,n.y,(n.x+e.x)/2,(n.y+e.y)/2,e.x,e.y)},findbbox:function(n){let e=US,r=US,i=qS,s=qS;return n.forEach(function(o){const a=o.bbox();e>a.x.min&&(e=a.x.min),r>a.y.min&&(r=a.y.min),i<a.x.max&&(i=a.x.max),s<a.y.max&&(s=a.y.max)}),{x:{min:e,mid:(e+i)/2,max:i,size:i-e},y:{min:r,mid:(r+s)/2,max:s,size:s-r}}},shapeintersections:function(n,e,r,i,s){if(!ue.bboxoverlap(e,i))return[];const o=[],a=[n.startcap,n.forward,n.back,n.endcap],c=[r.startcap,r.forward,r.back,r.endcap];return a.forEach(function(l){l.virtual||c.forEach(function(u){if(u.virtual)return;const d=l.intersects(u,s);d.length>0&&(d.c1=l,d.c2=u,d.s1=n,d.s2=r,o.push(d))})}),o},makeshape:function(n,e,r){const i=e.points.length,s=n.points.length,o=ue.makeline(e.points[i-1],n.points[0]),a=ue.makeline(n.points[s-1],e.points[0]),c={startcap:o,forward:n,back:e,endcap:a,bbox:ue.findbbox([o,n,e,a])};return c.intersections=function(l){return ue.shapeintersections(c,c.bbox,l,l.bbox,r)},c},getminmax:function(n,e,r){if(!r)return{min:0,max:0};let i=US,s=qS,o,a;r.indexOf(0)===-1&&(r=[0].concat(r)),r.indexOf(1)===-1&&r.push(1);for(let c=0,l=r.length;c<l;c++)o=r[c],a=n.get(o),a[e]<i&&(i=a[e]),a[e]>s&&(s=a[e]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(n,e){const r=e.p1.x,i=e.p1.y,s=-kc(e.p2.y-i,e.p2.x-r),o=function(a){return{x:(a.x-r)*zi(s)-(a.y-i)*ea(s),y:(a.x-r)*ea(s)+(a.y-i)*zi(s)}};return n.map(o)},roots:function(n,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const r=n.length-1,i=ue.align(n,e),s=function(_){return 0<=_&&_<=1};if(r===2){const _=i[0].y,P=i[1].y,M=i[2].y,T=_-2*P+M;if(T!==0){const A=-ws(P*P-_*M),R=-_+P,O=-(A+R)/T,j=-(-A+R)/T;return[O,j].filter(s)}else if(P!==M&&T===0)return[(2*P-M)/(2*P-2*M)].filter(s);return[]}const o=i[0].y,a=i[1].y,c=i[2].y,l=i[3].y;let u=-o+3*a-3*c+l,d=3*o-6*a+3*c,h=-3*o+3*a,p=o;if(ue.approximately(u,0)){if(ue.approximately(d,0))return ue.approximately(h,0)?[]:[-p/h].filter(s);const _=ws(h*h-4*d*p),P=2*d;return[(_-h)/P,(-h-_)/P].filter(s)}d/=u,h/=u,p/=u;const g=(3*h-d*d)/3,y=g/3,v=(2*d*d*d-9*d*h+27*p)/27,x=v/2,m=x*x+y*y*y;let b,S,w,I,C;if(m<0){const _=-g/3,P=_*_*_,M=ws(P),T=-v/(2*M),A=T<-1?-1:T>1?1:T,R=uxe(A),O=Tc(M),j=2*O;return w=j*zi(R/3)-d/3,I=j*zi((R+md)/3)-d/3,C=j*zi((R+2*md)/3)-d/3,[w,I,C].filter(s)}else{if(m===0)return b=x<0?Tc(-x):-Tc(x),w=2*b-d/3,I=-b-d/3,[w,I].filter(s);{const _=ws(m);return b=Tc(-x+_),S=Tc(x+_),[b-S-d/3].filter(s)}}},droots:function(n){if(n.length===3){const e=n[0],r=n[1],i=n[2],s=e-2*r+i;if(s!==0){const o=-ws(r*r-e*i),a=-e+r,c=-(o+a)/s,l=-(-o+a)/s;return[c,l]}else if(r!==i&&s===0)return[(2*r-i)/(2*(r-i))];return[]}if(n.length===2){const e=n[0],r=n[1];return e!==r?[e/(e-r)]:[]}return[]},curvature:function(n,e,r,i,s){let o,a,c,l,u=0,d=0;const h=ue.compute(n,e),p=ue.compute(n,r),g=h.x*h.x+h.y*h.y;if(i?(o=ws(br(h.y*p.z-p.y*h.z,2)+br(h.z*p.x-p.z*h.x,2)+br(h.x*p.y-p.x*h.y,2)),a=br(g+h.z*h.z,3/2)):(o=h.x*p.y-h.y*p.x,a=br(g,3/2)),o===0||a===0)return{k:0,r:0};if(u=o/a,d=a/o,!s){const y=ue.curvature(n-.001,e,r,i,!0).k,v=ue.curvature(n+.001,e,r,i,!0).k;l=(v-u+(u-y))/2,c=(Ec(v-u)+Ec(u-y))/2}return{k:u,r:d,dk:l,adk:c}},inflections:function(n){if(n.length<4)return[];const e=ue.align(n,{p1:n[0],p2:n.slice(-1)[0]}),r=e[2].x*e[1].y,i=e[3].x*e[1].y,s=e[1].x*e[2].y,o=e[3].x*e[2].y,a=18*(-3*r+2*i+3*s-o),c=18*(3*r-i-3*s),l=18*(s-r);if(ue.approximately(a,0)){if(!ue.approximately(c,0)){let p=-l/c;if(0<=p&&p<=1)return[p]}return[]}const u=2*a;if(ue.approximately(u,0))return[];const d=c*c-4*a*l;if(d<0)return[];const h=Math.sqrt(d);return[(h-c)/u,-(c+h)/u].filter(function(p){return 0<=p&&p<=1})},bboxoverlap:function(n,e){const r=["x","y"],i=r.length;for(let s=0,o,a,c,l;s<i;s++)if(o=r[s],a=n[o].mid,c=e[o].mid,l=(n[o].size+e[o].size)/2,Ec(a-c)>=l)return!1;return!0},expandbox:function(n,e){e.x.min<n.x.min&&(n.x.min=e.x.min),e.y.min<n.y.min&&(n.y.min=e.y.min),e.z&&e.z.min<n.z.min&&(n.z.min=e.z.min),e.x.max>n.x.max&&(n.x.max=e.x.max),e.y.max>n.y.max&&(n.y.max=e.y.max),e.z&&e.z.max>n.z.max&&(n.z.max=e.z.max),n.x.mid=(n.x.min+n.x.max)/2,n.y.mid=(n.y.min+n.y.max)/2,n.z&&(n.z.mid=(n.z.min+n.z.max)/2),n.x.size=n.x.max-n.x.min,n.y.size=n.y.max-n.y.min,n.z&&(n.z.size=n.z.max-n.z.min)},pairiteration:function(n,e,r){const i=n.bbox(),s=e.bbox(),o=1e5,a=r||.5;if(i.x.size+i.y.size<a&&s.x.size+s.y.size<a)return[(o*(n._t1+n._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let c=n.split(.5),l=e.split(.5),u=[{left:c.left,right:l.left},{left:c.left,right:l.right},{left:c.right,right:l.right},{left:c.right,right:l.left}];u=u.filter(function(h){return ue.bboxoverlap(h.left.bbox(),h.right.bbox())});let d=[];return u.length===0||(u.forEach(function(h){d=d.concat(ue.pairiteration(h.left,h.right,a))}),d=d.filter(function(h,p){return d.indexOf(h)===p})),d},getccenter:function(n,e,r){const i=e.x-n.x,s=e.y-n.y,o=r.x-e.x,a=r.y-e.y,c=i*zi(_s)-s*ea(_s),l=i*ea(_s)+s*zi(_s),u=o*zi(_s)-a*ea(_s),d=o*ea(_s)+a*zi(_s),h=(n.x+e.x)/2,p=(n.y+e.y)/2,g=(e.x+r.x)/2,y=(e.y+r.y)/2,v=h+c,x=p+l,m=g+u,b=y+d,S=ue.lli8(h,p,v,x,g,y,m,b),w=ue.dist(S,n);let I=kc(n.y-S.y,n.x-S.x),C=kc(e.y-S.y,e.x-S.x),_=kc(r.y-S.y,r.x-S.x),P;return I<_?((I>C||C>_)&&(I+=md),I>_&&(P=_,_=I,I=P)):_<C&&C<I?(P=_,_=I,I=P):_+=md,S.s=I,S.e=_,S.r=w,S},numberSort:function(n,e){return n-e}};class ll{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return ue.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,r){return e+r})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var r=e[0].bbox(),i=1;i<e.length;i++)ue.expandbox(r,e[i].bbox());return r}offset(e){const r=[];return this.curves.forEach(function(i){r.push(...i.offset(e))}),new ll(r)}}const{abs:Mc,min:ND,max:LD,cos:fxe,sin:pxe,acos:gxe,sqrt:Ac}=Math,mxe=Math.PI;class vt{constructor(e){let r=e&&e.forEach?e:Array.from(arguments).slice(),i=!1;if(typeof r[0]=="object"){i=r.length;const g=[];r.forEach(function(y){["x","y","z"].forEach(function(v){typeof y[v]<"u"&&g.push(y[v])})}),r=g}let s=!1;const o=r.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!s&&(o===9||o===12)||e&&e[0]&&typeof e[0].z<"u",c=this.points=[];for(let g=0,y=a?3:2;g<o;g+=y){var l={x:r[g],y:r[g+1]};a&&(l.z=r[g+2]),c.push(l)}const u=this.order=c.length-1,d=this.dims=["x","y"];a&&d.push("z"),this.dimlen=d.length;const h=ue.align(c,{p1:c[0],p2:c[u]}),p=ue.dist(c[0],c[u]);this._linear=h.reduce((g,y)=>g+Mc(y.y),0)<p/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,r,i,s){if(typeof s>"u"&&(s=.5),s===0)return new vt(r,r,i);if(s===1)return new vt(e,r,r);const o=vt.getABC(2,e,r,i,s);return new vt(e,o.A,i)}static cubicFromPoints(e,r,i,s,o){typeof s>"u"&&(s=.5);const a=vt.getABC(3,e,r,i,s);typeof o>"u"&&(o=ue.dist(r,a.C));const c=o*(1-s)/s,l=ue.dist(e,i),u=(i.x-e.x)/l,d=(i.y-e.y)/l,h=o*u,p=o*d,g=c*u,y=c*d,v={x:r.x-h,y:r.y-p},x={x:r.x+g,y:r.y+y},m=a.A,b={x:m.x+(v.x-m.x)/(1-s),y:m.y+(v.y-m.y)/(1-s)},S={x:m.x+(x.x-m.x)/s,y:m.y+(x.y-m.y)/s},w={x:e.x+(b.x-e.x)/s,y:e.y+(b.y-e.y)/s},I={x:i.x+(S.x-i.x)/(1-s),y:i.y+(S.y-i.y)/(1-s)};return new vt(e,w,I,i)}static getUtils(){return ue}getUtils(){return vt.getUtils()}static get PolyBezier(){return ll}valueOf(){return this.toString()}toString(){return ue.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,r=e[0].x,i=e[0].y,s=["M",r,i,this.order===2?"Q":"C"];for(let o=1,a=e.length;o<a;o++)s.push(e[o].x),s.push(e[o].y);return s.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,r){return""+r+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=ue.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,r=ue.angle(e[0],e[this.order],e[1]);this.clockwise=r>0}length(){return ue.length(this.derivative.bind(this))}static getABC(e=2,r,i,s,o=.5){const a=ue.projectionratio(o,e),c=1-a,l={x:a*r.x+c*s.x,y:a*r.y+c*s.y},u=ue.abcratio(o,e);return{A:{x:i.x+(i.x-l.x)/u,y:i.y+(i.y-l.y)/u},B:i,C:l,S:r,E:s}}getABC(e,r){r=r||this.get(e);let i=this.points[0],s=this.points[this.order];return vt.getABC(this.order,i,r,s,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let r=0,i,s;r<e;r++)s=r/(e-1),i=this.compute(s),i.t=s,this._lut.push(i);return this._lut}on(e,r){r=r||5;const i=this.getLUT(),s=[];for(let o=0,a,c=0;o<i.length;o++)a=i[o],ue.dist(a,e)<r&&(s.push(a),c+=o/i.length);return s.length?t/=s.length:!1}project(e){const r=this.getLUT(),i=r.length-1,s=ue.closest(r,e),o=s.mpos,a=(o-1)/i,c=(o+1)/i,l=.1/i;let u=s.mdist,d=a,h=d,p;u+=1;for(let g;d<c+l;d+=l)p=this.compute(d),g=ue.dist(e,p),g<u&&(u=g,h=d);return h=h<0?0:h>1?1:h,p=this.compute(h),p.t=h,p.d=u,p}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?ue.computeWithRatios(e,this.points,this.ratios,this._3d):ue.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,r=[e[0]],i=e.length;for(let s=1,o,a;s<i;s++)o=e[s],a=e[s-1],r[s]={x:(i-s)/i*o.x+s/i*a.x,y:(i-s)/i*o.y+s/i*a.y};return r[i]=e[i-1],new vt(r)}derivative(e){return ue.compute(e,this.dpoints[0],this._3d)}dderivative(e){return ue.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new vt(ue.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return ue.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return ue.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const r=this.derivative(e),i=Ac(r.x*r.x+r.y*r.y);return{t:e,x:-r.y/i,y:r.x/i}}__normal3(e){const r=this.derivative(e),i=this.derivative(e+.01),s=Ac(r.x*r.x+r.y*r.y+r.z*r.z),o=Ac(i.x*i.x+i.y*i.y+i.z*i.z);r.x/=s,r.y/=s,r.z/=s,i.x/=o,i.y/=o,i.z/=o;const a={x:i.y*r.z-i.z*r.y,y:i.z*r.x-i.x*r.z,z:i.x*r.y-i.y*r.x},c=Ac(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=c,a.y/=c,a.z/=c;const l=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:e,x:l[0]*r.x+l[1]*r.y+l[2]*r.z,y:l[3]*r.x+l[4]*r.y+l[5]*r.z,z:l[6]*r.x+l[7]*r.y+l[8]*r.z}}hull(e){let r=this.points,i=[],s=[],o=0;for(s[o++]=r[0],s[o++]=r[1],s[o++]=r[2],this.order===3&&(s[o++]=r[3]);r.length>1;){i=[];for(let a=0,c,l=r.length-1;a<l;a++)c=ue.lerp(e,r[a],r[a+1]),s[o++]=c,i.push(c);r=i}return s}split(e,r){if(e===0&&r)return this.split(r).left;if(r===1)return this.split(e).right;const i=this.hull(e),s={left:this.order===2?new vt([i[0],i[3],i[5]]):new vt([i[0],i[4],i[7],i[9]]),right:this.order===2?new vt([i[5],i[4],i[2]]):new vt([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=ue.map(0,0,1,this._t1,this._t2),s.left._t2=ue.map(e,0,1,this._t1,this._t2),s.right._t1=ue.map(e,0,1,this._t1,this._t2),s.right._t2=ue.map(1,0,1,this._t1,this._t2),r?(r=ue.map(r,e,1,0,1),s.right.split(r).left):s}extrema(){const e={};let r=[];return this.dims.forEach((function(i){let s=function(a){return a[i]},o=this.dpoints[0].map(s);e[i]=ue.droots(o),this.order===3&&(o=this.dpoints[1].map(s),e[i]=e[i].concat(ue.droots(o))),e[i]=e[i].filter(function(a){return a>=0&&a<=1}),r=r.concat(e[i].sort(ue.numberSort))}).bind(this)),e.values=r.sort(ue.numberSort).filter(function(i,s){return r.indexOf(i)===s}),e}bbox(){const e=this.extrema(),r={};return this.dims.forEach((function(i){r[i]=ue.getminmax(this,i,e[i])}).bind(this)),r}overlaps(e){const r=this.bbox(),i=e.bbox();return ue.bboxoverlap(r,i)}offset(e,r){if(typeof r<"u"){const i=this.get(e),s=this.normal(e),o={c:i,n:s,x:i.x+s.x*r,y:i.y+s.y*r};return this._3d&&(o.z=i.z+s.z*r),o}if(this._linear){const i=this.normal(0),s=this.points.map(function(o){const a={x:o.x+e*i.x,y:o.y+e*i.y};return o.z&&i.z&&(a.z=o.z+e*i.z),a});return[new vt(s)]}return this.reduce().map(function(i){return i._linear?i.offset(e)[0]:i.scale(e)})}simple(){if(this.order===3){const s=ue.angle(this.points[0],this.points[3],this.points[1]),o=ue.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const e=this.normal(0),r=this.normal(1);let i=e.x*r.x+e.y*r.y;return this._3d&&(i+=e.z*r.z),Mc(gxe(i))<mxe/3}reduce(){let e,r=0,i=0,s=.01,o,a=[],c=[],l=this.extrema().values;for(l.indexOf(0)===-1&&(l=[0].concat(l)),l.indexOf(1)===-1&&l.push(1),r=l[0],e=1;e<l.length;e++)i=l[e],o=this.split(r,i),o._t1=r,o._t2=i,a.push(o),r=i;return a.forEach(function(u){for(r=0,i=0;i<=1;)for(i=r+s;i<=1+s;i+=s)if(o=u.split(r,i),!o.simple()){if(i-=s,Mc(r-i)<s)return[];o=u.split(r,i),o._t1=ue.map(r,0,1,u._t1,u._t2),o._t2=ue.map(i,0,1,u._t1,u._t2),c.push(o),r=i;break}r<1&&(o=u.split(r,1),o._t1=ue.map(r,0,1,u._t1,u._t2),o._t2=u._t2,c.push(o))}),c}translate(e,r,i){i=typeof i=="number"?i:r;const s=this.order;let o=this.points.map((a,c)=>(1-c/s)*r+c/s*i);return new vt(this.points.map((a,c)=>({x:a.x+e.x*o[c],y:a.y+e.y*o[c]})))}scale(e){const r=this.order;let i=!1;if(typeof e=="function"&&(i=e),i&&r===2)return this.raise().scale(i);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):e,i?i(1):e);const a=i?i(0):e,c=i?i(1):e,l=[this.offset(0,10),this.offset(1,10)],u=[],d=ue.lli4(l[0],l[0].c,l[1],l[1].c);if(!d)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(h){const p=u[h*r]=ue.copy(o[h*r]);p.x+=(h?c:a)*l[h].n.x,p.y+=(h?c:a)*l[h].n.y}),i?([0,1].forEach(function(h){if(!(r===2&&h)){var p=o[h+1],g={x:p.x-d.x,y:p.y-d.y},y=i?i((h+1)/r):e;i&&!s&&(y=-y);var v=Ac(g.x*g.x+g.y*g.y);g.x/=v,g.y/=v,u[h+1]={x:p.x+y*g.x,y:p.y+y*g.y}}}),new vt(u)):([0,1].forEach(h=>{if(r===2&&h)return;const p=u[h*r],g=this.derivative(h),y={x:p.x+g.x,y:p.y+g.y};u[h+1]=ue.lli4(p,y,d,o[h+1])}),new vt(u))}outline(e,r,i,s){if(r=r===void 0?e:r,this._linear){const I=this.normal(0),C=this.points[0],_=this.points[this.points.length-1];let P,M,T;i===void 0&&(i=e,s=r),P={x:C.x+I.x*e,y:C.y+I.y*e},T={x:_.x+I.x*i,y:_.y+I.y*i},M={x:(P.x+T.x)/2,y:(P.y+T.y)/2};const A=[P,M,T];P={x:C.x-I.x*r,y:C.y-I.y*r},T={x:_.x-I.x*s,y:_.y-I.y*s},M={x:(P.x+T.x)/2,y:(P.y+T.y)/2};const R=[T,M,P],O=ue.makeline(R[2],A[0]),j=ue.makeline(A[2],R[0]),D=[O,new vt(A),j,new vt(R)];return new ll(D)}const o=this.reduce(),a=o.length,c=[];let l=[],u,d=0,h=this.length();const p=typeof i<"u"&&typeof s<"u";function g(I,C,_,P,M){return function(T){const A=P/_,R=(P+M)/_,O=C-I;return ue.map(T,0,1,I+A*O,I+R*O)}}o.forEach(function(I){const C=I.length();p?(c.push(I.scale(g(e,i,h,d,C))),l.push(I.scale(g(-r,-s,h,d,C)))):(c.push(I.scale(e)),l.push(I.scale(-r))),d+=C}),l=l.map(function(I){return u=I.points,u[3]?I.points=[u[3],u[2],u[1],u[0]]:I.points=[u[2],u[1],u[0]],I}).reverse();const y=c[0].points[0],v=c[a-1].points[c[a-1].points.length-1],x=l[a-1].points[l[a-1].points.length-1],m=l[0].points[0],b=ue.makeline(x,y),S=ue.makeline(v,m),w=[b].concat(c).concat([S]).concat(l);return new ll(w)}outlineshapes(e,r,i){r=r||e;const s=this.outline(e,r).curves,o=[];for(let a=1,c=s.length;a<c/2;a++){const l=ue.makeshape(s[a],s[c-a],i);l.startcap.virtual=a>1,l.endcap.virtual=a<c/2-1,o.push(l)}return o}intersects(e,r){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof vt&&(e=e.reduce()),this.curveintersects(this.reduce(),e,r)):this.selfintersects(r)}lineIntersects(e){const r=ND(e.p1.x,e.p2.x),i=ND(e.p1.y,e.p2.y),s=LD(e.p1.x,e.p2.x),o=LD(e.p1.y,e.p2.y);return ue.roots(this.points,e).filter(a=>{var c=this.get(a);return ue.between(c.x,r,s)&&ue.between(c.y,i,o)})}selfintersects(e){const r=this.reduce(),i=r.length-2,s=[];for(let o=0,a,c,l;o<i;o++)c=r.slice(o,o+1),l=r.slice(o+2),a=this.curveintersects(c,l,e),s.push(...a);return s}curveintersects(e,r,i){const s=[];e.forEach(function(a){r.forEach(function(c){a.overlaps(c)&&s.push({left:a,right:c})})});let o=[];return s.forEach(function(a){const c=ue.pairiteration(a.left,a.right,i);c.length>0&&(o=o.concat(c))}),o}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,r,i,s){const o=(s-i)/4,a=this.get(i+o),c=this.get(s-o),l=ue.dist(e,r),u=ue.dist(e,a),d=ue.dist(e,c);return Mc(u-l)+Mc(d-l)}_iterate(e,r){let i=0,s=1,o;do{o=0,s=1;let a=this.get(i),c,l,u,d,h=!1,p=!1,g,y=s,v=1;do if(p=h,d=u,y=(i+s)/2,c=this.get(y),l=this.get(s),u=ue.getccenter(a,c,l),u.interval={start:i,end:s},h=this._error(u,a,i,s)<=e,g=p&&!h,g||(v=s),h){if(s>=1){if(u.interval.end=v=1,d=u,s>1){let m={x:u.x+u.r*fxe(u.e),y:u.y+u.r*pxe(u.e)};u.e+=ue.angle({x:u.x,y:u.y},m,this.get(1))}break}s=s+(s-i)/2}else s=y;while(!g&&o++<100);if(o>=100)break;d=d||u,r.push(d),i=v}while(s<1);return r}}function s1(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function yxe(n){if(Array.isArray(n))return n}function vxe(n){if(Array.isArray(n))return s1(n)}function xxe(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function bxe(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e!==0)for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function Sxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wxe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _xe(n,e){if(n==null)return{};var r,i,s=Cxe(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],e.includes(r)||{}.propertyIsEnumerable.call(n,r)&&(s[r]=n[r])}return s}function Cxe(n,e){if(n==null)return{};var r={};for(var i in n)if({}.hasOwnProperty.call(n,i)){if(e.includes(i))continue;r[i]=n[i]}return r}function Pxe(n,e){return yxe(n)||bxe(n,e)||bB(n,e)||Sxe()}function Ixe(n){return vxe(n)||xxe(n)||bB(n)||wxe()}function Exe(n,e){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function kxe(n){var e=Exe(n,"string");return typeof e=="symbol"?e:e+""}function bB(n,e){if(n){if(typeof n=="string")return s1(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s1(n,e):void 0}}var Txe=(function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(c){return{keyAccessor:c,isProp:!(c instanceof Function)}}),o=n.reduce(function(c,l){var u=c,d=l;return s.forEach(function(h,p){var g=h.keyAccessor,y=h.isProp,v;if(y){var x=d,m=x[g],b=_xe(x,[g].map(kxe));v=m,d=b}else v=g(d,p);p+1<s.length?(u.hasOwnProperty(v)||(u[v]={}),u=u[v]):r?(u.hasOwnProperty(v)||(u[v]=[]),u[v].push(d)):u[v]=d}),c},{});r instanceof Function&&(function c(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;u===s.length?Object.keys(l).forEach(function(d){return l[d]=r(l[d])}):Object.values(l).forEach(function(d){return c(d,u+1)})})(o);var a=o;return i&&(a=[],(function c(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];u.length===s.length?a.push({keys:u,vals:l}):Object.entries(l).forEach(function(d){var h=Pxe(d,2),p=h[0],g=h[1];return c(g,[].concat(Ixe(u),[p]))})})(o),e instanceof Array&&e.length===0&&a.length===1&&(a[0].keys=[])),a});function Mxe(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const FD=Symbol("implicit");function SB(){var n=new sD,e=[],r=[],i=FD;function s(o){let a=n.get(o);if(a===void 0){if(i!==FD)return i;n.set(o,a=e.push(o)-1)}return r[a%r.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],n=new sD;for(const a of o)n.has(a)||n.set(a,e.push(a)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(i=o,s):i},s.copy=function(){return SB(e,r).unknown(i)},Mxe.apply(s,arguments),s}function Axe(n){for(var e=n.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+n.slice(i*6,++i*6);return r}const jxe=Axe("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Rxe(n,e){e===void 0&&(e={});var r=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}var Oxe=`.force-graph-container canvas {
  display: block;
  user-select: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.force-graph-container .clickable {
  cursor: pointer;
}

.force-graph-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.force-graph-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}
`;Rxe(Oxe);function o1(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,i=Array(e);r<e;r++)i[r]=n[r];return i}function Dxe(n){if(Array.isArray(n))return n}function Nxe(n){if(Array.isArray(n))return o1(n)}function zD(n,e,r){if(wB())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var s=new(n.bind.apply(n,i));return s}function Ll(n,e,r){return(e=Uxe(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function wB(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wB=function(){return!!n})()}function Lxe(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Fxe(n,e){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var i,s,o,a,c=[],l=!0,u=!1;try{if(o=(r=r.call(n)).next,e!==0)for(;!(l=(i=o.call(r)).done)&&(c.push(i.value),c.length!==e);l=!0);}catch(d){u=!0,s=d}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw s}}return c}}function zxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $xe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $D(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,i)}return r}function ta(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$D(Object(r),!0).forEach(function(i){Ll(n,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):$D(Object(r)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(r,i))})}return n}function ul(n,e){return Dxe(n)||Fxe(n,e)||_B(n,e)||zxe()}function Er(n){return Nxe(n)||Lxe(n)||_B(n)||$xe()}function Bxe(n,e){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Uxe(n){var e=Bxe(n,"string");return typeof e=="symbol"?e:e+""}function a1(n){"@babel/helpers - typeof";return a1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a1(n)}function _B(n,e){if(n){if(typeof n=="string")return o1(n,e);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o1(n,e):void 0}}var qxe=SB(jxe);function BD(n,e,r){!e||typeof r!="string"||n.filter(function(i){return!i[r]}).forEach(function(i){i[r]=qxe(e(i))})}function Hxe(n,e){var r=n.nodes,i=n.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,a=o===void 0?function(){return!0}:o,c=s.onLoopError,l=c===void 0?function(g){throw"Invalid DAG structure! Found cycle in node path: ".concat(g.join(" -> "),".")}:c,u={};r.forEach(function(g){return u[e(g)]={data:g,out:[],depth:-1,skip:!a(g)}}),i.forEach(function(g){var y=g.source,v=g.target,x=w(y),m=w(v);if(!u.hasOwnProperty(x))throw"Missing source node with id: ".concat(x);if(!u.hasOwnProperty(m))throw"Missing target node with id: ".concat(m);var b=u[x],S=u[m];b.out.push(S);function w(I){return a1(I)==="object"?e(I):I}});var d=[];p(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(Er(Object.entries(u).filter(function(g){var y=ul(g,2),v=y[1];return!v.skip}).map(function(g){var y=ul(g,2),v=y[0],x=y[1];return Ll({},v,x.depth)}))));return h;function p(g){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,x=function(){var w=g[m];if(y.indexOf(w)!==-1){var I=[].concat(Er(y.slice(y.indexOf(w))),[w]).map(function(C){return e(C.data)});return d.some(function(C){return C.length===I.length&&C.every(function(_,P){return _===I[P]})})||(d.push(I),l(I)),1}v>w.depth&&(w.depth=v,p(w.out,[].concat(Er(y),[w]),v+(w.skip?0:1)))},m=0,b=g.length;m<b;m++)x()}}var Gxe=2,pn=function(e,r){return r.onNeedsRedraw&&r.onNeedsRedraw()},UD=function(e,r){if(!r.isShadow){var i=tt(r.linkDirectionalParticles);r.graphData.links.forEach(function(s){var o=Math.round(Math.abs(i(s)));o?s.__photons=Er(Array(o)).map(function(){return{}}):delete s.__photons})}},Ih=AC({props:{graphData:{default:{nodes:[],links:[]},onChange:function(e,r){r.engineRunning=!1,UD(e,r)}},dagMode:{onChange:function(e,r){!e&&(r.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:pn},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:pn},nodeColor:{default:"color",triggerUpdate:!1,onChange:pn},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:pn},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:pn},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:pn},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:pn},linkColor:{default:"color",triggerUpdate:!1,onChange:pn},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:pn},linkWidth:{default:1,triggerUpdate:!1,onChange:pn},linkCurvature:{default:0,triggerUpdate:!1,onChange:pn},linkCanvasObject:{triggerUpdate:!1,onChange:pn},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:pn},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:pn},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:pn},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:pn},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:UD},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},linkDirectionalParticleCanvasObject:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,r){r.forceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,r){r.forceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,r){r.forceLayout.velocityDecay(e)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(e,r,i){return i===void 0?e.forceLayout.force(r):(e.forceLayout.force(r,i),this)},d3ReheatSimulation:function(e){return e.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},isEngineRunning:function(e){return!!e.engineRunning},tickFrame:function(e){return!e.isShadow&&r(),s(),!e.isShadow&&o(),!e.isShadow&&a(),i(),this;function r(){e.engineRunning&&(++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.forceLayout.tick(),e.onEngineTick()))}function i(){var c=tt(e.nodeVisibility),l=tt(e.nodeVal),u=tt(e.nodeColor),d=tt(e.nodeCanvasObjectMode),h=e.ctx,p=e.isShadow/e.globalScale,g=e.graphData.nodes.filter(c);h.save(),g.forEach(function(y){var v=d(y);if(e.nodeCanvasObject&&(v==="before"||v==="replace")&&(e.nodeCanvasObject(y,h,e.globalScale),v==="replace")){h.restore();return}var x=Math.sqrt(Math.max(0,l(y)||1))*e.nodeRelSize+p;h.beginPath(),h.arc(y.x,y.y,x,0,2*Math.PI,!1),h.fillStyle=u(y)||"rgba(31, 120, 180, 0.92)",h.fill(),e.nodeCanvasObject&&v==="after"&&e.nodeCanvasObject(y,e.ctx,e.globalScale)}),h.restore()}function s(){var c=tt(e.linkVisibility),l=tt(e.linkColor),u=tt(e.linkWidth),d=tt(e.linkLineDash),h=tt(e.linkCurvature),p=tt(e.linkCanvasObjectMode),g=e.ctx,y=e.isShadow*2,v=e.graphData.links.filter(c);v.forEach(C);var x=[],m=[],b=v;if(e.linkCanvasObject){var S=[],w=[];v.forEach(function(_){return({before:x,after:m,replace:S}[p(_)]||w).push(_)}),b=[].concat(Er(x),m,w),x=x.concat(S)}g.save(),x.forEach(function(_){return e.linkCanvasObject(_,g,e.globalScale)}),g.restore();var I=Txe(b,[l,u,d]);g.save(),Object.entries(I).forEach(function(_){var P=ul(_,2),M=P[0],T=P[1],A=!M||M==="undefined"?"rgba(0,0,0,0.15)":M;Object.entries(T).forEach(function(R){var O=ul(R,2),j=O[0],D=O[1],N=(j||1)/e.globalScale+y;Object.entries(D).forEach(function(F){var z=ul(F,2);z[0];var $=z[1],G=d($[0]);g.beginPath(),$.forEach(function(X){var ee=X.source,re=X.target;if(!(!ee||!re||!ee.hasOwnProperty("x")||!re.hasOwnProperty("x"))){g.moveTo(ee.x,ee.y);var B=X.__controlPoints;B?g[B.length===2?"quadraticCurveTo":"bezierCurveTo"].apply(g,Er(B).concat([re.x,re.y])):g.lineTo(re.x,re.y)}}),g.strokeStyle=A,g.lineWidth=N,g.setLineDash(G||[]),g.stroke()})})}),g.restore(),g.save(),m.forEach(function(_){return e.linkCanvasObject(_,g,e.globalScale)}),g.restore();function C(_){var P=h(_);if(!P){_.__controlPoints=null;return}var M=_.source,T=_.target;if(!(!M||!T||!M.hasOwnProperty("x")||!T.hasOwnProperty("x"))){var A=Math.sqrt(Math.pow(T.x-M.x,2)+Math.pow(T.y-M.y,2));if(A>0){var R=Math.atan2(T.y-M.y,T.x-M.x),O=A*P,j={x:(M.x+T.x)/2+O*Math.cos(R-Math.PI/2),y:(M.y+T.y)/2+O*Math.sin(R-Math.PI/2)};_.__controlPoints=[j.x,j.y]}else{var D=P*70;_.__controlPoints=[T.x,T.y-D,T.x+D,T.y]}}}}function o(){var c=1.6,l=.2,u=tt(e.linkDirectionalArrowLength),d=tt(e.linkDirectionalArrowRelPos),h=tt(e.linkVisibility),p=tt(e.linkDirectionalArrowColor||e.linkColor),g=tt(e.nodeVal),y=e.ctx;y.save(),e.graphData.links.filter(h).forEach(function(v){var x=u(v);if(!(!x||x<0)){var m=v.source,b=v.target;if(!(!m||!b||!m.hasOwnProperty("x")||!b.hasOwnProperty("x"))){var S=Math.sqrt(Math.max(0,g(m)||1))*e.nodeRelSize,w=Math.sqrt(Math.max(0,g(b)||1))*e.nodeRelSize,I=Math.min(1,Math.max(0,d(v))),C=p(v)||"rgba(0,0,0,0.28)",_=x/c/2,P=v.__controlPoints&&zD(vt,[m.x,m.y].concat(Er(v.__controlPoints),[b.x,b.y])),M=P?function(N){return P.get(N)}:function(N){return{x:m.x+(b.x-m.x)*N||0,y:m.y+(b.y-m.y)*N||0}},T=P?P.length():Math.sqrt(Math.pow(b.x-m.x,2)+Math.pow(b.y-m.y,2)),A=S+x+(T-S-w-x)*I,R=M(A/T),O=M((A-x)/T),j=M((A-x*(1-l))/T),D=Math.atan2(R.y-O.y,R.x-O.x)-Math.PI/2;y.beginPath(),y.moveTo(R.x,R.y),y.lineTo(O.x+_*Math.cos(D),O.y+_*Math.sin(D)),y.lineTo(j.x,j.y),y.lineTo(O.x-_*Math.cos(D),O.y-_*Math.sin(D)),y.fillStyle=C,y.fill()}}}),y.restore()}function a(){var c=tt(e.linkDirectionalParticles),l=tt(e.linkDirectionalParticleSpeed),u=tt(e.linkDirectionalParticleOffset),d=tt(e.linkDirectionalParticleWidth),h=tt(e.linkVisibility),p=tt(e.linkDirectionalParticleColor||e.linkColor),g=e.ctx;g.save(),e.graphData.links.filter(h).forEach(function(y){var v=c(y);if(!(!y.hasOwnProperty("__photons")||!y.__photons.length)){var x=y.source,m=y.target;if(!(!x||!m||!x.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var b=l(y),S=Math.abs(u(y)),w=y.__photons||[],I=Math.max(0,d(y)/2)/Math.sqrt(e.globalScale),C=p(y)||"rgba(0,0,0,0.28)";g.fillStyle=C;var _=y.__controlPoints?zD(vt,[x.x,x.y].concat(Er(y.__controlPoints),[m.x,m.y])):null,P=0,M=!1;w.forEach(function(T){var A=!!T.__singleHop;if(T.hasOwnProperty("__progressRatio")||(T.__progressRatio=A?0:(P+S)/v),!A&&P++,T.__progressRatio+=b,T.__progressRatio>=1)if(!A)T.__progressRatio=T.__progressRatio%1;else{M=!0;return}var R=T.__progressRatio,O=_?_.get(R):{x:x.x+(m.x-x.x)*R||0,y:x.y+(m.y-x.y)*R||0};e.linkDirectionalParticleCanvasObject?e.linkDirectionalParticleCanvasObject(O.x,O.y,y,g,e.globalScale):(g.beginPath(),g.arc(O.x,O.y,I,0,2*Math.PI,!1),g.fill())}),M&&(y.__photons=y.__photons.filter(function(T){return!T.__singleHop||T.__progressRatio<=1}))}}}),g.restore()}},emitParticle:function(e,r){return r&&(!r.__photons&&(r.__photons=[]),r.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:axe().force("link",J0e()).force("charge",cxe()).force("center",t0e()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,r){r.ctx=e},update:function(e,r){e.engineRunning=!1,e.onUpdate(),e.nodeAutoColorBy!==null&&BD(e.graphData.nodes,tt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&BD(e.graphData.links,tt(e.linkAutoColorBy),e.linkColor),e.graphData.links.forEach(function(p){p.source=p[e.linkSource],p.target=p[e.linkTarget]}),e.forceLayout.stop().alpha(1).nodes(e.graphData.nodes);var i=e.forceLayout.force("link");i&&i.id(function(p){return p[e.nodeId]}).links(e.graphData.links);var s=e.dagMode&&Hxe(e.graphData,function(p){return p[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),o=Math.max.apply(Math,Er(Object.values(s||[]))),a=e.dagLevelDistance||e.graphData.nodes.length/(o||1)*Gxe*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu"].includes(r.dagMode)){var c=["lr","rl"].includes(r.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(p){return delete p[c]})}if(["lr","rl","td","bu"].includes(e.dagMode)){var l=["rl","bu"].includes(e.dagMode),u=function(g){return(s[g[e.nodeId]]-o/2)*a*(l?-1:1)},d=["lr","rl"].includes(e.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(p){return p[d]=u(p)})}e.forceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?lxe(function(p){var g=s[p[e.nodeId]]||-1;return(e.dagMode==="radialin"?o-g:g)*a}).strength(function(p){return e.dagNodeFilter(p)?1:0}):null);for(var h=0;h<e.warmupTicks&&!(e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin);h++)e.forceLayout.tick();this.resetCountdown(),e.onFinishUpdate()}});function CB(n,e){var r=n instanceof Array?n:[n],i=new e;return i._destructor&&i._destructor(),{linkProp:function(o){return{default:i[o](),onChange:function(c,l){r.forEach(function(u){return l[u][o](c)})},triggerUpdate:!1}},linkMethod:function(o){return function(a){for(var c=arguments.length,l=new Array(c>1?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];var d=[];return r.forEach(function(h){var p=a[h],g=p[o].apply(p,l);g!==p&&d.push(g)}),d.length?d[0]:this}}}}var Kxe=800,Vxe=4,Wxe=5,PB=CB("forceGraph",Ih),Yxe=CB(["forceGraph","shadowGraph"],Ih),Xxe=Object.assign.apply(Object,Er(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleCanvasObject","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return Ll({},n,PB.linkProp(n))})).concat(Er(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(n){return Ll({},n,Yxe.linkProp(n))})))),Zxe=Object.assign.apply(Object,Er(["d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return Ll({},n,PB.linkMethod(n))})));function HS(n){if(n.canvas){var e=n.canvas.width,r=n.canvas.height;e===300&&r===150&&(e=r=0);var i=window.devicePixelRatio;e/=i,r/=i,[n.canvas,n.shadowCanvas].forEach(function(o){o.style.width="".concat(n.width,"px"),o.style.height="".concat(n.height,"px"),o.width=n.width*i,o.height=n.height*i,!e&&!r&&o.getContext("2d").scale(i,i)});var s=Br(n.canvas).k;n.zoom.translateBy(n.zoom.__baseElem,(n.width-e)/2/s,(n.height-r)/2/s),n.needsRedraw=!0}}function IB(n){var e=window.devicePixelRatio;n.setTransform(e,0,0,e,0,0)}function qD(n,e,r){n.save(),IB(n),n.clearRect(0,0,e,r),n.restore()}var Qxe=AC({props:ta({width:{default:window.innerWidth,onChange:function(e,r){return HS(r)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(e,r){return HS(r)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,r){[e.nodes,e.links].every(function(s){return(s||[]).every(function(o){return!o.hasOwnProperty("__indexColor")})})&&r.colorTracker.reset(),[{type:"Node",objs:e.nodes},{type:"Link",objs:e.links}].forEach(i),r.forceGraph.graphData(e),r.shadowGraph.graphData(e);function i(s){var o=s.type,a=s.objs;a.filter(function(c){if(!c.hasOwnProperty("__indexColor"))return!0;var l=r.colorTracker.lookup(c.__indexColor);return!l||!l.hasOwnProperty("d")||l.d!==c}).forEach(function(c){c.__indexColor=r.colorTracker.register({type:o,d:c})})}},triggerUpdate:!1},backgroundColor:{onChange:function(e,r){r.canvas&&e&&(r.canvas.style.background=e)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(e,r){r.shadowGraph.nodeCanvasObject(e?function(i,s,o){return e(i,i.__indexColor,s,o)}:null),r.flushShadowCanvas&&r.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(e,r){r.shadowGraph.linkCanvasObject(e?function(i,s,o){return e(i,i.__indexColor,s,o)}:null),r.flushShadowCanvas&&r.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(e,r){r.zoom.scaleExtent([e,r.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(e,r){r.zoom.scaleExtent([r.zoom.scaleExtent()[0],e])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(e,r){r.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},Xxe),aliases:{stopAnimation:"pauseAnimation"},methods:ta({graph2ScreenCoords:function(e,r,i){var s=Br(e.canvas);return{x:r*s.k+s.x,y:i*s.k+s.y}},screen2GraphCoords:function(e,r,i){var s=Br(e.canvas);return{x:(r-s.x)/s.k,y:(i-s.y)/s.k}},centerAt:function(e,r,i,s){if(!e.canvas)return null;if(r!==void 0||i!==void 0){var o=Object.assign({},r!==void 0?{x:r}:{},i!==void 0?{y:i}:{});return s?e.tweenGroup.add(new hD(a()).to(o,s).easing(vo.Quadratic.Out).onUpdate(c).start()):c(o),this}return a();function a(){var l=Br(e.canvas);return{x:(e.width/2-l.x)/l.k,y:(e.height/2-l.y)/l.k}}function c(l){var u=l.x,d=l.y;e.zoom.translateTo(e.zoom.__baseElem,u===void 0?a().x:u,d===void 0?a().y:d),e.needsRedraw=!0}},zoom:function(e,r,i){if(!e.canvas)return null;if(r!==void 0)return i?e.tweenGroup.add(new hD({k:s()}).to({k:r},i).easing(vo.Quadratic.Out).onUpdate(function(a){var c=a.k;return o(c)}).start()):o(r),this;return s();function s(){return Br(e.canvas).k}function o(a){e.zoom.scaleTo(e.zoom.__baseElem,a),e.needsRedraw=!0}},zoomToFit:function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];var c=this.getGraphBbox.apply(this,o);if(c){var l={x:(c.x[0]+c.x[1])/2,y:(c.y[0]+c.y[1])/2},u=Math.max(1e-12,Math.min(1e12,(e.width-i*2)/(c.x[1]-c.x[0]),(e.height-i*2)/(c.y[1]-c.y[0])));this.centerAt(l.x,l.y,r),this.zoom(u,r)}return this},getGraphBbox:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=tt(e.nodeVal),s=function(c){return Math.sqrt(Math.max(0,i(c)||1))*e.nodeRelSize},o=e.graphData.nodes.filter(r).map(function(a){return{x:a.x,y:a.y,r:s(a)}});return o.length?{x:[cD(o,function(a){return a.x-a.r}),aD(o,function(a){return a.x+a.r})],y:[cD(o,function(a){return a.y-a.r}),aD(o,function(a){return a.y+a.r})]}:null},pauseAnimation:function(e){return e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Zxe),stateInit:function(){return{lastSetZoom:1,zoom:b1(),forceGraph:new Ih,shadowGraph:new Ih().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new Rve,tweenGroup:new W8}},init:function(e,r){var i=this;e.innerHTML="";var s=document.createElement("div");s.classList.add("force-graph-container"),s.style.position="relative",e.appendChild(s),r.canvas=document.createElement("canvas"),r.backgroundColor&&(r.canvas.style.background=r.backgroundColor),s.appendChild(r.canvas),r.shadowCanvas=document.createElement("canvas");var o=r.canvas.getContext("2d"),a=r.shadowCanvas.getContext("2d",{willReadFrequently:!0}),c={x:-1e12,y:-1e12},l=function(){var h=null,p=window.devicePixelRatio,g=c.x>0&&c.y>0?a.getImageData(c.x*p,c.y*p,1,1):null;return g&&(h=r.colorTracker.lookup(g.data)),h};xn(r.canvas).call(f1().subject(function(){if(!r.enableNodeDrag)return null;var d=l();return d&&d.type==="Node"?d.d:null}).on("start",function(d){var h=d.subject;h.__initialDragPos={x:h.x,y:h.y,fx:h.fx,fy:h.fy},d.active||(h.fx=h.x,h.fy=h.y),r.canvas.classList.add("grabbable")}).on("drag",function(d){var h=d.subject,p=h.__initialDragPos,g=d,y=Br(r.canvas).k,v={x:p.x+(g.x-p.x)/y-h.x,y:p.y+(g.y-p.y)/y-h.y};["x","y"].forEach(function(x){return h["f".concat(x)]=h[x]=p[x]+(g[x]-p[x])/y}),!(!h.__dragged&&Wxe>=Math.sqrt(fye(["x","y"].map(function(x){return Math.pow(d[x]-p[x],2)}))))&&(r.forceGraph.d3AlphaTarget(.3).resetCountdown(),r.isPointerDragging=!0,h.__dragged=!0,r.onNodeDrag(h,v))}).on("end",function(d){var h=d.subject,p=h.__initialDragPos,g={x:h.x-p.x,y:h.y-p.y};p.fx===void 0&&(h.fx=void 0),p.fy===void 0&&(h.fy=void 0),delete h.__initialDragPos,r.forceGraph.d3AlphaTarget()&&r.forceGraph.d3AlphaTarget(0).resetCountdown(),r.canvas.classList.remove("grabbable"),r.isPointerDragging=!1,h.__dragged&&(delete h.__dragged,r.onNodeDragEnd(h,g))})),r.zoom(r.zoom.__baseElem=xn(r.canvas)),r.zoom.__baseElem.on("dblclick.zoom",null),r.zoom.filter(function(d){return!d.button&&r.enableZoomPanInteraction&&(d.type!=="wheel"||tt(r.enableZoomInteraction)(d))&&(d.type==="wheel"||tt(r.enablePanInteraction)(d))}).on("zoom",function(d){var h=d.transform;[o,a].forEach(function(p){IB(p),p.translate(h.x,h.y),p.scale(h.k,h.k)}),r.isPointerDragging=!0,r.onZoom&&r.onZoom(ta(ta({},h),i.centerAt())),r.needsRedraw=!0}).on("end",function(d){r.isPointerDragging=!1,r.onZoomEnd&&r.onZoomEnd(ta(ta({},d.transform),i.centerAt()))}),HS(r),r.forceGraph.onNeedsRedraw(function(){return r.needsRedraw=!0}).onFinishUpdate(function(){Br(r.canvas).k===r.lastSetZoom&&r.graphData.nodes.length&&(r.zoom.scaleTo(r.zoom.__baseElem,r.lastSetZoom=Vxe/Math.cbrt(r.graphData.nodes.length)),r.needsRedraw=!0)}),r.tooltip=new e0e(s),["pointermove","pointerdown"].forEach(function(d){return s.addEventListener(d,function(h){d==="pointerdown"&&(r.isPointerPressed=!0,r.pointerDownEvent=h),!r.isPointerDragging&&h.type==="pointermove"&&r.onBackgroundClick&&(h.pressure>0||r.isPointerPressed)&&(h.pointerType==="mouse"||h.movementX===void 0||[h.movementX,h.movementY].some(function(y){return Math.abs(y)>1}))&&(r.isPointerDragging=!0);var p=g(s);c.x=h.pageX-p.left,c.y=h.pageY-p.top;function g(y){var v=y.getBoundingClientRect(),x=window.pageXOffset||document.documentElement.scrollLeft,m=window.pageYOffset||document.documentElement.scrollTop;return{top:v.top+m,left:v.left+x}}},{passive:!0})}),s.addEventListener("pointerup",function(d){if(r.isPointerPressed){if(r.isPointerPressed=!1,r.isPointerDragging){r.isPointerDragging=!1;return}var h=[d,r.pointerDownEvent];requestAnimationFrame(function(){if(d.button===0)if(r.hoverObj){var p=r["on".concat(r.hoverObj.type,"Click")];p&&p.apply(void 0,[r.hoverObj.d].concat(h))}else r.onBackgroundClick&&r.onBackgroundClick.apply(r,h);if(d.button===2)if(r.hoverObj){var g=r["on".concat(r.hoverObj.type,"RightClick")];g&&g.apply(void 0,[r.hoverObj.d].concat(h))}else r.onBackgroundRightClick&&r.onBackgroundRightClick.apply(r,h)})}},{passive:!0}),s.addEventListener("contextmenu",function(d){return!r.onBackgroundRightClick&&!r.onNodeRightClick&&!r.onLinkRightClick?!0:(d.preventDefault(),!1)}),r.forceGraph(o),r.shadowGraph(a);var u=$ye(function(){qD(a,r.width,r.height),r.shadowGraph.linkWidth(function(h){return tt(r.linkWidth)(h)+r.linkHoverPrecision});var d=Br(r.canvas);r.shadowGraph.globalScale(d.k).tickFrame()},Kxe);r.flushShadowCanvas=u.flush,(this._animationCycle=function d(){var h=!r.autoPauseRedraw||!!r.needsRedraw||r.forceGraph.isEngineRunning()||r.graphData.links.some(function(S){return S.__photons&&S.__photons.length});if(r.needsRedraw=!1,r.enablePointerInteraction){var p=r.isPointerDragging?null:l();if(p!==r.hoverObj){var g=r.hoverObj,y=g?g.type:null,v=p?p.type:null;if(y&&y!==v){var x=r["on".concat(y,"Hover")];x&&x(null,g.d)}if(v){var m=r["on".concat(v,"Hover")];m&&m(p.d,y===v?g.d:null)}r.tooltip.content(p&&tt(r["".concat(p.type.toLowerCase(),"Label")])(p.d)||null),r.canvas.classList[(p&&r["on".concat(v,"Click")]||!p&&r.onBackgroundClick)&&tt(r.showPointerCursor)(p?.d)?"add":"remove"]("clickable"),r.hoverObj=p}h&&u()}if(h){qD(o,r.width,r.height);var b=Br(r.canvas).k;r.onRenderFramePre&&r.onRenderFramePre(o,b),r.forceGraph.globalScale(b).tickFrame(),r.onRenderFramePost&&r.onRenderFramePost(o,b)}r.tweenGroup.update(),r.animationFrameRequestId=requestAnimationFrame(d)})()},update:function(e){}}),GS={exports:{}},KS,HD;function Jxe(){if(HD)return KS;HD=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return KS=n,KS}var VS,GD;function ebe(){if(GD)return VS;GD=1;var n=Jxe();function e(){}function r(){}return r.resetWarningCache=e,VS=function(){function i(a,c,l,u,d,h){if(h!==n){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}i.isRequired=i;function s(){return i}var o={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:s,element:i,elementType:i,instanceOf:s,node:i,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:r,resetWarningCache:e};return o.PropTypes=o,o},VS}var KD;function tbe(){return KD||(KD=1,GS.exports=ebe()()),GS.exports}var nbe=tbe();const q=rs(nbe),Xf={width:q.number,height:q.number,graphData:q.shape({nodes:q.arrayOf(q.object).isRequired,links:q.arrayOf(q.object).isRequired}),backgroundColor:q.string,nodeRelSize:q.number,nodeId:q.string,nodeLabel:q.oneOfType([q.string,q.func]),nodeVal:q.oneOfType([q.number,q.string,q.func]),nodeVisibility:q.oneOfType([q.bool,q.string,q.func]),nodeColor:q.oneOfType([q.string,q.func]),nodeAutoColorBy:q.oneOfType([q.string,q.func]),onNodeHover:q.func,onNodeClick:q.func,linkSource:q.string,linkTarget:q.string,linkLabel:q.oneOfType([q.string,q.func]),linkVisibility:q.oneOfType([q.bool,q.string,q.func]),linkColor:q.oneOfType([q.string,q.func]),linkAutoColorBy:q.oneOfType([q.string,q.func]),linkWidth:q.oneOfType([q.number,q.string,q.func]),linkCurvature:q.oneOfType([q.number,q.string,q.func]),linkDirectionalArrowLength:q.oneOfType([q.number,q.string,q.func]),linkDirectionalArrowColor:q.oneOfType([q.string,q.func]),linkDirectionalArrowRelPos:q.oneOfType([q.number,q.string,q.func]),linkDirectionalParticles:q.oneOfType([q.number,q.string,q.func]),linkDirectionalParticleSpeed:q.oneOfType([q.number,q.string,q.func]),linkDirectionalParticleOffset:q.oneOfType([q.number,q.string,q.func]),linkDirectionalParticleWidth:q.oneOfType([q.number,q.string,q.func]),linkDirectionalParticleColor:q.oneOfType([q.string,q.func]),onLinkHover:q.func,onLinkClick:q.func,dagMode:q.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:q.number,dagNodeFilter:q.func,onDagError:q.func,d3AlphaMin:q.number,d3AlphaDecay:q.number,d3VelocityDecay:q.number,warmupTicks:q.number,cooldownTicks:q.number,cooldownTime:q.number,onEngineTick:q.func,onEngineStop:q.func,getGraphBbox:q.func},EB={zoomToFit:q.func,onNodeRightClick:q.func,onNodeDrag:q.func,onNodeDragEnd:q.func,onLinkRightClick:q.func,linkHoverPrecision:q.number,onBackgroundClick:q.func,onBackgroundRightClick:q.func,showPointerCursor:q.oneOfType([q.bool,q.func]),enablePointerInteraction:q.bool,enableNodeDrag:q.bool},zC={showNavInfo:q.bool,nodeOpacity:q.number,nodeResolution:q.number,nodeThreeObject:q.oneOfType([q.object,q.string,q.func]),nodeThreeObjectExtend:q.oneOfType([q.bool,q.string,q.func]),nodePositionUpdate:q.func,linkOpacity:q.number,linkResolution:q.number,linkCurveRotation:q.oneOfType([q.number,q.string,q.func]),linkMaterial:q.oneOfType([q.object,q.string,q.func]),linkThreeObject:q.oneOfType([q.object,q.string,q.func]),linkThreeObjectExtend:q.oneOfType([q.bool,q.string,q.func]),linkPositionUpdate:q.func,linkDirectionalArrowResolution:q.number,linkDirectionalParticleResolution:q.number,linkDirectionalParticleThreeObject:q.oneOfType([q.object,q.string,q.func]),forceEngine:q.oneOf(["d3","ngraph"]),ngraphPhysics:q.object,numDimensions:q.oneOf([1,2,3])},rbe=Object.assign({},Xf,EB,{linkLineDash:q.oneOfType([q.arrayOf(q.number),q.string,q.func]),nodeCanvasObjectMode:q.oneOfType([q.string,q.func]),nodeCanvasObject:q.func,nodePointerAreaPaint:q.func,linkCanvasObjectMode:q.oneOfType([q.string,q.func]),linkCanvasObject:q.func,linkPointerAreaPaint:q.func,linkDirectionalParticleCanvasObject:q.func,autoPauseRedraw:q.bool,minZoom:q.number,maxZoom:q.number,enableZoomInteraction:q.oneOfType([q.bool,q.func]),enablePanInteraction:q.oneOfType([q.bool,q.func]),onZoom:q.func,onZoomEnd:q.func,onRenderFramePre:q.func,onRenderFramePost:q.func});Object.assign({},Xf,EB,zC,{enableNavigationControls:q.bool,controlType:q.oneOf(["trackball","orbit","fly"]),rendererConfig:q.object,extraRenderers:q.arrayOf(q.shape({render:q.func.isRequired}))});Object.assign({},Xf,zC,{nodeDesc:q.oneOfType([q.string,q.func]),linkDesc:q.oneOfType([q.string,q.func])});Object.assign({},Xf,zC,{markerAttrs:q.object,yOffset:q.number,glScale:q.number});const $C=lye(Qxe,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});$C.displayName="ForceGraph2D";$C.propTypes=rbe;const kB=hU;function VD(n){const e=n.split("/")[0];return kB[e]||"#6366f1"}function ibe({onNodeClick:n}){const e=E.useRef(null),r=E.useRef(null),[i,s]=E.useState({nodes:[],links:[]}),[o,a]=E.useState(!0),[c,l]=E.useState(null),[u,d]=E.useState(null),[h,p]=E.useState(null),[g,y]=E.useState(1),[v,x]=E.useState(new Set),[m,b]=E.useState(!1);E.useEffect(()=>{const T=e.current;if(!T)return;const A=()=>{const O=T.getBoundingClientRect();d({width:Math.max(1,Math.floor(O.width)-2),height:Math.max(1,Math.floor(O.height)-2)})};A();const R=new ResizeObserver(A);return R.observe(T),()=>R.disconnect()},[]),E.useEffect(()=>{let T=!1;return a(!0),Cr.obsidian.getGraph().then(A=>{T||(A.success?s({nodes:A.nodes,links:A.links}):l("Failed to load graph data"),a(!1))}).catch(()=>{T||(l("Network error loading graph"),a(!1))}),()=>{T=!0}},[]);const S=E.useMemo(()=>{const T=new Set;for(const A of i.nodes){const R=A.folder?.split("/")[0]||"(root)";T.add(R)}return Array.from(T).sort()},[i.nodes]);E.useEffect(()=>{S.length>0&&!m&&(b(!0),x(new Set(S)))},[S,m]);const w=E.useMemo(()=>{if(v.size===0||v.size===S.length)return i;const T=new Set,A=i.nodes.filter(O=>{const j=O.folder?.split("/")[0]||"(root)",D=v.has(j);return D&&T.add(O.id),D}),R=i.links.filter(O=>{const j=typeof O.source=="string"?O.source:O.source.id,D=typeof O.target=="string"?O.target:O.target.id;return T.has(j)&&T.has(D)});return{nodes:A,links:R}},[i,v,S.length]),I=T=>{x(A=>{const R=new Set(A);return R.has(T)?R.delete(T):R.add(T),R})},C=E.useCallback(T=>{n?.(T.name)},[n]),_=E.useCallback(T=>{const A=Math.max(.1,Math.min(10,T));y(A);const R=r.current;R?.zoom&&R.zoom(A,200)},[]),P=E.useCallback((T,A,R)=>{const O=T.name,j=Math.max(10/R,2),D=Math.max(4,3+w.links.filter($=>(typeof $.source=="string"?$.source:$.source.id)===T.id||(typeof $.target=="string"?$.target:$.target.id)===T.id).length*.5),N=VD(T.folder),F=h?.id===T.id;A.beginPath(),A.arc(T.x||0,T.y||0,D,0,2*Math.PI),A.fillStyle=F?"#ffffff":N,A.fill(),(F||R>.4)&&(A.font=`${j}px monospace`,A.textAlign="center",A.textBaseline="top",A.fillStyle=F?"rgba(255,255,255,1)":"rgba(255,255,255,0.7)",A.fillText(O,T.x||0,(T.y||0)+D+2))},[w.links,h]),M=!o&&!c&&u;return f.jsxs("div",{className:"flex h-full",children:[f.jsx("div",{className:"w-[140px] shrink-0 border-r border-secondary/30 bg-black/60",children:f.jsx(oN,{className:"h-full",children:f.jsxs("div",{className:"p-3 space-y-3",children:[f.jsx("div",{className:"font-arcade text-xs text-primary mb-2",children:"FOLDERS"}),f.jsxs("label",{className:"flex items-center gap-2 py-1 cursor-pointer",children:[f.jsx(sa,{checked:v.size===S.length,onCheckedChange:T=>{x(T?new Set(S):new Set)},className:"border-primary data-[state=checked]:bg-primary"}),f.jsx("span",{className:"font-terminal text-xs text-primary",children:"All Folders"})]}),S.map(T=>f.jsxs("label",{className:"flex items-center gap-2 py-0.5 cursor-pointer",children:[f.jsx(sa,{checked:v.has(T),onCheckedChange:()=>I(T),className:"border-primary data-[state=checked]:bg-primary"}),f.jsx("span",{className:"font-terminal text-xs truncate",style:{color:VD(T==="(root)"?"":T)},children:T})]},T)),f.jsxs("div",{className:"pt-2 border-t border-secondary/30 space-y-1",children:[f.jsx("div",{className:"font-arcade text-xs text-muted-foreground mb-1",children:"COLORS"}),Object.entries(kB).filter(([T])=>T).map(([T,A])=>f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:A}}),f.jsx("span",{className:"font-terminal text-xs",style:{color:A},children:T})]},T))]}),f.jsxs("div",{className:"pt-2 border-t border-secondary/30 font-terminal text-xs text-muted-foreground",children:[f.jsxs("div",{children:["Notes: ",w.nodes.length]}),f.jsxs("div",{children:["Links: ",w.links.length]})]})]})})}),f.jsxs("div",{ref:e,className:"flex-1 relative bg-black/80 rounded border border-primary/30 overflow-hidden",children:[o&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-primary font-terminal z-10",children:f.jsx("div",{className:"animate-pulse",children:"SCANNING VAULT CONNECTIONS..."})}),c&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400 font-terminal z-10",children:c}),M&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"absolute top-2 left-2 right-2 z-10 flex items-center justify-between pointer-events-none",children:[f.jsx("div",{className:"flex items-center gap-2 pointer-events-auto",children:f.jsx("button",{onClick:()=>{r.current?.zoomToFit?.(400,40),setTimeout(()=>{const T=r.current;T?.zoom&&y(T.zoom())},450)},className:"px-2 py-0.5 text-xs font-terminal bg-primary/20 border border-primary/40 text-primary hover:bg-primary/30 rounded-none",children:"CENTER"})}),f.jsxs("div",{className:"flex items-center gap-1.5 pointer-events-auto bg-black/70 border border-primary/30 rounded-none px-2 py-1",children:[f.jsx("button",{onClick:()=>_(g/1.3),className:"text-primary hover:text-white font-mono text-sm w-5 h-5 flex items-center justify-center",children:"-"}),f.jsx("input",{type:"range",min:-2.3,max:2.3,step:.01,value:Math.log(g),onChange:T=>_(Math.exp(parseFloat(T.target.value))),className:"w-24 h-1 accent-primary cursor-pointer"}),f.jsx("button",{onClick:()=>_(g*1.3),className:"text-primary hover:text-white font-mono text-sm w-5 h-5 flex items-center justify-center",children:"+"}),f.jsxs("span",{className:"text-xs font-terminal text-primary/50 w-8 text-right",children:[Math.round(g*100),"%"]})]})]}),f.jsx($C,{ref:r,graphData:w,width:u.width,height:u.height,nodeCanvasObject:P,nodePointerAreaPaint:(T,A,R)=>{R.beginPath(),R.arc(T.x||0,T.y||0,6,0,2*Math.PI),R.fillStyle=A,R.fill()},onNodeClick:C,onNodeHover:T=>p(T),onZoom:({k:T})=>y(T),linkColor:()=>"rgba(255, 80, 80, 0.35)",linkWidth:1.5,backgroundColor:"transparent",cooldownTicks:100,d3AlphaDecay:.02,d3VelocityDecay:.3})]})]})]})}const yd={mode:"vault",isDirty:!1,nodeCount:0,edgeCount:0,canUndo:!1,canRedo:!1,supportsMermaid:!1,supportsDraw:!1,selectedLabels:[]},sbe=[{id:"mindmap",label:"Mind Map"},{id:"structured",label:"Structured"},{id:"freehand",label:"Freehand"},{id:"vault",label:"Vault Graph"}],WD={mindmap:{...yd,mode:"mindmap",supportsMermaid:!0,supportsDraw:!0},structured:{...yd,mode:"structured",supportsMermaid:!0},freehand:{...yd,mode:"freehand",supportsDraw:!0},vault:{...yd,mode:"vault"}},obe=[{name:"Simple Mind Map",mermaid:`graph LR
  A[Topic] --> B[Branch A]
  A --> C[Branch B]
  B --> D[Detail]
  C --> E[Detail]`},{name:"Decision Flow",mermaid:`graph TD
  A[Start] --> B{Decision}
  B -->|Yes| C[Action 1]
  B -->|No| D[Action 2]
  C --> E[End]
  D --> E`},{name:"Concept Chain",mermaid:`graph TD
  A[Concept 1] --> B[Concept 2]
  B --> C[Concept 3]
  C --> D[Clinical Link]`}];function Wbe(){const[n,e]=E.useState("mindmap"),[r,i]=E.useState(null),[s,o]=E.useState(WD),[a,c]=E.useState(!1),[l,u]=E.useState(""),[d,h]=E.useState(!1),[p,g]=E.useState(!1),y=E.useRef(0),{toast:v}=Eh(),x=s[n]||WD[n],m=E.useCallback((P,M,T)=>{const A=T||n;y.current+=1,i({id:y.current,target:A,type:P,payload:M})},[n]),b=E.useCallback(P=>{o(M=>({...M,[P.mode]:P}))},[]),S=E.useCallback(()=>{const P=l.trim();if(!P)return;const M=n==="freehand"?"structured":n;if(M==="vault"){v({title:"Import not available",description:"Switch to Mind Map or Structured mode",variant:"destructive"});return}n==="freehand"&&e("structured"),m("import_mermaid",P,M),c(!1),u("")},[l,n,m,v]),w=E.useCallback(async P=>{const M=x.selectedLabels.length>0?x.selectedLabels:[`${n} selection`],T=[`## ${new Date().toISOString()}  ${P}`,`- Mode: ${n}`,`- Labels: ${M.join(", ")}`,""];try{g(!0),await Cr.obsidian.append("Study Sessions/Brain Canvas Actions.md",`${T.join(`
`)}
`),v({title:"Study action saved",description:P})}catch(A){v({title:"Action failed",description:String(A),variant:"destructive"})}finally{g(!1)}},[x.selectedLabels,n,v]),I=n!=="vault",C=x.supportsMermaid&&n!=="vault",_=E.useMemo(()=>n==="mindmap"?f.jsx(Hme,{hideToolbar:!0,externalCommand:r,onStatusChange:b}):n==="structured"?f.jsx(dZ,{hideToolbar:!0,externalCommand:r,onStatusChange:b}):n==="freehand"?f.jsx(Rme,{hideToolbar:!0,externalCommand:r,onStatusChange:b,onImportMermaid:P=>{e("structured"),m("import_mermaid",P,"structured")}}):f.jsx(ibe,{}),[n,r,b]);return f.jsxs("div",{className:"flex flex-col h-full",children:[f.jsx("div",{className:"tab-sub-bar",role:"tablist","aria-label":"Canvas mode",children:sbe.map(P=>f.jsx("button",{role:"tab","aria-selected":n===P.id,onClick:()=>e(P.id),className:Kt("tab-sub-item",n===P.id&&"active"),children:P.label},P.id))}),f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-primary/20 bg-black/40 shrink-0 flex-wrap",children:[f.jsx(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:()=>m("undo"),disabled:!I||!x.canUndo,title:"Undo",children:f.jsx(bN,{className:"w-3 h-3"})}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:()=>m("redo"),disabled:!I||!x.canRedo,title:"Redo",children:f.jsx(xN,{className:"w-3 h-3"})}),f.jsx("div",{className:"w-px h-4 bg-primary/20"}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>m("save"),disabled:!I,title:"Save",children:[f.jsx(Rh,{className:"w-3 h-3 mr-1"}),"Save"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>c(P=>!P),disabled:!C,title:"Import Mermaid",children:[f.jsx(pN,{className:"w-3 h-3 mr-1"}),"Import"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>m("export_mermaid"),disabled:!C,title:"Export Mermaid",children:[f.jsx(lN,{className:"w-3 h-3 mr-1"}),"Mermaid"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>m("export_png"),disabled:!I,title:"Export PNG",children:[f.jsx(Oh,{className:"w-3 h-3 mr-1"}),"PNG"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>m("add_node"),disabled:!I,title:"Add node",children:[f.jsx(Dh,{className:"w-3 h-3 mr-1"}),"Add"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>{const P=window.prompt("Find text");P&&window.find(P)},title:"Search",children:[f.jsx(bU,{className:"w-3 h-3 mr-1"}),"Search"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>h(P=>!P),disabled:!C,title:"Templates",children:[f.jsx(DU,{className:"w-3 h-3 mr-1"}),"Templates"]}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-xs",onClick:()=>v({title:"Canvas settings",description:"Direction, layout, and draw controls live in mode tools."}),title:"Settings",children:[f.jsx(xU,{className:"w-3 h-3 mr-1"}),"Settings"]}),f.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs font-terminal text-muted-foreground",children:[f.jsxs("span",{children:[x.nodeCount,"N / ",x.edgeCount,"E"]}),f.jsx("span",{className:Kt("w-2 h-2 rounded-full",x.isDirty?"bg-destructive":"bg-success")}),f.jsx("span",{children:x.isDirty?"Unsaved":"Saved"})]})]}),(a||d)&&f.jsxs("div",{className:"shrink-0 px-3 py-2 border-b border-primary/20 bg-black/40 flex flex-col gap-2",children:[a&&f.jsxs(f.Fragment,{children:[f.jsx("p",{className:"font-arcade text-xs text-primary",children:"IMPORT MERMAID"}),f.jsx("textarea",{value:l,onChange:P=>u(P.target.value),placeholder:`graph TD
  A[Topic] --> B[Branch]`,className:"min-h-[72px] w-full px-2 py-1.5 font-mono text-xs bg-black/60 border border-primary/30 rounded-none text-foreground placeholder:text-muted-foreground resize-y",rows:4}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(De,{size:"sm",className:"rounded-none font-terminal text-xs",onClick:S,disabled:!l.trim(),children:"Import"}),f.jsx(De,{size:"sm",variant:"outline",className:"rounded-none font-terminal text-xs border-primary/30",onClick:()=>c(!1),children:"Cancel"})]})]}),d&&f.jsxs(f.Fragment,{children:[f.jsx("p",{className:"font-arcade text-xs text-primary",children:"TEMPLATES"}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:obe.map(P=>f.jsxs("button",{className:"text-left px-3 py-2 border border-primary/30 hover:border-primary/60 hover:bg-primary/10 rounded-none",onClick:()=>{const M=n==="freehand"?"structured":n;M!=="vault"&&(n==="freehand"&&e("structured"),m("import_mermaid",P.mermaid,M),h(!1))},children:[f.jsx("div",{className:"font-arcade text-xs text-primary",children:P.name}),f.jsx("div",{className:"font-terminal text-xs text-muted-foreground truncate",children:P.mermaid.split(`
`)[0]})]},P.name))})]})]}),f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-primary/20 bg-black/30 shrink-0 flex-wrap",children:[f.jsx("span",{className:"font-arcade text-[10px] text-muted-foreground mr-1",children:"STUDY TOOLS"}),f.jsxs(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 rounded-none font-terminal text-xs",onClick:()=>void w("Generate Summary"),disabled:p,children:[f.jsx(lU,{className:"w-3 h-3 mr-1"}),"Summary"]}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 rounded-none font-terminal text-xs",onClick:()=>void w("Generate Quiz"),disabled:p,children:"Quiz"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 rounded-none font-terminal text-xs",onClick:()=>void w("Generate Flashcards"),disabled:p,children:"Cards"}),f.jsx(De,{size:"sm",variant:"ghost",className:"h-6 px-1.5 rounded-none font-terminal text-xs",onClick:()=>void w("Mark Weak Area"),disabled:p,children:"Weak"})]}),f.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:_})]})}export{Wbe as UnifiedBrainCanvas};
