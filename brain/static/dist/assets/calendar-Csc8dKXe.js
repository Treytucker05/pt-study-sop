import{c as Wr,r as x,j as e,b as U,i as Jr,k as Vt,R as Xr,f as Zt,e as es,P as pt,g as ts,d as rs,u as ft,X as Bt,a as Wt}from"./index-Dq2i42cU.js";import{w as ss,x as as,B as M,g as De,i as Te,k as Re,l as Ae,I as Y,t as Le,v as ut,n as ke,y as ns,z as Jt,f as se,u as q,a as Q,S as mt,L as os,j as Yt,G as ls}from"./layout-MVbPqDQb.js";import{C as Xt,a as er,b as is,d as ds,B as rt,c as cs}from"./badge-BA71vPQw.js";import{C as Me}from"./checkbox-DS-B7bFA.js";import{S as Z,a as B,b as W,c as J,d as N}from"./select-DYp6QAUH.js";import{t as ee,l as xt,m as us,n as oe,o as ms,q as xs,r as hs,s as gs,v as tr,c as ps,e as fs,w as ys,C as Ke,x as bs,K as le,y as js,z as vs,A as Ns,B as Es,E as ws,p as rr,i as sr,j as z,f as he,g as Cs,h as Ss,u as ar,a as ht,F as st,G as $t,k as nr,H as Is,D as or,I as lr,P as ir,J as ks,b as Ds}from"./parseISO-DfGvJzBc.js";import{P as qe}from"./plus-DkBY5gKF.js";import{C as yt,a as Ts}from"./index-w1J5KrVK.js";import{C as Rs}from"./clock-DNmmqlQe.js";import{L as As}from"./link-tc9zKSjb.js";import{L as Ls}from"./loader-circle-CucYDA9g.js";import{S as Ms}from"./send-CZYNsg88.js";import{R as dr}from"./refresh-cw-BOYL3V07.js";import{E as Os}from"./external-link-BMMFd1O-.js";import{E as _s}from"./colors-BDuz-soV.js";import{S as Fs}from"./search-DYkyF6sy.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],cr=Wr("text-align-start",Ps);function gt(s,a){const r=ee(s);if(isNaN(a))return xt(s,NaN);if(!a)return r;const o=r.getDate(),l=xt(s,r.getTime());l.setMonth(r.getMonth()+a+1,0);const p=l.getDate();return o>=p?l:(r.setFullYear(l.getFullYear(),l.getMonth(),o),r)}function Us(s,a){const r=+ee(s);return xt(s,r+a)}function Ys(s,a){return Us(s,a*us)}function ur(s,a){const r=a*7;return oe(s,r)}function $s(s){return a=>{const r=Math.trunc,o=r(a);return o===0?0:o}}function zs(s,a){return+ee(s)-+ee(a)}function zt(s,a,r){const o=zs(s,a)/ms;return $s()(o)}function at(s){const a=ee(s),r=a.getMonth();return a.setFullYear(a.getFullYear(),r+1,0),a.setHours(23,59,59,999),a}function nt(s,a){const r=ee(s.start),o=ee(s.end);let l=+r>+o;const p=l?+r:+o,h=l?o:r;h.setHours(0,0,0,0);let f=1;const j=[];for(;+h<=p;)j.push(ee(h)),h.setDate(h.getDate()+f),h.setHours(0,0,0,0);return l?j.reverse():j}function ot(s){const a=ee(s);return a.setDate(1),a.setHours(0,0,0,0),a}function Gt(s,a){const r=xs(),o=a?.weekStartsOn??a?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,l=ee(s),p=l.getDay(),h=(p<o?-7:0)+6-(p-o);return l.setDate(l.getDate()+h),l.setHours(23,59,59,999),l}function Qt(s,a){const r=ee(s),o=ee(a);return r.getFullYear()===o.getFullYear()&&r.getMonth()===o.getMonth()}function Gs(s,a){return oe(s,-1)}function ge(s,a){const r=ee(s);return r.setHours(a),r}function pe(s,a){const r=ee(s);return r.setMinutes(a),r}function qt(s,a){return gt(s,-1)}function Qs(s,a){return ur(s,-1)}var qs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Hs=qs.reduce((s,a)=>{const r=ss(`Primitive.${a}`),o=x.forwardRef((l,p)=>{const{asChild:h,...f}=l,j=h?r:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(j,{...f,ref:p})});return o.displayName=`Primitive.${a}`,{...s,[a]:o}},{}),Ks="Label",mr=x.forwardRef((s,a)=>e.jsx(Hs.label,{...s,ref:a,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(s.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));mr.displayName=Ks;var xr=mr;const Vs=Jr("font-terminal text-base font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),I=x.forwardRef(({className:s,...a},r)=>e.jsx(xr,{ref:r,className:U(Vs(),s),...a}));I.displayName=xr.displayName;function bt(s,a,r){const o=s.slice();return o.splice(r<0?o.length+r:r,0,o.splice(a,1)[0]),o}function Zs(s,a){return s.reduce((r,o,l)=>{const p=a.get(o);return p&&(r[l]=p),r},Array(s.length))}function Ge(s){return s!==null&&s>=0}function Bs(s,a){if(s===a)return!0;if(s.length!==a.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!==a[r])return!1;return!0}function Ws(s){return typeof s=="boolean"?{draggable:s,droppable:s}:s}const hr=s=>{let{rects:a,activeIndex:r,overIndex:o,index:l}=s;const p=bt(a,o,r),h=a[l],f=p[l];return!f||!h?null:{x:f.left-h.left,y:f.top-h.top,scaleX:f.width/h.width,scaleY:f.height/h.height}},Qe={scaleX:1,scaleY:1},gr=s=>{var a;let{activeIndex:r,activeNodeRect:o,index:l,rects:p,overIndex:h}=s;const f=(a=p[r])!=null?a:o;if(!f)return null;if(l===r){const v=p[h];return v?{x:0,y:r<h?v.top+v.height-(f.top+f.height):v.top-f.top,...Qe}:null}const j=Js(p,l,r);return l>r&&l<=h?{x:0,y:-f.height-j,...Qe}:l<r&&l>=h?{x:0,y:f.height+j,...Qe}:{x:0,y:0,...Qe}};function Js(s,a,r){const o=s[a],l=s[a-1],p=s[a+1];return o?r<a?l?o.top-(l.top+l.height):p?p.top-(o.top+o.height):0:p?p.top-(o.top+o.height):l?o.top-(l.top+l.height):0:0}const pr="Sortable",fr=Vt.createContext({activeIndex:-1,containerId:pr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:hr,disabled:{draggable:!1,droppable:!1}});function yr(s){let{children:a,id:r,items:o,strategy:l=hr,disabled:p=!1}=s;const{active:h,dragOverlay:f,droppableRects:j,over:v,measureDroppableContainers:c}=hs(),w=gs(pr,r),m=f.rect!==null,C=x.useMemo(()=>o.map(E=>typeof E=="object"&&"id"in E?E.id:E),[o]),R=h!=null,D=h?C.indexOf(h.id):-1,T=v?C.indexOf(v.id):-1,$=x.useRef(C),F=!Bs(C,$.current),g=T!==-1&&D===-1||F,k=Ws(p);tr(()=>{F&&R&&c(C)},[F,C,R,c]),x.useEffect(()=>{$.current=C},[C]);const O=x.useMemo(()=>({activeIndex:D,containerId:w,disabled:k,disableTransforms:g,items:C,overIndex:T,useDragOverlay:m,sortedRects:Zs(C,j),strategy:l}),[D,w,k.draggable,k.droppable,g,C,T,j,m,l]);return Vt.createElement(fr.Provider,{value:O},a)}const Xs=s=>{let{id:a,items:r,activeIndex:o,overIndex:l}=s;return bt(r,o,l).indexOf(a)},ea=s=>{let{containerId:a,isSorting:r,wasDragging:o,index:l,items:p,newIndex:h,previousItems:f,previousContainerId:j,transition:v}=s;return!v||!o||f!==p&&l===h?!1:r?!0:h!==l&&a===j},ta={duration:200,easing:"ease"},br="transform",ra=Ke.Transition.toString({property:br,duration:0,easing:"linear"}),sa={roleDescription:"sortable"};function aa(s){let{disabled:a,index:r,node:o,rect:l}=s;const[p,h]=x.useState(null),f=x.useRef(r);return tr(()=>{if(!a&&r!==f.current&&o.current){const j=l.current;if(j){const v=ws(o.current,{ignoreTransform:!0}),c={x:j.left-v.left,y:j.top-v.top,scaleX:j.width/v.width,scaleY:j.height/v.height};(c.x||c.y)&&h(c)}}r!==f.current&&(f.current=r)},[a,r,o,l]),x.useEffect(()=>{p&&h(null)},[p]),p}function jt(s){let{animateLayoutChanges:a=ea,attributes:r,disabled:o,data:l,getNewIndex:p=Xs,id:h,strategy:f,resizeObserverConfig:j,transition:v=ta}=s;const{items:c,containerId:w,activeIndex:m,disabled:C,disableTransforms:R,sortedRects:D,overIndex:T,useDragOverlay:$,strategy:F}=x.useContext(fr),g=na(o,C),k=c.indexOf(h),O=x.useMemo(()=>({sortable:{containerId:w,index:k,items:c},...l}),[w,l,k,c]),E=x.useMemo(()=>c.slice(c.indexOf(h)),[c,h]),{rect:G,node:i,isOver:A,setNodeRef:P}=ps({id:h,data:O,disabled:g.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...j}}),{active:H,activatorEvent:je,activeNodeRect:u,attributes:L,setNodeRef:te,listeners:ie,isDragging:fe,over:re,setActivatorNodeRef:de,transform:Ze}=fs({id:h,data:O,attributes:{...sa,...r},disabled:g.draggable}),ce=ys(P,te),ae=!!H,ue=ae&&!R&&Ge(m)&&Ge(T),ye=!$&&fe,Oe=ye&&ue?Ze:null,wt=ue?Oe??(f??F)({rects:D,activeNodeRect:u,activeIndex:m,overIndex:T,index:k}):null,me=Ge(m)&&Ge(T)?p({id:h,items:c,activeIndex:m,overIndex:T}):k,ne=H?.id,K=x.useRef({activeId:ne,items:c,newIndex:me,containerId:w}),Be=c!==K.current.items,_e=a({active:H,containerId:w,isDragging:fe,isSorting:ae,id:h,index:k,items:c,newIndex:K.current.newIndex,previousItems:K.current.items,previousContainerId:K.current.containerId,transition:v,wasDragging:K.current.activeId!=null}),ve=aa({disabled:!_e,index:k,node:i,rect:G});return x.useEffect(()=>{ae&&K.current.newIndex!==me&&(K.current.newIndex=me),w!==K.current.containerId&&(K.current.containerId=w),c!==K.current.items&&(K.current.items=c)},[ae,me,w,c]),x.useEffect(()=>{if(ne===K.current.activeId)return;if(ne!=null&&K.current.activeId==null){K.current.activeId=ne;return}const Ne=setTimeout(()=>{K.current.activeId=ne},50);return()=>clearTimeout(Ne)},[ne]),{active:H,activeIndex:m,attributes:L,data:O,rect:G,index:k,newIndex:me,items:c,isOver:A,isSorting:ae,isDragging:fe,listeners:ie,node:i,overIndex:T,over:re,setNodeRef:ce,setActivatorNodeRef:de,setDroppableNodeRef:P,setDraggableNodeRef:te,transform:ve??wt,transition:be()};function be(){if(ve||Be&&K.current.newIndex===k)return ra;if(!(ye&&!bs(je)||!v)&&(ae||_e))return Ke.Transition.toString({...v,property:br})}}function na(s,a){var r,o;return typeof s=="boolean"?{draggable:s,droppable:!1}:{draggable:(r=s?.draggable)!=null?r:a.draggable,droppable:(o=s?.droppable)!=null?o:a.droppable}}function He(s){if(!s)return!1;const a=s.data.current;return!!(a&&"sortable"in a&&typeof a.sortable=="object"&&"containerId"in a.sortable&&"items"in a.sortable&&"index"in a.sortable)}const oa=[le.Down,le.Right,le.Up,le.Left],la=(s,a)=>{let{context:{active:r,collisionRect:o,droppableRects:l,droppableContainers:p,over:h,scrollableAncestors:f}}=a;if(oa.includes(s.code)){if(s.preventDefault(),!r||!o)return;const j=[];p.getEnabled().forEach(w=>{if(!w||w!=null&&w.disabled)return;const m=l.get(w.id);if(m)switch(s.code){case le.Down:o.top<m.top&&j.push(w);break;case le.Up:o.top>m.top&&j.push(w);break;case le.Left:o.left>m.left&&j.push(w);break;case le.Right:o.left<m.left&&j.push(w);break}});const v=js({collisionRect:o,droppableRects:l,droppableContainers:j});let c=vs(v,"id");if(c===h?.id&&v.length>1&&(c=v[1].id),c!=null){const w=p.get(r.id),m=p.get(c),C=m?l.get(m.id):null,R=m?.node.current;if(R&&C&&w&&m){const T=Ns(R).some((E,G)=>f[G]!==E),$=jr(w,m),F=ia(w,m),g=T||!$?{x:0,y:0}:{x:F?o.width-C.width:0,y:F?o.height-C.height:0},k={x:C.left,y:C.top};return g.x&&g.y?k:Es(k,g)}}}};function jr(s,a){return!He(s)||!He(a)?!1:s.data.current.sortable.containerId===a.data.current.sortable.containerId}function ia(s,a){return!He(s)||!He(a)||!jr(s,a)?!1:s.data.current.sortable.index<a.data.current.sortable.index}function da(s,a,{checkForDefaultPrevented:r=!0}={}){return function(l){if(s?.(l),r===!1||!l.defaultPrevented)return a?.(l)}}var ca=Xr[" useInsertionEffect ".trim().toString()]||Zt;function ua({prop:s,defaultProp:a,onChange:r=()=>{},caller:o}){const[l,p,h]=ma({defaultProp:a,onChange:r}),f=s!==void 0,j=f?s:l;{const c=x.useRef(s!==void 0);x.useEffect(()=>{const w=c.current;w!==f&&console.warn(`${o} is changing from ${w?"controlled":"uncontrolled"} to ${f?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=f},[f,o])}const v=x.useCallback(c=>{if(f){const w=xa(c)?c(s):c;w!==s&&h.current?.(w)}else p(c)},[f,s,p,h]);return[j,v]}function ma({defaultProp:s,onChange:a}){const[r,o]=x.useState(s),l=x.useRef(r),p=x.useRef(a);return ca(()=>{p.current=a},[a]),x.useEffect(()=>{l.current!==r&&(p.current?.(r),l.current=r)},[r,l]),[r,o,p]}function xa(s){return typeof s=="function"}var Ve="Collapsible",[ha]=es(Ve),[ga,vt]=ha(Ve),vr=x.forwardRef((s,a)=>{const{__scopeCollapsible:r,open:o,defaultOpen:l,disabled:p,onOpenChange:h,...f}=s,[j,v]=ua({prop:o,defaultProp:l??!1,onChange:h,caller:Ve});return e.jsx(ga,{scope:r,disabled:p,contentId:as(),open:j,onOpenToggle:x.useCallback(()=>v(c=>!c),[v]),children:e.jsx(pt.div,{"data-state":Et(j),"data-disabled":p?"":void 0,...f,ref:a})})});vr.displayName=Ve;var Nr="CollapsibleTrigger",Er=x.forwardRef((s,a)=>{const{__scopeCollapsible:r,...o}=s,l=vt(Nr,r);return e.jsx(pt.button,{type:"button","aria-controls":l.contentId,"aria-expanded":l.open||!1,"data-state":Et(l.open),"data-disabled":l.disabled?"":void 0,disabled:l.disabled,...o,ref:a,onClick:da(s.onClick,l.onOpenToggle)})});Er.displayName=Nr;var Nt="CollapsibleContent",wr=x.forwardRef((s,a)=>{const{forceMount:r,...o}=s,l=vt(Nt,s.__scopeCollapsible);return e.jsx(ts,{present:r||l.open,children:({present:p})=>e.jsx(pa,{...o,ref:a,present:p})})});wr.displayName=Nt;var pa=x.forwardRef((s,a)=>{const{__scopeCollapsible:r,present:o,children:l,...p}=s,h=vt(Nt,r),[f,j]=x.useState(o),v=x.useRef(null),c=rs(a,v),w=x.useRef(0),m=w.current,C=x.useRef(0),R=C.current,D=h.open||f,T=x.useRef(D),$=x.useRef(void 0);return x.useEffect(()=>{const F=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(F)},[]),Zt(()=>{const F=v.current;if(F){$.current=$.current||{transitionDuration:F.style.transitionDuration,animationName:F.style.animationName},F.style.transitionDuration="0s",F.style.animationName="none";const g=F.getBoundingClientRect();w.current=g.height,C.current=g.width,T.current||(F.style.transitionDuration=$.current.transitionDuration,F.style.animationName=$.current.animationName),j(o)}},[h.open,o]),e.jsx(pt.div,{"data-state":Et(h.open),"data-disabled":h.disabled?"":void 0,id:h.contentId,hidden:!D,...p,ref:c,style:{"--radix-collapsible-content-height":m?`${m}px`:void 0,"--radix-collapsible-content-width":R?`${R}px`:void 0,...s.style},children:D&&l})});function Et(s){return s?"open":"closed"}var fa=vr;const ya=fa,ba=Er,ja=wr;function va({dateStr:s}){if(!s)return null;try{const a=rr(s);if(!sr(a))return null;let r=z(a,"MMM d");he(a)&&(r="Today"),Cs(a)&&(r="Tomorrow");const o=Ss(a)&&!he(a);return e.jsxs("div",{className:`flex items-center gap-1 text-[10px] border px-1.5 py-0.5 rounded-none ${o?"text-red-400 border-red-400/50":"text-muted-foreground border-border"}`,children:[e.jsx(ns,{className:"w-3 h-3"}),r]})}catch{return null}}function Ht({task:s,onToggle:a,onDelete:r,onEdit:o}){const{attributes:l,listeners:p,setNodeRef:h,transform:f,transition:j,isDragging:v}=jt({id:s.id,data:{type:"Task",...s}}),c={transform:Ke.Translate.toString(f),transition:j,opacity:v?.5:1};return e.jsx("div",{ref:h,style:c,...l,...p,className:"mb-2 touch-none select-none relative group",children:e.jsxs("div",{className:`
            p-3 rounded-none border border-transparent hover:border-primary/30 transition-all
            flex gap-3 items-start bg-transparent hover:bg-primary/5
            ${v?"ring-2 ring-primary/50 bg-primary/10 z-50":""}
        `,onClick:()=>o(s),children:[e.jsx("div",{onClick:w=>{w.stopPropagation(),a(s)},className:`
                mt-0.5 w-5 h-5 rounded-none border-2 flex items-center justify-center cursor-pointer transition-colors
                ${s.status==="completed"?"bg-primary border-primary":"border-muted-foreground/60 hover:border-primary"}
            `,children:s.status==="completed"&&e.jsx("div",{className:"w-2.5 h-1.5 border-b-2 border-l-2 border-black rotate-[-45deg] mb-0.5"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:`text-sm font-terminal leading-tight truncate ${s.status==="completed"?"line-through text-muted-foreground":"text-foreground"}`,children:s.title}),(s.notes||s.due)&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-1",children:[s.due&&e.jsx(va,{dateStr:s.due}),s.notes&&e.jsxs("div",{className:"flex items-center text-[10px] text-muted-foreground gap-1",children:[e.jsx(cr,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[150px] opacity-70 font-terminal",children:s.notes.split(`
`)[0]})]})]})]})]})})}function Kt({task:s,isOpen:a,onClose:r,onSave:o,onDelete:l,isCreating:p,activeListId:h,availableLists:f=[]}){const[j,v]=x.useState(""),[c,w]=x.useState(""),[m,C]=x.useState(""),[R,D]=x.useState(""),[T,$]=x.useState("");x.useEffect(()=>{if(a){if(p)v(""),w(""),C(""),D(""),$(h||f[0]?.id||"");else if(s)if(v(s.title),w(s.notes||""),$(s.listId),s.due)try{const g=rr(s.due);sr(g)&&C(z(g,"yyyy-MM-dd"))}catch{}else C("")}},[a,s,p,h]);const F=()=>{if(!j)return;let g;m&&(g=R?`${m}T${R}:00Z`:`${m}T00:00:00Z`),o({title:j,notes:c,due:g,listId:T}),r()};return e.jsx(De,{open:a,onOpenChange:g=>!g&&r(),children:e.jsxs(Te,{className:"sm:max-w-[500px] border-2 border-primary bg-black text-foreground p-0 gap-0 overflow-hidden shadow-2xl rounded-none",children:[e.jsx(Re,{className:"sr-only",children:p?"Create New Task":"Edit Task"}),e.jsx(Ae,{className:"sr-only",children:p?"Enter task details to create a new task.":"Modify task details."}),e.jsx("div",{className:"p-6 pb-2",children:e.jsx(Y,{value:j,onChange:g=>v(g.target.value),placeholder:"Add title",className:"text-2xl font-terminal bg-transparent border-0 border-b border-primary/30 rounded-none px-0 py-2 focus-visible:ring-0 focus-visible:border-primary placeholder:text-muted-foreground/50 h-auto",autoFocus:p})}),e.jsxs("div",{className:"p-6 pt-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(Y,{type:"date",value:m,onChange:g=>C(g.target.value),className:"bg-secondary/20 border-secondary text-sm w-[150px] rounded-none"}),e.jsx(Y,{type:"time",value:R,onChange:g=>D(g.target.value),className:"bg-secondary/20 border-secondary text-sm w-[120px] rounded-none"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-7",children:[e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2 cursor-not-allowed opacity-70 font-terminal",children:[e.jsx("div",{className:"w-4 h-4 rounded-none border border-current"}),"Does not repeat"]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2 ml-4 cursor-not-allowed opacity-70 font-terminal",children:[e.jsx("div",{className:"w-4 h-4 border border-current rounded-none"}),"All day"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(cr,{className:"w-5 h-5 text-muted-foreground shrink-0 mt-2"}),e.jsx(Le,{value:c,onChange:g=>w(g.target.value),placeholder:"Add description",className:"bg-transparent border-0 resize-none min-h-[100px] focus-visible:ring-0 p-0 text-sm leading-relaxed placeholder:text-muted-foreground/50 font-terminal rounded-none"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 shrink-0"}),e.jsxs(Z,{value:T,onValueChange:$,children:[e.jsx(B,{className:"w-[150px] h-8 bg-secondary/20 border-secondary text-xs rounded-none",children:e.jsx(W,{placeholder:"Select List"})}),e.jsx(J,{children:f.map(g=>e.jsx(N,{value:g.id,children:g.title},g.id))})]})]})]}),e.jsxs(ut,{className:"p-4 bg-secondary/10 flex justify-between items-center border-t border-secondary",children:[!p&&s?e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>{confirm("Delete?")&&(l(s.id,s.listId),r())},children:e.jsx(ke,{className:"w-4 h-4 text-muted-foreground hover:text-primary"})}):e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",onClick:r,className:"hover:bg-secondary/20 rounded-none font-terminal",children:"Cancel"}),e.jsx(M,{onClick:F,disabled:!j,className:"bg-primary hover:bg-primary/80 text-primary-foreground rounded-none px-6 font-terminal",children:"Save"})]})]})]})})}function Na({listId:s,title:a,tasks:r,onAddTask:o,onEdit:l,onToggle:p,onDelete:h}){const{setNodeRef:f}=jt({id:s,data:{type:"Container",listId:s}}),j=r.filter(c=>c.status!=="completed"),v=r.filter(c=>c.status==="completed");return e.jsxs("div",{ref:f,className:"flex-1 min-w-[260px] max-w-[300px] flex flex-col h-full bg-black/40 rounded-none overflow-hidden border-2 border-secondary my-1",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between pb-2 border-b border-secondary",children:[e.jsx("h3",{className:"font-arcade text-xs text-primary tracking-wide truncate uppercase",children:a}),e.jsx("div",{className:"flex gap-1",children:e.jsxs(M,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary rounded-none",children:[e.jsx("div",{className:"w-1 h-1 bg-current mb-0.5"}),e.jsx("div",{className:"w-1 h-1 bg-current mb-0.5"}),e.jsx("div",{className:"w-1 h-1 bg-current"})]})})]}),e.jsx("div",{className:"px-4 py-2 border-b border-secondary/50",children:e.jsxs("button",{onClick:()=>o(s),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors group w-full text-left font-terminal",children:[e.jsx("div",{className:"w-6 h-6 rounded-none bg-secondary/20 flex items-center justify-center group-hover:bg-primary/20 group-hover:text-primary border border-secondary",children:e.jsx(qe,{className:"w-4 h-4"})}),"Add a task"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-2 overflow-x-hidden",children:e.jsxs(yr,{items:r.map(c=>c.id),strategy:gr,children:[j.length>0?e.jsx("div",{className:"space-y-1",children:j.map(c=>e.jsx(Ht,{task:c,onToggle:p,onEdit:l,onDelete:h},c.id))}):v.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-40",children:e.jsx("p",{className:"text-sm font-terminal",children:"No tasks yet"})}),v.length>0&&e.jsx("div",{className:"mt-4 pt-2 border-t border-secondary/50",children:e.jsxs(ya,{children:[e.jsxs(ba,{className:"flex items-center gap-2 text-sm font-terminal text-muted-foreground hover:text-primary w-full py-2 px-2 hover:bg-primary/5 rounded-none transition-colors",children:[e.jsx(yt,{className:"w-4 h-4 transition-transform ui-open:rotate-90"}),"Completed (",v.length,")"]}),e.jsx(ja,{className:"space-y-1 pl-2 mt-1",children:v.map(c=>e.jsx(Ht,{task:c,onToggle:p,onEdit:l,onDelete:h},c.id))})]})})]})})]})}function Ea({onClick:s}){return e.jsxs(M,{onClick:s,variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs border-primary text-primary hover:bg-primary hover:text-black",children:[e.jsx(Jt,{className:"w-4 h-4 mr-1"})," AI_ASSIST"]})}function wa({isOpen:s,onClose:a}){const[r,o]=x.useState([]),[l,p]=x.useState(""),h=x.useRef(null),f=ft(),{data:j,isLoading:v,refetch:c}=se({queryKey:["google-status"],queryFn:Q.google.getStatus,retry:1,enabled:s}),w=q({mutationFn:async()=>{const{authUrl:D}=await Q.google.getAuthUrl();window.location.href=D}});x.useEffect(()=>{s&&c()},[s,c]),x.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[r,s]);const m=q({mutationFn:async D=>Q.calendar.assistant(D),onSuccess:D=>{o(T=>[...T,{role:"assistant",content:D.response,isError:!D.success}]),f.invalidateQueries({queryKey:["events"]}),f.invalidateQueries({queryKey:["google-tasks"]}),f.invalidateQueries({queryKey:["google-calendar"]}),f.refetchQueries({queryKey:["google-calendar"]})},onError:D=>{o(T=>[...T,{role:"assistant",content:`Network Error: ${D}`,isError:!0}])}}),C=()=>{if(!l.trim())return;const D={role:"user",content:l};o(T=>[...T,D]),p(""),m.mutate(l)},R=D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),C())};return s?e.jsxs(Xt,{className:"fixed left-0 top-[68px] bottom-[40px] w-[380px] shadow-2xl z-50 flex flex-col border-r-2 border-primary bg-black text-white rounded-none animate-in fade-in slide-in-from-left-4 duration-300",children:[e.jsxs(er,{className:"border-b border-primary/50 flex flex-row items-center justify-between bg-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx(is,{className:"text-sm font-arcade tracking-wider text-primary",children:"AI_ASSISTANT"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"text-[10px] text-muted-foreground font-terminal",children:"Calendar + Tasks Assistant"}),!v&&j?.connected&&e.jsx("span",{className:"text-[9px] font-arcade text-success",children:"CONNECTED"})]})]})]}),e.jsx(M,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a,children:e.jsx(Bt,{className:"h-4 w-4 text-muted-foreground hover:text-white"})})]}),e.jsx(mt,{className:"flex-1 p-3",ref:h,children:e.jsxs("div",{className:"space-y-3",children:[!v&&!j?.connected&&e.jsxs("div",{className:"border border-warning/50 bg-warning/10 text-warning text-[10px] font-terminal px-3 py-2 flex items-center justify-between gap-3",children:[e.jsx("span",{children:"Calendar not connected."}),e.jsxs(M,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none border-warning text-warning hover:bg-warning/20 font-arcade text-[9px]",onClick:()=>w.mutate(),disabled:w.isPending,children:[e.jsx(As,{className:"w-3 h-3 mr-1"}),w.isPending?"CONNECTING...":"CONNECT GOOGLE CALENDAR"]})]}),r.length===0&&e.jsxs("div",{className:"text-center text-muted-foreground text-xs mt-8 space-y-2",children:[e.jsx("p",{className:"font-terminal",children:"Ask me to create events or tasks."}),e.jsx("p",{className:"text-[10px] opacity-50 font-terminal",children:'"Add a workout tomorrow at 3pm"'}),e.jsx("p",{className:"text-[10px] opacity-50 font-terminal",children:'"Schedule PT study session Friday 2pm"'})]}),r.map((D,T)=>e.jsx("div",{className:`flex ${D.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] px-3 py-2 text-xs font-terminal whitespace-pre-wrap ${D.role==="user"?"bg-primary text-black":D.isError?"bg-destructive/10 border border-destructive/50 text-destructive":"bg-white/10 text-white border border-white/10"}`,children:D.content})},T)),m.isPending&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-white/5 border border-white/10 px-3 py-2 text-[10px] flex items-center gap-2 text-muted-foreground font-terminal",children:[e.jsx(Ls,{className:"h-3 w-3 animate-spin"}),"Thinking..."]})})]})}),e.jsxs("div",{className:"p-3 border-t border-primary/50",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:l,onChange:D=>p(D.target.value),onKeyDown:R,placeholder:"Type a command...",className:"bg-black border-secondary font-terminal text-sm rounded-none focus-visible:ring-primary",disabled:m.isPending}),e.jsx(M,{onClick:C,disabled:m.isPending||!l.trim(),className:"rounded-none bg-primary text-black hover:bg-primary/90",children:e.jsx(Ms,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-[9px] text-center mt-1 text-muted-foreground/50 font-terminal",children:"OpenRouter â€¢ GPT-4o-mini"})]})]}):null}const lt=["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","America/Indiana/Indianapolis","America/Detroit","America/Boise","America/Juneau","Pacific/Honolulu"];function Ca({open:s,onOpenChange:a,event:r,onEventChange:o,onSave:l,onDeleteInstance:p,onDeleteSeries:h,onEditSeries:f,mode:j="series",courseOptions:v=[]}){const[c,w]=x.useState("details"),[m,C]=x.useState(""),R=j==="instance",D=x.useMemo(()=>{if(typeof Intl<"u"&&"supportedValuesOf"in Intl)try{const u=Intl.supportedValuesOf("timeZone").filter(L=>L.startsWith("America/")||L==="Pacific/Honolulu").slice().sort();return u.length>0?u:lt}catch{return lt}return lt},[]);x.useEffect(()=>{if(!s||!r?.recurringEventId||!r.calendarId||r.recurrence&&r.recurrence.length>0)return;let u=!1;return fetch(`/api/google-calendar/events/${encodeURIComponent(r.recurringEventId)}?calendarId=${encodeURIComponent(r.calendarId)}`).then(L=>L.ok?L.json():null).then(L=>{u||!L?.recurrence||o({...r,recurrence:L.recurrence})}).catch(()=>{}),()=>{u=!0}},[s,r?.recurringEventId,r?.calendarId,r?.recurrence,o]);const T=u=>{switch(u){case"RRULE:FREQ=DAILY":return"Daily";case"RRULE:FREQ=WEEKLY":return"Weekly";case"RRULE:FREQ=MONTHLY":return"Monthly";case"RRULE:FREQ=YEARLY":return"Yearly";default:return u||"Unavailable"}},$=x.useMemo(()=>{if(!r)return"__none__";if(r.courseId)return String(r.courseId);if(r.course){const u=v.find(L=>L.name===r.course);if(u)return String(u.id)}return"__none__"},[r,v]);if(!r)return null;const F=!!r.start?.date&&!r.start?.dateTime,g=r.start?.timeZone||r.extendedProperties?.private?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC",k=D[0]||"America/New_York",O=D.includes(g)?g:k,E=(u,L)=>{o({...r,[u]:L})},G=u=>{if(u==="__none__"){o({...r,course:void 0,courseId:void 0,courseCode:void 0});return}const L=v.find(te=>String(te.id)===u);L&&o({...r,course:L.name,courseId:L.id,courseCode:L.code||void 0})},i=u=>{if(u){const L=(r.start?.dateTime||"").substring(0,10)||new Date().toISOString().substring(0,10),te=(r.end?.dateTime||"").substring(0,10)||L;o({...r,start:{date:L},end:{date:te}})}else{const L=r.start?.date||new Date().toISOString().substring(0,10);o({...r,start:{dateTime:`${L}T09:00`},end:{dateTime:`${L}T10:00`}})}},A=u=>{const L={...r.extendedProperties,private:{...r.extendedProperties?.private||{},timeZone:u}},te=r.start?.dateTime?{...r.start,timeZone:u}:r.start,ie=r.end?.dateTime?{...r.end,timeZone:u}:r.end;o({...r,start:te,end:ie,extendedProperties:L})},P=()=>{const u=m.trim();if(!u||!u.includes("@"))return;const L=r.attendees||[];L.some(te=>te.email===u)||(E("attendees",[...L,{email:u}]),C(""))},H=u=>{E("attendees",(r.attendees||[]).filter(L=>L.email!==u))},je=[{id:"details",label:"DETAILS"},{id:"time",label:"TIME"},{id:"recurrence",label:"REPEAT"},{id:"people",label:"PEOPLE"},{id:"settings",label:"SETTINGS"}];return e.jsx(De,{open:s,onOpenChange:a,children:e.jsxs(Te,{"data-modal":"calendar-edit-google",className:"font-arcade bg-black border-2 border-green-500 rounded-none max-w-none w-[min(96vw,42rem)] p-0 overflow-hidden translate-y-0 max-h-[calc(100vh-4rem)]",style:{zIndex:100005,top:"3rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsx(Re,{className:"sr-only",children:"Edit Google Calendar event"}),e.jsx(Ae,{className:"sr-only",children:"Update event details, time, recurrence, attendees, and settings."}),e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"bg-green-500/20 border-b border-green-500 p-4 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-green-500 font-bold tracking-wider",children:"EDIT_EVENT"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[R&&f&&e.jsx(M,{size:"sm",variant:"ghost",onClick:f,className:"h-6 px-2 border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-[10px]",children:"EDIT SERIES"}),e.jsxs("div",{className:"flex gap-1",children:[R&&e.jsx(rt,{variant:"outline",className:"text-[10px] border-green-500 text-green-500",children:"INSTANCE"}),j==="series"&&r.recurrence&&e.jsx(rt,{variant:"outline",className:"text-[10px] border-green-500 text-green-500",children:"SERIES"}),(r.conferenceData||r.hangoutLink)&&e.jsx(rt,{variant:"outline",className:"text-[10px] border-blue-400 text-blue-400",children:"ONLINE"})]})]})]}),e.jsx("div",{className:"flex border-b border-green-500/30 shrink-0",children:je.map(u=>e.jsx("button",{className:U("flex-1 py-2 text-[10px] font-arcade transition-colors",c===u.id?"text-green-500 border-b-2 border-green-500 bg-green-500/10":"text-zinc-500 hover:text-zinc-300"),onClick:()=>w(u.id),children:u.label},u.id))}),e.jsxs("div",{className:"p-5 space-y-4 overflow-y-auto flex-1 min-h-0",children:[c==="details"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"TITLE_"}),e.jsx(Y,{value:r.summary||"",onChange:u=>E("summary",u.target.value),className:"bg-black border-green-500/50 focus:border-green-500 text-green-500 font-terminal text-lg h-12 rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"DESCRIPTION_"}),e.jsx(Le,{value:r.description||"",onChange:u=>E("description",u.target.value),className:"bg-black border-green-500/50 text-green-500 font-terminal min-h-[80px] rounded-none resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"LOCATION_"}),e.jsx(Y,{value:r.location||"",onChange:u=>E("location",u.target.value),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"EVENT_TYPE_"}),e.jsxs(Z,{value:r.eventType||"study",onValueChange:u=>E("eventType",u),children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[e.jsx(N,{value:"study",children:"STUDY"}),e.jsx(N,{value:"lecture",children:"LECTURE"}),e.jsx(N,{value:"exam",children:"EXAM"}),e.jsx(N,{value:"synchronous",children:"SYNCHRONOUS"}),e.jsx(N,{value:"online",children:"ONLINE"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"COURSE_"}),e.jsxs(Z,{value:$,onValueChange:G,children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"Select course"})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[e.jsx(N,{value:"__none__",children:"None"}),v.length===0&&e.jsx(N,{value:"__empty__",disabled:!0,children:"No courses found"}),v.map(u=>e.jsx(N,{value:String(u.id),children:u.name},u.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"WEIGHT_"}),e.jsx(Y,{value:r.weight||"",onChange:u=>E("weight",u.target.value),placeholder:"e.g. High, Medium, Low",className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"COLOR_ID_"}),e.jsxs(Z,{value:r.colorId||"0",onValueChange:u=>E("colorId",u==="0"?void 0:u),children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"Default"})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[e.jsx(N,{value:"0",children:"Default"}),e.jsx(N,{value:"1",children:"Lavender"}),e.jsx(N,{value:"2",children:"Sage"}),e.jsx(N,{value:"3",children:"Grape"}),e.jsx(N,{value:"4",children:"Flamingo"}),e.jsx(N,{value:"5",children:"Banana"}),e.jsx(N,{value:"6",children:"Tangerine"}),e.jsx(N,{value:"7",children:"Peacock"}),e.jsx(N,{value:"8",children:"Graphite"}),e.jsx(N,{value:"9",children:"Blueberry"}),e.jsx(N,{value:"10",children:"Basil"}),e.jsx(N,{value:"11",children:"Tomato"})]})]})]})]})]}),c==="time"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Me,{id:"all-day",checked:F,onCheckedChange:u=>i(!!u),className:"border-green-500/50 data-[state=checked]:bg-green-500"}),e.jsx(I,{htmlFor:"all-day",className:"text-xs text-green-500/80 cursor-pointer",children:"ALL DAY EVENT"})]}),F?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"START_DATE_"}),e.jsx(Y,{type:"date",value:r.start?.date||"",onChange:u=>o({...r,start:{date:u.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"END_DATE_"}),e.jsx(Y,{type:"date",value:r.end?.date||"",onChange:u=>o({...r,end:{date:u.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"START_"}),e.jsx(Y,{type:"datetime-local",value:r.start?.dateTime?.substring(0,16)||"",onChange:u=>o({...r,start:{dateTime:u.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"END_"}),e.jsx(Y,{type:"datetime-local",value:r.end?.dateTime?.substring(0,16)||"",onChange:u=>o({...r,end:{dateTime:u.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"TIMEZONE_"}),e.jsxs(Z,{value:O,onValueChange:A,children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"Select timezone"})}),e.jsx(J,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:D.map(u=>e.jsx(N,{value:u,children:u},u))})]})]})]}),c==="recurrence"&&e.jsx(e.Fragment,{children:r.recurringEventId?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-yellow-500 font-terminal",children:"This is a single instance of a recurring event. Recurrence can only be edited on the series."}),e.jsxs("p",{className:"text-[10px] text-green-300 font-terminal",children:["Series pattern: ",T(r.recurrence?.[0])]}),R&&f&&e.jsx(M,{size:"sm",variant:"ghost",onClick:f,className:"mt-2 h-7 px-3 border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-[10px]",children:"EDIT SERIES"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{className:"text-xs text-green-500/80 flex items-center gap-2",children:["PATTERN_ ",e.jsx(dr,{className:"w-3 h-3"})]}),e.jsxs(Z,{value:r.recurrence?.[0]||"none",onValueChange:u=>E("recurrence",u==="none"?void 0:[u]),children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"No Recurrence"})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[e.jsx(N,{value:"none",children:"None"}),e.jsx(N,{value:"RRULE:FREQ=DAILY",children:"Daily"}),e.jsx(N,{value:"RRULE:FREQ=WEEKLY",children:"Weekly"}),e.jsx(N,{value:"RRULE:FREQ=MONTHLY",children:"Monthly"}),e.jsx(N,{value:"RRULE:FREQ=YEARLY",children:"Yearly"})]})]})]}),r.recurrence&&!["RRULE:FREQ=DAILY","RRULE:FREQ=WEEKLY","RRULE:FREQ=MONTHLY","RRULE:FREQ=YEARLY"].includes(r.recurrence[0])&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"CUSTOM_RRULE_"}),e.jsx(Le,{value:r.recurrence[0],onChange:u=>E("recurrence",[u.target.value]),className:"bg-black border-green-500/30 text-green-100/70 text-[10px] font-terminal h-12 rounded-none",placeholder:"RRULE:FREQ=WEEKLY;BYDAY=MO,WE"})]})]})}),c==="people"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"ATTENDEES_"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:m,onChange:u=>C(u.target.value),onKeyDown:u=>u.key==="Enter"&&P(),placeholder:"email@example.com",className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none text-xs flex-1"}),e.jsx(M,{size:"sm",onClick:P,className:"rounded-none bg-green-500 text-black hover:bg-green-400 h-9 px-3",children:e.jsx(qe,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[(r.attendees||[]).map(u=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-zinc-800 text-xs font-terminal",children:[e.jsx("span",{className:"text-green-500",children:u.email}),e.jsxs("div",{className:"flex items-center gap-2",children:[u.responseStatus&&e.jsx("span",{className:U("text-[10px]",u.responseStatus==="accepted"?"text-green-400":u.responseStatus==="declined"?"text-red-400":"text-yellow-400"),children:u.responseStatus.toUpperCase()}),!u.self&&e.jsx("button",{onClick:()=>H(u.email),className:"text-red-500 hover:text-red-400",children:e.jsx(Bt,{className:"w-3 h-3"})})]})]},u.email)),(!r.attendees||r.attendees.length===0)&&e.jsx("p",{className:"text-xs text-zinc-500 font-terminal",children:"No attendees"})]})]}),c==="settings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"VISIBILITY_"}),e.jsxs(Z,{value:r.visibility||"default",onValueChange:u=>E("visibility",u==="default"?void 0:u),children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[e.jsx(N,{value:"default",children:"Default"}),e.jsx(N,{value:"public",children:"Public"}),e.jsx(N,{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"AVAILABILITY_"}),e.jsxs(Z,{value:r.transparency||"opaque",onValueChange:u=>E("transparency",u),children:[e.jsx(B,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[e.jsx(N,{value:"opaque",children:"Busy"}),e.jsx(N,{value:"transparent",children:"Free"})]})]})]}),(r.conferenceData||r.hangoutLink)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"CONFERENCE_"}),e.jsxs("div",{className:"p-2 border border-blue-500/30",children:[e.jsx("p",{className:"text-xs text-blue-400 font-terminal",children:r.conferenceData?.conferenceSolution?.name||"Google Meet"}),r.conferenceData?.entryPoints?.map((u,L)=>e.jsx("a",{href:u.uri,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-blue-300 hover:underline block mt-1 font-terminal",children:u.uri},L)),r.hangoutLink&&!r.conferenceData&&e.jsx("a",{href:r.hangoutLink,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-blue-300 hover:underline block mt-1 font-terminal",children:r.hangoutLink})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-green-500/80",children:"REMINDERS_"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{id:"use-default-reminders",checked:r.reminders?.useDefault!==!1,onCheckedChange:u=>E("reminders",u?{useDefault:!0}:{useDefault:!1,overrides:r.reminders?.overrides||[]}),className:"border-green-500/50 data-[state=checked]:bg-green-500"}),e.jsx(I,{htmlFor:"use-default-reminders",className:"text-xs text-green-500/80 cursor-pointer",children:"Use default reminders"})]})]})]})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between gap-4 border-t border-green-500/20 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsxs(M,{variant:"destructive",size:"sm",onClick:p,className:"rounded-none bg-red-900/20 text-red-400 hover:bg-red-900/40 border border-red-900/50 font-arcade text-[10px]",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"})," DELETE INSTANCE"]}),e.jsxs(M,{variant:"destructive",size:"sm",onClick:h,className:"rounded-none bg-red-900/10 text-red-500 hover:bg-red-900/30 border border-red-900/50 font-arcade text-[10px]",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"})," DELETE SERIES"]})]}):e.jsxs(M,{variant:"destructive",size:"sm",onClick:h,className:"rounded-none bg-red-900/20 text-red-500 hover:bg-red-900/40 border border-red-900/50 font-arcade text-xs",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"})," DELETE"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"ghost",className:"bg-transparent border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-xs",onClick:()=>r.htmlLink&&window.open(r.htmlLink,"_blank"),children:[e.jsx(Os,{className:"w-4 h-4 mr-2"})," OPEN"]}),e.jsx(M,{className:"bg-green-500 text-black hover:bg-green-400 rounded-none font-arcade text-xs px-6",onClick:l,children:"SAVE"})]})]})]})]})})}const it=["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","America/Indiana/Indianapolis","America/Detroit","America/Boise","America/Juneau","Pacific/Honolulu"],Sa=_s,Ia=[{id:"details",label:"DETAILS"},{id:"time",label:"TIME"},{id:"recurrence",label:"REPEAT"},{id:"people",label:"PEOPLE"},{id:"settings",label:"SETTINGS"}];function ka({open:s,onOpenChange:a,event:r,onEventChange:o,onSave:l,onDelete:p,courseOptions:h=[]}){const[f,j]=x.useState("details"),[v,c]=x.useState(""),w=x.useMemo(()=>{if(typeof Intl<"u"&&"supportedValuesOf"in Intl)try{const i=Intl.supportedValuesOf("timeZone").filter(A=>A.startsWith("America/")||A==="Pacific/Honolulu").slice().sort();return i.length>0?i:it}catch{return it}return it},[]),m=x.useMemo(()=>{if(!r)return"__none__";if(r.courseId)return String(r.courseId);if(r.course){const i=h.find(A=>A.name===r.course);if(i)return String(i.id)}return"__none__"},[r,h]);if(!r)return null;const C=new Date(r.date),R=r.endDate?new Date(r.endDate):null,D=r.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC",T=w[0]||"America/New_York",$=w.includes(D)?D:T,F=(()=>{const i=r.recurrence||"none";return i==="daily"?"RRULE:FREQ=DAILY":i==="weekly"?"RRULE:FREQ=WEEKLY":i==="monthly"?"RRULE:FREQ=MONTHLY":i==="yearly"?"RRULE:FREQ=YEARLY":i})(),g=["RRULE:FREQ=DAILY","RRULE:FREQ=WEEKLY","RRULE:FREQ=MONTHLY","RRULE:FREQ=YEARLY"],k=(i,A)=>{o({...r,[i]:A})},O=i=>{if(i==="__none__"){o({...r,course:null,courseId:null});return}const A=h.find(P=>String(P.id)===i);A&&o({...r,course:A.name,courseId:A.id})},E=()=>{const i=v.trim();if(!i||!i.includes("@"))return;const A=r.attendees||[];A.some(P=>P.email===i)||(k("attendees",[...A,{email:i}]),c(""))},G=i=>{k("attendees",(r.attendees||[]).filter(A=>A.email!==i))};return e.jsx(De,{open:s,onOpenChange:a,children:e.jsxs(Te,{"data-modal":"calendar-edit-local",className:"font-arcade bg-black border-2 border-primary rounded-none max-w-lg p-0 overflow-hidden translate-y-0 max-h-[calc(100vh-4rem)]",style:{zIndex:100005,top:"3rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsx(Re,{className:"sr-only",children:"Edit Event"}),e.jsx(Ae,{className:"sr-only",children:"Make changes to your event here. Click save when you're done."}),e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"bg-primary/20 border-b border-primary p-4 flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),e.jsx("span",{className:"text-primary font-bold tracking-wider",children:"EDIT_EVENT"})]}),e.jsx("div",{className:"flex border-b border-primary/30 shrink-0",children:Ia.map(i=>e.jsx("button",{className:U("flex-1 py-2 text-[10px] font-arcade transition-colors",f===i.id?"text-primary border-b-2 border-primary bg-primary/10":"text-zinc-500 hover:text-zinc-300"),onClick:()=>j(i.id),children:i.label},i.id))}),e.jsxs("div",{className:"p-5 space-y-4 overflow-y-auto flex-1 min-h-0",children:[f==="details"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"TITLE_"}),e.jsx(Y,{value:r.title,onChange:i=>k("title",i.target.value),className:"bg-black border-primary/50 focus:border-primary text-primary font-terminal text-lg h-12 rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"DESCRIPTION_"}),e.jsx(Le,{value:r.notes||"",onChange:i=>k("notes",i.target.value),className:"bg-black border-primary/50 text-primary font-terminal min-h-[80px] rounded-none resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"LOCATION_"}),e.jsx(Y,{value:r.location||"",onChange:i=>k("location",i.target.value||null),className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"EVENT_TYPE_"}),e.jsxs(Z,{value:r.eventType||"study",onValueChange:i=>k("eventType",i),children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[e.jsx(N,{value:"study",children:"STUDY"}),e.jsx(N,{value:"lecture",children:"LECTURE"}),e.jsx(N,{value:"exam",children:"EXAM"}),e.jsx(N,{value:"synchronous",children:"SYNCHRONOUS"}),e.jsx(N,{value:"online",children:"ONLINE"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"COURSE_"}),e.jsxs(Z,{value:m,onValueChange:O,children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"Select course"})}),e.jsxs(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[e.jsx(N,{value:"__none__",children:"None"}),h.length===0&&e.jsx(N,{value:"__empty__",disabled:!0,children:"No courses found"}),h.map(i=>e.jsx(N,{value:String(i.id),children:i.name},i.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"WEIGHT_"}),e.jsx(Y,{value:r.weight||"",onChange:i=>k("weight",i.target.value||null),placeholder:"e.g. High, Medium, Low",className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"COLOR_"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Sa.map(i=>e.jsx("button",{className:U("w-7 h-7 rounded-sm border-2 transition-all",r.color===i.value?"border-white scale-110":"border-transparent hover:border-white/30"),style:{backgroundColor:i.value},onClick:()=>k("color",i.value),title:i.label},i.value))})]})]})]}),f==="time"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Me,{id:"local-all-day",checked:r.allDay??!1,onCheckedChange:i=>k("allDay",!!i),className:"border-primary/50 data-[state=checked]:bg-primary"}),e.jsx(I,{htmlFor:"local-all-day",className:"text-xs text-primary/80 cursor-pointer",children:"ALL DAY EVENT"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"START_DATE_"}),e.jsx(Y,{type:"date",value:z(C,"yyyy-MM-dd"),onChange:i=>{const[A,P]=[C.getHours(),C.getMinutes()];k("date",pe(ge(new Date(i.target.value),A),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"END_DATE_"}),e.jsx(Y,{type:"date",value:R?z(R,"yyyy-MM-dd"):"",onChange:i=>{const A=i.target.value;k("endDate",A?new Date(A):null)},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]})]}),!r.allDay&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"START_TIME_"}),e.jsx(Y,{type:"time",value:z(C,"HH:mm"),onChange:i=>{const[A,P]=i.target.value.split(":").map(Number);k("date",pe(ge(C,A),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"END_TIME_"}),e.jsx(Y,{type:"time",value:R?z(R,"HH:mm"):"",onChange:i=>{if(!i.target.value)return;const[A,P]=i.target.value.split(":").map(Number);k("endDate",pe(ge(R||C,A),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"TIMEZONE_"}),e.jsxs(Z,{value:$,onValueChange:i=>k("timeZone",i),children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"Select timezone"})}),e.jsx(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:w.map(i=>e.jsx(N,{value:i,children:i},i))})]})]})]}),f==="recurrence"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"PATTERN_"}),e.jsxs(Z,{value:F,onValueChange:i=>k("recurrence",i==="none"?null:i),children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{placeholder:"No Recurrence"})}),e.jsxs(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[e.jsx(N,{value:"none",children:"None"}),e.jsx(N,{value:"RRULE:FREQ=DAILY",children:"Daily"}),e.jsx(N,{value:"RRULE:FREQ=WEEKLY",children:"Weekly"}),e.jsx(N,{value:"RRULE:FREQ=MONTHLY",children:"Monthly"}),e.jsx(N,{value:"RRULE:FREQ=YEARLY",children:"Yearly"})]})]})]}),r.recurrence&&!g.includes(F)&&F!=="none"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"CUSTOM_RRULE_"}),e.jsx(Le,{value:r.recurrence,onChange:i=>k("recurrence",i.target.value),className:"bg-black border-primary/30 text-primary text-[10px] font-mono h-12 rounded-none",placeholder:"RRULE:FREQ=WEEKLY;BYDAY=MO,WE"})]})]}),f==="people"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"ATTENDEES_"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:v,onChange:i=>c(i.target.value),onKeyDown:i=>i.key==="Enter"&&E(),placeholder:"email@example.com",className:"bg-black border-primary/50 text-primary font-terminal rounded-none text-xs flex-1"}),e.jsx(M,{size:"sm",onClick:E,className:"rounded-none bg-primary text-black hover:bg-primary/90 h-9 px-3",children:"ADD"})]})]}),e.jsxs("div",{className:"space-y-1",children:[(r.attendees||[]).map(i=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-zinc-800 text-xs font-terminal",children:[e.jsx("span",{className:"text-primary",children:i.email}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.responseStatus&&e.jsx("span",{className:U("text-[10px]",i.responseStatus==="accepted"?"text-green-400":i.responseStatus==="declined"?"text-red-400":"text-yellow-400"),children:i.responseStatus.toUpperCase()}),!i.self&&e.jsx("button",{onClick:()=>G(i.email),className:"text-red-500 hover:text-red-400",children:"X"})]})]},i.email)),(!r.attendees||r.attendees.length===0)&&e.jsx("p",{className:"text-xs text-zinc-500 font-terminal",children:"No attendees"})]})]}),f==="settings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"VISIBILITY_"}),e.jsxs(Z,{value:r.visibility||"default",onValueChange:i=>k("visibility",i==="default"?null:i),children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[e.jsx(N,{value:"default",children:"Default"}),e.jsx(N,{value:"public",children:"Public"}),e.jsx(N,{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"AVAILABILITY_"}),e.jsxs(Z,{value:r.transparency||"opaque",onValueChange:i=>k("transparency",i),children:[e.jsx(B,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:e.jsx(W,{})}),e.jsxs(J,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[e.jsx(N,{value:"opaque",children:"Busy"}),e.jsx(N,{value:"transparent",children:"Free"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-xs text-primary/80",children:"REMINDERS_"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{id:"use-default-reminders-local",checked:r.reminders?.useDefault!==!1,onCheckedChange:i=>k("reminders",i?{useDefault:!0}:{useDefault:!1,overrides:r.reminders?.overrides||[]}),className:"border-primary/50 data-[state=checked]:bg-primary"}),e.jsx(I,{htmlFor:"use-default-reminders-local",className:"text-xs text-primary/80 cursor-pointer",children:"Use default reminders"})]})]})]})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between gap-4 border-t border-primary/20 shrink-0",children:[e.jsxs(M,{variant:"destructive",size:"sm",onClick:p,className:"rounded-none bg-red-900/20 text-red-500 hover:bg-red-900/40 border border-red-900/50 font-arcade text-xs",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"})," DELETE"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",className:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10 rounded-none font-arcade text-xs",onClick:()=>a(!1),children:"CANCEL"}),e.jsx(M,{className:"bg-primary text-black hover:bg-primary/90 rounded-none font-arcade text-xs px-6",onClick:l,children:"SAVE"})]})]})]})]})})}const Da=s=>{let{transform:a}=s;return{...a,x:0}},dt=s=>{if(!s)return new Date;const[a,r,o]=s.split("-").map(Number);return!a||!r||!o?new Date(s):new Date(a,r-1,o)},ct=Array.from({length:24},(s,a)=>a),xe=60;function Ta({tasks:s,taskLists:a}){const r=ft(),{toast:o}=Wt(),[l,p]=x.useState(null),[h,f]=x.useState(null),[j,v]=x.useState(0),[c,w]=x.useState(null),m=ar(ht(ir,{activationConstraint:{distance:8}}),ht(ks,{coordinateGetter:la})),C=q({mutationFn:g=>Q.googleTasks.move(g.taskId,g.listId,g.destListId,g.previous,g.parent),onSuccess:()=>r.invalidateQueries({queryKey:["google-tasks"]}),onError:()=>o({title:"Move Failed",variant:"destructive"})}),R=q({mutationFn:g=>Q.googleTasks.update(g.id,g.listId,g.data),onSuccess:()=>{r.invalidateQueries({queryKey:["google-tasks"]}),f(null)}}),D=q({mutationFn:g=>Q.googleTasks.create(g.listId,{title:g.title,status:"needsAction"}),onSuccess:()=>r.invalidateQueries({queryKey:["google-tasks"]})}),T=q({mutationFn:g=>Q.googleTasks.delete(g.id,g.listId),onSuccess:()=>r.invalidateQueries({queryKey:["google-tasks"]})}),$=q({mutationFn:g=>Q.googleTasks.update(g.id,g.listId,{status:g.status==="completed"?"needsAction":"completed"}),onSuccess:()=>r.invalidateQueries({queryKey:["google-tasks"]})}),F=g=>{const{active:k,over:O}=g;if(p(null),!O)return;const E=s.find(i=>i.id===k.id);if(!E)return;let G=null;if(O.data.current?.listId)G=O.data.current.listId;else if(O.data.current?.type==="Container")G=O.id;else{const i=s.find(A=>A.id===O.id);i&&(G=i.listId)}if(G&&(k.id!==O.id||E.listId!==G)){const i=s.filter(P=>P.listId===G).sort((P,H)=>(P.position||"").localeCompare(H.position||""));let A;if(k.id!==O.id){s.findIndex(H=>H.id===k.id);const P=i.findIndex(H=>H.id===O.id);P!==-1&&P>0&&(A=i[P-1].id)}C.mutate({taskId:E.id,listId:E.listId,destListId:G,previous:A})}};return e.jsxs(or,{sensors:m,collisionDetection:lr,onDragEnd:F,onDragStart:g=>p(g.active.id),children:[e.jsxs("div",{className:"flex h-full items-start justify-center gap-4 pt-4",children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>v(g=>(g-1+a.length)%a.length),className:"h-10 w-10 mt-3 rounded-none border border-secondary hover:bg-primary/10 hover:text-primary shrink-0",children:e.jsx(nr,{className:"h-5 w-5"})}),a.length>0&&(()=>{const g=a[j],k=s.filter(O=>O.listId===g.id).sort((O,E)=>(O.position||"").localeCompare(E.position||""));return e.jsx("div",{className:"h-full w-[320px] shrink-0",children:e.jsx(Na,{listId:g.id,title:g.title,tasks:k,onAddTask:O=>w(O),onEdit:O=>f(O),onToggle:O=>$.mutate(O),onDelete:(O,E)=>{confirm("Delete task?")&&T.mutate({id:O,listId:E})}},g.id)})})(),e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>v(g=>(g+1)%a.length),className:"h-10 w-10 mt-3 rounded-none border border-secondary hover:bg-primary/10 hover:text-primary shrink-0",children:e.jsx(yt,{className:"h-5 w-5"})})]}),e.jsx(Ds,{children:l?e.jsx("div",{className:"opacity-80 rotate-2 cursor-grabbing",children:e.jsx("div",{className:"p-2 border bg-card text-primary font-arcade text-xs border-primary",children:s.find(g=>g.id===l)?.title||"Task"})}):null}),e.jsx(Kt,{task:h,isOpen:!!h,onClose:()=>f(null),onSave:g=>{h&&R.mutate({id:h.id,listId:h.listId,data:g})},onDelete:(g,k)=>T.mutate({id:g,listId:k}),availableLists:a}),e.jsx(Kt,{task:null,isOpen:!!c,isCreating:!0,activeListId:c||void 0,availableLists:a,onClose:()=>w(null),onSave:g=>{c&&g.title&&D.mutate({listId:c,title:g.title,...g})},onDelete:()=>{}})]})}function Ra({cal:s,isHidden:a,onToggle:r}){const{attributes:o,listeners:l,setNodeRef:p,transform:h,transition:f}=jt({id:s.id}),j={transform:Ke.Transform.toString(h),transition:f};return e.jsxs("div",{ref:p,style:j,className:U("flex items-center gap-3 p-2 border border-secondary hover:bg-secondary/30 transition-colors",a&&"opacity-50"),children:[e.jsx("div",{...o,...l,className:"cursor-grab text-muted-foreground hover:text-foreground",children:e.jsx(ls,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-4 h-4 rounded-sm",style:{backgroundColor:s.color}}),e.jsx("span",{className:"font-terminal text-sm flex-1 cursor-pointer",onClick:r,children:s.name}),e.jsx("span",{className:U("font-arcade text-[10px] px-2 py-0.5 cursor-pointer",a?"text-destructive":"text-success"),onClick:r,children:a?"HIDDEN":"VISIBLE"})]})}function Xa(){const s=ft(),{toast:a}=Wt(),[r,o]=x.useState(new Date),[l,p]=x.useState("month"),[h,f]=x.useState(!1),[j,v]=x.useState(!1),[c,w]=x.useState(null),[m,C]=x.useState({title:"",date:"",endDate:"",startTime:"09:00",endTime:"10:00",allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:""}),[R,D]=x.useState(()=>{try{const t=localStorage.getItem("selectedCalendars");if(t){const n=JSON.parse(t);if(Array.isArray(n))return new Set(n)}}catch{}return new Set}),[T,$]=x.useState(!0),[F,g]=x.useState(!1),[k,O]=x.useState(""),[E,G]=x.useState(null),[i,A]=x.useState(!1),[P,H]=x.useState("series"),[je,u]=x.useState(!1),[L,te]=x.useState(!1),[ie,fe]=x.useState(!1),re=typeof window<"u"&&new URLSearchParams(window.location.search).has("debugModals"),[de,Ze]=x.useState(()=>{const t=localStorage.getItem("pinnedCalendars");return t?JSON.parse(t):[]}),[ce,ae]=x.useState(()=>{const t=localStorage.getItem("hiddenCalendars");return t?JSON.parse(t):[]}),[ue,ye]=x.useState(!1),Oe=ar(ht(ir,{activationConstraint:{distance:5}})),[Cr,wt]=x.useState(!1);x.useEffect(()=>{j&&!c&&(re&&console.warn("[ModalDebug][Calendar] Edit modal open without event; closing."),v(!1))},[re,c,j]),x.useEffect(()=>{i&&!E&&(re&&console.warn("[ModalDebug][Calendar] Google edit modal open without event; closing."),A(!1))},[re,E,i]),x.useEffect(()=>{re&&console.info("[ModalDebug][Calendar] state",{showEditModal:j,selectedEvent:c?.id??null,showGoogleEditModal:i,selectedGoogleEvent:E?.id??null,googleEditMode:P,showCalendarSettings:ue,showEventModal:h})},[re,c,E,P,ue,j,h,i]);const me=t=>{ae(n=>{const d=n.includes(t),b=d?n.filter(y=>y!==t):[...n,t];return localStorage.setItem("hiddenCalendars",JSON.stringify(b)),d||D(y=>{const S=new Set(y);return S.delete(t),S}),b})},ne=ot(r),K=at(r),Be=st(ne,{weekStartsOn:0}),_e=Gt(K,{weekStartsOn:0}),ve=nt({start:Be,end:_e}),be=st(r,{weekStartsOn:0}),Ne=nt({start:be,end:oe(be,6)}),{data:Sr=[]}=se({queryKey:["events"],queryFn:Q.events.getAll}),Fe=Sr.map(t=>({...t,date:new Date(t.date),endDate:t.endDate?new Date(t.endDate):null,createdAt:new Date(t.createdAt)})),{data:Pe=[],isLoading:Ct,refetch:Ue}=se({queryKey:["google-calendar",r.getFullYear(),r.getMonth()],queryFn:async()=>{const t=ot(qt(r)).toISOString(),n=at(gt(r,1)).toISOString(),d=await fetch(`/api/google-calendar/events?timeMin=${encodeURIComponent(t)}&timeMax=${encodeURIComponent(n)}`);if(!d.ok)throw new Error("Failed to fetch");return d.json()}}),{data:Ir=[]}=se({queryKey:["tasks"],queryFn:Q.tasks.getAll}),{data:St=[],isLoading:Aa,isError:La,refetch:Ma}=se({queryKey:["google-tasks"],queryFn:Q.googleTasks.getAll,retry:1}),{data:It=[]}=se({queryKey:["courses"],queryFn:Q.courses.getActive}),{data:kr=[]}=se({queryKey:["google-task-lists"],queryFn:Q.googleTasks.getLists}),{data:kt=[],refetch:Dr}=se({queryKey:["google-calendar-list"],queryFn:async()=>{const t=await fetch("/api/google-calendar/calendars");if(!t.ok)throw new Error("Failed to fetch calendar list");return t.json()}}),{data:Dt,refetch:Tt,isLoading:Oa,error:_a}=se({queryKey:["google-status"],queryFn:Q.google.getStatus,retry:1}),Ye=!!Dt?.connected,Tr=async()=>{if(!ie){fe(!0);try{const t=await Tt();if(t.data&&!t.data.connected){a({title:"SYNC_FAILED",description:"Google is not connected.",variant:"destructive"});return}const b=((await Dr()).data||[]).map(S=>S.id).filter(Boolean);let y=null;if(b.length>0){const S=await fetch("/api/gcal/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({calendar_ids:b})});if(!S.ok)throw new Error("Failed to sync with Google.");const _=await S.json();if(_?.success===!1)throw new Error(_.error||"Sync failed.");y=_||null}if(b.length>0){const S=new Set(b);D(S),ae([]),typeof window<"u"&&(localStorage.setItem("selectedCalendars",JSON.stringify(b)),localStorage.setItem("hiddenCalendars",JSON.stringify([]))),g(!1)}if(s.invalidateQueries({queryKey:["events"]}),await Ue(),y){const S=[typeof y.imported=="number"?`${y.imported} imported`:null,typeof y.updated=="number"?`${y.updated} updated`:null,typeof y.pushed=="number"?`${y.pushed} pushed`:null].filter(Boolean).join(", "),_=y.errors?.length?` (${y.errors.length} errors)`:"";a({title:"SYNCED",description:`Google sync complete${S?`: ${S}`:""}${_}.`})}else a({title:"SYNCED",description:"Google calendars refreshed."})}catch(t){a({title:"SYNC_FAILED",description:t instanceof Error?t.message:"Unable to sync Google calendars.",variant:"destructive"})}finally{fe(!1)}}},We=q({mutationFn:async()=>{const{authUrl:t}=await Q.google.getAuthUrl();window.location.href=t}});q({mutationFn:Q.google.disconnect,onSuccess:()=>{Tt(),s.invalidateQueries({queryKey:["google-calendar-events"]}),s.invalidateQueries({queryKey:["google-calendar-list"]}),s.invalidateQueries({queryKey:["google-tasks"]})}});const{data:Je=[]}=se({queryKey:["calendar-order"],queryFn:async()=>{const t=await fetch("/api/calendar-order?userId=default");return t.ok?t.json():[]}}),Rr=q({mutationFn:async t=>{if(!(await fetch("/api/calendar-order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:"default",order:t})})).ok)throw new Error("Failed to save calendar order")},onMutate:async t=>{await s.cancelQueries({queryKey:["calendar-order"]}),s.setQueryData(["calendar-order"],t)},onError:()=>{s.invalidateQueries({queryKey:["calendar-order"]})}}),X=x.useMemo(()=>{const t=kt.map(n=>({id:n.id,name:n.summary,color:n.backgroundColor||"#888888"}));if(Je.length>0){const n=new Map(Je.map((d,b)=>[d,b]));t.sort((d,b)=>{const y=n.get(d.id)??999,S=n.get(b.id)??999;return y-S})}return t},[kt,Je]),Ar=x.useMemo(()=>X.filter(t=>!ce.includes(t.id)),[X,ce]),Rt=x.useMemo(()=>{const t=It.map(d=>({id:d.id,name:d.name,code:d.code??null})).filter(d=>!!d.name),n=new Map;return t.forEach(d=>{n.has(d.id)||n.set(d.id,d)}),Array.from(n.values()).sort((d,b)=>d.name.localeCompare(b.name))},[It]);x.useEffect(()=>{if(X.length>0&&R.size===0&&!localStorage.getItem("selectedCalendars")){const t=de.length>0?de:X.slice(0,2).map(n=>n.id);D(new Set(t))}},[X,de]),x.useEffect(()=>{if(X.length>0&&de.length===0&&!localStorage.getItem("pinnedCalendars")){const t=X.slice(0,2).map(n=>n.id);Ze(t),localStorage.setItem("pinnedCalendars",JSON.stringify(t))}},[X,de]);const Lr=t=>{D(n=>{const d=new Set(n);return d.has(t)?d.delete(t):d.add(t),d}),g(!0)},Mr=q({mutationFn:Q.events.create,onSuccess:()=>{s.invalidateQueries({queryKey:["events"]}),f(!1),Lt()}}),Or=q({mutationFn:({id:t,data:n})=>Q.events.update(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:["events"]}),v(!1),w(null)}}),_r=q({mutationFn:Q.events.delete,onSuccess:()=>{s.invalidateQueries({queryKey:["events"]}),v(!1),w(null)}});q({mutationFn:Q.tasks.create,onSuccess:()=>{s.invalidateQueries({queryKey:["tasks"]})}}),q({mutationFn:({id:t,status:n})=>Q.tasks.update(t,{status:n==="completed"?"pending":"completed"}),onSuccess:()=>{s.invalidateQueries({queryKey:["tasks"]})}}),q({mutationFn:async t=>{const n=await fetch("/api/google-tasks/@default",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t})});if(!n.ok)throw new Error("Failed to create task");return n.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["google-tasks"]})}}),q({mutationFn:async({taskId:t,completed:n})=>{const d=await fetch(`/api/google-tasks/@default/${t}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:n})});if(!d.ok)throw new Error("Failed to toggle task");return d.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["google-tasks"]})}});const At=q({mutationFn:async({eventId:t,calendarId:n})=>{const d=await fetch(`/api/google-calendar/events/${encodeURIComponent(t)}?calendarId=${encodeURIComponent(n)}`,{method:"DELETE"});if(!d.ok)throw new Error("Failed to delete event");return d.status===204?null:d.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["google-calendar"]}),Ue(),a({title:"EVENT_DELETED",description:"Event removed from Google Calendar"}),A(!1),G(null)},onError:t=>{a({title:"DELETE_FAILED",description:t.message,variant:"destructive"})}}),Fr=q({mutationFn:async t=>{if(!t.calendarId)throw new Error("Missing calendarId");const n={...t.extendedProperties?.private||{}};t.eventType!==void 0?n.eventType=t.eventType:delete n.eventType,t.course!==void 0?n.course=t.course:delete n.course,t.courseId!==void 0?n.courseId=String(t.courseId):delete n.courseId,t.courseCode!==void 0?n.courseCode=t.courseCode:delete n.courseCode,t.weight!==void 0?n.weight=t.weight:delete n.weight;const d=t.extendedProperties?.private?.timeZone||t.start?.timeZone;d&&(n.timeZone=d);const b=Object.keys(n).length?{private:n}:void 0,y=await fetch(`/api/google-calendar/events/${encodeURIComponent(t.id)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({calendarId:t.calendarId,summary:t.summary,description:t.description,location:t.location,start:t.start,end:t.end,recurrence:t.recurringEventId?void 0:t.recurrence,attendees:t.attendees,visibility:t.visibility,transparency:t.transparency,colorId:t.colorId,reminders:t.reminders,extendedProperties:b})});if(!y.ok)throw new Error("Failed to update google event");return y.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["google-calendar"]}),Ue(),a({title:"EVENT_UPDATED",description:"Changes synced to Google Calendar"}),A(!1)},onError:t=>{a({title:"SYNC_FAILED",description:t.message,variant:"destructive"})}}),Pr=q({mutationFn:async t=>{const n=await fetch("/api/google-calendar/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to create Google event");return n.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["google-calendar"]}),Ue(),f(!1),Lt(),a({title:"EVENT_CREATED",description:"Saved to Google Calendar"})},onError:t=>{a({title:"CREATE_FAILED",description:t.message,variant:"destructive"})}}),Ur=()=>{!E||!E.calendarId||confirm("Delete this single occurrence?")&&At.mutate({eventId:E.id,calendarId:E.calendarId})},Yr=()=>{if(!E||!E.calendarId)return;const t=E.recurringEventId||E.id;confirm("Delete the ENTIRE series? This cannot be undone.")&&At.mutate({eventId:t,calendarId:E.calendarId})},$r=()=>{E&&Fr.mutate(E)},Lt=()=>{C({title:"",date:"",endDate:"",startTime:"09:00",endTime:"10:00",allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:""})},zr=t=>{if(!t||t==="none")return null;if(t.startsWith("RRULE:"))return t;switch(t){case"daily":return"RRULE:FREQ=DAILY";case"weekly":return"RRULE:FREQ=WEEKLY";case"monthly":return"RRULE:FREQ=MONTHLY";case"yearly":return"RRULE:FREQ=YEARLY";default:return t}},Gr=t=>"summary"in t,$e=t=>{if(Gr(t)){const n=!!t.start?.date&&!t.start?.dateTime,d=t.start?.dateTime||t.start?.date||new Date().toISOString(),b=t.end?.dateTime||t.end?.date||d,y=n&&t.start?.date?dt(t.start.date):new Date(d);let S=n&&t.end?.date?dt(t.end.date):new Date(b);n&&t.start?.date&&t.end?.date&&t.end.date>t.start.date&&(S=oe(dt(t.end.date),-1));const _=!!(t.conferenceData||t.hangoutLink),V=t.eventType||t.extendedProperties?.private?.eventType;return{id:t.id,title:t.summary||"Untitled",start:y,end:S,allDay:n,isGoogle:!0,eventType:V||(_?"online":"synchronous"),calendarColor:t.calendarColor,calendarName:t.calendarSummary,originalEvent:t}}else{const n=t,d=new Date(n.date),b=n.endDate?new Date(n.endDate):Ys(d,1);return{id:n.id,title:n.title,start:d,end:b,allDay:n.allDay||!1,isGoogle:!1,eventType:n.eventType,calendarColor:n.color||void 0,originalEvent:t}}},Mt=t=>!t.calendarId||t.calendarId==="local",Qr=()=>{if(m.title&&m.date){const[t,n]=m.startTime.split(":").map(Number),[d,b]=m.endTime.split(":").map(Number),y=pe(ge(new Date(m.date),t),n);let S=null;if(m.allDay)m.endDate&&(S=new Date(m.endDate));else{const V=m.endDate||m.date;S=pe(ge(new Date(V),d),b)}const _=zr(m.recurrence);if(m.calendarId&&m.calendarId!=="local"){if(!Ye){a({title:"SYNC_FAILED",description:"Google is not connected.",variant:"destructive"});return}const V=m.allDay&&m.endDate?oe(new Date(m.endDate),1):S;Pr.mutate({calendarId:m.calendarId,title:m.title,date:y,endDate:V,allDay:m.allDay,recurrence:_});return}Mr.mutate({title:m.title,date:y,endDate:S,allDay:m.allDay,eventType:m.eventType,color:m.color,recurrence:_,calendarId:"local"})}},ze=(t,n)=>{const d=n??9;C({title:"",date:z(t,"yyyy-MM-dd"),endDate:"",startTime:`${d.toString().padStart(2,"0")}:00`,endTime:`${(d+1).toString().padStart(2,"0")}:00`,allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:"local"}),f(!0)},qr=t=>{t&&(w(t),v(!0))},Ot=(t,n)=>{const d=t.extendedProperties?.private||{},b=d.courseId?Number.parseInt(d.courseId,10):void 0,y=Number.isFinite(b)?b:void 0;return{...t,calendarId:t.calendarId??n?.calendarId,calendarSummary:t.calendarSummary??n?.calendarSummary,calendarColor:t.calendarColor??n?.calendarColor,eventType:t.eventType||d.eventType||n?.eventType,course:t.course||d.course||n?.course,courseId:t.courseId??y??n?.courseId,courseCode:t.courseCode||d.courseCode||n?.courseCode,weight:t.weight||d.weight||n?.weight}},Hr=(t,n)=>{if(!t)return;const d=t.recurringEventId?"instance":"series";H(d),G(Ot(t)),A(!0)},Kr=async()=>{if(!(!E?.recurringEventId||!E.calendarId))try{const t=await fetch(`/api/google-calendar/events/${encodeURIComponent(E.recurringEventId)}?calendarId=${encodeURIComponent(E.calendarId)}`);if(!t.ok)throw new Error("Failed to load series");const n=await t.json(),d=Ot({...n,calendarId:E.calendarId,calendarSummary:E.calendarSummary,calendarColor:E.calendarColor},E);G(d),H("series")}catch(t){a({title:"LOAD_FAILED",description:t?.message||"Unknown error",variant:"destructive"})}},Ee=t=>{t.isGoogle?Hr(t.originalEvent):qr(t.originalEvent)};x.useMemo(()=>{if(!k.trim())return[];const t=k.toLowerCase(),n=[];return T&&Fe.forEach(d=>{Ye&&!Mt(d)||d.title.toLowerCase().includes(t)&&n.push($e(d))}),Pe.forEach(d=>{R.has(d.calendarId||"")&&d.summary?.toLowerCase().includes(t)&&n.push($e(d))}),n.sort((d,b)=>d.start.getTime()-b.start.getTime())},[k,Fe,Pe,T,R]);const _t=x.useMemo(()=>{const t=[];return T&&Fe.forEach(n=>{Ye&&!Mt(n)||t.push($e(n))}),Pe.forEach(n=>{R.has(n.calendarId||"")&&t.push($e(n))}),t},[Fe,Pe,T,R,Ye]),Vr=x.useMemo(()=>{const t=new Map;return _t.forEach(n=>{const d=$t(n.start),b=$t(n.end);let y=d;for(;y<=b;){const S=z(y,"yyyy-MM-dd");t.has(S)||t.set(S,[]),t.get(S).push(n),y=oe(y,1)}}),t.forEach(n=>{n.sort((d,b)=>d.allDay&&!b.allDay?-1:!d.allDay&&b.allDay?1:d.start.getTime()-b.start.getTime())}),t},[_t]),we=t=>{const n=z(t,"yyyy-MM-dd");return Vr.get(n)||[]},Ft=t=>{o(l==="month"?t==="prev"?qt(r):gt(r,1):l==="week"?t==="prev"?Qs(r):ur(r,1):t==="prev"?Gs(r):oe(r,1))},Zr=()=>o(new Date),Xe=t=>{o(t),p("day")};Ir.filter(t=>t.status==="pending").length,St.filter(t=>t.status==="needsAction").length;const Br=()=>l==="month"?z(r,"MMMM yyyy").toUpperCase():l==="week"?`${z(be,"MMM d")} - ${z(oe(be,6),"MMM d, yyyy")}`.toUpperCase():z(r,"EEEE, MMMM d, yyyy").toUpperCase(),Ce=t=>{const n="backdrop-blur-sm shadow-sm transition-all duration-200 hover:scale-[1.02] hover:z-50 hover:shadow-lg";if(t.calendarColor)return`${n} text-white font-medium border-l-4`;if(t.isGoogle)return`${n} text-white font-medium border-l-4`;switch(t.eventType){case"study":return`${n} bg-red-500/30 text-white border-l-4 border-red-500`;case"lecture":return`${n} bg-cyan-500/30 text-white border-l-4 border-cyan-500`;case"exam":return`${n} bg-amber-500/30 text-white border-l-4 border-amber-500`;default:return`${n} bg-red-500/30 text-white border-l-4 border-red-500`}},Se=t=>{if(t.calendarColor){const n=t.calendarColor.replace("#",""),d=parseInt(n.substring(0,2),16),b=parseInt(n.substring(2,4),16),y=parseInt(n.substring(4,6),16);return{backgroundColor:`rgba(${d}, ${b}, ${y}, 0.35)`,borderLeftColor:t.calendarColor,boxShadow:"0 4px 6px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"}}return{boxShadow:"0 4px 6px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"}},Pt=(t,n,d=0,b=1)=>{const y=zt(t.start,n),S=zt(t.end,t.start),_=y/60*xe,V=Math.max(S/60*xe,24),Ie=b>1?`${100/b}%`:"calc(100% - 4px)",et=b>1?`${d/b*100}%`:"0",tt={top:`${_}px`,height:`${V}px`,width:Ie,left:et};return t.calendarColor&&(tt.backgroundColor=t.calendarColor,tt.borderLeftColor=t.calendarColor),tt},Ut=t=>{const n=new Map;if(t.length===0)return n;const d=[...t].sort((y,S)=>y.start.getTime()-S.start.getTime()),b=[];for(const y of d){let S=-1;for(let _=0;_<b.length;_++)if(y.start>=b[_]){S=_;break}S===-1?(S=b.length,b.push(y.end)):b[S]=y.end,n.set(y.id,{column:S,totalColumns:1})}for(const y of d){let S=1;for(const V of d)if(y.id!==V.id&&y.start<V.end&&y.end>V.start){const Ie=n.get(y.id)?.column||0,et=n.get(V.id)?.column||0;S=Math.max(S,Ie+1,et+1)}const _=n.get(y.id);_&&n.set(y.id,{..._,totalColumns:S})}return n};return e.jsxs(os,{children:[re&&e.jsxs("div",{className:"fixed bottom-12 right-4 z-[70] bg-black/80 border border-primary text-primary font-terminal text-[10px] px-2 py-1 rounded-none",children:[e.jsx("div",{children:"Calendar modals"}),e.jsxs("div",{children:["Edit event: ",j?"open":"closed"]}),e.jsxs("div",{children:["Selected event: ",c?.id??"none"]}),e.jsxs("div",{children:["Google edit: ",i?"open":"closed"]}),e.jsxs("div",{children:["Google event: ",E?.id??"none"]}),e.jsxs("div",{children:["Manage calendars: ",ue?"open":"closed"]}),e.jsxs("div",{children:["Create event: ",h?"open":"closed"]})]}),e.jsx("div",{className:"h-[calc(100vh-80px)]",children:e.jsx("div",{className:"flex flex-col h-full",children:e.jsxs(Xt,{className:"bg-black/40 border-2 border-primary rounded-none flex-1 flex flex-col overflow-hidden",children:[e.jsxs(er,{className:"border-b border-primary/30 p-4 flex flex-row justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{size:"sm",variant:"outline",className:"rounded-none border-primary text-primary hover:bg-primary hover:text-black font-arcade text-xs",onClick:Zr,"data-testid":"button-today",children:"TODAY"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none hover:bg-primary/20",onClick:()=>Ft("prev"),"data-testid":"button-prev",children:e.jsx(nr,{className:"h-4 w-4"})}),e.jsx(M,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none hover:bg-primary/20",onClick:()=>Ft("next"),"data-testid":"button-next",children:e.jsx(yt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"font-arcade text-sm md:text-lg text-primary hover:text-primary/80 flex items-center gap-1 transition-colors",onClick:()=>te(!L),"data-testid":"text-header-title",children:[Br(),e.jsx(Ts,{className:U("w-4 h-4 transition-transform",L&&"rotate-180")})]}),L&&e.jsx("div",{className:"absolute top-full left-0 mt-2 z-50 bg-black border-2 border-primary p-2 shadow-lg",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-center min-w-[200px]",children:[["S","M","T","W","T","F","S"].map((t,n)=>e.jsx("div",{className:"font-arcade text-[8px] text-muted-foreground p-1",children:t},n)),nt({start:st(ot(r),{weekStartsOn:0}),end:Gt(at(r),{weekStartsOn:0})}).slice(0,42).map((t,n)=>e.jsx("button",{onClick:()=>{Xe(t),te(!1)},className:U("font-terminal text-[10px] p-1 hover:bg-primary/20 transition-colors",!Qt(t,r)&&"text-muted-foreground/50",he(t)&&"bg-primary text-black",Is(t,r)&&!he(t)&&"ring-1 ring-primary"),children:z(t,"d")},n))]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative hidden md:block",children:[e.jsx(Fs,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-muted-foreground"}),e.jsx(Y,{className:"rounded-none bg-black/60 border-secondary pl-7 pr-2 font-terminal text-xs h-8 w-40",placeholder:"Search...",value:k,onChange:t=>O(t.target.value),"data-testid":"input-search-events"})]}),e.jsx(Ea,{onClick:()=>u(!0)}),e.jsx(M,{size:"sm",variant:"ghost",className:"rounded-none hover:bg-primary/20",onClick:Tr,disabled:Ct||ie,"data-testid":"button-sync",children:e.jsx(dr,{className:U("h-4 w-4",(Ct||ie)&&"animate-spin")})}),e.jsx("div",{className:"flex border border-secondary rounded-none",children:["month","week","day","tasks"].map(t=>e.jsx(M,{size:"sm",variant:l===t?"default":"ghost",className:U("rounded-none font-arcade text-xs px-3",l===t?"bg-primary text-black":""),onClick:()=>p(t),"data-testid":`button-${t}-view`,children:t.toUpperCase()},t))}),e.jsxs(M,{size:"sm",className:"rounded-none font-arcade text-xs bg-primary text-black hover:bg-primary/90",onClick:()=>ze(r),"data-testid":"button-create-event-header",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"})," CREATE"]})]})]}),e.jsxs("div",{className:"px-4 py-1.5 border-b border-primary/20 bg-black/60 flex items-center gap-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-x-auto flex-1 min-w-0",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground shrink-0",children:"CALENDARS:"}),e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity shrink-0",onClick:()=>$(!T),children:[e.jsx("div",{className:U("w-3 h-3 rounded-sm",T?"bg-primary":"bg-muted-foreground/30")}),e.jsx("span",{className:U("font-terminal text-sm",T?"text-primary":"text-muted-foreground"),children:"Local"})]}),Ar.map(t=>e.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:opacity-80 transition-opacity shrink-0",onClick:()=>Lr(t.id),children:[e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:R.has(t.id)?t.color:"rgba(100,100,100,0.3)"}}),e.jsx("span",{className:U("font-terminal text-sm truncate max-w-[100px]",R.has(t.id)?"":"text-muted-foreground"),children:t.name})]},t.id)),ce.length>0&&e.jsxs("span",{className:"font-terminal text-[10px] text-muted-foreground shrink-0",children:["+",ce.length," hidden"]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(M,{size:"sm",variant:"ghost",className:"h-6 px-2 rounded-none hover:bg-primary/20 font-arcade text-[9px] flex items-center gap-1.5",onClick:()=>{localStorage.setItem("selectedCalendars",JSON.stringify(Array.from(R))),g(!1),a({title:"SAVED",description:`${R.size} calendar(s) saved`})},children:[e.jsx("div",{className:U("w-2 h-2 rounded-full",F?"bg-destructive":"bg-success")}),"SAVE"]}),e.jsx(M,{size:"sm",variant:"ghost",className:"h-6 px-2 rounded-none hover:bg-primary/20 font-arcade text-[9px]",onClick:()=>{re&&console.info("[ModalDebug][Calendar] MANAGE click"),ye(!0)},children:"MANAGE"}),Dt?.connected?e.jsxs("div",{className:"flex items-center gap-1 text-success",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-current"}),e.jsx("span",{className:"font-terminal text-[10px]",children:"SYNCED"})]}):e.jsx(M,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none border-warning text-warning hover:bg-warning/20 font-arcade text-[9px]",onClick:()=>We.mutate(),disabled:We.isPending,children:We.isPending?"CONNECTING...":"CONNECT GOOGLE"})]})]}),e.jsx(De,{open:ue,onOpenChange:ye,modal:!1,children:e.jsxs(Te,{"data-modal":"calendar-manage",className:"bg-black border-2 border-primary rounded-none max-w-md pointer-events-auto translate-y-0 data-[state=open]:animate-none data-[state=closed]:animate-none",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(Yt,{children:[e.jsx(Re,{className:"font-arcade text-primary",children:"MANAGE CALENDARS"}),e.jsx(Ae,{className:"sr-only",children:"Reorder or hide calendars."})]}),e.jsxs("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:[e.jsx("p",{className:"font-terminal text-xs text-muted-foreground mb-4",children:"Drag to reorder. Click to show/hide."}),e.jsx(or,{sensors:Oe,collisionDetection:lr,modifiers:[Da],onDragEnd:t=>{const{active:n,over:d}=t;if(!d||n.id===d.id)return;const b=X.findIndex(_=>_.id===n.id),y=X.findIndex(_=>_.id===d.id);if(b===-1||y===-1)return;const S=bt(X,b,y);Rr.mutate(S.map(_=>_.id))},children:e.jsx(yr,{items:X.map(t=>t.id),strategy:gr,children:X.map(t=>e.jsx(Ra,{cal:t,isHidden:ce.includes(t.id),onToggle:()=>me(t.id)},t.id))})})]}),e.jsx(ut,{children:e.jsx(M,{variant:"outline",className:"rounded-none border-primary font-arcade text-xs",onClick:()=>ye(!1),children:"CLOSE"})})]})}),e.jsxs(cs,{className:"p-0 flex-1 overflow-hidden flex flex-col",children:[l==="month"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-secondary bg-secondary/20 shrink-0",children:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(t=>e.jsx("div",{className:"p-2 text-center font-arcade text-xs text-zinc-400 border-r border-secondary last:border-r-0",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 flex-1 overflow-auto",children:ve.map((t,n)=>{const d=we(t),b=Qt(t,r),y=he(t);return e.jsxs("div",{onClick:()=>Xe(t),className:U("min-h-[180px] border-r border-b border-secondary p-1.5 cursor-pointer transition-colors hover:bg-secondary/30",!b&&"bg-secondary/10 text-muted-foreground",n%7===6&&"border-r-0"),"data-testid":`day-cell-${z(t,"yyyy-MM-dd")}`,children:[e.jsx("div",{className:U("text-right font-terminal text-sm w-6 h-6 flex items-center justify-center ml-auto",y&&"bg-red-500 text-white rounded-none font-bold"),children:z(t,"d")}),e.jsxs("div",{className:"space-y-0.5 mt-1",children:[d.slice(0,3).map((S,_)=>e.jsxs("div",{className:U("text-xs font-terminal truncate px-1.5 py-1 rounded cursor-pointer hover:brightness-110",Ce(S)),style:Se(S),title:S.title,onClick:V=>{V.stopPropagation(),Ee(S)},children:[S.eventType==="online"&&e.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-primary/60 mr-1 align-middle",title:"Online"}),S.title]},`${S.id}-${_}`)),d.length>3&&e.jsxs("div",{className:"text-[10px] font-terminal text-zinc-400 px-1 mt-0.5",children:["+",d.length-3," more"]})]})]},n)})})]}),l==="week"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-secondary bg-secondary/20 shrink-0",children:[e.jsx("div",{className:"p-2 w-16 border-r border-secondary"}),Ne.map(t=>e.jsxs("div",{className:"p-2 text-center border-r border-secondary last:border-r-0 cursor-pointer hover:bg-secondary/30",onClick:()=>Xe(t),children:[e.jsx("div",{className:"font-arcade text-xs text-zinc-400",children:z(t,"EEE").toUpperCase()}),e.jsx("div",{className:U("font-terminal text-lg mt-1 w-8 h-8 flex items-center justify-center mx-auto",he(t)&&"bg-red-500 text-white rounded-none font-bold"),children:z(t,"d")})]},t.toISOString()))]}),e.jsxs("div",{className:"grid grid-cols-8 border-b border-secondary bg-secondary/10 shrink-0",children:[e.jsx("div",{className:"p-1 w-16 border-r border-secondary text-xs font-terminal text-muted-foreground text-right pr-2",children:"ALL DAY"}),Ne.map(t=>{const n=we(t).filter(d=>d.allDay);return e.jsx("div",{className:"border-r border-secondary last:border-r-0 p-0.5 min-h-[28px]",children:n.map((d,b)=>e.jsx("div",{className:U("text-[10px] font-terminal truncate px-1.5 py-0.5 rounded cursor-pointer hover:brightness-110",Ce(d)),style:Se(d),onClick:y=>{y.stopPropagation(),Ee(d)},children:d.title},b))},`allday-${t.toISOString()}`)})]}),e.jsx(mt,{className:"flex-1",children:e.jsxs("div",{className:"grid grid-cols-8 relative",style:{height:`${24*xe}px`},children:[e.jsx("div",{className:"w-16 border-r border-secondary",children:ct.map(t=>e.jsx("div",{className:"border-b border-secondary/50 text-right pr-2 font-terminal text-[11px] text-muted-foreground",style:{height:`${xe}px`},children:t===0?"12 AM":t<12?`${t} AM`:t===12?"12 PM":`${t-12} PM`},t))}),Ne.map(t=>{const n=ge(pe(t,0),0),d=we(t).filter(y=>!y.allDay),b=Ut(d);return e.jsxs("div",{className:"relative border-r border-secondary/50 last:border-r-0",children:[ct.map(y=>e.jsx("div",{className:"border-b border-secondary/30 cursor-pointer hover:bg-secondary/20",style:{height:`${xe}px`},onClick:()=>ze(t,y)},y)),d.map((y,S)=>{const _=b.get(y.id)||{column:0,totalColumns:1},V={...Pt(y,n,_.column,_.totalColumns),...Se(y)};return e.jsxs("div",{className:U("absolute rounded p-1 cursor-pointer overflow-hidden",Ce(y)),style:V,onClick:Ie=>{Ie.stopPropagation(),Ee(y)},children:[e.jsx("div",{className:"text-xs font-terminal font-medium truncate",children:y.title}),e.jsx("div",{className:"text-[10px] opacity-80 font-terminal",children:z(y.start,"h:mma")})]},S)})]},t.toISOString())})]})})]}),l==="day"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-secondary bg-secondary/20 shrink-0 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs text-zinc-400",children:z(r,"EEEE").toUpperCase()}),e.jsx("div",{className:U("font-terminal text-2xl font-bold",he(r)&&"text-red-500"),children:z(r,"d")})]}),e.jsxs(M,{size:"sm",className:"rounded-none font-arcade text-xs bg-red-500 text-white hover:bg-red-600",onClick:()=>ze(r),"data-testid":"button-create-event",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"})," CREATE"]})]}),(()=>{const t=we(r).filter(n=>n.allDay);return t.length===0?null:e.jsxs("div",{className:"p-3 border-b border-secondary/50 bg-black/40 shrink-0 flex gap-2 flex-wrap items-center",children:[e.jsx("span",{className:"font-terminal text-sm text-muted-foreground",children:"ALL DAY:"}),t.map((n,d)=>e.jsx("div",{className:U("text-sm font-terminal px-3 py-1 rounded cursor-pointer hover:brightness-110",Ce(n)),style:Se(n),onClick:b=>{b.stopPropagation(),Ee(n)},children:n.title},d))]})})(),e.jsx(mt,{className:"flex-1",children:e.jsxs("div",{className:"relative",style:{height:`${24*xe}px`},children:[ct.map(t=>e.jsxs("div",{className:"flex border-b border-secondary/30 cursor-pointer hover:bg-secondary/20",style:{height:`${xe}px`},onClick:()=>ze(r,t),children:[e.jsx("div",{className:"w-20 text-right pr-2 font-terminal text-xs text-muted-foreground shrink-0 pt-1",children:t===0?"12 AM":t<12?`${t} AM`:t===12?"12 PM":`${t-12} PM`}),e.jsx("div",{className:"flex-1 border-l border-secondary/50"})]},t)),(()=>{const t=we(r).filter(b=>!b.allDay),n=Ut(t),d=ge(pe(r,0),0);return e.jsx("div",{className:"absolute top-0 left-20 right-0",children:t.map((b,y)=>{const S=n.get(b.id)||{column:0,totalColumns:1},_={...Pt(b,d,S.column,S.totalColumns),...Se(b)};return e.jsxs("div",{className:U("absolute rounded p-2 cursor-pointer",Ce(b)),style:_,onClick:V=>{V.stopPropagation(),Ee(b)},children:[e.jsx("div",{className:"font-bold text-sm font-terminal truncate",children:b.title}),e.jsxs("div",{className:"text-xs font-terminal opacity-80",children:[z(b.start,"h:mm a")," - ",z(b.end,"h:mm a")]})]},y)})})})()]})})]}),l==="tasks"&&e.jsx("div",{className:"flex-1 overflow-hidden bg-black/40 p-4",children:e.jsx(Ta,{tasks:St,taskLists:kr})})]})]})})}),e.jsx(De,{open:h,onOpenChange:f,children:e.jsxs(Te,{"data-modal":"calendar-create",className:"bg-black border-2 border-primary rounded-none max-w-lg max-h-[90vh] overflow-y-auto translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(Yt,{children:[e.jsx(Re,{className:"font-arcade text-primary",children:"CREATE_EVENT"}),e.jsx(Ae,{className:"sr-only",children:"Create a new event."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"TITLE"}),e.jsx(Y,{className:"rounded-none bg-black border-secondary focus-visible:ring-primary",placeholder:"Event title...",value:m.title,onChange:t=>C({...m,title:t.target.value}),"data-testid":"input-modal-title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"START DATE"}),e.jsx(Y,{type:"date",className:"rounded-none bg-black border-secondary",value:m.date,onChange:t=>C({...m,date:t.target.value}),"data-testid":"input-modal-date"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"END DATE"}),e.jsx(Y,{type:"date",className:"rounded-none bg-black border-secondary",value:m.endDate,onChange:t=>C({...m,endDate:t.target.value}),placeholder:m.date,"data-testid":"input-modal-end-date"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{id:"allDay",checked:m.allDay,onCheckedChange:t=>C({...m,allDay:!!t})}),e.jsx(I,{htmlFor:"allDay",className:"font-terminal text-sm",children:"All day"})]}),!m.allDay&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"START TIME"}),e.jsx(Y,{type:"time",className:"rounded-none bg-black border-secondary",value:m.startTime,onChange:t=>C({...m,startTime:t.target.value}),"data-testid":"input-modal-start"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"END TIME"}),e.jsx(Y,{type:"time",className:"rounded-none bg-black border-secondary",value:m.endTime,onChange:t=>C({...m,endTime:t.target.value}),"data-testid":"input-modal-end"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"TYPE"}),e.jsxs(Z,{value:m.eventType,onValueChange:t=>C({...m,eventType:t}),children:[e.jsx(B,{className:"rounded-none bg-black border-secondary","data-testid":"select-event-type",children:e.jsx(W,{})}),e.jsxs(J,{className:"rounded-none bg-black border-primary z-[100010]",children:[e.jsx(N,{value:"study",children:"STUDY"}),e.jsx(N,{value:"lecture",children:"LECTURE"}),e.jsx(N,{value:"exam",children:"EXAM"}),e.jsx(N,{value:"synchronous",children:"SYNCHRONOUS"}),e.jsx(N,{value:"online",children:"ONLINE"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"COLOR"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#6b7280"].map(t=>e.jsx("button",{type:"button",className:U("w-6 h-6 rounded-sm border-2",m.color===t?"border-white":"border-transparent"),style:{backgroundColor:t},onClick:()=>C({...m,color:t}),"data-testid":`color-${t}`},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"REPEAT"}),e.jsxs(Z,{value:m.recurrence,onValueChange:t=>C({...m,recurrence:t}),children:[e.jsx(B,{className:"rounded-none bg-black border-secondary","data-testid":"select-recurrence",children:e.jsx(W,{placeholder:"No repeat"})}),e.jsxs(J,{className:"rounded-none bg-black border-primary z-[100010]",children:[e.jsx(N,{value:"none",children:"NO REPEAT"}),e.jsx(N,{value:"daily",children:"DAILY"}),e.jsx(N,{value:"weekly",children:"WEEKLY"}),e.jsx(N,{value:"monthly",children:"MONTHLY"}),e.jsx(N,{value:"yearly",children:"YEARLY"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"font-arcade text-sm",children:"CALENDAR"}),e.jsxs(Z,{value:m.calendarId,onValueChange:t=>C({...m,calendarId:t}),children:[e.jsx(B,{className:"rounded-none bg-black border-secondary","data-testid":"select-calendar",children:e.jsx(W,{placeholder:"Local"})}),e.jsxs(J,{className:"rounded-none bg-black border-primary z-[100010]",children:[e.jsx(N,{value:"local",children:"LOCAL"}),X.map(t=>e.jsx(N,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:t.color}}),t.name]})},t.id))]})]})]})]})]}),e.jsxs(ut,{children:[e.jsx(M,{variant:"ghost",className:"rounded-none font-arcade text-xs",onClick:()=>f(!1),children:"CANCEL"}),e.jsx(M,{className:"rounded-none font-arcade text-xs bg-primary text-black hover:bg-primary/90",onClick:Qr,disabled:!m.title||!m.date,"data-testid":"button-save-event",children:"SAVE"})]})]})}),c&&e.jsx(ka,{open:j,onOpenChange:t=>{v(t),t||w(null)},event:c,onEventChange:w,courseOptions:Rt,onSave:()=>{c&&Or.mutate({id:c.id,data:{title:c.title,date:c.date,endDate:c.endDate,allDay:c.allDay,eventType:c.eventType,courseId:c.courseId??null,course:c.course,weight:c.weight,notes:c.notes,color:c.color,recurrence:c.recurrence,location:c.location,attendees:c.attendees,visibility:c.visibility,transparency:c.transparency,reminders:c.reminders,timeZone:c.timeZone}})},onDelete:()=>{c&&_r.mutate(c.id)}}),E&&e.jsx(Ca,{open:i,onOpenChange:t=>{A(t),t||(G(null),H("series"))},event:E,onEventChange:G,courseOptions:Rt,onSave:$r,onDeleteInstance:Ur,onDeleteSeries:Yr,onEditSeries:Kr,mode:P}),e.jsx(wa,{isOpen:je,onClose:()=>u(!1)})]})}export{Xa as default};
