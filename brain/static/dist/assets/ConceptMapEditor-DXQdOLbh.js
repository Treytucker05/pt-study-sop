import{c as Vs,Q as kt,n as Ws,k as qe,r as _,j as h,T as $F,l as zF,U as UF,W as qF,Y as HF,Z as GF,$ as KF,a0 as VF,a1 as k0,o as xd,R as bd,f as wd,p as Cd,q as hb,e as lc,d as Un,P as Tn,A as pb,g as Mo,s as yA,D as SA,C as vA,t as xA,m as _d,a2 as WF,h as YF,a as bA,b as is,a3 as XF,a4 as ZF}from"./index-SmUd9Xtp.js";import{R as QF,P as JF,O as eB,C as tB,U as nB,V as rB,x as Ua,J as wA,M as CA,K as _A,N as IA,r as PA,Q as EA,a as kA,I as sB,B as bt,s as TA,t as iB,n as oB}from"./layout-Dz-pdy62.js";import{e as MA}from"./select-HWKqjDio.js";import{c as AA,R as aB,I as cB}from"./tabs-CekOw624.js";import{u as lB}from"./index-V4XiYPsw.js";import{D as jA,t as dB,M as uB,a as hB}from"./brain-BymC1TyA.js";import{c as pB,i as T0,a as M0,b as fB,d as A0,s as Id,p as RA,z as OA,e as gB,f as DA,g as ah,t as mB}from"./zoom-DwwqPMg_.js";import{d as yB,e as SB}from"./colors-BDuz-soV.js";import{P as LA}from"./plus-B123wIM7.js";import{A as vB}from"./triangle-alert-DTuoMuIk.js";import{F as xB}from"./file-text-CUZXiHzB.js";import"./refresh-cw-CZQOz89i.js";import"./index-DsgSQ3Wt.js";import"./search-DQrLZvu7.js";import"./message-square-Cyi2oMz6.js";import"./loader-circle-BzPCSG1q.js";import"./send-BXJA-L5u.js";import"./badge-CFEgvhmN.js";import"./checkbox-CAxDv4hw.js";import"./external-link-DNQt_DCk.js";import"./star-B53nJjwL.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bB=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],wB=Vs("arrow-left-right",bB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],_B=Vs("arrow-up-down",CB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IB=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]],PB=Vs("file-input",IB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m8 11 4 4 4-4",key:"1dohi6"}],["path",{d:"M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4",key:"1ywtjm"}]],NA=Vs("import",EB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kB=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],TB=Vs("layout-grid",kB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],AB=Vs("palette",MB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],RB=Vs("redo-2",jB);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],DB=Vs("undo-2",OB);var j0={},ea,R0;function rn(){if(R0)return ea;R0=1;var t=function(e){return e&&e.Math===Math&&e};return ea=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof kt=="object"&&kt)||t(typeof ea=="object"&&ea)||(function(){return this})()||Function("return this")(),ea}var ch={},lh,O0;function sn(){return O0||(O0=1,lh=function(t){try{return!!t()}catch{return!0}}),lh}var dh,D0;function hs(){if(D0)return dh;D0=1;var t=sn();return dh=!t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),dh}var uh,L0;function Pd(){if(L0)return uh;L0=1;var t=sn();return uh=!t(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),uh}var hh,N0;function ps(){if(N0)return hh;N0=1;var t=Pd(),e=Function.prototype.call;return hh=t?e.bind(e):function(){return e.apply(e,arguments)},hh}var ph={},F0;function LB(){if(F0)return ph;F0=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return ph.f=n?function(s){var i=e(this,s);return!!i&&i.enumerable}:t,ph}var fh,B0;function fb(){return B0||(B0=1,fh=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}),fh}var gh,$0;function Rt(){if($0)return gh;$0=1;var t=Pd(),e=Function.prototype,n=e.call,r=t&&e.bind.bind(n,n);return gh=t?r:function(s){return function(){return n.apply(s,arguments)}},gh}var mh,z0;function Ao(){if(z0)return mh;z0=1;var t=Rt(),e=t({}.toString),n=t("".slice);return mh=function(r){return n(e(r),8,-1)},mh}var yh,U0;function NB(){if(U0)return yh;U0=1;var t=Rt(),e=sn(),n=Ao(),r=Object,s=t("".split);return yh=e(function(){return!r("z").propertyIsEnumerable(0)})?function(i){return n(i)==="String"?s(i,""):r(i)}:r,yh}var Sh,q0;function FA(){return q0||(q0=1,Sh=function(t){return t==null}),Sh}var vh,H0;function jo(){if(H0)return vh;H0=1;var t=FA(),e=TypeError;return vh=function(n){if(t(n))throw new e("Can't call method on "+n);return n},vh}var xh,G0;function Ed(){if(G0)return xh;G0=1;var t=NB(),e=jo();return xh=function(n){return t(e(n))},xh}var bh,K0;function dn(){if(K0)return bh;K0=1;var t=typeof document=="object"&&document.all;return bh=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"},bh}var wh,V0;function fs(){if(V0)return wh;V0=1;var t=dn();return wh=function(e){return typeof e=="object"?e!==null:t(e)},wh}var Ch,W0;function kd(){if(W0)return Ch;W0=1;var t=rn(),e=dn(),n=function(r){return e(r)?r:void 0};return Ch=function(r,s){return arguments.length<2?n(t[r]):t[r]&&t[r][s]},Ch}var _h,Y0;function BA(){if(Y0)return _h;Y0=1;var t=Rt();return _h=t({}.isPrototypeOf),_h}var Ih,X0;function FB(){if(X0)return Ih;X0=1;var t=rn(),e=t.navigator,n=e&&e.userAgent;return Ih=n?String(n):"",Ih}var Ph,Z0;function BB(){if(Z0)return Ph;Z0=1;var t=rn(),e=FB(),n=t.process,r=t.Deno,s=n&&n.versions||r&&r.version,i=s&&s.v8,o,a;return i&&(o=i.split("."),a=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&e&&(o=e.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=e.match(/Chrome\/(\d+)/),o&&(a=+o[1]))),Ph=a,Ph}var Eh,Q0;function $A(){if(Q0)return Eh;Q0=1;var t=BB(),e=sn(),n=rn(),r=n.String;return Eh=!!Object.getOwnPropertySymbols&&!e(function(){var s=Symbol("symbol detection");return!r(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&t&&t<41}),Eh}var kh,J0;function zA(){if(J0)return kh;J0=1;var t=$A();return kh=t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",kh}var Th,e1;function UA(){if(e1)return Th;e1=1;var t=kd(),e=dn(),n=BA(),r=zA(),s=Object;return Th=r?function(i){return typeof i=="symbol"}:function(i){var o=t("Symbol");return e(o)&&n(o.prototype,s(i))},Th}var Mh,t1;function $B(){if(t1)return Mh;t1=1;var t=String;return Mh=function(e){try{return t(e)}catch{return"Object"}},Mh}var Ah,n1;function gb(){if(n1)return Ah;n1=1;var t=dn(),e=$B(),n=TypeError;return Ah=function(r){if(t(r))return r;throw new n(e(r)+" is not a function")},Ah}var jh,r1;function mb(){if(r1)return jh;r1=1;var t=gb(),e=FA();return jh=function(n,r){var s=n[r];return e(s)?void 0:t(s)},jh}var Rh,s1;function zB(){if(s1)return Rh;s1=1;var t=ps(),e=dn(),n=fs(),r=TypeError;return Rh=function(s,i){var o,a;if(i==="string"&&e(o=s.toString)&&!n(a=t(o,s))||e(o=s.valueOf)&&!n(a=t(o,s))||i!=="string"&&e(o=s.toString)&&!n(a=t(o,s)))return a;throw new r("Can't convert object to primitive value")},Rh}var Oh={exports:{}},Dh,i1;function qA(){return i1||(i1=1,Dh=!1),Dh}var Lh,o1;function yb(){if(o1)return Lh;o1=1;var t=rn(),e=Object.defineProperty;return Lh=function(n,r){try{e(t,n,{value:r,configurable:!0,writable:!0})}catch{t[n]=r}return r},Lh}var a1;function Sb(){if(a1)return Oh.exports;a1=1;var t=qA(),e=rn(),n=yb(),r="__core-js_shared__",s=Oh.exports=e[r]||n(r,{});return(s.versions||(s.versions=[])).push({version:"3.48.0",mode:t?"pure":"global",copyright:"© 2013–2025 Denis Pushkarev (zloirock.ru), 2025–2026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"}),Oh.exports}var Nh,c1;function vb(){if(c1)return Nh;c1=1;var t=Sb();return Nh=function(e,n){return t[e]||(t[e]=n||{})},Nh}var Fh,l1;function dc(){if(l1)return Fh;l1=1;var t=jo(),e=Object;return Fh=function(n){return e(t(n))},Fh}var Bh,d1;function Ys(){if(d1)return Bh;d1=1;var t=Rt(),e=dc(),n=t({}.hasOwnProperty);return Bh=Object.hasOwn||function(s,i){return n(e(s),i)},Bh}var $h,u1;function HA(){if(u1)return $h;u1=1;var t=Rt(),e=0,n=Math.random(),r=t(1.1.toString);return $h=function(s){return"Symbol("+(s===void 0?"":s)+")_"+r(++e+n,36)},$h}var zh,h1;function gs(){if(h1)return zh;h1=1;var t=rn(),e=vb(),n=Ys(),r=HA(),s=$A(),i=zA(),o=t.Symbol,a=e("wks"),c=i?o.for||o:o&&o.withoutSetter||r;return zh=function(l){return n(a,l)||(a[l]=s&&n(o,l)?o[l]:c("Symbol."+l)),a[l]},zh}var Uh,p1;function UB(){if(p1)return Uh;p1=1;var t=ps(),e=fs(),n=UA(),r=mb(),s=zB(),i=gs(),o=TypeError,a=i("toPrimitive");return Uh=function(c,l){if(!e(c)||n(c))return c;var d=r(c,a),u;if(d){if(l===void 0&&(l="default"),u=t(d,c,l),!e(u)||n(u))return u;throw new o("Can't convert object to primitive value")}return l===void 0&&(l="number"),s(c,l)},Uh}var qh,f1;function GA(){if(f1)return qh;f1=1;var t=UB(),e=UA();return qh=function(n){var r=t(n,"string");return e(r)?r:r+""},qh}var Hh,g1;function KA(){if(g1)return Hh;g1=1;var t=rn(),e=fs(),n=t.document,r=e(n)&&e(n.createElement);return Hh=function(s){return r?n.createElement(s):{}},Hh}var Gh,m1;function VA(){if(m1)return Gh;m1=1;var t=hs(),e=sn(),n=KA();return Gh=!t&&!e(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7}),Gh}var y1;function WA(){if(y1)return ch;y1=1;var t=hs(),e=ps(),n=LB(),r=fb(),s=Ed(),i=GA(),o=Ys(),a=VA(),c=Object.getOwnPropertyDescriptor;return ch.f=t?c:function(d,u){if(d=s(d),u=i(u),a)try{return c(d,u)}catch{}if(o(d,u))return r(!e(n.f,d,u),d[u])},ch}var Kh={},Vh,S1;function YA(){if(S1)return Vh;S1=1;var t=hs(),e=sn();return Vh=t&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Vh}var Wh,v1;function ji(){if(v1)return Wh;v1=1;var t=fs(),e=String,n=TypeError;return Wh=function(r){if(t(r))return r;throw new n(e(r)+" is not an object")},Wh}var x1;function Ro(){if(x1)return Kh;x1=1;var t=hs(),e=VA(),n=YA(),r=ji(),s=GA(),i=TypeError,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,c="enumerable",l="configurable",d="writable";return Kh.f=t?n?function(p,f,m){if(r(p),f=s(f),r(m),typeof p=="function"&&f==="prototype"&&"value"in m&&d in m&&!m[d]){var y=a(p,f);y&&y[d]&&(p[f]=m.value,m={configurable:l in m?m[l]:y[l],enumerable:c in m?m[c]:y[c],writable:!1})}return o(p,f,m)}:o:function(p,f,m){if(r(p),f=s(f),r(m),e)try{return o(p,f,m)}catch{}if("get"in m||"set"in m)throw new i("Accessors not supported");return"value"in m&&(p[f]=m.value),p},Kh}var Yh,b1;function xb(){if(b1)return Yh;b1=1;var t=hs(),e=Ro(),n=fb();return Yh=t?function(r,s,i){return e.f(r,s,n(1,i))}:function(r,s,i){return r[s]=i,r},Yh}var Xh={exports:{}},Zh,w1;function qB(){if(w1)return Zh;w1=1;var t=hs(),e=Ys(),n=Function.prototype,r=t&&Object.getOwnPropertyDescriptor,s=e(n,"name"),i=s&&(function(){}).name==="something",o=s&&(!t||t&&r(n,"name").configurable);return Zh={EXISTS:s,PROPER:i,CONFIGURABLE:o},Zh}var Qh,C1;function XA(){if(C1)return Qh;C1=1;var t=Rt(),e=dn(),n=Sb(),r=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(s){return r(s)}),Qh=n.inspectSource,Qh}var Jh,_1;function HB(){if(_1)return Jh;_1=1;var t=rn(),e=dn(),n=t.WeakMap;return Jh=e(n)&&/native code/.test(String(n)),Jh}var ep,I1;function ZA(){if(I1)return ep;I1=1;var t=vb(),e=HA(),n=t("keys");return ep=function(r){return n[r]||(n[r]=e(r))},ep}var tp,P1;function bb(){return P1||(P1=1,tp={}),tp}var np,E1;function QA(){if(E1)return np;E1=1;var t=HB(),e=rn(),n=fs(),r=xb(),s=Ys(),i=Sb(),o=ZA(),a=bb(),c="Object already initialized",l=e.TypeError,d=e.WeakMap,u,p,f,m=function(v){return f(v)?p(v):u(v,{})},y=function(v){return function(x){var b;if(!n(x)||(b=p(x)).type!==v)throw new l("Incompatible receiver, "+v+" required");return b}};if(t||i.state){var S=i.state||(i.state=new d);S.get=S.get,S.has=S.has,S.set=S.set,u=function(v,x){if(S.has(v))throw new l(c);return x.facade=v,S.set(v,x),x},p=function(v){return S.get(v)||{}},f=function(v){return S.has(v)}}else{var g=o("state");a[g]=!0,u=function(v,x){if(s(v,g))throw new l(c);return x.facade=v,r(v,g,x),x},p=function(v){return s(v,g)?v[g]:{}},f=function(v){return s(v,g)}}return np={set:u,get:p,has:f,enforce:m,getterFor:y},np}var k1;function GB(){if(k1)return Xh.exports;k1=1;var t=Rt(),e=sn(),n=dn(),r=Ys(),s=hs(),i=qB().CONFIGURABLE,o=XA(),a=QA(),c=a.enforce,l=a.get,d=String,u=Object.defineProperty,p=t("".slice),f=t("".replace),m=t([].join),y=s&&!e(function(){return u(function(){},"length",{value:8}).length!==8}),S=String(String).split("String"),g=Xh.exports=function(v,x,b){p(d(x),0,7)==="Symbol("&&(x="["+f(d(x),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),b&&b.getter&&(x="get "+x),b&&b.setter&&(x="set "+x),(!r(v,"name")||i&&v.name!==x)&&(s?u(v,"name",{value:x,configurable:!0}):v.name=x),y&&b&&r(b,"arity")&&v.length!==b.arity&&u(v,"length",{value:b.arity});try{b&&r(b,"constructor")&&b.constructor?s&&u(v,"prototype",{writable:!1}):v.prototype&&(v.prototype=void 0)}catch{}var E=c(v);return r(E,"source")||(E.source=m(S,typeof x=="string"?x:"")),v};return Function.prototype.toString=g(function(){return n(this)&&l(this).source||o(this)},"toString"),Xh.exports}var rp,T1;function JA(){if(T1)return rp;T1=1;var t=dn(),e=Ro(),n=GB(),r=yb();return rp=function(s,i,o,a){a||(a={});var c=a.enumerable,l=a.name!==void 0?a.name:i;if(t(o)&&n(o,l,a),a.global)c?s[i]=o:r(i,o);else{try{a.unsafe?s[i]&&(c=!0):delete s[i]}catch{}c?s[i]=o:e.f(s,i,{value:o,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return s},rp}var sp={},ip,M1;function KB(){if(M1)return ip;M1=1;var t=Math.ceil,e=Math.floor;return ip=Math.trunc||function(r){var s=+r;return(s>0?e:t)(s)},ip}var op,A1;function Ri(){if(A1)return op;A1=1;var t=KB();return op=function(e){var n=+e;return n!==n||n===0?0:t(n)},op}var ap,j1;function VB(){if(j1)return ap;j1=1;var t=Ri(),e=Math.max,n=Math.min;return ap=function(r,s){var i=t(r);return i<0?e(i+s,0):n(i,s)},ap}var cp,R1;function ej(){if(R1)return cp;R1=1;var t=Ri(),e=Math.min;return cp=function(n){var r=t(n);return r>0?e(r,9007199254740991):0},cp}var lp,O1;function uc(){if(O1)return lp;O1=1;var t=ej();return lp=function(e){return t(e.length)},lp}var dp,D1;function WB(){if(D1)return dp;D1=1;var t=Ed(),e=VB(),n=uc(),r=function(s){return function(i,o,a){var c=t(i),l=n(c);if(l===0)return!s&&-1;var d=e(a,l),u;if(s&&o!==o){for(;l>d;)if(u=c[d++],u!==u)return!0}else for(;l>d;d++)if((s||d in c)&&c[d]===o)return s||d||0;return!s&&-1}};return dp={includes:r(!0),indexOf:r(!1)},dp}var up,L1;function tj(){if(L1)return up;L1=1;var t=Rt(),e=Ys(),n=Ed(),r=WB().indexOf,s=bb(),i=t([].push);return up=function(o,a){var c=n(o),l=0,d=[],u;for(u in c)!e(s,u)&&e(c,u)&&i(d,u);for(;a.length>l;)e(c,u=a[l++])&&(~r(d,u)||i(d,u));return d},up}var hp,N1;function wb(){return N1||(N1=1,hp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),hp}var F1;function YB(){if(F1)return sp;F1=1;var t=tj(),e=wb(),n=e.concat("length","prototype");return sp.f=Object.getOwnPropertyNames||function(s){return t(s,n)},sp}var pp={},B1;function XB(){return B1||(B1=1,pp.f=Object.getOwnPropertySymbols),pp}var fp,$1;function ZB(){if($1)return fp;$1=1;var t=kd(),e=Rt(),n=YB(),r=XB(),s=ji(),i=e([].concat);return fp=t("Reflect","ownKeys")||function(a){var c=n.f(s(a)),l=r.f;return l?i(c,l(a)):c},fp}var gp,z1;function QB(){if(z1)return gp;z1=1;var t=Ys(),e=ZB(),n=WA(),r=Ro();return gp=function(s,i,o){for(var a=e(i),c=r.f,l=n.f,d=0;d<a.length;d++){var u=a[d];!t(s,u)&&!(o&&t(o,u))&&c(s,u,l(i,u))}},gp}var mp,U1;function JB(){if(U1)return mp;U1=1;var t=sn(),e=dn(),n=/#|\.prototype\./,r=function(c,l){var d=i[s(c)];return d===a?!0:d===o?!1:e(l)?t(l):!!l},s=r.normalize=function(c){return String(c).replace(n,".").toLowerCase()},i=r.data={},o=r.NATIVE="N",a=r.POLYFILL="P";return mp=r,mp}var yp,q1;function Oo(){if(q1)return yp;q1=1;var t=rn(),e=WA().f,n=xb(),r=JA(),s=yb(),i=QB(),o=JB();return yp=function(a,c){var l=a.target,d=a.global,u=a.stat,p,f,m,y,S,g;if(d?f=t:u?f=t[l]||s(l,{}):f=t[l]&&t[l].prototype,f)for(m in c){if(S=c[m],a.dontCallGetSet?(g=e(f,m),y=g&&g.value):y=f[m],p=o(d?m:l+(u?".":"#")+m,a.forced),!p&&y!==void 0){if(typeof S==typeof y)continue;i(S,y)}(a.sham||y&&y.sham)&&n(S,"sham",!0),r(f,m,S,a)}},yp}var Sp={},vp,H1;function e$(){if(H1)return vp;H1=1;var t=tj(),e=wb();return vp=Object.keys||function(r){return t(r,e)},vp}var G1;function t$(){if(G1)return Sp;G1=1;var t=hs(),e=YA(),n=Ro(),r=ji(),s=Ed(),i=e$();return Sp.f=t&&!e?Object.defineProperties:function(a,c){r(a);for(var l=s(c),d=i(c),u=d.length,p=0,f;u>p;)n.f(a,f=d[p++],l[f]);return a},Sp}var xp,K1;function n$(){if(K1)return xp;K1=1;var t=kd();return xp=t("document","documentElement"),xp}var bp,V1;function nj(){if(V1)return bp;V1=1;var t=ji(),e=t$(),n=wb(),r=bb(),s=n$(),i=KA(),o=ZA(),a=">",c="<",l="prototype",d="script",u=o("IE_PROTO"),p=function(){},f=function(v){return c+d+a+v+c+"/"+d+a},m=function(v){v.write(f("")),v.close();var x=v.parentWindow.Object;return v=null,x},y=function(){var v=i("iframe"),x="java"+d+":",b;return v.style.display="none",s.appendChild(v),v.src=String(x),b=v.contentWindow.document,b.open(),b.write(f("document.F=Object")),b.close(),b.F},S,g=function(){try{S=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&S?m(S):y():m(S);for(var v=n.length;v--;)delete g[l][n[v]];return g()};return r[u]=!0,bp=Object.create||function(x,b){var E;return x!==null?(p[l]=t(x),E=new p,p[l]=null,E[u]=x):E=g(),b===void 0?E:e.f(E,b)},bp}var wp,W1;function Cb(){if(W1)return wp;W1=1;var t=gs(),e=nj(),n=Ro().f,r=t("unscopables"),s=Array.prototype;return s[r]===void 0&&n(s,r,{configurable:!0,value:e(null)}),wp=function(i){s[r][i]=!0},wp}var Y1;function r$(){if(Y1)return j0;Y1=1;var t=Oo(),e=dc(),n=uc(),r=Ri(),s=Cb();return t({target:"Array",proto:!0},{at:function(o){var a=e(this),c=n(a),l=r(o),d=l>=0?l:c+l;return d<0||d>=c?void 0:a[d]}}),s("at"),j0}var Cp,X1;function hc(){if(X1)return Cp;X1=1;var t=rn(),e=Rt();return Cp=function(n,r){return e(t[n].prototype[r])},Cp}var _p,Z1;function s$(){if(Z1)return _p;Z1=1,r$();var t=hc();return _p=t("Array","at"),_p}var Ip,Q1;function i$(){if(Q1)return Ip;Q1=1;var t=s$();return Ip=t,Ip}i$();var J1={},Pp,eC;function rj(){if(eC)return Pp;eC=1;var t=Ao();return Pp=Array.isArray||function(n){return t(n)==="Array"},Pp}var Ep,tC;function o$(){if(tC)return Ep;tC=1;var t=TypeError,e=9007199254740991;return Ep=function(n){if(n>e)throw t("Maximum allowed index exceeded");return n},Ep}var kp,nC;function a$(){if(nC)return kp;nC=1;var t=Ao(),e=Rt();return kp=function(n){if(t(n)==="Function")return e(n)},kp}var Tp,rC;function c$(){if(rC)return Tp;rC=1;var t=a$(),e=gb(),n=Pd(),r=t(t.bind);return Tp=function(s,i){return e(s),i===void 0?s:n?r(s,i):function(){return s.apply(i,arguments)}},Tp}var Mp,sC;function l$(){if(sC)return Mp;sC=1;var t=hs(),e=Ro(),n=fb();return Mp=function(r,s,i){t?e.f(r,s,n(0,i)):r[s]=i},Mp}var Ap,iC;function sj(){if(iC)return Ap;iC=1;var t=rj(),e=uc(),n=o$(),r=c$(),s=l$(),i=function(o,a,c,l,d,u,p,f){for(var m=d,y=0,S=p?r(p,f):!1,g,v;y<l;)y in c&&(g=S?S(c[y],y,a):c[y],u>0&&t(g)?(v=e(g),m=i(o,a,g,v,m,u-1)-1):(n(m+1),s(o,m,g)),m++),y++;return m};return Ap=i,Ap}var jp,oC;function d$(){if(oC)return jp;oC=1;var t=gs(),e=t("toStringTag"),n={};return n[e]="z",jp=String(n)==="[object z]",jp}var Rp,aC;function ij(){if(aC)return Rp;aC=1;var t=d$(),e=dn(),n=Ao(),r=gs(),s=r("toStringTag"),i=Object,o=n((function(){return arguments})())==="Arguments",a=function(c,l){try{return c[l]}catch{}};return Rp=t?n:function(c){var l,d,u;return c===void 0?"Undefined":c===null?"Null":typeof(d=a(l=i(c),s))=="string"?d:o?n(l):(u=n(l))==="Object"&&e(l.callee)?"Arguments":u},Rp}var Op,cC;function u$(){if(cC)return Op;cC=1;var t=Rt(),e=sn(),n=dn(),r=ij(),s=kd(),i=XA(),o=function(){},a=s("Reflect","construct"),c=/^\s*(?:class|function)\b/,l=t(c.exec),d=!c.test(o),u=function(m){if(!n(m))return!1;try{return a(o,[],m),!0}catch{return!1}},p=function(m){if(!n(m))return!1;switch(r(m)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!l(c,i(m))}catch{return!0}};return p.sham=!0,Op=!a||e(function(){var f;return u(u.call)||!u(Object)||!u(function(){f=!0})||f})?p:u,Op}var Dp,lC;function h$(){if(lC)return Dp;lC=1;var t=rj(),e=u$(),n=fs(),r=gs(),s=r("species"),i=Array;return Dp=function(o){var a;return t(o)&&(a=o.constructor,e(a)&&(a===i||t(a.prototype))?a=void 0:n(a)&&(a=a[s],a===null&&(a=void 0))),a===void 0?i:a},Dp}var Lp,dC;function oj(){if(dC)return Lp;dC=1;var t=h$();return Lp=function(e,n){return new(t(e))(n===0?0:n)},Lp}var uC;function p$(){if(uC)return J1;uC=1;var t=Oo(),e=sj(),n=gb(),r=dc(),s=uc(),i=oj();return t({target:"Array",proto:!0},{flatMap:function(a){var c=r(this),l=s(c),d;return n(a),d=i(c,0),e(d,c,c,l,0,1,a,arguments.length>1?arguments[1]:void 0),d}}),J1}var hC={},pC;function f$(){if(pC)return hC;pC=1;var t=Cb();return t("flatMap"),hC}var Np,fC;function g$(){if(fC)return Np;fC=1,p$(),f$();var t=hc();return Np=t("Array","flatMap"),Np}var Fp,gC;function m$(){if(gC)return Fp;gC=1;var t=g$();return Fp=t,Fp}m$();var mC={},yC;function y$(){if(yC)return mC;yC=1;var t=Oo(),e=sj(),n=dc(),r=uc(),s=Ri(),i=oj();return t({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,c=n(this),l=r(c),d=i(c,0);return e(d,c,c,l,0,a===void 0?1:s(a)),d}}),mC}var SC={},vC;function S$(){if(vC)return SC;vC=1;var t=Cb();return t("flat"),SC}var Bp,xC;function v$(){if(xC)return Bp;xC=1,y$(),S$();var t=hc();return Bp=t("Array","flat"),Bp}var $p,bC;function x$(){if(bC)return $p;bC=1;var t=v$();return $p=t,$p}x$();var wC={},zp,CC;function pc(){if(CC)return zp;CC=1;var t=ij(),e=String;return zp=function(n){if(t(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(n)},zp}var _C;function b$(){if(_C)return wC;_C=1;var t=Oo(),e=Rt(),n=jo(),r=Ri(),s=pc(),i=sn(),o=e("".charAt),a=i(function(){return"𠮷".at(-2)!=="\uD842"});return t({target:"String",proto:!0,forced:a},{at:function(l){var d=s(n(this)),u=d.length,p=r(l),f=p>=0?p:u+p;return f<0||f>=u?void 0:o(d,f)}}),wC}var Up,IC;function w$(){if(IC)return Up;IC=1,b$();var t=hc();return Up=t("String","at"),Up}var qp,PC;function C$(){if(PC)return qp;PC=1;var t=w$();return qp=t,qp}C$();var EC={},Hp,kC;function aj(){if(kC)return Hp;kC=1;var t=ji();return Hp=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},Hp}var Gp,TC;function _$(){if(TC)return Gp;TC=1;var t=sn(),e=rn(),n=e.RegExp,r=t(function(){var o=n("a","y");return o.lastIndex=2,o.exec("abcd")!==null}),s=r||t(function(){return!n("a","y").sticky}),i=r||t(function(){var o=n("^r","gy");return o.lastIndex=2,o.exec("str")!==null});return Gp={BROKEN_CARET:i,MISSED_STICKY:s,UNSUPPORTED_Y:r},Gp}var Kp,MC;function I$(){if(MC)return Kp;MC=1;var t=sn(),e=rn(),n=e.RegExp;return Kp=t(function(){var r=n(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),Kp}var Vp,AC;function P$(){if(AC)return Vp;AC=1;var t=sn(),e=rn(),n=e.RegExp;return Vp=t(function(){var r=n("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),Vp}var Wp,jC;function _b(){if(jC)return Wp;jC=1;var t=ps(),e=Rt(),n=pc(),r=aj(),s=_$(),i=vb(),o=nj(),a=QA().get,c=I$(),l=P$(),d=i("native-string-replace",String.prototype.replace),u=RegExp.prototype.exec,p=u,f=e("".charAt),m=e("".indexOf),y=e("".replace),S=e("".slice),g=(function(){var E=/a/,I=/b*/g;return t(u,E,"a"),t(u,I,"a"),E.lastIndex!==0||I.lastIndex!==0})(),v=s.BROKEN_CARET,x=/()??/.exec("")[1]!==void 0,b=g||x||v||c||l;return b&&(p=function(I){var C=this,P=a(C),k=n(I),T=P.raw,M,A,j,R,L,F,H;if(T)return T.lastIndex=C.lastIndex,M=t(p,T,k),C.lastIndex=T.lastIndex,M;var B=P.groups,$=v&&C.sticky,Q=t(r,C),Z=C.source,ee=0,ne=k;if($&&(Q=y(Q,"y",""),m(Q,"g")===-1&&(Q+="g"),ne=S(k,C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&f(k,C.lastIndex-1)!==`
`)&&(Z="(?: "+Z+")",ne=" "+ne,ee++),A=new RegExp("^(?:"+Z+")",Q)),x&&(A=new RegExp("^"+Z+"$(?!\\s)",Q)),g&&(j=C.lastIndex),R=t(u,$?A:C,ne),$?R?(R.input=S(R.input,ee),R[0]=S(R[0],ee),R.index=C.lastIndex,C.lastIndex+=R[0].length):C.lastIndex=0:g&&R&&(C.lastIndex=C.global?R.index+R[0].length:j),x&&R&&R.length>1&&t(d,R[0],A,function(){for(L=1;L<arguments.length-2;L++)arguments[L]===void 0&&(R[L]=void 0)}),R&&B)for(R.groups=F=o(null),L=0;L<B.length;L++)H=B[L],F[H[0]]=R[H[1]];return R}),Wp=p,Wp}var RC;function cj(){if(RC)return EC;RC=1;var t=Oo(),e=_b();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),EC}var OC={},Yp,DC;function E$(){if(DC)return Yp;DC=1;var t=Pd(),e=Function.prototype,n=e.apply,r=e.call;return Yp=typeof Reflect=="object"&&Reflect.apply||(t?r.bind(n):function(){return r.apply(n,arguments)}),Yp}var Xp,LC;function k$(){if(LC)return Xp;LC=1,cj();var t=ps(),e=JA(),n=_b(),r=sn(),s=gs(),i=xb(),o=s("species"),a=RegExp.prototype;return Xp=function(c,l,d,u){var p=s(c),f=!r(function(){var g={};return g[p]=function(){return 7},""[c](g)!==7}),m=f&&!r(function(){var g=!1,v=/a/;if(c==="split"){var x={};x[o]=function(){return v},v={constructor:x,flags:""},v[p]=/./[p]}return v.exec=function(){return g=!0,null},v[p](""),!g});if(!f||!m||d){var y=/./[p],S=l(p,""[c],function(g,v,x,b,E){var I=v.exec;return I===n||I===a.exec?f&&!E?{done:!0,value:t(y,v,x,b)}:{done:!0,value:t(g,x,v,b)}:{done:!1}});e(String.prototype,c,S[0]),e(a,p,S[1])}u&&i(a[p],"sham",!0)},Xp}var Zp,NC;function T$(){if(NC)return Zp;NC=1;var t=Rt(),e=Ri(),n=pc(),r=jo(),s=t("".charAt),i=t("".charCodeAt),o=t("".slice),a=function(c){return function(l,d){var u=n(r(l)),p=e(d),f=u.length,m,y;return p<0||p>=f?c?"":void 0:(m=i(u,p),m<55296||m>56319||p+1===f||(y=i(u,p+1))<56320||y>57343?c?s(u,p):m:c?o(u,p,p+2):(m-55296<<10)+(y-56320)+65536)}};return Zp={codeAt:a(!1),charAt:a(!0)},Zp}var Qp,FC;function M$(){if(FC)return Qp;FC=1;var t=T$().charAt;return Qp=function(e,n,r){return n+(r?t(e,n).length:1)},Qp}var Jp,BC;function lj(){if(BC)return Jp;BC=1;var t=Rt(),e=dc(),n=Math.floor,r=t("".charAt),s=t("".replace),i=t("".slice),o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return Jp=function(c,l,d,u,p,f){var m=d+c.length,y=u.length,S=a;return p!==void 0&&(p=e(p),S=o),s(f,S,function(g,v){var x;switch(r(v,0)){case"$":return"$";case"&":return c;case"`":return i(l,0,d);case"'":return i(l,m);case"<":x=p[i(v,1,-1)];break;default:var b=+v;if(b===0)return g;if(b>y){var E=n(b/10);return E===0?g:E<=y?u[E-1]===void 0?r(v,1):u[E-1]+r(v,1):g}x=u[b-1]}return x===void 0?"":x})},Jp}var ef,$C;function A$(){if($C)return ef;$C=1;var t=rn(),e=sn(),n=t.RegExp,r=!e(function(){var s=!0;try{n(".","d")}catch{s=!1}var i={},o="",a=s?"dgimsy":"gimsy",c=function(p,f){Object.defineProperty(i,p,{get:function(){return o+=f,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};s&&(l.hasIndices="d");for(var d in l)c(d,l[d]);var u=Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(i);return u!==a||o!==a});return ef={correct:r},ef}var tf,zC;function dj(){if(zC)return tf;zC=1;var t=ps(),e=Ys(),n=BA(),r=A$(),s=aj(),i=RegExp.prototype;return tf=r.correct?function(o){return o.flags}:function(o){return!r.correct&&n(i,o)&&!e(o,"flags")?t(s,o):o.flags},tf}var nf,UC;function j$(){if(UC)return nf;UC=1;var t=ps(),e=ji(),n=dn(),r=Ao(),s=_b(),i=TypeError;return nf=function(o,a){var c=o.exec;if(n(c)){var l=t(c,o,a);return l!==null&&e(l),l}if(r(o)==="RegExp")return t(s,o,a);throw new i("RegExp#exec called on incompatible receiver")},nf}var qC;function R$(){if(qC)return OC;qC=1;var t=E$(),e=ps(),n=Rt(),r=k$(),s=sn(),i=ji(),o=dn(),a=fs(),c=Ri(),l=ej(),d=pc(),u=jo(),p=M$(),f=mb(),m=lj(),y=dj(),S=j$(),g=gs(),v=g("replace"),x=Math.max,b=Math.min,E=n([].concat),I=n([].push),C=n("".indexOf),P=n("".slice),k=function(j){return j===void 0?j:String(j)},T=(function(){return"a".replace(/./,"$0")==="$0"})(),M=(function(){return/./[v]?/./[v]("a","$0")==="":!1})(),A=!s(function(){var j=/./;return j.exec=function(){var R=[];return R.groups={a:"7"},R},"".replace(j,"$<a>")!=="7"});return r("replace",function(j,R,L){var F=M?"$":"$0";return[function(B,$){var Q=u(this),Z=a(B)?f(B,v):void 0;return Z?e(Z,B,Q,$):e(R,d(Q),B,$)},function(H,B){var $=i(this),Q=d(H);if(typeof B=="string"&&C(B,F)===-1&&C(B,"$<")===-1){var Z=L(R,$,Q,B);if(Z.done)return Z.value}var ee=o(B);ee||(B=d(B));var ne=d(y($)),N=C(ne,"g")!==-1,D;N&&(D=C(ne,"u")!==-1,$.lastIndex=0);for(var q=[],U;U=S($,Q),!(U===null||(I(q,U),!N));){var V=d(U[0]);V===""&&($.lastIndex=p(Q,l($.lastIndex),D))}for(var te="",ie=0,oe=0;oe<q.length;oe++){U=q[oe];for(var ue=d(U[0]),de=x(b(c(U.index),Q.length),0),ge=[],le,xe=1;xe<U.length;xe++)I(ge,k(U[xe]));var me=U.groups;if(ee){var et=E([ue],ge,de,Q);me!==void 0&&I(et,me),le=d(t(B,void 0,et))}else le=m(ue,Q,de,ge,me,B);de>=ie&&(te+=P(Q,ie,de)+le,ie=de+ue.length)}return te+P(Q,ie)}]},!A||!T||M),OC}var HC={},rf,GC;function O$(){if(GC)return rf;GC=1;var t=fs(),e=Ao(),n=gs(),r=n("match");return rf=function(s){var i;return t(s)&&((i=s[r])!==void 0?!!i:e(s)==="RegExp")},rf}var KC;function D$(){if(KC)return HC;KC=1;var t=Oo(),e=ps(),n=Rt(),r=jo(),s=dn(),i=fs(),o=O$(),a=pc(),c=mb(),l=dj(),d=lj(),u=gs(),p=qA(),f=u("replace"),m=TypeError,y=n("".indexOf),S=n("".replace),g=n("".slice),v=Math.max;return t({target:"String",proto:!0},{replaceAll:function(b,E){var I=r(this),C,P,k,T,M,A,j,R,L,F,H=0,B="";if(i(b)){if(C=o(b),C&&(P=a(r(l(b))),!~y(P,"g")))throw new m("`.replaceAll` does not allow non-global regexes");if(k=c(b,f),k)return e(k,b,I,E);if(p&&C)return S(a(I),b,E)}for(T=a(I),M=a(b),A=s(E),A||(E=a(E)),j=M.length,R=v(1,j),L=y(T,M);L!==-1;)F=A?a(E(M,L,T)):d(M,T,L,[],void 0,E),B+=g(T,H,L)+F,H=L+j,L=L+R>T.length?-1:y(T,M,L+R);return H<T.length&&(B+=g(T,H)),B}}),HC}var sf,VC;function L$(){if(VC)return sf;VC=1,cj(),R$(),D$();var t=hc();return sf=t("String","replaceAll"),sf}var of,WC;function N$(){if(WC)return of;WC=1;var t=L$();return of=t,of}N$();function uj(t){return t&&typeof t=="object"&&"parents"in t}function hj(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(!0),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}const $l=(t,e)=>{if(t.children.remove(e)&&t.children.isEmpty&&uj(t))for(let n=0,r=t.parents.length;n<r;n++)$l(t.parents[n],t)},Ib=(t,e)=>{if(t.children.add(e)&&uj(t))for(let n=0,r=t.parents.length;n<r;n++)Ib(t.parents[n],t)};function pj(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}function Xs(t,e){const n=Symbol.for(`com.tldraw.state/${t}`),r=globalThis;return r[n]??=e(),r[n]}const os=Xs("empty_array",()=>Object.freeze([])),YC=8;class zl{arraySize=0;array=Array(YC);set=null;get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<YC?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Nn=Symbol.for("com.tldraw.state/RESET_VALUE");class fj{constructor(e){this.capacity=e,this.buffer=new Array(e)}index=0;buffer;pushEntry(e,n,r){if(r!==void 0){if(r===Nn){this.clear();return}this.buffer[this.index]=[e,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:r,buffer:s}=this;for(let i=0;i<r;i++){const o=(n-1+r-i)%r,a=s[o];if(!a)return Nn;const[c,l]=a;if(i===0&&e>=l)return[];if(c<=e&&e<l){const d=i+1,u=new Array(d);for(let p=0;p<d;p++)u[p]=s[(o+p)%r][2];return u}}return Nn}}class F${constructor(e,n){this.below=e,this.child=n}offset=0;maybeRemoved}const nt=Xs("capture",()=>({stack:null}));function Zc(t){const e=nt.stack;nt.stack=null;try{return t()}finally{nt.stack=e}}function gj(t){nt.stack=new F$(nt.stack,t),t.parentSet.clear()}function mj(){const t=nt.stack;if(nt.stack=t.below,t.offset<t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parentSet.has(n)||$l(n,t.child)}t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset}if(t.maybeRemoved)for(let e=0;e<t.maybeRemoved.length;e++){const n=t.maybeRemoved[e];t.child.parentSet.has(n)||$l(n,t.child)}}function Ul(t){if(nt.stack){if(nt.stack.child.parentSet.has(t))return;if(nt.stack.child.parentSet.add(t),nt.stack.child.isActivelyListening&&Ib(t,nt.stack.child),nt.stack.offset<nt.stack.child.parents.length){const n=nt.stack.child.parents[nt.stack.offset];n!==t&&(nt.stack.maybeRemoved?nt.stack.maybeRemoved.push(n):nt.stack.maybeRemoved=[n])}nt.stack.child.parents[nt.stack.offset]=t,nt.stack.child.parentEpochs[nt.stack.offset]=t.lastChangedEpoch,nt.stack.offset++}}const Rs=-1;class B${constructor(e,n,r){this.name=e,this.runEffect=n,this._scheduleEffect=r?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=Rs;lastReactedEpoch=Rs;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentSet=new zl;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Sn()){if(this.parents.length&&!hj(this)){this.lastReactedEpoch=Sn();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)Ib(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)$l(this.parents[e],this)}execute(){try{gj(this);const e=Sn(),n=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,n}finally{mj()}}}const Do=Xs("EffectScheduler",()=>B$);function Oi(t,e,n){const r=new Do(t,e,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function $$(t,e,n){const r=new Do(t,e,n);return{scheduler:r,start:s=>{const i=s?.force??!1;r.attach(),i?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class z${constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return this.parent===null}commit(){this.isRoot?yj(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){We.globalEpoch++,this.initialAtomValues.forEach((e,n)=>{n.set(e),n.historyBuffer?.clear()}),this.commit()}}const We=Xs("transactions",()=>({globalEpoch:Rs+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:Rs+1}));function U$(){return We.reactionEpoch}function Sn(){return We.globalEpoch}function q$(){return We.globalIsReacting}function Pb(t,e){e.lastTraversedEpoch!==We.globalEpoch&&(e.lastTraversedEpoch=We.globalEpoch,e instanceof Do?t.add(e):e.children.visit(n=>Pb(t,n)))}function yj(t){if(We.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{We.globalIsReacting=!0,We.reactionEpoch=We.globalEpoch;const e=new Set;for(const r of t)r.children.visit(s=>Pb(e,s));for(const r of e)r.maybeScheduleEffect();let n=0;for(;We.cleanupReactors?.size;){if(n++>1e3)throw new Error("Reaction update depth limit exceeded");const r=We.cleanupReactors;We.cleanupReactors=null;for(const s of r)s.maybeScheduleEffect()}}finally{We.cleanupReactors=null,We.globalIsReacting=!1}}function H$(t,e){if(We.globalIsReacting){const n=We.cleanupReactors??=new Set;t.children.visit(r=>Pb(n,r))}else We.currentTransaction?We.currentTransaction.initialAtomValues.has(t)||We.currentTransaction.initialAtomValues.set(t,e):yj([t])}function G$(){We.globalEpoch++}function K$(t){const e=new z$(We.currentTransaction);We.currentTransaction=e;try{let n,r=!1;try{n=t(()=>r=!0)}catch(s){throw e.abort(),s}return r?e.abort():e.commit(),n}finally{We.currentTransaction=We.currentTransaction.parent}}function Or(t){return We.currentTransaction?t():K$(t)}class V${constructor(e,n,r){this.name=e,this.current=n,this.isEqual=r?.isEqual??null,r&&(r.historyLength&&(this.historyBuffer=new fj(r.historyLength)),this.computeDiff=r.computeDiff)}isEqual;computeDiff;lastChangedEpoch=Sn();children=new zl;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return Ul(this),this.current}set(e,n){if(this.isEqual?.(this.current,e)??pj(this.current,e))return this.current;G$(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Sn(),n??this.computeDiff?.(this.current,e,this.lastChangedEpoch,Sn())??Nn),this.lastChangedEpoch=Sn();const r=this.current;return this.current=e,H$(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){return Ul(this),e>=this.lastChangedEpoch?os:this.historyBuffer?.getChangesSince(e)??Nn}}const W$=Xs("Atom",()=>V$);function Tt(t,e,n){return new W$(t,e,n)}let XC=!1;function Y$(){XC||(XC=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const ya=Symbol.for("com.tldraw.state/UNINITIALIZED"),mi=t=>t===ya,vx=Xs("WithDiff",()=>class{constructor(e,n){this.value=e,this.diff=n}});function Sa(t,e){return new vx(t,e)}class X${constructor(e,n,r){this.name=e,this.derive=n,r?.historyLength&&(this.historyBuffer=new fj(r.historyLength)),this.computeDiff=r?.computeDiff,this.isEqual=r?.isEqual??pj}lastChangedEpoch=Rs;lastTraversedEpoch=Rs;lastCheckedEpoch=Rs;parentSet=new zl;parents=[];parentEpochs=[];children=new zl;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=ya;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){const n=this.lastChangedEpoch===Rs,r=Sn();if(!n&&(this.lastCheckedEpoch===r||this.isActivelyListening&&q$()&&this.lastTraversedEpoch<U$()||!hj(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{gj(this);const s=this.derive(this.state,this.lastCheckedEpoch),i=s instanceof vx?s.value:s,o=this.state===ya;if(o||!this.isEqual(i,this.state)){if(this.historyBuffer&&!o){const a=s instanceof vx?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Sn(),a??this.computeDiff?.(this.state,i,this.lastCheckedEpoch,Sn())??Nn)}this.lastChangedEpoch=Sn(),this.state=i}return this.error=null,this.lastCheckedEpoch=Sn(),this.state}catch(s){if(this.state!==ya&&(this.state=ya,this.lastChangedEpoch=Sn()),this.lastCheckedEpoch=Sn(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{mj()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Ul(this)}}getDiffSince(e){return this.__unsafe__getWithoutCapture(!0),Ul(this),e>=this.lastChangedEpoch?os:this.historyBuffer?.getChangesSince(e)??Nn}}const Eb=Xs("Computed",()=>X$);function Z$(t={},e,n,r){const s=r.value,i=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let o=this[i];return o||(o=new Eb(n,s.bind(this),t),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r.value[J$]=!0,r}function ZC(t={},e,n,r){return r.get?(Y$(),Q$(t,e,n,r)):Z$(t,e,n,r)}function Q$(t={},e,n,r){const s=r.get,i=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let o=this[i];return o||(o=new Eb(n,s.bind(this),t),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r}const J$="@@__isComputedMethod__@@";function J(){if(arguments.length===1){const t=arguments[0];return(e,n,r)=>ZC(t,e,n,r)}else return typeof arguments[0]=="string"?new Eb(arguments[0],arguments[1],arguments[2]):ZC(void 0,arguments[0],arguments[1],arguments[2])}const Sj=1,ez=Xs("apiVersion",()=>Sj);if(ez!==Sj)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var af,QC;function tz(){if(QC)return af;QC=1;var t="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof kt=="object"&&kt&&kt.Object===Object&&kt,l=typeof self=="object"&&self&&self.Object===Object&&self,d=c||l||Function("return this")(),u=Object.prototype,p=u.toString,f=Math.max,m=Math.min,y=function(){return d.Date.now()};function S(I,C,P){var k,T,M,A,j,R,L=0,F=!1,H=!1,B=!0;if(typeof I!="function")throw new TypeError(t);C=E(C)||0,v(P)&&(F=!!P.leading,H="maxWait"in P,M=H?f(E(P.maxWait)||0,C):M,B="trailing"in P?!!P.trailing:B);function $(V){var te=k,ie=T;return k=T=void 0,L=V,A=I.apply(ie,te),A}function Q(V){return L=V,j=setTimeout(ne,C),F?$(V):A}function Z(V){var te=V-R,ie=V-L,oe=C-te;return H?m(oe,M-ie):oe}function ee(V){var te=V-R,ie=V-L;return R===void 0||te>=C||te<0||H&&ie>=M}function ne(){var V=y();if(ee(V))return N(V);j=setTimeout(ne,Z(V))}function N(V){return j=void 0,B&&k?$(V):(k=T=void 0,A)}function D(){j!==void 0&&clearTimeout(j),L=0,k=R=T=j=void 0}function q(){return j===void 0?A:N(y())}function U(){var V=y(),te=ee(V);if(k=arguments,T=this,R=V,te){if(j===void 0)return Q(R);if(H)return j=setTimeout(ne,C),$(R)}return j===void 0&&(j=setTimeout(ne,C)),A}return U.cancel=D,U.flush=q,U}function g(I,C,P){var k=!0,T=!0;if(typeof I!="function")throw new TypeError(t);return v(P)&&(k="leading"in P?!!P.leading:k,T="trailing"in P?!!P.trailing:T),S(I,C,{leading:k,maxWait:C,trailing:T})}function v(I){var C=typeof I;return!!I&&(C=="object"||C=="function")}function x(I){return!!I&&typeof I=="object"}function b(I){return typeof I=="symbol"||x(I)&&p.call(I)==n}function E(I){if(typeof I=="number")return I;if(b(I))return e;if(v(I)){var C=typeof I.valueOf=="function"?I.valueOf():I;I=v(C)?C+"":C}if(typeof I!="string")return I===0?I:+I;I=I.replace(r,"");var P=i.test(I);return P||o.test(I)?a(I.slice(2),P?2:8):s.test(I)?e:+I}return af=g,af}var nz=tz();const vj=Ws(nz);var cf,JC;function rz(){if(JC)return cf;JC=1;var t=200,e="__lodash_hash_undefined__",n=1/0,r="[object Function]",s="[object GeneratorFunction]",i=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=typeof kt=="object"&&kt&&kt.Object===Object&&kt,c=typeof self=="object"&&self&&self.Object===Object&&self,l=a||c||Function("return this")();function d(Y,ae){var Ce=Y?Y.length:0;return!!Ce&&p(Y,ae,0)>-1}function u(Y,ae,Ce,De){for(var _t=Y.length,gn=Ce+-1;++gn<_t;)if(ae(Y[gn],gn,Y))return gn;return-1}function p(Y,ae,Ce){if(ae!==ae)return u(Y,f,Ce);for(var De=Ce-1,_t=Y.length;++De<_t;)if(Y[De]===ae)return De;return-1}function f(Y){return Y!==Y}function m(Y,ae){return Y.has(ae)}function y(Y,ae){return Y?.[ae]}function S(Y){var ae=!1;if(Y!=null&&typeof Y.toString!="function")try{ae=!!(Y+"")}catch{}return ae}function g(Y){var ae=-1,Ce=Array(Y.size);return Y.forEach(function(De){Ce[++ae]=De}),Ce}var v=Array.prototype,x=Function.prototype,b=Object.prototype,E=l["__core-js_shared__"],I=(function(){var Y=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||"");return Y?"Symbol(src)_1."+Y:""})(),C=x.toString,P=b.hasOwnProperty,k=b.toString,T=RegExp("^"+C.call(P).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=v.splice,A=Vt(l,"Map"),j=Vt(l,"Set"),R=Vt(Object,"create");function L(Y){var ae=-1,Ce=Y?Y.length:0;for(this.clear();++ae<Ce;){var De=Y[ae];this.set(De[0],De[1])}}function F(){this.__data__=R?R(null):{}}function H(Y){return this.has(Y)&&delete this.__data__[Y]}function B(Y){var ae=this.__data__;if(R){var Ce=ae[Y];return Ce===e?void 0:Ce}return P.call(ae,Y)?ae[Y]:void 0}function $(Y){var ae=this.__data__;return R?ae[Y]!==void 0:P.call(ae,Y)}function Q(Y,ae){var Ce=this.__data__;return Ce[Y]=R&&ae===void 0?e:ae,this}L.prototype.clear=F,L.prototype.delete=H,L.prototype.get=B,L.prototype.has=$,L.prototype.set=Q;function Z(Y){var ae=-1,Ce=Y?Y.length:0;for(this.clear();++ae<Ce;){var De=Y[ae];this.set(De[0],De[1])}}function ee(){this.__data__=[]}function ne(Y){var ae=this.__data__,Ce=xe(ae,Y);if(Ce<0)return!1;var De=ae.length-1;return Ce==De?ae.pop():M.call(ae,Ce,1),!0}function N(Y){var ae=this.__data__,Ce=xe(ae,Y);return Ce<0?void 0:ae[Ce][1]}function D(Y){return xe(this.__data__,Y)>-1}function q(Y,ae){var Ce=this.__data__,De=xe(Ce,Y);return De<0?Ce.push([Y,ae]):Ce[De][1]=ae,this}Z.prototype.clear=ee,Z.prototype.delete=ne,Z.prototype.get=N,Z.prototype.has=D,Z.prototype.set=q;function U(Y){var ae=-1,Ce=Y?Y.length:0;for(this.clear();++ae<Ce;){var De=Y[ae];this.set(De[0],De[1])}}function V(){this.__data__={hash:new L,map:new(A||Z),string:new L}}function te(Y){return Kt(this,Y).delete(Y)}function ie(Y){return Kt(this,Y).get(Y)}function oe(Y){return Kt(this,Y).has(Y)}function ue(Y,ae){return Kt(this,Y).set(Y,ae),this}U.prototype.clear=V,U.prototype.delete=te,U.prototype.get=ie,U.prototype.has=oe,U.prototype.set=ue;function de(Y){var ae=-1,Ce=Y?Y.length:0;for(this.__data__=new U;++ae<Ce;)this.add(Y[ae])}function ge(Y){return this.__data__.set(Y,e),this}function le(Y){return this.__data__.has(Y)}de.prototype.add=de.prototype.push=ge,de.prototype.has=le;function xe(Y,ae){for(var Ce=Y.length;Ce--;)if(Kn(Y[Ce][0],ae))return Ce;return-1}function me(Y){if(!Wt(Y)||tt(Y))return!1;var ae=cn(Y)||S(Y)?T:o;return ae.test(Gn(Y))}function et(Y,ae,Ce){var De=-1,_t=d,gn=Y.length,si=!0,lr=[],dr=lr;if(gn>=t){var Vn=ht(Y);if(Vn)return g(Vn);si=!1,_t=m,dr=new de}else dr=lr;e:for(;++De<gn;){var ur=Y[De],Vr=ur;if(ur=ur!==0?ur:0,si&&Vr===Vr){for(var zi=dr.length;zi--;)if(dr[zi]===Vr)continue e;lr.push(ur)}else _t(dr,Vr,Ce)||(dr!==lr&&dr.push(Vr),lr.push(ur))}return lr}var ht=j&&1/g(new j([,-0]))[1]==n?function(Y){return new j(Y)}:Kr;function Kt(Y,ae){var Ce=Y.__data__;return It(ae)?Ce[typeof ae=="string"?"string":"hash"]:Ce.map}function Vt(Y,ae){var Ce=y(Y,ae);return me(Ce)?Ce:void 0}function It(Y){var ae=typeof Y;return ae=="string"||ae=="number"||ae=="symbol"||ae=="boolean"?Y!=="__proto__":Y===null}function tt(Y){return!!I&&I in Y}function Gn(Y){if(Y!=null){try{return C.call(Y)}catch{}try{return Y+""}catch{}}return""}function jn(Y){return Y&&Y.length?et(Y):[]}function Kn(Y,ae){return Y===ae||Y!==Y&&ae!==ae}function cn(Y){var ae=Wt(Y)?k.call(Y):"";return ae==r||ae==s}function Wt(Y){var ae=typeof Y;return!!Y&&(ae=="object"||ae=="function")}function Kr(){}return cf=jn,cf}var sz=rz();const iz=Ws(sz),va={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},oz=va.Good;class xj{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,n=e===0?0:Math.floor(this.frames/e),r=n>55?va.Good:n>30?va.Mid:va.Poor,s=r===va.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${n}%c fps`,`color: white; background: ${oz};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${s};`,"font-weight: normal")}isStarted(){return this.started}}function kb(t,e){const n=[];e:for(const r of t){for(const s of n)if(e?e(r,s):r===s)continue e;n.push(r)}return n}function Te(t){return t.filter(e=>e!=null)}function Bt(t){return t[t.length-1]}function az(t,e){let n,r=1/0;for(const s of t){const i=e(s);i<r&&(n=s,r=i)}return n}function cz(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}class ls{items=new WeakMap;get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}function bj(t){const e=(...n)=>{try{return t(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const qa=()=>{},Fs={ok(t){return{ok:!0,value:t}},err(t){return{ok:!1,error:t}}};function tn(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const Ze=bj((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),er=bj((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function wj(t,e){let n;const r=(...s)=>(n||(n={},n.promise=new Promise((i,o)=>{n.resolve=i,n.reject=o})),clearTimeout(n.timeout),n.latestArgs=s,n.timeout=setTimeout(()=>{const i=n;n=void 0;try{i.resolve(t(...i.latestArgs))}catch(o){i.reject(o)}},e),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const e_=new WeakMap;function Tb(t,e){if(typeof t!="object"||t===null)return;let n=e_.get(t);n||(n={tags:{},extras:{}},e_.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}async function Nr(t,e){return window.fetch(t,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const mo=(t,e)=>{const n=new window.Image(t,e);return n.referrerPolicy="strict-origin-when-cross-origin",n};class yi{static async dataUrlToArrayBuffer(e){return Nr(e).then(function(n){return n.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((n,r)=>{if(e){const s=new FileReader;s.onload=()=>n(s.result),s.onerror=i=>r(i),s.onabort=i=>r(i),s.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((n,r)=>{if(e){const s=new FileReader;s.onload=()=>n(s.result),s.onerror=i=>r(i),s.onabort=i=>r(i),s.readAsText(e)}})}}function xx(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}function lz(t){const e=new DataView(t);let n=0;for(let r=0;r<e.byteLength;r++)n=(n<<5)-n+e.getUint8(r),n|=0;return n+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function dz(t){const e=new Uint8Array(t);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(i,o,a,c,l=1024){if(!o)return-1;o=new RegExp(o,"g");const d=o.source.length,u=new TextDecoder,p=i.length;if(typeof c>"u"&&(c=p),a>=p||c<=0||a>=c)return-1;i=i.subarray(a,c);let f=-1,m=0,y=0,S="";e:for(;m<i.length;){const g=m+l,v=i.subarray(m,g),x=u.decode(v,{stream:!0}),b=S+x;let E,I=-1;for(;(E=o.exec(b))!==null;){I=E.index-S.length,f=y+I;break e}m=g,y+=x.length;const C=I>-1?I+d:x.length-d;S=x.slice(C)}return f>=0&&(f+=a>=0?a:p+a),f}const s=r(e,"IDAT",12);return s>=12?r(e,"acTL",8,s)>=8:!1}const uz=t=>new Uint8Array(t)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function t_(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function hz(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function pz(t){const e=new Uint8Array(t);let n,r,s=0,i=0;if(!hz(t))return!1;for(n=e[10]&128,r=e[10]&7,s+=6,s+=7,s+=n?3*Math.pow(2,r+1):0;i<2&&s<e.length;)switch(e[s]){case 44:i+=1,n=e[s+9]&128,r=e[s+9]&7,s+=10,s+=n?3*Math.pow(2,r+1):0,s+=t_(e,s+1)+1;break;case 33:s+=2,s+=t_(e,s);break;case 59:s=e.length;break;default:s=e.length;break}return i>1}let bx=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(bx=new Int32Array(bx));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const fz=(t,e)=>{let n=-1;for(let r=0;r<t.length;r++)n=bx[(n^t[r])&255]^n>>>8;return n^-1},n_=4,r_=4;class Mr{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const r={};if(!Mr.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const s=n,i=e.getInt32(n);n+=4;const o=Mr.getChunkType(e,n);if(o==="IDAT"&&r[o]){n+=i+n_+r_;continue}if(o==="IEND")break;r[o]={start:s,dataOffset:n+4,size:i},n+=i+n_+r_}return r}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+4)}}static findChunk(e,n){return Mr.readChunks(e)[n]}static setPhysChunk(e,n=1,r){let s=46,i=0;const o=Mr.findChunk(e,"pHYs");o&&(s=o.start,i=o.size);const a=Mr.findChunk(e,"IDAT");a&&(s=a.start,i=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const d=2835.5;l.setInt32(8,d*n),l.setInt32(12,d*n),l.setInt8(16,1);const u=new Uint8Array(c.slice(4,17));l.setInt32(17,fz(u));const p=e.buffer.slice(0,s),f=e.buffer.slice(s+i);return new Blob([p,c,f],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function gz(t){return!t||t.length<12?!1:t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80}function mz(t){const e=new Uint8Array(t);return!gz(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const Cj=Object.freeze(["image/svg+xml"]),_j=Object.freeze(["image/jpeg","image/png","image/webp"]),Ij=Object.freeze(["image/gif","image/apng","image/avif"]),Mb=Object.freeze([..._j,...Cj,...Ij]),Pj=Object.freeze(["video/mp4","video/webm","video/quicktime"]),yz=[...Mb,...Pj].join(",");class Ar{static loadVideo(e){return new Promise((n,r)=>{const s=document.createElement("video");s.onloadeddata=()=>n(s),s.onerror=i=>{console.error(i),r(new Error("Could not load video"))},s.crossOrigin="anonymous",s.src=e})}static loadImage(e){return new Promise((n,r)=>{const s=mo();s.onload=()=>n(s),s.onerror=i=>{console.error(i),r(new Error("Could not load image"))},s.crossOrigin="anonymous",s.referrerPolicy="strict-origin-when-cross-origin",s.src=e})}static async getVideoSize(e){return Ar.usingObjectURL(e,async n=>{const r=await Ar.loadVideo(n);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const n=await Ar.usingObjectURL(e,Ar.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(Mr.isPng(r,0)){const s=Mr.findChunk(r,"pHYs");if(s){const i=Mr.parsePhys(r,s.dataOffset);if(i.unit===0&&i.ppux===i.ppuy){const o=Math.max(i.ppux/2834.5,1);return{w:Math.round(n.naturalWidth/o),h:Math.round(n.naturalHeight/o)}}}}}}catch(r){return console.error(r),{w:n.naturalWidth,h:n.naturalHeight}}return{w:n.naturalWidth,h:n.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?pz(await e.arrayBuffer()):e.type==="image/avif"?uz(await e.arrayBuffer()):e.type==="image/webp"?mz(await e.arrayBuffer()):e.type==="image/apng"?dz(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return Ij.includes(e||"")}static isStaticImageType(e){return _j.includes(e||"")}static isVectorImageType(e){return Cj.includes(e||"")}static isImageType(e){return Mb.includes(e)}static async usingObjectURL(e,n){const r=URL.createObjectURL(e);try{return await n(r)}finally{URL.revokeObjectURL(r)}}}function xn(t,e,n){return t+(e-t)*n}function wr(t=""){let e=0,n=0,r=0,s=0;function i(){const o=e^e<<11;return e=n,n=r,r=s,s^=(s>>>19^o^o>>>8)>>>0,s/4294967296*2}for(let o=0;o<t.length+64;o++)e^=t.charCodeAt(o)|0,i();return i}function yo(t,e,n,r=!1){const[s,i]=e,[o,a]=n,c=o+(t-s)/(i-s)*(a-o);return r?o<a?Math.max(Math.min(c,a),o):Math.max(Math.min(c,o),a):c}function Dr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Cn(t,e){if(Dr(t,e))return t[e]}function s_(t){return Object.keys(t)}function ft(t){return Object.values(t)}function Pn(t){return Object.entries(t)}function Ej(t){return Object.fromEntries(t)}function ja(t,e){const n={};let r=!1;for(const[s,i]of Pn(t))e(s,i)?n[s]=i:r=!0;return r?n:t}function fc(t,e){const n={};for(const[r,s]of Pn(t)){const i=e(r,s);n[r]=i}return n}function kj(t,e){if(t===e)return!0;const n=new Set(Object.keys(t)),r=new Set(Object.keys(e));if(n.size!==r.size)return!1;for(const s of n)if(!r.has(s)||!Object.is(t[s],e[s]))return!1;return!0}const Ln="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Tj="a0",Mj="A00000000000000000000000000";function Aj(t){if(t>="a"&&t<="z")return t.charCodeAt(0)-97+2;if(t>="A"&&t<="Z")return 90-t.charCodeAt(0)+2;throw new Error("Invalid index key head: "+t)}function jj(t){if(t.length!==Aj(t.charAt(0)))throw new Error("invalid integer part of index key: "+t)}function i_(t){if(t===void 0)throw Error("n is undefined")}function o_(t){jj(t);const[e,...n]=t.split("");let r=!0;for(let s=n.length-1;r&&s>=0;s--){const i=Ln.indexOf(n[s])+1;i===Ln.length?n[s]="0":(n[s]=Ln.charAt(i),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const s=String.fromCharCode(e.charCodeAt(0)+1);return s>"a"?n.push("0"):n.pop(),s+n.join("")}else return e+n.join("")}function Sz(t){jj(t);const[e,...n]=t.split("");let r=!0;for(let s=n.length-1;r&&s>=0;s--){const i=Ln.indexOf(n[s])-1;i===-1?n[s]=Ln.slice(-1):(n[s]=Ln.charAt(i),r=!1)}if(r){if(e==="a")return"Z"+Ln.slice(-1);if(e==="A")return;const s=String.fromCharCode(e.charCodeAt(0)-1);return s<"Z"?n.push(Ln.slice(-1)):n.pop(),s+n.join("")}else return e+n.join("")}function to(t,e){if(e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let s=0;for(;(t.charAt(s)||"0")===e.charAt(s);)s++;if(s>0)return e.slice(0,s)+to(t.slice(s),e.slice(s))}const n=t?Ln.indexOf(t.charAt(0)):0,r=e!==void 0?Ln.indexOf(e.charAt(0)):Ln.length;if(r-n>1){const s=Math.round(.5*(n+r));return Ln.charAt(s)}else return e&&e.length>1?e.slice(0,1):Ln.charAt(n)+to(t.slice(1),void 0)}function xa(t){const e=Aj(t.charAt(0));if(e>t.length)throw new Error("invalid index: "+t);return t.slice(0,e)}function wx(t){if(t===Mj)throw new Error("invalid index: "+t);const e=xa(t);if(t.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+t)}function Gi(t,e){if(t!==void 0&&wx(t),e!==void 0&&wx(e),t!==void 0&&e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t===void 0&&e===void 0)return Tj;if(t===void 0){if(e===void 0)throw Error("b is undefined");const a=xa(e),c=e.slice(a.length);if(a===Mj)return a+to("",c);if(a<e)return a;const l=Sz(a);return i_(l),l}if(e===void 0){const a=xa(t),c=t.slice(a.length),l=o_(a);return l===void 0?a+to(c,void 0):l}const n=xa(t),r=t.slice(n.length),s=xa(e),i=e.slice(s.length);if(n===s)return n+to(r,i);const o=o_(n);return i_(o),o<e?o:n+to(r,void 0)}function Hs(t,e,n){if(n===0)return[];if(n===1)return[Gi(t,e)];if(e===void 0){let i=Gi(t,e);const o=[i];for(let a=0;a<n-1;a++)i=Gi(i,e),o.push(i);return o}if(t===void 0){let i=Gi(t,e);const o=[i];for(let a=0;a<n-1;a++)i=Gi(t,i),o.push(i);return o.reverse(),o}const r=Math.floor(n/2),s=Gi(t,e);return[...Hs(t,s,r),s,...Hs(s,e,n-r-1)]}const Rj=Tj;function vz(t){wx(t)}function So(t,e,n){return Hs(t,e,n)}function lf(t,e){return Hs(t,void 0,e)}function Ha(t,e){return Hs(t,e,1)[0]}function fr(t){return Hs(t,void 0,1)[0]}function xz(t){return Hs(void 0,t,1)[0]}function Ga(t,e="a1"){return[e,...Hs(e,void 0,t)]}function en(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function bz(t,e){return t.id>e.id?1:-1}function Ab(t){try{return localStorage.getItem(t)}catch{return null}}function jb(t,e){try{localStorage.setItem(t,e)}catch{}}function wz(){try{localStorage.clear()}catch{}}function Oj(t){try{return sessionStorage.getItem(t)}catch{return null}}function Rb(t,e){try{sessionStorage.setItem(t,e)}catch{}}function Dj(t){try{sessionStorage.removeItem(t)}catch{}}function Cz(){try{sessionStorage.clear()}catch{}}const no=[],_z=60,Ml=Math.ceil(1e3/_z);let ta,df=0,Cx=0;const Iz=()=>{const t=no.splice(0,no.length);for(const e of t)e()};function Lj(){if(ta)return;const t=Date.now(),e=t-Cx;if(df+e<Ml){ta=requestAnimationFrame(()=>{ta=void 0,Lj()});return}ta=requestAnimationFrame(()=>{ta=void 0,Cx=t,df=Math.min(df+e-Ml,Ml*10),Iz()})}let a_=!1;function Nj(t){return no.includes(t)||(no.push(t),a_||(a_=!0,Cx=Date.now()-Ml-1),Lj()),()=>{const e=no.indexOf(t);e>-1&&no.splice(e,1)}}class Pz{timeouts=[];intervals=[];rafs=[];setTimeout(e,n,...r){const s=window.setTimeout(e,n,r);return this.timeouts.push(s),s}setInterval(e,n,...r){const s=window.setInterval(e,n,r);return this.intervals.push(s),s}requestAnimationFrame(e){const n=window.requestAnimationFrame(e);return this.rafs.push(n),n}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function Ez(t){return t!==null}function kz(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[t=>t&&JSON.parse(JSON.stringify(t)),!1]}const Fj=kz(),Ye=Fj[0];Fj[1];const Tz=Object.getPrototypeOf(Ye({}));var uf={};const Ob={enableLicensing:Mz("enableLicensing",{defaults:{all:!0,production:!1}})},Bj=mn("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),yt={logPreventDefaults:mn("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:mn("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:mn("logElementRemoves",{defaults:{all:!1}}),debugSvg:mn("debugSvg",{defaults:{all:!1}}),showFps:mn("showFps",{defaults:{all:!1}}),measurePerformance:mn("measurePerformance",{defaults:{all:!1}}),throwToBlob:mn("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:mn("reconnectOnPing",{defaults:{all:!1}}),debugCursors:mn("debugCursors",{defaults:{all:!1}}),forceSrgb:mn("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:mn("debugGeometry",{defaults:{all:!1}}),hideShapes:mn("hideShapes",{defaults:{all:!1}}),editOnType:mn("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const t=Element.prototype.removeChild;Oi("element removal logging",()=>{yt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function mn(t,{defaults:e,shouldStoreForSession:n=!0}){return $j({name:t,defaults:e,shouldStoreForSession:n})}function Mz(t,{defaults:e,shouldStoreForSession:n=!0}){return $j({name:t,defaults:e,shouldStoreForSession:n})}function $j(t){const e=jz(t),n=t.shouldStoreForSession?Az(t.name):null,r=Tt(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&Oi(`debug:${t.name}`,()=>{const s=r.get();s===e?Dj(`tldraw_debug:${t.name}`):Rb(`tldraw_debug:${t.name}`,JSON.stringify(s))}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,s=>s.toUpperCase())}`,{get(){return r.get()},set(s){r.set(s)},configurable:!0})),Object.assign(r,t)}function Az(t){try{return JSON.parse(Oj(`tldraw_debug:${t}`)??"null")}catch{return null}}function hf(t){try{return t()}catch{return null}}function jz(t){switch(hf(()=>uf.TLDRAW_ENV)??hf(()=>uf.VERCEL_PUBLIC_TLDRAW_ENV)??hf(()=>uf.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}class Al{constructor(e){this.previousValue=e}nextValue;diff;get(){const e=this.diff?.removed?.size??0,n=this.diff?.added?.size??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},n?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){const n=this.previousValue.has(e);if(n)return this.diff?.removed?.has(e)?this._add(e,n):void 0;this.nextValue?.has(e)||this._add(e,n)}_remove(e,n){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},n?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){const n=this.previousValue.has(e);if(!n)return this.diff?.added?.has(e)?this._remove(e,n):void 0;this.diff?.removed?.has(e)||this._remove(e,n)}}let zj=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");class Td{constructor(e,n){this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.validator=n.validator??{validate:s=>s},this.scope=n.scope??"document",this.ephemeralKeys=n.ephemeralKeys;const r=new Set;if(n.ephemeralKeys)for(const[s,i]of Pn(n.ephemeralKeys))i&&r.add(s);this.ephemeralKeySet=r}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){const n={...this.createDefaultProperties(),id:this.createId()};for(const[r,s]of Object.entries(e))s!==void 0&&(n[r]=s);return n.typeName=this.typeName,n}clone(e){return{...Ye(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??zj())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Td(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,n){return n&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(n,e):this.validator.validate(e)}}function qr(t,e){return new Td(t,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function ql(){return{added:{},updated:{},removed:{}}}function _x(t){const e={added:t.removed,removed:t.added,updated:{}};for(const[n,r]of Object.values(t.updated))e.updated[n.id]=[r,n];return e}function Uj(t){return Object.keys(t.added).length===0&&Object.keys(t.updated).length===0&&Object.keys(t.removed).length===0}function Db(t){const e={added:{},removed:{},updated:{}};return Ra(e,t),e}function Ra(t,e){for(const n of e){for(const[r,s]of Pn(n.added))if(t.removed[r]){const i=t.removed[r];delete t.removed[r],i!==s&&(t.updated[r]=[i,s])}else t.added[r]=s;for(const[r,[s,i]]of Pn(n.updated)){if(t.added[r]){t.added[r]=i,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],i],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,s]of Pn(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=s}}var ba={exports:{}};ba.exports;var c_;function Rz(){return c_||(c_=1,(function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",d="[object Boolean]",u="[object Date]",p="[object Error]",f="[object Function]",m="[object GeneratorFunction]",y="[object Map]",S="[object Number]",g="[object Null]",v="[object Object]",x="[object Promise]",b="[object Proxy]",E="[object RegExp]",I="[object Set]",C="[object String]",P="[object Symbol]",k="[object Undefined]",T="[object WeakMap]",M="[object ArrayBuffer]",A="[object DataView]",j="[object Float32Array]",R="[object Float64Array]",L="[object Int8Array]",F="[object Int16Array]",H="[object Int32Array]",B="[object Uint8Array]",$="[object Uint8ClampedArray]",Q="[object Uint16Array]",Z="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,ne=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,D={};D[j]=D[R]=D[L]=D[F]=D[H]=D[B]=D[$]=D[Q]=D[Z]=!0,D[a]=D[c]=D[M]=D[d]=D[A]=D[u]=D[p]=D[f]=D[y]=D[S]=D[v]=D[E]=D[I]=D[C]=D[T]=!1;var q=typeof kt=="object"&&kt&&kt.Object===Object&&kt,U=typeof self=="object"&&self&&self.Object===Object&&self,V=q||U||Function("return this")(),te=e&&!e.nodeType&&e,ie=te&&!0&&t&&!t.nodeType&&t,oe=ie&&ie.exports===te,ue=oe&&q.process,de=(function(){try{return ue&&ue.binding&&ue.binding("util")}catch{}})(),ge=de&&de.isTypedArray;function le(O,z){for(var re=-1,pe=O==null?0:O.length,Qe=0,ke=[];++re<pe;){var pt=O[re];z(pt,re,O)&&(ke[Qe++]=pt)}return ke}function xe(O,z){for(var re=-1,pe=z.length,Qe=O.length;++re<pe;)O[Qe+re]=z[re];return O}function me(O,z){for(var re=-1,pe=O==null?0:O.length;++re<pe;)if(z(O[re],re,O))return!0;return!1}function et(O,z){for(var re=-1,pe=Array(O);++re<O;)pe[re]=z(re);return pe}function ht(O){return function(z){return O(z)}}function Kt(O,z){return O.has(z)}function Vt(O,z){return O?.[z]}function It(O){var z=-1,re=Array(O.size);return O.forEach(function(pe,Qe){re[++z]=[Qe,pe]}),re}function tt(O,z){return function(re){return O(z(re))}}function Gn(O){var z=-1,re=Array(O.size);return O.forEach(function(pe){re[++z]=pe}),re}var jn=Array.prototype,Kn=Function.prototype,cn=Object.prototype,Wt=V["__core-js_shared__"],Kr=Kn.toString,Y=cn.hasOwnProperty,ae=(function(){var O=/[^.]+$/.exec(Wt&&Wt.keys&&Wt.keys.IE_PROTO||"");return O?"Symbol(src)_1."+O:""})(),Ce=cn.toString,De=RegExp("^"+Kr.call(Y).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=oe?V.Buffer:void 0,gn=V.Symbol,si=V.Uint8Array,lr=cn.propertyIsEnumerable,dr=jn.splice,Vn=gn?gn.toStringTag:void 0,ur=Object.getOwnPropertySymbols,Vr=_t?_t.isBuffer:void 0,zi=tt(Object.keys,Object),Ko=Hi(V,"DataView"),ii=Hi(V,"Map"),Vo=Hi(V,"Promise"),Wo=Hi(V,"Set"),Yo=Hi(V,"WeakMap"),oi=Hi(Object,"create"),ju=ci(Ko),Ru=ci(ii),Ou=ci(Vo),Du=ci(Wo),Lu=ci(Yo),Fc=gn?gn.prototype:void 0,Xo=Fc?Fc.valueOf:void 0;function Wr(O){var z=-1,re=O==null?0:O.length;for(this.clear();++z<re;){var pe=O[z];this.set(pe[0],pe[1])}}function Nu(){this.__data__=oi?oi(null):{},this.size=0}function Fu(O){var z=this.has(O)&&delete this.__data__[O];return this.size-=z?1:0,z}function Bu(O){var z=this.__data__;if(oi){var re=z[O];return re===r?void 0:re}return Y.call(z,O)?z[O]:void 0}function $u(O){var z=this.__data__;return oi?z[O]!==void 0:Y.call(z,O)}function Bc(O,z){var re=this.__data__;return this.size+=this.has(O)?0:1,re[O]=oi&&z===void 0?r:z,this}Wr.prototype.clear=Nu,Wr.prototype.delete=Fu,Wr.prototype.get=Bu,Wr.prototype.has=$u,Wr.prototype.set=Bc;function Wn(O){var z=-1,re=O==null?0:O.length;for(this.clear();++z<re;){var pe=O[z];this.set(pe[0],pe[1])}}function $c(){this.__data__=[],this.size=0}function zu(O){var z=this.__data__,re=qi(z,O);if(re<0)return!1;var pe=z.length-1;return re==pe?z.pop():dr.call(z,re,1),--this.size,!0}function Uu(O){var z=this.__data__,re=qi(z,O);return re<0?void 0:z[re][1]}function qu(O){return qi(this.__data__,O)>-1}function Hu(O,z){var re=this.__data__,pe=qi(re,O);return pe<0?(++this.size,re.push([O,z])):re[pe][1]=z,this}Wn.prototype.clear=$c,Wn.prototype.delete=zu,Wn.prototype.get=Uu,Wn.prototype.has=qu,Wn.prototype.set=Hu;function Yr(O){var z=-1,re=O==null?0:O.length;for(this.clear();++z<re;){var pe=O[z];this.set(pe[0],pe[1])}}function Gu(){this.size=0,this.__data__={hash:new Wr,map:new(ii||Wn),string:new Wr}}function zc(O){var z=Vc(this,O).delete(O);return this.size-=z?1:0,z}function Ku(O){return Vc(this,O).get(O)}function Vu(O){return Vc(this,O).has(O)}function Wu(O,z){var re=Vc(this,O),pe=re.size;return re.set(O,z),this.size+=re.size==pe?0:1,this}Yr.prototype.clear=Gu,Yr.prototype.delete=zc,Yr.prototype.get=Ku,Yr.prototype.has=Vu,Yr.prototype.set=Wu;function Ui(O){var z=-1,re=O==null?0:O.length;for(this.__data__=new Yr;++z<re;)this.add(O[z])}function Yu(O){return this.__data__.set(O,r),this}function Xu(O){return this.__data__.has(O)}Ui.prototype.add=Ui.prototype.push=Yu,Ui.prototype.has=Xu;function Pr(O){var z=this.__data__=new Wn(O);this.size=z.size}function Uc(){this.__data__=new Wn,this.size=0}function Zu(O){var z=this.__data__,re=z.delete(O);return this.size=z.size,re}function Qu(O){return this.__data__.get(O)}function Ju(O){return this.__data__.has(O)}function eh(O,z){var re=this.__data__;if(re instanceof Wn){var pe=re.__data__;if(!ii||pe.length<n-1)return pe.push([O,z]),this.size=++re.size,this;re=this.__data__=new Yr(pe)}return re.set(O,z),this.size=re.size,this}Pr.prototype.clear=Uc,Pr.prototype.delete=Zu,Pr.prototype.get=Qu,Pr.prototype.has=Ju,Pr.prototype.set=eh;function th(O,z){var re=Wc(O),pe=!re&&OF(O),Qe=!re&&!pe&&oh(O),ke=!re&&!pe&&!Qe&&P0(O),pt=re||pe||Qe||ke,Pt=pt?et(O.length,String):[],Lt=Pt.length;for(var ct in O)Y.call(O,ct)&&!(pt&&(ct=="length"||Qe&&(ct=="offset"||ct=="parent")||ke&&(ct=="buffer"||ct=="byteLength"||ct=="byteOffset")||TF(ct,Lt)))&&Pt.push(ct);return Pt}function qi(O,z){for(var re=O.length;re--;)if(w0(O[re][0],z))return re;return-1}function nh(O,z,re){var pe=z(O);return Wc(O)?pe:xe(pe,re(O))}function ai(O){return O==null?O===void 0?k:g:Vn&&Vn in Object(O)?EF(O):RF(O)}function Zo(O){return Jo(O)&&ai(O)==a}function qc(O,z,re,pe,Qe){return O===z?!0:O==null||z==null||!Jo(O)&&!Jo(z)?O!==O&&z!==z:Hc(O,z,re,pe,qc,Qe)}function Hc(O,z,re,pe,Qe,ke){var pt=Wc(O),Pt=Wc(z),Lt=pt?c:_s(O),ct=Pt?c:_s(z);Lt=Lt==a?v:Lt,ct=ct==a?v:ct;var Rn=Lt==v,hr=ct==v,Yt=Lt==ct;if(Yt&&oh(O)){if(!oh(z))return!1;pt=!0,Rn=!1}if(Yt&&!Rn)return ke||(ke=new Pr),pt||P0(O)?Gc(O,z,re,pe,Qe,ke):ih(O,z,Lt,re,pe,Qe,ke);if(!(re&s)){var Yn=Rn&&Y.call(O,"__wrapped__"),Xn=hr&&Y.call(z,"__wrapped__");if(Yn||Xn){var Is=Yn?O.value():O,Xr=Xn?z.value():z;return ke||(ke=new Pr),Qe(Is,Xr,re,pe,ke)}}return Yt?(ke||(ke=new Pr),Kc(O,z,re,pe,Qe,ke)):!1}function rh(O){if(!I0(O)||AF(O))return!1;var z=C0(O)?De:ne;return z.test(ci(O))}function sh(O){return Jo(O)&&_0(O.length)&&!!D[ai(O)]}function Qo(O){if(!jF(O))return zi(O);var z=[];for(var re in Object(O))Y.call(O,re)&&re!="constructor"&&z.push(re);return z}function Gc(O,z,re,pe,Qe,ke){var pt=re&s,Pt=O.length,Lt=z.length;if(Pt!=Lt&&!(pt&&Lt>Pt))return!1;var ct=ke.get(O);if(ct&&ke.get(z))return ct==z;var Rn=-1,hr=!0,Yt=re&i?new Ui:void 0;for(ke.set(O,z),ke.set(z,O);++Rn<Pt;){var Yn=O[Rn],Xn=z[Rn];if(pe)var Is=pt?pe(Xn,Yn,Rn,z,O,ke):pe(Yn,Xn,Rn,O,z,ke);if(Is!==void 0){if(Is)continue;hr=!1;break}if(Yt){if(!me(z,function(Xr,li){if(!Kt(Yt,li)&&(Yn===Xr||Qe(Yn,Xr,re,pe,ke)))return Yt.push(li)})){hr=!1;break}}else if(!(Yn===Xn||Qe(Yn,Xn,re,pe,ke))){hr=!1;break}}return ke.delete(O),ke.delete(z),hr}function ih(O,z,re,pe,Qe,ke,pt){switch(re){case A:if(O.byteLength!=z.byteLength||O.byteOffset!=z.byteOffset)return!1;O=O.buffer,z=z.buffer;case M:return!(O.byteLength!=z.byteLength||!ke(new si(O),new si(z)));case d:case u:case S:return w0(+O,+z);case p:return O.name==z.name&&O.message==z.message;case E:case C:return O==z+"";case y:var Pt=It;case I:var Lt=pe&s;if(Pt||(Pt=Gn),O.size!=z.size&&!Lt)return!1;var ct=pt.get(O);if(ct)return ct==z;pe|=i,pt.set(O,z);var Rn=Gc(Pt(O),Pt(z),pe,Qe,ke,pt);return pt.delete(O),Rn;case P:if(Xo)return Xo.call(O)==Xo.call(z)}return!1}function Kc(O,z,re,pe,Qe,ke){var pt=re&s,Pt=b0(O),Lt=Pt.length,ct=b0(z),Rn=ct.length;if(Lt!=Rn&&!pt)return!1;for(var hr=Lt;hr--;){var Yt=Pt[hr];if(!(pt?Yt in z:Y.call(z,Yt)))return!1}var Yn=ke.get(O);if(Yn&&ke.get(z))return Yn==z;var Xn=!0;ke.set(O,z),ke.set(z,O);for(var Is=pt;++hr<Lt;){Yt=Pt[hr];var Xr=O[Yt],li=z[Yt];if(pe)var E0=pt?pe(li,Xr,Yt,z,O,ke):pe(Xr,li,Yt,O,z,ke);if(!(E0===void 0?Xr===li||Qe(Xr,li,re,pe,ke):E0)){Xn=!1;break}Is||(Is=Yt=="constructor")}if(Xn&&!Is){var Yc=O.constructor,Xc=z.constructor;Yc!=Xc&&"constructor"in O&&"constructor"in z&&!(typeof Yc=="function"&&Yc instanceof Yc&&typeof Xc=="function"&&Xc instanceof Xc)&&(Xn=!1)}return ke.delete(O),ke.delete(z),Xn}function b0(O){return nh(O,NF,kF)}function Vc(O,z){var re=O.__data__;return MF(z)?re[typeof z=="string"?"string":"hash"]:re.map}function Hi(O,z){var re=Vt(O,z);return rh(re)?re:void 0}function EF(O){var z=Y.call(O,Vn),re=O[Vn];try{O[Vn]=void 0;var pe=!0}catch{}var Qe=Ce.call(O);return pe&&(z?O[Vn]=re:delete O[Vn]),Qe}var kF=ur?function(O){return O==null?[]:(O=Object(O),le(ur(O),function(z){return lr.call(O,z)}))}:FF,_s=ai;(Ko&&_s(new Ko(new ArrayBuffer(1)))!=A||ii&&_s(new ii)!=y||Vo&&_s(Vo.resolve())!=x||Wo&&_s(new Wo)!=I||Yo&&_s(new Yo)!=T)&&(_s=function(O){var z=ai(O),re=z==v?O.constructor:void 0,pe=re?ci(re):"";if(pe)switch(pe){case ju:return A;case Ru:return y;case Ou:return x;case Du:return I;case Lu:return T}return z});function TF(O,z){return z=z??o,!!z&&(typeof O=="number"||N.test(O))&&O>-1&&O%1==0&&O<z}function MF(O){var z=typeof O;return z=="string"||z=="number"||z=="symbol"||z=="boolean"?O!=="__proto__":O===null}function AF(O){return!!ae&&ae in O}function jF(O){var z=O&&O.constructor,re=typeof z=="function"&&z.prototype||cn;return O===re}function RF(O){return Ce.call(O)}function ci(O){if(O!=null){try{return Kr.call(O)}catch{}try{return O+""}catch{}}return""}function w0(O,z){return O===z||O!==O&&z!==z}var OF=Zo((function(){return arguments})())?Zo:function(O){return Jo(O)&&Y.call(O,"callee")&&!lr.call(O,"callee")},Wc=Array.isArray;function DF(O){return O!=null&&_0(O.length)&&!C0(O)}var oh=Vr||BF;function LF(O,z){return qc(O,z)}function C0(O){if(!I0(O))return!1;var z=ai(O);return z==f||z==m||z==l||z==b}function _0(O){return typeof O=="number"&&O>-1&&O%1==0&&O<=o}function I0(O){var z=typeof O;return O!=null&&(z=="object"||z=="function")}function Jo(O){return O!=null&&typeof O=="object"}var P0=ge?ht(ge):sh;function NF(O){return DF(O)?th(O):Qo(O)}function FF(){return[]}function BF(){return!1}t.exports=LF})(ba,ba.exports)),ba.exports}var Oz=Rz();const Dz=Ws(Oz);function Lz(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),r=new Set;for(const s of e)n.every(i=>i.has(s))&&r.add(s);return r}function Nz(t,e){const n={};for(const r of e)t.has(r)||(n.added??=new Set,n.added.add(r));for(const r of t)e.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}function l_(t,e){for(const[n,r]of Object.entries(t)){const s=r,i=e[n];if("eq"in s&&i!==s.eq||"neq"in s&&i===s.neq||"gt"in s&&(typeof i!="number"||i<=s.gt))return!1}return!0}function d_(t,e,n){const r=Object.fromEntries(Object.keys(n).map(s=>[s,new Set]));for(const[s,i]of Object.entries(n))if("eq"in i){const a=t.index(e,s).get().get(i.eq);if(a)for(const c of a)r[s].add(c)}else if("neq"in i){const o=t.index(e,s);for(const[a,c]of o.get())if(a!==i.neq)for(const l of c)r[s].add(l)}else if("gt"in i){const o=t.index(e,s);for(const[a,c]of o.get())if(a>i.gt)for(const l of c)r[s].add(l)}return Lz(Object.values(r))}class Fz{constructor(e,n){this.atoms=e,this.history=n}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=J("filterHistory:"+e,(r,s)=>{if(mi(r))return this.history.get();const i=this.history.getDiffSince(s);if(i===Nn)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const d of i){for(const u of ft(d.added))if(u.typeName===e)if(o.removed[u.id]){const p=o.removed[u.id];delete o.removed[u.id],c--,p!==u&&(o.updated[u.id]=[p,u],l++)}else o.added[u.id]=u,a++;for(const[u,p]of ft(d.updated))p.typeName===e&&(o.added[p.id]?o.added[p.id]=p:o.updated[p.id]?o.updated[p.id]=[o.updated[p.id][0],p]:(o.updated[p.id]=[u,p],l++));for(const u of ft(d.removed))u.typeName===e&&(o.added[u.id]?(delete o.added[u.id],a--):o.updated[u.id]?(o.removed[u.id]=o.updated[u.id][0],delete o.updated[u.id],l--,c++):(o.removed[u.id]=u,c++))}return a||c||l?Sa(this.history.get(),o):r},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const r=e+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const s=this.__uncached_createIndex(e,n);return this.indexCache.set(r,s),s}__uncached_createIndex(e,n){const r=this.filterHistory(e),s=()=>{r.get();const i=new Map;for(const o of ft(this.atoms.get())){const a=o.get();if(a.typeName===e){const c=a[n];i.has(c)||i.set(c,new Set),i.get(c).add(a.id)}}return i};return J("index:"+e+":"+n,(i,o)=>{if(mi(i))return s();const a=r.getDiffSince(o);if(a===Nn)return s();const c=new Map,l=(f,m)=>{let y=c.get(f);y||(y=new Al(i.get(f)??new Set)),y.add(m),c.set(f,y)},d=(f,m)=>{let y=c.get(f);y||(y=new Al(i.get(f)??new Set)),y.remove(m),c.set(f,y)};for(const f of a){for(const m of ft(f.added))if(m.typeName===e){const y=m[n];l(y,m.id)}for(const[m,y]of ft(f.updated))if(y.typeName===e){const S=m[n],g=y[n];S!==g&&(d(S,y.id),l(g,y.id))}for(const m of ft(f.removed))if(m.typeName===e){const y=m[n];d(y,m.id)}}let u,p;for(const[f,m]of c){const y=m.get();y&&(u||(u=new Map(i)),p||(p=new Map),y.value.size===0?u.delete(f):u.set(f,y.value),p.set(f,y.diff))}return u&&p?Sa(u,p):i},{historyLength:100})}record(e,n=()=>({}),r="record:"+e+(n?":"+n.toString():"")){const s=this.ids(e,n,r);return J(r,()=>{for(const i of s.get())return this.atoms.get()[i]?.get()})}records(e,n=()=>({}),r="records:"+e+(n?":"+n.toString():"")){const s=this.ids(e,n,"ids:"+r);return J(r,()=>[...s.get()].map(i=>{const o=this.atoms.get()[i];if(!o)throw new Error("no atom found for record id: "+i);return o.get()}))}ids(e,n=()=>({}),r="ids:"+e+(n?":"+n.toString():"")){const s=this.filterHistory(e),i=()=>{s.get();const c=n();return Object.keys(c).length===0?new Set(ft(this.atoms.get()).flatMap(l=>{const d=l.get();return d.typeName===e?d.id:[]})):d_(this,e,c)},o=c=>{const l=i(),d=Nz(c,l);return d?Sa(l,d):c},a=J("ids_query:"+r,n,{isEqual:Dz});return J("query:"+r,(c,l)=>{const d=a.get();if(mi(c))return i();if(l<a.lastChangedEpoch)return o(c);const u=s.getDiffSince(l);if(u===Nn)return o(c);const p=new Al(c);for(const m of u){for(const y of ft(m.added))y.typeName===e&&l_(d,y)&&p.add(y.id);for(const[y,S]of ft(m.updated))S.typeName===e&&(l_(d,S)?p.add(S.id):p.remove(S.id));for(const y of ft(m.removed))y.typeName===e&&p.remove(y.id)}const f=p.get();return f?Sa(f.value,f.diff):c},{historyLength:50})}exec(e,n){const r=d_(this,e,n);if(r.size===0)return os;const s=this.atoms.get();return[...r].map(i=>s[i].get())}}class Bz{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,n){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let s=e;for(const i of r)s=i(s,n);return s}return e}handleAfterCreate(e,n){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const s of r)s(e,n)}handleBeforeChange(e,n,r){if(!this._isEnabled)return n;const s=this._beforeChangeHandlers[n.typeName];if(s){let i=n;for(const o of s)i=o(e,i,r);return i}return n}handleAfterChange(e,n,r){if(!this._isEnabled)return;const s=this._afterChangeHandlers[n.typeName];if(s)for(const i of s)i(e,n,r)}handleBeforeDelete(e,n){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const s of r)if(s(e,n)===!1)return!1}return!0}handleAfterDelete(e,n){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const s of r)s(e,n)}handleOperationComplete(e){if(this._isEnabled)for(const n of this._operationCompleteHandlers)n(e)}register(e){const n=[];for(const[r,s]of Object.entries(e))s?.beforeCreate&&n.push(this.registerBeforeCreateHandler(r,s.beforeCreate)),s?.afterCreate&&n.push(this.registerAfterCreateHandler(r,s.afterCreate)),s?.beforeChange&&n.push(this.registerBeforeChangeHandler(r,s.beforeChange)),s?.afterChange&&n.push(this.registerAfterChangeHandler(r,s.afterChange)),s?.beforeDelete&&n.push(this.registerBeforeDeleteHandler(r,s.beforeDelete)),s?.afterDelete&&n.push(this.registerAfterDeleteHandler(r,s.afterDelete));return()=>{for(const r of n)r()}}registerBeforeCreateHandler(e,n){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n),()=>di(this._beforeCreateHandlers[e],n)}registerAfterCreateHandler(e,n){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n),()=>di(this._afterCreateHandlers[e],n)}registerBeforeChangeHandler(e,n){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n),()=>di(this._beforeChangeHandlers[e],n)}registerAfterChangeHandler(e,n){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n),()=>di(this._afterChangeHandlers[e],n)}registerBeforeDeleteHandler(e,n){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n),()=>di(this._beforeDeleteHandlers[e],n)}registerAfterDeleteHandler(e,n){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n),()=>di(this._afterDeleteHandlers[e],n)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>di(this._operationCompleteHandlers,e)}}function di(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}class Lb{id;atoms=Tt("store_atoms",{});history=Tt("history",0,{historyLength:1e3});query=new Fz(this.atoms,this.history);listeners=new Set;historyAccumulator=new zz;historyReactor;cancelHistoryReactor=()=>{};schema;props;scopedTypes;sideEffects=new Bz(this);constructor(e){const{initialData:n,schema:r,id:s}=e;this.id=s??zj(),this.schema=r,this.props=e.props,n&&this.atoms.set(Ej(Pn(n).map(([i,o])=>[i,Tt("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=$$("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>this.cancelHistoryReactor=Nj(i)}),this.scopedTypes={document:new Set(ft(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(ft(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(ft(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:r}of e){let s=null,i=null,o=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(i??=this.filterChangesByScope(n,"document"),!i)continue;a({changes:i,source:r})}else if(c.scope==="session"){if(s??=this.filterChangesByScope(n,"session"),!s)continue;a({changes:s,source:r})}else{if(o??=this.filterChangesByScope(n,"presence"),!o)continue;a({changes:o,source:r})}else a({changes:n,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,n){const r={added:ja(e.added,(s,i)=>this.scopedTypes[n].has(i.typeName)),updated:ja(e.updated,(s,i)=>this.scopedTypes[n].has(i[1].typeName)),removed:ja(e.removed,(s,i)=>this.scopedTypes[n].has(i.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}put=(e,n)=>{this.atomic(()=>{const r={},s={},i=this.atoms.__unsafe__getWithoutCapture();let o=null,a,c=!1;const l=this.isMergingRemoteChanges?"remote":"user";for(let d=0,u=e.length;d<u;d++){a=e[d];const p=(o??i)[a.id];if(p){const f=p.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(f,a,l),this.schema.validateRecord(this,a,n??"updateRecord",f)===f)continue;p.set(a),c=!0;const y=p.__unsafe__getWithoutCapture();r[a.id]=[f,y],this.addDiffForAfterEvent(f,y)}else a=this.sideEffects.handleBeforeCreate(a,l),c=!0,a=this.schema.validateRecord(this,a,n??"createRecord",null),s[a.id]=a,this.addDiffForAfterEvent(null,a),o||(o={...i}),o[a.id]=Tt("atom:"+a.id,a)}o&&this.atoms.set(o),c&&this.updateHistory({added:s,updated:r,removed:{}})})};remove=e=>{this.atomic(()=>{const n=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const i of e){const o=this.atoms.__unsafe__getWithoutCapture()[i];o&&this.sideEffects.handleBeforeDelete(o.get(),r)===!1&&n.add(i)}let s;this.atoms.update(i=>{let o;for(const a of e){if(n.has(a)||!(a in i))continue;o||(o={...i}),s||(s={}),delete o[a];const c=i[a].get();s[a]=c,this.addDiffForAfterEvent(c,null)}return o??i}),s&&this.updateHistory({added:{},updated:{},removed:s})})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.__unsafe__getWithoutCapture()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{const n={};for(const[r,s]of Pn(this.atoms.get())){const i=s.get();(e==="all"||this.scopedTypes[e].has(i.typeName))&&(n[r]=i)}return n};getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords=()=>ft(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove(s_(this.atoms.get()))};update=(e,n)=>{const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(r.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,n)=>{this._flushHistory();const r={onHistory:e,filters:{source:n?.source??"all",scope:n?.scope??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Or(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){const n=[],r=this.historyAccumulator.addInterceptor(s=>n.push(s.changes));try{return Or(e),Db(n)}finally{r()}}applyDiff(e,{runCallbacks:n=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const s=ft(e.added);for(const[o,a]of ft(e.updated)){const c=this.schema.getType(a.typeName);if(r&&c.ephemeralKeySet.size){const l=this.get(a.id);if(!l){s.push(a);continue}let d=null;for(const[u,p]of Object.entries(a))c.ephemeralKeySet.has(u)||Object.is(p,Cn(l,u))||(d||(d={...l}),d[u]=p);d&&s.push(d)}else s.push(a)}const i=s_(e.removed);s.length&&this.put(s),i.length&&this.remove(i)},n)}createComputedCache=(e,n,r)=>{const s=new ls;return{get:i=>{const o=this.atoms.get()[i];if(o)return s.get(o,()=>{const a=r?J(o.name+":equals",()=>o.get(),{isEqual:r}):o;return J(e+":"+i,()=>n(a.get()))}).get()}}};createSelectedComputedCache=(e,n,r)=>{const s=new ls;return{get:i=>{const o=this.atoms.get()[i];if(o)return s.get(o,()=>{const a=J(e+":"+i+":selector",()=>n(o.get()));return J(e+":"+i,()=>r(a.get()))}).get()}}};_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,n){if(Ze(this.pendingAfterEvents,"must be in event operation"),e===n||(e&&n&&Ze(e.id===n.id),!e&&!n))return;const r=(e||n).id,s=this.pendingAfterEvents.get(r);s?s.after=n:this.pendingAfterEvents.set(r,{before:e,after:n})}flushAtomicCallbacks(){let e=0;const n=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:i}of r.values())s&&i?this.sideEffects.handleAfterChange(s,i,n):s&&!i?this.sideEffects.handleAfterDelete(s,n):!s&&i&&this.sideEffects.handleAfterCreate(i,n);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(n)}}}_isInAtomicOp=!1;atomic(e,n=!0){return Or(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(n??r),this._isInAtomicOp=!0;try{const s=e();return this.flushAtomicCallbacks(),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(n=>e(n,this.isMergingRemoteChanges?"remote":"user"))}}function $z(t){if(t.length===0)return[];const e=[];let n=[t[0]],r;for(let s=1,i=t.length;s<i;s++)r=t[s],n[0].source!==r.source&&(e.push(n),n=[]),n.push(r);return e.push(n),e.map(s=>({source:s[0].source,changes:Db(s.map(i=>i.changes))}))}class zz{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=$z(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function Uz(t,e,n){const r=new ls;return{get(s,i){return r.get(s,()=>(s instanceof Lb?s:s.store).createComputedCache(t,c=>e(s,c),n)).get(i)}}}function qz(t){const e=[];for(let n=t.length-1;n>=0;n--){const r=t[n];if("id"in r)e.unshift(r);else{const s=r.dependsOn,i=e[0];i&&(e[0]={...i,dependsOn:s.concat(i.dependsOn??[])})}}return e}function po({sequence:t,sequenceId:e,retroactive:n=!0}){const r={sequenceId:e,retroactive:n,sequence:qz(t)};return qj(r),r}function Mn(t,e){return Object.fromEntries(Pn(e).map(([n,r])=>[n,`${t}/${r}`]))}function qn(t){const e=t.sequenceId;return po({sequenceId:e,retroactive:t.retroactive??!0,sequence:t.sequence.map(n=>"id"in n?{...n,scope:"record",filter:r=>r.typeName===t.recordType&&(n.filter?.(r)??!0)&&(t.filter?.(r)??!0)}:n)})}function Hz(t){const e=new Map(t.map(i=>[i.id,i])),n=new Set,r=[];function s(i){Ze(!n.has(i.id),`Circular dependency in migrations: ${i.id}`),n.add(i.id);const{version:o,sequenceId:a}=Hl(i.id),c=e.get(`${a}/${o-1}`);if(c&&s(c),i.dependsOn)for(const l of i.dependsOn){const d=e.get(l);d&&s(d)}e.delete(i.id),r.push(i)}for(const i of e.values())s(i);return r}function Hl(t){const[e,n]=t.split("/");return{sequenceId:e,version:parseInt(n)}}function u_(t,e){e&&Ze(t.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${t}'`),Ze(t.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${t}'`)}function qj(t){if(Ze(!t.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${t.sequenceId}`),Ze(t.sequenceId.length,"sequenceId must be a non-empty string"),t.sequence.length===0)return;u_(t.sequence[0].id,t.sequenceId);let e=Hl(t.sequence[0].id).version;Ze(e===1,`Expected the first migrationId to be '${t.sequenceId}/1' but got '${t.sequence[0].id}'`);for(let n=1;n<t.sequence.length;n++){const r=t.sequence[n].id;u_(r,t.sequenceId);const s=Hl(r).version;Ze(s===e+1,`Migration id numbers must increase in increments of 1, expected ${t.sequenceId}/${e+1} but got '${t.sequence[n].id}'`),e=s}}var Ms=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(Ms||{});function Gz(t){if(t.schemaVersion>2||t.schemaVersion<1)return Fs.err("Bad schema version");if(t.schemaVersion===2)return Fs.ok(t);const e={schemaVersion:2,sequences:{}};for(const[n,r]of Object.entries(t.recordVersions))if(e.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(const[s,i]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${n}.${s}`]=i;return Fs.ok(e)}class Nb{constructor(e,n){this.types=e,this.options=n;for(const s of n.migrations??[])Ze(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),qj(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=Hz(r);for(const s of this.sortedMigrations)if(s.dependsOn?.length)for(const i of s.dependsOn){const o=r.find(a=>a.id===i);Ze(o,`Migration '${s.id}' depends on missing migration '${i}'`)}}static create(e,n){return new Nb(e,n??{})}migrations={};sortedMigrations;validateRecord(e,n,r,s){try{const i=Cn(this.types,n.typeName);if(!i)throw new Error(`Missing definition for record type ${n.typeName}`);return i.validate(n,s??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:r,recordBefore:s,error:i});throw i}}getMigrationsSince(e){const n=Gz(e);if(!n.ok)return n;const r=n.value,s=new Set(Object.keys(r.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)r.sequences[o]===void 0&&this.migrations[o].retroactive&&s.add(o);if(s.size===0)return Fs.ok([]);const i=new Set;for(const o of s){const a=r.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const d of this.migrations[o].sequence)i.add(d.id);continue}const c=`${o}/${a}`,l=this.migrations[o].sequence.findIndex(d=>d.id===c);if(l===-1)return Fs.err("Incompatible schema?");for(const d of this.migrations[o].sequence.slice(l+1))i.add(d.id)}return Fs.ok(this.sortedMigrations.filter(({id:o})=>i.has(o)))}migratePersistedRecord(e,n,r="up"){const s=this.getMigrationsSince(n);if(!s.ok)return console.error("Error migrating record",s.error),{type:"error",reason:Ms.MigrationError};let i=s.value;if(i.length===0)return{type:"success",value:e};if(i.some(o=>o.scope==="store"))return{type:"error",reason:r==="down"?Ms.TargetVersionTooOld:Ms.TargetVersionTooNew};if(r==="down"){if(!i.every(o=>o.down))return{type:"error",reason:Ms.TargetVersionTooOld};i=i.slice().reverse()}e=Ye(e);try{for(const o of i){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const c=o[r](e);c&&(e=Ye(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Ms.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:n}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:Ms.MigrationError};const s=r.value;if(s.length===0)return{type:"success",value:n};n=Ye(n);try{for(const i of s)if(i.scope==="record")for(const[o,a]of Object.entries(n)){if(!(i.filter?i.filter(a):!0))continue;const l=i.up(a);l&&(n[o]=Ye(l))}else if(i.scope==="store"){const o=i.up(n);o&&(n=Ye(o))}else tn(i)}catch(i){return console.error("Error migrating store",i),{type:"error",reason:Ms.MigrationError}}return{type:"success",value:n}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:n})=>[e,n.length?Hl(n.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const n=Cn(this.types,e);return Ze(n,"record type does not exists"),n}}function Kz(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Ne extends Error{constructor(e,n=[]){const r=Kz(n),s=e.split(`
`).map((i,o)=>o===0?i:`  ${i}`).join(`
`);super(n?`At ${r}: ${s}`:s),this.rawMessage=e,this.path=n}name="ValidationError"}function En(t,e){try{return e()}catch(n){throw n instanceof Ne?new Ne(n.rawMessage,[t,...n.path]):new Ne(n.toString(),[t])}}function Gs(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:tn(e)}}class un{constructor(e,n){this.validationFn=e,this.validateUsingKnownGoodVersionFn=n}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,n){return Object.is(e,n)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,n):this.validate(n)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return Qz(this)}optional(){return Gj(this)}refine(e){return new un(n=>e(this.validate(n)),(n,r)=>{const s=this.validateUsingKnownGoodVersion(n,r);return Object.is(n,s)?n:e(s)})}check(e,n){return typeof e=="string"?this.refine(r=>(En(`(check ${e})`,()=>n(r)),r)):this.refine(r=>(e(r),r))}}class Vz extends un{constructor(e){super(n=>{const r=h_.validate(n);for(let s=0;s<r.length;s++)En(s,()=>e.validate(r[s]));return r},(n,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const s=h_.validate(r);let i=n.length!==s.length;for(let o=0;o<s.length;o++){const a=s[o];if(o>=n.length){i=!0,En(o,()=>e.validate(a));continue}if(Object.is(n[o],a))continue;const c=En(o,()=>e.validateUsingKnownGoodVersion(n[o],a));Object.is(c,n[o])||(i=!0)}return i?r:n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Ne("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Ne("Expected an array with length greater than 1")})}}class Gl extends un{constructor(e,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Ne(`Expected object, got ${Gs(r)}`);for(const[s,i]of Object.entries(e))En(s,()=>{i.validate(Cn(r,s))});if(!n){for(const s of Object.keys(r))if(!Dr(e,s))throw new Ne("Unexpected property",[s])}return r},(r,s)=>{if(typeof s!="object"||s===null)throw new Ne(`Expected object, got ${Gs(s)}`);let i=!1;for(const[o,a]of Object.entries(e)){const c=Cn(r,o),l=Cn(s,o);if(Object.is(c,l))continue;const d=En(o,()=>{const u=a;return u.validateUsingKnownGoodVersion?u.validateUsingKnownGoodVersion(c,l):u.validate(l)});Object.is(d,c)||(i=!0)}if(!n){for(const o of Object.keys(s))if(!Dr(e,o))throw new Ne("Unexpected property",[o])}for(const o of Object.keys(r))if(!Dr(s,o)){i=!0;break}return i?s:r}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new Gl(this.config,!0)}extend(e){return new Gl({...this.config,...e})}}class Md extends un{constructor(e,n,r,s){super(i=>{this.expectObject(i);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(i);return o===void 0?this.unknownValueValidation(i,a):En(`(${e} = ${a})`,()=>o.validate(i))},(i,o)=>{this.expectObject(o),this.expectObject(i);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,c):Cn(i,e)!==Cn(o,e)?En(`(${e} = ${c})`,()=>a.validate(o)):En(`(${e} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(i,o):a.validate(o))}),this.key=e,this.config=n,this.unknownValueValidation=r,this.useNumberKeys=s}expectObject(e){if(typeof e!="object"||e===null)throw new Ne(`Expected an object, got ${Gs(e)}`,[])}getMatchingSchemaAndVariant(e){const n=Cn(e,this.key);if(!this.useNumberKeys&&typeof n!="string")throw new Ne(`Expected a string for key "${this.key}", got ${Gs(n)}`);if(this.useNumberKeys&&!Number.isFinite(Number(n)))throw new Ne(`Expected a number for key "${this.key}", got "${n}"`);return{matchingSchema:Dr(this.config,n)?this.config[n]:void 0,variant:n}}validateUnknownVariants(e){return new Md(this.key,this.config,e,this.useNumberKeys)}}class Wz extends un{constructor(e,n){super(r=>{if(typeof r!="object"||r===null)throw new Ne(`Expected object, got ${Gs(r)}`);for(const[s,i]of Object.entries(r))En(s,()=>{e.validate(s),n.validate(i)});return r},(r,s)=>{if(typeof s!="object"||s===null)throw new Ne(`Expected object, got ${Gs(s)}`);let i=!1;for(const[o,a]of Object.entries(s)){if(!Dr(r,o)){i=!0,En(o,()=>{e.validate(o),n.validate(a)});continue}const c=Cn(r,o),l=a;if(Object.is(c,l))continue;const d=En(o,()=>n.validateUsingKnownGoodVersion?n.validateUsingKnownGoodVersion(c,l):n.validate(l));Object.is(d,c)||(i=!0)}for(const o of Object.keys(r))if(!Dr(s,o)){i=!0;break}return i?s:r}),this.keyValidator=e,this.valueValidator=n}}function Fb(t){return new un(e=>{if(typeof e!==t)throw new Ne(`Expected ${t}, got ${Gs(e)}`);return e})}const Yz=new un(t=>t),Ee=Fb("string"),Ie=Fb("number").check(t=>{if(Number.isNaN(t))throw new Ne("Expected a number, got NaN");if(!Number.isFinite(t))throw new Ne(`Expected a finite number, got ${t}`)}),Kl=Ie.check(t=>{if(t<0)throw new Ne(`Expected a positive number, got ${t}`)}),xt=Ie.check(t=>{if(t<=0)throw new Ne(`Expected a non-zero positive number, got ${t}`)}),Hj=Ie.check(t=>{if(!Number.isInteger(t))throw new Ne(`Expected an integer, got ${t}`)}),jl=Hj.check(t=>{if(t<0)throw new Ne(`Expected a positive integer, got ${t}`)}),Xz=Hj.check(t=>{if(t<=0)throw new Ne(`Expected a non-zero positive integer, got ${t}`)}),Me=Fb("boolean");function nn(t){return new un(e=>{if(e!==t)throw new Ne(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const h_=new un(t=>{if(!Array.isArray(t))throw new Ne(`Expected an array, got ${Gs(t)}`);return t});function $t(t){return new Vz(t)}function je(t){return new Gl(t)}function Ix(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null||Object.getPrototypeOf(t)===Tz)}function Px(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(Px):Ix(t)?Object.values(t).every(Px):!1}const zt=new un(t=>{if(Px(t))return t;throw new Ne(`Expected json serializable value, got ${typeof t}`)},(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let n=t.length!==e.length;for(let r=0;r<e.length;r++){if(r>=t.length){n=!0,zt.validate(e[r]);continue}const s=t[r],i=e[r];if(Object.is(s,i))continue;const o=zt.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(n=!0)}return n?e:t}else if(Ix(t)&&Ix(e)){let n=!1;for(const r of Object.keys(e)){if(!Dr(t,r)){n=!0,zt.validate(e[r]);continue}const s=t[r],i=e[r];if(Object.is(s,i))continue;const o=zt.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(n=!0)}for(const r of Object.keys(t))if(!Dr(e,r)){n=!0;break}return n?e:t}else return zt.validate(e)});function Vl(t,e){return new Wz(t,e)}function Bb(t,e){return new Md(t,e,(n,r)=>{throw new Ne(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!1)}function Zz(t,e){return new Md(t,e,(n,r)=>{throw new Ne(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!0)}function Hr(t,e){return new un(n=>En(t,()=>e.validate(n)),(n,r)=>En(t,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(n,r):e.validate(r)))}function Ad(t){return new un(e=>{if(!t.has(e)){const n=Array.from(t,r=>JSON.stringify(r)).join(" or ");throw new Ne(`Expected ${n}, got ${e}`)}return e})}function Gj(t){return new un(e=>{if(e!==void 0)return t.validate(e)},(e,n)=>{if(!(e===void 0&&n===void 0)&&n!==void 0)return t.validateUsingKnownGoodVersion&&e!==void 0?t.validateUsingKnownGoodVersion(e,n):t.validate(n)})}function Qz(t){return new un(e=>e===null?null:t.validate(e),(e,n)=>n===null?null:t.validateUsingKnownGoodVersion&&e!==null?t.validateUsingKnownGoodVersion(e,n):t.validate(n))}function jd(...t){return Ad(new Set(t))}function $b(t){try{return new URL(t)}catch{if(t.startsWith("/")||t.startsWith("./"))try{return new URL(t,"http://example.com")}catch{throw new Ne(`Expected a valid url, got ${JSON.stringify(t)}`)}throw new Ne(`Expected a valid url, got ${JSON.stringify(t)}`)}}const Jz=new Set(["http:","https:","mailto:"]),$n=Ee.check(t=>{if(t==="")return;const e=$b(t);if(!Jz.has(e.protocol.toLowerCase()))throw new Ne(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)}),e4=new Set(["http:","https:","data:","asset:"]),xi=Ee.check(t=>{if(t==="")return;const e=$b(t);if(!e4.has(e.protocol.toLowerCase()))throw new Ne(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});Ee.check(t=>{if(t==="")return;if(!$b(t).protocol.toLowerCase().match(/^https?:$/))throw new Ne(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});const zb=Ee.refine(t=>{try{return vz(t),t}catch{throw new Ne(`Expected an index key, got ${JSON.stringify(t)}`)}});function Fn(t){return Ee.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const Rd=Fn("asset");function Ub(t,e){return je({id:Rd,typeName:nn("asset"),type:nn(t),props:e,meta:zt})}const bi=je({x:Ie,y:Ie,z:Ie.optional()}),Oa=je({x:Ie,y:Ie,w:Ie,h:Ie});let Kj=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const Vj=Ie.check(t=>{if(t<0||t>1)throw new Ne("Opacity must be between 0 and 1")}),t4=Ee.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),Qn=Fn("shape");function n4(t,e,n){return je({id:Qn,typeName:nn("shape"),x:Ie,y:Ie,rotation:Ie,index:zb,parentId:t4,type:nn(t),isLocked:Me,opacity:Vj,props:e?je(e):zt,meta:n?je(n):zt})}const r4=Fn("binding");function s4(t,e,n){return je({id:r4,typeName:nn("binding"),type:nn(t),fromId:Qn,toId:Qn,props:e?je(e):zt,meta:n?je(n):zt})}Mn("com.tldraw.binding",{});qn({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Si(t){return`binding:${Kj()}`}function i4(t){return qr("binding",{scope:"document",validator:Hr("binding",Bb("type",fc(t,(e,{props:n,meta:r})=>s4(e,n,r))))}).withDefaultProperties(()=>({meta:{}}))}class Ht{constructor(e,n,r){this.id=e,this.defaultValue=n,this.type=r}static define(e,n){const{defaultValue:r,type:s=Yz}=n;return new Ht(e,r,s)}static defineEnum(e,n){const{defaultValue:r,values:s}=n;return new o4(e,r,s)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,n){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,n):this.validate(n)}}class o4 extends Ht{constructor(e,n,r){super(e,n,jd(...r)),this.values=r}}const Qc=Mn("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),a4=qn({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Qc.AddIsLocked,up:t=>{t.isLocked=!1},down:t=>{delete t.isLocked}},{id:Qc.HoistOpacity,up:t=>{t.opacity=Number(t.props.opacity??"1"),delete t.props.opacity},down:t=>{const e=t.opacity;delete t.opacity,t.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:Qc.AddMeta,up:t=>{t.meta={}}},{id:Qc.AddWhite,up:t=>{},down:t=>{t.props.color==="white"&&(t.props.color="black")}}]});function ro(t){return t?t.typeName==="shape":!1}function vn(t){return t?t.startsWith("shape:"):!1}function He(t){return`shape:${t??Kj()}`}function Wj(t){const e=new Map;for(const[n,r]of Object.entries(t))if(r instanceof Ht){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,n)}return e}function Cr(t,e){return fc(e,(n,r)=>`com.tldraw.shape.${t}/${r}`)}function c4(t){return qr("shape",{scope:"document",validator:Hr("shape",Bb("type",fc(t,(e,{props:n,meta:r})=>n4(e,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function p_(t,e){const n=[];for(const[r,{migrations:s}]of Object.entries(e)){const i=`com.tldraw.${t}.${r}`;s?"sequenceId"in s?(Ze(i===s.sequenceId,`sequenceId mismatch for ${r} ${Td} migrations. Expected '${i}', got '${s.sequenceId}'`),n.push(s)):"sequence"in s?n.push(po({sequenceId:i,retroactive:!1,sequence:s.sequence.map(o=>"id"in o?Yj(t,r,o):o)})):n.push(po({sequenceId:i,retroactive:!1,sequence:Object.keys(s.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${i}/${o}`,scope:"record",filter:a=>a.typeName===t&&a.type===r,up:a=>{const c=s.migrators[o].up(a);if(c)return c},down:a=>{const c=s.migrators[o].down(a);if(c)return c}}))})):n.push(po({sequenceId:i,retroactive:!1,sequence:[]}))}return n}function Yj(t,e,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:r=>r.typeName===t&&r.type===e,up:r=>{const s=n.up(r.props);s&&(r.props=s)},down:typeof n.down=="function"?r=>{const s=n.down(r.props);s&&(r.props=s)}:void 0}}const Xj=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],Wl={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function ms(t){return t.isDarkMode?Wl.darkMode:Wl.lightMode}const zn=Ht.defineEnum("tldraw:color",{defaultValue:"black",values:Xj}),Zj=Ht.defineEnum("tldraw:labelColor",{defaultValue:"black",values:Xj}),wi=Ht.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Ci=Ht.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Fr=Ht.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),Qj={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Br=Ht.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Jj=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Yl=Ht.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:Jj}),Xl=Ht.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:Jj}),eR={labelColor:Zj,color:zn,fill:Ci,dash:wi,size:Br,arrowheadStart:Yl,arrowheadEnd:Xl,font:Fr,start:bi,end:bi,bend:Ie,text:Ee,labelPosition:Ie,scale:xt},Qi=Cr("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Jc(t){return Yj("shape","arrow",t)}const tR=po({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Jc({id:Qi.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"}),Jc({id:Qi.AddIsPrecise,up:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Jc({id:Qi.AddLabelPosition,up:t=>{t.labelPosition=.5},down:t=>{delete t.labelPosition}}),{id:Qi.ExtractBindings,scope:"store",up:t=>{const e=Object.values(t).filter(n=>n.typeName==="shape"&&n.type==="arrow");for(const n of e){const{start:r,end:s}=n.props;if(r.type==="binding"){const i=Si(),o={typeName:"binding",id:i,type:"arrow",fromId:n.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};t[i]=o,n.props.start={x:0,y:0}}else delete n.props.start.type;if(s.type==="binding"){const i=Si(),o={typeName:"binding",id:i,type:"arrow",fromId:n.id,toId:s.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};t[i]=o,n.props.end={x:0,y:0}}else delete n.props.end.type}}},Jc({id:Qi.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}})]}),nR={terminal:jd("start","end"),normalizedAnchor:bi,isExact:Me,isPrecise:Me},rR={sequence:[{dependsOn:[Qi.ExtractBindings]}]},l4=Hr("camera",je({typeName:nn("camera"),id:Fn("camera"),x:Ie,y:Ie,z:Ie,meta:zt})),d4=Mn("com.tldraw.camera",{AddMeta:1}),u4=qn({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:d4.AddMeta,up:t=>{t.meta={}}}]}),jr=qr("camera",{validator:l4,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),h4=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),sR=Ad(h4),p4=je({type:sR,rotation:Ie}),f4=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),g4=Ad(f4),m4=new Set(["starting","paused","active","stopping"]),iR=je({id:Ee,points:$t(bi),size:Kl,color:g4,opacity:Ie,state:Ad(m4),delay:Ie,shrink:Ie,taper:Me}),Ka=Fn("page"),y4=Hr("page",je({typeName:nn("page"),id:Ka,name:Ee,index:zb,meta:zt})),S4=Mn("com.tldraw.page",{AddMeta:1}),v4=qn({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:S4.AddMeta,up:t=>{t.meta={}}}]}),ds=qr("page",{validator:y4,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function yn(t){return ds.isId(t)}const x4={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},oR=t=>t?ja(t,e=>x4[e]):null;Fn("instance");function b4(t){const e={};for(const[r,s]of t)e[r]=Gj(s);const n=Hr("instance",je({typeName:nn("instance"),id:Fn("instance"),currentPageId:Ka,followingUserId:Ee.nullable(),brush:Oa.nullable(),opacityForNextShape:Vj,stylesForNextShape:je(e),cursor:p4,scribbles:$t(iR),isFocusMode:Me,isDebugMode:Me,isToolLocked:Me,exportBackground:Me,screenBounds:Oa,insets:$t(Me),zoomBrush:Oa.nullable(),isPenMode:Me,isGridMode:Me,chatMessage:Ee,isChatting:Me,highlightedUserIds:$t(Ee),isFocused:Me,devicePixelRatio:Ie,isCoarsePointer:Me,isHoveringCanvas:Me.nullable(),openMenus:$t(Ee),isChangingStyle:Me,isReadonly:Me,meta:zt,duplicateProps:je({shapeIds:$t(Fn("shape")),offset:je({x:Ie,y:Ie})}).nullable()}));return qr("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Je=Mn("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),w4=qn({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Je.AddTransparentExportBgs,up:t=>({...t,exportBackground:!0})},{id:Je.RemoveDialog,up:({dialog:t,...e})=>e},{id:Je.AddToolLockMode,up:t=>({...t,isToolLocked:!1})},{id:Je.RemoveExtraPropsForNextShape,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))})},{id:Je.AddLabelColor,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}})},{id:Je.AddFollowingUserId,up:t=>({...t,followingUserId:null})},{id:Je.RemoveAlignJustify,up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}}},{id:Je.AddZoom,up:t=>({...t,zoomBrush:null})},{id:Je.AddVerticalAlign,up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}})},{id:Je.AddScribbleDelay,up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t}},{id:Je.RemoveUserId,up:({userId:t,...e})=>e},{id:Je.AddIsPenModeAndIsGridMode,up:t=>({...t,isPenMode:!1,isGridMode:!1})},{id:Je.HoistOpacity,up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e})},{id:Je.AddChat,up:t=>({...t,chatMessage:"",isChatting:!1})},{id:Je.AddHighlightedUserIds,up:t=>({...t,highlightedUserIds:[]})},{id:Je.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}})},{id:Je.AddMeta,up:t=>({...t,meta:{}})},{id:Je.RemoveCursorColor,up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}}},{id:Je.AddLonelyProperties,up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Je.ReadOnlyReadonly,up:({isReadOnly:t,...e})=>({...e,isReadonly:t})},{id:Je.AddHoveringCanvas,up:t=>({...t,isHoveringCanvas:null})},{id:Je.AddScribbles,up:({scribble:t,...e})=>({...e,scribbles:[]})},{id:Je.AddInset,up:t=>({...t,insets:[!1,!1,!1,!1]}),down:({insets:t,...e})=>({...e})},{id:Je.AddDuplicateProps,up:t=>({...t,duplicateProps:null}),down:({duplicateProps:t,...e})=>({...e})},{id:Je.RemoveCanMoveCamera,up:({canMoveCamera:t,...e})=>({...e}),down:t=>({...t,canMoveCamera:!0})}]}),ln="instance:instance",C4=Hr("instance_page_state",je({typeName:nn("instance_page_state"),id:Fn("instance_page_state"),pageId:Ka,selectedShapeIds:$t(Qn),hintingShapeIds:$t(Qn),erasingShapeIds:$t(Qn),hoveredShapeId:Qn.nullable(),editingShapeId:Qn.nullable(),croppingShapeId:Qn.nullable(),focusedGroupId:Qn.nullable(),meta:zt})),na=Mn("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),_4=qn({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:na.AddCroppingId,up(t){t.croppingShapeId=null}},{id:na.RemoveInstanceIdAndCameraId,up(t){delete t.instanceId,delete t.cameraId}},{id:na.AddMeta,up:t=>{t.meta={}}},{id:na.RenameProperties,up:t=>{},down:t=>{}},{id:na.RenamePropertiesAgain,up:t=>{t.selectedShapeIds=t.selectedIds,delete t.selectedIds,t.hintingShapeIds=t.hintingIds,delete t.hintingIds,t.erasingShapeIds=t.erasingIds,delete t.erasingIds,t.hoveredShapeId=t.hoveredId,delete t.hoveredId,t.editingShapeId=t.editingId,delete t.editingId,t.croppingShapeId=t.croppingShapeId??t.croppingId??null,delete t.croppingId,t.focusedGroupId=t.focusLayerId,delete t.focusLayerId},down:t=>{t.selectedIds=t.selectedShapeIds,delete t.selectedShapeIds,t.hintingIds=t.hintingShapeIds,delete t.hintingShapeIds,t.erasingIds=t.erasingShapeIds,delete t.erasingShapeIds,t.hoveredId=t.hoveredShapeId,delete t.hoveredShapeId,t.editingId=t.editingShapeId,delete t.editingShapeId,t.croppingId=t.croppingShapeId,delete t.croppingShapeId,t.focusLayerId=t.focusedGroupId,delete t.focusedGroupId}}]}),gr=qr("instance_page_state",{validator:C4,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),I4=Hr("pointer",je({typeName:nn("pointer"),id:Fn("pointer"),x:Ie,y:Ie,lastActivityTimestamp:Ie,meta:zt})),P4=Mn("com.tldraw.pointer",{AddMeta:1}),E4=qn({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:P4.AddMeta,up:t=>{t.meta={}}}]}),qb=qr("pointer",{validator:I4,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Zl=qb.createId("pointer"),k4=Hr("instance_presence",je({typeName:nn("instance_presence"),id:Fn("instance_presence"),userId:Ee,userName:Ee,lastActivityTimestamp:Ie,followingUserId:Ee.nullable(),cursor:je({x:Ie,y:Ie,type:sR,rotation:Ie}),color:Ee,camera:je({x:Ie,y:Ie,z:Ie}),screenBounds:Oa,selectedShapeIds:$t(Fn("shape")),currentPageId:Fn("page"),brush:Oa.nullable(),scribbles:$t(iR),chatMessage:Ee,meta:zt})),ra=Mn("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),T4=qn({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:ra.AddScribbleDelay,up:t=>{t.scribble!==null&&(t.scribble.delay=0)}},{id:ra.RemoveInstanceId,up:t=>{delete t.instanceId}},{id:ra.AddChatMessage,up:t=>{t.chatMessage=""}},{id:ra.AddMeta,up:t=>{t.meta={}}},{id:ra.RenameSelectedShapeIds,up:t=>{}}]}),M4=qr("instance_presence",{validator:k4,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),A4=Hr("document",je({typeName:nn("document"),id:nn("document:document"),gridSize:Ie,name:Ee,meta:zt})),f_=Mn("com.tldraw.document",{AddName:1,AddMeta:2}),j4=qn({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:f_.AddName,up:t=>{t.name=""},down:t=>{delete t.name}},{id:f_.AddMeta,up:t=>{t.meta={}}}]}),Hb=qr("document",{validator:A4,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),Ex=Hb.createId("document");function R4(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function g_(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}const O4=({error:t,phase:e,record:n,recordBefore:r})=>{throw Tb(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?g_(Ye(r)):void 0,recordAfter:g_(Ye(n))}}),t};function D4(){return[ds.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function L4(t){const e=t.query.ids("page"),n=()=>{if(!t.has(Ex))return t.put([Hb.create({id:Ex,name:t.props.defaultName})]),n();if(!t.has(Zl))return t.put([qb.create({id:Zl})]),n();const r=e.get();if(r.size===0)return t.put(D4()),n();const s=()=>[...r].map(c=>t.get(c)).sort(R4)[0].id,i=t.get(ln);if(i){if(!r.has(i.currentPageId))return t.put([{...i,currentPageId:s()}]),n()}else return t.put([t.schema.types.instance.create({id:ln,currentPageId:s(),exportBackground:!0})]),n();const o=new Set,a=new Set;for(const c of r){const l=gr.createId(c);t.has(l)||o.add(l);const d=jr.createId(c);t.has(d)||a.add(d)}o.size>0&&t.put([...o].map(c=>gr.create({id:c,pageId:gr.parseId(c)}))),a.size>0&&t.put([...a].map(c=>jr.create({id:c})))};return n}const N4=Ub("bookmark",je({title:Ee,description:Ee,image:Ee,favicon:Ee,src:xi.nullable()})),m_=Mn("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),F4=qn({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:t=>t.type==="bookmark",sequence:[{id:m_.MakeUrlsValid,up:t=>{xi.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:m_.AddFavicon,up:t=>{xi.isValid(t.props.favicon)||(t.props.favicon="")},down:t=>{delete t.props.favicon}}]}),B4=Ub("image",je({w:Ie,h:Ie,name:Ee,isAnimated:Me,mimeType:Ee.nullable(),src:xi.nullable(),fileSize:xt.optional()})),sa=Mn("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),$4=qn({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:t=>t.type==="image",sequence:[{id:sa.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:sa.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:sa.MakeUrlsValid,up:t=>{xi.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:sa.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:sa.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),z4=Ub("video",je({w:Ie,h:Ie,name:Ee,isAnimated:Me,mimeType:Ee.nullable(),src:xi.nullable(),fileSize:Ie.optional()})),ia=Mn("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),U4=qn({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:t=>t.type==="video",sequence:[{id:ia.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:ia.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:ia.MakeUrlsValid,up:t=>{xi.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:ia.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:ia.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),q4=Hr("asset",Bb("type",{image:B4,video:z4,bookmark:N4})),H4=Mn("com.tldraw.asset",{AddMeta:1}),G4=qn({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:H4.AddMeta,up:t=>{t.meta={}}}]}),fi=qr("asset",{validator:q4,scope:"document"}).withDefaultProperties(()=>({meta:{}})),aR={w:xt,h:xt,assetId:Rd.nullable(),url:$n},y_=Cr("bookmark",{NullAssetId:1,MakeUrlsValid:2}),cR={sequence:[{id:y_.NullAssetId,up:t=>{t.assetId===void 0&&(t.assetId=null)},down:"retired"},{id:y_.MakeUrlsValid,up:t=>{$n.isValid(t.url)||(t.url="")},down:t=>{}}]},lR=je({type:jd("free","straight"),points:$t(bi)}),dR={color:zn,fill:Ci,dash:wi,size:Br,segments:$t(lR),isComplete:Me,isClosed:Me,isPen:Me,scale:xt},S_=Cr("draw",{AddInPen:1,AddScale:2}),uR={sequence:[{id:S_.AddInPen,up:t=>{const{points:e}=t.segments[0];if(e.length===0){t.isPen=!1;return}let n=!(e[0].z===0||e[0].z===.5);e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),t.isPen=n},down:"retired"},{id:S_.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]};var K4={};const v_=/(^\/r\/[^/]+\/?$)/,ze=t=>{try{return new URL(t)}catch{return}},gc=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(v_))return t},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(v_))return t}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:t=>{if(t.includes("/maps/")){const e=t.match(/@(.*),(.*),(.*)z/);let n;if(e){const[,r,s,i]=e;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${K4.NEXT_PUBLIC_GC_API_KEY}&center=${r},${s}&zoom=${i}`}else n="";return n}},fromEmbedUrl:t=>{const e=ze(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[s,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${i},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ze(t),n=e&&e.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ze(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ze(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ze(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[r,s,i]=n;return`https://codepen.io/${s}/embed/${i}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,s,i]=n;return`https://codepen.io/${s}/pen/${i}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[r,s]=n;return`https://scratch.mit.edu/projects/embed/${s}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,s]=n;return`https://scratch.mit.edu/projects/${s}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ze(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:t=>{const e=ze(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=ze(t),n=e?.searchParams.get("cid");if(e?.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=ze(t),n=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=ze(t);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/pub\/?$/)){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}},fromEmbedUrl:t=>{const e=ze(t);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:t=>{const e=ze(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${t}?embed`},fromEmbedUrl:t=>{const e=ze(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],V4={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},hR={w:xt,h:xt,url:Ee},el=Cr("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),pR={sequence:[{id:el.GenOriginalUrlInEmbed,up:t=>{try{const e=t.url,n=new URL(e).host.replace("www.","");let r;for(const s of gc)if(s.hostnames.includes(n))try{r=s.fromEmbedUrl(e)}catch(i){console.warn(i)}t.tmpOldUrl=t.url,t.url=r??""}catch{t.url="",t.tmpOldUrl=t.url}},down:"retired"},{id:el.RemoveDoesResize,up:t=>{delete t.doesResize},down:"retired"},{id:el.RemoveTmpOldUrl,up:t=>{delete t.tmpOldUrl},down:"retired"},{id:el.RemovePermissionOverrides,up:t=>{delete t.overridePermissions},down:"retired"}]},fR={w:xt,h:xt,name:Ee},gR={sequence:[]},Ql=Ht.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Jl=Ht.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),mr=Ht.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),mR={geo:mr,labelColor:Zj,color:zn,fill:Ci,dash:wi,size:Br,font:Fr,align:Ql,verticalAlign:Jl,url:$n,w:xt,h:xt,growY:Kl,text:Ee,scale:xt},Zr=Cr("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),yR={sequence:[{id:Zr.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Zr.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"},{id:Zr.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Zr.AddCheckBox,up:t=>{},down:"retired"},{id:Zr.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Zr.MigrateLegacyAlign,up:t=>{let e;switch(t.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}t.align=e},down:"retired"},{id:Zr.AddCloud,up:t=>{},down:"retired"},{id:Zr.MakeUrlsValid,up:t=>{$n.isValid(t.url)||(t.url="")},down:t=>{}},{id:Zr.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},SR={},vR={sequence:[]},xR={color:zn,size:Br,segments:$t(lR),isComplete:Me,isPen:Me,scale:xt},W4=Cr("highlight",{AddScale:1}),bR={sequence:[{id:W4.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},Y4=je({topLeft:bi,bottomRight:bi}),wR={w:xt,h:xt,playing:Me,url:$n,assetId:Rd.nullable(),crop:Y4.nullable(),flipX:Me,flipY:Me},tl=Cr("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),CR={sequence:[{id:tl.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:tl.AddCropProp,up:t=>{t.crop=null},down:t=>{delete t.crop}},{id:tl.MakeUrlsValid,up:t=>{$n.isValid(t.url)||(t.url="")},down:t=>{}},{id:tl.AddFlipProps,up:t=>{t.flipX=!1,t.flipY=!1},down:t=>{delete t.flipX,delete t.flipY}}]},ed=Ht.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),X4=je({id:Ee,index:zb,x:Ie,y:Ie}),_R={color:zn,dash:wi,size:Br,spline:ed,points:Vl(Ee,X4),scale:xt},oa=Cr("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),IR={sequence:[{id:oa.AddSnapHandles,up:t=>{for(const e of Object.values(t.handles))e.canSnap=!0},down:"retired"},{id:oa.RemoveExtraHandleProps,up:t=>{t.handles=Ej(Object.values(t.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:t=>{const e=Object.entries(t.handles).map(([n,r])=>({index:n,...r})).sort(en);t.handles=Object.fromEntries(e.map((n,r)=>{const s=r===0?"start":r===e.length-1?"end":`handle:${n.index}`;return[s,{id:s,type:"vertex",canBind:!1,canSnap:!0,index:n.index,x:n.x,y:n.y}]}))}},{id:oa.HandlesToPoints,up:t=>{const e=Object.entries(t.handles).map(([n,{x:r,y:s}])=>({x:r,y:s,index:n})).sort(en);t.points=e.map(({x:n,y:r})=>({x:n,y:r})),delete t.handles},down:t=>{const e=Ga(t.points.length);t.handles=Object.fromEntries(t.points.map((n,r)=>[e[r],{x:n.x,y:n.y}])),delete t.points}},{id:oa.PointIndexIds,up:t=>{const e=Ga(t.points.length);t.points=Object.fromEntries(t.points.map((n,r)=>{const s=e[r];return[s,{id:s,index:s,x:n.x,y:n.y}]}))},down:t=>{const e=Object.values(t.points).sort(en);t.points=e.map(({x:n,y:r})=>({x:n,y:r}))}},{id:oa.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},PR={color:zn,size:Br,font:Fr,fontSizeAdjustment:Kl,align:Ql,verticalAlign:Jl,growY:Kl,url:$n,text:Ee,scale:xt},ui=Cr("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),ER={sequence:[{id:ui.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:ui.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:ui.MigrateLegacyAlign,up:t=>{switch(t.align){case"start":t.align="start-legacy";return;case"end":t.align="end-legacy";return;default:t.align="middle-legacy";return}},down:"retired"},{id:ui.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:ui.MakeUrlsValid,up:t=>{$n.isValid(t.url)||(t.url="")},down:t=>{}},{id:ui.AddFontSizeAdjustment,up:t=>{t.fontSizeAdjustment=0},down:t=>{delete t.fontSizeAdjustment}},{id:ui.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},kx=Ht.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),kR={color:zn,size:Br,font:Fr,textAlign:kx,w:xt,text:Ee,scale:xt,autoSize:Me},x_=Cr("text",{RemoveJustify:1,AddTextAlign:2}),TR={sequence:[{id:x_.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:x_.AddTextAlign,up:t=>{t.textAlign=t.align,delete t.align},down:t=>{t.align=t.textAlign,delete t.textAlign}}]},MR={w:xt,h:xt,time:Ie,playing:Me,url:$n,assetId:Rd.nullable()},b_=Cr("video",{AddUrlProp:1,MakeUrlsValid:2}),AR={sequence:[{id:b_.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:b_.MakeUrlsValid,up:t=>{$n.isValid(t.url)||(t.url="")},down:t=>{}}]},nl=Mn("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),Z4=po({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:nl.RemoveCodeAndIconShapeTypes,scope:"store",up:t=>{for(const[e,n]of Pn(t))n.typeName==="shape"&&(n.type==="icon"||n.type==="code")&&delete t[e]}},{id:nl.AddInstancePresenceType,scope:"store",up(t){}},{id:nl.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:t=>{for(const[e,n]of Pn(t))n.typeName.match(/^(user|user_presence)$/)&&delete t[e]}},{id:nl.RemoveUserDocument,scope:"store",up:t=>{for(const[e,n]of Pn(t))n.typeName.match("user_document")&&delete t[e]}}]}),Q4={arrow:{migrations:tR,props:eR},bookmark:{migrations:cR,props:aR},draw:{migrations:uR,props:dR},embed:{migrations:pR,props:hR},frame:{migrations:gR,props:fR},geo:{migrations:yR,props:mR},group:{migrations:vR,props:SR},highlight:{migrations:bR,props:xR},image:{migrations:CR,props:wR},line:{migrations:IR,props:_R},note:{migrations:ER,props:PR},text:{migrations:TR,props:kR},video:{migrations:AR,props:MR}},J4={arrow:{migrations:rR,props:nR}};function e6({shapes:t=Q4,bindings:e=J4,migrations:n}={}){const r=new Map;for(const a of ft(t))for(const c of Wj(a.props??{}).keys()){if(r.has(c.id)&&r.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);r.set(c.id,c)}const s=c4(t),i=i4(e),o=b4(r);return Nb.create({asset:fi,binding:i,camera:jr,document:Hb,instance:o,instance_page_state:gr,page:ds,instance_presence:M4,pointer:qb,shape:s},{migrations:[Z4,G4,u4,j4,w4,_4,v4,T4,E4,a4,F4,$4,U4,...p_("shape",t),...p_("binding",e),...n??[]],onValidationFailure:O4,createIntegrityChecker:L4})}const Va=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenščina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"עברית"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ku",label:"کوردی"},{locale:"ne",label:"नेपाली"},{locale:"hi-in",label:"हिन्दी"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"my",label:"မြန်မာစာ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function t6(){const t=typeof window<"u"?window.navigator.languages??["en"]:["en"];return n6(t)}function n6(t){for(const e of t){const n=r6(e);if(n)return n}return"en"}const w_={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function r6(t){const e=Va.find(s=>s.locale===t.toLowerCase());if(e)return e.locale;const[n,r]=t.split(/[-_]/).map(s=>s.toLowerCase());if(r){const s=Va.find(i=>i.locale===n);if(s)return s.locale}return n in w_?w_[n]:null}function Od(t,e){const n=qe.useRef(e);n.current=e;const[r,s,i]=qe.useMemo(()=>{let o=null;const a=d=>(o=d,()=>{o=null}),c=new Do(`useStateTracking(${t})`,()=>n.current?.(),{scheduleEffect(){o?.()}});return[c,a,()=>c.scheduleCount]},[t]);return qe.useSyncExternalStore(s,i,i),qe.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const C_={apply(t,e,n){return Od(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},s6=Symbol.for("react.memo"),i6=Symbol.for("react.forward_ref");function Ot(t){let e=null;const n=t.$$typeof;return n===s6&&(t=t.type,e=t.compare),n===i6?_.memo(_.forwardRef(new Proxy(t.render,C_))):_.memo(new Proxy(t,C_),e)}function o6(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return _.useMemo(()=>J(`useComputed(${t})`,e,n),r)}function Bs(t,e,n=os){_.useEffect(()=>{const r=new Do(t,e);return r.attach(),r.execute(),()=>{r.detach()}},n)}function X(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,r=_.useRef(!0);r.current=!0;const s=_.useMemo(()=>t.length===1?t[0]:J(n,()=>{if(r.current)return t[1]();try{return t[1]()}catch{return{}}}),e);try{const{subscribe:i,getSnapshot:o}=_.useMemo(()=>({subscribe:a=>Oi(`useValue(${n})`,()=>{s.get(),a()}),getSnapshot:()=>s.get()}),[s]);return _.useSyncExternalStore(i,o,o)}finally{r.current=!1}}var pf={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var __;function a6(){return __||(__=1,(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var i="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(i=s(i,r(a)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return n.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var o="";for(var a in i)e.call(i,a)&&i[a]&&(o=s(o,a));return o}function s(i,o){return o?i?i+" "+o:i+o:i}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(pf)),pf.exports}var c6=a6();const be=Ws(c6),jR="2.4.6",I_={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z"},l6={error:null};class RR extends _.Component{static getDerivedStateFromError(e){return{error:e}}state=l6;componentDidCatch(e){this.props.onError?.(e)}render(){const{error:e}=this.state;if(e!==null){const{fallback:n}=this.props;return h.jsx(n,{error:e})}return this.props.children}}function Wa({children:t,fallback:e,...n}){return e===null?t:h.jsx(RR,{fallback:e,...n,children:t})}const Dd=_.createContext(null);function K(){const t=qe.useContext(Dd);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function d6(){return h.jsx("div",{className:"tl-background"})}function Lo(t,e,n,r,s,i){_.useLayoutEffect(()=>{const o=t.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),s!==void 0&&(a+=` rotate(${s}rad)`),i&&(a+=` translate(${i.x}px, ${i.y}px)`),o.style.transform=a})}const Mt={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class w{constructor(e=0,n=0,r=1){this.x=e,this.y=n,this.z=r}get pressure(){return this.z}set(e=this.x,n=this.y,r=this.z){return this.x=e,this.y=n,this.z=r,this}setTo({x:e=0,y:n=0,z:r=1}){return this.x=e,this.y=n,this.z=r,this}rot(e){if(e===0)return this;const{x:n,y:r}=this,s=Math.sin(e),i=Math.cos(e);return this.x=n*i-r*s,this.y=n*s+r*i,this}rotWith(e,n){if(n===0)return this;const r=this.x-e.x,s=this.y-e.y,i=Math.sin(n),o=Math.cos(n);return this.x=e.x+(r*o-s*i),this.y=e.y+(r*i+s*o),this}clone(){const{x:e,y:n,z:r}=this;return new w(e,n,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const r=w.Tan(e,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return w.Dpr(this,e)}cpr(e){return w.Cpr(this,e)}len2(){return w.Len2(this)}len(){return w.Len(this)}pry(e){return w.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){return w.Uni(this)}tan(e){return w.Tan(this,e)}dist(e){return w.Dist(this,e)}distanceToLineSegment(e,n){return w.DistanceToLineSegment(e,n,this)}slope(e){return w.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return w.Angle(this,e)}toAngle(){return w.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return w.Equals(this,e)}equalsXY(e,n){return w.EqualsXY(this,e,n)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return w.ToFixed(this)}toString(){return w.ToString(w.ToFixed(this))}toJson(){return w.ToJson(this)}toArray(){return w.ToArray(this)}static Add(e,n){return new w(e.x+n.x,e.y+n.y)}static AddXY(e,n,r){return new w(e.x+n,e.y+r)}static Sub(e,n){return new w(e.x-n.x,e.y-n.y)}static SubXY(e,n,r){return new w(e.x-n,e.y-r)}static AddScalar(e,n){return new w(e.x+n,e.y+n)}static SubScalar(e,n){return new w(e.x-n,e.y-n)}static Div(e,n){return new w(e.x/n,e.y/n)}static Mul(e,n){return new w(e.x*n,e.y*n)}static DivV(e,n){return new w(e.x/n.x,e.y/n.y)}static MulV(e,n){return new w(e.x*n.x,e.y*n.y)}static Neg(e){return new w(-e.x,-e.y)}static Per(e){return new w(e.y,-e.x)}static Abs(e){return new w(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return((e.y-n.y)**2+(e.x-n.x)**2)**.5}static DistMin(e,n,r){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)<r**2}static Dist2(e,n){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new w(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,n){return w.Dpr(e,n)/w.Len(n)}static Uni(e){return w.Div(e,w.Len(e))}static Tan(e,n){return w.Uni(w.Sub(e,n))}static Min(e,n){return new w(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new w(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:r=1}){return new w(e,n,r)}static FromArray(e){return new w(e[0],e[1])}static Rot(e,n=0){const r=Math.sin(n),s=Math.cos(n);return new w(e.x*s-e.y*r,e.x*r+e.y*s)}static RotWith(e,n,r){const s=e.x-n.x,i=e.y-n.y,o=Math.sin(r),a=Math.cos(r);return new w(n.x+(s*a-i*o),n.y+(s*o+i*a))}static NearestPointOnLineThroughPoint(e,n,r){return w.Mul(n,w.Sub(r,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,r,s=!0){if(w.Equals(e,r)||w.Equals(n,r))return w.From(r);const i=w.Tan(n,e),o=w.Add(e,w.Mul(i,w.Sub(r,e).pry(i)));if(s){if(o.x<Math.min(e.x,n.x))return w.Cast(e.x<n.x?e:n);if(o.x>Math.max(e.x,n.x))return w.Cast(e.x>n.x?e:n);if(o.y<Math.min(e.y,n.y))return w.Cast(e.y<n.y?e:n);if(o.y>Math.max(e.y,n.y))return w.Cast(e.y>n.y?e:n)}return o}static DistanceToLineThroughPoint(e,n,r){return w.Dist(r,w.NearestPointOnLineThroughPoint(e,n,r))}static DistanceToLineSegment(e,n,r,s=!0){return w.Dist(r,w.NearestPointOnLineSegment(e,n,r,s))}static Snap(e,n=1){return new w(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof w?e:w.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static Lrp(e,n,r){return w.Sub(n,e).mul(r).add(e)}static Med(e,n){return new w((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,r){return e.x===n&&e.y===r}static Clockwise(e,n,r){return(r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y)<0}static Rescale(e,n){const r=w.Len(e);return new w(n*e.x/r,n*e.y/r)}static ScaleWithOrigin(e,n,r){return w.Sub(e,r).mul(n).add(r)}static ToFixed(e){return new w(ns(e.x),ns(e.y))}static ToInt(e){return new w(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,n,r){return w.Add(e,w.Tan(n,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new w(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:r,z:s}=e;return{x:n,y:r,z:s}}static Average(e){const n=e.length,r=new w(0,0);if(n===0)return r;for(let s=0;s<n;s++)r.add(e[s]);return r.div(n)}static Clamp(e,n,r){return r===void 0?new w(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new w(Math.min(Math.max(e.x,n),r),Math.min(Math.max(e.y,n),r))}static PointsBetween(e,n,r=6){const s=[];for(let i=0;i<r;i++){const o=Mt.easeInQuad(i/(r-1)),a=w.Lrp(e,n,o);a.z=Math.min(1,.5+Math.abs(.5-u6(o))*.65),s.push(a)}return s}static SnapToGrid(e,n=8){return new w(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const u6=t=>t<.5?2*t*t:-1+(4-2*t)*t;function Be(t){return`${G(t.x)},${G(t.y)} `}function bn(t,e){return`${G((t.x+e.x)/2)},${G((t.y+e.y)/2)} `}const $e=Math.PI,Xe=$e/2,Ue=$e*2,h6=Math.sin;function Et(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function rl(t,e=1e10){return t?Math.round(t*e)/e:0}function $s(t,e,n=1e-6){return Math.abs(t-e)<=n}function OR(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return $e*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function zs(t){return t=t%Ue,t<0?t=t+Ue:t===0&&(t=0),t}function mc(t,e){return t=zs(t),e=zs(e),t>e&&(e+=Ue),e-t}function DR(t,e){return Ue-mc(t,e)}function Rl(t,e){const n=(e-t)%Ue;return 2*n%Ue-n}function Tx(t){return(Ue+t)%Ue}function td(t,e){const n=Ue/e;let r=Math.floor((Tx(t)+n/2)/n)*n%Ue;return r<$e&&(r+=Ue),r>$e&&(r-=Ue),r}function LR(t,e){return t===e||$s(t%(Math.PI/2)-e%(Math.PI/2),0)}function p6(t){return t*$e/180}function f6(t){return t*180/$e}function _i(t,e,n){return new w(t.x,t.y).add(w.FromAngle(n,e))}function ff(t,e,n){const r=t/2,s=e/2,i=[];let o=1/0,a=-1/0,c=1/0,l=-1/0;for(let m=0;m<n;m++){const y=Ue/n,S=-Xe+m*y,g=r+r*Math.cos(S),v=s+s*Math.sin(S);g<o&&(o=g),v<c&&(c=v),g>a&&(a=g),v>l&&(l=v),i.push(new w(g,v))}const d=a-o,u=l-c,p=t-d,f=e-u;if(p!==0||f!==0)for(let m=0;m<i.length;m++){const y=i[m];y.x=(y.x-o)/d*t,y.y=(y.y-c)/u*e}return i}function aa(t,e,n,r){return t<r&&n<e}function pr(t,e,n,r){const s=Math.max(t,n),i=Math.min(e,r);return s<=i?[s,i]:null}function P_(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function Bn(t,e){let n=0,r,s;for(let i=0;i<e.length;i++){if(r=e[i],r.x===t.x&&r.y===t.y||(s=e[(i+1)%e.length],w.Dist(t,r)+w.Dist(t,s)===w.Dist(r,s)))return!0;r.y<=t.y?s.y>t.y&&P_(r,s,t)>0&&(n+=1):s.y<=t.y&&P_(r,s,t)<0&&(n-=1)}return n!==0}function G(t){return Math.round(t*1e4)/1e4}function ns(t){return Math.round(t*100)/100}const E_=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER;function As(t,e,n){return n<0?mc(t,e):DR(t,e)}function Mx(t,e,n,r){let s;if(Math.abs(t)>$e){s=Rl(e,r);const i=Rl(r,n);return Math.abs(s)<Math.abs(i)?s/t:(t-i)/t}else{s=Rl(e,r);const i=s/t;return Math.sign(s)!==Math.sign(t)?Math.abs(i)>.5?1:0:i}}function g6(t,e,n,r){const s=2*((e-t)%Ue)%Ue-(e-t)%Ue;return r?(Ue-Math.abs(s))*(n?1:-1):s}function Gb(t,e,n){const r=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y);return new w(((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/r,((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/r)}function m6(t,e,n,r,s){if(n===null)return[w.From(t),w.From(e)];const i=[],o=w.Angle(n,t),a=w.Angle(n,e),c=mc(o,a);for(let l=0;l<s;l++){const d=l/(s-1),u=o+c*d,p=_i(n,r,u);i.push(p)}return i}const gf=({brush:t,color:e,opacity:n,className:r})=>{const s=_.useRef(null);Lo(s,t.x,t.y);const i=G(Math.max(1,t.w)),o=G(Math.max(1,t.h));return h.jsx("svg",{className:"tl-overlays__item",ref:s,children:e?h.jsxs("g",{className:"tl-brush",opacity:n,children:[h.jsx("rect",{width:i,height:o,fill:e,opacity:.75}),h.jsx("rect",{width:i,height:o,fill:"none",stroke:e,opacity:.1})]}):h.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:i,height:o})})},k_={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},mf={duration:0,easing:Mt.easeInOutCubic},T_={CAMERA_MOVE:-10},y6=["top","right","bottom","left"],M_=0,Kb=2,sl=1,A_=5,S6=128;function nd(t){if(t instanceof HTMLElement)return t;if(t.parentElement)return nd(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Le(t){t.preventDefault(),yt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",t)}function yc(t,e){if(t.setPointerCapture(e.pointerId),yt.logPointerCaptures.get()){const n=Bj.get();n.set(t,(n.get(t)??0)+1),console.warn("setPointerCapture called on element:",t,e)}}function Sc(t,e){if(t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),yt.logPointerCaptures.get())){const n=Bj.get();n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",t,e)}}const jt=t=>t.stopPropagation(),Xt=(t,e,n)=>{t&&t.style.setProperty(e,n)};function _n(t){return t.isKilled=!0,{point:{x:t.clientX,y:t.clientY,z:t.pressure},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:t.pointerId,button:t.button,isPen:t.pointerType==="pen"}}function NR(){const t=K();return _.useMemo(function(){let r,s;function i(y){if(!y.isKilled){if(y.button===Kb){t.dispatch({type:"pointer",target:"canvas",name:"right_click",..._n(y)});return}y.button!==0&&y.button!==1&&y.button!==5||(yc(y.currentTarget,y),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",..._n(y)}))}}function o(y){y.isKilled||y.clientX===r&&y.clientY===s||(r=y.clientX,s=y.clientY,t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",..._n(y)}))}function a(y){y.isKilled||y.button!==0&&y.button!==1&&y.button!==2&&y.button!==5||(r=y.clientX,s=y.clientY,Sc(y.currentTarget,y),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",..._n(y)}))}function c(y){if(y.isKilled||t.getInstanceState().isPenMode&&y.pointerType!=="pen")return;const S=y.pointerType==="mouse"||y.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:S?!0:null})}function l(y){if(y.isKilled||t.getInstanceState().isPenMode&&y.pointerType!=="pen")return;const S=y.pointerType==="mouse"||y.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:S?!1:null})}function d(y){y.isKilled=!0,Le(y)}function u(y){y.isKilled=!0,y.target instanceof HTMLElement&&y.target.tagName!=="A"&&y.target.tagName!=="TEXTAREA"&&!(t.getEditingShape()&&y.target.className.includes("tl-text-content"))&&Le(y)}function p(y){Le(y)}async function f(y){if(Le(y),!y.dataTransfer?.files?.length)return;const S=Array.from(y.dataTransfer.files);await t.putExternalContent({type:"files",files:S,point:t.screenToPage({x:y.clientX,y:y.clientY}),ignoreParent:!1})}function m(y){jt(y)}return{onPointerDown:i,onPointerMove:o,onPointerUp:a,onPointerEnter:c,onPointerLeave:l,onDragOver:p,onDrop:f,onTouchStart:d,onTouchEnd:u,onClick:m}},[t])}function v6(){const t=K();_.useEffect(()=>{let e=t.getInstanceState().isCoarsePointer;const n=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,t.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",n,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),s=t.environment.isFirefox&&!t.environment.isAndroid&&!t.environment.isIos,i=()=>{const o=s?!1:r.matches;e===o&&(e=o,t.updateInstanceState({isCoarsePointer:o}))};return r&&(r.addEventListener("change",i),i()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),r&&r.removeEventListener("change",i)}},[t])}const FR=_.createContext(null);function x6({container:t,children:e}){return h.jsx(FR.Provider,{value:t,children:e})}function Dt(){return er(_.useContext(FR),"useContainer used outside of <Tldraw />")}function b6(){const t=K(),e=Dt(),n=X("isFocused",()=>t.getIsFocused(),[t]);_.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const s=()=>{r?.();const i=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(i),a=c=>{c.type==="change"&&s()};o.addEventListener?o.addEventListener("change",s):o.addListener&&o.addListener(a),r=()=>{o.removeEventListener?o.removeEventListener("change",s):o.removeListener&&o.removeListener(a)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{r?.()}},[t]),_.useEffect(()=>{if(!n)return;const r=a=>{if(a.altKey&&(t.isIn("zoom")||!t.getPath().endsWith(".idle"))&&!il()&&Le(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Le(a);return}break}case"Tab":{if(il()||t.getIsMenuOpen())return;break}case",":return;case"Escape":{if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&a.preventDefault(),t.getOpenMenus().length>0)return;t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),t.focus());return}default:if(il()||t.getIsMenuOpen())return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};t.dispatch(c)},s=a=>{if(a.isKilled||(a.isKilled=!0,il()||t.getIsMenuOpen())||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};t.dispatch(c)};function i(a){if(e.contains(a.target)){const c=a.touches[0].pageX,l=a.touches[0].radiusX||0;(c-l<10||c+l>t.getViewportScreenBounds().width-10)&&(a.target?.tagName==="BUTTON"&&a.target?.click(),Le(a))}}const o=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Le(a)};return e.addEventListener("touchstart",i,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",Le),document.addEventListener("gesturechange",Le),document.addEventListener("gestureend",Le),e.addEventListener("keydown",r),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",i),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",Le),document.removeEventListener("gesturechange",Le),document.removeEventListener("gestureend",Le),e.removeEventListener("keydown",r),e.removeEventListener("keyup",s)}},[t,e,n])}const w6=["input","select","button","textarea"];function il(){const{activeElement:t}=document;return!!(t&&(t.getAttribute("contenteditable")||w6.indexOf(t.tagName.toLowerCase())>-1))}const C6=["textarea","input"];function _6(t){const e=K();_.useEffect(()=>{const n=t.current;if(!n)return;const r=s=>{if(s instanceof PointerEvent&&s.pointerType==="pen"){s.isKilled=!0;const{target:i}=s;if(C6.includes(i.tagName?.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Le(s)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[e,t])}function I6(t,e,n){return Math.max(e,Math.min(t,n))}const Ut={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function j_(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function R_(t,e,n,r=.15){return r===0?I6(t,e,n):t<e?-j_(e-t,n-e,r)+e:t>n?+j_(t-n,n-e,r)+n:t}function P6(t,[e,n],[r,s]){const[[i,o],[a,c]]=t;return[R_(e,i,o,r),R_(n,a,c,s)]}function E6(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function k6(t){var e=E6(t,"string");return typeof e=="symbol"?e:String(e)}function Qt(t,e,n){return e=k6(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function dt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O_(Object(n),!0).forEach(function(r){Qt(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O_(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const BR={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function D_(t){return t?t[0].toUpperCase()+t.slice(1):""}const T6=["enter","leave"];function M6(t=!1,e){return t&&!T6.includes(e)}function A6(t,e="",n=!1){const r=BR[t],s=r&&r[e]||e;return"on"+D_(t)+D_(s)+(M6(n,s)?"Capture":"")}const j6=["gotpointercapture","lostpointercapture"];function R6(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=j6.includes(e)?"capturecapture":"capture",s=!!~e.indexOf(r);return s&&(e=e.replace("capture","")),{device:e,capture:s,passive:n}}function O6(t,e=""){const n=BR[t],r=n&&n[e]||e;return t+r}function $R(t){return"touches"in t}function D6(t){return $R(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function L6(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function Ax(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,s=(e.clientX+t.clientX)/2,i=(e.clientY+t.clientY)/2,o=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:o,origin:[s,i]}}catch{}return null}function N6(t){return L6(t).map(e=>e.identifier)}function L_(t,e){const[n,r]=Array.from(t.touches).filter(s=>e.includes(s.identifier));return Ax(n,r)}const N_=40,F_=800;function zR(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return r===1?(e*=N_,n*=N_):r===2&&(e*=F_,n*=F_),[e,n]}function F6(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:s,ctrlKey:i}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:s,ctrlKey:i})}return e}function rd(t,...e){return typeof t=="function"?t(...e):t}function B6(){}function $6(...t){return t.length===0?B6:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function B_(t,e){return Object.assign({},e,t||{})}const z6=32;class UR{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:s}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?rd(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:s}=this;n.args=this.args;let i=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,F6(e)),s.down=s.pressed=s.buttons%2===1||s.touches>0,i=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const I=n._delta.map(Math.abs);Ut.addTo(n._distance,I)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[c,l]=r.threshold,{_step:d,values:u}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&u[0]),d[1]===!1&&(d[1]=Math.abs(a)>=l&&u[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const p=[0,0];if(r.hasCustomTransform){const[I,C]=u;p[0]=d[0]!==!1?I-d[0]:0,p[1]=d[1]!==!1?C-d[1]:0}else p[0]=d[0]!==!1?o-d[0]:0,p[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(p);const f=n.offset,m=n._active&&!n._blocked||n.active;m&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=s[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=rd(r.bounds,n)),this.setup&&this.setup()),n.movement=p,this.computeOffset()));const[y,S]=n.offset,[[g,v],[x,b]]=n._bounds;n.overflow=[y<g?-1:y>v?1:0,S<x?-1:S>b?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const E=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=P6(n._bounds,n.offset,E),n.delta=Ut.sub(n.offset,f),this.computeMovement(),m&&(!n.last||i>z6)){n.delta=Ut.sub(n.offset,f);const I=n.delta.map(Math.abs);Ut.addTo(n.distance,I),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&i>0&&(n.velocity=[I[0]/i,I[1]/i],n.timeDelta=i)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const s=this.handler(dt(dt(dt({},n),e),{},{[this.aliasKey]:e.values}));s!==void 0&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function U6([t,e],n){const r=Math.abs(t),s=Math.abs(e);if(r>s&&r>n)return"x";if(s>r&&s>n)return"y"}class q6 extends UR{constructor(...e){super(...e),Qt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Ut.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Ut.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const s=typeof r.axisThreshold=="object"?r.axisThreshold[D6(e)]:r.axisThreshold;n.axis=U6(n._movement,s)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const H6=t=>t,$_=.15,qR={enabled(t=!0){return t},eventOptions(t,e,n){return dt(dt({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[$_,$_];case!1:return[0,0];default:return Ut.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return Ut.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||H6},threshold(t){return Ut.toVector(t,0)}},G6=0,vc=dt(dt({},qR),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=G6){return t},bounds(t={}){if(typeof t=="function")return i=>vc.bounds(t(i));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:s=1/0}=t;return[[e,n],[r,s]]}}),xc=typeof window<"u"&&window.document&&window.document.createElement;function HR(){return xc&&"ontouchstart"in window}function K6(){return HR()||xc&&window.navigator.maxTouchPoints>1}function V6(){return xc&&"onpointerdown"in window}function W6(){return xc&&"exitPointerLock"in window.document}function Y6(){try{return"constructor"in GestureEvent}catch{return!1}}const tr={isBrowser:xc,gesture:Y6(),touch:HR(),touchscreen:K6(),pointer:V6(),pointerLock:W6()},X6=250,Z6=180,Q6=.5,J6=50,eU=250,tU=10,z_={mouse:0,touch:0,pen:8};dt(dt({},vc),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:s=!1}={}}){return this.pointerLock=r&&tr.pointerLock,tr.touch&&n?"touch":this.pointerLock?"mouse":tr.pointer&&!s?"pointer":tr.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?X6:void 0,!(!tr.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:s=!0}={}}){return this.pointerButtons=r,this.keys=s,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:s=void 0}){const i=Ut.toVector(t,n?r:s?1:0);return this.filterTaps=n,this.tapsThreshold=r,i},swipe({velocity:t=Q6,distance:e=J6,duration:n=eU}={}){return{velocity:this.transform(Ut.toVector(t)),distance:this.transform(Ut.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return Z6;case!1:return 0;default:return t}},axisThreshold(t){return t?dt(dt({},z_),t):z_},keyboardDisplacement(t=tU){return t}});function GR(t){const[e,n]=t.overflow,[r,s]=t._delta,[i,o]=t._direction;(e<0&&r>0&&i<0||e>0&&r<0&&i>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&s>0&&o<0||n>0&&s<0&&o>0)&&(t._movement[1]=t._movementBound[1])}const nU=30,rU=100;class sU extends UR{constructor(...e){super(...e),Qt(this,"ingKey","pinching"),Qt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Ut.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,r]=e._movement;if(!e.axis){const s=Math.abs(n)*nU-Math.abs(r);s<0?e.axis="angle":s>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(i=>r.has(i))||r.size<2)return;this.start(e),n._touchIds=Array.from(r).slice(0,2);const s=L_(e,n._touchIds);s&&this.pinchStart(e,s)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,r=n._pointerEvents,s=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(o=>s.has(o))||(r.size<2&&r.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const i=Ax(...Array.from(r.values()));i&&this.pinchStart(e,i)}pinchStart(e,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=L_(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const r=Ax(...Array.from(n.values()));r&&this.pinchMove(e,r)}pinchMove(e,n){const r=this.state,s=r._values[1],i=n.angle-s;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([n.distance,n.angle-360*o]),r.origin=n.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const r=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=Ut.sub(n._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>e[r]):!e[n])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-zR(e)[1]/rU*r.offset[0],0],Ut.addTo(r._movement,r._delta),GR(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const iU=dt(dt({},qR),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!tr.touch&&tr.gesture)return"gesture";if(tr.touch&&r)return"touch";if(tr.touchscreen){if(tr.pointer)return"pointer";if(tr.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const s=o=>{const a=B_(rd(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},i=o=>{const a=B_(rd(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[s(),i()]:o=>[s(o),i(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",Ut.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});dt(dt({},vc),{},{mouseOnly:(t=!0)=>t});class oU extends q6{constructor(...e){super(...e),Qt(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=zR(e),Ut.addTo(n._movement,n._delta),GR(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const aU=vc;dt(dt({},vc),{},{mouseOnly:(t=!0)=>t});const Vb=new Map,jx=new Map;function cU(t){Vb.set(t.key,t.engine),jx.set(t.key,t.resolver)}const lU={key:"pinch",engine:sU,resolver:iU},dU={key:"wheel",engine:oU,resolver:aU};function uU(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function hU(t,e){if(t==null)return{};var n=uU(t,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const pU={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=tr.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},fU=["target","eventOptions","window","enabled","transform"];function Ol(t={},e){const n={};for(const[r,s]of Object.entries(e))switch(typeof s){case"function":n[r]=s.call(n,t[r],r,t);break;case"object":n[r]=Ol(t[r],s);break;case"boolean":s&&(n[r]=t[r]);break}return n}function gU(t,e,n={}){const r=t,{target:s,eventOptions:i,window:o,enabled:a,transform:c}=r,l=hU(r,fU);if(n.shared=Ol({target:s,eventOptions:i,window:o,enabled:a,transform:c},pU),e){const d=jx.get(e);n[e]=Ol(dt({shared:n.shared},l),d)}else for(const d in l){const u=jx.get(d);u&&(n[d]=Ol(dt({shared:n.shared},l[d]),u))}return n}class KR{constructor(e,n){Qt(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,s,i){const o=this._listeners,a=O6(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=dt(dt({},c),i);e.addEventListener(a,s,l);const d=()=>{e.removeEventListener(a,s,l),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class mU{constructor(){Qt(this,"_timeouts",new Map)}add(e,n,r=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...s))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class yU{constructor(e){Qt(this,"gestures",new Set),Qt(this,"_targetEventStore",new KR(this)),Qt(this,"gestureEventStores",{}),Qt(this,"gestureTimeoutStores",{}),Qt(this,"handlers",{}),Qt(this,"config",{}),Qt(this,"pointerIds",new Set),Qt(this,"touchIds",new Set),Qt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),SU(this,e)}setEventIds(e){if($R(e))return this.touchIds=new Set(N6(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=gU(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let s;if(!(n.target&&(s=n.target(),!s))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],c=U_(r,a.eventOptions,!!s);if(a.enabled){const l=Vb.get(o);new l(this,e,o).bind(c)}}const i=U_(r,n.eventOptions,!!s);for(const o in this.nativeHandlers)i(o,"",a=>this.nativeHandlers[o](dt(dt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const i in r)r[i]=$6(...r[i]);if(!s)return r;for(const i in r){const{device:o,capture:a,passive:c}=R6(i);this._targetEventStore.add(s,o,"",r[i],{capture:a,passive:c})}}}}function Ki(t,e){t.gestures.add(e),t.gestureEventStores[e]=new KR(t,e),t.gestureTimeoutStores[e]=new mU}function SU(t,e){e.drag&&Ki(t,"drag"),e.wheel&&Ki(t,"wheel"),e.scroll&&Ki(t,"scroll"),e.move&&Ki(t,"move"),e.pinch&&Ki(t,"pinch"),e.hover&&Ki(t,"hover")}const U_=(t,e,n)=>(r,s,i,o={},a=!1)=>{var c,l;const d=(c=o.capture)!==null&&c!==void 0?c:e.capture,u=(l=o.passive)!==null&&l!==void 0?l:e.passive;let p=a?r:A6(r,s,d);n&&u&&(p+="Passive"),t[p]=t[p]||[],t[p].push(i)},vU=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function xU(t){const e={},n={},r=new Set;for(let s in t)vU.test(s)?(r.add(RegExp.lastMatch),n[s]=t[s]):e[s]=t[s];return[n,e,r]}function Vi(t,e,n,r,s,i){if(!t.has(n)||!Vb.has(r))return;const o=n+"Start",a=n+"End",c=l=>{let d;return l.first&&o in e&&e[o](l),n in e&&(d=e[n](l)),l.last&&a in e&&e[a](l),d};s[r]=c,i[r]=i[r]||{}}function bU(t,e){const[n,r,s]=xU(t),i={};return Vi(s,n,"onDrag","drag",i,e),Vi(s,n,"onWheel","wheel",i,e),Vi(s,n,"onScroll","scroll",i,e),Vi(s,n,"onPinch","pinch",i,e),Vi(s,n,"onMove","move",i,e),Vi(s,n,"onHover","hover",i,e),{handlers:i,config:e,nativeHandlers:r}}function wU(t,e={},n,r){const s=qe.useMemo(()=>new yU(t),[]);if(s.applyHandlers(t,r),s.applyConfig(e,n),qe.useEffect(s.effect.bind(s)),qe.useEffect(()=>s.clean.bind(s),[]),e.target===void 0)return s.bind.bind(s)}function CU(t){return t.forEach(cU),function(n,r){const{handlers:s,nativeHandlers:i,config:o}=bU(n,r||{});return wU(s,o,void 0,i)}}const q_=10,_U=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function VR(t){let{deltaY:e,deltaX:n}=t,r=0;return t.ctrlKey||t.altKey||t.metaKey?r=(Math.abs(e)>q_?q_*Math.sign(e):e)/100:t.shiftKey&&!_U&&(n=e,e=0),{x:-n,y:-e,z:-r}}const IU=CU([dU,lU]);let Wi;const PU=t=>Wi===void 0?(Wi=t,!1):t-Wi>120&&t-Wi<160?(Wi=t,!0):(Wi=t,!1);function EU(t){const e=K(),n=_.useMemo(()=>{let r="not sure";const s=({event:y})=>{if(!e.getInstanceState().isFocused||(r="not sure",PU(Date.now())))return;const S=e.getEditingShapeId();if(S){const x=e.getShape(S);if(x&&e.getShapeUtil(x).canScroll(x)&&e.getShapePageBounds(S)?.containsPoint(e.inputs.currentPagePoint))return}Le(y),jt(y);const g=VR(y);if(g.x===0&&g.y===0)return;const v={type:"wheel",name:"wheel",delta:g,point:new w(y.clientX,y.clientY),shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey};e.dispatch(v)};let i=1,o=1,a=1,c=0;const l=new w,d=new w,u=y=>{const S=t.current;r="not sure";const{event:g,origin:v,da:x}=y;g instanceof WheelEvent||(g.target===S||S?.contains(g.target))&&(d.x=v[0],d.y=v[1],l.x=v[0],l.y=v[1],i=x[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:v[0],y:v[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey}))},p=y=>{if(y&&(r="zooming"),r==="zooming")return;const S=Math.abs(c-i),g=w.Dist(l,d);switch(r){case"not sure":{S>24?r="zooming":g>16&&(r="panning");break}case"panning":{S>64&&(r="zooming");break}}};return{onWheel:s,onPinchStart:u,onPinchEnd:y=>{const S=t.current,{event:g,origin:v,offset:x}=y;if(g instanceof WheelEvent||!(g.target===S||S?.contains(g.target)))return;const b=x[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:v[0],y:v[1],z:b},delta:{x:v[0],y:v[1]},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey})})},onPinch:y=>{const S=t.current,{event:g,origin:v,offset:x,da:b}=y;if(g instanceof WheelEvent||!(g.target===S||S?.contains(g.target)))return;const E=y.type==="gesturechange"||y.type==="gestureend";c=b[0];const I=v[0]-d.x,C=v[1]-d.y;switch(d.x=v[0],d.y=v[1],p(E),r){case"zooming":{a=x[0],e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:a},delta:{x:I,y:C},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:o},delta:{x:I,y:C},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey});break}}}}},[e,t]);IU(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function yf(t,e,n){const r=t.getShape(e),s=t.getShapeHandles(r);return{shape:r,handle:s.find(i=>i.id===n)}}function kU(t,e){const n=K();return _.useMemo(()=>{const r=c=>{if(c.isKilled)return;const l=nd(c.currentTarget);yc(l,c);const{shape:d,handle:u}=yf(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_down",..._n(c)})};let s,i;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===s&&c.clientY===i)return;s=c.clientX,i=c.clientY;const{shape:l,handle:d}=yf(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:l,name:"pointer_move",..._n(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=nd(c.currentTarget);Sc(l,c);const{shape:d,handle:u}=yf(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_up",..._n(c)})}}},[n,t,e])}class ce{constructor(e=0,n=0,r=0,s=0){this.x=e,this.y=n,this.w=r,this.h=s}x=0;y=0;w=0;h=0;get point(){return new w(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new w(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new w(this.minX,this.minY),new w(this.maxX,this.minY),new w(this.maxX,this.maxY),new w(this.minX,this.maxY)]}get cornersAndCenter(){return[new w(this.minX,this.minY),new w(this.maxX,this.minY),new w(this.maxX,this.maxY),new w(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new w(this.w,this.h)}toFixed(){return this.x=rl(this.x),this.y=rl(this.y),this.w=rl(this.w),this.h=rl(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,r=0,s=0){return this.x=e,this.y=n,this.w=r,this.h=s,this}expand(e){const n=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),s=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=n,this.y=r,this.w=s-n,this.h=i-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:r,h:s}=this;return new ce(e,n,r,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,s=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=n,this.minY=r,this.width=Math.max(1,s-n),this.height=Math.max(1,i-r)}collides(e){return ce.Collides(this,e)}contains(e){return ce.Contains(this,e)}includes(e){return ce.Includes(this,e)}containsPoint(e,n=0){return ce.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new w(this.minX,this.minY);case"top_right":return new w(this.maxX,this.minY);case"bottom_left":return new w(this.minX,this.maxY);case"bottom_right":return new w(this.maxX,this.maxY);case"top":return new w(this.midX,this.minY);case"right":return new w(this.maxX,this.midY);case"bottom":return new w(this.midX,this.maxY);case"left":return new w(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,n,r){const{minX:s,minY:i,maxX:o,maxY:a}=this;let{minX:c,minY:l,maxX:d,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=n;break}case"right":case"top_right":case"bottom_right":{d+=n;break}}switch(e){case"top":case"top_left":case"top_right":{l+=r;break}case"bottom":case"bottom_left":case"bottom_right":{u+=r;break}}const p=(d-c)/(o-s),f=(u-l)/(a-i),m=p<0,y=f<0;if(m){const S=d;d=c,c=S}if(y){const S=u;u=l,l=S}this.minX=c,this.minY=l,this.width=Math.abs(d-c),this.height=Math.abs(u-l)}union(e){const n=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),s=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=n,this.y=r,this.width=s-n,this.height=i-r,this}static From(e){return new ce(e.x,e.y,e.w,e.h)}static FromCenter(e,n){return new ce(e.x-n.x/2,e.y-n.y/2,n.x,n.y)}static FromPoints(e){if(e.length===0)return new ce;let n=1/0,r=1/0,s=-1/0,i=-1/0,o;for(let a=0,c=e.length;a<c;a++)o=e[a],n=Math.min(o.x,n),r=Math.min(o.y,r),s=Math.max(o.x,s),i=Math.max(o.y,i);return new ce(n,r,s-n,i-r)}static Expand(e,n){const r=Math.min(n.minX,e.minX),s=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),o=Math.max(n.maxY,e.maxY);return new ce(r,s,i-r,o-s)}static ExpandBy(e,n){return new ce(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Collides=(e,n)=>!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY);static Contains=(e,n)=>e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX;static Includes=(e,n)=>ce.Collides(e,n)||ce.Contains(e,n);static ContainsPoint=(e,n,r=0)=>!(n.x<e.minX-r||n.y<e.minY-r||n.x>e.maxX+r||n.y>e.maxY+r);static Common=e=>{let n=1/0,r=1/0,s=-1/0,i=-1/0;for(let o=0;o<e.length;o++){const a=e[o];n=Math.min(n,a.minX),r=Math.min(r,a.minY),s=Math.max(s,a.maxX),i=Math.max(i,a.maxY)}return new ce(n,r,s-n,i-r)};static Sides=(e,n=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]};static Resize(e,n,r,s,i=!1){const{minX:o,minY:a,maxX:c,maxY:l}=e;let{minX:d,minY:u,maxX:p,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{p+=r;break}}switch(n){case"top":case"top_left":case"top_right":{u+=s;break}case"bottom":case"bottom_left":case"bottom_right":{f+=s;break}}const m=(p-d)/(c-o),y=(f-u)/(l-a),S=m<0,g=y<0;if(i){const x=(c-o)/(l-a),b=Math.abs(p-d),E=Math.abs(f-u),I=b*(y<0?1:-1)*(1/x),C=E*(m<0?1:-1)*x,P=x<b/E;switch(n){case"top_left":{P?u=f+I:d=p+C;break}case"top_right":{P?u=f+I:p=d-C;break}case"bottom_right":{P?f=u-I:p=d-C;break}case"bottom_left":{P?f=u-I:d=p+C;break}case"bottom":case"top":{const k=(d+p)/2,T=E*x;d=k-T/2,p=k+T/2;break}case"left":case"right":{const k=(u+f)/2,T=b/x;u=k-T/2,f=k+T/2;break}}}if(S){const x=p;p=d,d=x}if(g){const x=f;f=u,u=x}const v=new ce(d,u,Math.abs(p-d),Math.abs(f-u));return{box:v,scaleX:+(v.width/e.width*(m>0?1:-1)).toFixed(5),scaleY:+(v.height/e.height*(y>0?1:-1)).toFixed(5)}}equals(e){return ce.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new ce(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function TU(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function MU(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function AU(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}function jU(t){const e=K();_.useLayoutEffect(()=>{let n=new ce;function r(){const l=t.current;if(!l)return null;const d=l.getBoundingClientRect(),u=new ce(d.left||d.x,d.top||d.y,Math.max(d.width,1),Math.max(d.height,1));n.equals(u)||(e.updateViewportScreenBounds(u),n=u)}r();const s=vj(r,200,{trailing:!0}),i=e.timers.setInterval(s,1e3);window.addEventListener("resize",s);const o=new ResizeObserver(l=>{l[0].contentRect&&s()}),a=t.current;let c=null;return a&&(o.observe(a),c=RU(a),c.addEventListener("scroll",s)),()=>{clearInterval(i),window.removeEventListener("resize",s),o.disconnect(),c?.removeEventListener("scroll",s),s.cancel()}},[e,t])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const RU=t=>{let e=t.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:n}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(n==="auto"||n==="scroll"||n==="overlay"))return e;e=e.parentElement}return document};class se{constructor(e,n,r,s,i,o){this.a=e,this.b=n,this.c=r,this.d=s,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:r,b:s,c:i,d:o,e:a,f:c}=this;return this.a=r*n.a+i*n.b,this.c=r*n.c+i*n.d,this.e=r*n.e+i*n.f+a,this.b=s*n.a+o*n.b,this.d=s*n.c+o*n.d,this.f=s*n.e+o*n.f+c,this}rotate(e,n,r){return e===0?this:n===void 0?this.multiply(se.Rotate(e)):this.translate(n,r).multiply(se.Rotate(e)).translate(-n,-r)}translate(e,n){return this.multiply(se.Translate(e,n))}scale(e,n){return this.multiply(se.Scale(e,n))}invert(){const{a:e,b:n,c:r,d:s,e:i,f:o}=this,a=e*s-n*r;return this.a=s/a,this.b=n/-a,this.c=r/-a,this.d=e/a,this.e=(s*i-r*o)/-a,this.f=(n*i-e*o)/a,this}applyToPoint(e){return se.applyToPoint(this,e)}applyToPoints(e){return se.applyToPoints(this,e)}rotation(){return se.Rotation(this)}point(){return se.Point(this)}decomposed(){return se.Decompose(this)}toCssString(){return se.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return se.Decompose(this)}clone(){return new se(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new se(1,0,0,1,0,0)}static Translate(e,n){return new se(1,0,0,1,e,n)}static Rotate(e,n,r){if(e===0)return se.Identity();const s=Math.cos(e),i=Math.sin(e),o=new se(s,i,-i,s,0,0);return n===void 0?o:se.Compose(se.Translate(n,r),o,se.Translate(-n,-r))}static Scale=(e,n,r,s)=>{const i=new se(e,0,0,n,0,0);return r===void 0?i:se.Compose(se.Translate(r,s),i,se.Translate(-r,-s))};static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=se.Identity();for(let r=0,s=e.length;r<s;r++)n.multiply(e[r]);return n}static Point(e){return new w(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;n=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;n=Xe+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0;return Tx(n)}static Decompose(e){let n,r,s;if(e.a!==0||e.c!==0){const i=(e.a*e.a+e.c*e.c)**.5;n=i,r=(e.a*e.d-e.b*e.c)/i,s=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const i=(e.b*e.b+e.d*e.d)**.5;n=(e.a*e.d-e.b*e.c)/i,r=i,s=Xe+Math.acos(e.b/i)*(e.d>0?-1:1)}else n=0,r=0,s=0;return{x:e.e,y:e.f,scaleX:n,scaleY:r,rotation:Tx(s)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${G(e.a)}, ${G(e.b)}, ${G(e.c)}, ${G(e.d)}, ${G(e.e)}, ${G(e.f)})`}static applyToPoint(e,n){return new w(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,r){return[e.a*n+e.c*r+e.e,e.b*n+e.d*r+e.f]}static applyToPoints(e,n){return n.map(r=>new w(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,n){return new ce(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new se(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof se?e:se.From(e)}}function WR(t,e){return e===0?t:WR(e,t%e)}function YR(t){const e=t.toString().split(".")[1];if(!e)return 1;const n=Math.pow(10,e.length),r=parseInt(e,10);return n/WR(r,n)}class Zs{isFilled=!1;isClosed=!0;isLabel=!1;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,n=0,r=!1){return this.isClosed&&(this.isFilled||r)&&Bn(e,this.vertices)?!0:w.Dist2(e,this.nearestPoint(e))<=n*n}distanceToPoint(e,n=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||n)&&Bn(e,this.vertices)?-1:1)}distanceToLineSegment(e,n){if(e.equals(n))return this.distanceToPoint(e);const{vertices:r}=this;let s,i=1/0,o,a,c;for(let l=0;l<r.length;l++)a=r[l],c=w.NearestPointOnLineSegment(e,n,a,!0),o=w.Dist2(a,c),o<i&&(i=o,s=c);if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&Bn(s,this.vertices)?-i:i}hitTestLineSegment(e,n,r=0){return this.distanceToLineSegment(e,n)<=r}nearestPointOnLineSegment(e,n){const{vertices:r}=this;let s,i=1/0,o,a,c;for(let l=0;l<r.length;l++)a=r[l],c=w.NearestPointOnLineSegment(e,n,a,!0),o=w.Dist2(a,c),o<i&&(i=o,s=c);if(!s)throw Error("nearest point not found");return s}isPointInBounds(e,n=0){const{bounds:r}=this;return!(e.x<r.minX-n||e.y<r.minY-n||e.x>r.maxX+n||e.y>r.maxY+n)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return ce.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let r=0,s=e.length;r<s;r++){const i=e[r],o=e[(r+1)%s];n+=i.x*o.y-o.x*i.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,r=n.length;if(r===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let s=1;s<r;s++)e+=`L${n[s].x},${n[s].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let n,r=e[0],s=0;for(let i=1;i<e.length;i++)n=e[i],s+=w.Dist2(r,n),r=n;return Math.sqrt(s)}}class xr extends Zs{children=[];ignoredChildren=[];constructor(e){super({...e,isClosed:!0,isFilled:!1});for(const n of e.children)n.ignore?this.ignoredChildren.push(n):this.children.push(n);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let n=1/0,r;const{children:s}=this;if(s.length===0)throw Error("no children");let i,o;for(const a of s)i=a.nearestPoint(e),o=w.Dist2(i,e),o<n&&(n=o,r=i);if(!r)throw Error("nearest point not found");return r}distanceToPoint(e,n=!1){return Math.min(...this.children.map((r,s)=>r.distanceToPoint(e,n||s>0)))}hitTestPoint(e,n,r){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(e,n,r))}hitTestLineSegment(e,n,r){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(e,n,r))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const r of this.children)e+=r.toSimpleSvgPath();const n=ce.FromPoints(this.vertices).corners;for(let r=0,s=n.length;r<s;r++){const i=n[r],o=n[(r-1+s)%s],a=i.dist(o),c=n[(r+1)%s],l=i.dist(c),d=i.clone().lrp(o,4/a),u=i,p=i.clone().lrp(c,4/l);e+=`M${d.x},${d.y} L${u.x},${u.y} L${p.x},${p.y} `}return e}getLength(){return this.children.reduce((e,n)=>n.isLabel?e:e+n.length,0)}getSvgPathData(){return this.children.map((e,n)=>e.isLabel?"":e.getSvgPathData(n===0)).join(" ")}}function OU(t=!0){const[e,n]=_.useState(0),r=K();_.useEffect(()=>{if(!t)return;const s=()=>n(i=>i+1);return r.on("tick",s),()=>{r.off("tick",s)}},[r,t])}const DU=Ot(function({showStroke:e=!0,showVertices:n=!0,showClosestPointOnOutline:r=!0}){const s=K();OU(r);const i=s.getZoomLevel(),o=s.getRenderingShapes(),{inputs:{currentPagePoint:a}}=s;return h.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const l=s.getShape(c.id);if(l.type==="group")return null;const d=s.getShapeGeometry(l),u=s.getShapePageTransform(l),p=s.getPointInShapeSpace(l,a),f=d.nearestPoint(p),m=d.distanceToPoint(p,!0),y=Math.abs(m)*i,S=m<0,{vertices:g}=d;return h.jsxs("g",{transform:u.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&h.jsx("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/i,fill:"none",children:h.jsx(XR,{geometry:d})}),n&&g.map((v,x)=>h.jsx("circle",{cx:v.x,cy:v.y,r:2/i,fill:`hsl(${yo(x,[0,g.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/i},`v${x}`)),r&&y<150&&h.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-y/150,stroke:S?"goldenrod":"dodgerblue",strokeWidth:2/i})]},c.id+"_outline")})})});function XR({geometry:t}){return t instanceof xr?h.jsx(h.Fragment,{children:[...t.children,...t.ignoredChildren].map((e,n)=>h.jsx(XR,{geometry:e},n))}):h.jsx("path",{d:t.toSimpleSvgPath()})}function ZR(t){return iz(t)}function QR(){const t=K(),e=o6("userIds",()=>ZR(t.getCollaborators().map(n=>n.userId)).sort(),{isEqual:(n,r)=>n.join(",")===r.join?.(",")},[t]);return X(e)}function Ld(t){const e=K();return X(`latestPresence:${t}`,()=>e.getCollaborators().find(r=>r.userId===t),[e,t])??null}const LU=Ot(function(){return QR().map(n=>h.jsx(NU,{collaboratorId:n},n))}),NU=Ot(function({collaboratorId:e}){const n=K(),r=Ld(e),s=BU(n,r);if(!(r&&r.currentPageId===n.getCurrentPageId()))return null;switch(s){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=n.getInstanceState();if(!(i===r.userId||o.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=n.getInstanceState();if(r.followingUserId===n.user.getId()&&!(r.chatMessage||i.includes(r.userId)))return null;break}}return h.jsx(FU,{latestPresence:r})}),FU=Ot(function({latestPresence:e}){const n=K(),{CollaboratorBrush:r,CollaboratorScribble:s,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:a}=st(),c=n.getZoomLevel(),l=n.getViewportPageBounds(),{userId:d,chatMessage:u,brush:p,scribbles:f,selectedShapeIds:m,userName:y,cursor:S,color:g}=e,v=!(S.x<l.minX-12/c||S.y<l.minY-16/c||S.x>l.maxX-12/c||S.y>l.maxY-16/c);return h.jsxs(h.Fragment,{children:[p&&r?h.jsx(r,{className:"tl-collaborator__brush",brush:p,color:g,opacity:.1},d+"_brush"):null,v&&i?h.jsx(i,{className:"tl-collaborator__cursor",point:S,color:g,zoom:c,name:y!=="New User"?y:null,chatMessage:u},d+"_cursor"):o?h.jsx(o,{className:"tl-collaborator__cursor-hint",point:S,color:g,zoom:c,viewport:l},d+"_cursor_hint"):null,s&&f.length?h.jsx(h.Fragment,{children:f.map(x=>h.jsx(s,{className:"tl-collaborator__scribble",scribble:x,color:g,zoom:c,opacity:x.color==="laser"?.5:.1},d+"_scribble_"+x.id))}):null,a&&m.map(x=>h.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:x,color:g,opacity:.5},d+"_"+x))]})});function H_(t,e){return e>t.options.collaboratorInactiveTimeoutMs?"inactive":e>t.options.collaboratorIdleTimeoutMs?"idle":"active"}function BU(t,e){const n=_.useRef(e?.lastActivityTimestamp??-1),[r,s]=_.useState(()=>H_(t,Date.now()-n.current));return _.useEffect(()=>{const i=t.timers.setInterval(()=>{s(H_(t,Date.now()-n.current))},t.options.collaboratorCheckIntervalMs);return()=>clearInterval(i)},[t]),e&&(n.current=e.lastActivityTimestamp),r}const JR=_.memo(function({id:e,shape:n,util:r,index:s,backgroundIndex:i,opacity:o,dprMultiple:a}){const c=K(),{ShapeErrorFallback:l}=st(),d=_.useRef(null),u=_.useRef(null),p=_.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Bs("set shape stuff",()=>{const y=c.getShape(e);if(!y)return;const S=p.current,g=c.getShapeClipPath(e)??"none";g!==S.clipPath&&(Xt(d.current,"clip-path",g),Xt(u.current,"clip-path",g),S.clipPath=g);const v=c.getShapePageTransform(e),x=se.toCssString(v),b=c.getShapeGeometry(y).bounds;x!==S.transform&&(Xt(d.current,"transform",x),Xt(u.current,"transform",x),S.transform=x);const E=b.w%a,I=b.h%a,C=E===0?b.w:b.w+(a-E),P=I===0?b.h:b.h+(a-I);(C!==S.width||P!==S.height)&&(Xt(d.current,"width",Math.max(C,a)+"px"),Xt(d.current,"height",Math.max(P,a)+"px"),Xt(u.current,"width",Math.max(C,a)+"px"),Xt(u.current,"height",Math.max(P,a)+"px"),S.width=C,S.height=P)},[c]),Bs("set opacity and z-index",()=>{const y=d.current,S=u.current;Xt(y,"opacity",o),Xt(S,"opacity",o),Xt(y,"z-index",s),Xt(S,"z-index",i)},[o,s,i]),Bs("set display",()=>{if(!c.getShape(e))return;const g=c.getCulledShapes().has(e);g!==p.current.isCulled&&(Xt(d.current,"display",g?"none":"block"),Xt(u.current,"display",g?"none":"block"),p.current.isCulled=g)},[c]);const f=_.useCallback(y=>c.annotateError(y,{origin:"shape",willCrashApp:!1}),[c]);if(!n)return null;const m="fill"in n.props&&n.props.fill!=="none";return h.jsxs(h.Fragment,{children:[r.backgroundComponent&&h.jsx("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":n.type,draggable:!1,children:h.jsx(Wa,{fallback:l,onError:f,children:h.jsx(zU,{shape:n,util:r})})}),h.jsx("div",{ref:d,className:"tl-shape","data-shape-type":n.type,"data-shape-is-filled":m,draggable:!1,children:h.jsx(Wa,{fallback:l,onError:f,children:h.jsx($U,{shape:n,util:r})})})]})}),$U=_.memo(function({shape:e,util:n}){return Od("InnerShape:"+e.type,()=>n.component(n.editor.store.unsafeGetWithoutCapture(e.id)))},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),zU=_.memo(function({shape:e,util:n}){return Od("InnerShape:"+e.type,()=>n.backgroundComponent?.(n.editor.store.unsafeGetWithoutCapture(e.id)))},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta);function UU({className:t}){const e=K(),{Background:n,SvgDefs:r,ShapeIndicators:s}=st(),i=_.useRef(null),o=_.useRef(null),a=_.useRef(null),c=Dt();jU(i),b6(),v6(),EU(i),_6(i);const l=_.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Bs("position layers",function(){const{x:v,y:x,z:b}=e.getCamera();if(l.current.allowTextOutline&&e.environment.isSafari&&(c.style.setProperty("--tl-text-outline","none"),l.current.allowTextOutline=!1),l.current.allowTextOutline&&b<e.options.textShadowLod!==l.current.lodDisableTextOutline){const C=b<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",C?"none":"var(--tl-text-outline-reference)"),l.current.lodDisableTextOutline=C}const E=b>=1?yo(b,[1,8],[.125,.5],!0):yo(b,[.1,1],[-2,.125],!0),I=`scale(${G(b)}) translate(${G(v+E)}px,${G(x+E)}px)`;Xt(o.current,"transform",I),Xt(a.current,"transform",I)},[e,c]);const d=NR(),u=X("shapeSvgDefs",()=>{const g=new Map;for(const v of ft(e.shapeUtils)){if(!v)return;const x=v.getCanvasSvgDefs();for(const{key:b,component:E}of x)g.has(b)||g.set(b,h.jsx(E,{},b))}return[...g.values()]},[e]),p=X("debug_shapes",()=>yt.hideShapes.get(),[yt]),f=X("debug_svg",()=>yt.debugSvg.get(),[yt]),m=X("debug_geometry",()=>yt.debugGeometry.get(),[yt]),y=X("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),S=X("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return h.jsxs(h.Fragment,{children:[h.jsxs("div",{ref:i,draggable:!1,"data-iseditinganything":y,"data-isselectinganything":S,className:be("tl-canvas",t),"data-testid":"canvas",...d,children:[h.jsx("svg",{className:"tl-svg-context",children:h.jsxs("defs",{children:[u,h.jsx(nq,{}),h.jsx(rq,{}),r&&h.jsx(r,{})]})}),n&&h.jsx("div",{className:"tl-background__wrapper",children:h.jsx(n,{})}),h.jsx(HU,{}),h.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[h.jsx(aq,{}),h.jsx(oq,{}),p?null:f?h.jsx(QU,{}):h.jsx(eq,{})]}),h.jsx("div",{className:"tl-overlays",children:h.jsxs("div",{ref:a,className:"tl-html-layer",children:[m?h.jsx(DU,{}):null,h.jsx(YU,{}),h.jsx(KU,{}),h.jsx(GU,{}),h.jsx(VU,{}),s&&h.jsx(s,{}),h.jsx(tq,{}),h.jsx(WU,{}),h.jsx(iq,{}),h.jsx(LU,{})]})}),h.jsx(cq,{})]}),h.jsx(qU,{})]})}function qU(){const{InFrontOfTheCanvas:t}=st();return t?h.jsx(t,{}):null}function HU(){const t=K(),e=X("gridSize",()=>t.getDocumentSettings().gridSize,[t]),{x:n,y:r,z:s}=X("camera",()=>t.getCamera(),[t]),i=X("isGridMode",()=>t.getInstanceState().isGridMode,[t]),{Grid:o}=st();return o&&i?h.jsx(o,{x:n,y:r,z:s,size:e}):null}function GU(){const t=K(),e=X("scribbles",()=>t.getInstanceState().scribbles,[t]),n=X("zoomLevel",()=>t.getZoomLevel(),[t]),{Scribble:r}=st();return r&&e.length?e.map(s=>h.jsx(r,{className:"tl-user-scribble",scribble:s,zoom:n},s.id)):null}function KU(){const t=K(),e=X("brush",()=>t.getInstanceState().brush,[t]),{Brush:n}=st();return n&&e?h.jsx(n,{className:"tl-user-brush",brush:e}):null}function VU(){const t=K(),e=X("zoomBrush",()=>t.getInstanceState().zoomBrush,[t]),{ZoomBrush:n}=st();return n&&e?h.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function WU(){const t=K(),e=X("snapLines",()=>t.snaps.getIndicators(),[t]),n=X("zoomLevel",()=>t.getZoomLevel(),[t]),{SnapIndicator:r}=st();return r&&e.length>0?e.map(s=>h.jsx(r,{className:"tl-user-snapline",line:s,zoom:n},s.id)):null}function YU(){const t=K(),e=X("handles shapeIdWithHandles",()=>{const{isReadonly:n,isChangingStyle:r}=t.getInstanceState();if(n||r)return!1;const s=t.getOnlySelectedShape();return!s||!t.getShapeHandles(s)?!1:s.id},[t]);return e?h.jsx(XU,{shapeId:e}):null}function XU({shapeId:t}){const e=K(),{Handles:n}=st(),r=X("zoomLevel",()=>e.getZoomLevel(),[e]),s=X("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=X("handles transform",()=>e.getShapePageTransform(t),[e,t]),o=X("handles",()=>{const a=e.getShapeHandles(t);if(!a)return null;const c=(s?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return a.filter(l=>l.type!=="virtual"||!a.some(d=>d!==l&&d.type==="vertex"&&w.Dist(l,d)<c)).sort(l=>l.type==="vertex"?1:-1)},[e,r,s,t]);return!n||!o||!i?null:h.jsx(n,{children:h.jsx("g",{transform:se.toCssString(i),children:o.map(a=>h.jsx(ZU,{shapeId:t,handle:a,zoom:r,isCoarse:s},a.id))})})}function ZU({shapeId:t,handle:e,zoom:n,isCoarse:r}){const s=kU(t,e.id),{Handle:i}=st();return i?h.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...s,children:h.jsx(i,{shapeId:t,handle:e,zoom:n,isCoarse:r})}):null}function QU(){const t=K(),e=X("rendering shapes",()=>t.getRenderingShapes(),[t]),n=X("dpr multiple",()=>YR(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return e.map(r=>h.jsxs(_.Fragment,{children:[h.jsx(JR,{...r,dprMultiple:n}),h.jsx(sq,{id:r.id})]},r.id+"_fragment"))}function JU(){const t=K(),e=_.useRef(new Set);return Bs("reflow for culled shapes",()=>{const n=t.getCulledShapes();if(e.current.size===n.size&&[...n].every(s=>e.current.has(s)))return;e.current=n;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[t]),null}function eq(){const t=K(),e=X("rendering shapes",()=>t.getRenderingShapes(),[t]),n=X("dpr multiple",()=>YR(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return h.jsxs(h.Fragment,{children:[e.map(r=>h.jsx(JR,{...r,dprMultiple:n},r.id+"_shape")),t.environment.isSafari&&h.jsx(JU,{})]})}function tq(){const t=K(),{ShapeIndicator:e}=st(),n=X("hinting shape ids",()=>kb(t.getHintingShapeIds()),[t]);return!n.length||!e?null:n.map(r=>h.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function nq(){return h.jsxs("g",{id:"cursor",children:[h.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[h.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),h.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),h.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[h.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),h.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),h.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[h.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),h.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function rq(){return h.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function sq({id:t}){const e=K(),[n,r]=_.useState(null),s=X("is in root",()=>e.getShape(t)?.parentId===e.getCurrentPageId(),[e,t]);return _.useEffect(()=>{if(!s)return;let i=null;const o=Oi("shape to svg",async()=>{const a=Math.random();i=a;const l=e.isShapeOfType(t,"frame")?0:10;let d=e.getShapePageBounds(t);if(!d)return;d=d.clone().expandBy(l);const u=await e.getSvgString([t],{padding:l,background:e.getInstanceState().exportBackground});if(i!==a||!u)return;const p=`data:image/svg+xml;utf8,${encodeURIComponent(u.svg)}`;r({src:p,bounds:d})});return()=>{i=null,o()}},[e,t,s]),!s||!n?null:h.jsx("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function iq(){const t=K(),e=X("selection rotation",()=>t.getSelectionRotation(),[t]),n=X("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionForeground:r}=st();return!n||!r?null:h.jsx(r,{bounds:n,rotation:e})}function oq(){const t=K(),e=X("selection rotation",()=>t.getSelectionRotation(),[t]),n=X("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionBackground:r}=st();return!n||!r?null:h.jsx(r,{bounds:n,rotation:e})}function aq(){const{OnTheCanvas:t}=st();return t?h.jsx(t,{}):null}function cq(){const t=K(),e=X("camera state",()=>t.getCameraState(),[t]);return h.jsx("div",{className:be("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function lq({className:t,zoom:e,point:n,color:r,viewport:s,opacity:i=1}){const o=_.useRef(null);return Lo(o,Et(n.x,s.minX+5/e,s.maxX-5/e),Et(n.y,s.minY+5/e,s.maxY-5/e),1/e,w.Angle(s.center,n)),h.jsxs("svg",{ref:o,className:be("tl-overlays__item",t),children:[h.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),h.jsx("use",{href:"#cursor_hint",color:r,opacity:i})]})}const G_=_.memo(function({className:e,zoom:n,point:r,color:s,name:i,chatMessage:o}){const a=_.useRef(null);return Lo(a,r?.x,r?.y,1/n),r?h.jsxs("div",{ref:a,className:be("tl-overlays__item",e),children:[h.jsx("svg",{className:"tl-cursor",children:h.jsx("use",{href:"#cursor",color:s})}),o?h.jsxs(h.Fragment,{children:[i&&h.jsx("div",{className:"tl-nametag-title",style:{color:s},children:i}),h.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:s},children:o})]}):i&&h.jsx("div",{className:"tl-nametag",style:{backgroundColor:s},children:i})]}):null});function eO(){return _.useId().replace(/:/g,"_")}function dq({x:t,y:e,z:n,size:r}){const s=`grid_${eO()}`,i=K(),{gridSteps:o}=i.options;return h.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("defs",{children:o.map(({min:a,mid:c,step:l},d)=>{const u=l*r*n,p=.5+t*n,f=.5+e*n,m=p>0?p%u:u+p%u,y=f>0?f%u:u+f%u,S=n<c?yo(n,[a,c],[0,1]):1;return h.jsx("pattern",{id:`${s}_${l}`,width:u,height:u,patternUnits:"userSpaceOnUse",children:h.jsx("circle",{className:"tl-grid-dot",cx:m,cy:y,r:1,opacity:S})},d)})}),o.map(({step:a},c)=>h.jsx("rect",{width:"100%",height:"100%",fill:`url(#${s}_${a})`},c))]})}function uq({handle:t,isCoarse:e,className:n,zoom:r}){const s=K(),i=(e?s.options.coarseHandleRadius:s.options.handleRadius)/r;if(t.type==="clone"){const a=3/r,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,l=y6.indexOf(t.id);return h.jsxs("g",{className:be(`tl-handle tl-handle__${t.type}`,n),children:[h.jsx("circle",{className:"tl-handle__bg",r:i}),h.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*l})`})]})}const o=(t.type==="create"&&e?3:4)/Math.max(r,.25);return h.jsxs("g",{className:be(`tl-handle tl-handle__${t.type}`,n),children:[h.jsx("circle",{className:"tl-handle__bg",r:i}),h.jsx("circle",{className:"tl-handle__fg",r:o})]})}const hq=({children:t})=>h.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}),pq=()=>{const{Spinner:t}=st();return h.jsx(ow,{children:t?h.jsx(t,{}):null})};function Wb(t,e=!0){const n=t.length;if(n<2)return"";let r=t[0],s=t[1];if(n===2)return`M${Be(r)}L${Be(s)}`;let i="";for(let o=2,a=n-1;o<a;o++)r=t[o],s=t[o+1],i+=bn(r,s);return e?`M${bn(t[0],t[1])}Q${Be(t[1])}${bn(t[1],t[2])}T${i}${bn(t[n-1],t[0])}${bn(t[0],t[1])}Z`:`M${Be(t[0])}Q${Be(t[1])}${bn(t[1],t[2])}${t.length>3?"T":""}${i}L${Be(t[n-1])}`}function K_({scribble:t,zoom:e,color:n,opacity:r,className:s}){return t.points.length?h.jsx("svg",{className:s&&be("tl-overlays__item",s),children:h.jsx("path",{className:"tl-scribble",d:Wb(t.points,!1),stroke:n??`var(--color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:r??t.opacity})}):null}function tO({bounds:t,rotation:e}){const n=_.useRef(null);return Lo(n,t.x,t.y,1,e),_.useLayoutEffect(()=>{const r=n.current;r&&(r.style.width=G(Math.max(1,t.width))+"px",r.style.height=G(Math.max(1,t.height))+"px")},[t.width,t.height]),h.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function fq({bounds:t,rotation:e}){const n=K(),r=_.useRef(null),s=X("only selected shape",()=>n.getOnlySelectedShape(),[n]),i=s?n.getShapeUtil(s).expandSelectionOutlinePx(s):0;return Lo(r,t?.x,t?.y,1,e,{x:-i,y:-i}),t=t.clone().expandBy(i).zeroFix(),h.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:h.jsx("rect",{className:be("tl-selection__fg__outline"),width:G(t.width),height:G(t.height)})})}const gq=()=>h.jsx("div",{className:"tl-shape-error-boundary"}),mq=({shape:t,util:e})=>Od("Indicator: "+t.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(t.id))),yq=({editor:t,id:e})=>{const n=X("shape for indicator",()=>t.store.get(e),[t,e]),{ShapeIndicatorErrorFallback:r}=st();return!n||n.isLocked?null:h.jsx(Wa,{fallback:r,onError:s=>t.annotateError(s,{origin:"react.shapeIndicator",willCrashApp:!1}),children:h.jsx(mq,{shape:n,util:t.getShapeUtil(n)},n.id)})},V_=_.memo(function({shapeId:e,className:n,color:r,hidden:s,opacity:i}){const o=K(),a=_.useRef(null);return Bs("indicator transform",()=>{const c=a.current;if(!c)return;const l=o.getShapePageTransform(e);l&&c.style.setProperty("transform",l.toCssString())},[o,e]),_.useLayoutEffect(()=>{const c=a.current;c&&c.style.setProperty("display",s?"none":"block")},[s]),h.jsx("svg",{ref:a,className:be("tl-overlays__item",n),children:h.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:i,children:h.jsx(yq,{editor:o,id:e})})})}),Sq=()=>h.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),nO=_.memo(function(){const e=K(),n=_.useRef(new Set),r=X("should display selected ids",()=>{const o=n.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const l of c)a.add(l);if(e.isInAny("select.idle","select.editing_shape")){const l=e.getInstanceState();if(l.isHoveringCanvas&&!l.isCoarsePointer){const d=e.getHoveredShapeId();d&&a.add(d)}}}if(o.size!==a.size)return n.current=a,a;for(const c of a)if(!o.has(c))return n.current=a,a;return o},[e]),s=X("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:i}=st();return i?s.map(({id:o})=>h.jsx(i,{shapeId:o,hidden:!r.has(o)},o+"_indicator")):null});function vq({points:t,zoom:e}){const n=2.5/e,r=t.reduce((p,f)=>Math.min(p,f.x),1/0),s=t.reduce((p,f)=>Math.max(p,f.x),-1/0),i=t.reduce((p,f)=>Math.min(p,f.y),1/0),o=t.reduce((p,f)=>Math.max(p,f.y),-1/0),a=t.some(p=>p.x===r&&p.y===i);let c,l,d,u;return a?(c=r,l=i,d=s,u=o):(c=r,l=o,d=s,u=i),h.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[h.jsx("line",{x1:c,y1:l,x2:d,y2:u}),t.map((p,f)=>h.jsx("g",{transform:`translate(${p.x},${p.y})`,children:h.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function xq({gaps:t,direction:e,zoom:n}){const r=3.5/n;let s=[-1/0,1/0],i=null;const o=e==="horizontal";for(const c of t){if(i=pr(s[0],s[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),i)s=i;else continue;if(i=pr(s[0],s[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),i)s=i;else continue}if(s===null)return null;const a=(s[0]+s[1])/2;return h.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:t.map(({startEdge:c,endEdge:l},d)=>h.jsx(_.Fragment,{children:o?h.jsxs(h.Fragment,{children:[h.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),h.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),h.jsx("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),h.jsx("line",{x1:(c[0].x+l[0].x)/2,y1:a-r,x2:(c[0].x+l[0].x)/2,y2:a+r})]}):h.jsxs(h.Fragment,{children:[h.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),h.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),h.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),h.jsx("line",{x1:a-r,y1:(c[0].y+l[0].y)/2,x2:a+r,y2:(c[0].y+l[0].y)/2})]})},d))})}function bq({className:t,line:e,zoom:n}){return h.jsx("svg",{className:be("tl-overlays__item",t),children:e.type==="points"?h.jsx(vq,{...e,zoom:n}):e.type==="gaps"?h.jsx(xq,{...e,zoom:n}):null})}function Yb(){return h.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:h.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[h.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),h.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:h.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const wq=()=>null;function rO(t,e){const n=_.useRef(t);return e(t,n.current)?n.current:(n.current=t,t)}function Da(t){return rO(t,cz)}const Cq=(t,e)=>(t??=null,e??=null,t===e?!0:!t||!e?!1:kj(t,e));function Nd(t){return rO(t,Cq)}const sO=_.createContext(null);function _q({overrides:t={},children:e}){const n=Nd(t),r=_.useMemo(()=>({Background:d6,SvgDefs:wq,Brush:gf,ZoomBrush:gf,CollaboratorBrush:gf,Cursor:G_,CollaboratorCursor:G_,CollaboratorHint:lq,CollaboratorShapeIndicator:V_,Grid:dq,Scribble:K_,SnapIndicator:bq,Handles:hq,Handle:uq,CollaboratorScribble:K_,ErrorFallback:oO,ShapeErrorFallback:gq,ShapeIndicatorErrorFallback:Sq,Spinner:Yb,SelectionBackground:tO,SelectionForeground:fq,ShapeIndicators:nO,ShapeIndicator:V_,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:UU,LoadingScreen:pq,...n}),[n]);return h.jsx(sO.Provider,{value:r,children:e})}function st(){const t=_.useContext(sO);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const Xb={openWindow:(t,e)=>window.open(t,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function iO(){Xb.hardReset()}function Iq(){Xb.refreshPage()}const Pq="https://github.com/tldraw/tldraw/issues/new",oO=({error:t,editor:e})=>{const n=_.useRef(null),[r,s]=_.useState(!1),[i,o]=_.useState(!1),[a,c]=_.useState(!1);let l=null;try{l=st().Canvas??null}catch{}const d=t instanceof Error?t.message:String(t),u=t instanceof Error?t.stack:null,p=X("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,m]=_.useState(null);_.useLayoutEffect(()=>{p!==null&&m(p);let x=n.current?.parentElement,b=!1;for(;x;){if(x.classList.contains("tl-theme__dark")||x.classList.contains("tl-theme__light")){b=!0;break}x=x.parentElement}if(b){m(null);return}typeof window<"u"&&"matchMedia"in window&&m(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),_.useEffect(()=>{if(i){const x=e?.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(x)}},[i,e]);const y=()=>{const x=document.createElement("textarea");x.value=u??d,document.body.appendChild(x),x.select(),document.execCommand("copy"),x.remove(),o(!0)},S=()=>{Iq()},g=async()=>{iO()},v=new URL(Pq);return v.searchParams.set("title",d),v.searchParams.set("labels","bug"),v.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??d}
\`\`\`

My browser: ${navigator.userAgent}`),h.jsxs("div",{ref:n,className:be("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[h.jsx("div",{className:"tl-error-boundary__overlay"}),e&&h.jsx(RR,{onError:qa,fallback:()=>null,children:h.jsx(Dd.Provider,{value:e,children:h.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:l?h.jsx(l,{}):null})})}),h.jsx("div",{className:be("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?h.jsxs(h.Fragment,{children:[h.jsx("h2",{children:"Are you sure?"}),h.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),h.jsxs("div",{className:"tl-error-boundary__content__actions",children:[h.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),h.jsx("button",{className:"tl-error-boundary__reset",onClick:g,children:"Reset data"})]})]}):h.jsxs(h.Fragment,{children:[h.jsx("h2",{children:"Something's gone wrong."}),h.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",h.jsx("a",{href:v.toString(),children:"create a GitHub issue"})," or"," ",h.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&h.jsxs(h.Fragment,{children:["Message:",h.jsx("h4",{children:h.jsx("code",{children:d})}),"Stack trace:",h.jsxs("div",{className:"tl-error-boundary__content__error",children:[h.jsx("pre",{children:h.jsx("code",{children:u??d})}),h.jsx("button",{onClick:y,children:i?"Copied!":"Copy"})]})]}),h.jsxs("div",{className:"tl-error-boundary__content__actions",children:[h.jsx("button",{onClick:()=>s(!r),children:r?"Hide details":"Show details"}),h.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[h.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),h.jsx("button",{className:"tl-error-boundary__refresh",onClick:S,children:"Refresh Page"})]})]})]})})]})};let Eq=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function lt(){return Eq()}const aO="TLDRAW_USER_DATA_v3",cO=je({id:Ee,name:Ee.nullable().optional(),locale:Ee.nullable().optional(),color:Ee.nullable().optional(),colorScheme:jd("light","dark","system").optional(),animationSpeed:Ie.nullable().optional(),edgeScrollSpeed:Ie.nullable().optional(),isSnapMode:Me.nullable().optional(),isWrapMode:Me.nullable().optional(),isDynamicSizeMode:Me.nullable().optional(),isPasteAtCursorMode:Me.nullable().optional()}),Jr={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},Zb=Math.max(...Object.values(Jr));function kq(t){t.version<Jr.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<Jr.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version<Jr.MakeFieldsNullable,t.version<Jr.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<Jr.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<Jr.AllowSystemColorScheme&&(t.user.isDarkMode===!0?t.user.colorScheme="dark":t.user.isDarkMode===!1&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<Jr.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<Jr.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version=Zb}const Rx=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function lO(){return Rx[Math.floor(Math.random()*Rx.length)]}function Tq(){return typeof window<"u"&&"matchMedia"in window?window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1:!1}const Qr=Object.freeze({name:"New User",locale:t6(),color:lO(),edgeScrollSpeed:1,animationSpeed:Tq()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function Sf(){return{id:lt(),color:lO()}}function dO(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return Sf();const e=Ye(t);kq(e);try{return cO.validate(e.user)}catch{return Sf()}}function Mq(){const t=JSON.parse(Ab(aO)||"null")??null;return dO(t)}const Fd=Tt("globalUserData",null);function Aq(){jb(aO,JSON.stringify({version:Zb,user:Fd.get()}))}function uO(t){cO.validate(t),Fd.set(t),Aq(),jq()}const hO=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;hO?.addEventListener("message",t=>{const e=t.data;e?.type===fO&&e?.origin!==pO()&&Fd.set(dO(e.data))});let vf=null;function pO(){return vf===null&&(vf=lt()),vf}const fO="tldraw-user-preferences-change";function jq(){hO?.postMessage({type:fO,origin:pO(),data:{user:gO(),version:Zb}})}function gO(){let t=Fd.get();return t||(t=Mq(),uO(t)),t}const Rq=J("defaultLocalStorageUserPrefs",()=>gO());function mO(t={}){return{userPreferences:t.userPreferences??Rq,setUserPreferences:t.setUserPreferences??uO}}var xf={exports:{}},W_;function Oq(){return W_||(W_=1,(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function i(c,l,d,u,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new s(d,u||c,p),m=n?n+l:l;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],f]:c._events[m].push(f):(c._events[m]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,u;if(this._eventsCount===0)return l;for(u in d=this._events)e.call(d,u)&&l.push(n?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=n?n+l:l,u=this._events[d];if(!u)return[];if(u.fn)return[u.fn];for(var p=0,f=u.length,m=new Array(f);p<f;p++)m[p]=u[p].fn;return m},a.prototype.listenerCount=function(l){var d=n?n+l:l,u=this._events[d];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,d,u,p,f,m){var y=n?n+l:l;if(!this._events[y])return!1;var S=this._events[y],g=arguments.length,v,x;if(S.fn){switch(S.once&&this.removeListener(l,S.fn,void 0,!0),g){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,u),!0;case 4:return S.fn.call(S.context,d,u,p),!0;case 5:return S.fn.call(S.context,d,u,p,f),!0;case 6:return S.fn.call(S.context,d,u,p,f,m),!0}for(x=1,v=new Array(g-1);x<g;x++)v[x-1]=arguments[x];S.fn.apply(S.context,v)}else{var b=S.length,E;for(x=0;x<b;x++)switch(S[x].once&&this.removeListener(l,S[x].fn,void 0,!0),g){case 1:S[x].fn.call(S[x].context);break;case 2:S[x].fn.call(S[x].context,d);break;case 3:S[x].fn.call(S[x].context,d,u);break;case 4:S[x].fn.call(S[x].context,d,u,p);break;default:if(!v)for(E=1,v=new Array(g-1);E<g;E++)v[E-1]=arguments[E];S[x].fn.apply(S[x].context,v)}}return!0},a.prototype.on=function(l,d,u){return i(this,l,d,u,!1)},a.prototype.once=function(l,d,u){return i(this,l,d,u,!0)},a.prototype.removeListener=function(l,d,u,p){var f=n?n+l:l;if(!this._events[f])return this;if(!d)return o(this,f),this;var m=this._events[f];if(m.fn)m.fn===d&&(!p||m.once)&&(!u||m.context===u)&&o(this,f);else{for(var y=0,S=[],g=m.length;y<g;y++)(m[y].fn!==d||p&&!m[y].once||u&&m[y].context!==u)&&S.push(m[y]);S.length?this._events[f]=S.length===1?S[0]:S:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=n?n+l:l,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(xf)),xf.exports}var Dq=Oq();const Lq=Ws(Dq),fo="TLDRAW_TAB_ID_v2",Us=globalThis.window;function Nq(){return Us?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Us.navigator.platform)||Us.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const sd=Us?Us[fo]??Oj(fo)??"TLDRAW_INSTANCE_STATE_V1_"+lt():"<error>";Us&&(Us[fo]=sd,Nq()?Rb(fo,sd):Dj(fo));Us?.addEventListener("beforeunload",()=>{Rb(fo,sd)});const yO={Initial:0},Bd=Math.max(...Object.values(yO));function Fq(t){t.version<yO.Initial,t.version=Bd}const SO=je({version:Ie,currentPageId:Ka,isFocusMode:Me,exportBackground:Me,isDebugMode:Me,isToolLocked:Me,isGridMode:Me,pageStates:$t(je({pageId:Ka,camera:je({x:Ie,y:Ie,z:Ie}),selectedShapeIds:$t(Qn),focusedGroupId:Qn.nullable()}))});function Bq(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;t.version!==Bd&&(t=Ye(t),Fq(t));try{return SO.validate(t)}catch(e){return console.warn(e),null}}function vO(t){const e=t.query.ids("page");return J("sessionStateSnapshot",()=>{const n=t.get(ln);if(!n)return null;const r=[...e.get()];return{version:Bd,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(s=>{const i=t.get(gr.createId(s)),o=t.get(jr.createId(s));return{pageId:s,camera:{x:o?.x??0,y:o?.y??0,z:o?.z??1},selectedShapeIds:i?.selectedShapeIds??[],focusedGroupId:i?.focusedGroupId??null}})}})}function xO(t,e){const n=Bq(e);if(!n)return;const r=t.schema.types.instance.create({id:ln,...oR(t.get(ln)),currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground}),s=t.allRecords().filter(i=>i.typeName==="instance_page_state"||i.typeName==="camera");t.atomic(()=>{t.remove(s.map(i=>i.id));for(const i of n.pageStates)t.put([jr.create({id:jr.createId(i.pageId),x:i.camera.x,y:i.camera.y,z:i.camera.z}),gr.create({id:gr.createId(i.pageId),pageId:i.pageId,selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId})]);t.put([r]),t.ensureStoreIsUsable()})}function $q(t){const e=[];for(const s of Object.values(t))s.typeName?.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const n=e.filter(s=>s.typeName==="instance"&&s.id!==ln)[0];if(!n)return null;const r={version:Bd,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===n.id).map(s=>{const i=t[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:i.x,y:i.y,z:i.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return SO.validate(r),r}catch{return null}}function Qb(t,e){let n={};if("store"in e){const s=t.schema.migrateStoreSnapshot(e);if(s.type!=="success")throw new Error("Failed to migrate store snapshot: "+s.reason);n.document={schema:t.schema.serialize(),store:ja(s.value,(i,{typeName:o})=>t.scopedTypes.document.has(o))}}else n=e;const r=oR(t.get(ln));t.atomic(()=>{n.document&&t.loadStoreSnapshot(n.document),r&&t.update(ln,s=>({...s,...r})),n.session&&xO(t,n.session)})}const zq=new ls;function bO(t){const n=zq.get(t,vO).get();if(!n)throw new Error("Session state is not ready yet");return{document:t.getStoreSnapshot(),session:n}}function wO(t){const e=[],n=new Set;for(const r of t){if(n.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function Ks({children:t,className:e="",...n}){return h.jsx("svg",{...n,className:be("tl-svg-container",e),children:t})}function Jb(t,e,n,r){const s=t.x-n.x,i=t.y-n.y,o=r.x-n.x,a=r.y-n.y,c=e.x-t.x,l=e.y-t.y,d=o*i-a*s,u=c*i-l*s,p=a*c-o*l;if(d===0||u===0||p===0)return null;if(p!==0){const f=d/p,m=u/p;if(0<=f&&f<=1&&0<=m&&m<=1)return w.AddXY(t,f*c,f*l)}return null}function bc(t,e,n,r){const s=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),i=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),o=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-r*r,a=i*i-4*s*o;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-i+c)/(2*s),d=(-i-c)/(2*s);if((l<0||l>1)&&(d<0||d>1))return null;const u=[];return 0<=l&&l<=1&&u.push(w.Lrp(t,e,l)),0<=d&&d<=1&&u.push(w.Lrp(t,e,d)),u.length===0?null:u}function Uq(t,e,n){const r=[];let s;for(let i=0,o=n.length-1;i<o;i++)s=Jb(t,e,n[i],n[i+1]),s&&r.push(s);return r.length===0?null:r}function ew(t,e,n){const r=[];let s;for(let i=1,o=n.length;i<o+1;i++)s=Jb(t,e,n[i-1],n[i%n.length]),s&&r.push(s);return r.length===0?null:r}function qq(t,e,n,r){let s=n.x-t.x,i=n.y-t.y;const o=Math.sqrt(s*s+i*i),a=(o*o-r*r+e*e)/(2*o),c=Math.sqrt(e*e-a*a);return s/=o,i/=o,[new w(t.x+s*a-i*c,t.y+i*a+s*c),new w(t.x+s*a+i*c,t.y+i*a-s*c)]}function Ox(t,e,n){const r=[];let s,i,o;for(let a=0,c=n.length;a<c;a++)s=n[a],i=n[(a+1)%n.length],o=bc(s,i,t,e),o&&r.push(...o);return r.length===0?null:r}function Y_(t,e,n){const r=[];let s,i,o;for(let a=1,c=n.length;a<c;a++)s=n[a-1],i=n[a],o=bc(s,i,t,e),o&&r.push(...o);return r.length===0?null:r}function ol(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function tw(t,e,n,r){return ol(t,n,r)!==ol(e,n,r)&&ol(t,e,n)!==ol(t,e,r)}function X_(t,e){const n=new Map;let r,s,i,o;for(let a=0,c=t.length;a<c;a++)if(r=t[a],Bn(r,e)){const l=bf(r);n.has(l)||n.set(l,r)}for(let a=0,c=e.length;a<c;a++)if(r=e[a],Bn(r,t)){const l=bf(r);n.has(l)||n.set(l,r)}for(let a=0,c=t.length;a<c;a++){r=t[a],s=t[(a+1)%t.length];for(let l=0,d=e.length;l<d;l++){i=e[l],o=e[(l+1)%e.length];const u=Jb(r,s,i,o);if(u!==null){const p=bf(u);n.has(p)||n.set(p,u)}}}return n.size===0?null:Hq([...n.values()])}function bf(t){return`${t.x},${t.y}`}function Hq(t){const e=w.Average(t);return t.sort((n,r)=>w.Angle(e,n)-w.Angle(e,r))}function CO(t,e){let n,r,s,i;for(let o=0,a=t.length;o<a;o++){n=t[o],r=t[(o+1)%a];for(let c=0,l=e.length;c<l;c++)if(s=e[c],i=e[(c+1)%l],tw(n,r,s,i))return!0}return!1}function Gq(t,e){let n,r,s,i;for(let o=0,a=t.length;o<a;o++){n=t[o],r=t[(o+1)%a];for(let c=1,l=e.length;c<l;c++)if(s=e[c-1],i=e[c],tw(n,r,s,i))return!0}return!1}class rs extends Zs{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{start:n,end:r}=e;this.start=n,this.end=r,this.d=n.clone().sub(r),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:n,end:r,u:s,ul:i}=this;if(i===0)return n;const o=w.Sub(e,n).dpr(s)/i,a=n.x+s.x*o;if(a<Math.min(n.x,r.x))return n.x<r.x?n:r;if(a>Math.max(n.x,r.x))return n.x>r.x?n:r;const c=n.y+s.y*o;return c<Math.min(n.y,r.y)?n.y<r.y?n:r:c>Math.max(n.y,r.y)?n.y>r.y?n:r:new w(a,c)}hitTestLineSegment(e,n,r=0){return tw(e,n,this.start,this.end)||this.distanceToLineSegment(e,n)<=r}getSvgPathData(e=!0){const{start:n,end:r}=this;return`${e?`M${n.toFixed()}`:""} L${r.toFixed()}`}}class No extends Zs{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});const{points:n}=e;this.points=n}_segments;get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let n=0,r=e.length-1;n<r;n++){const s=e[n],i=e[n+1];this._segments.push(new rs({start:s,end:i}))}this.isClosed&&this._segments.push(new rs({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,n)=>e+n.length,0)}getVertices(){return this.points}nearestPoint(e){const{segments:n}=this;let r=this.points[0],s=1/0,i,o;for(let a=0;a<n.length;a++)i=n[a].nearestPoint(e),o=w.Dist2(i,e),o<s&&(r=i,s=o);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,n,r=0){const{segments:s}=this;for(let i=0,o=s.length;i<o;i++)if(s[i].hitTestLineSegment(e,n,r))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce((n,r,s)=>s===0?`M ${r.x} ${r.y}`:`${n} L ${r.x} ${r.y}`,"")}}class mt extends No{constructor(e){super({...e}),this.isClosed=!0}}class us extends mt{x;y;w;h;constructor(e){const{x:n=0,y:r=0,width:s,height:i}=e;super({...e,points:[new w(n,r),new w(n+s,r),new w(n+s,r+i),new w(n,r+i)]}),this.x=n,this.y=r,this.w=s,this.h=i}getBounds(){return new ce(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:e,y:n,w:r,h:s}=this;return`M${e},${n} h${r} v${s} h-${r}z`}}class Qs{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canBind(e){return!0}canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;canBeLaidOut=()=>!0;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;canReceiveNewChildrenOfType(e,n){return!1}canDropShapes(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}function Kq(t,e,n={}){const{closed:r=!1,snap:s=1,start:i="outset",end:o="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,d=0,u=1,p=0,f=0;switch(c){case"dashed":{u=1,l=Math.min(e*a,t/4);break}case"dotted":{u=100,l=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(i==="outset"?(t+=l/2,f+=l/2):i==="skip"&&(t-=l,f-=l),o==="outset"?t+=l/2:o==="skip"&&(t-=l)),d=Math.floor(t/l/(2*u)),d-=d%s,d<3&&c==="dashed"?t/e<5?(l=t,d=1,p=0):(l=t*.333,p=t*.333):(d=Math.max(d,3),l=t/d/(2*u),r?(f=l/2,p=(t-d*l)/d):p=(t-d*l)/Math.max(1,d-1)),{strokeDasharray:[l,p].join(" "),strokeDashoffset:f.toString()}}function Z_({bounds:t,className:e}){const n=K(),r=X("zoom level",()=>n.getZoomLevel(),[n]);return h.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((s,i)=>{const{strokeDasharray:o,strokeDashoffset:a}=Kq(s[0].dist(s[1]),1/r,{style:"dashed",lengthRatio:4});return h.jsx("line",{x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y,strokeDasharray:o,strokeDashoffset:a},i)})})}class Vq extends Qs{static type="group";static props=SR;static migrations=vR;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){const n=this.editor.getSortedChildIdsForParent(e.id);return n.length===0?new us({width:1,height:1,isFilled:!1}):new xr({children:n.map(r=>{const s=this.editor.getShape(r),i=this.editor.getShapeGeometry(r),o=this.editor.getShapeLocalTransform(s).applyToPoints(i.vertices);return i.isClosed?new mt({points:o,isFilled:!0}):new No({points:o})})})}component(e){const n=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),s=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!n&&(i||s))return null;const o=this.editor.getShapeGeometry(e).bounds;return h.jsx(Ks,{id:e.id,children:h.jsx(Z_,{className:"tl-group",bounds:o})})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return h.jsx(Z_,{className:"",bounds:n})}onChildrenChange=e=>{const n=this.editor.getSortedChildIdsForParent(e.id);if(n.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(n.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(n,e.parentId),this.editor.deleteShapes([e.id]);return}}}const _O=[Vq],Wq=new Set(_O.map(t=>t.type));function IO(t){const e=[..._O],n=new Set;for(const r of t){if(Wq.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}const Yq={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function Q_(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw tn(t)}}class Xq{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[r,s]of this){if(!Q_(s,e.get(r)))return!1;n.add(r)}for(const[r,s]of e)if(!n.has(r)&&!Q_(s,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Dx extends Xq{set(e,n){this.map.set(e,n)}applyValue(e,n){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(e,{type:"mixed"});return;default:tn(r,"type")}}}function Zq(t,e,n){return Nr(t).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:n})})}const Qq="https://cdn.tldraw.com";function Os(){return`${Qq}/${jR}`}function Jq(t,e){let n=t;const r=new Set(e);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${n} 1`;return n}function al(t,e,n){if(n.length===0)return[];const r=new Map;for(const i of Te(n.map(o=>t.getShape(o)))){const{parentId:o}=i;r.has(o)||r.set(o,{children:Te(t.getSortedChildIdsForParent(o).map(a=>t.getShape(a))),moving:new Set}),r.get(o).moving.add(i)}const s=[];switch(e){case"toBack":{r.forEach(({moving:i,children:o})=>e8(i,o,s));break}case"toFront":{r.forEach(({moving:i,children:o})=>t8(i,o,s));break}case"forward":{r.forEach(({moving:i,children:o})=>n8(i,o,s));break}case"backward":{r.forEach(({moving:i,children:o})=>r8(i,o,s));break}}return s}function e8(t,e,n){const r=e.length;if(t.size===r)return;let s,i;for(let o=0;o<r;o++){const a=e[o];if(t.has(a))s=a.index,t.delete(a);else{i=a.index;break}}if(t.size!==0){const o=So(s,i,t.size);n.push(...Array.from(t.values()).sort(en).map((a,c)=>({...a,index:o[c]})))}}function t8(t,e,n){const r=e.length;if(t.size===r)return;let s,i;for(let o=r-1;o>-1;o--){const a=e[o];if(t.has(a))i=a.index,t.delete(a);else{s=a.index;break}}if(t.size!==0){const o=So(s,i,t.size);n.push(...Array.from(t.values()).sort(en).map((a,c)=>({...a,index:o[c]})))}}function n8(t,e,n){const r=e.length;if(t.size===r)return;let s={name:"skipping"};for(let i=0;i<r;i++){const o=t.has(e[i]);switch(s.name){case"skipping":{if(!o)continue;s={name:"selecting",selectIndex:i};break}case"selecting":{if(o)continue;const{selectIndex:a}=s;So(e[i].index,e[i+1]?.index,i-a).forEach((c,l)=>n.push({...e[a+l],index:c})),s={name:"skipping"};break}}}}function r8(t,e,n){const r=e.length;if(t.size===r)return;let s={name:"skipping"};for(let i=r-1;i>-1;i--){const o=t.has(e[i]);switch(s.name){case"skipping":{if(!o)continue;s={name:"selecting",selectIndex:i};break}case"selecting":{if(o)continue;So(e[i-1]?.index,e[i].index,s.selectIndex-i).forEach((a,c)=>{n.push({...e[i+c+1],index:a})}),s={name:"skipping"};break}}}}function PO({editor:t}){const e=t.getSelectedShapes(),n=t.getSelectionRotation(),r=t.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:s}}=t;if(!r)return null;const i=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:i,initialCursorAngle:i.angle(s),initialSelectionRotation:n,shapeSnapshots:e.map(o=>({shape:Ye(o),initialPagePoint:t.getShapePageTransform(o.id).point()}))}}function Dl({delta:t,editor:e,snapshot:n,stage:r}){const{selectionPageCenter:s,shapeSnapshots:i}=n;e.updateShapes(i.map(({shape:a,initialPagePoint:c})=>{const l=vn(a.parentId)?e.getShapePageTransform(a.parentId):se.Identity(),d=w.RotWith(c,s,t),u=se.applyToPoint(se.Inverse(l),d),p=zs(a.rotation+t);return{id:a.id,type:a.type,x:u.x,y:u.y,rotation:p}}));const o=[];i.forEach(({shape:a})=>{const c=e.getShape(a.id);if(!c)return;const l=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const u=l.onRotateStart?.(a);u&&o.push(u)}const d=l.onRotate?.(a,c);if(d&&o.push(d),r==="end"||r==="one-off"){const u=l.onRotateEnd?.(a,c);u&&o.push(u)}}),o.length>0&&e.updateShapes(o)}const s8=t=>{const{store:e}=t,n=e.query.filterHistory("binding"),r=e.query.records("binding");function s(){const i=r.get(),o=new Map;for(const a of i){const{fromId:c,toId:l}=a,d=o.get(c);d?d.push(a):o.set(c,[a]);const u=o.get(l);u?u.push(a):o.set(l,[a])}return o}return J("arrowBindingsIndex",(i,o)=>{if(mi(i))return s();const a=i,c=n.getDiffSince(o);if(c===Nn)return s();let l;function d(f){l??=new Map(a);const y=l.get(f.fromId)?.filter(v=>v.id!==f.id);y?.length?l.set(f.fromId,y):l.delete(f.fromId);const g=l.get(f.toId)?.filter(v=>v.id!==f.id);g?.length?l.set(f.toId,g):l.delete(f.toId)}function u(f){l??=new Map(a);let m=l.get(f);return m?m===a.get(f)&&(m=m.slice(0),l.set(f,m)):(m=[],l.set(f,m)),m}function p(f){u(f.fromId).push(f),u(f.toId).push(f)}for(const f of c){for(const m of ft(f.added))p(m);for(const[m,y]of ft(f.updated))d(m),p(y);for(const m of ft(f.removed))d(m)}return l??a})};function i8(t,e,n){const r=t.getShapeMaskedPageBounds(e);return r===void 0?!0:!n.includes(r)}const o8=t=>{function e(n){const r=n.getCurrentPageShapeIds(),s=n.getViewportPageBounds(),i=new Set;return r.forEach(o=>{i8(n,o,s)&&i.add(o)}),i}return J("getCulledShapes",n=>{if(mi(n))return e(t);const r=e(t);if(n.size!==r.size)return r;for(const s of n)if(!r.has(s))return r;return n})},a8=t=>{const e=t.query.ids("shape"),n=t.query.filterHistory("shape");function r(){const s={},i=e.get(),o=Array(i.size);return i.forEach(a=>o.push(t.get(a))),o.sort(en),o.forEach(a=>{s[a.parentId]||(s[a.parentId]=[]),s[a.parentId].push(a.id)}),s}return J("parentsToChildrenWithIndexes",(s,i)=>{if(mi(s))return r();const o=n.getDiffSince(i);if(o===Nn)return r();if(o.length===0)return s;let a=null;const c=u=>{a||(a={...s}),a[u]?a[u]===s[u]&&(a[u]=[...a[u]]):a[u]=[]},l=new Set;let d;for(let u=0,p=o.length;u<p;u++){d=o[u];for(const f of Object.values(d.added))ro(f)&&(c(f.parentId),a[f.parentId].push(f.id),l.add(a[f.parentId]));for(const[f,m]of Object.values(d.updated))if(ro(m)&&ro(f)){if(f.parentId!==m.parentId)c(f.parentId),c(m.parentId),a[f.parentId].splice(a[f.parentId].indexOf(m.id),1),a[m.parentId].push(m.id),l.add(a[m.parentId]);else if(f.index!==m.index){c(m.parentId);const y=a[m.parentId].indexOf(m.id);a[m.parentId][y]=m.id,l.add(a[m.parentId])}}for(const f of Object.values(d.removed))ro(f)&&(c(f.parentId),a[f.parentId].splice(a[f.parentId].indexOf(f.id),1))}for(const u of l){const p=Te(u.map(f=>t.get(f)));p.sort(en),u.splice(0,u.length,...p.map(f=>f.id))}return a??s})},wf=(t,e,n)=>{for(;!yn(n.parentId);){const r=t.get(n.parentId);if(!r)return!1;n=r}return n.parentId===e},c8=(t,e)=>{const n=t.query.ids("shape");let r=null;function s(){const i=e();return r=i,new Set([...n.get()].filter(o=>wf(t,i,t.get(o))))}return J("_shapeIdsInCurrentPage",(i,o)=>{if(mi(i))return s();const a=e();if(a!==r)return s();const c=t.history.getDiffSince(o);if(c===Nn)return s();const l=new Al(i);for(const u of c){for(const p of Object.values(u.added))ro(p)&&wf(t,a,p)&&l.add(p.id);for(const[p,f]of Object.values(u.updated))ro(f)&&(wf(t,a,f)?l.add(f.id):l.remove(f.id));for(const p of Object.keys(u.removed))vn(p)&&l.remove(p)}const d=l.get();return d?Sa(d.value,d.diff):i})},EO=_.createContext(null);function l8({context:t,editor:e,children:n}){return h.jsx(Dd.Provider,{value:e,children:h.jsx(EO.Provider,{value:t,children:n})})}function kO(){const t=_.useContext(EO);return t?{isDarkMode:t.isDarkMode}:null}async function d8(t,e,n={}){const r=typeof e[0]=="string"?e:e.map(E=>E.id);if(r.length===0)return;if(!window.document)throw Error("No document");const{scale:s=1,background:i=!1,padding:o=t.options.defaultSvgPadding,preserveAspectRatio:a=!1}=n,c=n.darkMode??t.user.getIsDarkMode(),l=ms({isDarkMode:c}),d=t.getShapeAndDescendantIds(r),u=t.getUnorderedRenderingShapes(!1).filter(({id:E})=>d.has(E));let p=null;if(n.bounds)p=n.bounds;else for(const{id:E}of u){const I=t.getShapeMaskedPageBounds(E);I&&(p?p.union(I):p=I.clone())}if(!p)return;const f=r.length===1&&t.isShapeOfType(t.getShape(r[0]),"frame")?r[0]:null;f||p.expandBy(o);const m=p.width*s,y=p.height*s;try{document.body.focus?.()}catch{}const S=[],g=new Map,v={isDarkMode:c,addExportDef:E=>{if(g.has(E.key))return;const I=(async()=>{const C=await E.getElement();C&&S.push(h.jsx(_.Fragment,{children:C},S.length))})();g.set(E.key,I)}},x=(await Promise.all(u.map(async({id:E,opacity:I,index:C,backgroundIndex:P})=>{if(E===f)return[];const k=t.getShape(E);if(t.isShapeOfType(k,"group"))return[];const T=t.getShapeUtil(k);let M=await T.toSvg?.(k,v),A=await T.toBackgroundSvg?.(k,v);if(!M&&!A){const F=t.getShapePageBounds(k);M=h.jsx("rect",{width:F.w,height:F.h,fill:l.solid,stroke:l.grey.pattern,strokeWidth:1})}let j=t.getShapePageTransform(k).toCssString();"scale"in k.props&&k.props.scale!==1&&(j=`${j} scale(${k.props.scale}, ${k.props.scale})`),M&&(M=h.jsx("g",{transform:j,opacity:I,children:M},k.id)),A&&(A=h.jsx("g",{transform:j,opacity:I,children:A},`bg_${k.id}`));const R=t.getShapeMask(k.id);if(R){const F=`mask_${k.id.replace(":","_")}`;S.push(h.jsx("clipPath",{id:F,children:h.jsx("path",{d:`M${R.map(({x:H,y:B})=>`${H},${B}`).join("L")}Z`})},S.length)),M&&(M=h.jsx("g",{clipPath:`url(#${F})`,children:M},k.id)),A&&(A=h.jsx("g",{clipPath:`url(#${F})`,children:A},`bg_${k.id}`))}const L=[];return M&&L.push({zIndex:C,element:M}),A&&L.push({zIndex:P,element:A}),L}))).flat();return await Promise.all(g.values()),{jsx:h.jsx(l8,{editor:t,context:v,children:h.jsxs("svg",{preserveAspectRatio:a||void 0,direction:"ltr",width:m,height:y,viewBox:`${p.minX} ${p.minY} ${p.width} ${p.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:i?f?l.solid:l.background:"transparent"},children:[h.jsx("defs",{children:S}),x.sort((E,I)=>E.zIndex-I.zIndex).map(({element:E})=>E)]})}),width:m,height:y}}const u8=40;class h8{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,n=lt())=>{this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};handlePointerEvent=e=>{switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=w.From(e.point),this._previousScreenPoint&&w.Dist2(this._previousScreenPoint,this._clickScreenPoint)>u8**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=w.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&w.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}class p8{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){const{editor:n}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>n.options.edgeScrollDelay){const s=n.options.edgeScrollEaseDuration>0?Mt.easeInCubic(Math.min(1,this._edgeScrollDuration/(n.options.edgeScrollDelay+n.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*s,y:r.y*s})}}getEdgeProximityFactors(e,n,r,s,i){const{editor:o}=this,a=o.options.edgeScrollDistance,c=r?o.options.coarsePointerWidth:0,l=e-c,d=e+c,u=s?0:a,p=i?n:n-a;return l<u?Math.min(1,(u-l)/a):d>p?-Math.min(1,(d-p)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:n,y:r}}}=e,s=e.getViewportScreenBounds(),{isCoarsePointer:i,insets:[o,a,c,l]}=e.getInstanceState(),d=this.getEdgeProximityFactors(n,s.w,i,l,a),u=this.getEdgeProximityFactors(r,s.h,i,o,c);return{x:d,y:u}}moveCameraWhenCloseToEdge(e){const{editor:n}=this;if(!n.inputs.isDragging||n.inputs.isPanning||n.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=n.getViewportScreenBounds(),s=r.w<1e3?.612:1,i=r.h<1e3?.612:1,o=n.getZoomLevel(),a=n.user.getEdgeScrollSpeed()*n.options.edgeScrollSpeed,c=a*e.x*s/o,l=a*e.y*i/o,{x:d,y:u,z:p}=n.getCamera();n.setCamera(new w(d+c,u+l,p))}}class f8{constructor(e){this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}class g8{constructor(e,n){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(s,i)=>{s.isFocused!==i.isFocused&&(i.isFocused?this.focus():this.blur(),this.updateContainerClass())});const r=e.getInstanceState().isFocused;n!==r&&e.updateInstanceState({isFocused:!!n}),this.updateContainerClass()}disposeSideEffectListener;updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){this.disposeSideEffectListener?.()}}function ca(t){return y8}class m8{length=0;head=null;tail=this;push(e){return new nw(e,this)}toArray(){return os}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const y8=new m8;class nw{constructor(e,n){this.head=e,this.tail=n,this.length=n.length+1}length;push(e){return new nw(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class S8{store;dispose;state="recording";pendingDiff=new x8;stacks=Tt("HistoryManager.stacks",{undos:ca(),redos:ca()},{isEqual:(e,n)=>e.undos===n.undos&&e.redos===n.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??qa,this.dispose=this.store.addHistoryInterceptor((n,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(n.changes),this.stacks.update(({undos:s})=>({undos:s,redos:ca()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(n.changes);break;case"paused":break;default:tn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch=(e,n)=>{const r=this.state;r!=="paused"&&n?.history&&(this.state=v8[n.history]);try{if(this._isInBatch)return Or(e),this;this._isInBatch=!0;try{Or(e)}catch(s){throw this.annotateError(s),s}finally{this._isInBatch=!1}return this}finally{this.state=r}};_undo=({pushToRedoStack:e,toMark:n=void 0})=>{const r=this.state;this.state="paused";try{let{undos:s,redos:i}=this.stacks.get();const o=this.pendingDiff.clear(),a=Uj(o),c=_x(o);e&&!a&&(i=i.push({type:"diff",diff:o}));let l=!1;if(a)for(;s.head?.type==="stop";){const d=s.head;if(s=s.tail,e&&(i=i.push(d)),d.id===n){l=!0;break}}if(!l)e:for(;s.head;){const d=s.head;switch(s=s.tail,e&&(i=i.push(d)),d.type){case"diff":Ra(c,[_x(d.diff)]);break;case"stop":if(!n||d.id===n)break e;break;default:tn(d)}}this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:i})}finally{this.state=r}return this};undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>{const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:n,redos:r}=this.stacks.get();if(r.length===0)return this;for(;r.head?.type==="stop";)n=n.push(r.head),r=r.tail;const s=ql();for(;r.head;){const i=r.head;if(n=n.push(i),r=r.tail,i.type==="diff")Ra(s,[i.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:n,redos:r})}finally{this.state=e}return this};bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);squashToMark=e=>{let n=this.stacks.get().undos;const r=[];for(;n.head&&!(n.head.type==="stop"&&n.head.id===e);)n.head.type==="diff"&&r.push(n.head.diff),n=n.tail;if(!n.head||n.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const s=ql();return Ra(s,r.reverse()),this.stacks.update(({redos:i})=>({undos:n.push({type:"diff",diff:s}),redos:i})),this};mark=(e=lt())=>(Or(()=>{this.flushPendingDiff(),this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"stop",id:e}),redos:r}))}),e);clear(){this.stacks.set({undos:ca(),redos:ca()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:n}=this.stacks.get();return{undos:e.toArray(),redos:n.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const v8={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class x8{diff=ql();isEmptyAtom=Tt("PendingDiff.isEmpty",!0);clear(){const e=this.diff;return this.diff=ql(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){Ra(this.diff,[e]),this.isEmptyAtom.set(Uj(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class b8{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,n=lt())=>{const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),r};reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop=e=>{const n=this.scribbleItems.get(e);if(!n)throw Error(`Scribble with id ${e} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n};addPoint=(e,n,r)=>{const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:i}=s,o={x:n,y:r,z:.5};return(!i||w.Dist(i,o)>=1)&&(s.next=o),s};tick=e=>{this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:c,prev:l}=n;c&&c!==l&&(n.prev=c,n.scribble.points.push(c)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-e)),n.timeoutMs+=e,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:s,prev:i,next:o,scribble:a}=n;switch(a.state){case"active":{o&&o!==i?(n.prev=o,a.points.push(o),r===0&&a.points.length>8&&a.points.shift()):s===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&s===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)})})}}var w8=Object.defineProperty,C8=Object.getOwnPropertyDescriptor,$d=(t,e,n,r)=>{for(var s=C8(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&w8(e,n,s),s};const _e=t=>Math.round(t*10**8)/10**8;function es(t,e,n,r,s){const i=t.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&_e(a.length)===_e(n)&&pr(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));if(i.length===0)return[];const o=new Set;return i.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!o.has(c)){o.add(c);const l=es(t,c,n,r,pr(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));i.push(...l)}}),i}function _8(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let r=e-1;r>=0;r--){const s=t[r];if(s.direction===n.direction&&n.gaps.every(i=>s.gaps.some(o=>_e(i.startEdge[0].x)===_e(o.startEdge[0].x)&&_e(i.startEdge[0].y)===_e(o.startEdge[0].y)&&_e(i.startEdge[1].x)===_e(o.startEdge[1].x)&&_e(i.startEdge[1].y)===_e(o.startEdge[1].y))&&s.gaps.some(o=>_e(i.endEdge[0].x)===_e(o.endEdge[0].x)&&_e(i.endEdge[0].y)===_e(o.endEdge[0].y)&&_e(i.endEdge[1].x)===_e(o.endEdge[1].x)&&_e(i.endEdge[1].y)===_e(o.endEdge[1].y)))){t.splice(e,1);break}}}}class wc{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const r=e.getShapePageTransform(n.id);if(!r)return;const i=e.getShapeUtil(n).getBoundsSnapGeometry(n).points??e.getShapeGeometry(n).bounds.cornersAndCenter;if(!(!r||!i))return i.map((o,a)=>{const{x:c,y:l}=se.applyToPoint(r,o);return{x:c,y:l,id:`${n.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),n=this.manager.getSnappableShapes(),r=[];for(const s of n){const i=e.get(s);i&&r.push(...i)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:er(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],n=[];let r,s;const i=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)s=i[c],r.pageBounds.maxX<s.pageBounds.minX&&aa(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)&&e.push({startNode:r,endNode:s,startEdge:[new w(r.pageBounds.maxX,r.pageBounds.minY),new w(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new w(s.pageBounds.minX,s.pageBounds.minY),new w(s.pageBounds.minX,s.pageBounds.maxY)],length:s.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:pr(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)})}const o=i.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<o.length;a++){r=o[a];for(let c=a+1;c<o.length;c++)s=o[c],r.pageBounds.maxY<s.pageBounds.minY&&aa(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)&&n.push({startNode:r,endNode:s,startEdge:[new w(r.pageBounds.minX,r.pageBounds.maxY),new w(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new w(s.pageBounds.minX,s.pageBounds.minY),new w(s.pageBounds.maxX,s.pageBounds.minY)],length:s.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:pr(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:s}){const i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=n.clone().translate(s),c=r.map(({x:S,y:g},v)=>({id:"selection:"+v,x:S+s.x,y:g+s.y})),l=o,d=[],u=[],p=new w(i,i);this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:p});const f=new w(e==="x"?0:d[0]?.nudge??0,e==="y"?0:u[0]?.nudge??0);p.x=0,p.y=0,d.length=0,u.length=0,c.forEach(S=>{S.x+=f.x,S.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:p});const m=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:u}),y=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u});return this.manager.setIndicators([...y,...m]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:n,handle:r,isAspectRatioLocked:s,isResizingFromCenter:i}){const o=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:l}=ce.Resize(e,r,i?n.x*2:n.x,i?n.y*2:n.y,s);let d=r;c<0&&(d=MU(d)),l<0&&(d=TU(d)),i&&(a.center=e.center);const u=d==="top"||d==="bottom",p=d==="left"||d==="right",f=J_(d,a),m=this.getSnappablePoints(),y=[],S=[],g=new w(o,o);this.collectPointSnaps({minOffset:g,nearestSnapsX:y,nearestSnapsY:S,otherNodeSnapPoints:m,selectionSnapPoints:f});const v=new w(u?0:y[0]?.nudge??0,p?0:S[0]?.nudge??0);if(s&&AU(d)&&v.len()!==0){const C=y.length&&S.length?Math.abs(v.x)<Math.abs(v.y)?"x":"y":y.length?"x":"y",P=e.aspectRatio;C==="x"?(S.length=0,v.y=v.x/P,(d==="bottom_left"||d==="top_right")&&(v.y=-v.y)):(y.length=0,v.x=v.y*P,(d==="bottom_left"||d==="top_right")&&(v.x=-v.x))}const x=w.Add(n,v),{box:b}=ce.Resize(e,r,i?x.x*2:x.x,i?x.y*2:x.y,s);i&&(b.center=e.center);const E=J_("any",b);y.length=0,S.length=0,g.x=0,g.y=0,this.collectPointSnaps({minOffset:g,nearestSnapsX:y,nearestSnapsY:S,otherNodeSnapPoints:m,selectionSnapPoints:E});const I=this.getPointSnapLines({nearestSnapsX:y,nearestSnapsY:S});return this.manager.setIndicators([...I]),{nudge:v}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:s,nearestSnapsY:i}){for(const o of e)for(const a of n){const c=w.Sub(o,a),l=Math.abs(c.x),d=Math.abs(c.y);_e(l)<=_e(r.x)&&(_e(l)<_e(r.x)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),r.x=l),_e(d)<=_e(r.y)&&(_e(d)<_e(r.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:r,nearestSnapsY:s}){const{horizontal:i,vertical:o}=this.getVisibleGaps();for(const a of i){if(!aa(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&_e(Math.abs(l))<=_e(n.x)){_e(Math.abs(l))<_e(n.x)&&(r.length=0),n.x=Math.abs(l);const g={type:"gap_center",gap:a,nudge:l},v=r.find(({type:b})=>b==="gap_center"),x=v&&pr(a.breadthIntersection[0],a.breadthIntersection[1],v.gap.breadthIntersection[0],v.gap.breadthIntersection[1]);v&&v.gap.length>a.length&&x?r[r.indexOf(v)]=g:(!v||!x)&&r.push(g)}const u=a.startNode.pageBounds.minX-a.length,p=e.maxX,f=u-p;_e(Math.abs(f))<=_e(n.x)&&(_e(Math.abs(f))<_e(n.x)&&(r.length=0),n.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const m=a.endNode.pageBounds.maxX+a.length,y=e.minX,S=m-y;_e(Math.abs(S))<=_e(n.x)&&(_e(Math.abs(S))<_e(n.x)&&(r.length=0),n.x=Math.abs(S),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:S}))}for(const a of o){if(!aa(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&_e(Math.abs(l))<=_e(n.y)){_e(Math.abs(l))<_e(n.y)&&(s.length=0),n.y=Math.abs(l);const g={type:"gap_center",gap:a,nudge:l},v=s.find(({type:b})=>b==="gap_center"),x=v&&aa(v.gap.breadthIntersection[0],v.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);v&&v.gap.length>a.length&&x?s[s.indexOf(v)]=g:(!v||!x)&&s.push(g);continue}const u=a.startNode.pageBounds.minY-a.length,p=e.maxY,f=u-p;_e(Math.abs(f))<=_e(n.y)&&(_e(Math.abs(f))<_e(n.y)&&(s.length=0),n.y=Math.abs(f),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const m=a.endNode.pageBounds.maxY+a.length,y=e.minY,S=m-y;_e(Math.abs(S))<=_e(n.y)&&(_e(Math.abs(S))<_e(n.y)&&(s.length=0),n.y=Math.abs(S),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:S}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const r={},s={};if(e.length>0){for(const i of e)if(i.type==="points"){const o=_e(i.points.otherPoint.x);r[o]||(r[o]=[]),r[o].push(i.points)}}if(n.length>0){for(const i of n)if(i.type==="points"){const o=_e(i.points.otherPoint.y);s[o]||(s[o]=[]),s[o].push(i.points)}}return Object.values(r).concat(Object.values(s)).map(i=>({id:lt(),type:"points",points:kb(i.map(o=>w.From(o.otherPoint)).concat(i.map(o=>w.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:s,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(n.length>0)for(const c of n){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:u,endNode:p,length:f,endEdge:m}}=c;switch(c.type){case"gap_center":{const y=(f-e.width)/2,S=pr(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:lt(),gaps:[...es(i,u.id,y,"backward",S),{startEdge:d,endEdge:o.left},{startEdge:o.right,endEdge:m},...es(i,p.id,y,"forward",S)]});break}case"gap_duplicate":{const y=pr(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:lt(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:d.map(S=>S.clone().addXY(-u.pageBounds.width,0))},{startEdge:d,endEdge:m},...es(i,p.id,f,"forward",y)]:[...es(i,u.id,f,"backward",y),{startEdge:d,endEdge:m},{startEdge:m.map(S=>S.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:u,endNode:p,length:f,endEdge:m}}=c;switch(c.type){case"gap_center":{const y=(f-e.height)/2,S=pr(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:lt(),gaps:[...es(s,u.id,y,"backward",S),{startEdge:d,endEdge:o.top},{startEdge:o.bottom,endEdge:m},...es(s,c.gap.endNode.id,y,"forward",S)]});break}case"gap_duplicate":{const y=pr(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:lt(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:d.map(S=>S.clone().addXY(0,-u.pageBounds.height))},{startEdge:d,endEdge:m},...es(s,p.id,f,"forward",y)]:[...es(s,u.id,f,"backward",y),{startEdge:d,endEdge:m},{startEdge:m.map(S=>S.clone().addXY(0,p.pageBounds.height)),endEdge:o.top}]})}break}}return _8(a),a}}$d([J],wc.prototype,"getSnapPointsCache");$d([J],wc.prototype,"getSnappablePoints");$d([J],wc.prototype,"getSnappableGapNodes");$d([J],wc.prototype,"getVisibleGaps");function J_(t,e){const{minX:n,maxX:r,minY:s,maxY:i}=e,o=[];switch(t){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:n,y:s})}switch(t){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:r,y:s})}switch(t){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:r,y:i})}switch(t){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:n,y:i})}return o}var I8=Object.defineProperty,P8=Object.getOwnPropertyDescriptor,E8=(t,e,n,r)=>{for(var s=P8(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&I8(e,n,s),s};const k8=()=>null,T8=()=>[];class TO{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",n=>{const r=e.getShapeUtil(n).getHandleSnapGeometry(n);return{outline:r.outline===void 0?e.getShapeGeometry(n):r.outline,points:r.points??[],getSelfSnapOutline:r.getSelfSnapOutline??k8,getSelfSnapPoints:r.getSelfSnapPoints??T8}})}*iterateSnapPointsInPageSpace(e,n){const r=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(n);if(r&&r.length){const s=er(this.editor.getShapePageTransform(e));for(const i of r)yield s.applyToPoint(i)}for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const i=this.getSnapGeometryCache().get(s)?.points;if(!i||!i.length)continue;const o=er(this.editor.getShapePageTransform(s));for(const a of i)yield o.applyToPoint(a)}}*iterateSnapOutlines(e,n){const r=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(n);r&&(yield{shapeId:e,outline:r});for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const i=this.getSnapGeometryCache().get(s)?.outline;i&&(yield{shapeId:s,outline:i})}}getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:r}){const s=this.manager.getSnapThreshold();let i=s,o=null;for(const l of this.iterateSnapPointsInPageSpace(e,n))w.DistMin(r,l,i)&&(i=w.Dist(r,l),o=l);if(o)return o;let a=s,c=null;for(const{shapeId:l,outline:d}of this.iterateSnapOutlines(e,n)){const u=er(this.editor.getShapePageTransform(l)),p=this.editor.getPointInShapeSpace(l,r),f=d.nearestPoint(p),m=u.applyToPoint(f);w.DistMin(r,m,a)&&(a=w.Dist(r,m),c=m)}return c||null}snapHandle({currentShapeId:e,handle:n}){const s=er(this.editor.getShapePageTransform(e)).applyToPoint(n),i=this.getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:s});return i?(this.manager.setIndicators([{id:lt(),type:"points",points:[i]}]),{nudge:w.Sub(i,s)}):null}}E8([J],TO.prototype,"getSnapGeometryCache");var M8=Object.defineProperty,A8=Object.getOwnPropertyDescriptor,rw=(t,e,n,r)=>{for(var s=A8(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&M8(e,n,s),s};class zd{constructor(e){this.editor=e,this.shapeBounds=new wc(this),this.handles=new TO(this)}shapeBounds;handles;_snapIndicators=Tt("snapLines",void 0);getIndicators(){return this._snapIndicators.get()??os}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,n=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),s=new Set,i=o=>{if(vn(o)){const c=e.getShape(o);c&&e.isShapeOfType(c,"frame")&&s.add(o)}const a=e.getSortedChildIdsForParent(o);for(const c of a){if(r.includes(c))continue;const l=e.getShape(c);if(!l||!e.getShapeUtil(l).canSnap(l))continue;const u=e.getShapePageBounds(c);if(u&&n.includes(u)){if(e.isShapeOfType(l,"group")){i(c);continue}s.add(c)}}};return i(this.getCurrentCommonAncestor()??e.getCurrentPageId()),s}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}rw([J],zd.prototype,"getSnapThreshold");rw([J],zd.prototype,"getSnappableShapes");rw([J],zd.prototype,"getCurrentCommonAncestor");const j8=/\r?\n|\r/g;function eI(t){return t.replace(j8,`
`).split(`
`).map(e=>e||" ").join(`
`)}const R8={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},O8=/\s/;class D8{constructor(e){this.editor=e;const n=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,n.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}baseElm;measureText=(e,n)=>{const r=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-style",n.fontStyle),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("font-size",n.fontSize+"px"),r.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),r.style.setProperty("max-width",n.maxWidth===null?null:n.maxWidth+"px"),r.style.setProperty("min-width",n.minWidth===null?null:n.minWidth+"px"),r.style.setProperty("padding",n.padding),r.style.setProperty("overflow-wrap",n.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=eI(e);const s=r.scrollWidth,i=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:i.width,h:i.height,scrollWidth:s}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const r=[],s=e.getBoundingClientRect(),i=-s.left,o=-s.top,a=new Range,c=e.childNodes[0];let l=0,d=null,u=null,p=0,f=0,m=!1;for(const y of e.childNodes)if(y.nodeType===Node.TEXT_NODE)for(const S of y.textContent??""){a.setStart(c,l),a.setEnd(c,l+S.length);const g=a.getClientRects(),v=g[g.length-1],x=v.top+o,b=v.left+i,E=v.right+i,I=b<f,C=O8.test(S);if(C!==u||x!==p||!d){if(d){if(n&&x!==p){m=!0;break}r.push(d)}d={box:{x:b,y:x,w:v.width,h:v.height},text:S},f=b}else I&&(d.box.x=b),d.box.w=I?d.box.w+v.width:E-d.box.x,d.text+=S;S===`
`&&(f=0),u=C,p=x,l+=S.length}return d&&r.push(d),{spans:r,didTruncate:m}}measureTextSpans(e,n){if(e==="")return[];const r=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const s=Math.ceil(n.width-n.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${s}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${n.fontSize}px`),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),r.style.setProperty("text-align",R8[n.textAlign]);const i=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip";i&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const o=eI(e);r.textContent=o;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:i});if(n.overflow==="truncate-ellipsis"&&c){r.textContent="…";const l=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${s-l}px`),r.textContent=o;const d=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,u=d[d.length-1];return d.push({text:"…",box:{x:Math.min(u.box.x+u.box.w,n.width-n.padding-l),y:u.box.y,w:l,h:u.box.h}}),d}return r.remove(),a}}const tI=Nj;class L8{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}cancelRaf;isPaused=!0;now=0;start=()=>{this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=tI(this.tick),this.now=Date.now()};tick=()=>{if(this.isPaused)return;const e=Date.now(),n=e-this.now;this.now=e,this.updatePointerVelocity(n),this.editor.emit("frame",n),this.editor.emit("tick",n),this.cancelRaf=tI(this.tick)};dispose=()=>{this.isPaused=!0,this.cancelRaf?.()};prevPoint=new w;updatePointerVelocity=e=>{const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:s}}}=this;if(e===0)return;const i=w.Sub(r,n);this.prevPoint=r.clone();const o=i.len(),a=o?i.div(o):new w(0,0),c=s.clone().lrp(a.mul(o/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),s.equals(c)||(this.editor.inputs.pointerVelocity=c)}}var N8=Object.defineProperty,F8=Object.getOwnPropertyDescriptor,ir=(t,e,n,r)=>{for(var s=F8(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&N8(e,n,s),s};class Hn{constructor(e,n){if(this.user=e,this.inferDarkMode=n,typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r?.matches&&this.systemColorScheme.set("dark"),r?.addEventListener("change",s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}systemColorScheme=Tt("systemColorScheme","light");updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Qr.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Qr.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Qr.name}getLocale(){return this.user.userPreferences.get().locale??Qr.locale}getColor(){return this.user.userPreferences.get().color??Qr.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Qr.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Qr.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Qr.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Qr.isPasteAtCursorMode}}ir([J],Hn.prototype,"getUserPreferences");ir([J],Hn.prototype,"getIsDarkMode");ir([J],Hn.prototype,"getEdgeScrollSpeed");ir([J],Hn.prototype,"getAnimationSpeed");ir([J],Hn.prototype,"getId");ir([J],Hn.prototype,"getName");ir([J],Hn.prototype,"getLocale");ir([J],Hn.prototype,"getColor");ir([J],Hn.prototype,"getIsSnapMode");ir([J],Hn.prototype,"getIsWrapMode");ir([J],Hn.prototype,"getIsDynamicResizeMode");ir([J],Hn.prototype,"getIsPasteAtCursorMode");const B8={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},$8=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Se{constructor(e,n){this.editor=e;const{id:r,children:s,initial:i,isLockable:o}=this.constructor;this.id=r,this._isActive=Tt("toolIsActive"+this.id,!1),this._current=Tt("toolState"+this.id,void 0),this._path=J("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=n??{},this.parent?s&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",s&&i&&(this.initial=i,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new xj}performanceTracker;static id;static initial;static children;static isLockable=!0;id;type;shapeType;initial;children;isLockable;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,n={})=>{const r=e.split(".");let s=this;for(let i=0;i<r.length;i++){const o=r[i],a=s.getCurrent(),c=s.children?.[o];if(!c)throw Error(`${s.id} - no child state exists with the id ${o}.`);if(a?.id!==c.id&&(a?.exit(n,o),s._current.set(c),c.enter(n,a?.id||"initial"),!c.getIsActive()))break;s=c}return this};handleEvent=e=>{const n=B8[e.name],r=this._current.__unsafe__getWithoutCapture();this[n]?.(e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)};enter=(e,n)=>{if(yt.measurePerformance.get()&&$8.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,n),this.children&&this.initial&&this.getIsActive()){const r=this.children[this.initial];this._current.set(r),r.enter(e,n)}};exit=(e,n)=>{yt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,n),this.getIsActive()||this.getCurrent()?.exit(e,n)};_currentToolIdMask=Tt("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onLongPress;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onTick;onEnter;onExit}class z8 extends Se{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const n=this.getCurrent();n&&n.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:n.id})}break}}}}var U8=Object.defineProperty,q8=Object.getOwnPropertyDescriptor,fe=(t,e,n,r)=>{for(var s=q8(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&U8(e,n,s),s};class he extends Lq{constructor({store:e,user:n,shapeUtils:r,bindingUtils:s,tools:i,getContainer:o,cameraOptions:a,initialState:c,autoFocus:l,inferDarkMode:d,options:u}){super(),this.options={...Yq,...u},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new S8({store:e,annotateError:P=>{this.annotateError(P,{origin:"history.batch",willCrashApp:!0}),this.crash(P)}}),this.snaps=new zd(this),this.timers=new Pz,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...k_,...a}),this.user=new Hn(n??mO(),d??!1),this.getContainer=o??(()=>document.body),this.textMeasure=new D8(this),this._tickManager=new L8(this);class p extends z8{static initial=c??""}this.root=new p(this),this.root.children={};const f=IO(r),m={},y={},S=new Map;for(const P of f){const k=new P(this);m[P.type]=k;const T=Wj(P.props??{});y[P.type]=T;for(const M of T.keys())if(!S.has(M.id))S.set(M.id,M);else if(S.get(M.id)!==M)throw Error(`Multiple style props with id "${M.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=m,this.styleProps=y;const g=wO(s),v={};for(const P of g){const k=new P(this);v[P.type]=k}this.bindingUtils=v;for(const P of[...i]){if(Dr(this.root.children,P.id))throw Error(`Can't override tool with id "${P.id}"`);this.root.children[P.id]=new P(this,this.root)}this.environment=new f8(this),this.scribbles=new b8(this);const x=(P,k)=>{let T=null;const M=P.selectedShapeIds.filter(R=>!k.has(R));M.length!==P.selectedShapeIds.length&&(T||(T={...P}),T.selectedShapeIds=M);const A=P.erasingShapeIds.filter(R=>!k.has(R));A.length!==P.erasingShapeIds.length&&(T||(T={...P}),T.erasingShapeIds=A),P.hoveredShapeId&&k.has(P.hoveredShapeId)&&(T||(T={...P}),T.hoveredShapeId=null),P.editingShapeId&&k.has(P.editingShapeId)&&(T||(T={...P}),T.editingShapeId=null);const j=P.hintingShapeIds.filter(R=>!k.has(R));return j.length!==P.hintingShapeIds.length&&(T||(T={...P}),T.hintingShapeIds=j),P.focusedGroupId&&k.has(P.focusedGroupId)&&(T||(T={...P}),T.focusedGroupId=null),T};this.sideEffects=this.store.sideEffects;let b=new Map;const E=new Set,I=new Set;let C=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{E.clear();for(const P of I){I.delete(P);const k=this.getShape(P);if(!k)continue;const M=this.getShapeUtil(k).onChildrenChange?.(k);M?.length&&this.updateShapes(M)}if(C.size){const P=C;C=new Set;for(const k of P)this.getBindingUtil(k).onOperationComplete?.()}if(b.size){const P=b;b=new Map;for(const k of P.values())this.getBindingUtil(k.binding).onAfterDelete?.(k)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(P,k)=>{for(const T of this.getBindingsInvolvingShape(k))C.add(T.type),T.fromId===k.id&&this.getBindingUtil(T).onAfterChangeFromShape?.({binding:T,shapeBefore:P,shapeAfter:k}),T.toId===k.id&&this.getBindingUtil(T).onAfterChangeToShape?.({binding:T,shapeBefore:P,shapeAfter:k});if(P.parentId!==k.parentId){const T=M=>{const A=this.getShape(M);if(A)for(const j of this.getBindingsInvolvingShape(A))C.add(j.type),j.fromId===A.id&&this.getBindingUtil(j).onAfterChangeFromShape?.({binding:j,shapeBefore:A,shapeAfter:A}),j.toId===A.id&&this.getBindingUtil(j).onAfterChangeToShape?.({binding:j,shapeBefore:A,shapeAfter:A})};T(k.id),this.visitDescendants(k.id,T)}if(P.parentId!==k.parentId&&yn(k.parentId)){const T=new Set([P.id]);this.visitDescendants(P.id,M=>{T.add(M)});for(const M of this.getPageStates()){if(M.pageId===k.parentId)continue;const A=x(M,T);A&&this.store.put([A])}}P.parentId&&vn(P.parentId)&&I.add(P.parentId),k.parentId!==P.parentId&&vn(k.parentId)&&I.add(k.parentId)},beforeDelete:P=>{if(E.has(P.id))return;P.parentId&&vn(P.parentId)&&I.add(P.parentId),E.add(P.id);const k=[];for(const A of this.getBindingsInvolvingShape(P)){C.add(A.type),k.push(A.id);const j=this.getBindingUtil(A);A.fromId===P.id?(j.onBeforeIsolateToShape?.({binding:A,removedShape:P}),j.onBeforeDeleteFromShape?.({binding:A,shape:P})):(j.onBeforeIsolateFromShape?.({binding:A,removedShape:P}),j.onBeforeDeleteToShape?.({binding:A,shape:P}))}k.length&&this.deleteBindings(k);const T=new Set([P.id]),M=Te(this.getPageStates().map(A=>x(A,T)));M.length&&this.store.put(M)}},binding:{beforeCreate:P=>{const k=this.getBindingUtil(P).onBeforeCreate?.({binding:P});return k||P},afterCreate:P=>{C.add(P.type),this.getBindingUtil(P).onAfterCreate?.({binding:P})},beforeChange:(P,k)=>{const T=this.getBindingUtil(k).onBeforeChange?.({bindingBefore:P,bindingAfter:k});return T||k},afterChange:(P,k)=>{C.add(k.type),this.getBindingUtil(k).onAfterChange?.({bindingBefore:P,bindingAfter:k})},beforeDelete:P=>{this.getBindingUtil(P).onBeforeDelete?.({binding:P})},afterDelete:P=>{this.getBindingUtil(P).onAfterDelete?.({binding:P}),C.add(P.type)}},page:{afterCreate:P=>{const k=jr.createId(P.id),T=gr.createId(P.id);this.store.has(k)||this.store.put([jr.create({id:k})]),this.store.has(T)||this.store.put([gr.create({id:T,pageId:P.id})])},afterDelete:(P,k)=>{if(this.getInstanceState()?.currentPageId===P.id){const A=this.getPages().find(j=>j.id!==P.id)?.id;A?this.store.put([{...this.getInstanceState(),currentPageId:A}]):k==="user"&&this.store.ensureStoreIsUsable()}const T=jr.createId(P.id),M=gr.createId(P.id);this.store.remove([T,M])}},instance:{afterChange:(P,k,T)=>{if(!this.store.has(k.currentPageId)){const M=this.store.has(P.currentPageId)?P.currentPageId:this.getPages()[0]?.id;M?this.store.update(k.id,A=>({...A,currentPageId:M})):T==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(P,k)=>{if(P?.selectedShapeIds!==k?.selectedShapeIds){const T=k.selectedShapeIds.filter(A=>{let j=this.getShape(A)?.parentId;for(;vn(j);){if(k.selectedShapeIds.includes(j))return!1;j=this.getShape(j)?.parentId}return!0});let M=null;if(T.length>0){const A=this.findCommonAncestor(Te(T.map(j=>this.getShape(j))),j=>this.isShapeOfType(j,"group"));A&&(M=A)}else k?.focusedGroupId&&(M=k.focusedGroupId);(T.length!==k.selectedShapeIds.length||M!==k.focusedGroupId)&&this.store.put([{...k,selectedShapeIds:T,focusedGroupId:M??null}])}}}})),this._currentPageShapeIds=c8(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=a8(this.store),this.disposables.add(this.store.listen(P=>{this.emit("change",P)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new p8(this),this.focusManager=new g8(this,l),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new xj}options;store;root;disposables=new Set;isDisposed=!1;_tickManager;snaps;timers;user;textMeasure;environment;scribbles;sideEffects;edgeScrollManager;focusManager;getContainer;dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}shapeUtils;styleProps;getShapeUtil(e){const n=typeof e=="string"?e:e.type,r=Cn(this.shapeUtils,n);return Ze(r,`No shape util found for type "${n}"`),r}bindingUtils;getBindingUtil(e){const n=typeof e=="string"?e:e.type,r=Cn(this.bindingUtils,n);return Ze(r,`No binding util found for type "${n}"`),r}history;undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return this.history.mark(e),this}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}_shouldIgnoreShapeLock=!1;run(e,n){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=n?.ignoreShapeLock??r;try{this.history.batch(e,n)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,n){return this.run(e,n)}annotateError(e,{origin:n,willCrashApp:r,tags:s,extras:i}){const o=this.createErrorAnnotations(n,r);return Tb(e,{tags:{...o.tags,...s},extras:{...o.extras,...i}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,n){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:n},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:n},extras:{}}}}_crashingError=null;getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const s=n.pop();if(!s)return!0;const i=r.getCurrent();if(i?.id===s){if(n.length===0)return!0;r=i;continue}else return!1}return!1}isInAny(...e){return e.some(n=>this.isIn(n))}setCurrentTool(e,n={}){return this.root.transition(e,n),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const s=n.pop();if(!s)return r;const i=r.children?.[s];if(!i)return;r=i}return r}getDocumentSettings(){return this.store.get(Ex)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ln)}updateInstanceState(e,n){return this._updateInstanceState(e,{history:"ignore",...n}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState=(e,n)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},n)};_isChangingStyleTimeout=-1;getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){const n=new Set(this.getOpenMenus());return n.has(e)||(n.add(e),this.updateInstanceState({openMenus:[...n]})),this}deleteOpenMenu(e){const n=new Set(this.getOpenMenus());return n.has(e)&&(n.delete(e),this.updateInstanceState({openMenus:[...n]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}setCursor=e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this);getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return gr.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState=e=>{this.store.update(e.id??this.getCurrentPageState().id,n=>({...n,...e}))};getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return Te(e.map(n=>this.store.get(n)))}setSelectedShapes(e){return this.run(()=>{const n=e.map(i=>typeof i=="string"?i:i.id),{selectedShapeIds:r}=this.getCurrentPageState(),s=new Set(r);if(n.length===s.size&&n.every(i=>s.has(i)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const n=typeof e=="string"?e:e?.id??null,r=this.getShape(n);if(!r)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,i=>s.includes(i.id))}select(...e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(n),this}deselect(...e){const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=this.getSelectedShapeIds();return r.length>0&&n.length>0&&this.setSelectedShapes(r.filter(s=>!n.includes(s))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getSelectionPageBounds(){const e=this.getCurrentPageState().selectedShapeIds;return e.length===0?null:ce.Common(Te(e.map(n=>this.getShapePageBounds(n))))}getSelectionRotation(){const e=this.getSelectedShapeIds();let n=!1,r=0;for(let s=0,i=e.length;s<i;s++){const o=this.getShapePageTransform(e[s]);if(o)if(n){if(o.rotation()!==r)return 0}else n=!0,r=o.rotation()}return r}getSelectionRotatedPageBounds(){const e=this.getSelectedShapeIds();if(e.length===0)return;const n=this.getSelectionRotation();if(n===0)return this.getSelectionPageBounds();if(e.length===1){const s=this.getShapeGeometry(e[0]).bounds.clone(),i=this.getShapePageTransform(e[0]);return s.point=i.applyToPoint(s.point),s}const r=ce.FromPoints(this.getSelectedShapeIds().flatMap(s=>{const i=this.getShapePageTransform(s);return i?i.applyToPoints(this.getShapeGeometry(s).bounds.corners):[]}).map(s=>s.rot(-n)));return r.point=r.point.rot(n),r}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),s=this.getZoomLevel();return new ce(n,r,e.width*s,e.height*s)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const n=typeof e=="string"?e:e?.id??null;if(n!==null){const r=this.getShape(n);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${n} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return n===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const n=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup(n?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const n=typeof e=="string"?e:e?.id??null;if(n!==this.getEditingShapeId()){if(n){const r=this.getShape(n);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:n})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const n=typeof e=="string"?e:e?.id??null;return n===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:n})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return Te(e.map(n=>this.getShape(n)))}setHintingShapes(e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:kb(n)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return Te(e.map(n=>this.getShape(n)))}setErasingShapes(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id);n.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(n.length===r.length){for(let s=0;s<n.length;s++)if(n[s]!==r[s]){this._updateCurrentPageState({erasingShapeIds:n});break}}else this._updateCurrentPageState({erasingShapeIds:n})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const n=typeof e=="string"?e:e?.id??null;return n!==this.getCroppingShapeId()&&this.run(()=>{if(!n)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(n),s=this.getShapeUtil(r);r&&s.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:n})}},{history:"ignore"}),this}_unsafe_getCameraId(){return jr.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const n=this.getCameraForFollowing();if(n)return{...e,...n}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const n=this.getCollaborators().find(u=>u.userId===e);if(!n)return null;const{w:r,h:s}=n.screenBounds,{x:i,y:o,z:a}=n.camera,c=new ce(-i,-o,r/a,s/a),l=this.getViewportScreenBounds().clone(),d=l.width/l.height;return l.width=c.width,l.height=l.width/d,l.height<c.height&&(l.height=c.height,l.width=l.height*d),l.center=c.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:n,zy:r}=rI(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw tn(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:n,zy:r}=rI(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw tn(e.constraints.baseZoom)}}_cameraOptions=Tt("camera options",k_);getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){const n=Ye({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return n.zoomSteps?.length<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this}getConstrainedCamera(e,n){const r=this.getCamera();let{x:s,y:i,z:o=r.z}=e;if(!n?.force){const a=this.getCameraOptions(),c=a.zoomSteps[0],l=Bt(a.zoomSteps),d=this.getViewportScreenBounds();if(a.constraints){const{constraints:u}=a,p=Math.min(u.padding.y,d.w/2),f=Math.min(u.padding.x,d.h/2),m=ce.From(a.constraints.bounds),y=(d.w-f*2)/m.w,S=(d.h-p*2)/m.h,g=this.getBaseZoom(),v=l*g,x=c*g;if(n?.reset&&(o=this.getInitialZoom()),o<x||o>v){const{x:A,y:j,z:R}=r,L=-A+d.w/R/2,F=-j+d.h/R/2;o=Et(o,x,v);const H=-A+d.w/o/2,B=-j+d.h/o/2;s=A+H-L,i=j+B-F}const b=f/o-m.x,E=p/o-m.y,I=(d.w-f*2)/o-m.w,C=(d.h-p*2)/o-m.h,P=b+I*u.origin.x,k=E+C*u.origin.y,T=typeof u.behavior=="string"?u.behavior:u.behavior.x,M=typeof u.behavior=="string"?u.behavior:u.behavior.y;if(n?.reset)s=P,i=k;else{switch(T){case"fixed":{s=P;break}case"contain":{o<y?s=P:s=Et(s,b+I,b);break}case"inside":{o<y?s=Et(s,b,(d.w-f)/o-m.w):s=Et(s,b+I,b);break}case"outside":{s=Et(s,f/o-m.w,(d.w-f)/o);break}case"free":break;default:throw tn(T)}switch(M){case"fixed":{i=k;break}case"contain":{o<S?i=k:i=Et(i,E+C,E);break}case"inside":{o<S?i=Et(i,E,(d.h-p)/o-m.h):i=Et(i,E+C,E);break}case"outside":{i=Et(i,p/o-m.h,(d.h-p)/o);break}case"free":break;default:throw tn(M)}}}else if(o>l||o<c){const{x:u,y:p,z:f}=r;o=Et(o,c,l),s=u+(-u+d.w/o/2)-(-u+d.w/f/2),i=p+(-p+d.h/o/2)-(-p+d.h/f/2)}}return{x:s,y:i,z:o}}_setCamera(e,n){const r=this.getCamera(),{x:s,y:i,z:o}=this.getConstrainedCamera(e,n);return r.x===s&&r.y===i&&r.z===o?this:(Or(()=>{const a={...r,x:s,y:i,z:o};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:l}=this.inputs,{screenBounds:d}=this.store.unsafeGetWithoutCapture(ln);if(c.x/o-s!==l.x||c.y/o-i!==l.y){const u={type:"pointer",target:"canvas",name:"pointer_move",point:w.AddXY(c,d.x,d.y),pointerId:T_.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};n?.immediate?this._flushEventForTick(u):this.dispatch(u)}this._tickCameraState()}),this)}setCamera(e,n){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!n?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const s=w.Cast(e);Number.isFinite(s.x)||(s.x=0),Number.isFinite(s.y)||(s.y=0),(s.z===void 0||!Number.isFinite(s.z))&&(e.z=this.getZoomLevel());const i=this.getConstrainedCamera(s,n);if(n?.animation){const{width:o,height:a}=this.getViewportScreenBounds();this._animateToViewport(new ce(-i.x,-i.y,o/i.z,a/i.z),n)}else this._setCamera(i,{...n,force:!0});return this}centerOnPoint(e,n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{width:s,height:i}=this.getViewportPageBounds();return this.setCamera(new w(-(e.x-s/2),-(e.y-i/2),this.getCamera().z),n),this}zoomToFit(e){const n=[...this.getCurrentPageShapeIds()];if(n.length<=0)return this;const r=ce.Common(Te(n.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),n){const{isLocked:r,constraints:s}=this.getCameraOptions();if(r&&!n?.force)return this;const i=this.getCamera(),{x:o,y:a,z:c}=i,{x:l,y:d}=e;let u=1;if(s){const p=this.getInitialZoom();c!==p&&(u=p)}return this.setCamera(new w(o+(l/u-l)-(l/c-l),a+(d/u-d)-(d/c-d),u),n),this}zoomIn(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{x:s,y:i,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let l=Bt(a)*c;for(let d=1;d<a.length;d++){const u=a[d-1]*c,p=a[d]*c;if(!(p-o<=(p-u)/2)){l=p;break}}this.setCamera(new w(s+(e.x/l-e.x)-(e.x/o-e.x),i+(e.y/l-e.y)-(e.y/o-e.y),l),n)}return this}zoomOut(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{zoomSteps:s}=this.getCameraOptions();if(s!==null&&s.length>1){const i=this.getBaseZoom(),{x:o,y:a,z:c}=this.getCamera();let l=s[0]*i;for(let d=s.length-1;d>0;d--){const u=s[d-1]*i,p=s[d]*i;if(!(p-c>=(p-u)/2)){l=u;break}}this.setCamera(new w(o+(e.x/l-e.x)-(e.x/c-e.x),a+(e.y/l-e.y)-(e.y/c-e.y),l),n)}return this}zoomToSelection(e){const{isLocked:n}=this.getCameraOptions();if(n&&!e?.force)return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,n){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!n?.force)return this;const s=this.getViewportScreenBounds(),i=n?.inset??Math.min(S6,s.width*.28),o=this.getBaseZoom(),a=r.zoomSteps[0],c=Bt(r.zoomSteps);let l=Et(Math.min((s.width-i)/e.w,(s.height-i)/e.h),a*o,c*o);return n?.targetZoom!==void 0&&(l=Math.min(n.targetZoom,l)),this.setCamera(new w(-e.x+(s.width-e.w*l)/2/l,-e.y+(s.height-e.h*l)/2/l,l),n),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_viewportAnimation=null;_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:n,easing:r,duration:s,start:i,end:o}=this._viewportAnimation;if(n>s){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new w(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}const a=s-n,c=r(1-a/s),l=i.minX+(o.minX-i.minX)*c,d=i.minY+(o.minY-i.minY)*c,u=i.maxX+(o.maxX-i.maxX)*c;this._setCamera(new w(-l,-d,this.getViewportScreenBounds().width/(u-l)),{force:!0})}_animateToViewport(e,n={animation:mf}){const{animation:r,...s}=n;if(!r)return;const{duration:i=0,easing:o=Mt.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||a===0?this._setCamera(new w(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...s}):(this._viewportAnimation={elapsed:0,duration:i/a,easing:o,start:c.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:n}=this.getCameraOptions();if(n&&!e?.force)return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:s,friction:i=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let c=Math.min(s,1);const l=()=>{this.off("tick",d),this.off("stop-camera-animation",l)};this.once("stop-camera-animation",l);const d=u=>{const{x:p,y:f,z:m}=this.getCamera(),y=w.Mul(o,c*u/m);c*=1-i,c<a?l():this._setCamera(new w(p+y.x,f+y.y,m))};return this.on("tick",d),this}zoomToUser(e,n={animation:{duration:500}}){const r=this.getCollaborators().find(s=>s.userId===e);return r?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=r.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(r.currentPageId),n&&n.animation&&!s&&(n.animation=void 0),this.centerOnPoint(r.cursor,n);const{highlightedUserIds:i}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...i,e]}),this.timers.setTimeout(()=>{const o=[...this.getInstanceState().highlightedUserIds],a=o.indexOf(e);a<0||(o.splice(a,1),this.updateInstanceState({highlightedUserIds:o}))},this.options.collaboratorIdleTimeoutMs)}),this):this}_willSetInitialBounds=!0;updateViewportScreenBounds(e,n=!1){e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!$s(document.body.scrollWidth,e.maxX,1),!$s(document.body.scrollHeight,e.maxY,1),e.minX!==0],{screenBounds:s,insets:i}=this.getInstanceState();if(e.equals(s)&&r.every((a,c)=>a===i[c]))return this;const{_willSetInitialBounds:o}=this;if(this._willSetInitialBounds=!1,o)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(n&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(w.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:n,w:r,h:s}=this.getInstanceState().screenBounds;return new ce(e,n,r,s)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new w(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:n}=this.getViewportScreenBounds(),{x:r,y:s,z:i}=this.getCamera();return new ce(-r,-s,e/i,n/i)}screenToPage(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(ln),{x:r,y:s,z:i=1}=this.getCamera();return new w((e.x-n.x)/i-r,(e.y-n.y)/i-s,e.z??.5)}pageToScreen(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(ln),{x:r,y:s,z:i=1}=this.getCamera();return new w((e.x+r)*i+n.x,(e.y+s)*i+n.y,e.z??.5)}pageToViewport(e){const{x:n,y:r,z:s=1}=this.getCamera();return new w((e.x+n)*s,(e.y+r)*s,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(i=>i.userId===r).sort((i,o)=>o.lastActivityTimestamp-i.lastActivityTimestamp)[0]):os}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(n=>n.currentPageId===e)}_isLockedOnFollowingUser=Tt("isLockedOnFollowingUser",!1);startFollowingUser(e){this.stopFollowingUser();const n=this._getCollaboratorsQuery().get().filter(i=>i.userId===e);if(!n.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),n.some(i=>i.followingUserId===r))return this;const s=J("latestLeaderPresence",()=>this.getCollaborators().find(i=>i.userId===e));return Or(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const i=Oi("update current page",()=>{const c=s.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),o=()=>{i(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",o)},a=()=>{if(!s.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const l=this.user.getAnimationSpeed();if(l===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const u=this.getViewportPageBounds(),p=Math.abs(d.minX-u.minX)+Math.abs(d.maxX-u.maxX),f=Math.abs(d.minY-u.minY)+Math.abs(d.maxY-u.maxY);if(p<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const m=Et(l*.5,.1,.8),y=new ce(xn(u.minX,d.minX,m),xn(u.minY,d.minY,m),xn(u.width,d.width,m),xn(u.height,d.height,m)),S=new w(-y.x,-y.y,this.getViewportScreenBounds().width/y.width);this.stopCameraAnimation(),this._setCamera(S)};this.once("stop-following",o),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const n=[];let r=this.options.maxShapesPerPage*2,s=this.options.maxShapesPerPage;const i=this.getErasingShapeIds(),o=(c,l,d)=>{const u=this.getShape(c);if(!u)return;l*=u.opacity;let p=!1;const f=this.getShapeUtil(u);e&&(p=!d&&i.includes(c),p&&(l*=.32)),n.push({id:c,shape:u,util:f,index:r,backgroundIndex:s,opacity:l}),r+=1,s+=1;const m=this.getSortedChildIdsForParent(c);if(!m.length)return;let y=null;f.providesBackgroundForChildren(u)&&(y=s,s=r,r+=this.options.maxShapesPerPage);for(const S of m)o(S,l,d||p);y!==null&&(s=y)},a=e?[this.getCurrentPage()]:this.getPages();for(const c of a)for(const l of this.getSortedChildIdsForParent(c.id))o(l,1,!1);return n}_cameraState=Tt("camera state","idle");_cameraStateTimeoutRemaining=0;_decayCameraStateTimeout=e=>{this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))};_tickCameraState=()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))};getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(bz)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(en)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}_currentPageShapeIds;getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const n=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:n}});return this.getShapeAndDescendantIds(r.map(s=>s.id))}setCurrentPage(e){const n=typeof e=="string"?e:e.id;return this.store.has(n)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:n}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getInstanceState().isReadonly?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const n=this.getPages(),r=Jq(e.name??"Page 1",n.map(o=>o.name));let s=e.index;(!s||n.some(o=>o.index===s))&&(s=fr(n[n.length-1].index));const i=ds.create({meta:{},...e,name:r,index:s});this.store.put([i])}),this}deletePage(e){const n=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;const r=this.getPages();if(r.length===1)return;const s=this.getPage(n);if(s){if(n===this.getCurrentPageId()){const i=r.findIndex(a=>a.id===n),o=r[i-1]??r[i+1];this.setCurrentPage(o.id)}this.store.remove([s.id])}}),this}duplicatePage(e,n=ds.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,s=this.getPage(r);if(!s)return this;const i={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.run(()=>{const a=this.getPages(),c=Ha(s.index,a[a.indexOf(s)+1]?.index);if(this.createPage({name:s.name+" Copy",id:n,index:c}),this.setCurrentPage(n),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,n){const r=typeof e=="string"?e:e.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:r,name:n}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(n=>({...this.store.get(n.id),...n})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getInstanceState().isReadonly)return this;const n=typeof e[0]=="string"?e:e.map(r=>r.id);return n.length<=0?this:(this.run(()=>this.store.remove(n),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,n){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:s=1,shouldResolveToOriginal:i=!1}=n,a=Math.max(.125,(d=>Math.pow(2,Math.ceil(Math.log2(d))))(s)),c="connection"in navigator?navigator.connection.effectiveType:null,l=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(r,{screenScale:s||1,steppedScreenScale:a,dpr:l,networkEffectiveType:c,shouldResolveToOriginal:i})}async uploadAsset(e,n){return await this.store.props.assets.upload(e,n)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,n)=>e.props===n.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e))}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);if(!r)throw Error("Editor.getTransform: shape not found");return se.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(yn(e.parentId))return this.getShapeLocalTransform(e);const n=this._getShapePageTransformCache().get(e.parentId)??se.Identity();return se.Compose(n,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);return!r||yn(r.parentId)?se.Identity():this._getShapePageTransformCache().get(r.parentId)??se.Identity()}getShapePageTransform(e){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n)??se.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const n=this._getShapePageTransformCache().get(e.id);return n?ce.FromPoints(se.applyToPoints(n,this.getShapeGeometry(e).vertices)):new ce})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const n=this._getShapeMaskCache().get(e.id);if(!n)return;if(n.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${se.applyToPoints(se.Inverse(r),n).map(i=>`${i.x}px ${i.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(yn(e.parentId))return;const n=this.getShapeAncestors(e.id).filter(s=>this.isShapeOfType(s,"frame"));return n.length===0?void 0:n.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,i)=>{if(!(i&&s))return;const o=X_(s,i);return o?o.map(w.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const n=this._getShapePageBoundsCache().get(e.id);if(!n)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:s}=n;if(s.every((o,a)=>o&&w.Equals(o,r[a])))return n.clone();const i=X_(r,s);return i?ce.FromPoints(i):void 0}return n})}getShapeAncestors(e,n=[]){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return n;const i=s.parentId;if(yn(i))return n.reverse(),n;const o=this.store.get(i);return o?(n.push(o),this.getShapeAncestors(o,n)):n}findShapeAncestor(e,n){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return;const i=s.parentId;if(yn(i))return;const o=this.getShape(i);if(o)return n(o)?o:this.findShapeAncestor(o,n)}hasAncestor(e,n){const r=typeof e=="string"?e:e?.id,s=r&&this.getShape(r);return s?s.parentId===n?!0:this.hasAncestor(this.getShapeParent(s),n):!1}findCommonAncestor(e,n){if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(c=>c.id),s=Te(r.map(c=>this.getShape(c)));if(s.length===1){const c=s[0].parentId;return yn(c)?void 0:n?this.findShapeAncestor(s[0],n)?.id:c}const[i,...o]=s;let a=this.getShapeParent(i);for(;a;){if(n&&!n(a)){a=this.getShapeParent(a);continue}if(o.every(c=>this.hasAncestor(c,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const n=typeof e=="string"?this.getShape(e):e;return n===void 0?!1:n.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(n))}_notVisibleShapes(){return o8(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),n=this.getSelectedShapeIds(),r=this.getEditingShapeId(),s=new Set(e);return r&&s.delete(r),n.forEach(i=>{s.delete(i)}),s}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(n=>{const r=this.getShapeMaskedPageBounds(n);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const n=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&n.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,n={}){const r=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:i,margin:o=0,hitLocked:a=!1,hitLabels:c=!1,hitInside:l=!1,hitFrameInside:d=!1}=n;let u=1/0,p=null,f=1/0,m=null;const y=(n.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(S=>{if(S.isLocked&&!a||this.isShapeOfType(S,"group"))return!1;const g=this.getShapeMask(S);return g&&!Bn(e,g)?!1:i?i(S):!0});for(let S=y.length-1;S>=0;S--){const g=y[S],v=this.getShapeGeometry(g),x=v instanceof xr,b=this.getPointInShapeSpace(g,e);if((this.isShapeOfType(g,"arrow")||this.isShapeOfType(g,"geo")&&g.props.fill==="none")&&g.props.text.trim()){for(const I of v.children)if(I.isLabel&&I.isPointInBounds(b))return g}if(this.isShapeOfType(g,"frame")){const I=v.distanceToPoint(b,l);if(Math.abs(I)<=o)return m||g;if(v.hitTestPoint(b,0,!0))return m||p||(d?g:void 0);continue}let E;if(x){let I=1/0;for(const C of v.children){if(C.isLabel&&!c)continue;const P=C.distanceToPoint(b,l);P<I&&(I=P)}E=I}else o===0&&(v.bounds.w<1||v.bounds.h<1)||v.bounds.containsPoint(b,o)?E=v.distanceToPoint(b,l):E=1/0;if(v.isClosed){if(E<=o){if(v.isFilled||x&&v.children[0].isFilled)return m||g;if(this.getShapePageBounds(g).contains(s))continue;if(Math.abs(E)<o)Math.abs(E)<f&&(f=Math.abs(E),m=g);else if(!m){const{area:I}=v;I<u&&(u=I,p=g)}}}else if(E<this.options.hitTestMargin/r)return g}return m||p||void 0}getShapesAtPoint(e,n={}){return this.getCurrentPageShapes().filter(r=>this.isPointInShape(r,e,n))}isPointInShape(e,n,r={}){const{hitInside:s=!1,margin:i=0}=r,o=typeof e=="string"?e:e.id,a=this.getShapeMask(o);return a&&!Bn(n,a)?!1:this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,n),i,s)}getPointInShapeSpace(e,n){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(n)}getPointInParentSpace(e,n){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return new w(0,0);if(yn(s.parentId))return w.From(n);const i=this.getShapePageTransform(s.parentId);return i?i.clone().invert().applyToPoint(n):w.From(n)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],n=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,s=n.length;r<s;r++)MO(this,n[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:n})=>!e.has(n))}isShapeOfType(e,n){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===n:!1}getShape(e){const n=typeof e=="string"?e:e.id;if(vn(n))return this.store.get(n)}getShapeParent(e){const n=typeof e=="string"?e:e?.id;if(!n)return;const r=this.getShape(n);if(!(r===void 0||!vn(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,n){return n?n.parentId===e.parentId?n:this.findShapeAncestor(n,s=>s.parentId===e.parentId):void 0}isShapeInPage(e,n=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return!1;let i=!1;if(s.parentId===n)i=!0;else{let o=this.getShape(s.parentId);e:for(;o;){if(o.parentId===n){i=!0;break e}o=this.getShape(o.parentId)}}return i}getAncestorPageId(e){const n=typeof e=="string"?e:e?.id,r=n&&this.getShape(n);if(r)return yn(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}_parentIdsToChildIds;reparentShapes(e,n,r){const s=typeof e[0]=="string"?e:e.map(p=>p.id);if(s.length===0)return this;const i=[],o=yn(n)?se.Identity():this.getShapePageTransform(n),a=o.rotation();let c=[];const l=Te(this.getSortedChildIdsForParent(n).map(p=>this.getShape(p)));if(r){const p=l.find(f=>f.index===r);if(p){const f=l[l.indexOf(p)+1];f?c=So(r,f.index,s.length):c=lf(r,s.length)}else{const f=l.sort(en).find(m=>m.index>r);f?c=So(r,f.index,s.length):c=lf(r,s.length)}}else{const p=l.length&&l[l.length-1];c=p?lf(p.index,s.length):Ga(s.length)}const d=o.clone().invert(),u=Te(s.map(p=>this.getShape(p)));return this.run(()=>{for(let p=0;p<u.length;p++){const f=u[p],m=this.getShapePageTransform(f);if(!m)continue;const y=m.point();if(!y)continue;const S=d.applyToPoint(y),g=m.rotation()-a;i.push({id:f.id,type:f.type,parentId:n,x:S.x,y:S.y,rotation:g,index:c[p]})}this.updateShapes(i)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];if(!r||r.length===0)return"a1";const s=this.getShape(r[r.length-1]);return fr(s.index)}getSortedChildIdsForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];return r||os}visitDescendants(e,n){const r=typeof e=="string"?e:e.id,s=this.getSortedChildIdsForParent(r);for(const i of s)n(i)!==!1&&this.visitDescendants(i,n);return this}getShapeAndDescendantIds(e){const n=new Set;for(const r of e.map(s=>this.getShape(s)).sort(en))n.add(r.id),this.visitDescendants(r,s=>{n.add(s)});return n}getDroppingOverShape(e,n=[]){const r=this.getCurrentPageShapesSorted();for(let s=r.length-1;s>=0;s--){const i=r[s];if(this.getSelectedShapeIds().includes(i.id)||!this.getShapeUtil(i).canDropShapes(i,n)||n.find(a=>a.id===i.id||this.hasAncestor(i,a.id)))continue;const o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,n){const r=typeof e=="string"?e:e.id,s=this.getShape(r);let i=s,o=s;const a=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&a?.id!==o.id&&!this.hasAncestor(a,o.id)&&(n?.(o)??!0))i=o;else if(a?.id===o.id)break;o=this.getShapeParent(o)}return i}_getBindingsIndexCache(){const e=s8(this);return this.store.createComputedCache("bindingsIndex",n=>e.get().get(n.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(s=>s.fromId===r&&s.type===n)}getBindingsToShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(s=>s.toId===r&&s.type===n)}getBindingsInvolvingShape(e,n){const r=typeof e=="string"?e:e.id,s=this._getBindingsIndexCache().get(r)??os;return n?s.filter(i=>i.type===n):s}createBindings(e){const n=[];for(const r of e){const s=this.getShape(r.fromId),i=this.getShape(r.toId);if(!s||!i||!this.canBindShapes({fromShape:s,toShape:i,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),c=this.store.schema.types.binding.create({...r,id:r.id??Si(),props:{...a,...r.props}});n.push(c)}return this.store.put(n),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const n=[];for(const r of e){if(!r)continue;const s=this.getBinding(r.id);if(!s)continue;const i=Er(s,r);if(i===s)continue;const o=this.getShape(i.fromId),a=this.getShape(i.toId);!o||!a||this.canBindShapes({fromShape:o,toShape:a,binding:i})&&n.push(i)}return this.store.put(n),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:n=!1}={}){const r=e.map(s=>typeof s=="string"?s:s.id);return n?this.store.atomic(()=>{for(const s of r){const i=this.getBinding(s);if(!i)continue;const o=this.getBindingUtil(i);o.onBeforeIsolateFromShape?.({binding:i,removedShape:this.getShape(i.toId)}),o.onBeforeIsolateToShape?.({binding:i,removedShape:this.getShape(i.fromId)}),this.store.remove([s])}}):this.store.remove(r),this}deleteBinding(e,n){return this.deleteBindings([e],n)}canBindShapes({fromShape:e,toShape:n,binding:r}){const s=typeof e=="string"?e:e.type,i=typeof n=="string"?n:n.type,o=typeof r=="string"?r:r.type,a={fromShapeType:s,toShapeType:i,bindingType:o};return s===i?this.getShapeUtil(s).canBind(a):this.getShapeUtil(s).canBind(a)&&this.getShapeUtil(i).canBind(a)}rotateShapesBy(e,n){if((typeof e[0]=="string"?e:e.map(i=>i.id)).length<=0)return this;const s=PO({editor:this});return s?(Dl({delta:n,snapshot:s,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(e,n){let r=e;const s=this.getShapeUtil(e);return r=Er(r,s.onTranslateStart?.(r)??void 0),r=Er(r,{id:e.id,type:e.type,x:n.x,y:n.y}),r=Er(r,s.onTranslate?.(e,r)??void 0),r=Er(r,s.onTranslateEnd?.(e,r)??void 0),r}nudgeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length<=0)return this;const s=[];for(const i of r){const o=this.getShape(i),a=w.From(n),c=this.getShapeParentTransform(o);c&&a.rot(-c.rotation()),s.push(this.getChangesToTranslateShape(o,a.add(o)))}return this.updateShapes(s),this}duplicateShapes(e,n){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(u=>u.id);if(r.length<=0)return this;const s=new Set(r),i=this.getShapeAndDescendantIds(r),o=[...i].reverse(),a=new Map;for(const u of i)a.set(u,He());const{shapesToCreate:c,bindingsToCreate:l}=nI(this,i,u=>{const p=[];for(const m of u){const y=this.getBinding(m);if(!y)continue;const S=Si();p.push({...y,id:S,fromId:er(a.get(y.fromId)),toId:er(a.get(y.toId))})}const f=[];for(const m of o){const y=er(a.get(m)),S=this.getShape(m);if(!S)continue;let g=0,v=0;if(n&&s.has(m)){const k=this.getShapeParentTransform(S),T=new w(n.x,n.y).rot(-k.rotation());g=T.x,v=T.y}const x=S.parentId,b=this.getSortedChildIdsForParent(x),E=b.indexOf(S.id),I=b[E+1],C=I?this.getShape(I):null,P=C?Ha(S.index,C.index):fr(S.index);f.push({...S,id:y,x:S.x+g,y:S.y+v,index:P,parentId:a.get(S.parentId)??S.parentId})}return{shapesToCreate:f,bindingsToCreate:p}});if(c.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){cl(this);return}if(this.createShapes(c),this.createBindings(l),this.setSelectedShapes(Te(r.map(u=>a.get(u)))),n!==void 0){const u=this.getSelectionPageBounds(),p=this.getViewportPageBounds();u&&!p.contains(u)&&this.centerOnPoint(u.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,n){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getInstanceState().isReadonly)return this;const s=this.getCurrentPageId();if(n===s)return this;if(!this.store.has(n))return this;const i=this.getContentFromCurrentPage(r);if(!i)return this;if(this.getPageShapeIds(n).size+i.shapes.length>this.options.maxShapesPerPage)return cl(this,n),this;const o=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(n),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:o}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getInstanceState().isReadonly||n.length===0)return this;let r=!0,s=!0;const i=[];for(const o of n){const a=this.getShape(o);a&&(i.push(a),a.isLocked?s=!1:r=!1)}return this.run(()=>{s?(this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!1}))):this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!0})))}),this}sendToBack(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=al(this,"toBack",n);return r&&this.updateShapes(r),this}sendBackward(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=al(this,"backward",n);return r&&this.updateShapes(r),this}bringForward(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=al(this,"forward",n);return r&&this.updateShapes(r),this}bringToFront(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=al(this,"toFront",n);return r&&this.updateShapes(r),this}flipShapes(e,n){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getInstanceState().isReadonly)return this;let s=Te(r.map(o=>this.getShape(o)));if(!s.length)return this;s=Te(s.map(o=>this.isShapeOfType(o,"group")?this.getSortedChildIdsForParent(o.id).map(a=>this.getShape(a)):o).flat());const i=ce.Common(Te(s.map(o=>this.getShapePageBounds(o)))).center;return this.run(()=>{for(const o of s){const a=this.getShapeGeometry(o).bounds,c=this.getShapePageTransform(o.id);c&&this.resizeShape(o.id,{x:n==="horizontal"?-1:1,y:n==="vertical"?-1:1},{initialBounds:a,initialPageTransform:c,initialShape:o,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(o).isAspectRatioLocked(o),scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,n,r){const s=typeof e[0]=="string"?e:e.map(y=>y.id);if(this.getInstanceState().isReadonly)return this;const i=s.map(y=>this.getShape(y)).filter(y=>y?this.getShapeUtil(y).canBeLaidOut(y):!1),o=i.length;if(r===0&&o<3||o<2)return this;const a=Object.fromEntries(i.map(y=>[y.id,this.getShapePageBounds(y)]));let c,l,d,u;n==="horizontal"?(c="x",l="minX",d="maxX",u="width"):(c="y",l="minY",d="maxY",u="height");let p;if(r===0){const y=[];i.sort((g,v)=>a[g.id][l]-a[v.id][l]);for(let g=0;g<o-1;g++){const v=i[g],x=i[g+1],b=a[v.id],I=a[x.id][l]-b[d],C=y.find(P=>P.gap===I);C?C.count++:y.push({gap:I,count:1})}let S=0;y.forEach(g=>{g.count>S&&(S=g.count,p=g.gap)}),S===1&&(p=Math.max(0,y.reduce((g,v)=>g+v.gap*v.count,0)/(o-1)))}else p=r;const f=[];let m=a[i[0].id][d];return i.forEach((y,S)=>{if(S===0)return;const g={x:0,y:0};g[c]=m+p-a[y.id][c];const v=this.getShapeParent(y),x=v?w.Rot(g,-this.getShapePageTransform(v).decompose().rotation):g,b=this.getShapeUtil(y).onTranslateStart?.(y);f.push(b?{...b,[c]:y[c]+x[c]}:{id:y.id,type:y.type,[c]:y[c]+x[c]}),m+=a[y.id][u]+p}),this.updateShapes(f),this}packShapes(e,n){const r=typeof e[0]=="string"?e:e.map(I=>I.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const s=r.map(I=>this.getShape(I)).filter(I=>I?this.getShapeUtil(I).canBeLaidOut(I):!1),i={},o={};let a,c,l=0;for(let I=0;I<s.length;I++)a=s[I],c=this.getShapePageBounds(a),i[a.id]=c,o[a.id]=c.clone(),l+=c.width*c.height;const d=ce.Common(Te(Object.values(i))),u=d.width;s.sort((I,C)=>i[C.id].height-i[I.id].height);const p=Math.max(Math.ceil(Math.sqrt(l/.95)),u),f=[new ce(d.x,d.y,p,1/0)];let m=0,y=0,S,g;for(let I=0;I<s.length;I++){a=s[I],c=o[a.id];for(let C=f.length-1;C>=0;C--)if(S=f[C],!(c.width>S.width||c.height>S.height)){c.x=S.x,c.y=S.y,y=Math.max(y,c.maxY),m=Math.max(m,c.maxX),c.width===S.width&&c.height===S.height?(g=f.pop(),C<f.length&&(f[C]=g)):c.height===S.height?(S.x+=c.width+n,S.width-=c.width+n):c.width===S.width?(S.y+=c.height+n,S.height-=c.height+n):(f.push(new ce(S.x+(c.width+n),S.y,S.width-(c.width+n),c.height)),S.y+=c.height+n,S.height-=c.height+n);break}}const v=ce.Common(Object.values(o)),x=w.Sub(d.center,v.center);let b;const E=[];for(let I=0;I<s.length;I++){a=s[I],c=i[a.id],b=o[a.id];const C=w.Sub(b.point,c.point).add(x),P=this.getShapeParentTransform(a);P&&C.rot(-P.rotation());const k={id:a.id,type:a.type,x:a.x+C.x,y:a.y+C.y},T=this.getShapeUtil(a).onTranslateStart?.({...a,...k});T?E.push({...k,...T}):E.push(k)}return E.length&&this.updateShapes(E),this}alignShapes(e,n){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const s=Te(r.map(c=>this.getShape(c))),i=Object.fromEntries(s.map(c=>[c.id,this.getShapePageBounds(c)])),o=ce.Common(Te(Object.values(i))),a=[];return s.forEach(c=>{const l=i[c.id];if(!l)return;const d={x:0,y:0};switch(n){case"top":{d.y=o.minY-l.minY;break}case"center-vertical":{d.y=o.midY-l.minY-l.height/2;break}case"bottom":{d.y=o.maxY-l.minY-l.height;break}case"left":{d.x=o.minX-l.minX;break}case"center-horizontal":{d.x=o.midX-l.minX-l.width/2;break}case"right":{d.x=o.maxX-l.minX-l.width;break}}const u=this.getShapeParent(c),p=u?w.Rot(d,-this.getShapePageTransform(u).decompose().rotation):d;a.push(this.getChangesToTranslateShape(c,w.Add(c,p)))}),this.updateShapes(a),this}distributeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(v=>v.id);if(this.getInstanceState().isReadonly)return this;if(r.length<3)return this;const s=r.length,i=Te(r.map(v=>this.getShape(v))),o=Object.fromEntries(i.map(v=>[v.id,this.getShapePageBounds(v)]));let a,c,l,d,u;n==="horizontal"?(a="x",c="minX",l="maxX",d="midX",u="width"):(a="y",c="minY",l="maxY",d="midY",u="height");const p=[],f=i.sort((v,x)=>o[v.id][c]-o[x.id][c])[0],m=i.sort((v,x)=>o[x.id][l]-o[v.id][l])[0],y=o[f.id][d],S=(o[m.id][d]-y)/(s-1),g=y+S;return i.filter(v=>v!==f&&v!==m).sort((v,x)=>o[v.id][d]-o[x.id][d]).forEach((v,x)=>{const b={x:0,y:0};b[a]=g+S*x-o[v.id][u]/2-o[v.id][a];const E=this.getShapeParent(v),I=E?w.Rot(b,-this.getShapePageTransform(E).rotation()):b;p.push(this.getChangesToTranslateShape(v,w.Add(v,I)))}),this.updateShapes(p),this}stretchShapes(e,n){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const s=Te(r.map(c=>this.getShape(c))),i=Object.fromEntries(r.map(c=>[c,this.getShapeGeometry(c).bounds])),o=Object.fromEntries(r.map(c=>[c,this.getShapePageBounds(c)])),a=ce.Common(Te(Object.values(o)));switch(n){case"vertical":{this.run(()=>{for(const c of s){if(this.getShapePageTransform(c).rotation()%Ue)continue;const d=i[c.id],u=o[c.id],p=new w(0,a.minY-u.minY),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:m,y}=w.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:m,y}]);const S=new w(1,a.height/u.height);this.resizeShape(c.id,S,{initialBounds:d,scaleOrigin:new w(u.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of s){const l=i[c.id],d=o[c.id];if(this.getShapePageTransform(c).rotation()%Ue)continue;const p=new w(a.minX-d.minX,0),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:m,y}=w.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:m,y}]);const S=new w(a.width/d.width,1);this.resizeShape(c.id,S,{initialBounds:l,scaleOrigin:new w(a.minX,d.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(e,n,r={}){const s=typeof e=="string"?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(n.x)||(n=new w(1,n.y)),Number.isFinite(n.y)||(n=new w(n.x,1));const i=r.initialShape??this.getShape(s);if(!i)return this;const o=r.scaleOrigin??this.getShapePageBounds(s)?.center;if(!o)return this;const a=r.initialPageTransform?se.Cast(r.initialPageTransform):this.getShapePageTransform(s);if(!a)return this;const c=a.rotation();if(c==null)return this;const l=r.scaleAxisRotation??c,d=r.initialBounds??this.getShapeGeometry(s).bounds;if(!d)return this;const u=r.isAspectRatioLocked??this.getShapeUtil(i).isAspectRatioLocked(i);if(!LR(c,l))return this._resizeUnalignedShape(s,n,{...r,initialBounds:d,scaleOrigin:o,scaleAxisRotation:l,initialPageTransform:a,isAspectRatioLocked:u,initialShape:i});const p=this.getShapeUtil(i);if(u&&(Math.abs(n.x)>Math.abs(n.y)?n=new w(n.x,Math.sign(n.y)*Math.abs(n.x)):n=new w(Math.sign(n.x)*Math.abs(n.y),n.y)),p.onResize&&p.canResize(i)){const f=this._scalePagePoint(se.applyToPoint(a,new w(0,0)),o,n,l),m=this.getPointInParentSpace(i.id,f),y=new w(n.x,n.y),S=$s((c-l)%Math.PI,0);y.x=S?n.x:n.y,y.y=S?n.y:n.x;const g=se.applyToPoint(a,new w),{x:v,y:x}=this.getPointInParentSpace(i.id,g);let b=i;r.skipStartAndEndCallbacks||(b=Er(i,p.onResizeStart?.(i)??void 0)),b=Er(b,{id:s,type:i.type,x:m.x,y:m.y,...p.onResize({...i,x:v,y:x},{newPoint:m,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:y.x,scaleY:y.y,initialBounds:d,initialShape:i})}),r.skipStartAndEndCallbacks||(b=Er(b,p.onResizeEnd?.(i,b)??void 0)),this.updateShapes([b])}else{const f=se.applyToPoint(a,d.center),m=this._scalePagePoint(f,o,n,l),y=this.getPointInParentSpace(i.id,f),S=this.getPointInParentSpace(i.id,m),g=w.Sub(S,y);this.updateShapes([{id:s,type:i.type,x:i.x+g.x,y:i.y+g.y}])}return this}_scalePagePoint(e,n,r,s){const i=w.RotWith(e,n,-s).sub(n),o=w.MulV(i,r);return w.Add(o,n).rotWith(n,s)}_resizeUnalignedShape(e,n,r){const{type:s}=r.initialShape,i=new w(n.x,n.y);if(Math.abs(n.x)>Math.abs(n.y)?i.x=Math.sign(n.x)*Math.abs(n.y):i.y=Math.sign(n.y)*Math.abs(n.x),this.resizeShape(e,i,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(n.x)*Math.sign(n.y)<0){let{rotation:S}=se.Decompose(r.initialPageTransform);S-=2*S,this.updateShapes([{id:e,type:s,rotation:S}])}const o=se.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(o,r.scaleOrigin,n,r.scaleAxisRotation),c=this.getShapePageBounds(e),l=this.getShapePageTransform(e),d=c.center,u=l.point();if(!d||!u)return this;const p=w.Sub(a,d),f=w.Add(u,p),{x:m,y}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:s,x:m,y}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(e.length<=0)return this;const n=this.getCurrentPageShapeIds();if(e.length+n.size>this.options.maxShapesPerPage)return cl(this),this;const s=this.getFocusedGroupId();return this.run(()=>{const i=this.getCurrentPageShapesSorted(),o=e.map(d=>{if(d.id||(d={id:He(),...d}),!d.parentId||!(this.store.has(d.parentId)||e.some(u=>u.id===d.parentId))){let u=this.getFocusedGroupId();for(let f=i.length-1;f>=0;f--){const m=i[f];if(this.getShapeUtil(m).canReceiveNewChildrenOfType(m,d.type)&&this.isPointInShape(m,{x:d.x??0,y:d.y??0},{margin:0,hitInside:!0})){u=m.id;break}}const p=d.parentId;if(u===d.id&&(u=s),u!==p&&(d={...d},d.parentId=u,vn(u))){const f=this.getPointInShapeSpace(this.getShape(u),{x:d.x??0,y:d.y??0});d.x=f.x,d.y=f.y,d.rotation=-this.getShapePageTransform(u).rotation()+(d.rotation??0)}}return d}),a=new Map,c=[],{opacityForNextShape:l}=this.getInstanceState();for(const d of o){const u=this.getShapeUtil(d);let p=d.index;if(!p){const S=d.parentId??s;a.has(S)||a.set(S,this.getHighestIndexForParent(S)),p=a.get(S),a.set(S,fr(p))}const f=u.getDefaultProps();for(const[S,g]of this.styleProps[d.type])f[g]=this.getStyleForNextShape(S);let m=this.store.schema.types.shape.create({...d,index:p,opacity:d.opacity??l,parentId:d.parentId??s,props:"props"in d?{...f,...d.props}:f});if(m.index===void 0)throw Error("no index!");const y=this.getShapeUtil(m).onBeforeCreate?.(m);y&&(m=y),c.push(m)}c.forEach(d=>{d.meta={...this.getInitialMetaForShape(d),...d.meta}}),this.store.put(c)}),this}animatingShapes=new Map;animateShape(e,n={animation:mf}){return this.animateShapes([e],n)}animateShapes(e,n={animation:mf}){if(!n.animation)return this;const{duration:r=500,easing:s=Mt.linear}=n.animation,i=lt();let o=r,a;const c=[];let l,d;for(let p=0,f=e.length;p<f;p++){if(l=e[p],!l)continue;const m=this.getShape(l.id);m&&(d={start:Ye(m),end:Er(Ye(m),l)},c.push(d),this.animatingShapes.set(m.id,i))}const u=p=>{if(o-=p,o<0){const{animatingShapes:S}=this,g=e.filter(v=>v&&S.get(v.id)===i);g.length&&this.updateShapes(g),this.off("tick",u);return}a=s(1-o/r);const{animatingShapes:f}=this,m=[];let y;for(let S=0,g=c.length;S<g;S++){const{start:v,end:x}=c[S];y=f.get(v.id),y===i&&m.push({...x,x:v.x+(x.x-v.x)*a,y:v.y+(x.y-v.y)*a,opacity:v.opacity+(x.opacity-v.opacity)*a,rotation:v.rotation+(x.rotation-v.rotation)*a,props:this.getShapeUtil(x).getInterpolatedProps?.(v,x,a)??x.props})}this._updateShapes(m)};return this.on("tick",u),this}groupShapes(e,n={}){const{groupId:r=He(),select:s=!0}=n;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const i=typeof e[0]=="string"?e:e.map(m=>m.id);if(i.length<=1)return this;const o=Te((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(m=>this.getShape(m))),a=o.sort(en).map(m=>m.id),c=ce.Common(Te(o.map(m=>this.getShapePageBounds(m)))),{x:l,y:d}=c.point,u=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=o.filter(m=>m.parentId===u).sort(en),f=p[p.length-1]?.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:f,x:l,y:d,opacity:1,props:{}}]),this.reparentShapes(a,r),s&&this.select(r)}),this}ungroupShapes(e,n={}){if(this.getInstanceState().isReadonly)return this;const{select:r=!0}=n,s=typeof e[0]=="string"?e:e.map(c=>c.id),i=Te((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(c=>this.getShape(c)));if(i.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return i.forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):o.add(c.id)}),a.length===0?this:(this.run(()=>{let c;for(let l=0,d=a.length;l<d;l++){c=a[l];const u=this.getSortedChildIdsForParent(c.id);for(let p=0,f=u.length;p<f;p++)o.add(u[p]);this.reparentShapes(u,c.parentId,c.index)}this.deleteShapes(a.map(l=>l.id)),r&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const n=Array(e.length);for(let r=0,s=e.length;r<s;r++){const i=e[r];if(!i)continue;const o=this.getShape(i.id);if(o){if(!this._shouldIgnoreShapeLock){if(o.isLocked){if(!(Object.hasOwn(i,"isLocked")&&!i.isLocked))continue}else if(this.isShapeOrAncestorLocked(o))continue}this.animatingShapes.delete(i.id),n.push(i)}}return this._updateShapes(n),this}_updateShapes=e=>{this.getInstanceState().isReadonly||this.run(()=>{const n=[];let r,s;for(let i=0,o=e.length;i<o;i++){const a=e[i];a&&(r=this.getShape(a.id),r&&(s=Er(r,a),s!==r&&(s=this.getShapeUtil(r).onBeforeUpdate?.(r,s)??s,n.push(s))))}this.store.put(n)})};_getUnlockedShapeIds(e){return e.filter(n=>!this.getShape(n)?.isLocked)}deleteShapes(e){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=this._shouldIgnoreShapeLock?n:this._getUnlockedShapeIds(n);if(r.length===0)return this;const s=new Set(r);for(const i of r)this.visitDescendants(i,o=>{s.add(o)});return this.run(()=>this.store.remove([...s]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,n){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let s=0,i=r.length;s<i;s++)this._extractSharedStyles(this.getShape(r[s]),n)}else for(const[r,s]of this.styleProps[e.type])n.applyValue(r,Cn(e.props,s))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),n=new Dx;for(const r of e)this._extractSharedStyles(r,n);return n}getStyleForNextShape(e){const n=this.getInstanceState().stylesForNextShape[e.id];return n===void 0?e.defaultValue:n}getShapeStyleIfExists(e,n){const r=this.styleProps[e.type].get(n);if(r!==void 0)return Cn(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),n=new Dx;if(!e)return n;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())n.applyValue(r,this.getStyleForNextShape(r));return n}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],n=s=>{const i=this.getShape(s);if(i)if(this.isShapeOfType(i,"group"))for(const o of this.getSortedChildIdsForParent(i.id))n(o);else e.push(i)};for(const s of this.getSelectedShapeIds())n(s);let r=null;for(const s of e)if(r===null)r=s.opacity;else if(r!==s.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,n){return this.updateInstanceState({opacityForNextShape:e},n),this}setOpacityForSelectedShapes(e){const n=this.getSelectedShapes();if(n.length>0){const r=[],s=i=>{if(this.isShapeOfType(i,"group")){const o=this.getSortedChildIdsForParent(i);for(const a of o)s(this.getShape(a))}else r.push(i)};for(const i of n)s(i);this.updateShapes(r.map(i=>({id:i.id,type:i.type,opacity:e})))}return this}setStyleForNextShapes(e,n,r){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[e.id]:n}},r),this}setStyleForSelectedShapes(e,n){const r=this.getSelectedShapes();if(r.length>0){const s=[],i=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o.id);for(const c of a)i(this.getShape(c))}else{const a=this.getShapeUtil(o),c=this.styleProps[o.type].get(e);if(c){const l={id:o.id,type:o.type,props:{[c]:n}};s.push({util:a,originalShape:o,updatePartial:l})}}};for(const o of r)i(o);this.updateShapes(s.map(({updatePartial:o})=>o))}return this}externalAssetContentHandlers={file:null,url:null};registerExternalAssetHandler(e,n){return this.externalAssetContentHandlers[e]=n,this}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}externalContentHandlers={text:null,files:null,embed:null,"svg-text":null,url:null};registerExternalContentHandler(e,n){return this.externalContentHandlers[e]=n,this}async putExternalContent(e){return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id);if(!n||n.length===0)return;const r=this.getShapeAndDescendantIds(n);return nI(this,r,s=>{const i=[];for(const d of s){const u=this.getBinding(d);u&&i.push(u)}const o=[],a=[];for(const d of r){const u=this.getShape(d);if(!u)continue;if(!r.has(u.parentId)){const f=this.getShapePageTransform(u.id),m=f.point();a.push({...u,x:m.x,y:m.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),o.push(u.id)}else a.push(u)}const c=[],l=new Set;for(const d of a){if(!("assetId"in d.props))continue;const u=d.props.assetId;if(!u||l.has(u))continue;l.add(u);const p=this.getAsset(u);p&&c.push(p)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:o,bindings:i,assets:c}})}async resolveAssetsInContent(e){if(!e)return;const n=[];return await Promise.allSettled(e.assets.map(async r=>{if((r.type==="image"||r.type==="video")&&!r.props.src?.startsWith("data:image")&&!r.props.src?.startsWith("http")){const s=Ye(r),i=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});s.props.src=await yi.blobToDataUrl(await Nr(i).then(o=>o.blob())),n.push(s)}else n.push(r)})),e.assets=n,e}putContentOntoCurrentPage(e,n={}){if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:s=!1,preservePosition:i=!1}=n;let{point:o=void 0}=n;const a=this.getCurrentPageId(),{rootShapeIds:c}=e,l=[],d=[],u=[],p={store:{...Object.fromEntries(e.assets.map(T=>[T.id,T])),...Object.fromEntries(e.shapes.map(T=>[T.id,T])),...Object.fromEntries(e.bindings?.map(T=>[T.id,T])??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(p);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const T of Object.values(f.value))switch(T.typeName){case"asset":{l.push(T);break}case"shape":{d.push(T);break}case"binding":{u.push(T);break}}const m=new Map(s?d.map(T=>[T.id,T.id]):d.map(T=>[T.id,He()])),y=new Map(s?u.map(T=>[T.id,T.id]):u.map(T=>[T.id,Si()]));let S=this.getCurrentPageId(),g=1/0,v=[];for(const T of this.getSelectedShapes()){if(g===0)break;const M=this.isShapeOfType(T,"frame"),A=this.getShapeAncestors(T);M&&A.push(T);const j=M?A.length+1:A.length;if(j<g)g=j,v=A,S=M?T.id:T.parentId;else if(j===g){if(v.length!==A.length)throw Error(`Ancestors: ${v.length} !== ${A.length}`);if(v.length===0){S=a;break}else{S=a;for(let R=0;R<v.length&&A[R]===v[R];R++)S=A[R].id}}}let x=!1;if(!yn(S)){const T=this.getShape(S);if(T){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(T)))S=a;else if(c.length===1){const M=d.find(A=>A.id===c[0]);this.isShapeOfType(T,"frame")&&this.isShapeOfType(M,"frame")&&M.props.w===T?.props.w&&M.props.h===T?.props.h&&(x=!0)}}else S=a}x||(x=m.has(S)),x&&(S=this.getShape(S).parentId);let b=this.getHighestIndexForParent(S);const E=[],I=d.map(T=>{const M=m.get(T.id),A={...T,id:M};return c.includes(T.id)&&(A.parentId=a,E.push(A)),m.has(A.parentId)?A.parentId=m.get(T.parentId):(c.push(A.id),A.index=b,b=fr(b)),A});if(I.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return cl(this),this;const C=u.map(T=>({...T,id:er(y.get(T.id)),fromId:er(m.get(T.fromId)),toId:er(m.get(T.toId))})),P=[],k=[];for(const T of l)this.store.has(T.id)||((T.type==="image"||T.type==="video")&&T.props.src?.startsWith("data:image")&&(k.push(Ye(T)),T.props.src=null),P.push(T));return Promise.allSettled(k.map(async T=>{const M=await Zq(T.props.src,T.props.name,T.props.mimeType??"image/png"),A=await this.getAssetForExternalContent({type:"file",file:M});if(!A){this.deleteAssets([T.id]);return}this.updateAssets([{...A,id:T.id}])})),this.run(()=>{P.length>0&&this.createAssets(P),this.createShapes(I),this.createBindings(C),r&&this.select(...E.map(R=>R.id)),S!==a&&this.reparentShapes(E.map(R=>R.id),S);const T=I.map(R=>this.getShape(R.id)),M=ce.Common(T.map(R=>this.getShapePageBounds(R)));if(o===void 0)if(yn(S)){const R=this.getViewportPageBounds();i||R.includes(ce.From(M))?o=M.center:o=R.center}else{const R=this.getShape(S);o=se.applyToPoint(this.getShapePageTransform(R),this.getShapeGeometry(R).bounds.center)}if(E.length===1){const R=E[0];if(this.isShapeOfType(R,"frame"))for(;this.getShapesAtPoint(o).some(L=>this.isShapeOfType(L,"frame")&&L.props.w===R.props.w&&L.props.h===R.props.h);)o.x+=M.w+16}const A=ce.Common(Te(E.map(({id:R})=>this.getShapePageBounds(R)))).center,j=w.Sub(o,A);this.updateShapes(E.map(({id:R})=>{const L=this.getShape(R),F=this.getShapeParentTransform(R).decompose().rotation,H=w.Rot(j,-F);return{id:L.id,type:L.type,x:L.x+H.x,y:L.y+H.y}}))}),this}async getSvgElement(e,n={}){const r=await d8(this,e,n);if(!r)return;const s=document.createDocumentFragment(),i=$F.createRoot(s);zF.flushSync(()=>{i.render(r.jsx)});const o=s.firstElementChild;return Ze(o instanceof SVGSVGElement,"Expected an SVG element"),i.unmount(),{svg:o,width:r.width,height:r.height}}async getSvgString(e,n={}){const r=await this.getSvgElement(e,n);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,n={}){const r=await this.getSvgElement(e,n);if(r)return r.svg}inputs={originPagePoint:new w,originScreenPoint:new w,previousPagePoint:new w,previousScreenPoint:new w,currentPagePoint:new w,currentScreenPoint:new w,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new w};_updateInputsFromEvent(e){const{pointerVelocity:n,previousScreenPoint:r,previousPagePoint:s,currentScreenPoint:i,currentPagePoint:o}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(ln),{x:c,y:l,z:d}=Zc(()=>this.getCamera()),u=e.point.x-a.x,p=e.point.y-a.y,f=e.point.z??.5;r.setTo(i),s.setTo(o),i.set(u,p);const m=u/d-c,y=p/d-l;isFinite(m)&&isFinite(y)&&o.set(m,y,f),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(n.set(0,0),this.inputs.originScreenPoint.setTo(i),this.inputs.originPagePoint.setTo(o)),this.run(()=>{this.store.put([{id:Zl,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===T_.CAMERA_MOVE?this.store.unsafeGetWithoutCapture(Zl)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return bO(this.store)}loadSnapshot(e){return Qb(this.store,e),this}_clickManager=new h8(this);cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_prevCursor="default";_shiftKeyTimeout=-1;_setShiftKeyTimeout=()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})};_altKeyTimeout=-1;_setAltKeyTimeout=()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})};_ctrlKeyTimeout=-1;_setCtrlKeyTimeout=()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})};_restoreToolId="select";_pinchStart=1;_didPinch=!1;_selectedShapeIdsAtPointerDown=[];_longPressTimeout=-1;capturedPointerId=null;performanceTracker;performanceTrackerTimeout=-1;dispatch=e=>(this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this);_pendingEventsForNextTick=[];_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const n=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of n)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick=e=>{if(this.getCrashingError())return this;const{inputs:n}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,n.shiftKey=!0):!e.shiftKey&&n.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,n.altKey=!0):!e.altKey&&n.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,n.ctrlKey=!0):!e.ctrlKey&&n.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:s,currentPagePoint:i}=n;n.isPointing||(n.isDragging=!1);const o=this.store.unsafeGetWithoutCapture(ln),a=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(n.isPinching)return;n.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,n.isPinching=!0,this.interrupt());return}case"pinch":{if(!n.isPinching)return;const{point:{z:l=1},delta:{x:d,y:u}}=e,{x:p,y:f}=w.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:m,y,z:S}=Zc(()=>this.getCamera()),{panSpeed:g,zoomSpeed:v}=c;this._setCamera(new w(m+d*g/S-p/S+p/(l*v),y+u*g/S-f/S+f/(l*v),l*v),{immediate:!0});return}case"pinch_end":{if(!n.isPinching)return this;n.isPinching=!1;const{_selectedShapeIdsAtPointerDown:l}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,l.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(l)}));return}}}case"wheel":{if(c.isLocked)return;if(this._updateInputsFromEvent(e),!this.getIsMenuOpen()){const{panSpeed:l,zoomSpeed:d,wheelBehavior:u}=c;if(u!=="none"){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:p,y:f,z:m}=Zc(()=>this.getCamera()),{x:y,y:S,z:g=0}=e.delta;let v=u;switch(n.ctrlKey&&(v=u==="pan"?"zoom":"pan"),v){case"zoom":{const{x,y:b}=this.inputs.currentScreenPoint;let E=g;u==="zoom"&&(Math.abs(S)>10?E=10*Math.sign(S)/100:E=S/100);const I=m+(E??0)*d*m;this._setCamera(new w(p+(x/I-x)-(x/m-x),f+(b/I-b)-(b/m-b),I),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new w(p+y*l/m,f+S*l/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(n.isPinching)return;this._updateInputsFromEvent(e);const{isPen:l}=e,{isPenMode:d}=o;switch(e.name){case"pointer_down":{if(d&&!l)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===M_&&(this.capturedPointerId=e.pointerId),n.buttons.add(e.button),n.isPointing=!0,n.isDragging=!1,!d&&l&&this.updateInstanceState({isPenMode:!0}),e.button===A_?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===sl&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!l&&d)return;const{x:u,y:p,z:f}=Zc(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:m,previousScreenPoint:y}=this.inputs,{panSpeed:S}=c,g=w.Sub(m,y);this.setCamera(new w(u+g.x*S/f,p+g.y*S/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}n.isPointing&&!n.isDragging&&w.Dist2(s,i)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(n.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(n.isDragging=!1,n.isPointing=!1,clearTimeout(this._longPressTimeout),n.buttons.delete(e.button),this.getIsMenuOpen()||o.isPenMode&&!l)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),n.isPanning){n.keys.has("Space")||(n.isPanning=!1);const u=this.inputs.pointerVelocity,p=Math.min(2,u.len());switch(e.button){case M_:{this.setCursor({type:"grab",rotation:0});break}case sl:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:u})}else e.button===A_&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.name){case"key_down":{n.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{n.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(sl)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===sl?e.name="middle_click":e.button===Kb&&(e.name="right_click");const{isPenMode:l}=this.store.unsafeGetWithoutCapture(ln);if(e.isPen===l){const d=this._clickManager.handlePointerEvent(e);if(e.name!==d.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(e),this.emit("event",e),this};maybeTrackPerformance(e){yt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}fe([J],he.prototype,"getCanUndo");fe([J],he.prototype,"getCanRedo");fe([J],he.prototype,"getPath");fe([J],he.prototype,"getCurrentTool");fe([J],he.prototype,"getCurrentToolId");fe([J],he.prototype,"getDocumentSettings");fe([J],he.prototype,"getInstanceState");fe([J],he.prototype,"getOpenMenus");fe([J],he.prototype,"getIsMenuOpen");fe([J],he.prototype,"getPageStates");fe([J],he.prototype,"_getPageStatesQuery");fe([J],he.prototype,"getCurrentPageState");fe([J],he.prototype,"_getCurrentPageStateId");fe([J],he.prototype,"getSelectedShapeIds");fe([J],he.prototype,"getSelectedShapes");fe([J],he.prototype,"getOnlySelectedShapeId");fe([J],he.prototype,"getOnlySelectedShape");fe([J],he.prototype,"getSelectionPageBounds");fe([J],he.prototype,"getSelectionRotation");fe([J],he.prototype,"getSelectionRotatedPageBounds");fe([J],he.prototype,"getSelectionRotatedScreenBounds");fe([J],he.prototype,"getFocusedGroupId");fe([J],he.prototype,"getFocusedGroup");fe([J],he.prototype,"getEditingShapeId");fe([J],he.prototype,"getEditingShape");fe([J],he.prototype,"getHoveredShapeId");fe([J],he.prototype,"getHoveredShape");fe([J],he.prototype,"getHintingShapeIds");fe([J],he.prototype,"getHintingShape");fe([J],he.prototype,"getErasingShapeIds");fe([J],he.prototype,"getErasingShapes");fe([J],he.prototype,"_unsafe_getCameraId");fe([J],he.prototype,"getCamera");fe([J],he.prototype,"getViewportPageBoundsForFollowing");fe([J],he.prototype,"getCameraForFollowing");fe([J],he.prototype,"getZoomLevel");fe([J],he.prototype,"getViewportScreenBounds");fe([J],he.prototype,"getViewportScreenCenter");fe([J],he.prototype,"getViewportPageBounds");fe([J],he.prototype,"_getCollaboratorsQuery");fe([J],he.prototype,"getCollaborators");fe([J],he.prototype,"getCollaboratorsOnCurrentPage");fe([J],he.prototype,"getRenderingShapes");fe([J],he.prototype,"_getAllPagesQuery");fe([J],he.prototype,"getPages");fe([J],he.prototype,"getCurrentPageId");fe([J],he.prototype,"getCurrentPageShapeIdsSorted");fe([J],he.prototype,"_getAllAssetsQuery");fe([J],he.prototype,"_getShapeGeometryCache");fe([J],he.prototype,"_getShapeHandlesCache");fe([J],he.prototype,"_getShapePageTransformCache");fe([J],he.prototype,"_getShapePageBoundsCache");fe([J],he.prototype,"_getShapeClipPathCache");fe([J],he.prototype,"_getShapeMaskCache");fe([J],he.prototype,"_getShapeMaskedPageBoundsCache");fe([J],he.prototype,"_notVisibleShapes");fe([J],he.prototype,"getCulledShapes");fe([J],he.prototype,"getCurrentPageBounds");fe([J],he.prototype,"getCurrentPageShapes");fe([J],he.prototype,"getCurrentPageShapesSorted");fe([J],he.prototype,"getCurrentPageRenderingShapesSorted");fe([J],he.prototype,"_getBindingsIndexCache");fe([J],he.prototype,"_getSelectionSharedStyles");fe([J({isEqual:(t,e)=>t.equals(e)})],he.prototype,"getSharedStyles");fe([J],he.prototype,"getSharedOpacity");fe([J],he.prototype,"getIsFocused");function cl(t,e=t.getCurrentPageId()){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:t.options.maxShapesPerPage})}function Er(t,e){if(!e)return t;let n=null;const r=Object.entries(e);for(let s=0,i=r.length;s<i;s++){const[o,a]=r[s];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==t[o]){if(n||(n={...t}),o==="props"||o==="meta"){n[o]={...t[o]};for(const[c,l]of Object.entries(a))l!==void 0&&(n[o][c]=l);continue}n[o]=a}}return n||t}function MO(t,e,n){const r=t.getShape(e);if(!r)return;n.push(r);const s=t.getSortedChildIdsForParent(e);for(let i=0,o=s.length;i<o;i++)MO(t,s[i],n)}function nI(t,e,n){let r;if(t.run(()=>{const s=t.store.extractingChanges(()=>{const i=new Set,o=new Set;for(const a of e)if(t.getShape(a))for(const l of t.getBindingsInvolvingShape(a)){const d=e.has(l.fromId),u=e.has(l.toId);if(d&&u){i.add(l.id);continue}(!d||!u)&&o.add(l.id)}t.deleteBindings([...o],{isolateShapes:!0});try{r=Fs.ok(n(i))}catch(a){r=Fs.err(a)}});t.store.applyDiff(_x(s))},{history:"ignore"}),r.ok)return r.value;throw r.error}function rI(t,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:r}}=e.constraints,s=t.getViewportScreenBounds(),i=ce.From(e.constraints.bounds),o=(s.w-n*2)/i.w,a=(s.h-r*2)/i.h;return{zx:o,zy:a}}function Cc(){const t=K(),e=kO();return X("isDarkMode",()=>e?.isDarkMode??t.user.getIsDarkMode(),[e,t])}const sI="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",iI="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",ll='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Ps(t,e,n,r,s,i=16,o=16){const a=(-n-e)*($e/180),c=Math.sin(a),l=Math.cos(a),d=1*l-1*c,u=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${i} ${o}, pointer`}const H8=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],G8={none:()=>"none","ew-resize":(t,e,n)=>Ps(iI,t,0,e,n),"ns-resize":(t,e,n)=>Ps(iI,t,90,e,n),"nesw-resize":(t,e,n)=>Ps(sI,t,0,e,n),"nwse-resize":(t,e,n)=>Ps(sI,t,90,e,n),"nwse-rotate":(t,e,n)=>Ps(ll,t,0,e,n),"nesw-rotate":(t,e,n)=>Ps(ll,t,90,e,n),"senw-rotate":(t,e,n)=>Ps(ll,t,180,e,n),"swne-rotate":(t,e,n)=>Ps(ll,t,270,e,n)};function On(t,e=0,n="black"){return G8[t](f6(e),!1,n)}function K8(){const t=K(),e=Dt(),n=Cc();Bs("useCursor",()=>{const{type:r,rotation:s}=t.getInstanceState().cursor;if(H8.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",On(r,s,n?"white":"black"))},[t,e,n])}function V8(){const t=K(),e=Dt(),n=Cc(),r=X(yt.forceSrgb);qe.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,r,n])}function AO(t){const e=_.useRef();return _.useLayoutEffect(()=>{e.current=t}),_.useDebugValue(t),_.useCallback((...n)=>{const r=e.current;return Ze(r,"fn does not exist"),r(...n)},[])}function W8(){const[t,e]=_.useState(0);_.useEffect(()=>e(n=>n+1),[])}const Y8=t=>t.props.src,X8={upload:(t,e)=>yi.blobToDataUrl(e)};function Z8(t){return"schema"in t&&t.schema?t.schema:e6({shapes:"shapeUtils"in t&&t.shapeUtils?oI(IO(t.shapeUtils)):void 0,bindings:"bindingUtils"in t&&t.bindingUtils?oI(wO(t.bindingUtils)):void 0,migrations:"migrations"in t?t.migrations:void 0})}function Ya({initialData:t,defaultName:e="",id:n,assets:r=X8,onMount:s,collaboration:i,...o}={}){const a=Z8(o),c=new Lb({id:n,schema:a,initialData:t,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??Y8},onMount:l=>{Ze(l instanceof he),s?.(l)},collaboration:i}});if(o.snapshot){if(t)throw new Error("Cannot provide both initialData and snapshot");Qb(c,o.snapshot)}return c}function oI(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const Q8=(t,e)=>e.some(n=>t instanceof n);let aI,cI;function J8(){return aI||(aI=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function e9(){return cI||(cI=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jO=new WeakMap,Lx=new WeakMap,RO=new WeakMap,Cf=new WeakMap,sw=new WeakMap;function t9(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(as(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&jO.set(n,t)}).catch(()=>{}),sw.set(e,t),e}function n9(t){if(Lx.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Lx.set(t,e)}let Nx={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Lx.get(t);if(e==="objectStoreNames")return t.objectStoreNames||RO.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return as(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function r9(t){Nx=t(Nx)}function s9(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(_f(this),e,...n);return RO.set(r,e.sort?e.sort():[e]),as(r)}:e9().includes(t)?function(...e){return t.apply(_f(this),e),as(jO.get(this))}:function(...e){return as(t.apply(_f(this),e))}}function i9(t){return typeof t=="function"?s9(t):(t instanceof IDBTransaction&&n9(t),Q8(t,J8())?new Proxy(t,Nx):t)}function as(t){if(t instanceof IDBRequest)return t9(t);if(Cf.has(t))return Cf.get(t);const e=i9(t);return e!==t&&(Cf.set(t,e),sw.set(e,t)),e}const _f=t=>sw.get(t);function OO(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=as(o);return r&&o.addEventListener("upgradeneeded",c=>{r(as(o.result),c.oldVersion,c.newVersion,as(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function DO(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),as(n).then(()=>{})}const o9=["get","getKey","getAll","getAllKeys","count"],a9=["put","add","delete","clear"],If=new Map;function lI(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(If.get(e))return If.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=a9.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||o9.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),s&&c.done]))[0]};return If.set(e,i),i}r9(t=>({...t,get:(e,n,r)=>lI(e,n)||t.get(e,n,r),has:(e,n)=>!!lI(e,n)||t.has(e,n)}));const c9="TLDRAW_DOCUMENT_v2",l9="TLDRAW_ASSET_STORE_v1",LO="TLDRAW_DB_NAME_INDEX_v2",Oe={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function NO(t){const e=c9+t;return u9(e),await OO(e,4,{upgrade(n){n.objectStoreNames.contains(Oe.Records)||n.createObjectStore(Oe.Records),n.objectStoreNames.contains(Oe.Schema)||n.createObjectStore(Oe.Schema),n.objectStoreNames.contains(Oe.SessionState)||n.createObjectStore(Oe.SessionState),n.objectStoreNames.contains(Oe.Assets)||n.createObjectStore(Oe.Assets)}})}async function d9(t){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):iw(),n=l9+t;if(!e.find(p=>p===n))return;const s=await OO(n,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}}),i=s.transaction(["assets"],"readonly"),o=i.objectStore("assets"),a=await o.getAllKeys(),c=await Promise.all(a.map(async p=>[p,await o.get(p)]));await i.done;const l=await NO(t),d=l.transaction([Oe.Assets],"readwrite"),u=d.objectStore(Oe.Assets);for(const[p,f]of c)u.put(f,p);await d.done,s.close(),l.close(),await DO(n)}class Xa{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){Xa.connectedInstances.add(this),this.getDbPromise=(async()=>(await d9(e),await NO(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(qa)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Xa.connectedInstances.delete(this))}tx(e,n,r){const s=(async()=>{Ze(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(n,e),a=o.done.catch(c=>{if(!this.isClosed)throw c});try{return await r(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(s),s.finally(()=>this.pendingTransactionSet.delete(s)),s}async load({sessionId:e}={}){return await this.tx("readonly",[Oe.Records,Oe.Schema,Oe.SessionState],async n=>{const r=n.objectStore(Oe.Records),s=n.objectStore(Oe.Schema),i=n.objectStore(Oe.SessionState);let o=e?(await i.get(e))?.snapshot:null;return o||(o=(await i.getAll()).sort((l,d)=>l.updatedAt-d.updatedAt).pop()?.snapshot),{records:await r.getAll(),schema:await s.get(Oe.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:n,sessionId:r,sessionStateSnapshot:s}){await this.tx("readwrite",[Oe.Records,Oe.Schema,Oe.SessionState],async i=>{const o=i.objectStore(Oe.Records),a=i.objectStore(Oe.Schema),c=i.objectStore(Oe.SessionState);for(const[l,d]of Object.entries(n.added))await o.put(d,l);for(const[l,d]of Object.values(n.updated))await o.put(d,d.id);for(const l of Object.keys(n.removed))await o.delete(l);a.put(e.serialize(),Oe.Schema),s&&r?c.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:n,sessionId:r,sessionStateSnapshot:s}){await this.tx("readwrite",[Oe.Records,Oe.Schema,Oe.SessionState],async i=>{const o=i.objectStore(Oe.Records),a=i.objectStore(Oe.Schema),c=i.objectStore(Oe.SessionState);await o.clear();for(const[l,d]of Object.entries(n))await o.put(d,l);a.put(e.serialize(),Oe.Schema),s&&r?c.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Oe.SessionState],async e=>{const n=e.objectStore(Oe.SessionState),r=(await n.getAll()).sort((i,o)=>i.updatedAt-o.updatedAt);if(r.length<10){await e.done;return}const s=r.slice(0,r.length-10);for(const{id:i}of s)await n.delete(i)})}async getAsset(e){return await this.tx("readonly",[Oe.Assets],async n=>await n.objectStore(Oe.Assets).get(e))}async storeAsset(e,n){await this.tx("readwrite",[Oe.Assets],async r=>{await r.objectStore(Oe.Assets).put(n,e)})}}function iw(){const t=JSON.parse(Ab(LO)||"[]")??[];return Array.isArray(t)?t:[]}function u9(t){const e=new Set(iw());e.add(t),jb(LO,JSON.stringify([...e]))}function h9(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function p9(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const f9=350,g9=1e4,dI=Symbol("UPDATE_INSTANCE_STATE"),m9=t=>t;class y9{onmessage;constructor(e){}postMessage(e){}close(){}}const S9=typeof BroadcastChannel>"u"?y9:BroadcastChannel;class v9{constructor(e,{persistenceKey:n,sessionId:r=sd,onLoad:s,onLoadError:i},o=new S9(`tldraw-tab-sync-${n}`)){this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.db=new Xa(n),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=vO(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(m9({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(dI),this.schedulePersist()},{scope:"session"})),this.connect(s,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(s){n(s),p9();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const s=Object.fromEntries(r.records.map(a=>[a.id,a])),i=r.sessionStateSnapshot??$q(s),o=this.store.schema.migrateStoreSnapshot({store:s,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),n(new Error(`Failed to migrate store: ${o.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(o.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),i&&xO(this.store,i)}this.channel.onmessage=({data:s})=>{this.debug("got message",s);const i=s,o=this.store.schema.getMigrationsSince(i.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}i.type==="diff"&&(this.debug("applying diff"),Or(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(i.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;n(s);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?g9:f9))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(Ze(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=Db(e.filter(r=>r!==dI));await this.db.storeChanges({changes:n,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),h9(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function FO(t){const e=_.useRef(t),[n,r]=_.useState(t);n!==e.current&&r(e.current);const s=_.useCallback(i=>{typeof i=="function"?e.current=i(e.current):e.current=i,r(e.current)},[]);return[n,s]}function x9(t){const[e,n]=FO({status:"loading"});return t=Nd(t),_.useEffect(()=>{const{persistenceKey:r,sessionId:s,...i}=t;if(!r){n({status:"not-synced",store:Ya(i)});return}n({status:"loading"});const o=new ls,a={upload:async(u,p)=>(await d.db.storeAsset(u.id,p),u.id),resolve:async u=>u.props.src?u.props.src.startsWith("asset:")?await o.get(u,async()=>{const p=await d.db.getAsset(u.id);return p?URL.createObjectURL(p):null}):u.props.src:null,...i.assets},c=Ya({...i,assets:a});let l=!1;const d=new v9(c,{sessionId:s,persistenceKey:r,onLoad(){l||n({store:c,status:"synced-local"})},onLoadError(u){l||n({status:"error",error:u})}});return()=>{l=!0,d.close()}},[t,n]),e}function b9(){const t=K(),e=Dt();_.useEffect(()=>{const n=i=>e.style.setProperty("--tl-zoom",i.toString()),r=wj(n,100),s=new Do("useZoomCss",()=>{t.getCurrentPageShapeIds().size<300?n(t.getZoomLevel()):r(t.getZoomLevel())});return s.attach(),s.execute(),()=>{s.detach(),r.cancel()}},[t,e])}function Fx(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0,s=t.length;r<s;r++)n[r]=t.charCodeAt(r);return e}function w9(t){const e=atob(t),n=Fx(e);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const C9=5,Ll={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},_9=Math.max(...Object.values(Ll)),wa={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},I9=Object.keys(wa).length,dl="sales@tldraw.com";class BO{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=Tt("license state","pending");constructor(e,n,r){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=n||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,Ob.enableLicensing.get()?this.getLicenseFromKey(e).then(s=>{const i=P9(s);this.state.set(i?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[n,r]=e.split("."),[s,i]=n.split("/");if(!s.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${s}'`);const o=await w9(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(Fx(atob(r))),new Uint8Array(Fx(atob(i))))}catch(l){throw console.error(l),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(i))}catch{throw new Error("Could not parse object")}return c.length>I9&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[wa.ID],hosts:c[wa.HOSTS],flags:c[wa.FLAGS],expiryDate:c[wa.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let n=e.replace(/[\u200B-\u200D\uFEFF]/g,"");n=n.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(n),s=new Date(r.expiryDate),i=this.isFlagEnabled(r.flags,Ll.ANNUAL_LICENSE),o=this.isFlagEnabled(r.flags,Ll.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:s,isAnnualLicense:i,isAnnualLicenseExpired:i&&this.isAnnualLicenseExpired(s),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(s),isInternalLicense:this.isFlagEnabled(r.flags,Ll.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const n=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const s=r.toLowerCase().trim();return s===n||`www.${s}`===n||s===`www.${n}`||r==="*"?!0:r.includes("*")?new RegExp(r.replace(/\*/g,".*?")).test(n):!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+C9+1)}isAnnualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r=new Date>=n;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${dl} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r={major:new Date(I_.major),minor:new Date(I_.minor)};return r.major>=n||r.minor>=n}isFlagEnabled(e,n){return(e&n)===n}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${dl} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${dl} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${dl} if you would like to use tldraw on other domains.`]),e.license.flags>=_9*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){this.outputDelimiter();for(const n of e)console.log(`%c${n}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}function P9(t){if(!t.isLicenseParseable||!t.isDomainValid&&!t.isDevelopment)return!0;if(t.isPerpetualLicenseExpired||t.isAnnualLicenseExpired){if(t.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const $O=_.createContext({}),E9=()=>_.useContext($O);function k9({licenseKey:t,children:e}){const[n]=_.useState(()=>new BO(t));return h.jsx($O.Provider,{value:n,children:e})}const T9='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',M9=`${Os()}/watermarks/watermark-desktop.svg`,ul=`data:image/svg+xml;utf8,${encodeURIComponent(T9)}`;let Pf=null;async function A9(t){return t?ul:(Pf||(Pf=Promise.race([(async()=>{try{const e=await Nr(M9);if(!e.ok)return ul;const n=await e.blob();return URL.createObjectURL(n)}catch{return ul}})(),new Promise(e=>{setTimeout(()=>{e(ul)},3e3)})])),Pf)}const j9=qe.memo(function({forceLocal:e=!1}){const n=NR(),r=K(),s=E9(),i=X("show watermark",()=>Ob.enableLicensing.get()&&r.getViewportScreenBounds().width>760&&s.state.get()==="unlicensed",[r,s]),o=X("debug mode",()=>r.getInstanceState().isDebugMode,[r]),a=X("is menu open",()=>r.getIsMenuOpen(),[r]),[c,l]=_.useState(null),d=e||s.isDevelopment;if(_.useEffect(()=>{if(!i)return;let f=!1;return(async()=>{const m=await A9(d);f||l(m)})(),()=>{f=!0}},[d,i]),!i||!c)return null;const u=BO.className,p=`url('${c}') center 100% / 100% no-repeat`;return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${u} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${a?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${u}[data-debug='true'] {
	bottom: 46px;
}

.${u} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${u}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${u}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),h.jsx("div",{className:u,"data-debug":o,draggable:!1,...n,children:h.jsx("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:jt,style:{mask:p,WebkitMask:p}})})]})}),R9=[],O9=[],D9=[],L9="tl-container",N9=_.memo(function({store:e,components:n,className:r,user:s,...i}){const[o,a]=qe.useState(null),c=_.useMemo(()=>s??mO(),[s]),l=n?.ErrorFallback===void 0?oO:n?.ErrorFallback,d={...i,shapeUtils:i.shapeUtils??R9,bindingUtils:i.bindingUtils??O9,tools:i.tools??D9,components:n};return h.jsx("div",{ref:a,"data-tldraw":jR,draggable:!1,className:be(`${L9} tl-theme__light`,r),onPointerDown:jt,tabIndex:-1,children:h.jsx(Wa,{fallback:l,onError:u=>Tb(u,{tags:{origin:"react.tldraw-before-app"}}),children:o&&h.jsx(k9,{licenseKey:i.licenseKey,children:h.jsx(x6,{container:o,children:h.jsx(_q,{overrides:n,children:e?e instanceof Lb?h.jsx(UO,{...d,store:e,user:c}):h.jsx(zO,{...d,store:e,user:c}):h.jsx(F9,{...d,store:e,user:c})})})})})})});function F9(t){const{defaultName:e,snapshot:n,initialData:r,shapeUtils:s,bindingUtils:i,persistenceKey:o,sessionId:a,user:c,assets:l}=t,d=x9({shapeUtils:s,bindingUtils:i,initialData:r,persistenceKey:o,sessionId:a,defaultName:e,snapshot:n,assets:l});return h.jsx(zO,{...t,store:d,user:c})}const zO=_.memo(function({store:e,user:n,...r}){const s=Dt();_.useLayoutEffect(()=>{n.userPreferences.get().colorScheme==="dark"&&(s.classList.remove("tl-theme__light"),s.classList.add("tl-theme__dark"))},[s,n]);const{LoadingScreen:i}=st();switch(e.status){case"error":throw e.error;case"loading":return i?h.jsx(i,{}):null}return h.jsx(UO,{...r,store:e.store,user:n})}),Ef=()=>document.location.search.includes("tldraw_preserve_focus");function UO({onMount:t,children:e,store:n,tools:r,shapeUtils:s,bindingUtils:i,user:o,initialState:a,autoFocus:c=!0,inferDarkMode:l,cameraOptions:d,options:u,licenseKey:p}){const{ErrorFallback:f}=st(),m=Dt(),[y,S]=FO(null),g=_.useRef({autoFocus:c&&!Ef(),inferDarkMode:l,initialState:a,cameraOptions:d});_.useLayoutEffect(()=>{g.current={autoFocus:c&&!Ef(),inferDarkMode:l,initialState:a,cameraOptions:d}},[c,l,a,d]),_.useLayoutEffect(()=>{const{autoFocus:b,inferDarkMode:E,initialState:I,cameraOptions:C}=g.current,P=new he({store:n,shapeUtils:s,bindingUtils:i,tools:r,getContainer:()=>m,user:o,initialState:I,autoFocus:b,inferDarkMode:E,cameraOptions:C,options:u,licenseKey:p});return S(P),()=>{P.dispose()}},[i,m,u,s,n,r,o,S,p]),_.useLayoutEffect(()=>{y&&d&&y.setCameraOptions(d)},[y,d]);const v=_.useSyncExternalStore(_.useCallback(b=>y?(y.on("crash",b),()=>y.off("crash",b)):()=>{},[y]),()=>y?.getCrashingError()??null);_.useEffect(function(){if(!y)return;function E(){y&&y.focus()}function I(){y&&y.blur()}if(c&&Ef())return y.getContainer().addEventListener("pointerdown",E),document.body.addEventListener("pointerdown",I),()=>{y.getContainer()?.removeEventListener("pointerdown",E),document.body.removeEventListener("pointerdown",I)}},[y,c]);const{Canvas:x}=st();return y?h.jsx(Wa,{fallback:f,onError:b=>y.annotateError(b,{origin:"react.tldraw",willCrashApp:!0}),children:v?h.jsx($9,{crashingError:v}):h.jsx(Dd.Provider,{value:y,children:h.jsxs(B9,{onMount:t,children:[e??(x?h.jsx(x,{}):null),h.jsx(j9,{})]})})}):null}function B9({children:t,onMount:e}){return b9(),K8(),V8(),W8(),HO(n=>{const r=n.store.props.onMount(n),s=e?.(n);return()=>{r?.(),s?.()}}),t}function $9({crashingError:t}){throw t}function ow({children:t}){return h.jsx("div",{className:"tl-loading",children:t})}function qO({children:t}){return h.jsx("div",{className:"tl-loading",children:t})}function HO(t){const e=K(),n=AO(r=>{let s;return r.run(()=>{s=t?.(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,s});qe.useLayoutEffect(()=>{if(e)return n?.(e)},[e,n])}function Ii({children:t,className:e="",...n}){return h.jsx("div",{...n,className:be("tl-html-container",e),children:t})}class z9{constructor(e){this.editor=e}static props;static migrations;static type}function aw(t,e,n={}){const{newPoint:r,handle:s,scaleX:i,scaleY:o}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:d=1/0}=n;let u=t.props.w*i,p=t.props.h*o;const f=new w(0,0);if(u>0){if(u<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=u-a;break}case"top":case"bottom":{f.x=(u-a)/2;break}default:f.x=0}u=a}}else if(f.x=u,u=-u,u<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-u;break}default:f.x=-a}u=a}if(p>0){if(p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:m,y}=f.rot(t.rotation).add(r);return{...t,x:m,y,props:{w:Math.min(c,u),h:Math.min(d,p)}}}class Fo extends Qs{getGeometry(e){return new us({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,n)=>aw(e,n);getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,n,r){return{...n.props,w:xn(e.props.w,n.props.w,r),h:xn(e.props.h,n.props.h,r)}}}let U9=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}},q9=class extends Se{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=this.parent.shapeType,s=He();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:r,x:n.x,y:n.y,props:{w:1,h:1}}]).select(s),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const n=this.parent.shapeType,r=He();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:e.x,y:e.y}]);const s=this.editor.getShape(r);if(!s){this.cancel();return}let{w:i,h:o}=s.props;const a=new w(i/2,o/2),c=this.editor.getShapeParentTransform(s);c&&a.rot(-c.rotation());let l=1;this.editor.user.getIsDynamicResizeMode()&&(l=1/this.editor.getZoomLevel(),i*=l,o*=l,a.mul(l));const d=Ye(s);d.x=s.x-a.x,d.y=s.y-a.y,d.props.w=i,d.props.h=o,"scale"in s.props&&(d.props.scale=l),this.editor.updateShape(d),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};class H9 extends Se{static id="box";static initial="idle";static children=()=>[U9,q9];onCreate}function Ud(t){const e=K();return X("isEditing",()=>e.getEditingShapeId()===t,[e,t])}function kr(t){const e=K();return _.useMemo(function(){const s=l=>{if(l.isKilled)return;if(l.button===Kb){e.dispatch({type:"pointer",target:"selection",handle:t,name:"right_click",..._n(l)});return}if(l.button!==0)return;const d=nd(l.currentTarget);function u(){d.removeEventListener("pointerup",u),Sc(d,l)}yc(d,l),d.addEventListener("pointerup",u),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,..._n(l)}),jt(l)};let i,o;function a(l){l.isKilled||l.button===0&&(l.clientX===i&&l.clientY===o||(i=l.clientX,o=l.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,..._n(l)})))}return{onPointerDown:s,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,..._n(l)})}}},[e,t])}function G9(t){const[e,n]=_.useState(()=>({store:Ya(t),opts:t}));if(!kj(e.opts,t)){const r={store:Ya(t),opts:t};return n(r),r.store}return e.store}const K9=20,V9=8;function cw(t,e=K9){return Math.max(V9,Math.ceil(t/e))}class so extends Zs{_center;radius;start;end;largeArcFlag;sweepFlag;measure;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});const{center:n,sweepFlag:r,largeArcFlag:s,start:i,end:o}=e;if(i.equals(o))throw Error("Arc must have different start and end points.");this.angleStart=w.Angle(n,i),this.angleEnd=w.Angle(n,o),this.radius=w.Dist(n,i),this.measure=g6(this.angleStart,this.angleEnd,r,s),this.start=i,this.end=o,this.sweepFlag=r,this.largeArcFlag=s,this._center=n}nearestPoint(e){const{_center:n,measure:r,radius:s,angleEnd:i,angleStart:o,start:a,end:c}=this,l=Mx(r,o,i,n.angle(e));if(l<=0)return a;if(l>=1)return c;const d=n.clone().add(e.clone().sub(n).uni().mul(s));let u,p=1/0,f;for(const m of[a,c,d])f=w.Dist2(e,m),f<p&&(u=m,p=f);if(!u)throw Error("nearest point not found");return u}hitTestLineSegment(e,n){const{_center:r,radius:s,measure:i,angleStart:o,angleEnd:a}=this,c=bc(e,n,r,s);return c===null?!1:c.some(l=>{const d=Mx(i,o,a,r.angle(l));return d>=0&&d<=1})}getVertices(){const{_center:e,measure:n,length:r,radius:s,angleStart:i}=this,o=[];for(let a=0,c=cw(Math.abs(r));a<c+1;a++){const l=a/c*n,d=i+l;o.push(_i(e,s,d))}return o}getSvgPathData(e=!0){const{start:n,end:r,radius:s,largeArcFlag:i,sweepFlag:o}=this;return`${e?`M${n.toFixed()}`:""} A${s} ${s} 0 ${i} ${o} ${r.toFixed()}`}getLength(){return this.measure*this.radius}}class lw extends Zs{constructor(e){super({isClosed:!0,...e}),this.config=e;const{x:n=0,y:r=0,radius:s}=e;this.x=n,this.y=r,this._center=new w(s+n,s+r),this.radius=s}_center;radius;x;y;getBounds(){return new ce(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:e,radius:n}=this,r=Ue*n,s=[];for(let i=0,o=cw(r);i<o;i++){const a=i/o*Ue;s.push(_i(e,n,a))}return s}nearestPoint(e){const{_center:n,radius:r}=this;return n.equals(e)?w.AddXY(n,r,0):n.clone().add(e.clone().sub(n).uni().mul(r))}hitTestLineSegment(e,n,r=0){const{_center:s,radius:i}=this;return bc(e,n,s,i+r)!==null}getSvgPathData(){const{_center:e,radius:n}=this;return`M${e.x+n},${e.y} a${n},${n} 0 1,0 ${n*2},0a${n},${n} 0 1,0 -${n*2},0`}}class Jt extends No{a;b;c;d;constructor(e){const{start:n,cp1:r,cp2:s,end:i}=e;super({...e,points:[n,i]}),this.a=n,this.b=r,this.c=s,this.d=i}getVertices(){const e=[],{a:n,b:r,c:s,d:i}=this;for(let o=0,a=10;o<=a;o++){const c=o/a;e.push(new w((1-c)*(1-c)*(1-c)*n.x+3*((1-c)*(1-c))*c*r.x+3*(1-c)*(c*c)*s.x+c*c*c*i.x,(1-c)*(1-c)*(1-c)*n.y+3*((1-c)*(1-c))*c*r.y+3*(1-c)*(c*c)*s.y+c*c*c*i.y))}return e}midPoint(){return Jt.GetAtT(this,.5)}nearestPoint(e){let n,r=1/0,s,i;for(const o of this.segments)i=o.nearestPoint(e),s=w.Dist2(i,e),s<r&&(n=i,r=s);if(!n)throw Error("nearest point not found");return n}getSvgPathData(e=!0){const{a:n,b:r,c:s,d:i}=this;return`${e?`M ${n.toFixed()} `:""} C${r.toFixed()} ${s.toFixed()} ${i.toFixed()}`}static GetAtT(e,n){const{a:r,b:s,c:i,d:o}=e;return new w((1-n)*(1-n)*(1-n)*r.x+3*((1-n)*(1-n))*n*s.x+3*(1-n)*(n*n)*i.x+n*n*n*o.x,(1-n)*(1-n)*(1-n)*r.y+3*((1-n)*(1-n))*n*s.y+3*(1-n)*(n*n)*i.y+n*n*n*o.y)}getLength(e=32){let n,r=this.a,s=0;for(let i=1;i<=e;i++)n=Jt.GetAtT(this,i/e),s+=w.Dist(r,n),r=n;return s}}class W9 extends Zs{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{points:n}=e;this.points=n}_segments;get segments(){if(!this._segments){this._segments=[];const{points:e}=this,n=e.length,r=n-2,s=1.25;for(let i=0;i<n-1;i++){const o=i===0?e[0]:e[i-1],a=e[i],c=e[i+1],l=i===r?c:e[i+2],d=a,u=i===0?o:new w(a.x+(c.x-o.x)/6*s,a.y+(c.y-o.y)/6*s),p=i===r?c:new w(c.x-(l.x-a.x)/6*s,c.y-(l.y-a.y)/6*s),f=c;this._segments.push(new Jt({start:d,cp1:u,cp2:p,end:f}))}}return this._segments}getLength(){return this.segments.reduce((e,n)=>e+n.length,0)}getVertices(){const e=this.segments.reduce((n,r)=>n.concat(r.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let n,r=1/0,s,i;for(const o of this.segments)i=o.nearestPoint(e),s=w.Dist2(i,e),s<r&&(n=i,r=s);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(e,n){return this.segments.some(r=>r.hitTestLineSegment(e,n))}getSvgPathData(){let e=this.segments.reduce((n,r,s)=>n+r.getSvgPathData(s===0),"");return this.isClosed&&(e+="Z"),e}}class Y9 extends Zs{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:n,height:r}=e;this.w=n,this.h=r}w;h;_edges;get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let n=0,r=e.length;n<r;n++){const s=e[n],i=e[(n+1)%r];this._edges.push(new rs({start:s,end:i}))}}return this._edges}getVertices(){const e=Math.max(1,this.w),n=Math.max(1,this.h),r=e/2,s=n/2,i=Math.pow(r-s,2)/Math.pow(r+s,2),o=$e*(r+s)*(1+3*i/(10+Math.sqrt(4-3*i))),a=cw(o),c=Ue/a,l=Math.cos(c),d=Math.sin(c);let u=0,p=1,f=0,m=1;const y=Array(a);for(let S=0;S<a;S++)y[S]=new w(r+r*p,s+s*u),f=d*p+l*u,m=l*p-d*u,u=f,p=m;return y}nearestPoint(e){let n,r=1/0,s,i;for(const o of this.edges)i=o.nearestPoint(e),s=w.Dist2(i,e),s<r&&(n=i,r=s);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(e,n){return this.edges.some(r=>r.hitTestLineSegment(e,n))}getBounds(){return new ce(0,0,this.w,this.h)}getLength(){const{w:e,h:n}=this,r=e/2,s=n/2,i=Math.max(0,r),o=Math.max(0,s);return OR(i,o)}getSvgPathData(e=!1){const{w:n,h:r}=this,s=n/2,i=r/2,o=Math.max(0,s),a=Math.max(0,i);return`${e?`M${s-o},${i}`:""} a${o},${a},0,1,1,${o*2},0a${o},${a},0,1,1,-${o*2},0`}}class X9 extends Zs{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:n,height:r}=e;if(this.w=n,this.h=r,r>n){const s=n/2;this.a=new so({start:new w(0,s),end:new w(n,s),center:new w(n/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new rs({start:new w(n,s),end:new w(n,r-s)}),this.c=new so({start:new w(n,r-s),end:new w(0,r-s),center:new w(n/2,r-s),sweepFlag:1,largeArcFlag:1}),this.d=new rs({start:new w(0,r-s),end:new w(0,s)})}else{const s=r/2;this.a=new so({start:new w(s,r),end:new w(s,0),center:new w(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new rs({start:new w(s,0),end:new w(n-s,0)}),this.c=new so({start:new w(n-s,0),end:new w(n-s,r),center:new w(n-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new rs({start:new w(n-s,r),end:new w(s,r)})}}w;h;a;b;c;d;nearestPoint(e){let n,r=1/0,s,i;const{a:o,b:a,c,d:l}=this;for(const d of[o,a,c,l])i=d.nearestPoint(e),s=w.Dist2(i,e),s<r&&(n=i,r=s);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(e,n){const{a:r,b:s,c:i,d:o}=this;return[r,s,i,o].some(a=>a.hitTestLineSegment(e,n))}getVertices(){const{a:e,b:n,c:r,d:s}=this;return[e,n,r,s].reduce((i,o)=>(i.push(...o.vertices),i),[])}getBounds(){return new ce(0,0,this.w,this.h)}getLength(){const{h:e,w:n}=this;return e>n?($e*(n/2)+(e-n))*2:($e*(e/2)+(n-e))*2}getSvgPathData(){const{a:e,b:n,c:r,d:s}=this;return[e,n,r,s].map((i,o)=>i.getSvgPathData(o===0)).join(" ")+" Z"}}async function Z9({shouldReload:t=!0}={}){Cz();for(const e of Xa.connectedInstances)await e.close();await Promise.all(iw().map(e=>DO(e))),wz(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=Z9);function Q9(t,e="_blank"){Xb.openWindow(t,e)}function J9({children:t}){const e=K();return X("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?h.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null}const{PI:e7}=Math,go=e7+1e-4;function GO(t,e={}){const{size:n=16,smoothing:r=.5}=e;if(t.length===0||n<=0)return{left:[],right:[]};const s=t[0],i=t[t.length-1],o=i.runningLength,a=Math.pow(n*r,2),c=[],l=[];let d=t[0].vector,u=t[0].point,p=u,f=u,m=p,y=!1,S;for(let g=0;g<t.length;g++){S=t[g];const{point:v,vector:x}=t[g],b=S.vector.dpr(d),E=(g<t.length-1?t[g+1]:t[g]).vector,I=g<t.length-1?E.dpr(S.vector):1,C=b<0&&!y,P=I!==null&&I<.2;if(C||P){if(I>-.62&&o-S.runningLength>S.radius){const T=d.clone().mul(S.radius);d.clone().cpr(E)<0?(f=w.Add(v,T),m=w.Sub(v,T)):(f=w.Sub(v,T),m=w.Add(v,T)),c.push(f),l.push(m)}else{const T=d.clone().mul(S.radius).per(),M=w.Sub(S.input,T);for(let A=1/13,j=0;j<1;j+=A)f=w.RotWith(M,S.input,go*j),c.push(f),m=w.RotWith(M,S.input,go+go*-j),l.push(m)}u=f,p=m,P&&(y=!0);continue}if(y=!1,S===s||S===i){const T=w.Per(x).mul(S.radius);c.push(w.Sub(v,T)),l.push(w.Add(v,T));continue}const k=w.Lrp(E,x,I).per().mul(S.radius);f=w.Sub(v,k),(g<=1||w.Dist2(u,f)>a)&&(c.push(f),u=f),m=w.Add(v,k),(g<=1||w.Dist2(p,m)>a)&&(l.push(m),p=m),d=x}return{left:c,right:l}}function dw(t,e={}){const{size:n=16,start:r={},end:s={},last:i=!1}=e,{cap:o=!0}=r,{cap:a=!0}=s;if(t.length===0||n<=0)return[];const c=t[0],l=t[t.length-1],d=l.runningLength,u=r.taper===!1?0:r.taper===!0?Math.max(n,d):r.taper,p=s.taper===!1?0:s.taper===!0?Math.max(n,d):s.taper,{left:f,right:m}=GO(t,e),y=c.point,S=t.length>1?t[t.length-1].point:w.AddXY(c.point,1,1);if(t.length===1&&(!(u||p)||i)){const b=w.Add(y,w.Sub(y,S).uni().per().mul(-c.radius)),E=[];for(let I=1/13,C=I;C<=1;C+=I)E.push(w.RotWith(b,y,go*2*C));return E}const g=[];if(!(u||p&&t.length===1))if(o)for(let b=1/8,E=b;E<=1;E+=b){const I=w.RotWith(m[0],y,go*E);g.push(I)}else{const b=w.Sub(f[0],m[0]),E=w.Mul(b,.5),I=w.Mul(b,.51);g.push(w.Sub(y,E),w.Sub(y,I),w.Add(y,I),w.Add(y,E))}const v=[],x=l.vector.clone().per().neg();if(p||u&&t.length===1)v.push(S);else if(a){const b=w.Add(S,w.Mul(x,l.radius));for(let E=1/29,I=E;I<1;I+=E)v.push(w.RotWith(b,S,go*3*I))}else v.push(w.Add(S,w.Mul(x,l.radius)),w.Add(S,w.Mul(x,l.radius*.99)),w.Sub(S,w.Mul(x,l.radius*.99)),w.Sub(S,w.Mul(x,l.radius)));return f.concat(v,m.reverse(),g)}const t7=.025,n7=.01;function $r(t,e={}){const{streamline:n=.5,size:r=16,simulatePressure:s=!1}=e;if(t.length===0)return[];const i=.15+(1-n)*.85;let o=t.map(w.From),a=0;if(!s){let S=o[0];for(;S&&!(S.z>=t7);)o.shift(),S=o[0]}if(!s){let S=o[o.length-1];for(;S&&!(S.z>=n7);)o.pop(),S=o[o.length-1]}if(o.length===0)return[{point:w.From(t[0]),input:w.From(t[0]),pressure:s?.5:.15,vector:new w(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(w.Dist2(c,o[0])>(r/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const l=o.pop();for(c=o[o.length-1];c&&!(w.Dist2(c,l)>(r/3)**2);)o.pop(),c=o[o.length-1],a++;o.push(l);const d=e.last||!e.simulatePressure||o.length>1&&w.Dist2(o[o.length-1],o[o.length-2])<r**2||a>0;if(o.length===2&&e.simulatePressure){const S=o[1];o=o.slice(0,-1);for(let g=1;g<5;g++){const v=w.Lrp(o[0],S,g/4);v.z=(o[0].z+(S.z-o[0].z))*g/4,o.push(v)}}const u=[{point:o[0],input:o[0],pressure:s?.5:o[0].z,vector:new w(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=u[0],m,y;d&&n>0&&o.push(o[o.length-1].clone());for(let S=1,g=o.length;S<g;S++)m=!i||e.last&&S===g-1?o[S].clone():o[S].clone().lrp(f.point,1-i),!f.point.equals(m)&&(y=w.Dist(m,f.point),p+=y,!(S<4&&p<r)&&(f={input:o[S],point:m,pressure:s?.5:o[S].z,vector:w.Sub(f.point,m).uni(),distance:y,runningLength:p,radius:1},u.push(f)));if(u[1]?.vector&&(u[0].vector=u[1].vector.clone()),p<1){const S=Math.max(.5,...u.map(g=>g.pressure));u.forEach(g=>g.pressure=S)}return u}const{min:Es}=Math,kf=.275;function qd(t,e){const{size:n=16,thinning:r=.5,simulatePressure:s=!0,easing:i=S=>S,start:o={},end:a={}}=e,{easing:c=Mt.easeOutQuad}=o,{easing:l=Mt.easeOutCubic}=a,d=t[t.length-1].runningLength;let u,p=t[0].pressure,f;if(!s&&d<n){const S=t.reduce((g,v)=>Math.max(g,v.pressure),.5);return t.forEach(g=>{g.pressure=S,g.radius=n*i(.5-r*(.5-g.pressure))}),t}else{let S;for(let g=0,v=t.length;g<v&&(f=t[g],!(f.runningLength>n*5));g++){const x=Es(1,f.distance/n);if(s){const b=Es(1,1-x);S=Es(1,p+(b-p)*(x*kf))}else S=Es(1,p+(f.pressure-p)*.5);p=p+(S-p)*.5}for(let g=0;g<t.length;g++){if(f=t[g],r){let{pressure:v}=f;const x=Es(1,f.distance/n);if(s){const b=Es(1,1-x);v=Es(1,p+(b-p)*(x*kf))}else v=Es(1,p+(v-p)*(x*kf));f.radius=n*i(.5-r*(.5-v)),p=v}else f.radius=n/2;u===void 0&&(u=f.radius)}}const m=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,y=a.taper===!1?0:a.taper===!0?Math.max(n,d):a.taper;if(m||y)for(let S=0;S<t.length;S++){f=t[S];const{runningLength:g}=f,v=g<m?c(g/m):1,x=d-g<y?l((d-g)/y):1;f.radius=Math.max(.01,f.radius*Math.min(v,x))}return t}function r7(t,e={}){return dw(qd($r(t,e),e),e)}function uI({scribble:t,zoom:e,color:n,opacity:r,className:s}){if(!t.points.length)return null;const i=r7(t.points,{size:t.size/e,start:{taper:t.taper,easing:Mt.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(i.length<4){const a=t.size/e/2,{x:c,y:l}=t.points[t.points.length-1];o=`M ${c-a},${l} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=Wb(i);return h.jsx("svg",{className:s&&be("tl-overlays__item",s),children:h.jsx("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${t.color})`,opacity:r??t.opacity})})}const s7=({bounds:t,rotation:e})=>{const n=K();return X("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?h.jsx(tO,{bounds:t,rotation:e}):null};function ys(){const t=K();return X("isReadonlyMode",()=>t.getInstanceState().isReadonly,[t])}function i7({size:t,width:e,height:n,hideAlternateHandles:r}){const s=G(t/3),i=s/2;return h.jsxs("svg",{className:"tl-overlays__item",children:[h.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${G(0-i)},${G(t)} 
						${G(0-i)},${G(0-i)} 
						${G(t)},${G(0-i)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),h.jsx("line",{className:be("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:G(e/2-t),y1:G(0-i),x2:G(e/2+t),y2:G(0-i),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),h.jsx("polyline",{className:be("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${G(e-t)},${G(0-i)} 
						${G(e+i)},${G(0-i)} 
						${G(e+i)},${G(t)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),h.jsx("line",{className:be("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:G(e+i),y1:G(n/2-t),x2:G(e+i),y2:G(n/2+t),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),h.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${G(e+i)},${G(n-t)} 
						${G(e+i)},${G(n+i)}
						${G(e-t)},${G(n+i)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),h.jsx("line",{className:be("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:G(e/2-t),y1:G(n+i),x2:G(e/2+t),y2:G(n+i),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),h.jsx("polyline",{className:be("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${G(0+t)},${G(n+i)} 
						${G(0-i)},${G(n+i)}
						${G(0-i)},${G(n-t)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),h.jsx("line",{className:be("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:G(0-i),y1:G(n/2-t),x2:G(0-i),y2:G(n/2+t),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const o7=Ot(function({bounds:e,rotation:n}){const r=K(),s=_.useRef(null),i=ys(),o=kr("top"),a=kr("right"),c=kr("bottom"),l=kr("left"),d=kr("top_left"),u=kr("top_right"),p=kr("bottom_right"),f=kr("bottom_left"),m=!r.getIsMenuOpen()&&r.getInstanceState().cursor.type==="default",y=r.getInstanceState().isCoarsePointer,S=r.getOnlySelectedShape(),g=S&&r.isShapeOrAncestorLocked(S),v=S?r.getShapeUtil(S).expandSelectionOutlinePx(S):0;if(Lo(s,e?.x,e?.y,1,r.getSelectionRotation(),{x:-v,y:-v}),!e)return null;e=e.clone().expandBy(v).zeroFix();const x=r.getZoomLevel(),b=r.getInstanceState().isChangingStyle,E=e.width,I=e.height,C=8/x,P=E<C*2,k=I<C*2,T=E<C*4,M=I<C*4,A=E<C*5,j=I<C*5,R=y?1.75:1,L=6/x*R,F=(T?L/2:L)*(R*.75),H=(M?L/2:L)*(R*.75),B=(S?!r.getShapeUtil(S).hideSelectionBoundsFg(S):!0)&&!b;let $=B&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||B&&r.isIn("select.resizing")&&S&&r.isShapeOfType(S,"text");S&&$&&r.environment.isFirefox&&r.isShapeOfType(S,"embed")&&($=!1);const Q=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!b&&!i,Z=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!b&&!i,ee=!y&&!(P||k)&&(Z||Q)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!g,ne=y&&(!T||!M)&&(Z||Q)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!g,N=Z&&(S?r.getShapeUtil(S).canResize(S)&&!r.getShapeUtil(S).hideResizeHandles(S):!0)&&!Q&&!g,D=P||k,q=P&&k,U=A||j,V=N||Q,te=!ee,ie=!Z||!ne,oe=!Z||!V,ue=!Z||!V||D,de=!Z||!V||D,ge=!Z||!V||q&&!Q;let le=!0,xe=!0;if(Q)le=U,xe=U;else if(N){le=D||q||y;const ht=y&&S&&S.type==="text";xe=le&&!ht}const me=Math.min(24/x,I-H*3),et=Z&&y&&S&&r.isShapeOfType(S,"text")&&me*x>=4;return h.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:h.jsxs("g",{ref:s,children:[$&&h.jsx("rect",{className:"tl-selection__fg__outline",width:G(E),height:G(I)}),h.jsx(hl,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:L,corner:"top_left_rotate",cursor:m?On("nwse-rotate",n):void 0,isHidden:te}),h.jsx(hl,{"data-testid":"selection.rotate.top-right",cx:E+L*3,cy:0,targetSize:L,corner:"top_right_rotate",cursor:m?On("nesw-rotate",n):void 0,isHidden:te}),h.jsx(hl,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:I+L*3,targetSize:L,corner:"bottom_left_rotate",cursor:m?On("swne-rotate",n):void 0,isHidden:te}),h.jsx(hl,{"data-testid":"selection.rotate.bottom-right",cx:E+L*3,cy:I+L*3,targetSize:L,corner:"bottom_right_rotate",cursor:m?On("senw-rotate",n):void 0,isHidden:te}),h.jsx(c7,{"data-testid":"selection.rotate.mobile",cx:T?-L*1.5:E/2,cy:T?I/2:-L*1.5,size:C,isHidden:ie}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":le}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:G(0-(M?H*2:H)),width:G(E),height:G(Math.max(1,H*2)),style:m?{cursor:On("ns-resize",n)}:void 0,...o}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":xe}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:G(E-(T?0:F)),y:0,height:G(I),width:G(Math.max(1,F*2)),style:m?{cursor:On("ew-resize",n)}:void 0,...a}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":le}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:G(I-(M?0:H)),width:G(E),height:G(Math.max(1,H*2)),style:m?{cursor:On("ns-resize",n)}:void 0,...c}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":xe}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:G(0-(T?F*2:F)),y:0,height:G(I),width:G(Math.max(1,F*2)),style:m?{cursor:On("ew-resize",n)}:void 0,...l}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":oe}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:G(0-(T?F*2:F*1.5)),y:G(0-(M?H*2:H*1.5)),width:G(F*3),height:G(H*3),style:m?{cursor:On("nwse-resize",n)}:void 0,...d}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":ue}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:G(E-(T?0:F*1.5)),y:G(0-(M?H*2:H*1.5)),width:G(F*3),height:G(H*3),style:m?{cursor:On("nesw-resize",n)}:void 0,...u}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":ge}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:G(E-(T?F:F*1.5)),y:G(I-(M?H:H*1.5)),width:G(F*3),height:G(H*3),style:m?{cursor:On("nwse-resize",n)}:void 0,...p}),h.jsx("rect",{className:be("tl-transparent",{"tl-hidden":de}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:G(0-(T?F*3:F*1.5)),y:G(I-(M?0:H*1.5)),width:G(F*3),height:G(H*3),style:m?{cursor:On("nesw-resize",n)}:void 0,...f}),N&&h.jsxs(h.Fragment,{children:[h.jsx("rect",{"data-testid":"selection.resize.top-left",className:be("tl-corner-handle",{"tl-hidden":oe}),"aria-label":"top_left handle",x:G(0-C/2),y:G(0-C/2),width:G(C),height:G(C)}),h.jsx("rect",{"data-testid":"selection.resize.top-right",className:be("tl-corner-handle",{"tl-hidden":ue}),"aria-label":"top_right handle",x:G(E-C/2),y:G(0-C/2),width:G(C),height:G(C)}),h.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:be("tl-corner-handle",{"tl-hidden":ge}),"aria-label":"bottom_right handle",x:G(E-C/2),y:G(I-C/2),width:G(C),height:G(C)}),h.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:be("tl-corner-handle",{"tl-hidden":de}),"aria-label":"bottom_left handle",x:G(0-C/2),y:G(I-C/2),width:G(C),height:G(C)})]}),et&&h.jsxs(h.Fragment,{children:[h.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:G(0-C/4),y:G(I/2-me/2),rx:C/4,width:G(C/2),height:G(me)}),h.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:C/4,x:G(E-C/4),y:G(I/2-me/2),width:G(C/2),height:G(me)})]}),Q&&h.jsx(i7,{size:C,width:E,height:I,hideAlternateHandles:U})]})})}),hl=function({cx:e,cy:n,targetSize:r,corner:s,cursor:i,isHidden:o,"data-testid":a}){const c=kr(s);return h.jsx("rect",{className:be("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${s} target`,pointerEvents:"all",x:G(e-r*3),y:G(n-r*3),width:G(Math.max(1,r*3)),height:G(Math.max(1,r*3)),cursor:i,...c})},a7=Math.sqrt(Math.PI),c7=function({cx:e,cy:n,size:r,isHidden:s,"data-testid":i}){const o=kr("mobile_rotate"),a=K(),c=X("zoom level",()=>a.getZoomLevel(),[a]),l=Math.max(14*(1/c),20/Math.max(1,c));return h.jsxs("g",{children:[h.jsx("circle",{"data-testid":i,pointerEvents:"all",className:be("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:e,cy:n,r:l,...o}),h.jsx("circle",{className:be("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:e,cy:n,r:r/a7})]})};function l7(){const t=K();return X("is in a valid select state",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[t])?h.jsx(nO,{}):null}function Bx(t,e,n){const{arrowheadStart:r,arrowheadEnd:s}=e.props,i=io(t,e,n),o=i.start.clone(),a=i.end.clone(),c=w.Med(o,a);if(w.Equals(o,a))return{bindings:n,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const l=w.Sub(a,o).uni(),d=id(t,e,"start"),u=id(t,e,"end"),p=t.getShapePageTransform(e);hI(a,i.start,p,u),hI(o,i.end,p,d);let f=0,m=0,y=0,S=0,g=oo*e.props.scale;const v=d&&u&&d.shape===u.shape,x=d&&u?uw(t,d.shape.id,u.shape.id):"safe";x==="safe"&&d&&u&&!v&&!d.isExact&&!u.isExact&&(u.didIntersect&&!d.didIntersect?d.isClosed&&o.setTo(a.clone().add(l.clone().mul(oo*e.props.scale))):u.didIntersect||u.isClosed&&a.setTo(o.clone().sub(l.clone().mul(oo*e.props.scale))));const b=w.Sub(a,o),E=w.Len(b)?b.uni():w.From(b),I=!w.Equals(E,l);v||(x!=="start-contains-end"&&d&&r!=="none"&&!d.isExact&&(y=Ds[e.props.size]/2+("size"in d.shape.props?Ds[d.shape.props.size]/2:0),f=(od+y)*e.props.scale,g+=y*e.props.scale),x!=="end-contains-start"&&u&&s!=="none"&&!u.isExact&&(S=Ds[e.props.size]/2+("size"in u.shape.props?Ds[u.shape.props.size]/2:0),m=(od+S)*e.props.scale,g+=S*e.props.scale));const C=o.clone().add(E.clone().mul(f*(I?-1:1))),P=a.clone().sub(E.clone().mul(m*(I?-1:1)));w.DistMin(C,P,g)&&(f!==0&&m!==0?(f*=-1.5,m*=-1.5):f!==0?f*=-1:m!==0&&(m*=-1)),o.add(E.clone().mul(f*(I?-1:1))),a.sub(E.clone().mul(m*(I?-1:1))),I?(d&&u&&a.setTo(w.Add(o,E.clone().mul(-oo*e.props.scale))),c.setTo(w.Med(i.start,i.end))):c.setTo(w.Med(o,a));const k=w.Dist(o,a);return{bindings:n,isStraight:!0,start:{handle:i.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:i.end,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:k>0,length:k}}function hI(t,e,n,r){if(r===void 0||r.isExact)return;const s=se.applyToPoint(n,e),i=se.applyToPoint(n,t),o=se.applyToPoint(se.Inverse(r.transform),s),a=se.applyToPoint(se.Inverse(r.transform),i),c=r.isClosed,d=(c?ew:Uq)(o,a,r.outline);let u;if(d!==null&&(u=d.sort((m,y)=>w.Dist2(m,o)-w.Dist2(y,o))[0]??(c?void 0:a)),u===void 0)return;const p=se.applyToPoint(r.transform,u),f=se.applyToPoint(se.Inverse(n),p);t.setTo(f),r.didIntersect=!0}function d7(t,e,n){const{arrowheadEnd:r,arrowheadStart:s}=e.props,i=e.props.bend;if(Math.abs(i)>Math.abs(e.props.bend*(g7*e.props.scale)))return Bx(t,e,n);const o=io(t,e,n),a=w.Med(o.start,o.end),c=w.Sub(o.end,o.start),l=w.Len(c)?c.uni():w.From(c),d=w.Add(a,l.per().mul(-i)),u=id(t,e,"start"),p=id(t,e,"end"),f=o.start.clone(),m=o.end.clone(),y=d.clone();if(w.Equals(f,m))return{bindings:n,isStraight:!0,start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:m,point:m,arrowhead:e.props.arrowheadEnd},middle:y,isValid:!1,length:0};const S=e.props.bend<0,g=S?mc:DR,v=pI(f,m,y),x=w.Angle(v.center,f),b=w.Angle(v.center,m),E=g(x,b);if(v.length===0||v.size===0||!E_(v.length)||!E_(v.size))return Bx(t,e,n);const I=f.clone(),C=m.clone(),P=y.clone(),k=t.getShapePageTransform(e);let T=0,M=0,A=oo*e.props.scale;if(u&&!u.isExact){const Q=se.applyToPoint(k,I),Z=se.applyToPoint(k,v.center),ee=se.applyToPoint(k,C),ne=se.Inverse(u.transform),N=se.applyToPoint(ne,Q),D=se.applyToPoint(ne,Z),q=se.applyToPoint(ne,ee),{isClosed:U}=u,V=U?Ox:Y_;let te,ie=V(D,v.radius,u.outline);if(ie){const oe=D.angle(N),ue=D.angle(q),de=g(oe,ue);ie=ie.filter(le=>g(oe,D.angle(le))<=de);const ge=de*.25;ie.sort(U?(le,xe)=>Math.abs(g(oe,D.angle(le))-ge)<Math.abs(g(oe,D.angle(xe))-ge)?-1:1:(le,xe)=>g(oe,D.angle(le))<g(oe,D.angle(xe))?-1:1),te=ie[0]??(U?void 0:N)}else te=U?void 0:N;if(te&&(I.setTo(t.getPointInShapeSpace(e,se.applyToPoint(u.transform,te))),u.didIntersect=!0,s!=="none")){const oe=Ds[e.props.size]/2+("size"in u.shape.props?Ds[u.shape.props.size]/2:0);T=(od+oe)*e.props.scale,A+=oe*e.props.scale}}if(p&&!p.isExact){const Q=se.applyToPoint(k,I),Z=se.applyToPoint(k,C),ee=se.applyToPoint(k,v.center),ne=se.Inverse(p.transform),N=se.applyToPoint(ne,Q),D=se.applyToPoint(ne,ee),q=se.applyToPoint(ne,Z),U=p.isClosed,V=U?Ox:Y_;let te,ie=V(D,v.radius,p.outline);if(ie){const oe=D.angle(N),ue=D.angle(q),de=g(oe,ue),ge=de*.75;ie=ie.filter(le=>g(oe,D.angle(le))<=de),ie.sort(U?(le,xe)=>Math.abs(g(oe,D.angle(le))-ge)<Math.abs(g(oe,D.angle(xe))-ge)?-1:1:(le,xe)=>g(oe,D.angle(le))<g(oe,D.angle(xe))?-1:1),ie[0]?te=ie[0]:te=U?void 0:q}else te=U?void 0:q;if(te&&(C.setTo(t.getPointInShapeSpace(e,se.applyToPoint(p.transform,te))),p.didIntersect=!0,r!=="none")){const oe=Ds[e.props.size]/2+("size"in p.shape.props?Ds[p.shape.props.size]/2:0);M=(od+oe)*e.props.scale,A+=oe*e.props.scale}}let j=w.Angle(v.center,I),R=w.Angle(v.center,C),L=g(j,R),F=L*v.radius;const H=I.clone(),B=C.clone();if(T!==0&&H.setTo(v.center).add(w.FromAngle(j+L*(T/F*(S?1:-1))).mul(v.radius)),M!==0&&B.setTo(v.center).add(w.FromAngle(R+L*(M/F*(S?-1:1))).mul(v.radius)),w.DistMin(H,B,A)&&(T!==0&&M!==0?(T*=-1.5,M*=-1.5):T!==0?T*=-2:M!==0&&(M*=-2)),T!==0&&I.setTo(v.center).add(w.FromAngle(j+L*(T/F*(S?1:-1))).mul(v.radius)),M!==0&&C.setTo(v.center).add(w.FromAngle(R+L*(M/F*(S?-1:1))).mul(v.radius)),u&&p&&!u.isExact&&!p.isExact){j=w.Angle(v.center,I),R=w.Angle(v.center,C),L=g(j,R),F=L*v.radius;const Q=uw(t,u.shape.id,p.shape.id);Q==="double-bound"&&F<30?(I.setTo(f),C.setTo(m),P.setTo(y)):Q==="safe"&&(u&&!u.didIntersect&&I.setTo(f),(p&&!p.didIntersect||g(x,j)>g(x,R))&&C.setTo(v.center).add(w.FromAngle(j+L*(Math.min(.9,oo*e.props.scale/F)*(S?1:-1))).mul(v.radius)))}u7(v.center,v.radius,I,C,P,E,S),I.equals(C)&&(I.setTo(P.clone().addXY(1,1)),C.setTo(P.clone().subXY(1,1))),f.setTo(I),m.setTo(C),y.setTo(P);const $=pI(f,m,y);return{bindings:n,isStraight:!1,start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:m,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:y,handleArc:v,bodyArc:$,isValid:$.length!==0&&isFinite($.center.x)&&isFinite($.center.y)}}function pI(t,e,n){const r=Gb(t,e,n),s=w.Dist(r,t),i=+w.Clockwise(t,n,e),o=((t.y-e.y)**2+(t.x-e.x)**2)**.5,a=((e.y-n.y)**2+(e.x-n.x)**2)**.5,c=((n.y-t.y)**2+(n.x-t.x)**2)**.5,l=Math.acos((a*a+c*c-o*o)/(2*a*c))*2,d=+($e>l),u=(Ue-l)*(i?1:-1),p=u*s;return{center:r,radius:s,size:u,length:p,largeArcFlag:d,sweepFlag:i}}function u7(t,e,n,r,s,i,o){const a=w.Angle(t,n),c=w.Angle(t,r);let l=mc(a,c);if(o||(l=Ue-l),s.setTo(t).add(w.FromAngle(a+l*(.5*(o?1:-1))).mul(e)),l>i){s.rotWith(t,$e);const d=r.clone();r.setTo(n),n.setTo(d)}}const h7=8;function p7(t){return Math.abs(t.props.bend)<h7*t.props.scale}function id(t,e,n){const r=t.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===n);if(!r)return;const s=t.getShape(r.toId);if(!s)return;const i=t.getShapePageTransform(s),o=t.getShapeGeometry(s),a=o instanceof xr?o.children[0].vertices:o.vertices;return{shape:s,transform:i,isClosed:o.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function fI(t,e,n,r){const s=t.getShape(n.toId);if(s){const{point:i,size:o}=t.getShapeGeometry(s).bounds,a=w.Add(i,w.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},o)),c=se.applyToPoint(t.getShapePageTransform(s),a);return se.applyToPoint(se.Inverse(e),c)}else return new w(0,0)}function wn(t,e){const n=t.getBindingsFromShape(e,"arrow");return{start:n.find(r=>r.props.terminal==="start"),end:n.find(r=>r.props.terminal==="end")}}const f7=Uz("arrow info",(t,e)=>{const n=wn(t,e);return p7(e)?Bx(t,e,n):d7(t,e,n)});function Rr(t,e){const n=typeof e=="string"?e:e.id;return f7.get(t,n)}function io(t,e,n){const r=t.getShapePageTransform(e),s=uw(t,n.start?.toId,n.end?.toId),i=n.start?fI(t,r,n.start,s==="double-bound"||s==="start-contains-end"):w.From(e.props.start),o=n.end?fI(t,r,n.end,s==="double-bound"||s==="end-contains-start"):w.From(e.props.end);return{start:i,end:o}}function la(t,e,n,r){const s=typeof e=="string"?e:e.id,i=typeof n=="string"?n:n.id,o=t.getBindingsFromShape(s,"arrow").filter(c=>c.props.terminal===r.terminal);o.length>1&&t.deleteBindings(o.slice(1));const a=o[0];a?t.updateBinding({...a,toId:i,props:r}):t.createBinding({type:"arrow",fromId:s,toId:i,props:r})}function Nl(t,e,n){const r=t.getBindingsFromShape(e,"arrow").filter(s=>s.props.terminal===n);t.deleteBindings(r)}const oo=10,od=10,g7=10,Ds={s:2,m:3.5,l:5,xl:10};function uw(t,e,n){if(!e||!n)return"safe";if(e===n)return"double-bound";const r=t.getShapePageBounds(e),s=t.getShapePageBounds(n);if(r&&s){if(r.contains(s))return"start-contains-end";if(s.contains(r))return"end-contains-start"}return"safe"}class m7 extends z9{static type="arrow";static props=nR;static migrations=rR;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){Tf(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){Tf(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){Tf(this.editor,e)}onAfterChangeToShape({binding:e}){KO(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const n=this.editor.getShape(e.fromId);n&&ad({editor:this.editor,arrow:n,terminal:e.props.terminal})}}function KO(t,e){const n=t.getShape(e);if(!n)return;const r=wn(t,n),{start:s,end:i}=r,o=s?t.getShape(s.toId):void 0,a=i?t.getShape(i.toId):void 0,c=t.getAncestorPageId(n);if(!c)return;let l;if(o&&a)l=t.findCommonAncestor([o,a])??c;else if(o||a){const S=(o||a)?.parentId;S&&S===n.parentId?l=n.parentId:l=c}else return;l&&l!==n.parentId&&t.reparentShapes([e],l);const d=t.getShape(e);if(!d)throw Error("no reparented arrow");const u=t.getShapeNearestSibling(d,o),p=t.getShapeNearestSibling(d,a);let f;if(u&&p)f=u.index>p.index?u:p;else if(u&&!p)f=u;else if(p&&!u)f=p;else return;let m;const y=t.getSortedChildIdsForParent(f.parentId).map(S=>t.getShape(S)).filter(S=>S.index>f.index);if(y.length){const S=y.find(g=>g.type!=="arrow");if(d.index>f.index&&(!S||d.index<S.index))return;m=Ha(f.index,y[0].index)}else m=fr(f.index);m!==d.index&&t.updateShapes([{id:e,type:"arrow",index:m}])}function Tf(t,e){const n=wn(t,e);for(const r of["start","end"]){const s=n[r];if(!s)continue;const i=t.getShape(s.toId),o=t.getAncestorPageId(e)===t.getAncestorPageId(i);(!i||!o)&&ad({editor:t,arrow:e,terminal:r,unbind:!0})}KO(t,e.id)}function ad({editor:t,arrow:e,terminal:n,unbind:r=!1,useHandle:s=!1}){const i=Rr(t,e);if(!i)throw new Error("expected arrow info");const o=s?i.start.handle:i.start.point,a=s?i.end.handle:i.end.point,c=n==="start"?o:a,l={id:e.id,type:"arrow",props:{[n]:{x:c.x,y:c.y},bend:e.props.bend}};if(!i.isStraight){const d=n==="start"?o:i.start.handle,u=n==="end"?a:i.end.handle,p=w.Med(d,u),f=w.Sub(d,u).per().uni().mul(i.handleArc.radius*2*Math.sign(e.props.bend)),m=bc(i.handleArc.center,w.Add(p,f),i.handleArc.center,i.handleArc.radius);Ze(m?.length===1);const y=w.Dist(p,m[0])*Math.sign(e.props.bend);$s(y,l.props.bend)||(l.props.bend=y)}t.updateShape(l),r&&Nl(t,e,n)}const VO=[m7],qt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},At={s:2,m:3.5,l:5,xl:10},vo={s:18,m:24,l:36,xl:44},cs={s:18,m:22,l:26,xl:32},y7={s:18,m:20,l:24,xl:28},Lr={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},S7=20,v7=4.25,Jn=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function x7(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,i,o,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(d){l=!0,s=d}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function gI(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.push.apply(n,r)}return n}function Dn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gI(Object(n),!0).forEach((function(r){b7(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gI(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}function b7(t,e,n){return e=M7(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w7(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function C7(t,e){if(t==null)return{};var n=w7(t,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function mI(t,e){return I7(t)||x7(t,e)||WO(t,e)||k7()}function pl(t){return _7(t)||P7(t)||WO(t)||E7()}function _7(t){if(Array.isArray(t))return $x(t)}function I7(t){if(Array.isArray(t))return t}function P7(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function WO(t,e){if(t){if(typeof t=="string")return $x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $x(t,e)}}function $x(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function E7(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T7(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function M7(t){var e=T7(t,"string");return typeof e=="symbol"?e:String(e)}function La(t){var e=t.sizes.shift(),n=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),s=[n-1,r-1,1,1],i=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;o?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(n,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=n,c.height=r);var l=a.getContext("2d"),d=c.getContext("2d");d&&(d.fillRect.apply(d,s),l.drawImage(c,n-1,r-1,1,1,0,0,1,1));var u=l&&l.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-i;return[a,c].forEach((function(f){f.height=0,f.width=0})),o?(postMessage({width:n,height:r,benchmark:p,isTestPass:u}),!u&&t.sizes.length&&La(t)):u?t.onSuccess(n,r,p):(t.onError(n,r,p),t.sizes.length&&La(t)),u}var Mf={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},A7=["onError","onSuccess"],ao={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},da={};function Af(t){var e=t.width===t.height,n=t.height===1,r=t.width===1,s=[];if(!t.width||!t.height)t.sizes.forEach((function(d){var u=e||n?d:1,p=e||r?d:1;s.push([u,p])}));else for(var i=t.min||ao.min,o=t.step||ao.step,a=Math.max(t.width,t.height);a>=i;){var c=e||n?a:1,l=e||r?a:1;s.push([c,l]),a-=o}return s}function fl(t){var e=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),s=t.onError,i=t.onSuccess,o=C7(t,A7),a=null;if(!e)return!1;if(t.useWorker&&n){var c=`
            var canvasTest = `.concat(La.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(l);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(u){var p=u.data,f=p.width,m=p.height,y=p.benchmark,S=p.isTestPass;S?(da[r].onSuccess(f,m,y),delete da[r]):da[r].onError(f,m,y)}}if(t.usePromise)return new Promise((function(u,p){var f=Dn(Dn({},t),{},{onError:function(g,v,x){var b;if(t.sizes.length===0)b=!0;else{var E=t.sizes.slice(-1),I=mI(E,1),C=mI(I[0],2),P=C[0],k=C[1];b=g===P&&v===k}s(g,v,x),b&&p({width:g,height:v,benchmark:x})},onSuccess:function(g,v,x){i(g,v,x),u({width:g,height:v,benchmark:x})}});if(a){var m=f.onError,y=f.onSuccess;da[r]={onError:m,onSuccess:y},a.postMessage(o)}else La(f)}));if(a)da[r]={onError:s,onSuccess:i},a.postMessage(o);else return La(t)}var jf={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Af({width:e.max,height:e.max,min:e.min,step:e.step,sizes:pl(Mf.area)}),r=Dn(Dn(Dn({},ao),e),{},{sizes:n});return fl(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Af({width:1,height:e.max,min:e.min,step:e.step,sizes:pl(Mf.height)}),r=Dn(Dn(Dn({},ao),e),{},{sizes:n});return fl(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Af({width:e.max,height:1,min:e.min,step:e.step,sizes:pl(Mf.width)}),r=Dn(Dn(Dn({},ao),e),{},{sizes:n});return fl(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Dn(Dn({},ao),e);return n.sizes=pl(n.sizes),n.width&&n.height&&(n.sizes=[[n.width,n.height]]),fl(n)}};let Rf=null;function j7(){return Rf||(Rf=R7()),Rf}async function R7(){const t=await jf.maxWidth({usePromise:!0}),e=await jf.maxHeight({usePromise:!0}),n=await jf.maxArea({usePromise:!0});return{maxWidth:t.width,maxHeight:e.height,maxArea:n.width*n.height}}const yI=8192,O7=4096*4096;async function D7(t,e){if(t<=yI&&e<=yI&&t*e<=O7)return[t,e];const{maxWidth:n,maxHeight:r,maxArea:s}=await j7(),i=t/e;if(t>n&&(t=n,e=t/i),e>r&&(e=r,t=e*i),t*e>s){const o=Math.sqrt(s/(t*e));t*=o,e*=o}return[t,e]}function L7(t,e){const n=t.w/e.w,r=t.h/e.h;return n<=1&&r<=1?t:n>r?{w:t.w/n,h:t.h/n}:{w:t.w/r,h:t.h/r}}function N7(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function F7(t){const e=new URL(t).host.replace("www.","");for(const n of gc)if(YO(n.hostnames,e)){const r=n.fromEmbedUrl(t);if(r)return{definition:n,url:r,embedUrl:t}}}const B7=t=>t.split("*").map(e=>N7(e)).join(".+"),YO=(t,e)=>!!t.find(n=>{const r=new RegExp(B7(n));return e.match(r)});function $7(t){const e=new URL(t).host.replace("www.","");for(const n of gc)if(YO(n.hostnames,e)){const r=n.toEmbedUrl(t);if(r)return{definition:n,embedUrl:r,url:t}}}function XO(t){return $7(t)??F7(t)}function Ls(t){try{return XO(t)}catch(e){console.error(e)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const co="  ";class Nt{static insertTextFirefox(e,n){e.setRangeText(n,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(e,n){const r=e.ownerDocument,s=r.activeElement;s!==e&&e.focus(),r.execCommand("insertText",!1,n)||Nt.insertTextFirefox(e,n),s===r.body?e.blur():s instanceof HTMLElement&&s!==e&&s.focus()}static set(e,n){e.select(),Nt.insert(e,n)}static getSelection(e){const{selectionStart:n,selectionEnd:r}=e;return e.value.slice(n||void 0,r||void 0)}static wrapSelection(e,n,r){const{selectionStart:s,selectionEnd:i}=e,o=Nt.getSelection(e);Nt.insert(e,n+o+(r??n)),e.selectionStart=(s||0)+n.length,e.selectionEnd=(i||0)+n.length}static replace(e,n,r){let s=0;e.value.replace(n,(...i)=>{const o=s+i[i.length-2],a=i[0].length;e.selectionStart=o,e.selectionEnd=o+a;const c=typeof r=="string"?r:r(...i);return Nt.insert(e,c),e.selectionStart=o,s+=c.length-a,c})}static findLineEnd(e,n){const r=e.lastIndexOf(`
`,n-1)+1;return e.charAt(r)!=="	"?n:r+1}static indent(e){const{selectionStart:n,selectionEnd:r,value:s}=e,i=s.slice(n,r),o=/\n/g.exec(i)?.length;if(o&&o>0){const a=s.lastIndexOf(`
`,n-1)+1,c=e.value.slice(a,r-1),l=c.replace(/^|\n/g,`$&${co}`),d=l.length-c.length;e.setSelectionRange(a,r-1),Nt.insert(e,l),e.setSelectionRange(n+1,r+d)}else Nt.insert(e,co)}static unindent(e){const{selectionStart:n,selectionEnd:r,value:s}=e,i=s.lastIndexOf(`
`,n-1)+1,o=Nt.findLineEnd(s,r),a=e.value.slice(i,o),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;e.setSelectionRange(i,o),Nt.insert(e,c);const d=/\t| {1,2}/.exec(s.slice(i,n)),u=d?d[0].length:0,p=n-u;e.setSelectionRange(n-u,Math.max(p,r-l))}static indentCE(e){const n=window.getSelection(),r=e.innerText,s=gl(e)??0,i=gl(e)??0,o=r.slice(s,i),a=/\n/g.exec(o)?.length;if(a&&a>0){const c=r.lastIndexOf(`
`,s-1)+1,l=r.slice(c,i-1),u=l.replace(/^|\n/g,`$&${co}`).length-l.length;n&&n.setBaseAndExtent(e,s+1,e,i+u)}else{const c=window.getSelection();e.innerText=r.slice(0,s)+co+r.slice(s),c?.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){const n=window.getSelection(),r=e.innerText,s=gl(e)??0,i=gl(e)??0,o=r.lastIndexOf(`
`,s-1)+1,a=Nt.findLineEnd(r,i),c=r.slice(o,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=c.length-l.length;if(n){n.setBaseAndExtent(e,o,e,a);const u=/\t| {1,2}/.exec(r.slice(o,s)),p=u?u[0].length:0,f=s-p;n.setBaseAndExtent(e,s-p,e,Math.max(f,i-d))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(Nt.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Nt.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}}function gl(t){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let n=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(t),s.setEnd(r.endContainer,r.endOffset),n=s.toString().length}return n}const z7=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function ZO(t){return z7.test(t)}function U7(t){return t.replace(/\t/g,co)}function q7(t){const e=t.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let n=1/0;for(const r of e)if(r.trim().length>0){const s=r.length-r.trimStart().length;n=Math.min(n,s)}return e.map(r=>r.slice(n)).join(`
`)}function H7(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function G7(t){return H7(q7(U7(t)))}function K7(t,{maxImageDimension:e,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:s},{toasts:i,msg:o}){t.registerExternalAssetHandler("file",async({file:a})=>{const c=a.name;let l=a;const d=r.includes(l.type),u=s.includes(l.type);!d&&!u&&i.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),Ze(d||u,`File type not allowed: ${l.type}`),l.size>n&&i.addToast({title:o("assets.files.size-too-big"),severity:"error"}),Ze(l.size<=n,`File size too big: ${(l.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),l.type==="video/quicktime"&&(l=new File([l],l.name,{type:"video/mp4"}));let p=d?await Ar.getImageSize(l):await Ar.getVideoSize(l);const f=await Ar.isAnimated(l)||u,m=lz(await l.arrayBuffer());if(isFinite(e)){const g=L7(p,{w:e,h:e});p!==g&&Ar.isStaticImageType(l.type)&&(p=g)}const S={id:fi.createId(m),type:d?"image":"video",typeName:"asset",props:{name:c,src:"",w:p.w,h:p.h,fileSize:l.size,mimeType:l.type,isAnimated:f}};return S.props.src=await t.uploadAsset(S,l),fi.create(S)}),t.registerExternalAssetHandler("url",async({url:a})=>{let c;try{const d=await(await Nr(a,{method:"GET",mode:"no-cors"})).text(),u=new DOMParser().parseFromString(d,"text/html");c={image:u.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:u.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??u.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:u.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??a,description:u.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""},c.image.startsWith("http")||(c.image=new URL(c.image,a).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,a).href)}catch(l){console.error(l),i.addToast({title:o("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:fi.createId(xx(a)),typeName:"asset",type:"bookmark",props:{src:a,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),t.registerExternalContentHandler("svg-text",async({point:a,text:c})=>{const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!d)throw new Error("No <svg/> element present");let u=parseFloat(d.getAttribute("width")||"0"),p=parseFloat(d.getAttribute("height")||"0");if(!(u&&p)){document.body.appendChild(d);const m=d.getBoundingClientRect();document.body.removeChild(d),u=m.width,p=m.height}const f=await t.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");SI(t,[f],l)}),t.registerExternalContentHandler("embed",({point:a,url:c,embed:l})=>{const d=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),{width:u,height:p}=l,f=He(),m={id:f,type:"embed",x:d.x-(u||450)/2,y:d.y-(p||450)/2,props:{w:u,h:p,url:c}};t.createShapes([m]).select(f)}),t.registerExternalContentHandler("files",async({point:a,files:c})=>{const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=new w(l.x,l.y),u=[];await Promise.all(c.map(async(p,f)=>{if(p.size>n)return i.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(p.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!p.type)throw new Error("No mime type");if(!r.concat(s).includes(p.type))return i.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${p.name} not loaded - Extension not allowed.`),null;try{const m=await t.getAssetForExternalContent({type:"file",file:p});if(!m)throw Error("Could not create an asset");u[f]=m}catch(m){return i.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(m),null}})),SI(t,Te(u),d)}),t.registerExternalContentHandler("text",async({point:a,text:c})=>{const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=t.getShapeUtil("text").getDefaultProps(),u=G7(c),p=t.getOnlySelectedShape();if(p&&"text"in p.props){t.updateShapes([{id:p.id,type:p.type,props:{text:u}}]);return}let f,m,y,S="middle";const g=u.split(`
`).length>1,v=ZO(u);g&&(S=g?v?"end":"start":"middle");const x=t.textMeasure.measureText(u,{...qt,fontFamily:Lr[d.font],fontSize:vo[d.size],maxWidth:null}),b=Math.min(g?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(x.w>b){const E=t.textMeasure.measureText(u,{...qt,fontFamily:Lr[d.font],fontSize:vo[d.size],maxWidth:b});f=E.w,m=E.h,y=!1,S=v?"end":"start"}else f=x.w,m=x.h,y=!0;l.y-m/2<t.getViewportPageBounds().minY+40&&(l.y=t.getViewportPageBounds().minY+40+m/2),t.createShapes([{id:He(),type:"text",x:l.x-f/2,y:l.y-m/2,props:{text:u,textAlign:S,autoSize:y,w:f}}])}),t.registerExternalContentHandler("url",async({point:a,url:c})=>{const l=Ls(c);if(l)return t.putExternalContent({type:"embed",url:l.url,point:a,embed:l.definition});const d=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),u=fi.createId(xx(c)),p=V7(t,c,d);let f=t.getAsset(u),m=!1;if(!f){m=!0;try{const y=await t.getAssetForExternalContent({type:"url",url:c});if(!y)throw Error("Could not create an asset");f=y}catch{i.addToast({title:o("assets.url.failed"),severity:"error"});return}}t.run(()=>{m&&t.createAssets([f]),t.updateShapes([{id:p.id,type:p.type,props:{assetId:f.id}}])})})}async function SI(t,e,n){if(!e.length)return[];const r=w.From(n),s=[];for(let i=0;i<e.length;i++){const o=e[i];switch(o.type){case"bookmark":{s.push({id:He(),type:"bookmark",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{s.push({id:He(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":s.push({id:He(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}}return t.run(()=>{const i=e.filter(o=>!t.getAsset(o.id));i.length&&t.createAssets(i),t.createShapes(s).select(...s.map(o=>o.id)),QO(t,n)}),s.map(i=>i.id)}function QO(t,e){const n=t.getViewportPageBounds();let r=t.getSelectionPageBounds();if(r){const s=r.center.sub(e);t.updateShapes(t.getSelectedShapes().map(i=>{const o=t.getShapeParentTransform(i).decompose().rotation,a=w.Rot(s,-o);return{id:i.id,type:i.type,x:i.x-a.x,y:i.y-a.y}}))}r=t.getSelectionPageBounds(),r&&!n.contains(r)&&t.zoomToSelection()}function V7(t,e,n){const r={id:He(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:e}};return t.run(()=>{t.createShapes([r]).select(r.id),QO(t,n)}),t.getShape(r.id)}let W7=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}}},Y7=class extends Se{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:n=>!n.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:n,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){const{originPagePoint:e}=this.editor.inputs,n=He();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShape({id:n,type:"arrow",x:e.x,y:e.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(n);if(!r)throw Error("expected shape");const s=this.editor.getShapeHandles(r);if(!s)throw Error("expected handles for arrow");const i=this.editor.getShapeUtil("arrow"),o=this.shape,a=s.find(l=>l.id==="start"),c=i.onHandleDrag?.(r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:o});c&&this.editor.updateShapes([c]),this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const n=this.editor.getShapeHandles(e);if(!n)throw Error("expected handles for arrow");{const r=this.editor.getShapeUtil("arrow"),s=this.shape,i=n.find(a=>a.id==="start"),o=r.onHandleDrag?.(e,{handle:{...i,x:0,y:0},isPrecise:this.didTimeout,initial:s});o&&this.editor.updateShapes([o])}{const r=this.editor.getShapeUtil("arrow"),s=this.shape,i=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),o=n.find(c=>c.id==="end"),a=r.onHandleDrag?.(this.editor.getShape(e),{handle:{...o,x:i.x,y:i.y},isPrecise:!1,initial:s});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}};class X7 extends Se{static id="arrow";static initial="idle";static children=()=>[W7,Y7];shapeType="arrow"}class JO extends Se{static id="drawing";info={};initialShape;shapeType=this.parent.id==="highlight"?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{const{inputs:e}=this.editor;if(this.isPen&&!e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?w.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())};onKeyDown=e=>{if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()};onKeyUp=e=>{if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()};onExit=()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return this.shapeType!=="highlight"}getIsClosed(e,n,r){if(!this.canClose())return!1;const s=At[n],i=e[0].points[0],o=e[e.length-1],a=o.points[o.points.length-1];return i!==a&&this.currentLineLength>s*4*r&&w.DistMin(i,a,s*2*r)}startShape(){const{inputs:{originPagePoint:e,isPen:n}}=this.editor;this.markId="draw start "+lt(),this.editor.mark(this.markId);const{z:r=.5}=this.info.point;this.isPen=n,this.isPenOrStylus=n||r>0&&r<.5||r>.5&&r<1;const s=this.isPenOrStylus?r*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const o=this.editor.getShape(this.initialShape.id);if(o&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=Bt(o.props.segments);if(!a)throw Error("Expected a previous segment!");const c=Bt(a.points);if(!c)throw Error("Expected a previous point!");const{x:l,y:d}=this.editor.getPointInShapeSpace(o,e).toFixed(),u={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+s.toFixed(2)},{x:l,y:d,z:+s.toFixed(2)}]},p=se.applyToPoint(this.editor.getShapePageTransform(o.id),c);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const f=[...o.props.segments,u];this.currentLineLength<At[o.props.size]*4&&(this.currentLineLength=this.getLineLength(f));const m={id:o.id,type:this.shapeType,props:{segments:f}};this.canClose()&&(m.props.isClosed=this.getIsClosed(f,o.props.size,o.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const i=He();this.editor.createShapes([{id:i,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){const{initialShape:e}=this,{inputs:n}=this.editor;if(!e)return;const{id:r,props:{size:s,scale:i}}=e,o=this.editor.getShape(r);if(!o)return;const{segments:a}=o.props,{x:c,y:l,z:d}=this.editor.getPointInShapeSpace(o,n.currentPagePoint).toFixed(),u=this.isPenOrStylus?+(n.currentPagePoint.z*1.25).toFixed(2):.5,p={x:c,y:l,z:u};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(w.Dist2(f,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const y=Bt(a);if(!y)throw Error("Expected a previous segment!");const S=Bt(y.points);if(!S)throw Error("Expected a previous last point!");let g;const v=this.editor.getPointInShapeSpace(o,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(y.type==="straight"){this.currentLineLength+=w.Dist(S,v),g={type:"straight",points:[{...S},v]};const b=this.editor.getShapePageTransform(o);this.pagePointWhereCurrentSegmentChanged=se.applyToPoint(b,S)}else g={type:"straight",points:[v,p]};const x={id:r,type:this.shapeType,props:{segments:[...a,g]}};this.canClose()&&(x.props.isClosed=this.getIsClosed(a,s,i)),this.editor.updateShapes([x])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(w.Dist2(f,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const y=a.slice(),S=y[y.length-1],g=Bt(S.points);if(!g)throw Error("No previous point!");const v={type:"free",points:[...w.PointsBetween(g,p,6).map(E=>({x:ns(E.x),y:ns(E.y),z:ns(E.z)}))]},x=[...y,v];this.currentLineLength<At[o.props.size]*4&&(this.currentLineLength=this.getLineLength(x));const b={id:r,type:this.shapeType,props:{segments:x}};this.canClose()&&(b.props.isClosed=this.getIsClosed(x,s,i)),this.editor.updateShapes([b])}break}case"straight":{const f=a.slice(),m=f[f.length-1],{pagePointWhereCurrentSegmentChanged:y}=this,{ctrlKey:S,currentPagePoint:g}=this.editor.inputs;if(!y)throw Error("We should have a point where the segment changed");let v,x=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(x=!S,this.didJustShiftClickToExtendPreviousShapeLine=!1):x=!S;let b=this.editor.getPointInShapeSpace(o,g).toFixed().toJson(),E=!1,I;if((this.editor.user.getIsSnapMode()?!S:S)&&f.length>2){let k,T=8/this.editor.getZoomLevel();for(let M=0,A=a.length-2;M<A;M++){const j=a[M];if(!j)break;if(j.type==="free")continue;const R=j.points[0],L=Bt(j.points);if(!(R&&L))continue;const F=w.NearestPointOnLineSegment(R,L,b);if(w.DistMin(F,b,T)){k=F.toFixed().toJson(),T=w.Dist(F,b),I=j;break}}k&&(E=!0,b=k)}if(E&&I){const k=this.editor.getShapePageTransform(o),T=I.points[0],M=Bt(I.points);if(!M)throw Error("Expected a last point!");const A=se.applyToPoint(k,T),j=se.applyToPoint(k,M),R=se.applyToPoint(k,b);this.editor.snaps.setIndicators([{id:lt(),type:"points",points:[A,R,j]}])}else{if(this.editor.snaps.clearIndicators(),x){const k=w.Angle(y,g),M=td(k,24)-k;v=w.RotWith(g,y,M)}else v=g;b=this.editor.getPointInShapeSpace(o,v).toFixed().toJson()}this.currentLineLength+=w.Dist(m.points[0],b),f[f.length-1]={...m,type:"straight",points:[m.points[0],b]};const P={id:r,type:this.shapeType,props:{segments:f}};this.canClose()&&(P.props.isClosed=this.getIsClosed(a,s,i)),this.editor.updateShapes([P]);break}case"free":{const f=a.slice(),m=f[f.length-1],y=[...m.points];if(y.length&&this.mergeNextPoint){const{z:g}=y[y.length-1];y[y.length-1]={x:p.x,y:p.y,z:g?Math.max(g,p.z):p.z}}else this.currentLineLength+=w.Dist(y[y.length-1],p),y.push(p);f[f.length-1]={...m,points:y},this.currentLineLength<At[o.props.size]*4&&(this.currentLineLength=this.getLineLength(f));const S={id:r,type:this.shapeType,props:{segments:f}};if(this.canClose()&&(S.props.isClosed=this.getIsClosed(f,s,i)),this.editor.updateShapes([S]),y.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:r,type:this.shapeType,props:{isComplete:!0}}]);const g=He(),v=this.editor.getShape(r).props;this.editor.createShapes([{id:g,type:this.shapeType,x:ns(n.currentPagePoint.x),y:ns(n.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:v.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=Ye(this.editor.getShape(g)),this.mergeNextPoint=!1,this.lastRecordedPoint=n.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let n=0;for(const r of e)for(let s=0;s<r.points.length-1;s++){const i=r.points[s],o=r.points[s+1];n+=w.Dist2(o,i)}return Math.sqrt(n)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}let eD=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};class Z7 extends Se{static id="draw";static initial="idle";static isLockable=!1;static children=()=>[eD,JO];shapeType="draw";onExit=()=>{const e=this.children.drawing;e.initialShape=void 0}}class Q7 extends H9{static id="frame";static initial="idle";shapeType="frame";onCreate=e=>{if(!e)return;const n=this.editor.getShapePageBounds(e),r=[],s=this.editor.getShapeAncestors(e).map(i=>i.id);this.editor.getSortedChildIdsForParent(e.parentId).map(i=>{const o=this.editor.getShape(i);if(!o||o.id===e.id||o.isLocked)return;const a=this.editor.getShapePageBounds(o);a&&n.contains(a)&&J7(o,s,e)&&r.push(o.id)}),this.editor.reparentShapes(r,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}function J7(t,e,n){return e.includes(t.id)?!1:t.parentId===n.parentId}let eH=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}};onCancel=()=>{this.editor.setCurrentTool("select")}},tH=class extends Se{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=He();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:n.x,y:n.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(mr),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){const{originPagePoint:e}=this.editor.inputs,n=He();this.markId=`creating:${n}`,this.editor.mark(this.markId);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,s=this.editor.getStyleForNextShape(mr),i=s==="star"?{w:200,h:190}:s==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:n,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(mr),scale:r,...i}}]);const o=this.editor.getShape(n);if(!o)return;const{w:a,h:c}=o.props,l=new w(a/2,c/2).mul(r),d=this.editor.getShapeParentTransform(o);d&&l.rot(-d.rotation()),this.editor.select(n),this.editor.updateShape({id:o.id,type:"geo",x:o.x-l.x,y:o.y-l.y,props:{geo:this.editor.getStyleForNextShape(mr),w:a*r,h:c*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};class nH extends Se{static id="geo";static initial="idle";static children=()=>[eH,tH];shapeType="geo"}class rH extends Se{static id="highlight";static initial="idle";static children=()=>[eD,JO];static isLockable=!1;shapeType="highlight";onExit=()=>{const e=this.children.drawing;e.initialShape=void 0}}let sH=class extends Se{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}};const vI=2;let iH=class extends Se{static id="pointing";shape={};markId;onEnter=e=>{const{inputs:n}=this.editor,{currentPagePoint:r}=n;this.markId=void 0;const s=e.shapeId&&this.editor.getShape(e.shapeId);if(s&&n.shiftKey){this.markId=`creating:${s.id}`,this.editor.mark(this.markId),this.shape=s;const i=this.editor.getShapeHandles(this.shape);if(!i)return;const o=i.filter(p=>p.type==="vertex").sort(en),a=o[o.length-1],c=o[o.length-2],l=se.applyToPoint(this.editor.getShapeParentTransform(this.shape),new w(this.shape.x,this.shape.y)),d=w.Sub(r,l).addXY(.1,.1),u=Ye(this.shape.props.points);if(w.DistMin(a,c,vI)||w.DistMin(d,a,vI))u[a.id]={id:a.id,index:a.index,x:d.x,y:d.y};else{const p=fr(a.index);u[p]={id:p,index:p,x:d.x,y:d.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:u}}])}else{const i=He();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:"line",x:r.x,y:r.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(i),this.shape=this.editor.getShape(i)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const n=Bt(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...n,x:n.x-.1,y:n.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};class oH extends Se{static id="line";static initial="idle";static children=()=>[sH,iH];shapeType="line"}let aH=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};function Ve(t,e){const n=new Set;for(const s of e){const i=t.getShape(s);if(!i)continue;t.getShapeUtil(i).onDragShapesOut&&n.add(i);const o=t.getShape(i.parentId);o&&t.getShapeUtil(o).onDragShapesOut&&n.add(o)}const r=new Map;for(const s of n){const i=tD(t,s);i.length&&r.set(s,i)}for(const[s,i]of r){const o=t.getShapeUtil(s),a=Te(i.map(c=>t.getShape(c)));o.onDragShapesOut?.(s,a)}}function tD(t,e){const n=t.getSortedChildIdsForParent(e.id);if(n.length===0)return[];const r=t.getShapePageBounds(e);if(!r)return[];let s,i,o;const a=[];for(const c of n){const l=t.getShapePageBounds(c);if(!l)continue;if(!r.includes(l)){a.push(c);continue}s??=t.getShapeGeometry(e),i??=t.getShapePageTransform(e),o??=i.applyToPoints(s.vertices);const d=t.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:u,isClosed:p}=t.getShapeGeometry(c);if(!u.some(f=>Bn(f,d))){if(p){if(CO(d,u))continue}else if(Gq(d,u))continue;a.push(c)}}return a}function cd(t,e,n=!1){t.select(e),t.setEditingShape(e),t.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),n&&t.emit("select-all-text",{shapeId:e.id}),nD(t)}const cH=16;function nD(t){const e=t.getSelectionPageBounds(),n=t.getViewportPageBounds();if(e&&!n.contains(e)){const r=e.clone().expandBy(cH/t.getZoomLevel()).expand(n),s=n.clone().translate({x:(r.center.x-n.center.x)*2,y:(r.center.y-n.center.y)*2});t.zoomToBounds(s,{animation:{duration:t.options.animationMediumMs},inset:0})}}const lH=0,Ge=200,Hd=new w(Ge/2,Ge/2),rD=10,dH=t=>[[["a1"],new w(Ge*.5,Ge*-.5-t.options.adjacentShapeMargin)],[["a2"],new w(Ge*1.5+t.options.adjacentShapeMargin,Ge*.5)],[["a3"],new w(Ge*.5,Ge*1.5+t.options.adjacentShapeMargin)],[["a4"],new w(Ge*-.5-t.options.adjacentShapeMargin,Ge*.5)]];function uH(t,e){if(e===1)return dH(t);const n=Ge*e,r=t.options.adjacentShapeMargin*e;return[[["a1"],new w(n*.5,n*-.5-r)],[["a2"],new w(n*1.5+r,n*.5)],[["a3"],new w(n*.5,n*1.5+r)],[["a4"],new w(n*-.5-r,n*.5)]]}function sD(t,e,n,r,s,i){return Object.fromEntries(uH(t,i).map(([o,a],c)=>{const l=a.clone();return c===0&&s?l.y-=s:c===2&&r&&(l.y+=r),[o,l.rot(n).add(e)]}))}function iD(t,e,n,r){const s=new Set(t.getSelectedShapeIds()),i=(Ge+t.options.adjacentShapeMargin+r)**2,o=new Map,a=[];for(const d of t.getCurrentPageShapes()){if(!t.isShapeOfType(d,"note")||n!==d.props.scale||s.has(d.id))continue;const u=t.getShapePageTransform(d.id);e===u.rotation()&&(o.set(d,t.getShapePageBounds(d).center),a.push(...Object.values(sD(t,u.point(),e,d.props.growY,r,n))))}const c=a.length;let l;for(const[d,u]of o)for(let p=0;p<c;p++)l=a[p],l&&(w.Dist2(u,l)>i||t.isPointInShape(d,l)&&(a[p]=void 0));return Te(a)}function oD(t,e,n,r,s=!1){let i;const o=t.getCurrentPageShapesSorted(),a=(Ge+t.options.adjacentShapeMargin**2)**e.props.scale;for(let c=o.length-1;c>=0;c--){const l=o[c];if(l.type==="note"&&l.id!==e.id){const d=t.getShapePageBounds(l);if(d&&w.Dist2(d.center,n)<a&&t.isPointInShape(l,n)){i=l;break}}}if(t.complete(),!i||s){t.mark("creating note shape");const c=He();t.createShape({id:c,type:"note",x:n.x,y:n.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const l=t.getShape(c);if(!l)return;const d=t.getPointInParentSpace(l,w.Sub(n,w.Rot(Hd.clone().mul(l.props.scale),r)));t.updateShape({id:c,type:"note",x:d.x,y:d.y}),i=t.getShape(c)}return nD(t),i}let hH=class extends Se{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{const{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){const n=He();this.markId=`creating:${n}`,e.mark(this.markId);const r=this.editor.inputs.originPagePoint.clone(),s=xI(this.editor,r,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&r.sub(s),this.shape=bI(this.editor,n,r)}};onPointerMove=e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const n=He(),r=this.editor.inputs.originPagePoint.clone(),s=xI(this.editor,r,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&r.sub(s),this.shape=bI(this.editor,n,r)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};function xI(t,e,n){let r=rD/t.getZoomLevel(),s;for(const i of iD(t,0,n,0)){const o=w.Sub(e,i),a=o.len();a<r&&(r=a,s=o)}return s}function bI(t,e,n){t.createShape({id:e,type:"note",x:n.x,y:n.y,props:{scale:t.user.getIsDynamicResizeMode()?1/t.getZoomLevel():1}}).select(e);const r=t.getShape(e),s=t.getShapeGeometry(r).bounds;return t.updateShapes([{id:e,type:"note",x:r.x-s.width/2,y:r.y-s.height/2}]),t.getShape(e)}class pH extends Se{static id="note";static initial="idle";static children=()=>[aH,hH];shapeType="note"}function fH(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),renderingOnly:!0});if(!e)return t.setHoveredShape(null);let n;const r=t.getOutermostSelectableShape(e);return r===e||r.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(r.id)?n=e:n=r,t.setHoveredShape(n.id)}const ss=vj(fH,32);let gH=class extends Se{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":ss(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onExit=()=>{ss.cancel()};onKeyDown=e=>{if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}};onCancel=()=>{this.editor.setCurrentTool("select")}},mH=class extends Se{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:n}}=this.editor,r=He();this.markId=`creating:${r}`,this.editor.mark(this.markId);const s=this.createTextShape(r,n,!1);if(!s){this.cancel();return}this.shape=this.editor.getShape(s),this.editor.select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(s.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");const e=He(),{currentPagePoint:n}=this.editor.inputs;this.createTextShape(e,n,!0)&&(this.editor.select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.getCurrent()?.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,n,r){this.editor.createShape({id:e,type:"text",x:n.x,y:n.y,props:{text:"",autoSize:r,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(e);if(!s){this.cancel();return}const i=this.editor.getShapePageBounds(s),o=new w;if(r)switch(s.props.textAlign){case"start":{o.x=0;break}case"middle":{o.x=-i.width/2;break}case"end":{o.x=-i.width;break}}else o.x=0;if(o.y=-i.height/2,vn(s.parentId)){const a=this.editor.getShapeParentTransform(s);o.rot(-a.rotation())}return this.editor.updateShape({...s,x:s.x+o.x,y:s.y+o.y}),s}};class yH extends Se{static id="text";static initial="idle";static children=()=>[gH,mH];static isLockable=!1;shapeType="text"}const SH=[yH,Z7,nH,pH,oH,Q7,X7,rH];function or(){return ms({isDarkMode:Cc()})}function Gd(t){return{key:`${Fr.id}:${t}`,getElement:async()=>{const e=vH(t);if(!e)return null;const n=e.$$_url,r=e.$$_fontface;if(!n||!r)return null;const s=await(await Nr(n)).blob(),i=await yi.blobToDataUrl(s),o=r.replace(n,i);return h.jsx("style",{children:o})}}}function vH(t){const e=Qj[t];for(const n of document.fonts)if(e.includes(n.family))return n;return null}function hw(t){return{key:`${Fr.id}:${t}`,getElement:async()=>t!=="pattern"?null:h.jsx(xH,{})}}function xH(){const t=or(),e=8/12;return h.jsxs(h.Fragment,{children:[h.jsxs("mask",{id:"hash_pattern_mask",children:[h.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),h.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[h.jsx("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),h.jsx("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),h.jsx("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),h.jsx("pattern",{id:ld(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:h.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:"url(#hash_pattern_mask)"})})]})}function pw(){return{key:`${Fr.id}:pattern`,component:_H}}const Ca=8,wI=(t,e,n)=>new Promise((r,s)=>{const i=Ca*e*t,o=document.createElement("canvas");o.width=i,o.height=i;const a=o.getContext("2d");if(!a)return;a.fillStyle=n?Wl.darkMode.solid:Wl.lightMode.solid,a.fillRect(0,0,i,i),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*t;const c=8/12,l=d=>d*e*t;a.beginPath(),a.moveTo(l(c*1),l(c*3)),a.lineTo(l(c*3),l(c*1)),a.moveTo(l(c*5),l(c*7)),a.lineTo(l(c*7),l(c*5)),a.moveTo(l(c*9),l(c*11)),a.lineTo(l(c*11),l(c*9)),a.stroke(),o.toBlob(d=>{!d||yt.throwToBlob.get()?s():r(d)})}),CI=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const r=n.getContext("2d");return r?(e(r),n.toDataURL()):""};let Of=null;function bH(){return Of||(Of={white:CI([1,1],t=>{t.fillStyle="#f8f9fa",t.fillRect(0,0,1,1)}),black:CI([1,1],t=>{t.fillStyle="#212529",t.fillRect(0,0,1,1)})}),Of}function aD(t){return Math.ceil(Math.log2(Math.max(1,t)))}function ld(t,e){const n=aD(t);return`tldraw_hash_pattern_${e}_${n}`}function cD(t){const e=[],r=aD(t);for(let s=0;s<=r;s++)e.push(Math.pow(2,s));return e}function wH(t){const e=bH();return cD(t).flatMap(n=>[{zoom:n,url:e.white,theme:"light"},{zoom:n,url:e.black,theme:"dark"}])}function CH(){const t=K(),e=X("devicePixelRatio",()=>t.getInstanceState().devicePixelRatio,[t]),n=X("maxZoom",()=>Math.ceil(Bt(t.getCameraOptions().zoomSteps)),[t]),[r,s]=_.useState(!1),[i,o]=_.useState(()=>wH(n));return _.useEffect(()=>{const c=Promise.all(cD(n).flatMap(d=>[wI(e,d,!1).then(u=>({zoom:d,theme:"light",url:URL.createObjectURL(u)})),wI(e,d,!0).then(u=>({zoom:d,theme:"dark",url:URL.createObjectURL(u)}))]));let l=!1;return c.then(d=>{l||(o(d),s(!0))}),()=>{l=!0,s(!1),c.then(d=>{for(const{url:u}of d)URL.revokeObjectURL(u)})}},[e,n]),{defs:h.jsx(h.Fragment,{children:i.map(c=>{const l=ld(c.zoom,c.theme);return h.jsx("pattern",{id:l,width:Ca,height:Ca,patternUnits:"userSpaceOnUse",children:h.jsx("image",{href:c.url,width:Ca,height:Ca})},l)})}),isReady:r}}function _H(){const t=K(),e=_.useRef(null),{defs:n,isReady:r}=CH();return _.useEffect(()=>{if(r&&t.environment.isSafari){const s=lD(e.current);s&&t.timers.requestAnimationFrame(()=>{s.style.display="none",t.timers.requestAnimationFrame(()=>{s.style.display=""})})}},[t,r]),h.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function lD(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?lD(t.parentElement):null}const Zt=qe.memo(function({theme:e,d:n,color:r,fill:s,scale:i}){switch(s){case"none":return null;case"solid":return h.jsx("path",{fill:e[r].semi,d:n});case"semi":return h.jsx("path",{fill:e.solid,d:n});case"fill":return h.jsx("path",{fill:e[r].fill,d:n});case"pattern":return h.jsx(IH,{theme:e,color:r,fill:s,d:n,scale:i})}});function IH({d:t,color:e,theme:n}){const r=K(),s=kO(),i=X("zoomLevel",()=>r.getZoomLevel(),[r]),o=r.getZoomLevel()<=.18;return h.jsxs(h.Fragment,{children:[h.jsx("path",{fill:n[e].pattern,d:t}),h.jsx("path",{fill:s?`url(#${ld(1,n.id)})`:o?n[e].semi:`url(#${ld(i,n.id)})`,d:t})]})}function PH(t){return t.replace(/\s/g," ")}function zx(t,e,n){const{padding:r=0}=n;if(e.length===0)return null;const s=ce.From(e[0].box);for(const{box:l}of e)s.union(l);const i=r+(n.offsetX??0),o=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-s.height:(Math.ceil(n.height)-s.height)/2);let a=null;const c=[];for(const{text:l,box:d}of e)a!==null&&d.y>a&&c.push(h.jsx("tspan",{alignmentBaseline:"mathematical",x:i,y:d.y+o,children:`
`},c.length)),c.push(h.jsx("tspan",{alignmentBaseline:"mathematical",x:d.x+i,y:d.y+o,unicodeBidi:"plaintext",children:PH(l)},c.length)),a=d.y;return h.jsx("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:c})}function EH(t,e,n,r){if((t==="start-legacy"||t==="end-legacy")&&n.length!==0){const s=ce.From(n[0].box);for(const{box:i}of n)s.union(i);if(t==="start-legacy")return(r-2*e-s.width)/2;if(t==="end-legacy")return-(r-2*e-s.width)/2}}function kH(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function Kd({fontSize:t,font:e,align:n,verticalAlign:r,text:s,labelColor:i,bounds:o,padding:a=16,stroke:c=!0}){const l=K(),d=or(),u={fontSize:t,fontFamily:Qj[e],textAlign:n,verticalTextAlign:r,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:qt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:i,stroke:void 0,strokeWidth:void 0},p=l.textMeasure.measureTextSpans(s,u),f=EH(n,a,p,o.width);f&&(u.offsetX=f),u.offsetX+=o.x,u.offsetY+=o.y;const m=zx(l,p,u);let y=null;return c&&(u.fill=d.background,u.stroke=d.background,u.strokeWidth=2,y=zx(l,p,u)),h.jsxs(h.Fragment,{children:[y,m]})}const TH=_.forwardRef(function({isEditing:e,text:n,handleFocus:r,handleChange:s,handleKeyDown:i,handleBlur:o,handleInputPointerDown:a,handleDoubleClick:c},l){return h.jsx("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:n,onFocus:r,onChange:s,onKeyDown:i,onBlur:o,onTouchEnd:jt,onContextMenu:e?jt:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:Le})});function MH(t,e,n){const r=K(),s=_.useRef(null),i=X("isEditing",()=>r.getEditingShapeId()===t,[r]),o=X("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);_.useEffect(()=>{function d({shapeId:u}){u===t&&s.current?.select()}return r.on("select-all-text",d),()=>{r.off("select-all-text",d)}},[r,t,i]),_.useEffect(()=>{i&&(document.activeElement!==s.current&&s.current?.focus(),r.getInstanceState().isCoarsePointer&&s.current?.select(),r.environment.isSafari&&(s.current?.blur(),s.current?.focus()))},[r,i]);const a=_.useCallback(d=>{if(r.getEditingShapeId()===t)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&r.complete();break}}},[r,t]),c=_.useCallback(d=>{if(r.getEditingShapeId()!==t)return;let u=Nt.normalizeText(d.currentTarget.value);const p=u.replace(/\t/g,co);if(p!==u){const f=d.currentTarget.selectionStart;d.currentTarget.value=p,d.currentTarget.selectionStart=f+(p.length-u.length),d.currentTarget.selectionEnd=f+(p.length-u.length),u=p}r.updateShape({id:t,type:e,props:{text:u}})},[r,t,e]),l=_.useCallback(d=>{r.dispatch({..._n(d),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(t)}),jt(d)},[r,t]);return{rInput:s,handleFocus:qa,handleBlur:qa,handleKeyDown:a,handleChange:c,handleInputPointerDown:l,handleDoubleClick:jt,isEmpty:n.trim().length===0,isEditing:i,isEditingAnything:o}}const Vd=qe.memo(function({id:e,type:n,text:r,labelColor:s,font:i,fontSize:o,lineHeight:a,align:c,verticalAlign:l,wrap:d,isSelected:u,padding:p=0,onKeyDown:f,classNamePrefix:m,style:y,textWidth:S,textHeight:g}){const{rInput:v,isEmpty:x,isEditing:b,isEditingAnything:E,...I}=MH(e,n,r),[C,P]=_.useState(r);_.useEffect(()=>{b||P(r)},[b,r]);const k=Nt.normalizeTextForDom(r),T=k.length>0,M=kH(c);if(!b&&!T)return null;const A=m||"tl-text";return h.jsx("div",{className:`${A}-label tl-text-wrapper`,"data-font":i,"data-align":c,"data-hastext":!x,"data-isediting":b,"data-iseditinganything":E,"data-textwrap":!!d,"data-isselected":u,style:{justifyContent:c==="middle"||M?"center":c,alignItems:l==="middle"?"center":l,padding:p,...y},children:h.jsxs("div",{className:`${A}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*a)+"px",minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(S||0),color:s,width:S?Math.ceil(S):void 0,height:g?Math.ceil(g):void 0},children:[h.jsx("div",{className:`${A} tl-text tl-text-content`,dir:"auto",children:k.split(`
`).map((j,R)=>h.jsx("div",{dir:"auto",children:j},R))}),(E||u)&&h.jsx(TH,{ref:v,text:r,isEditing:b,...I,handleKeyDown:f??I.handleKeyDown},C)]})})});function Tr(t,e,n={}){const{closed:r=!1,snap:s=1,start:i="outset",end:o="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,d=0,u=1,p=0,f=0;switch(c){case"dashed":{u=1,l=Math.min(e*a,t/4);break}case"dotted":{u=100,l=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(i==="outset"?(t+=l/2,f+=l/2):i==="skip"&&(t-=l,f-=l),o==="outset"?t+=l/2:o==="skip"&&(t-=l)),d=Math.floor(t/l/(2*u)),d-=d%s,d<3&&c==="dashed"?t/e<4?(l=t,d=1,p=0):(l=t*(1/3),p=t*(1/3)):(l=t/d/(2*u),r?(f=l/2,p=(t-d*l)/d):p=(t-d*l)/Math.max(1,d-1)),{strokeDasharray:[l,p].join(" "),strokeDashoffset:f.toString()}}const _I=new WeakMap;function fw(t,e){const n=_I.get(e);if(n)return n;const r=Rr(t,e);let s=0,i=0;const o=r.isStraight?new rs({start:w.From(r.start.point),end:w.From(r.end.point)}):new so({center:w.Cast(r.handleArc.center),start:w.Cast(r.start.point),end:w.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(e.props.text.trim()){const c=o.bounds,l=Ux(e),{w:d,h:u}=t.textMeasure.measureText(e.props.text,{...qt,fontFamily:Lr[e.props.font],fontSize:l,maxWidth:null});if(s=d,i=u,c.width>c.height){s=Math.max(Math.min(d,64),Math.min(c.width-64,d));const{w:p,h:f}=t.textMeasure.measureText(e.props.text,{...qt,fontFamily:Lr[e.props.font],fontSize:l,maxWidth:s});s=p,i=f}if(s>16*l){s=16*l;const{w:p,h:f}=t.textMeasure.measureText(e.props.text,{...qt,fontFamily:Lr[e.props.font],fontSize:l,maxWidth:s});s=p,i=f}}const a=new w(s,i).addScalar(v7*2*e.props.scale);return _I.set(e,a),a}function dD(t){const e=At[t.props.size];return(S7+(e-At.s)*2+(e===At.xl?20:0))*t.props.scale}function AH(t,e,n){const r=fw(t,e),s=dD(e),i=w.Nudge(n.start.point,n.end.point,s),o=w.Nudge(n.end.point,n.start.point,s),a=ew(i,o,ce.FromCenter(n.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,l]=a;w.Dist2(c,i)>w.Dist2(l,i)&&([l,c]=a);const d=i.add(w.Sub(n.middle,c)),u=o.add(w.Sub(n.middle,l)),p=w.Dist(n.start.point,d)/n.length,f=w.Dist(n.start.point,u)/n.length;return{start:p,end:f}}function jH(t,e,n){const r=fw(t,e),s=dD(e),i=Math.sign(e.props.bend),o=s/n.handleArc.radius*i,a=w.Angle(n.bodyArc.center,n.start.point)-o,c=w.Angle(n.bodyArc.center,n.end.point)+o,l=_i(n.bodyArc.center,n.bodyArc.radius,a),d=_i(n.bodyArc.center,n.bodyArc.radius,c),u=[],p=II(n.bodyArc.center,n.bodyArc.radius,a,c,i,ce.FromCenter(l,r).corners);u.push(new mt({points:ce.FromCenter(l,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=II(n.bodyArc.center,n.bodyArc.radius,a,c,i,ce.FromCenter(d,r).corners);u.push(new mt({points:ce.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const C of[...p??[],...f??[],l,d])u.push(new lw({x:C.x-3,y:C.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const m=(p&&PI(n.start.point,p))??n.middle,y=(f&&PI(n.end.point,f))??n.middle,S=w.Angle(n.bodyArc.center,n.start.point),g=w.Angle(n.bodyArc.center,n.end.point),v=w.Angle(n.bodyArc.center,m),x=w.Angle(n.bodyArc.center,y);if(As(S,v,i)>As(S,x,i))return{start:.5,end:.5,dbg:u};const b=As(S,g,i),E=As(S,v,i)/b,I=As(S,x,i)/b;return{start:E,end:I,dbg:u}}function Fl(t,e){let n;const r=[],s=Rr(t,e),i=!!s.bindings.start,o=!!s.bindings.end,a=s.start.arrowhead!=="none",c=s.end.arrowhead!=="none";if(s.isStraight){const d=AH(t,e,s);let u=Et(e.props.labelPosition,a||i?d.start:0,c||o?d.end:1);u=u>=.48&&u<=.52?.5:u,n=w.Lrp(s.start.point,s.end.point,u)}else{const d=jH(t,e,s);d.dbg&&r.push(...d.dbg);let u=Et(e.props.labelPosition,a||i?d.start:0,c||o?d.end:1);u=u>=.48&&u<=.52?.5:u;const p=RH(w.Angle(s.bodyArc.center,s.start.point),w.Angle(s.bodyArc.center,s.end.point),Math.sign(e.props.bend),u);n=_i(s.bodyArc.center,s.bodyArc.radius,p)}const l=fw(t,e);return{box:ce.FromCenter(n,l),debugGeom:r}}function II(t,e,n,r,s,i){const o=Ox(t,e,i),a=As(n,r,s);return o?.filter(c=>{const l=As(n,w.Angle(t,c),s);return l>=0&&l<=a})}function PI(t,e){let n=null,r=-1/0;for(const s of e){const i=w.Dist2(t,s);i>r&&(n=s,r=i)}return n}function RH(t,e,n,r){const s=As(t,e,n);return t+s*r*n*-1}function Ux(t){return y7[t.props.size]*t.props.scale}function OH(t,e,n){const r=e==="end"?t.end.point:t.start.point,s=e==="end"?t.start.point:t.end.point,i=t.isStraight?w.Dist(s,r):Math.abs(t.bodyArc.length),o=Math.max(Math.min(i/5,n*3),n);let a;if(t.isStraight)a=w.Nudge(r,s,o);else{const c=qq(r,o,t.handleArc.center,t.handleArc.radius);a=e==="end"?t.handleArc.sweepFlag?c[0]:c[1]:t.handleArc.sweepFlag?c[1]:c[0]}return w.IsNaN(a)&&(a=t.start.point),{point:r,int:a}}function DH({point:t,int:e}){const n=w.RotWith(e,t,$e/6),r=w.RotWith(e,t,-$e/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y}`}function LH({point:t,int:e}){const n=w.RotWith(e,t,$e/6),r=w.RotWith(e,t,-$e/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function NH({point:t,int:e}){const n=w.Sub(e,t).div(2),r=w.Add(t,w.Rot(n,Xe)),s=w.Sub(t,w.Rot(n,Xe));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${s.x} ${s.y} Z`}function FH({point:t,int:e}){const n=w.Lrp(t,e,.45),r=w.Dist(n,t);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function BH({point:t,int:e}){const n=w.Lrp(t,e,.75),r=w.RotWith(n,t,$e/4),s=w.RotWith(n,t,-$e/4),i=w.Lrp(r,s,.5);return i.add(w.Sub(i,t)),`M ${i.x} ${i.y} L ${r.x} ${r.y} ${t.x} ${t.y} L ${s.x} ${s.y} Z`}function $H({int:t,point:e}){const n=w.Lrp(e,t,.85),r=w.Sub(n,e).div(2),s=w.Add(e,w.Rot(r,Xe)),i=w.Sub(e,w.Rot(r,Xe)),o=w.Add(n,w.Rot(r,Xe)),a=w.Sub(n,w.Rot(r,Xe));return`M ${s.x} ${s.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${i.x} ${i.y} Z`}function zH({int:t,point:e}){const n=w.Sub(t,e).div(2),r=w.Add(e,w.Rot(n,Xe)),s=w.Sub(e,w.Rot(n,Xe));return`M ${r.x} ${r.y} L ${s.x} ${s.y}`}function dd(t,e,n){const r=e==="end"?t.end.arrowhead:t.start.arrowhead;if(r==="none")return;const s=OH(t,e,n);if(s){switch(r){case"bar":return zH(s);case"square":return $H(s);case"diamond":return BH(s);case"dot":return FH(s);case"inverted":return NH(s);case"arrow":return DH(s);case"triangle":return LH(s)}return""}}function UH(t){const{start:e,end:n,handleArc:{radius:r,largeArcFlag:s,sweepFlag:i}}=t;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${s} ${i} ${n.handle.x},${n.handle.y}`}function uD(t){const{start:e,end:n,bodyArc:{radius:r,largeArcFlag:s,sweepFlag:i}}=t;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${s} ${i} ${n.point.x},${n.point.y}`}function hD(t,e){return`M${t.x},${t.y}L${e.x},${e.y}`}function qH(t){return hD(t.start.handle,t.end.handle)}function pD(t){return hD(t.start.point,t.end.point)}let HH=0;class GH extends Qs{static type="arrow";static props=eR;static migrations=tR;canEdit=()=>!0;canBind({toShapeType:e}){return e!=="arrow"}canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;canBeLaidOut=e=>{const n=wn(this.editor,e);return!n.start&&!n.end};getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const n=Rr(this.editor,e),r=[],s=n.isStraight?new rs({start:w.From(n.start.point),end:w.From(n.end.point)}):new so({center:w.Cast(n.handleArc.center),start:w.Cast(n.start.point),end:w.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});let i;if(e.props.text.trim()){const o=Fl(this.editor,e);r.push(...o.debugGeom),i=new us({x:o.box.x,y:o.box.y,width:o.box.w,height:o.box.h,isFilled:!0,isLabel:!0})}return new xr({children:[...i?[s,i]:[s],...r]})}getHandles(e){const n=Rr(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:n.start.handle.x,y:n.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:n.middle.x,y:n.middle.y},{id:"end",type:"vertex",index:"a3",x:n.end.handle.x,y:n.end.handle.y}].filter(Boolean)}onHandleDrag=(e,{handle:n,isPrecise:r})=>{const s=n.id,i=wn(this.editor,e);if(s==="middle"){const{start:E,end:I}=io(this.editor,e,i),C=w.Sub(I,E),P=w.Per(C),k=w.Med(I,E),T=w.Sub(k,P),M=w.Add(k,P),A=w.NearestPointOnLineSegment(T,M,n,!1);let j=w.Dist(A,k);return w.Clockwise(A,I,k)&&(j*=-1),{id:e.id,type:e.type,props:{bend:j}}}const o={id:e.id,type:"arrow",props:{}},a=i[s],l=i[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Nl(this.editor,e,s),o.props[s]={x:n.x,y:n.y},o;const d=this.editor.getShapePageTransform(e.id).applyToPoint(n),u=this.editor.getShapeAtPoint(d,{hitInside:!0,hitFrameInside:!0,margin:0,filter:E=>!E.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:E,binding:"arrow"})});if(!u)return Nl(this.editor,e,s),o.props[s]={x:n.x,y:n.y},o;const p=this.editor.getShapeGeometry(u),f=ce.ZeroFix(p.bounds),y=this.editor.getShapePageTransform(o.id).applyToPoint(n),S=this.editor.getPointInShapeSpace(u,y);let g=r;g||(!a||a&&u.id!==a.toId)&&(g=this.editor.inputs.pointerVelocity.len()<.5),r||(p.isClosed||(g=!0),l&&u.id===l.toId&&l.props.isPrecise&&(g=!0));const v={x:(S.x-f.minX)/f.width,y:(S.y-f.minY)/f.height};g&&w.Dist(S,f.center)<Math.max(4,Math.min(Math.min(f.width,f.height)*.15,16))/this.editor.getZoomLevel()&&(v.x=.5,v.y=.5);const x={terminal:s,normalizedAnchor:v,isPrecise:g,isExact:this.editor.inputs.altKey};la(this.editor,e,u.id,x),this.editor.setHintingShapes([u.id]);const b=wn(this.editor,e);return b.start&&b.end&&b.start.toId===b.end.toId&&w.Equals(b.start.props.normalizedAnchor,b.end.props.normalizedAnchor)&&la(this.editor,e,b.end.toId,{...b.end.props,normalizedAnchor:{x:b.end.props.normalizedAnchor.x+.05,y:b.end.props.normalizedAnchor.y}}),o};onTranslateStart=e=>{const n=wn(this.editor,e),r=io(this.editor,e,n),s=this.editor.getShapePageTransform(e.id),i=this.editor.getSelectedShapeIds();if(!(n.start&&(i.includes(n.start.toId)||this.editor.isAncestorSelected(n.start.toId))||n.end&&(i.includes(n.end.toId)||this.editor.isAncestorSelected(n.end.toId)))){kI.set(e,{pagePosition:s.applyToPoint(e),terminalBindings:fc(r,(o,a)=>{const c=n[o];return c?{binding:c,shapePosition:a,pagePosition:s.applyToPoint(a)}:null})}),n.start&&(ad({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),n.end&&ad({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const o of["start","end"]){const a=n[o];a&&this.editor.updateBinding({...a,props:{...a.props,isPrecise:!0}})}}};onTranslate=(e,n)=>{const r=kI.get(e);if(!r)return;const s=this.editor.getShapePageTransform(n.id),i=w.Sub(s.applyToPoint(n),r.pagePosition);for(const o of Object.values(r.terminalBindings)){if(!o)continue;const a=w.Add(o.pagePosition,w.Mul(i,.5)),c=this.editor.getShapeAtPoint(a,{hitInside:!0,hitFrameInside:!0,margin:0,filter:l=>!l.isLocked&&this.editor.canBindShapes({fromShape:n,toShape:l,binding:"arrow"})});if(c?.id===o.binding.toId){const l=ce.ZeroFix(this.editor.getShapeGeometry(c).bounds),d=this.editor.getPointInShapeSpace(c,a),u={x:(d.x-l.minX)/l.width,y:(d.y-l.minY)/l.height};la(this.editor,n,c.id,{...o.binding.props,normalizedAnchor:u,isPrecise:!0})}else Nl(this.editor,n,o.binding.props.terminal)}};_resizeInitialBindings=new ls;onResize=(e,n)=>{const{scaleX:r,scaleY:s}=n,i=this._resizeInitialBindings.get(e,()=>wn(this.editor,e)),o=io(this.editor,e,i),{start:a,end:c}=Ye(e.props);let{bend:l}=e.props;i.start||(a.x=o.start.x*r,a.y=o.start.y*s),i.end||(c.x=o.end.x*r,c.y=o.end.y*s);const d=Math.abs(r),u=Math.abs(s),p=i?.start?w.From(i.start.props.normalizedAnchor):null,f=i?.end?w.From(i.end.props.normalizedAnchor):null;return r<0&&s>=0?(l!==0&&(l*=-1,l*=Math.max(d,u)),p&&(p.x=1-p.x),f&&(f.x=1-f.x)):r>=0&&s<0?(l!==0&&(l*=-1,l*=Math.max(d,u)),p&&(p.y=1-p.y),f&&(f.y=1-f.y)):r>=0&&s>=0?l!==0&&(l*=Math.max(d,u)):r<0&&s<0&&(l!==0&&(l*=Math.max(d,u)),p&&(p.x=1-p.x,p.y=1-p.y),f&&(f.x=1-f.x,f.y=1-f.y)),i.start&&p&&la(this.editor,e,i.start.toId,{...i.start.props,normalizedAnchor:p.toJson()}),i.end&&f&&la(this.editor,e,i.end.toId,{...i.end.props,normalizedAnchor:f.toJson()}),{props:{start:a,end:c,bend:l}}};onDoubleClickHandle=(e,n)=>{switch(n.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}};component(e){const n=or(),r=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly;if(!Rr(this.editor,e)?.isValid)return null;const o=Fl(this.editor,e),a=e.id===this.editor.getOnlySelectedShapeId(),l=this.editor.getEditingShapeId()===e.id||e.props.text;return h.jsxs(h.Fragment,{children:[h.jsx(Ks,{id:e.id,style:{minWidth:50,minHeight:50},children:h.jsx(EI,{shape:e,shouldDisplayHandles:s&&r?.id===e.id})}),l&&h.jsx(Vd,{id:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:Ux(e),lineHeight:qt.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:n[e.props.labelColor].solid,textWidth:o.box.w,isSelected:a,padding:0,style:{transform:`translate(${o.box.center.x}px, ${o.box.center.y}px)`}})]})}indicator(e){const n=Ud(e.id),r=Rr(this.editor,e);if(!r)return null;const{start:s,end:i}=io(this.editor,e,r?.bindings),o=this.editor.getShapeGeometry(e),a=o.bounds,c=e.props.text.trim()?o.children[1]:null;if(w.Equals(s,i))return null;const l=At[e.props.size]*e.props.scale,d=r.start.arrowhead&&dd(r,"start",l),u=r.end.arrowhead&&dd(r,"end",l),p=r.isStraight?pD(r):uD(r),f=d&&r.start.arrowhead!=="arrow"||u&&r.end.arrowhead!=="arrow"||!!c,m=(e.id+"_clip").replace(":","_");return n&&c?h.jsx("rect",{x:G(c.x),y:G(c.y),width:c.w,height:c.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale}):h.jsxs("g",{children:[f&&h.jsx("defs",{children:h.jsxs("mask",{id:m,children:[h.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),c&&h.jsx("rect",{x:G(c.x),y:G(c.y),width:c.w,height:c.h,fill:"black",rx:3.5*e.props.scale,ry:3.5*e.props.scale}),d&&h.jsx("path",{d,fill:r.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),u&&h.jsx("path",{d:u,fill:r.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),h.jsxs("g",{...f?{mask:`url(#${m})`}:void 0,children:[f&&h.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),h.jsx("path",{d:p})]}),d&&h.jsx("path",{d}),u&&h.jsx("path",{d:u}),c&&h.jsx("rect",{x:G(c.x),y:G(c.y),width:c.w,height:c.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{const{id:n,type:r,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:s.trimEnd()}}])};toSvg(e,n){n.addExportDef(hw(e.props.fill)),e.props.text&&n.addExportDef(Gd(e.props.font));const r=ms(n),s=1/e.props.scale;return h.jsxs("g",{transform:`scale(${s})`,children:[h.jsx(EI,{shape:e,shouldDisplayHandles:!1}),h.jsx(Kd,{fontSize:Ux(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:r[e.props.labelColor].solid,bounds:Fl(this.editor,e).box,padding:4*e.props.scale})]})}getCanvasSvgDefs(){return[pw(),{key:"arrow:dot",component:VH},{key:"arrow:cross",component:WH}]}getInterpolatedProps(e,n,r){return{...n.props,start:{x:xn(e.props.start.x,n.props.start.x,r),y:xn(e.props.start.y,n.props.start.y,r)},end:{x:xn(e.props.end.x,n.props.end.x,r),y:xn(e.props.end.y,n.props.end.y,r)},bend:xn(e.props.bend,n.props.bend,r),labelPosition:xn(e.props.labelPosition,n.props.labelPosition,r)}}}function KH(t,e){const n=Rr(t,e);return n.isStraight?w.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}const EI=Ot(function({shape:e,shouldDisplayHandles:n}){const r=K(),s=or(),i=Rr(r,e),o=ce.ZeroFix(r.getShapeGeometry(e).bounds),a=wn(r,e),c=qe.useMemo(()=>r.environment.isSafari?HH+=1:0,[e]);if(!i?.isValid)return null;const l=At[e.props.size]*e.props.scale,d=i.start.arrowhead&&dd(i,"start",l),u=i.end.arrowhead&&dd(i,"end",l),p=i.isStraight?pD(i):uD(i);let f=null;if(n){const b=2/r.getZoomLevel(),{strokeDasharray:E,strokeDashoffset:I}=Tr(KH(r,e),b,{end:"skip",start:"skip",lengthRatio:2.5});f=a.start||a.end?h.jsx("path",{className:"tl-arrow-hint",d:i.isStraight?qH(i):UH(i),strokeDasharray:E,strokeDashoffset:I,strokeWidth:b,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:m,strokeDashoffset:y}=Tr(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:e.props.dash}),S=Fl(r,e),g=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),v=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow"),x=(e.id+"_clip_"+c).replace(":","_");return h.jsxs(h.Fragment,{children:[h.jsx("defs",{children:h.jsxs("mask",{id:x,children:[h.jsx("rect",{x:G(-100+o.minX),y:G(-100+o.minY),width:G(o.width+200),height:G(o.height+200),fill:"white"}),e.props.text.trim()&&h.jsx("rect",{x:S.box.x,y:S.box.y,width:S.box.w,height:S.box.h,fill:"black",rx:4,ry:4}),d&&g&&h.jsx("path",{d,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),u&&v&&h.jsx("path",{d:u,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),h.jsxs("g",{fill:"none",stroke:s[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,h.jsxs("g",{mask:`url(#${x})`,children:[h.jsx("rect",{x:G(o.minX-100),y:G(o.minY-100),width:G(o.width+200),height:G(o.height+200),opacity:0}),h.jsx("path",{d:p,strokeDasharray:m,strokeDashoffset:y})]}),d&&g&&e.props.fill!=="none"&&h.jsx(Zt,{theme:s,d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),u&&v&&e.props.fill!=="none"&&h.jsx(Zt,{theme:s,d:u,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&h.jsx("path",{d}),u&&h.jsx("path",{d:u})]})]})}),kI=new WeakMap;function VH(){return h.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:h.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function WH(){return h.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[h.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),h.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const TI="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function xo({url:t,zoomLevel:e}){return h.jsx("a",{className:be("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:jt,onPointerUp:jt,title:t,draggable:!1,children:h.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${TI}") center 100% / 100% no-repeat`,WebkitMask:`url("${TI}") center 100% / 100% no-repeat`}})})}const MI="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",YH=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function gw(t){return YH.map(n=>{const{offsetX:r,offsetY:s,blur:i,spread:o,color:a}=n,c=new w(r,s),{x:l,y:d}=c.rot(-t);return`${l}px ${d}px ${i}px ${o}px ${a}`}).join(", ")}const XH=300,fD=320,ZH=46,QH=101;class JH extends Fo{static type="bookmark";static props=aR;static migrations=cR;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:XH,h:fD,assetId:null}}component(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):null,r=this.editor.getShapePageTransform(e).rotation(),s=eG(e);return h.jsx(Ii,{children:h.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:gw(r),maxHeight:e.props.h},children:[(!n||n.props.image)&&h.jsxs("div",{className:"tl-bookmark__image_container",children:[n?h.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:n?.props.image,alt:n?.props.title||""}):h.jsx("div",{className:"tl-bookmark__placeholder"}),n?.props.image&&h.jsx(xo,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),h.jsxs("div",{className:"tl-bookmark__copy_container",children:[n?.props.title?h.jsx("h2",{className:"tl-bookmark__heading",children:n.props.title}):null,n?.props.description&&n?.props.image?h.jsx("p",{className:"tl-bookmark__description",children:n.props.description}):null,h.jsxs("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:jt,onPointerUp:jt,onClick:jt,children:[n?.props.favicon?h.jsx("img",{className:"tl-bookmark__favicon",src:n?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${s}`}):h.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${MI}") center 100% / 100% no-repeat`,WebkitMask:`url("${MI}") center 100% / 100% no-repeat`}}),h.jsx("span",{children:s})]})]})]})})}indicator(e){return h.jsx("rect",{width:G(e.props.w),height:G(e.props.h),rx:"6",ry:"6"})}onBeforeCreate=e=>AI(this.editor,e);onBeforeUpdate=(e,n)=>{if(e.props.url!==n.props.url)if($n.isValid(n.props.url))tG(this.editor,n);else return{...n,props:{...n.props,url:e.props.url}};if(e.props.assetId!==n.props.assetId)return AI(this.editor,n)}}function AI(t,e){const n=e.props.assetId?t.getAsset(e.props.assetId):null;let r=fD;return n&&(n.props.image||(n.props.title?r=QH:r=ZH)),{...e,props:{...e.props,h:r}}}const eG=t=>{try{return new URL(t.props.url).hostname.replace(/^www\./,"")}catch{return t.props.url}};function tG(t,e){const{url:n}=e.props,r=fi.createId(xx(n));t.getAsset(r)?e.props.assetId!==r&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),nG(t,e))}const nG=wj(async(t,e)=>{if(t.isDisposed)return;const{url:n}=e.props,r=await t.getAssetForExternalContent({type:"url",url:n});r&&t.run(()=>{t.createAssets([r]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Pi(t,e=!1){const n=t.length;if(n<2)return"";let r=t[0].point,s=t[1].point;if(n===2)return`M${Be(r)}L${Be(s)}`;let i="";for(let o=2,a=n-1;o<a;o++)r=t[o].point,s=t[o+1].point,i+=bn(r,s);return e?`M${bn(t[0].point,t[1].point)}Q${Be(t[1].point)}${bn(t[1].point,t[2].point)}T${i}${bn(t[n-1].point,t[0].point)}${bn(t[0].point,t[1].point)}Z`:`M${Be(t[0].point)}Q${Be(t[1].point)}${bn(t[1].point,t[2].point)}${t.length>3?"T":""}${i}L${Be(t[n-1].point)}`}function rG(t,e={}){const{start:n={},end:r={}}=e,{cap:s=!0}=n,{cap:i=!0}=r;Ze(!n.taper&&!r.taper,"cap taper not supported here"),Ze(!n.easing&&!r.easing,"cap easing not supported here"),Ze(s&&i,"cap must be true");const o=$r(t,e);qd(o,e);const a=sG(o);let c="";for(const l of a)c+=oG(l,e);return c}function sG(t){if(t.length<=2)return[t];const e=[];let n=[t[0]],r=w.Sub(t[1].point,t[0].point).uni(),s,i,o,a,c;for(let l=1,d=t.length;l<d-1;l++){if(o=t[l-1],a=t[l],c=t[l+1],s=w.Sub(c.point,a.point).uni(),i=w.Dpr(r,s),r=s,i<-.8){const u={...a,point:a.input};n.push(u),e.push(Df(n)),n=[u];continue}if(n.push(a),!(i>.7)&&(w.Dist2(o.point,a.point)+w.Dist2(a.point,c.point))/((o.radius+a.radius+c.radius)/3)**2<1.5){n.push(a),e.push(Df(n)),n=[a];continue}}return n.push(t[t.length-1]),e.push(Df(n)),e}function Df(t){const e=t[0];let n;for(;t.length>2&&(n=t[1],w.Dist2(e.point,n.point)<((e.radius+n.radius)/2*.5)**2);)t.splice(1,1);const r=t[t.length-1];let s;for(;t.length>2&&(s=t[t.length-2],w.Dist2(r.point,s.point)<((r.radius+s.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:w.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:w.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function iG(t,e,n){return"M "+t+" "+e+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function oG(t,e={}){if(t.length===0)return"";if(t.length===1)return iG(t[0].point.x,t[0].point.y,t[0].radius);const{left:n,right:r}=GO(t,e);r.reverse();let s=`M${Be(n[0])}T`;for(let i=1;i<n.length;i++)s+=bn(n[i-1],n[i]);{const i=t[t.length-1],o=i.radius,a=i.vector.clone().per().neg(),c=w.Add(i.point,w.Mul(a,o)),l=w.Add(i.point,w.Mul(a,-o));s+=`${Be(c)}A${G(o)},${G(o)} 0 0 1 ${Be(l)}T`}for(let i=1;i<r.length;i++)s+=bn(r[i-1],r[i]);{const i=t[0],o=i.radius,a=i.vector.clone().per(),c=w.Add(i.point,w.Mul(a,o)),l=w.Add(i.point,w.Mul(a,-o));s+=`${Be(c)}A${G(o)},${G(o)} 0 0 1 ${Be(l)}Z`}return s}const aG=t=>t*.65+h6(t*$e/2)*.35,cG=t=>({size:t,thinning:.5,streamline:yo(t,[9,16],[.64,.74],!0),smoothing:.62,easing:Mt.easeOutSine,simulatePressure:!0}),lG=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:aG}),jI=t=>({size:t,thinning:0,streamline:yo(t,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Mt.linear}),dG=t=>({size:t,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Mt.linear});function mw({strokeWidth:t,showAsComplete:e}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Mt.easeOutSine,last:e}}function qx(t,e,n,r){const s=t.isComplete||n;return r?t.isPen?{...dG(e),last:s}:{...jI(e),last:s}:t.dash==="draw"?t.isPen?{...lG(e),last:s}:{...cG(e),last:s}:{...jI(e),last:s}}function bo(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(w.Cast));else{const r=Math.max(4,Math.floor(w.Dist(n.points[0],n.points[1])/16));e.push(...w.PointsBetween(n.points[0],n.points[1],r))}return e}function uG(t,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class hG extends Qs{static type="draw";static props=dR;static migrations=uR;hideResizeHandles=e=>Lf(e);hideRotateHandle=e=>Lf(e);hideSelectionBoundsFg=e=>Lf(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const n=bo(e.props.segments),r=(At[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const i=ce.FromPoints(n);if(i.width<r*2&&i.height<r*2)return new lw({x:-r,y:-r,radius:r,isFilled:!0})}const s=$r(n,qx(e.props,r,e.props.isPen,!0)).map(i=>i.point);return e.props.isClosed?new mt({points:s,isFilled:e.props.fill!=="none"}):new No({points:s})}component(e){return h.jsx(Ks,{id:e.id,children:h.jsx(RI,{shape:e,zoomLevel:this.editor.getZoomLevel()})})}indicator(e){const n=bo(e.props.segments);let r=(At[e.props.size]+1)*e.props.scale;const s=this.editor.getZoomLevel();!(s<.5&&s<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&n.length===1&&(r+=wr(e.id)()*(r/6));const o=e.props.isComplete||Bt(e.props.segments)?.type==="straight",a=qx(e.props,r,o,!0),c=$r(n,a),l=c.length>1?Pi(c,e.props.isClosed):gD(n[0],r);return h.jsx("path",{d:l})}toSvg(e,n){n.addExportDef(hw(e.props.fill));const r=1/e.props.scale;return h.jsx("g",{transform:`scale(${r})`,children:h.jsx(RI,{shape:e,zoomLevel:1})})}getCanvasSvgDefs(){return[pw()]}onResize=(e,n)=>{const{scaleX:r,scaleY:s}=n,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map(({x:a,y:c,z:l})=>({x:ns(r*a),y:ns(s*c),z:l}))});return{props:{segments:i}}};expandSelectionOutlinePx(e){const n=e.props.dash==="draw"?1.6:1;return At[e.props.size]*n/2*e.props.scale}}function gD(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function Lf(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function RI({shape:t,zoomLevel:e}){const n=or(),r=bo(t.props.segments),s=t.props.isComplete||Bt(t.props.segments)?.type==="straight";let i=(At[t.props.size]+1)*t.props.scale;const o=e<.5&&e<1.5/i;!o&&!t.props.isPen&&t.props.dash==="draw"&&r.length===1&&(i+=wr(t.id)()*(i/6));const a=qx(t.props,i,s,o);if(!o&&t.props.dash==="draw")return h.jsxs(h.Fragment,{children:[t.props.isClosed&&t.props.fill&&r.length>1?h.jsx(Zt,{d:Pi($r(r,a),t.props.isClosed),theme:n,color:t.props.color,fill:t.props.isClosed?t.props.fill:"none",scale:t.props.scale}):null,h.jsx("path",{d:rG(r,a),strokeLinecap:"round",fill:n[t.props.color].solid})]});const c=$r(r,a),l=c.length<2,d=l?gD(r[0],0):Pi(c,t.props.isClosed);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{d,theme:n,color:t.props.color,fill:l||t.props.isClosed?t.props.fill:"none",scale:t.props.scale}),h.jsx("path",{d,strokeLinecap:"round",fill:l?n[t.props.color].solid:"none",stroke:n[t.props.color].solid,strokeWidth:i,strokeDasharray:l?"none":uG(t,i),strokeDashoffset:"0"})]})}function pG(t,e,n={}){const{newPoint:r,handle:s,scaleX:i,scaleY:o}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:d=1/0}=n;let u=t.props.w*i,p=t.props.h*o;const f=new w(0,0);if(u>0){if(u<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=u-a;break}case"top":case"bottom":{f.x=(u-a)/2;break}default:f.x=0}u=a}}else if(f.x=u,u=-u,u<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-u;break}default:f.x=-a}u=a}if(p>0){if(p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:m,y}=f.rot(t.rotation).add(r);return{x:m,y,props:{w:Math.min(c,u),h:Math.min(d,p)}}}const fG=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" ");class gG extends Fo{static type="embed";static props=hR;static migrations=pR;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canResize=e=>!!Ls(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>Ls(e.props.url)?.definition.isAspectRatioLocked??!1;onResize=(e,n)=>{const r=this.isAspectRatioLocked(e),s=Ls(e.props.url);let i=s?.definition.minWidth??200,o=s?.definition.minHeight??200;if(r){const a=e.props.w/e.props.h;a>1?i*=a:o/=a}return pG(e,n,{minWidth:i,minHeight:o})};component(e){const{w:n,h:r,url:s}=e.props,i=Ud(e.id),o=_.useMemo(()=>XO(s),[s]),a=X("is hovering",()=>{const{editingShapeId:p,hoveredShapeId:f}=this.editor.getCurrentPageState();if(p&&f!==p){const m=this.editor.getShape(p);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation(),l=i||a;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&o?.definition.type==="tldraw")return null;if(o?.definition.type==="github_gist"){const p=o.url.split("/").pop();if(!p)throw Error("No gist id!");return h.jsx(Ii,{className:"tl-embed-container",id:e.id,children:h.jsx(mG,{id:p,width:G(n),height:G(r),isInteractive:l,pageRotation:c})})}const u=fG({...V4,...o?.definition.overridePermissions??{}});return h.jsx(Ii,{className:"tl-embed-container",id:e.id,children:o?.definition?h.jsx("iframe",{className:"tl-embed",sandbox:u,src:o.embedUrl,width:G(n),height:G(r),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:l?"auto":"none",zIndex:l?"":"-1",boxShadow:gw(c),borderRadius:o?.definition.overrideOutlineRadius??8,background:o?.definition.backgroundColor}}):null})}indicator(e){const n=_.useMemo(()=>Ls(e.props.url),[e.props.url]);return h.jsx("rect",{width:G(e.props.w),height:G(e.props.h),rx:n?.definition.overrideOutlineRadius??8,ry:n?.definition.overrideOutlineRadius??8})}}function mG({id:t,file:e,isInteractive:n,width:r,height:s,style:i,pageRotation:o}){return h.jsx("iframe",{className:"tl-embed",draggable:!1,width:G(r),height:G(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:gw(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const yG=_.forwardRef(({id:t,name:e,isEditing:n},r)=>{const s=K(),i=_.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(jt(c),c.currentTarget.blur(),s.setEditingShape(null))},[s]),o=_.useCallback(c=>{const l=s.getShape(t);if(!l)return;const d=l.props.name,u=c.currentTarget.value.trim();d!==u&&s.updateShapes([{id:t,type:"frame",props:{name:u}}])},[t,s]),a=_.useCallback(c=>{const l=s.getShape(t);if(!l)return;const d=l.props.name,u=c.currentTarget.value;d!==u&&s.updateShapes([{id:t,type:"frame",props:{name:u}}])},[t,s]);return h.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[h.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:i,onBlur:o,onChange:a}),mD(e,"Frame")+"​"]})}),SG=function({id:e,name:n,width:r,height:s}){const i=K(),o=X("shape rotation",()=>zs(i.getShapePageTransform(e).rotation()),[i,e]),a=Ud(e),c=_.useRef(null),l=_.useCallback(m=>{const y=_n(m);m.preventDefault(),i.getEditingShapeId()!==e&&i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(e),...y})},[i,e]);_.useEffect(()=>{const m=c.current;m&&a&&(m.focus(),m.select())},[c,a]);const u=((o+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(u)];let f;switch(p){case"top":f="";break;case"right":f=`translate(${G(r)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${G(r)}px, ${G(s)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${G(s)}px) rotate(270deg)`;break}return h.jsx("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?r:s)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:h.jsx("div",{className:"tl-frame-heading-hit-area",children:h.jsx(yG,{ref:c,id:e,name:n,isEditing:a})})})};function mD(t,e){return t.match(/^\s*$/)?e:t}class vG extends Fo{static type="frame";static props=fR;static migrations=gR;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new us({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const n=this.editor.getShapeGeometry(e).bounds,r=or(),s=X("is creating this shape",()=>{const i=this.editor.getStateDescendant("select.resizing");if(!i||!i.getIsActive())return!1;const o=i?.info;return o?o.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return h.jsxs(h.Fragment,{children:[h.jsx(Ks,{children:h.jsx("rect",{className:be("tl-frame__body",{"tl-frame__creating":s}),width:n.width,height:n.height,fill:r.solid,stroke:r.text})}),s?null:h.jsx(SG,{id:e.id,name:e.props.name,width:n.width,height:n.height})]})}toSvg(e,n){const r=ms({isDarkMode:n.isDarkMode}),o=((zs(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=Math.floor(o);let c;switch(a){case 0:c="";break;case 3:c=`translate(${G(e.props.w)}, 0) rotate(90)`;break;case 2:c=`translate(${G(e.props.w)}, ${G(e.props.h)}) rotate(180)`;break;case 1:c=`translate(0, ${G(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const l={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(mD(e.props.name,"Frame")+"​",l),u=d[0],p=Bt(d),f=p.box.w+p.box.x-u.box.x,m=zx(this.editor,d,{offsetY:-l.height-2,...l});return h.jsxs(h.Fragment,{children:[h.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),h.jsxs("g",{transform:c,children:[h.jsx("rect",{x:-8,y:-l.height-4,width:f+16,height:l.height,fill:r.background,rx:4,ry:4}),m]})]})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return h.jsx("rect",{width:G(n.width),height:G(n.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,n)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,n)=>!e.isLocked;onDragShapesOver=(e,n)=>{n.every(r=>r.parentId===e.id)||this.editor.reparentShapes(n,e.id)};onDragShapesOut=(e,n)=>{const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(n,r.id):this.editor.reparentShapes(n,this.editor.getCurrentPageId())};onResize=(e,n)=>aw(e,n)}function OI(t,e){return t>e?($e*(e/2)+(t-e))*2:($e*(t/2)+(e-t))*2}function yD(t,e){return yw(t,e).map((n,r)=>n.getSvgPathData(r===0)).join(" ")+" Z"}function xG(t,e,n,r){const s=t/4,i=e/4,o=wr(r),a=n*.75,c=v=>v.addXY(o()*a,o()*a),l=new w(t/2,e),d=new w(0,i*1.2),u=new w(t/2,i*.9),p=new w(t,i*1.2),f=c(new w(t/2,e)),m=c(new w(0,i*1.2)),y=c(new w(t/2,i*.9)),S=c(new w(t,i*1.2));return[new Jt({start:l,cp1:new w(s*1.5,i*3),cp2:new w(0,i*2.5),end:d}),new Jt({start:d,cp1:new w(0,-i*.32),cp2:new w(s*1.85,-i*.32),end:u}),new Jt({start:u,cp1:new w(s*2.15,-i*.32),cp2:new w(t,-i*.32),end:p}),new Jt({start:p,cp1:new w(t,i*2.5),cp2:new w(s*2.5,i*3),end:f}),new Jt({start:f,cp1:new w(s*1.5,i*3),cp2:new w(0,i*2.5),end:m}),new Jt({start:m,cp1:new w(0,-i*.32),cp2:new w(s*1.85,-i*.32),end:y}),new Jt({start:y,cp1:new w(s*2.15,-i*.32),cp2:new w(t,-i*.32),end:S}),new Jt({start:S,cp1:new w(t,i*2.5),cp2:new w(s*2.5,i*3),end:l})].map((v,x)=>v.getSvgPathData(x===0)).join(" ")+" Z"}function yw(t,e){const n=t/4,r=e/4;return[new Jt({start:new w(t/2,e),cp1:new w(n*1.5,r*3),cp2:new w(0,r*2.5),end:new w(0,r*1.2)}),new Jt({start:new w(0,r*1.2),cp1:new w(0,-r*.32),cp2:new w(n*1.85,-r*.32),end:new w(t/2,r*.9)}),new Jt({start:new w(t/2,r*.9),cp1:new w(n*2.15,-r*.32),cp2:new w(t,-r*.32),end:new w(t,r*1.2)}),new Jt({start:new w(t,r*1.2),cp1:new w(t,r*2.5),cp2:new w(n*2.5,r*3),end:new w(t/2,e)})]}function bG(t){return{size:1+t,thinning:.25,end:{taper:t},start:{taper:t},streamline:0,smoothing:1,simulatePressure:!1}}function wG(t,e,n,r){const s=wr(t),i=e/2,o=n/2,a=OR(i,o),c=[],l=Ue*s(),d=Ue+Xe/2+Math.abs(s())*Xe,u=Math.max(16,a/10);for(let p=0;p<u;p++){const f=p/(u-1),m=l+f*d,y=Math.cos(m),S=Math.sin(m);c.push(new w(i*y+e*.5+.05*s(),o*S+n/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?Mt.easeInOutSine(f):Mt.easeInExpo(f)))/2)))}return $r(c,bG(r))}function CG(t,e,n,r){return Pi(wG(t,e,n,r))}function Hx(t){let e="M";const n=t.length;let r,s,i;for(let o=0,a=n;o<a;o+=3)r=t[o],s=t[o+1],i=t[o+2],e+=`${Be(r)}L${Be(s)}Q${Be(i)}`;return e+=`${Be(t[0])}`,e}function Gx(t,e,n,r,s){const i=[],o=wr(t);let a=e[0],c;const l=e.length;for(let d=0,u=l*s;d<u;d++){c=w.AddXY(e[(d+1)%l],o()*n,o()*n);const p=w.Sub(c,a),f=w.Len(p),m=w.Div(p,f).mul(Math.min(f/4,r));i.push(w.Add(a,m),w.Add(c,m.neg()),c),a=c}return i}function _G(t,e,n){const r=Math.min(t,e)/2,s=Math.max(t,e)-r*2,o=(Math.PI*(r*2)+2*s)/n,a=t>e?[{type:"straight",start:new w(r,0),delta:new w(1,0)},{type:"arc",center:new w(t-r,r),startAngle:-$e/2},{type:"straight",start:new w(t-r,e),delta:new w(-1,0)},{type:"arc",center:new w(r,r),startAngle:$e/2}]:[{type:"straight",start:new w(t,r),delta:new w(0,1)},{type:"arc",center:new w(r,e-r),startAngle:0},{type:"straight",start:new w(0,e-r),delta:new w(0,-1)},{type:"arc",center:new w(r,r),startAngle:$e}];let c=0;const l=[];for(let d=0;d<n;d++){const u=a[0];u.type==="straight"?l.push(w.Add(u.start,w.Mul(u.delta,c))):l.push(_i(u.center,r,u.startAngle+c/r)),c+=o;let p=u.type==="straight"?s:$e*r;for(;c>p;)c-=p,a.push(a.shift()),p=a[0].type==="straight"?s:$e*r}return l}const IG={s:50,m:70,l:100,xl:130},PG=.2;function Wd(t,e,n,r){const s=wr(n),i=OI(t,e),o=Math.max(Math.ceil(i/IG[r]),6,Math.ceil(i/Math.min(t,e))),a=i/o*PG,c=Math.max(t-a*2,1),l=Math.max(e-a*2,1),u=OI(c,l)/o,p=(t-c)/2,f=(e-l)/2,m=_G(c,l,o).map(x=>x.addXY(p,f)),y=t<20?0:a*.3,S=e<20?0:a*.3,g=m.slice(0);for(let x=0;x<Math.floor(o/2);x++)g[x]=w.AddXY(g[x],s()*y,s()*S),g[o-x-1]=w.AddXY(g[o-x-1],s()*y,s()*S);const v=[];for(let x=0;x<g.length;x++){const b=x===g.length-1?0:x+1,E=g[x],I=g[b],C=m[x],P=m[b],k=w.Dist(C,P),T=u-k,A=w.Dist(E,I)/k,j=(Math.max(p,f)+T)*A,R=w.Lrp(C,P,.5).add(w.Sub(P,C).uni().per().mul(j));R.x<0?R.x=0:R.x>t&&(R.x=t),R.y<0?R.y=0:R.y>e&&(R.y=e);const L=Gb(E,I,R),F=w.Dist(L||w.Average([E,I]),E);v.push({leftPoint:E,rightPoint:I,arcPoint:R,center:L,radius:F})}return v}function EG(t,e,n,r){const s=[],i=Wd(t,e,n,r);for(const{center:o,radius:a,leftPoint:c,rightPoint:l}of i)s.push(...m6(c,l,o,a,10));return s}function Kx(t,e,n,r){const s=Wd(t,e,n,r);let i=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:a,radius:c,center:l}of s){if(l===null){i+=` L${a.toFixed()}`;continue}const d=w.Clockwise(o,a,l)?"0":"1";i+=` A${G(c)},${G(c)} 0 ${d},1 ${a.toFixed()}`}return i+=" Z",i}const kG={s:.5,m:.7,l:.9,xl:1.6};function TG(t,e,n,r){const s=wr(n),i=kG[r],o=Wd(t,e,n,r),l=o.reduce((f,m)=>f+w.Dist2(m.leftPoint,m.rightPoint),0)/o.length>(i*15)**2?f=>f.addXY(s()*i*2,s()*i*2):f=>f;let d=`M${o[0].leftPoint.toFixed()}`,u=l(o[0].leftPoint),p=`M${u.toFixed()}`;for(const{leftPoint:f,center:m,rightPoint:y,radius:S,arcPoint:g}of o){if(m===null){d+=` L${y.toFixed()}`;const C=l(y);p+=` L${C.toFixed()}`,u=C;continue}const v=w.Clockwise(f,y,m)?"0":"1";d+=` A${G(S)},${G(S)} 0 ${v},1 ${y.toFixed()}`;const x=l(y),b=l(g),E=Gb(u,x,b);if(!Number.isFinite(E.x)||!Number.isFinite(E.y)){p+=` L${x.toFixed()}`,u=x;continue}const I=Math.abs(w.Dist(E,u));p+=` A${G(I)},${G(I)} 0 ${v},1 ${x.toFixed()}`,u=x}return d+p+" Z"}function Vx(t,e){switch(t.geo){case"x-box":return MG(t.w,t.h,e,t.dash);case"check-box":return AG(t.w,t.h);default:return}}function MG(t,e,n,r){const s=r==="draw"?.62:0;if(r==="dashed")return[[new w(0,0),new w(t/2,e/2)],[new w(t,e),new w(t/2,e/2)],[new w(0,e),new w(t/2,e/2)],[new w(t,0),new w(t/2,e/2)]];const i=a=>Math.max(0,Math.min(t,a)),o=a=>Math.max(0,Math.min(e,a));return[[new w(i(n*s),o(n*s)),new w(i(t-n*s),o(e-n*s))],[new w(i(n*s),o(e-n*s)),new w(i(t-n*s),o(n*s))]]}function AG(t,e){const n=Math.min(t,e)*.82,r=(t-n)/2,s=(e-n)/2,i=a=>Math.max(0,Math.min(t,a)),o=a=>Math.max(0,Math.min(e,a));return[[new w(i(r+n*.25),o(s+n*.52)),new w(i(r+n*.45),o(s+n*.82))],[new w(i(r+n*.45),o(s+n*.82)),new w(i(r+n*.82),o(s+n*.22))]]}function DI({shape:t,shouldScale:e}){const n=e?t.props.scale:1,r=K(),s=or(),{id:i,props:o}=t,{w:a,color:c,fill:l,dash:d,growY:u,size:p}=o,f=At[p]*n,m=o.h+u;switch(o.geo){case"cloud":if(d==="solid"){const y=Kx(a,m,i,p);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:y,color:c,fill:l,scale:n}),h.jsx("path",{d:y,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}else if(d==="draw"){const y=TG(a,m,i,p);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:y,color:c,fill:l,scale:n}),h.jsx("path",{d:y,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}else{const y=Kx(a,m,i,p),S=Wd(a,m,i,p);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:y,color:c,fill:l,scale:n}),h.jsx("g",{strokeWidth:f,stroke:s[c].solid,fill:"none",pointerEvents:"all",children:S.map(({leftPoint:g,rightPoint:v,center:x,radius:b},E)=>{const I=x?b*zs(zs(w.Angle(x,v))-zs(w.Angle(x,g))):w.Dist(g,v),{strokeDasharray:C,strokeDashoffset:P}=Tr(I,f,{style:d,start:"outset",end:"outset"});return h.jsx("path",{d:x?`M${g.x},${g.y}A${b},${b},0,0,1,${v.x},${v.y}`:`M${g.x},${g.y}L${v.x},${v.y}`,strokeDasharray:C,strokeDashoffset:P},E)})})]})}case"ellipse":{const y=e?r.getShapeGeometry(t):r.getShapeUtil(t).getGeometry(t),S=y.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const g=y.length,{strokeDasharray:v,strokeDashoffset:x}=Tr(g<64?g*2:g,f,{style:d,snap:4,closed:!0});return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:S,color:c,fill:l,scale:n}),h.jsx("path",{d:S,strokeWidth:f,fill:"none",stroke:s[c].solid,strokeDasharray:v,strokeDashoffset:x})]})}else{const v=(e?r.getShapeGeometry(t):r.getShapeUtil(t).getGeometry(t)).getSvgPathData(!0);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:v,color:c,fill:l,scale:n}),h.jsx("path",{d:v,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}}case"oval":{const y=e?r.getShapeGeometry(t):r.getShapeUtil(t).getGeometry(t),S=y.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const g=y.getLength(),{strokeDasharray:v,strokeDashoffset:x}=Tr(g<64?g*2:g,f,{style:d,snap:4,start:"outset",end:"outset",closed:!0});return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:S,color:c,fill:l,scale:n}),h.jsx("path",{d:S,strokeWidth:f,fill:"none",stroke:s[c].solid,strokeDasharray:v,strokeDashoffset:x})]})}else return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:S,color:c,fill:l,scale:n}),h.jsx("path",{d:S,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}case"heart":if(d==="dashed"||d==="dotted"||d==="solid"){const y=yD(a,m),S=yw(a,m);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:y,color:c,fill:l,scale:n}),S.map((g,v)=>{const{strokeDasharray:x,strokeDashoffset:b}=Tr(g.length,f,{style:d,snap:1,start:"outset",end:"outset",closed:!0});return h.jsx("path",{d:g.getSvgPathData(),strokeWidth:f,fill:"none",stroke:s[c].solid,strokeDasharray:x,strokeDashoffset:b,pointerEvents:"all"},`curve_${v}`)})]})}else{const y=xG(a,m,f,t.id);return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:y,color:c,fill:l,scale:n}),h.jsx("path",{d:y,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}default:{const y=e?r.getShapeGeometry(t):r.getShapeUtil(t).getGeometry(t),S=y instanceof xr?y.children[0].vertices:y.vertices,g=Vx(t.props,f);if(d==="solid"){let v="M"+S[0]+"L"+S.slice(1)+"Z";if(g)for(const[x,b]of g)v+=`M${x.x},${x.y}L${b.x},${b.y}`;return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:v,color:c,fill:l,scale:n}),h.jsx("path",{d:v,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}else if(d==="dashed"||d==="dotted"){const v="M"+S[0]+"L"+S.slice(1)+"Z";return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:v,color:c,fill:l,scale:n}),h.jsxs("g",{strokeWidth:f,stroke:s[c].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(S.length)).map((x,b)=>{const E=w.ToFixed(S[b]),I=w.ToFixed(S[(b+1)%S.length]),C=w.Dist(E,I),{strokeDasharray:P,strokeDashoffset:k}=Tr(C,f,{style:d,start:"outset",end:"outset"});return h.jsx("line",{x1:E.x,y1:E.y,x2:I.x,y2:I.y,strokeDasharray:P,strokeDashoffset:k},b)}),g&&g.map(([x,b],E)=>{const I=w.Dist(x,b),{strokeDasharray:C,strokeDashoffset:P}=Tr(I,f,{style:d,start:"skip",end:"skip",snap:d==="dotted"?4:void 0});return h.jsx("path",{d:`M${x.x},${x.y}L${b.x},${b.y}`,stroke:s[c].solid,strokeWidth:f,fill:"none",strokeDasharray:C,strokeDashoffset:P},`line_fg_${E}`)})]})]})}else if(d==="draw"){let v=Hx(Gx(i,S,f/3,f*2,2));if(g)for(const[b,E]of g)v+=`M${b.toFixed()}L${E.toFixed()}`;const x=Hx(Gx(i,S,0,f*2,1));return h.jsxs(h.Fragment,{children:[h.jsx(Zt,{theme:s,d:x,color:c,fill:l,scale:n}),h.jsx("path",{d:v,stroke:s[c].solid,strokeWidth:f,fill:"none"})]})}}}}const LI=51;class jG extends Fo{static type="geo";static props=mR;static migrations=yR;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),s=n/2,i=r/2,o=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new mt({points:EG(n,r,e.id,e.props.size),isFilled:o});break}case"triangle":{a=new mt({points:[new w(s,0),new w(n,r),new w(0,r)],isFilled:o});break}case"diamond":{a=new mt({points:[new w(s,0),new w(n,i),new w(s,r),new w(0,i)],isFilled:o});break}case"pentagon":{a=new mt({points:ff(n,r,5),isFilled:o});break}case"hexagon":{a=new mt({points:ff(n,r,6),isFilled:o});break}case"octagon":{a=new mt({points:ff(n,r,8),isFilled:o});break}case"ellipse":{a=new Y9({width:n,height:r,isFilled:o});break}case"oval":{a=new X9({width:n,height:r,isFilled:o});break}case"star":{const v=Ue/5/2,x=Math.floor(5/4)*2,b=10-x,E=0,I=Math.floor(5/2)*2,C=Math.cos(-Xe+x*v)*n/2,P=Math.cos(-Xe+b*v)*n/2,k=Math.sin(-Xe+E*v)*r/2,T=Math.sin(-Xe+I*v)*r/2,M=n-Math.abs(C-P),A=r-Math.abs(T-k),j=n/2+P-(n/2-C),R=r/2+k-(r/2-T),L=1,F=(n-j)/2,H=(r-R)/2,B=(n+M)/2,$=(r+A)/2,Q=B*L/2,Z=$*L/2;a=new mt({points:Array.from(Array(10)).map((ee,ne)=>{const N=-Xe+ne*v;return new w(F+(ne%2?Q:B)*Math.cos(N),H+(ne%2?Z:$)*Math.sin(N))}),isFilled:o});break}case"rhombus":{const g=Math.min(n*.38,r*.38);a=new mt({points:[new w(g,0),new w(n,0),new w(n-g,r),new w(0,r)],isFilled:o});break}case"rhombus-2":{const g=Math.min(n*.38,r*.38);a=new mt({points:[new w(0,0),new w(n-g,0),new w(n,r),new w(g,r)],isFilled:o});break}case"trapezoid":{const g=Math.min(n*.38,r*.38);a=new mt({points:[new w(g,0),new w(n-g,0),new w(n,r),new w(0,r)],isFilled:o});break}case"arrow-right":{const g=Math.min(n,r)*.38,v=r*.16;a=new mt({points:[new w(0,v),new w(n-g,v),new w(n-g,0),new w(n,r/2),new w(n-g,r),new w(n-g,r-v),new w(0,r-v)],isFilled:o});break}case"arrow-left":{const g=Math.min(n,r)*.38,v=r*.16;a=new mt({points:[new w(g,0),new w(g,v),new w(n,v),new w(n,r-v),new w(g,r-v),new w(g,r),new w(0,r/2)],isFilled:o});break}case"arrow-up":{const g=n*.16,v=Math.min(n,r)*.38;a=new mt({points:[new w(n/2,0),new w(n,v),new w(n-g,v),new w(n-g,r),new w(g,r),new w(g,v),new w(0,v)],isFilled:o});break}case"arrow-down":{const g=n*.16,v=Math.min(n,r)*.38;a=new mt({points:[new w(g,0),new w(n-g,0),new w(n-g,r-v),new w(n,r-v),new w(n/2,r),new w(0,r-v),new w(g,r-v)],isFilled:o});break}case"check-box":case"x-box":case"rectangle":{a=new us({width:n,height:r,isFilled:o});break}case"heart":{const v=yw(n,r).reduce((x,b)=>(x.push(...b.vertices),x),[]);a=new mt({points:v,isFilled:o});break}default:tn(e.props.geo)}const c=ml(this.editor,e),l=n/e.props.scale,d=r/e.props.scale,u=Math.min(100,l/2),p=Math.min(cs[e.props.size]*qt.lineHeight+Jn*2,d/2),f=Math.min(l,Math.max(c.w,Math.min(u,Math.max(1,l-8)))),m=Math.min(d,Math.max(c.h,Math.min(p,Math.max(1,d-8)))),y=Vx(e.props,At[e.props.size]*e.props.scale),S=y?y.map(g=>new No({points:g})):[];return new xr({children:[a,new us({x:e.props.align==="start"?0:e.props.align==="end"?(l-f)*e.props.scale:(l-f)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(d-m)*e.props.scale:(d-m)/2*e.props.scale,width:f*e.props.scale,height:m*e.props.scale,isFilled:!0,isLabel:!0}),...S]})}getHandleSnapGeometry(e){const n=this.getGeometry(e),r=n.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),n.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[n.bounds.center]};default:tn(e.props.geo)}}onEditEnd=e=>{const{id:n,type:r,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:s.trimEnd()}}])};component(e){const{id:n,type:r,props:s}=e,{fill:i,font:o,align:a,verticalAlign:c,size:l,text:d}=s,u=or(),p=this.editor.getEditingShapeId()!==null,f=X("isGeoOnlySelected",()=>e.id===this.editor.getOnlySelectedShapeId(),[]),m=p||e.props.text;return h.jsxs(h.Fragment,{children:[h.jsx(Ks,{id:n,children:h.jsx(DI,{shape:e,shouldScale:!0})}),m&&h.jsx(Ii,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+s.growY},children:h.jsx(Vd,{id:n,type:r,font:o,fontSize:cs[l]*e.props.scale,lineHeight:qt.lineHeight,padding:Jn*e.props.scale,fill:i,align:a,verticalAlign:c,text:d,isSelected:f,labelColor:u[s.labelColor].solid,wrap:!0})}),e.props.url&&h.jsx(xo,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:n,props:r}=e,{w:s,size:i}=r,o=r.h+r.growY,a=At[i],c=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?h.jsx("path",{d:CG(n,s,o,a)}):h.jsx("path",{d:c.getSvgPathData(!0)});case"heart":return h.jsx("path",{d:yD(s,o)});case"oval":return h.jsx("path",{d:c.getSvgPathData(!0)});case"cloud":return h.jsx("path",{d:Kx(s,o,n,i)});default:{const l=this.editor.getShapeGeometry(e),d=l instanceof xr?l.children[0].vertices:l.vertices;let u;if(r.dash==="draw"){const f=Gx(n,d,0,a*2*e.props.scale,1);u=Hx(f)}else u="M"+d[0]+"L"+d.slice(1)+"Z";const p=Vx(e.props,a);if(p)for(const[f,m]of p)u+=`M${f.x},${f.y}L${m.x},${m.y}`;return h.jsx("path",{d:u})}}}toSvg(e,n){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},s=r.props;n.addExportDef(hw(s.fill));let i;if(s.text){n.addExportDef(Gd(s.font));const o=ms(n),a=new ce(0,0,s.w,s.h+s.growY);i=h.jsx(Kd,{fontSize:cs[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:o[s.labelColor].solid,bounds:a,padding:16})}return h.jsxs(h.Fragment,{children:[h.jsx(DI,{shouldScale:!1,shape:r}),i]})}getCanvasSvgDefs(){return[pw()]}onResize=(e,{handle:n,newPoint:r,scaleX:s,scaleY:i,initialShape:o})=>{const a=o.props.w/o.props.scale,c=o.props.h/o.props.scale,l=o.props.growY/o.props.scale;let d=a*s,u=(c+l)*i,p=0,f=0;const m=LI;if(e.props.text.trim()){let b=Math.max(Math.abs(d),m),E=Math.max(Math.abs(u),m);b<m&&E===m&&(b=m),b===m&&E<m&&(E=m);const I=ml(this.editor,{...e,props:{...e.props,w:b*e.props.scale,h:E*e.props.scale}}),C=Math.max(Math.abs(d),I.w)*Math.sign(d),P=Math.max(Math.abs(u),I.h)*Math.sign(u);p=Math.abs(C)-Math.abs(d),f=Math.abs(P)-Math.abs(u),d=C,u=P}const y=d*e.props.scale,S=u*e.props.scale,g=new w(0,0);s<0&&(g.x+=y),(n==="left"||n==="top_left"||n==="bottom_left")&&(g.x+=s<0?p:-p),i<0&&(g.y+=S),(n==="top"||n==="top_left"||n==="top_right")&&(g.y+=i<0?f:-f);const{x:v,y:x}=g.rot(e.rotation).add(r);return{x:v,y:x,props:{w:Math.max(Math.abs(y),1),h:Math.max(Math.abs(S),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const n=e.props.h/e.props.scale,r=ml(this.editor,e).h;let s=null;if(r>n?s=r-n:e.props.growY&&(s=0),s!==null)return{...e,props:{...e.props,growY:s*e.props.scale}}};onBeforeUpdate=(e,n)=>{const r=e.props.text,s=n.props.text;if(r===s&&e.props.font===n.props.font&&e.props.size===n.props.size)return;if(r&&!s)return{...n,props:{...n.props,growY:0}};const i=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,c=ml(this.editor,n);if(!r&&s&&s.length===1){let d=Math.max(i,c.w),u=Math.max(o,c.h);const p=LI;return i<p&&o<p&&(d=Math.max(d,p),u=Math.max(u,p),d=Math.max(d,u),u=Math.max(d,u)),{...n,props:{...n.props,w:d*n.props.scale,h:u*n.props.scale,growY:0}}}let l=null;if(c.h>o?l=c.h-o:a&&(l=0),l!==null){const d=n.props.w/n.props.scale;return{...n,props:{...n.props,growY:l*n.props.scale,w:Math.max(d,c.w)*n.props.scale}}}if(c.w>i)return{...n,props:{...n.props,w:c.w*n.props.scale}}};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}}function ml(t,e){const{text:n,font:r,size:s,w:i}=e.props;if(!n)return{w:0,h:0};const o=t.textMeasure.measureText("w",{...qt,fontFamily:Lr[r],fontSize:cs[s],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},c=t.textMeasure.measureText(n,{...qt,fontFamily:Lr[r],fontSize:cs[s],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+a[s]),Math.ceil(i/e.props.scale-Jn*2))});return{w:c.w+Jn*2,h:c.h+Jn*2}}function RG(){const[t,e]=_.useState(!1);return _.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");e(r&&s.matches);const i=()=>e(r&&s.matches);return s.addEventListener("change",i),()=>s.removeEventListener("change",i)},[]),X(yt.forceSrgb)||!t?"srgb":"p3"}const NI=.35,FI=.82;class OG extends Qs{static type="highlight";static props=xR;static migrations=bR;hideResizeHandles=e=>yl(e);hideRotateHandle=e=>yl(e);hideSelectionBoundsFg=e=>yl(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const n=hi(e);if(yl(e))return new lw({x:-n/2,y:-n/2,radius:n/2,isFilled:!0});const{strokePoints:r,sw:s}=BI(e,n,!0),i=mw({strokeWidth:s,showAsComplete:!0});return qd(r,i),new mt({points:dw(r,i),isFilled:!0})}component(e){const n=Nf(this.editor,e),r=hi(e);return h.jsx(Ks,{id:e.id,children:h.jsx(Sl,{shape:e,forceSolid:n,strokeWidth:r,opacity:NI})})}backgroundComponent(e){const n=Nf(this.editor,e),r=hi(e);return h.jsx(Ks,{id:e.id,children:h.jsx(Sl,{shape:e,forceSolid:n,strokeWidth:r,opacity:FI})})}indicator(e){const n=Nf(this.editor,e),r=hi(e),{strokePoints:s,sw:i}=BI(e,r,n),o=bo(e.props.segments);let a;return s.length<2?a=LG(o[0],i):a=Pi(s,!1),h.jsx("path",{d:a})}toSvg(e){const n=hi(e),r=n<1.5,s=1/e.props.scale;return h.jsx("g",{transform:`scale(${s})`,children:h.jsx(Sl,{forceSolid:r,strokeWidth:n,shape:e,opacity:NI})})}toBackgroundSvg(e){const n=hi(e),r=n<1.5,s=1/e.props.scale;return h.jsx("g",{transform:`scale(${s})`,children:h.jsx(Sl,{forceSolid:r,strokeWidth:n,shape:e,opacity:FI})})}onResize=(e,n)=>{const{scaleX:r,scaleY:s}=n,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map(({x:a,y:c,z:l})=>({x:r*a,y:s*c,z:l}))});return{props:{segments:i}}}}function DG(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function LG(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function BI(t,e,n){const r=bo(t.props.segments),s=t.props.isComplete||Bt(t.props.segments)?.type==="straight";let i=e;!n&&!t.props.isPen&&r.length===1&&(i+=wr(t.id)()*(e/6));const o=mw({strokeWidth:i,showAsComplete:s});return{strokePoints:$r(r,o),sw:i}}function hi(t){return vo[t.props.size]*1.12*t.props.scale}function yl(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function Sl({strokeWidth:t,forceSolid:e,shape:n,opacity:r}){const s=or(),i=bo(n.props.segments);let o=t;!e&&!n.props.isPen&&i.length===1&&(o+=wr(n.id)()*(o/6));const a=mw({strokeWidth:o,showAsComplete:n.props.isComplete||Bt(n.props.segments)?.type==="straight"}),c=$r(i,a),l=c.length>1?Pi(c,!1):DG(n.props.segments[0].points[0]),d=RG(),u=s[n.props.color].highlight[d];return h.jsx("path",{d:l,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:u,strokeWidth:o,opacity:r})}function Nf(t,e){return X("forceSolid",()=>{const n=hi(e),r=t.getZoomLevel();return n/r<1.5},[t])}function SD(){return h.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[h.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),h.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),h.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function vD(t,e,n){const r=K(),[s,i]=_.useState(null),o=e?r.getAsset(e):null,c=r.getCulledShapes().has(t),l=_.useRef(!1);_.useEffect(()=>{s&&(l.current=!0)},[s]);const d=o&&"w"in o.props?n/o.props.w:1,u=X("zoom level",()=>r.getZoomLevel()*d,[r,d]);return _.useEffect(()=>{if(c)return;let p=!1;const f=r.timers.setTimeout(async()=>{const m=await r.resolveAssetUrl(e,{screenScale:u});p||i(m)},l.current?500:0);return()=>{clearTimeout(f),p=!0}},[e,o?.props.src,c,u,r]),{asset:o,url:s}}function xD(){const[t,e]=_.useState(!1);return _.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),t}async function NG(t){const n=await(await Nr(t)).blob();return yi.blobToDataUrl(n)}class FG extends Fo{static type="image";static props=wR;static migrations=CR;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize=(e,n)=>{let r=aw(e,n);const{flipX:s,flipY:i}=n.initialShape.props;return r={...r,props:{...r.props,flipX:n.scaleX<0!==s,flipY:n.scaleY<0!==i}},r};isAnimated(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return n?"mimeType"in n.props&&Ar.isAnimatedImageType(n?.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated:!1}component(e){const n=this.editor.getCroppingShapeId()===e.id,r=xD(),[s,i]=_.useState(""),[o,a]=_.useState(""),c=e.id===this.editor.getOnlySelectedShapeId(),{asset:l,url:d}=vD(e.id,e.props.assetId,e.props.w);if(_.useEffect(()=>{if(d){let m=!1;const y=mo();return y.onload=()=>{m||a(d)},y.src=d,()=>{m=!0}}},[d,e]),_.useEffect(()=>{if(d&&this.isAnimated(e)){let m=!1;const y=mo();return y.onload=()=>{if(m)return;const S=document.createElement("canvas");S.width=y.width,S.height=y.height;const g=S.getContext("2d");g&&(g.drawImage(y,0,0),i(S.toDataURL()),a(d))},y.crossOrigin="anonymous",y.src=d,()=>{m=!0}}},[r,d,e]),l?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");const u=c&&n&&this.editor.isIn("select.crop"),p=r&&(l?.props.mimeType?.includes("video")||this.isAnimated(e)),f=$I(e);return l?.props.src?o?h.jsxs(h.Fragment,{children:[u&&h.jsx("div",{style:f,children:h.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||p?s:o,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),h.jsxs(Ii,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[h.jsxs("div",{className:"tl-image-container",style:f,children:[h.jsx("img",{className:be("tl-image",{"tl-flip-x":e.props.flipX&&!e.props.flipY,"tl-flip-y":e.props.flipY&&!e.props.flipX,"tl-flip-xy":e.props.flipY&&e.props.flipX}),crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||p?s:o,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(e)&&!e.props.playing&&h.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),e.props.url&&h.jsx(xo,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:h.jsxs(Ii,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:l?"transparent":"var(--color-low)",border:l?"none":"1px solid var(--color-low-border)"},children:[h.jsx("div",{className:"tl-image-container",style:f,children:l?null:h.jsx(SD,{})}),"url"in e.props&&e.props.url&&h.jsx(xo,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:h.jsx("rect",{width:G(e.props.w),height:G(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!r)return null;(r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await NG(r)||"");const s=$I(e),i=e.props.crop;if(s.transform&&i){const{transform:o,width:a,height:c}=s,l=(i.bottomRight.x-i.topLeft.x)*a,d=(i.bottomRight.y-i.topLeft.y)*c,u=[new w(0,0),new w(l,0),new w(l,d),new w(0,d)],p=`cropClipPath_${e.id.replace(":","_")}`;return h.jsxs(h.Fragment,{children:[h.jsx("defs",{children:h.jsx("clipPath",{id:p,children:h.jsx("polygon",{points:u.map(f=>`${f.x},${f.y}`).join(" ")})})}),h.jsx("g",{clipPath:`url(#${p})`,children:h.jsx("image",{href:r,width:a,height:c,style:{transform:o}})})]})}else return h.jsx("image",{href:r,width:e.props.w,height:e.props.h})}onDoubleClick=e=>{const n=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;!n||!(n.props.src&&this.isAnimated(e))||this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{const n=e.props;if(!n||this.editor.getCroppingShapeId()!==e.id)return;const r=Ye(n.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},s=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,o=new w(r.topLeft.x*s,r.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:s,h:i}};this.editor.updateShapes([a])}}function $I(t){const e=t.props.crop,n=e?.topLeft;if(!n)return{width:t.props.w,height:t.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*t.props.w,s=1/(e.bottomRight.y-e.topLeft.y)*t.props.h,i=-n.x*r,o=-n.y*s;return{transform:`translate(${i}px, ${o}px)`,width:r,height:s}}function bD(t){return{size:t,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function wD(t,e,n){const r=e.vertices,s=bD(n);return $r(r,s)}function BG(t,e,n){const r=bD(n);return dw(qd(wD(t,e,n),r),r)}function $G(t,e,n){const r=BG(t,e,n);return Wb(r)}function zG(t,e,n){if(t.props.dash==="draw"){const r=wD(t,e,n);return Pi(r)}return e.getSvgPathData()}function CD(t,e,n){let r=`M ${Be(e[0])}L`,s=`M ${Be(e[0])}L`;const i=n/3,o=n*2,a=wr(t);let c=e[0],l,d=e[0],u;const p=e.length;for(let f=0,m=p-1;f<m;f++){l=e[f+1],u=w.AddXY(e[f+1],a()*i,a()*i);const y=w.Sub(l,c),S=w.Len(y),g=w.Div(y,S).mul(Math.min(S/4,o)),v=w.Add(c,g),x=w.Add(l,g.neg()),b=w.Sub(u,d),E=w.Len(b),I=w.Div(b,E).mul(Math.min(E/4,o)),C=w.Add(d,I),P=w.Add(u,I.neg());f===m-1?(r+=`${Be(v)}L ${Be(l)}`,s+=`${Be(C)}L ${Be(u)}`):(r+=`${Be(v)}L ${Be(x)}Q ${Be(l)}`,s+=`${Be(C)}L ${Be(P)}Q ${Be(u)}`,c=l,d=u)}return[r,r+s]}const UG=new ls;class qG extends Qs{static type="line";static props=_R;static migrations=IR;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){const[e,n]=Ga(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[n]:{id:n,index:n,x:.1,y:.1}},scale:1}}getGeometry(e){return Ia(e)}getHandles(e){return UG.get(e.props,()=>{const n=Ia(e),r=_a(e),s=r.map(i=>({...i,id:i.index,type:"vertex",canSnap:!0}));for(let i=0;i<r.length-1;i++){const o=Ha(r[i].index,r[i+1].index),c=n.segments[i].midPoint();s.push({id:o,type:"create",index:o,x:c.x,y:c.y,canSnap:!0})}return s.sort(en)})}onResize=(e,n)=>{const{scaleX:r,scaleY:s}=n;return{props:{points:fc(e.props.points,(i,{id:o,index:a,x:c,y:l})=>({id:o,index:a,x:c*r,y:l*s}))}}};onHandleDrag=(e,{handle:n})=>{if(n.type==="vertex")return{...e,props:{...e.props,points:{...e.props.points,[n.id]:{id:n.id,index:n.index,x:n.x,y:n.y}}}}};component(e){return h.jsx(Ks,{id:e.id,children:h.jsx(zI,{shape:e})})}indicator(e){const n=At[e.props.size]*e.props.scale,r=Ia(e),{dash:s}=e.props;let i;if(e.props.spline==="line"){const o=r.points;if(s==="solid"||s==="dotted"||s==="dashed")i="M"+o[0]+"L"+o.slice(1);else{const[a]=CD(e.id,o,n);i=a}}else i=zG(e,r,n);return h.jsx("path",{d:i})}toSvg(e){return h.jsx(zI,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const n=_a(e);return{points:n,getSelfSnapPoints:r=>{const s=this.getHandles(e).filter(i=>i.type==="vertex").findIndex(i=>i.id===r.id);return n.filter((i,o)=>Math.abs(o-s)>1).map(w.From)},getSelfSnapOutline:r=>{const s=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id),i=Ia(e).segments.filter((o,a)=>a!==s-1&&a!==s);return i.length?new xr({children:i}):null}}}getInterpolatedProps(e,n,r){const s=_a(e),i=_a(n),o=[],a=[];let c=Rj;if(s.length>i.length)for(let l=0;l<s.length;l++)o[l]={...s[l]},i[l]===void 0?a[l]={...i[i.length-1],id:c}:a[l]={...i[l],id:c},c=fr(c);else if(i.length>s.length)for(let l=0;l<i.length;l++)a[l]={...i[l]},s[l]===void 0?o[l]={...s[s.length-1],id:c}:o[l]={...s[l],id:c},c=fr(c);else for(let l=0;l<i.length;l++)o[l]=s[l],a[l]=i[l];return{...n.props,points:Object.fromEntries(o.map((l,d)=>{const u=a[d];return[l.id,{...l,x:xn(l.x,u.x,r),y:xn(l.y,u.y,r)}]}))}}}function _a(t){return Object.values(t.props.points).sort(en)}function Ia(t){const e=_a(t).map(w.From);switch(t.props.spline){case"cubic":return new W9({points:e});case"line":return new No({points:e})}}function zI({shape:t,shouldScale:e=!1}){const n=or(),r=Ia(t),{dash:s,color:i,size:o}=t.props,a=1/t.props.scale,c=e?a:1,l=At[o]*t.props.scale;if(t.props.spline==="line"){if(s==="solid"){const d=r.points,u="M"+d[0]+"L"+d.slice(1);return h.jsx("path",{d:u,stroke:n[i].solid,strokeWidth:l,fill:"none",transform:`scale(${c})`})}if(s==="dashed"||s==="dotted")return h.jsx("g",{stroke:n[i].solid,strokeWidth:l,transform:`scale(${c})`,children:r.segments.map((d,u)=>{const{strokeDasharray:p,strokeDashoffset:f}=Tr(d.length,l,{style:s,start:u>0?"outset":"none",end:u<r.segments.length-1?"outset":"none"});return h.jsx("path",{strokeDasharray:p,strokeDashoffset:f,d:d.getSvgPathData(!0),fill:"none"},u)})});if(s==="draw"){const d=r.points,[u,p]=CD(t.id,d,l);return h.jsx("path",{d:p,stroke:n[i].solid,strokeWidth:l,fill:"none",transform:`scale(${c})`})}}if(t.props.spline==="cubic"){const d=r.getSvgPathData();if(s==="solid")return h.jsx("path",{strokeWidth:l,stroke:n[i].solid,fill:"none",d,transform:`scale(${c})`});if(s==="dashed"||s==="dotted")return h.jsx("g",{stroke:n[i].solid,strokeWidth:l,transform:`scale(${c})`,children:r.segments.map((u,p)=>{const{strokeDasharray:f,strokeDashoffset:m}=Tr(u.length,l,{style:s,start:p>0?"outset":"none",end:p<r.segments.length-1?"outset":"none"});return h.jsx("path",{strokeDasharray:f,strokeDashoffset:m,d:u.getSvgPathData(),fill:"none"},p)})});if(s==="draw")return h.jsx("path",{d:$G(t,r,l),strokeWidth:1,stroke:n[i].solid,fill:n[i].solid,transform:`scale(${c})`})}}const _D=_.createContext(null);function HG({assetUrls:t,children:e}){return _.useEffect(()=>{for(const n of Object.values(t.icons)){const r=mo();r.src=n,r.decode()}for(const n of Object.values(t.embedIcons)){const r=mo();r.src=n,r.decode()}},[t]),h.jsx(_D.Provider,{value:t,children:e})}function Sw(){const t=_.useContext(_D);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const Wx={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},GG=new Set(["ar","fa","he","ur","ku"]),Yi={locale:"en",label:"English",messages:Wx,dir:"ltr"};async function KG(t,e){if(!(await Nr(e.translations.en)).ok)return console.warn("No main translations found."),Yi;if(t==="en")return Yi;const r=Va.find(o=>o.locale===t);if(!r)return console.warn(`No translation found for locale ${t}`),Yi;const i=await(await Nr(e.translations[r.locale])).json();if(!i)return console.warn(`No messages found for locale ${t}`),Yi;for(const o in Yi.messages)i[o];return{locale:t,label:r.label,dir:GG.has(r.locale)?"rtl":"ltr",messages:{...Yi.messages,...i}}}const ID=_.createContext(null);function PD(){const t=_.useContext(ID);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}const VG=Ot(function({overrides:e,children:n}){const s=K().user.getLocale(),i=Sw(),[o,a]=_.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...Wx,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:Wx});return _.useEffect(()=>{let c=!1;async function l(){const d=await KG(s,i);d&&!c&&(e&&e[s]?a({...d,messages:{...d.messages,...e[s]}}):a(d))}return l(),()=>{c=!0}},[i,s,e]),h.jsx(ID.Provider,{value:o,children:n})});function Re(){const t=PD();return _.useCallback(function(n){return t.messages[n]??n},[t])}class WG extends Qs{static type="note";static props=PR;static migrations=ER;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!1;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:n,labelWidth:r}=ED(this.editor,e),{scale:s}=e.props,i=n*s,o=r*s,a=Ge*s,c=vl(e);return new xr({children:[new us({width:a,height:c,isFilled:!0}),new us({x:e.props.align==="start"?0:e.props.align==="end"?a-o:(a-o)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?c-i:(c-i)/2,width:o,height:i,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:n}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*n<.25)return[];const i=vl(e),o=Ge*n,a=lH/s*n;return s*n<.5?[{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a}]:[{id:"top",index:"a1",type:"clone",x:o/2,y:-a},{id:"right",index:"a2",type:"clone",x:o+a,y:i/2},{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a},{id:"left",index:"a4",type:"clone",x:-a,y:i/2}]}component(e){const{id:n,type:r,props:{scale:s,color:i,font:o,size:a,align:c,text:l,verticalAlign:d,fontSizeAdjustment:u}}=e,p=ZG(n),f=or(),m=Ge*s,y=vl(e),S=X("shape rotation",()=>this.editor.getShapePageTransform(n)?.rotation()??0,[this.editor]),g=X("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),v=e.id===this.editor.getOnlySelectedShapeId();return h.jsxs(h.Fragment,{children:[h.jsx("div",{id:n,className:"tl-note__container",style:{width:m,height:y,backgroundColor:f[i].note.fill,borderBottom:g?`${3*s}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:g?"none":QG(e.id,S,s)},children:h.jsx(Vd,{id:n,type:r,font:o,fontSize:(u||cs[a])*s,lineHeight:qt.lineHeight,align:c,verticalAlign:d,text:l,isNote:!0,isSelected:v,labelColor:f[i].note.text,wrap:!0,padding:16*s,onKeyDown:p})}),"url"in e.props&&e.props.url&&h.jsx(xo,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{scale:n}=e.props;return h.jsx("rect",{rx:n,width:G(Ge*n),height:G(vl(e))})}toSvg(e,n){e.props.text&&n.addExportDef(Gd(e.props.font));const r=ms({isDarkMode:n.isDarkMode}),s=JG(e);return h.jsxs(h.Fragment,{children:[h.jsx("rect",{x:5,y:5,rx:1,width:Ge-10,height:s.h,fill:"rgba(0,0,0,.1)"}),h.jsx("rect",{rx:1,width:Ge,height:s.h,fill:r[e.props.color].note.fill}),h.jsx(Kd,{fontSize:e.props.fontSizeAdjustment||cs[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:s,stroke:!1})]})}onBeforeCreate=e=>UI(this.editor,e);onBeforeUpdate=(e,n)=>{if(!(e.props.text===n.props.text&&e.props.font===n.props.font&&e.props.size===n.props.size))return UI(this.editor,n)};onEditEnd=e=>{const{id:n,type:r,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:s.trimEnd()}}])}}function UI(t,e){const{labelHeight:n,fontSizeAdjustment:r}=ED(t,e),s=Math.max(0,n-Ge);if(s!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:s,fontSizeAdjustment:r}}}function YG(t,e){const{text:n}=e.props;if(!n)return{labelHeight:cs[e.props.size]*qt.lineHeight+Jn*2,labelWidth:100,fontSizeAdjustment:0};const r=cs[e.props.size];let s=0,i=0,o=Ge,a=Ge;const c=1;do{s=Math.min(r,r-i);const l=t.textMeasure.measureText(n,{...qt,fontFamily:Lr[e.props.font],fontSize:s,maxWidth:Ge-Jn*2-c,disableOverflowWrapBreaking:!0});if(o=l.h+Jn*2,a=l.w+Jn*2,s<=14){const d=t.textMeasure.measureText(n,{...qt,fontFamily:Lr[e.props.font],fontSize:s,maxWidth:Ge-Jn*2-c});o=d.h+Jn*2,a=d.w+Jn*2;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(i++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:s}}const XG=new ls;function ED(t,e){return XG.get(e,()=>YG(t,e))}function ZG(t){const e=K(),n=PD();return _.useCallback(r=>{const s=e.getShape(t);if(!s)return;const i=r.key==="Tab",o=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(i||o){r.preventDefault();const a=e.getShapePageTransform(t),c=a.rotation(),l=!!(n.dir==="rtl"||ZO(s.props.text)),d=(Ge+e.options.adjacentShapeMargin+(o&&!r.shiftKey?s.props.growY:0))*s.props.scale,u=new w(i?r.shiftKey!=l?-1:1:0,o?r.shiftKey?-1:1:0).mul(d).add(Hd.clone().mul(s.props.scale)).rot(c).add(a.point()),p=oD(e,s,u,c);p&&(e.mark("editing adjacent shape"),cd(e,p,!0))}},[t,e,n.dir])}function vl(t){return(Ge+t.props.growY)*t.props.scale}function QG(t,e,n){const r=wr(t),s=Math.abs(r())+.5,i=Math.cos(e),o=5*n,a=4*n,c=6*n,l=7*n;return`0px ${o-s}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+s*l)*Math.max(0,i)}px ${c+s*l}px -${a+s*c}px rgba(15, 23, 31, ${(.3+s*.1).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+i)/2)).toFixed(2)})`}function JG(t){return new ce(0,0,Ge,Ge+t.props.growY)}function eK(t,{initialBounds:e,scaleX:n,scaleY:r,newPoint:s}){const i=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),o=new w(0,0);n<0&&(o.x=-(e.width*i)),r<0&&(o.y=-(e.height*i));const{x:a,y:c}=w.Add(s,o.rot(t.rotation));return{x:a,y:c,props:{scale:i*t.props.scale}}}const tK=new ls;class nK extends Qs{static type="text";static props=kR;static migrations=TR;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return tK.get(e.props,n=>qI(this.editor,n))}getGeometry(e){const{scale:n}=e.props,{width:r,height:s}=this.getMinDimensions(e);return new us({width:r*n,height:s*n,isFilled:!0,isLabel:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){const{id:n,props:{font:r,size:s,text:i,color:o,scale:a,textAlign:c}}=e,{width:l,height:d}=this.getMinDimensions(e),u=e.id===this.editor.getOnlySelectedShapeId(),p=or(),f=rK(n);return h.jsx(Vd,{id:n,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:vo[s],lineHeight:qt.lineHeight,align:c,verticalAlign:"middle",text:i,labelColor:p[o].solid,isSelected:u,textWidth:l,textHeight:d,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:f})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds,r=K();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:h.jsx("rect",{width:G(n.width),height:G(n.height)})}toSvg(e,n){e.props.text&&n.addExportDef(Gd(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,s=r.width/(e.props.scale??1),i=r.height/(e.props.scale??1),o=ms(n);return h.jsx(Kd,{fontSize:vo[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:o[e.props.color].solid,bounds:new ce(0,0,s,i),padding:0})}onResize=(e,n)=>{const{newPoint:r,initialBounds:s,initialShape:i,scaleX:o,handle:a}=n;if(n.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...eK(e,n)};{const c=Math.max(1,Math.abs(s.width*o)),{x:l,y:d}=o<0?w.Sub(r,w.FromAngle(e.rotation).mul(c)):r;return{id:e.id,type:e.type,x:l,y:d,props:{w:c/i.props.scale,autoSize:!1}}}};onEditEnd=e=>{const{id:n,type:r,props:{text:s}}=e,i=e.props.text.trimEnd();i.length===0?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:s.trimEnd()}}])};onBeforeUpdate=(e,n)=>{if(!n.props.autoSize)return;const r=e.props.size!==n.props.size||e.props.textAlign!==n.props.textAlign||e.props.font!==n.props.font||e.props.scale!==1&&n.props.scale===1,s=e.props.text!==n.props.text;if(!r&&!s)return;const i=this.getMinDimensions(e),o=qI(this.editor,n.props),a=i.width*e.props.scale,c=i.height*e.props.scale,l=o.width*n.props.scale,d=o.height*n.props.scale;let u;switch(n.props.textAlign){case"middle":{u=new w((l-a)/2,s?0:(d-c)/2);break}case"end":{u=new w(l-a,s?0:(d-c)/2);break}default:{if(s)break;u=new w(0,(d-c)/2);break}}if(u){u.rot(n.rotation);const{x:p,y:f}=n;return{...n,x:p-u.x,y:f-u.y,props:{...n.props,w:l}}}else return{...n,props:{...n.props,w:l}}}}function qI(t,e){const{font:n,text:r,autoSize:s,size:i,w:o}=e,a=s?16:Math.max(16,o),c=vo[i],l=s?null:Math.floor(Math.max(a,o)),d=t.textMeasure.measureText(r,{...qt,fontFamily:Lr[n],fontSize:c,maxWidth:l});return s&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(c,d.h)}}function rK(t){const e=K();return _.useCallback(n=>{if(e.getEditingShapeId()===t)switch(n.key){case"Enter":{(n.ctrlKey||n.metaKey)&&e.complete();break}case"Tab":{Le(n),n.shiftKey?Nt.unindent(n.currentTarget):Nt.indent(n.currentTarget);break}}},[e,t])}class sK extends Fo{static type="video";static props=MR;static migrations=AR;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:n}=this,r=n.getShapeGeometry(e).bounds.w*n.getZoomLevel()>=110,{asset:s,url:i}=vD(e.id,e.props.assetId,e.props.w),{time:o,playing:a}=e.props,c=Ud(e.id),l=xD(),d=_.useRef(null),u=_.useCallback(g=>{const v=g.currentTarget;v&&n.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:v.currentTime}}])},[e.id,n]),p=_.useCallback(g=>{const v=g.currentTarget;v&&n.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:v.currentTime}}])},[e.id,n]),f=_.useCallback(g=>{const v=g.currentTarget;v&&c&&n.updateShapes([{type:"video",id:e.id,props:{time:v.currentTime}}])},[c,e.id,n]),[m,y]=_.useState(!1),S=_.useCallback(g=>{const v=g.currentTarget;v&&(o!==v.currentTime&&(v.currentTime=o),a||v.pause(),y(!0))},[a,o]);return _.useEffect(()=>{const g=d.current;g&&(m&&!c&&o!==g.currentTime&&(g.currentTime=o),c&&document.activeElement!==g&&g.focus())},[c,m,o]),_.useEffect(()=>{if(l){const g=d.current;if(!g)return;g.pause(),g.currentTime=0}},[d,l]),h.jsxs(h.Fragment,{children:[h.jsx(Ii,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:s?"transparent":"var(--color-low)",border:s?"none":"1px solid var(--color-low-border)"},children:h.jsx("div",{className:"tl-counter-scaled",children:h.jsx("div",{className:"tl-video-container",children:s?.props.src?i?h.jsx("video",{ref:d,style:c?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:c&&r,onPlay:u,onPause:p,onTimeUpdate:f,onLoadedData:S,hidden:!m,children:h.jsx("source",{src:i})}):null:h.jsx(SD,{})})})}),"url"in e.props&&e.props.url&&h.jsx(xo,{url:e.props.url,zoomLevel:n.getZoomLevel()})]})}indicator(e){return h.jsx("rect",{width:G(e.props.w),height:G(e.props.h)})}toSvg(e){return h.jsx("image",{href:iK(e.id),width:e.props.w,height:e.props.h})}}function iK(t){const e=t.split(":")[1],n=document.querySelector(`.tl-video-shape-${e}`);if(n){const r=document.createElement("canvas");return r.width=n.videoWidth,r.height=n.videoHeight,r.getContext("2d").drawImage(n,0,0),r.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const kD=[nK,JH,hG,jG,WG,qG,vG,GH,OG,gG,FG,sK];function oK(t){return t.sideEffects.register({instance_page_state:{afterChange:(e,n)=>{if(e.croppingShapeId!==n.croppingShapeId){const r=t.isIn("select.crop");!e.croppingShapeId&&n.croppingShapeId?r||t.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!n.croppingShapeId&&r&&t.setCurrentTool("select.idle")}e.editingShapeId!==n.editingShapeId&&(!e.editingShapeId&&n.editingShapeId?t.isIn("select.editing_shape")||t.setCurrentTool("select.editing_shape"):e.editingShapeId&&!n.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle"))}}})}class aK extends Se{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:n}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const i=this.editor.getPointInShapeSpace(s,n);return this.editor.getShapeGeometry(s).bounds.containsPoint(i)}return!1}).map(s=>s.id));const r=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=r.id,this.update()};pushPointToScribble=()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){const{editor:e,excludedShapeIds:n}=this,r=e.getErasingShapeIds(),s=e.getZoomLevel(),i=e.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:a}}=e;this.pushPointToScribble();const c=new Set(r),l=this.editor.options.hitTestMargin/s;for(const d of i){if(e.isShapeOfType(d,"group"))continue;const u=e.getShapeMask(d.id);if(u&&!Bn(o,u))continue;const p=e.getShapeGeometry(d),f=e.getShapePageTransform(d);if(!p||!f)continue;const m=f.clone().invert(),y=m.applyToPoint(a),S=m.applyToPoint(o),{bounds:g}=p;g.minX-l>Math.max(y.x,S.x)||g.minY-l>Math.max(y.y,S.y)||g.maxX+l<Math.min(y.x,S.x)||g.maxY+l<Math.min(y.y,S.y)||p.hitTestLineSegment(y,S,l)&&c.add(e.getOutermostSelectableShape(d).id)}this.editor.setErasingShapes([...c].filter(d=>!n.has(d)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}let cK=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}},lK=class extends Se{static id="pointing";onEnter=()=>{const e=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,s=new Set,i=s.size;for(let o=n.length,a=o-1;a>=0;a--){const c=n[a];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const l=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(l,"frame")&&s.size>i)break;s.add(l.id)}}this.editor.setErasingShapes([...s])};onLongPress=e=>{this.startErasing(e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startErasing(e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}};class dK extends Se{static id="eraser";static initial="idle";static isLockable=!1;static children=()=>[cK,lK,aK];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class uK extends Se{static id="dragging";initialCamera=new w;onEnter=()=>{this.initialCamera=w.From(this.editor.getCamera()),this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.parent.transition("idle")};onComplete=()=>{this.complete()};update(){const{initialCamera:e,editor:n}=this,{currentScreenPoint:r,originScreenPoint:s}=n.inputs,i=w.Sub(r,s).div(n.getZoomLevel());i.len2()!==0&&n.setCamera(e.clone().add(i))}complete(){const{editor:e}=this,{pointerVelocity:n}=e.inputs,r=Math.min(n.len(),2);r>.1&&this.editor.slideCamera({speed:r,direction:n}),this.parent.transition("idle")}}let hK=class extends Se{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}},pK=class extends Se{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})};onLongPress=()=>{this.startDragging()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startDragging()};startDragging(){this.parent.transition("dragging")}onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle")}};class fK extends Se{static id="hand";static initial="idle";static isLockable=!1;static children=()=>[hK,pK,uK];onDoubleClick=e=>{if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomIn(n,{animation:{duration:220,easing:Mt.easeOutQuint}})}};onTripleClick=e=>{if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomOut(n,{animation:{duration:320,easing:Mt.easeOutQuint}})}};onQuadrupleClick=e=>{if(e.phase==="settle"){const n=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;n===1?this.editor.zoomToFit({animation:{duration:400,easing:Mt.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Mt.easeOutQuint}})}}}let gK=class extends Se{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}};class mK extends Se{static id="lasering";scribbleId="id";onEnter=()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};pushPointToScribble=()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class yK extends Se{static id="laser";static initial="idle";static children=()=>[gK,mK];static isLockable=!1;onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class SK extends Se{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;initialStartShape=null;onEnter=e=>{const{altKey:n,currentPagePoint:r}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),n){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(r)[0],this.hitTestShapes()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=({elapsed:e})=>{const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:n,isWrapMode:r}=this,{inputs:{originPagePoint:s,currentPagePoint:i,shiftKey:o,ctrlKey:a}}=e,c=new Set(o?this.initialSelectedShapeIds:[]),l=r?!a:a,d=ce.FromPoints([s,i]),{corners:u}=d;let p,f,m,y,S,g;const v=e.getCurrentPageShapes(),x=e.getCurrentPageId();e:for(let I=0,C=v.length;I<C;I++){if(m=v[I],n.has(m.id)||c.has(m.id)||(y=e.getShapePageBounds(m),!y))continue e;if(d.contains(y)){this.handleHit(m,i,x,c,u);continue e}if(l||e.isShapeOfType(m,"frame"))continue e;if(d.collides(y)){if(S=e.getShapePageTransform(m),!S)continue e;g=S.clone().invert().applyToPoints(u);const P=e.getShapeGeometry(m);t:for(let k=0;k<4;k++)if(p=g[k],f=g[(k+1)%4],P.hitTestLineSegment(p,f,0)){this.handleHit(m,i,x,c,u);break t}}}e.getInstanceState().isCoarsePointer;const b=e.getInstanceState().brush;(!b||!d.equals(b))&&e.updateInstanceState({brush:{...d.toJson()}});const E=e.getSelectedShapeIds();(E.length!==c.size||E.some(I=>!c.has(I)))&&e.setSelectedShapes(Array.from(c))}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,n,r,s,i){if(e.parentId===r){s.add(e.id);return}const o=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(o.id);a&&!CO(a,i)&&!Bn(n,a)||s.add(o.id)}}const wo={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class vK extends Se{static id="pointing_resize_handle";info={};updateCursor(){const e=this.editor.getSelectedShapes(),n=wo[this.info.handle];this.editor.setCursor({type:n,rotation:e.length===1?this.editor.getSelectionRotation():0})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startResizing()};onLongPress=()=>{this.startResizing()};startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}const Zn=8;class TD extends Se{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const n=wo[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){const{shape:e,cursorHandleOffset:n}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;const s=e.props,i=this.editor.inputs.currentPagePoint.clone().sub(n),o=this.editor.inputs.originPagePoint.clone().sub(n),a=i.clone().sub(o).rot(-e.rotation),c=s.crop??this.getDefaultCrop(),l=Ye(c),d=new w(e.x,e.y),u=new w(0,0),p=1/(c.bottomRight.x-c.topLeft.x)*s.w,f=1/(c.bottomRight.y-c.topLeft.y)*s.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(f<Zn)break;m=!0,l.topLeft.y=l.topLeft.y+a.y/f,f*(l.bottomRight.y-l.topLeft.y)<Zn?(l.topLeft.y=l.bottomRight.y-Zn/f,u.y=(l.topLeft.y-c.topLeft.y)*f):l.topLeft.y<=0?(l.topLeft.y=0,u.y=(l.topLeft.y-c.topLeft.y)*f):u.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(f<Zn)break;m=!0,l.bottomRight.y=Math.min(1,l.bottomRight.y+a.y/f),f*(l.bottomRight.y-l.topLeft.y)<Zn&&(l.bottomRight.y=l.topLeft.y+Zn/f);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(p<Zn)break;m=!0,l.topLeft.x=l.topLeft.x+a.x/p,p*(l.bottomRight.x-l.topLeft.x)<Zn?(l.topLeft.x=l.bottomRight.x-Zn/p,u.x=(l.topLeft.x-c.topLeft.x)*p):l.topLeft.x<=0?(l.topLeft.x=0,u.x=(l.topLeft.x-c.topLeft.x)*p):u.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(p<Zn)break;m=!0,l.bottomRight.x=Math.min(1,l.bottomRight.x+a.x/p),p*(l.bottomRight.x-l.topLeft.x)<Zn&&(l.bottomRight.x=l.topLeft.x+Zn/p);break}}if(!m)return;d.add(u.rot(e.rotation));const y={id:e.id,type:e.type,x:d.x,y:d.y,props:{crop:l,w:(l.bottomRight.x-l.topLeft.x)*p,h:(l.bottomRight.y-l.topLeft.y)*f}};this.editor.updateShapes([y]),this.updateCursor()}complete(){this.updateShapes(),Ve(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,r=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),i=w.RotWith(s.getHandlePoint(this.info.handle),s.point,e),o=w.Sub(n,i);return{shape:r,cursorHandleOffset:o}}}function MD(t,e=!1){const n=t.getZoomLevel(),{inputs:{currentPagePoint:r}}=t;return t.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:t.options.hitTestMargin/n,renderingOnly:!0})??t.getSelectedShapeAtPoint(r)}function AD(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const s=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;s==="x"?n.x=0:s==="y"&&(n.y=0),n.rot(-e.rotation);const i=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,o=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,l=Ye(r);return l.topLeft.x=Math.min(1-c,Math.max(0,l.topLeft.x-n.x/i)),l.topLeft.y=Math.min(1-a,Math.max(0,l.topLeft.y-n.y/o)),l.bottomRight.x=l.topLeft.x+c,l.bottomRight.y=l.topLeft.y+a,{id:e.id,type:e.type,props:{crop:l}}}let xK=class extends Se{static id="idle";onEnter=()=>{this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const n=MD(this.editor);if(n&&!this.editor.isShapeOfType(n,"group")){this.onPointerDown({...e,shape:n,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||e.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const r=this.editor.getShape(n);if(!r)return;const s=this.editor.getShapeUtil(r);if(s){if(e.target==="selection"){s.onDoubleClickEdge?.(r);return}this.cancel(),this.editor.root.handleEvent(e)}};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),s=new w(0,0);if(n.has("ArrowLeft")&&(s.x+=1),n.has("ArrowRight")&&(s.x-=1),n.has("ArrowUp")&&(s.y+=1),n.has("ArrowDown")&&(s.y-=1),s.equals(new w(0,0)))return;r&&s.mul(10);const i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;const o=AD(this.editor,i,s);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}};class bK extends Se{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}}class jD extends Se{static id="pointing_crop_handle";info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const n=this.editor.getSelectedShapes()[0];if(!n)return;const r=wo[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(n.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startCropping()};onLongPress=()=>{this.startCropping()};startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class wK extends Se{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}};onKeyUp=e=>{switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:n,currentPagePoint:r}=this.editor.inputs,s=r.clone().sub(n),i=AD(this.editor,e,s);i&&this.editor.updateShapes([i])}}class CK extends Se{static id="crop";static initial="idle";static children=()=>[xK,wK,bK,jD,TD];markId="";onEnter=()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)};didCancel=!1;onExit=()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)};onCancel=()=>{this.didCancel=!0}}class _K extends Se{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{const{shape:n,isCreating:r,handle:s}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=n.id,this.markId=r?`creating:${n.id}`:"dragging handle",r||this.editor.mark(this.markId),this.initialHandle=Ye(s),this.editor.isShapeOfType(n,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...n,props:{points:{...n.props.points,[s.index]:{id:s.index,index:s.index,x:s.x,y:s.y}}}});const c=this.editor.getShapeHandles(n).find(l=>l.index===s.index);this.initialHandle=Ye(c)}this.initialPageTransform=this.editor.getShapePageTransform(n),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:r?"cross":"grabbing",rotation:0});const i=this.editor.getShapeHandles(n).sort(en),o=i.findIndex(a=>a.id===e.handle.id);this.initialAdjacentHandle=null;for(let a=o+1;a<i.length;a++){const c=i[a];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==e.handle.id){this.initialAdjacentHandle=c;break}}if(!this.initialAdjacentHandle)for(let a=i.length-1;a>=0;a--){const c=i[a];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==e.handle.id){this.initialAdjacentHandle=c;break}}if(this.editor.isShapeOfType(n,"arrow")){const a=wn(this.editor,n)[e.handle.id];this.isPrecise=!1,a?(this.editor.setHintingShapes([a.toId]),this.isPrecise=a.props.isPrecise,this.isPrecise?this.isPreciseId=a.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.update(),this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})};complete(){this.editor.snaps.clearIndicators(),Ve(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){const{editor:e,shapeId:n,initialPagePoint:r}=this,{initialHandle:s,initialPageRotation:i,initialAdjacentHandle:o}=this,a=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:d,shiftKey:u,ctrlKey:p,altKey:f,pointerVelocity:m}}=e,y=this.info.shape,S=e.getShape(n);if(!S)return;const g=e.getShapeUtil(S);let v=d.clone().sub(r).rot(-i).add(s);if(u&&o&&s.id!=="middle"){const I=w.Angle(o,v),P=td(I,24)-I;v=w.RotWith(v,o,P)}e.snaps.clearIndicators();let x={...s,x:v.x,y:v.y};if(s.canSnap&&(c?!p:p)){if(!e.getShapePageTransform(S.id))throw Error("Expected a page transform");const C=l.handles.snapHandle({currentShapeId:n,handle:x});C&&(C.nudge.rot(-e.getShapeParentTransform(S).rotation()),v.add(C.nudge),x={...s,x:v.x,y:v.y})}const b=g.onHandleDrag?.(S,{handle:x,isPrecise:this.isPrecise||f,initial:y}),E={id:S.id,type:S.type,...b};if(s.type==="vertex"&&this.editor.isShapeOfType(S,"arrow")){const I=wn(e,S)[s.id];I?a[0]!==I.toId&&(e.setHintingShapes([I.toId]),this.pointingId=I.toId,this.isPrecise=m.len()<.5||f,this.isPreciseId=this.isPrecise?I.toId:null,this.resetExactTimeout()):a.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}b&&e.updateShapes([E])}}function RD(t){return t.isLabel?[t]:t instanceof xr?t.children.filter(e=>e.isLabel):[]}class IK extends Se{static id="editing_shape";hitShapeForPointerUp=null;onEnter=()=>{const e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,ss(this.editor),this.editor.select(e)};onExit=()=>{const{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null),ss.cancel();const n=this.editor.getShape(e);this.editor.getShapeUtil(n).onEditEnd?.(n)};onPointerMove=e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{ss(this.editor);return}}};onPointerDown=e=>{switch(this.hitShapeForPointerUp=null,e.target){case"shape":{const{shape:n}=e,r=this.editor.getEditingShape();if(!r)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(n).getGeometry(n),i=RD(s),o=i.length===1?i[0]:void 0,a=this.editor.isShapeOfType(r,"text")&&r.props.text.trim()==="";if(o&&!a){const c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(c,0)&&o.hitTestPoint(c)){if(n.id===r.id)return;this.hitShapeForPointerUp=n,this.editor.mark("editing on pointer up"),this.editor.select(n.id);return}}else{if(n.id===r.id)this.editor.isShapeOfType(n,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e));else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onPointerUp=e=>{const n=this.hitShapeForPointerUp;if(!n)return;this.hitShapeForPointerUp=null;const r=this.editor.getShapeUtil(n);if(!n.isLocked){if(this.editor.getInstanceState().isReadonly&&!r.canEditInReadOnly(n)){this.parent.transition("pointing_shape",e);return}this.editor.select(n.id),this.editor.setEditingShape(n.id),ss(this.editor)}};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}}function HI(t){const e=t.getOnlySelectedShape();return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function ud(t){const e=t.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:s}=t.inputs,i=t.getShapeAtPoint(s,{hitInside:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:o=>!o.isLocked});if(i){const o=t.getOutermostSelectableShape(i);if(n&&!r)t.cancelDoubleClick(),e.includes(o.id)?(t.mark("deselecting shape"),t.deselect(o)):(t.mark("shift selecting shape"),t.setSelectedShapes([...e,o.id]));else{let a;o===i||o.id===t.getFocusedGroupId()||e.includes(o.id)?a=i:a=o,a&&!e.includes(a.id)&&(t.mark("selecting shape"),t.select(a.id))}}else{if(n)return;{e.length>0&&(t.mark("selecting none"),t.selectNone());const o=t.getFocusedGroupId();if(vn(o)){const a=t.getShape(o);t.isPointInShape(a,s,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const PK=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let EK=class extends Se{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),ss(this.editor),this.editor.setCursor({type:"default",rotation:0})};onExit=()=>{ss.cancel()};onPointerMove=()=>{ss(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;const n=e.ctrlKey&&HI(this.editor);if(e.ctrlKey&&!n){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const r=MD(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((s.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&GI(this.editor,o)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{n?this.parent.transition("crop.pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}};onDoubleClick=e=>{if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),s=this.editor.getFocusedGroupId();if(r){if(this.editor.isShapeOfType(r,"group")){ud(this.editor);return}else{const i=this.editor.getShape(r.parentId);if(i&&this.editor.isShapeOfType(i,"group")&&!(s&&i.id===s)){ud(this.editor);return}}this.onDoubleClick({...e,shape:r,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const n=this.editor.getOnlySelectedShape();if(n){const r=this.editor.getShapeUtil(n);if(!this.canInteractWithShapeInReadOnly(n))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const s=r.onDoubleClickEdge?.(n);if(s){this.editor.mark("double click edge"),this.editor.updateShapes([s]),Ve(this.editor,[n.id]);return}}if(r.canCrop(n)&&!this.editor.isShapeOrAncestorLocked(n)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(n)&&this.startEditingShape(n,e,!0)}break}case"shape":{const{shape:n}=e,r=this.editor.getShapeUtil(n);if(n.type!=="video"&&n.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(r.onDoubleClick){const s=r.onDoubleClick?.(n);if(s){this.editor.updateShapes([s]);return}else if(r.canCrop(n)&&!this.editor.isShapeOrAncestorLocked(n)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(n)?this.startEditingShape(n,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:n,handle:r}=e,i=this.editor.getShapeUtil(n).onDoubleClickHandle?.(n,r);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(n)&&this.startEditingShape(n,e,!0)}}};onRightClick=e=>{switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((s.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&GI(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:n}=this.editor.getCurrentPageState(),{shape:r}=e,s=this.editor.getOutermostSelectableShape(r,i=>!n.includes(i.id));!n.includes(s.id)&&!this.editor.findShapeAncestor(s,i=>n.includes(i.id))&&(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(yt.editOnType.get()&&!PK.includes(e.key)&&!e.altKey&&!e.ctrlKey){const n=this.editor.getOnlySelectedShape();if(n&&this.editor.isShapeOfType(n,"note")&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}};onKeyUp=e=>{switch(e.code){case"Enter":{const n=this.editor.getSelectedShapes();if(n.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(n.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}HI(this.editor)&&this.parent.transition("crop",e);break}}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,n,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),cd(this.editor,e,r),this.parent.transition("editing_shape",n))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;isOverArrowLabelTest(e){if(!e)return!1;const n=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&Bn(n,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const n=He(),{x:r,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:r,y:s,props:{text:"",autoSize:!0}}]);const i=this.editor.getShape(n);if(!i)return;const o=this.editor.getShapeUtil(i);this.editor.getInstanceState().isReadonly&&!o.canEditInReadOnly(i)||(this.editor.setEditingShape(n),this.editor.select(n),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),s=new w(0,0);if(n.has("ArrowLeft")&&(s.x-=1),n.has("ArrowRight")&&(s.x+=1),n.has("ArrowUp")&&(s.y-=1),n.has("ArrowDown")&&(s.y+=1),s.equals(new w(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?r?i*MK:i:r?kK:TK,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,s.mul(o)),Ve(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}};const kK=10,TK=1,MK=5;function GI(t,e){const n=t.getSelectionRotatedPageBounds();if(!n)return!1;const r=t.getSelectionRotation();return r?Bn(e,n.corners.map(s=>w.RotWith(s,n.point,r))):n.containsPoint(e)}class AK extends Se{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter=e=>{const{shape:n}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=n.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===n.id,this.updateCursor();const s=this.editor.getShapeGeometry(n).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${n.id}`);const{currentPagePoint:i}=this.editor.inputs,o=this.editor.getPointInShapeSpace(n,i);this._labelDragOffset=w.Sub(s.center,o),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};_labelDragOffset=new w(0,0);onPointerMove=()=>{const{isDragging:e}=this.editor.inputs;if(!e)return;const n=this.editor.getShape(this.shapeId);if(!n)return;const r=Rr(this.editor,n),s=this.editor.getShapeGeometry(n),i=s.children[0],o=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),a=i.nearestPoint(w.Add(o,this._labelDragOffset));let c;if(r.isStraight){const l=w.Dist(r.start.point,r.end.point);c=1-w.Dist(r.end.point,a)/l}else{const{_center:l,measure:d,angleEnd:u,angleStart:p}=s.children[0];c=Mx(d,p,u,l.angle(a))}isNaN(c)&&(c=.5),this.didDrag=!0,this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:c}})};onPointerUp=()=>{const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class jK extends Se{static id="pointing_canvas";onEnter=()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{ud(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle")};complete(){this.parent.transition("idle")}}class RK extends Se{static id="pointing_handle";info={};onEnter=e=>{this.info=e;const{shape:n}=e;if(this.editor.isShapeOfType(n,"arrow")){const r=wn(this.editor,n)[e.handle.id];r&&this.editor.setHintingShapes([r.toId])}this.editor.setCursor({type:"grabbing",rotation:0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})};onPointerUp=()=>{const{shape:e,handle:n}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:r}=this,s=KI(r,e,n,!1);if(s){cd(r,s,!0);return}}this.parent.transition("idle",this.info)};onPointerMove=()=>{const{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()};onLongPress=()=>{this.startDraggingHandle()};startDraggingHandle(){const{editor:e}=this;if(e.getInstanceState().isReadonly)return;const{shape:n,handle:r}=this.info;if(e.isShapeOfType(n,"note")){const s=KI(e,n,r,!0);if(s){const i=e.getPointInParentSpace(s,e.inputs.originPagePoint).sub(w.Rot(Hd.clone().mul(n.props.scale),s.rotation));e.updateShape({...s,x:i.x,y:i.y}),e.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{cd(e,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}function KI(t,e,n,r){const s=t.getShapePageTransform(e.id),i=s.point(),o=s.rotation(),c=sD(t,i,o,e.props.growY,0,e.props.scale)[n.index];if(c)return oD(t,e,c,o,r)}class OK extends Se{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:wo[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter=e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startRotating()};onLongPress=()=>{this.startRotating()};startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class DK extends Se{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{ud(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}onDoubleClick=e=>{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(r){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(r)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class LK extends Se{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didSelectOnEnter=!1;onEnter=e=>{const n=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i,shiftKey:o,altKey:a}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;const c=this.editor.getOutermostSelectableShape(e.shape),l=this.editor.findShapeAncestor(c,d=>n.includes(d.id));if(this.editor.getShapeUtil(e.shape).onClick||c.id===s||n.includes(c.id)||l||n.length>1&&r?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,o&&!a?(this.editor.cancelDoubleClick(),n.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...n,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))};onPointerUp=e=>{const n=this.editor.getSelectedShapeIds(),r=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i,shiftKey:o}}=this.editor,a=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,c=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(c){const l=this.editor.getShapeUtil(c);if(l.onClick){const d=l.onClick?.(c);if(d){this.editor.mark("shape on click"),this.editor.updateShapes([d]),this.parent.transition("idle",e);return}}if(c.id===r){n.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const l=this.editor.getOutermostSelectableShape(a,d=>!n.includes(d.id));if(n.includes(l.id))if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(n.includes(c.id)){if(n.length===1){const d=this.editor.getShapeUtil(c).getGeometry(c),u=RD(d),p=u.length===1?u[0]:void 0;if(p){const f=this.editor.getPointInShapeSpace(c,i);if(p.bounds.containsPoint(f,0)&&p.hitTestPoint(f)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const m=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!m.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:c.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(o){const d=this.editor.getShapeAncestors(l);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(u=>!d.find(p=>p.id===u)),l.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([l.id])}this.parent.transition("idle",e)};onDoubleClick=()=>{this.isDoubleClick=!0};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",e))}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class NK extends Se{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter=e=>{const{isCreating:n=!1,creationCursorOffset:r={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=r,this.snapshot=this._createSnapshot(),n?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()};onTick=({elapsed:e})=>{const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(Ve(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:r})=>{const i=this.editor.getShapeUtil(r).onResizeStart?.(r);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:r})=>{const s=this.editor.getShape(r.id),o=this.editor.getShapeUtil(r).onResizeEnd?.(r,s);o&&n.push(o)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{altKey:e,shiftKey:n}=this.editor.inputs,{frames:r,shapeSnapshots:s,selectionBounds:i,cursorHandleOffset:o,selectedShapeIds:a,selectionRotation:c,canShapesDeform:l}=this.snapshot;let d=n||!l;if(s.size===1){const C=[...s.values()][0];this.editor.isShapeOfType(C.shape,"text")&&(d=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:u}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),f=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!u){const{gridSize:C}=this.editor.getDocumentSettings();p.snapToGrid(C)}const m=this.info.handle,y=VI(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!u:u)&&c%Xe===0){const{nudge:C}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:w.Sub(p,f),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:VI(m,c),isAspectRatioLocked:d,isResizingFromCenter:e});p.add(C)}const g=w.RotWith(e?i.center:i.getHandlePoint(y),i.point,c),v=w.Sub(p,g).rot(-c),x=w.Sub(f,g).rot(-c),b=w.DivV(v,x);Number.isFinite(b.x)||(b.x=1),Number.isFinite(b.y)||(b.y=1);const E=m==="top"||m==="bottom",I=m==="left"||m==="right";d?I?b.y=Math.abs(b.x):E?b.x=Math.abs(b.y):Math.abs(b.x)>Math.abs(b.y)?b.y=Math.abs(b.x)*(b.y<0?-1:1):b.x=Math.abs(b.y)*(b.x<0?-1:1):(E&&(b.x=1),I&&(b.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:b.x<0,isFlippedY:b.y<0,rotation:c});for(const C of s.keys()){const P=s.get(C);this.editor.resizeShape(C,b,{initialShape:P.shape,initialBounds:P.bounds,initialPageTransform:P.pageTransform,dragHandle:m,mode:a.length===1&&C===a[0]?"resize_bounds":"scale_shape",scaleOrigin:g,isAspectRatioLocked:d,scaleAxisRotation:c,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:C,children:P}of r){if(!P.length)continue;const k=s.get(C).shape,T=this.editor.getShape(C);if(!(k&&T))continue;const M=T.x-k.x,A=T.y-k.y,j=new w(M,A).rot(-k.rotation);if(j.x!==0||j.y!==0)for(const R of P)this.editor.updateShape({id:R.id,type:R.type,x:R.x-j.x,y:R.y-j.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:C}of r)if(C.length)for(const P of C)this.editor.updateShape({id:P.id,type:P.type,x:P.x,y:P.y})}}updateCursor({dragHandle:e,isFlippedX:n,isFlippedY:r,rotation:s}){const i={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{i.type="nwse-resize",n!==r&&(i.type="nesw-resize");break}case"top_right":case"bottom_left":{i.type="nesw-resize",n!==r&&(i.type="nwse-resize");break}}i.rotation=s,this.editor.setCursor(i)}onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()};_createSnapshot=()=>{const e=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),i=w.RotWith(s.getHandlePoint(this.info.handle),s.point,n),o=w.Sub(r,i),a=new Map,c=[];e.forEach(d=>{const u=this.editor.getShape(d);if(u){if(u.type==="frame"&&c.push({id:d,children:Te(this.editor.getSortedChildIdsForParent(u).map(p=>this.editor.getShape(p)))}),a.set(u.id,this._createShapeSnapshot(u)),this.editor.isShapeOfType(u,"frame")&&e.length===1)return;this.editor.visitDescendants(u.id,p=>{const f=this.editor.getShape(p);if(f&&(a.set(f.id,this._createShapeSnapshot(f)),this.editor.isShapeOfType(f,"frame")))return!1})}});const l=![...a.values()].some(d=>!LR(d.pageRotation,n)||d.isAspectRatioLocked);return{shapeSnapshots:a,selectionBounds:s,cursorHandleOffset:o,selectionRotation:n,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}};_createShapeSnapshot=e=>{const n=this.editor.getShapePageTransform(e),r=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:n,pageRotation:se.Decompose(n).rotation,isAspectRatioLocked:r.isAspectRatioLocked(e)}}}const Ff=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function VI(t,e){e=e%Ue;const n=Math.round(e/($e/4)),r=Ff.indexOf(t);return Ff[(r+n)%Ff.length]}const WI=Math.PI/180;class FK extends Se{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const n=PO({editor:this.editor});if(!n)return this.parent.transition("idle",this.info);this.snapshot=n;const r=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Dl({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:wo[this.info.handle],rotation:r+this.snapshot.initialSelectionRotation})};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Dl({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:wo[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{Dl({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),Ve(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};_getRotationFromPointerPosition({snapToNearestDegree:e}){const n=this.editor.getSelectionRotation(),r=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:i}}=this.editor,{initialCursorAngle:o,initialSelectionRotation:a}=this.snapshot;if(!r)return a;const l=r.center.clone().rotWith(r.point,n).angle(i)-o;let d=a+l;if(s)d=td(d,24);else if(e&&(d=Math.round(d/WI)*WI,this.editor.getInstanceState().isCoarsePointer)){const u=td(d,4),p=Rl(d,u);Math.abs(p)<p6(5)&&(d=u)}return d-a}}class BK extends Se{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)};updateScribbleSelection(e){const{editor:n}=this,r=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:s,originPagePoint:i,previousPagePoint:o,currentPagePoint:a}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:l}=this;e&&this.pushPointToScribble();const d=r;let u,p,f,m;const y=0;for(let v=0,x=d.length;v<x;v++){if(u=d[v],n.isShapeOfType(u,"group")||c.has(u.id)||n.isShapeOrAncestorLocked(u)||(p=n.getShapeGeometry(u),n.isShapeOfType(u,"frame")&&p.bounds.containsPoint(n.getPointInShapeSpace(u,i))))continue;const b=n.getShapePageTransform(u);if(!p||!b)continue;const E=b.clone().invert();f=E.applyToPoint(o),m=E.applyToPoint(a);const{bounds:I}=p;if(!(I.minX-y>Math.max(f.x,m.x)||I.minY-y>Math.max(f.y,m.y)||I.maxX+y<Math.min(f.x,m.x)||I.maxY+y<Math.min(f.y,m.y))&&p.hitTestLineSegment(f,m,y)){const C=this.editor.getOutermostSelectableShape(u),P=this.editor.getShapeMask(C.id);if(P&&ew(o,a,P)!==null&&!Bn(a,P))continue;c.add(C.id)}}const S=n.getSelectedShapeIds(),g=new Set(s?[...c,...l]:[...c]);(S.length!==g.size||S.some(v=>!g.has(v)))&&this.editor.setSelectedShapes(Array.from(g))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}const $K=20,zK=100;class UK{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,n){this.first&&(this.editor.setHintingShapes(e.map(r=>this.editor.findShapeAncestor(r,s=>s.type!=="group")).filter(r=>r)),this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,$K,n):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,zK,n))}setDragTimer(e,n,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},n)}handleDrag(e,n,r){n=Te(n.map(c=>this.editor.getShape(c.id)));const s=this.editor.getDroppingOverShape(e,n)?.id??null;if(s===this.prevDroppingShapeId){this.hintParents(n);return}const{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),a=s&&this.editor.getShape(s);o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,n),a&&this.editor.getShapeUtil(a).onDragShapesOver?.(a,n),this.hintParents(n),r?.(),this.prevDroppingShapeId=s}hintParents(e){const n=new Map;for(const s of e){const i=this.editor.findShapeAncestor(s,o=>o.type!=="group");i&&(n.has(i.id)||n.set(i.id,[]),n.get(i.id).push(s.id))}const r=[];for(const[s,i]of n){const o=this.editor.getShape(s);o&&tD(this.editor,o).length<i.length&&r.push(o.id)}this.editor.setHintingShapes(r)}dropShapes(e){const{prevDroppingShapeId:n}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),n){const r=this.editor.getShape(n);if(!r)return;this.editor.getShapeUtil(r).onDropShapesOver?.(r,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}}class qK extends Se{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>{};dragAndDropManager=new UK(this.editor);onEnter=e=>{const{isCreating:n=!1,onCreate:r=()=>{}}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.onCreate=r,n?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=YI(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()};onTick=({elapsed:e})=>{const{editor:n}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),n.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=YI(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),Ve(this.editor,this.snapshot.movingShapes.map(e=>e.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(r=>{const i=this.editor.getShapeUtil(r).onTranslateStart?.(r);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=w.Average(e.map(i=>this.editor.getShapePageTransform(i.id).point())),s=w.Sub(r,this.selectionSnapshot.averagePagePoint);w.IsNaN(s)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(i=>i.id),offset:{x:s.x,y:s.y}}})}const n=[];e.forEach(r=>{const s=this.editor.getShape(r.id),o=this.editor.getShapeUtil(r).onTranslateEnd?.(r,s);o&&n.push(o)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),HK({editor:this.editor,snapshot:e});const{movingShapes:n}=e,r=[];n.forEach(s=>{const i=this.editor.getShape(s.id),a=this.editor.getShapeUtil(s).onTranslate?.(s,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms=()=>{const{editor:e,snapshot:{shapeSnapshots:n}}=this;n.forEach(r=>{const s=e.getShape(r.shape.id);if(!s)return null;const i=yn(s.parentId)?null:se.Inverse(e.getShapePageTransform(s.parentId));r.parentTransform=i})}}function YI(t){const e=[],n=[],r=t.getSelectedShapeIds(),s=Te(r.map(u=>{const p=t.getShape(u);if(!p)return null;e.push(p);const f=t.getShapePageTransform(u),m=f.point(),y=f.rotation();n.push(m);const S=ds.isId(p.parentId)?null:se.Inverse(t.getShapePageTransform(p.parentId));return{shape:p,pagePoint:m,pageRotation:y,parentTransform:S}})),i=t.getOnlySelectedShape();let o=[];if(i)o=t.snaps.shapeBounds.getSnapPoints(i.id);else{const u=t.getSelectionPageBounds();u&&(o=u.cornersAndCenter.map((p,f)=>({id:"selection:"+f,x:p.x,y:p.y})))}let a,c;const{originPagePoint:l}=t.inputs,d=s.filter(u=>t.isShapeOfType(u.shape,"note")&&t.isPointInShape(u.shape,l));if(d.length!==0)if(d.length===1)c=d[0];else{const u=t.getCurrentPageShapesSorted();c=d.map(p=>({snapshot:p,index:u.findIndex(f=>f.id===p.shape.id)})).sort((p,f)=>f.index-p.index)[0]?.snapshot}return c&&(a=iD(t,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:w.Average(n),movingShapes:e,shapeSnapshots:s,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:c}}function HK({editor:t,snapshot:e}){const{inputs:n}=t,{noteSnapshot:r,noteAdjacentPositions:s,initialPageBounds:i,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:c}=e,l=t.getInstanceState().isGridMode,d=t.getDocumentSettings().gridSize,u=w.Sub(n.currentPagePoint,n.originPagePoint),p=t.inputs.shiftKey?Math.abs(u.x)<Math.abs(u.y)?"x":"y":null;if(p==="x"?u.x=0:p==="y"&&(u.y=0),t.snaps.clearIndicators(),(t.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:S}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:u,initialSelectionPageBounds:i,lockedAxis:p,initialSelectionSnapPoints:o});u.add(S)}else if(r&&s){const{scale:S}=r.shape.props,g=r.pagePoint.clone().add(u).add(Hd.clone().mul(S).rot(r.pageRotation));let v=rD/t.getZoomLevel(),x=new w(0,0);for(const b of s){const E=w.Sub(g,b),I=E.len();I<v&&(v=I,x=E)}u.sub(x)}const m=w.Add(c,u);l&&!n.ctrlKey&&m.snapToGrid(d);const y=w.Sub(m,c);t.updateShapes(Te(a.map(({shape:S,pagePoint:g,parentTransform:v})=>{const x=w.Add(g,y),b=v?se.applyToPoint(v,x):x;return{id:S.id,type:S.type,x:b.x,y:b.y}})))}class GK extends Se{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children=()=>[CK,TD,EK,jK,LK,qK,SK,BK,jD,DK,vK,IK,NK,FK,OK,AK,RK,_K];cleanUpDuplicateProps=()=>{const e=this.editor.getSelectedShapeIds(),n=this.editor.getInstanceState();if(!n.duplicateProps)return;const r=new Set(n.duplicateProps.shapeIds);e.length===r.size&&e.every(s=>r.has(s))||this.editor.updateInstanceState({duplicateProps:null})};onEnter=()=>{this.reactor=Oi("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})};onExit=()=>{this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class KK extends Se{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}}class VK extends Se{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class WK extends Se{static id="zoom_brushing";info={};zoomBrush=new ce;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){const{inputs:{originPagePoint:e,currentPagePoint:n}}=this.editor;this.zoomBrush.setTo(ce.FromPoints([e,n])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,n=8/this.editor.getZoomLevel();if(e.width<n&&e.height<n){const r=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(r,{animation:{duration:220}}):this.editor.zoomIn(r,{animation:{duration:220}})}else{const r=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:r,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class YK extends Se{static id="zoom";static initial="idle";static children=()=>[KK,WK,VK];static isLockable=!1;info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),e.code==="KeyZ"&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}const XK=[dK,fK,yK,YK,GK],OD=()=>{},DD=_.createContext(null);function ZK({onEvent:t,children:e}){return h.jsx(DD.Provider,{value:t??OD,children:e})}function Gt(){return _.useContext(DD)??OD}const LD=_.createContext(null);function QK({children:t}){const e=K(),n=Gt(),[r,s]=_.useState([]),i=_.useCallback(l=>{const d=l.id??lt();return s(u=>[...u.filter(p=>p.id!==l.id),{...l,id:d}]),n("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d},[e,n]),o=_.useCallback((l,d)=>(s(u=>u.map(p=>p.id===l?{...p,...d}:p)),n("open-menu",{source:"dialog",id:l}),e.addOpenMenu(l),l),[e,n]),a=_.useCallback(l=>(s(d=>d.filter(u=>u.id===l?(u.onClose?.(),!1):!0)),n("close-menu",{source:"dialog",id:l}),e.deleteOpenMenu(l),l),[e,n]),c=_.useCallback(()=>{s(l=>(l.forEach(d=>{d.onClose?.(),n("close-menu",{source:"dialog",id:d.id}),e.deleteOpenMenu(d.id)}),[]))},[e,n]);return h.jsx(LD.Provider,{value:{dialogs:r,addDialog:i,removeDialog:a,clearDialogs:c,updateDialog:o},children:t})}function Di(){const t=_.useContext(LD);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const JK=({id:t,component:e,onClose:n})=>{const{removeDialog:r}=Di(),s=Dt(),i=_.useCallback(o=>{if(!o){if(n)try{n()}catch(a){console.warn(a)}r(t)}},[t,n,r]);return h.jsx(QF,{onOpenChange:i,defaultOpen:!0,children:h.jsx(JF,{container:s,children:h.jsx(eB,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&i(!1)},children:h.jsx(tB,{dir:"ltr",className:"tlui-dialog__content",children:h.jsx(e,{onClose:()=>i(!1)})})})})})};function eV(){const{dialogs:t}=Di();return t.map(e=>h.jsx(JK,{...e},e.id))}const tV=qe.memo(eV);function nV(){const t=K(),e=X("follow",()=>t.getInstanceState().followingUserId,[t]);return e?h.jsx(rV,{userId:e}):null}function rV({userId:t}){const e=Ld(t);return e?h.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}const ND=_.createContext(null);function sV({children:t}){const[e,n]=_.useState([]),r=_.useCallback(o=>{const a=o.id??lt();return n(c=>[...c.filter(l=>l.id!==o.id),{...o,id:a}]),a},[]),s=_.useCallback(o=>(n(a=>a.filter(c=>c.id!==o)),o),[]),i=_.useCallback(()=>{n(()=>[])},[]);return h.jsx(UF,{children:h.jsx(ND.Provider,{value:{toasts:e,addToast:r,removeToast:s,clearToasts:i},children:t})})}function _r(){const t=_.useContext(ND);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}const we=_.forwardRef(function({children:e,disabled:n,type:r,...s},i){return h.jsx("button",{ref:i,type:"button",draggable:!1,disabled:n,...s,className:be("tlui-button",`tlui-button__${r}`,s.className),children:e})});function vt({children:t}){return h.jsx("span",{className:"tlui-button__label",children:t})}const zr=_.memo(function({small:e,invertIcon:n,icon:r,color:s,className:i,...o}){const a=Sw(),c=a.icons[r]??a.icons["question-mark-circle"],l=_.useRef(null);return _.useLayoutEffect(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),l?.current&&(l.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[l,c,r]),r==="none"?h.jsx("div",{className:be("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},i)}):h.jsx("div",{...o,ref:l,className:be("tlui-icon",{"tlui-icon__small":e},i),style:{color:s,mask:`url(${c}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}),iV={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function oV({toast:t}){const{removeToast:e}=_r(),n=Re(),r=o=>{o||e(t.id)},s=t.actions&&t.actions.length>0,i=t.icon||t.severity&&iV[t.severity];return h.jsxs(HF,{onOpenChange:r,className:"tlui-toast__container",duration:t.keepOpen?1/0:5e3,"data-severity":t.severity,children:[i&&h.jsx("div",{className:"tlui-toast__icon",children:h.jsx(zr,{icon:i})}),h.jsxs("div",{className:"tlui-toast__main",children:[h.jsxs("div",{className:"tlui-toast__content",children:[t.title&&h.jsx(GF,{className:"tlui-toast__title",children:t.title}),t.description&&h.jsx(KF,{className:"tlui-toast__description",children:t.description})]}),t.actions&&h.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((o,a)=>h.jsx(VF,{altText:o.label,asChild:!0,onClick:o.onClick,children:h.jsx(we,{type:o.type,children:h.jsx(vt,{children:o.label})})},a)),h.jsx(k0,{asChild:!0,children:h.jsx(we,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:h.jsx(vt,{children:t.closeLabel??n("toast.close")})})})]})]}),!s&&h.jsx(k0,{asChild:!0,children:h.jsx(we,{type:"normal",className:"tlui-toast__close",children:h.jsx(vt,{children:t.closeLabel??n("toast.close")})})})]})}function aV(){const{toasts:t}=_r();return t.map(e=>h.jsx(oV,{toast:e},e.id))}const cV=_.memo(aV);function lV(){const t=K(),{toasts:e}=_r(),[n,r]=_.useState(!1);return _.useEffect(()=>{let s=-1;return e.length?r(!0):s=t.timers.setTimeout(()=>{r(!1)},1e3),()=>{clearTimeout(s)}},[e.length,r,t]),n?h.jsx(qF,{className:"tlui-toast__viewport"}):null}function Ae({icon:t,small:e,invertIcon:n}){return h.jsx(zr,{className:"tlui-button__icon",icon:t,small:e,invertIcon:n})}const Bf=[0,390,428,468,580,640,840,1023];var gt=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(gt||{});let Yx={fonts:{draw:`${Os()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${Os()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${Os()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${Os()}/fonts/IBMPlexMono-Medium.woff2`}};function FD(t){return _.useMemo(()=>t?{fonts:{...Yx.fonts,...t?.fonts}}:Yx,[t])}const dV=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let ua={...Yx,icons:Object.fromEntries(dV.map(t=>[t,`${Os()}/icons/icon/${t}.svg`])),translations:Object.fromEntries(Va.map(t=>[t.locale,`${Os()}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(gc.map(t=>[t.type,`${Os()}/embed-icons/${t.type}.png`]))};function uV(t){return t?{fonts:Object.assign({...ua.fonts},{...t?.fonts}),icons:Object.assign({...ua.icons},{...t?.icons}),embedIcons:Object.assign({...ua.embedIcons},{...t?.embedIcons}),translations:Object.assign({...ua.translations},{...t?.translations})}:ua}function Yd({className:t,children:e}){return h.jsx("div",{className:be("tlui-dialog__header",t),children:e})}function Xd({className:t,children:e}){return h.jsx(nB,{dir:"ltr",className:be("tlui-dialog__header__title",t),children:e})}function Zd(){return h.jsx("div",{className:"tlui-dialog__header__close",children:h.jsx(rB,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:h.jsx(we,{type:"icon","aria-label":"Close",onTouchEnd:t=>t.target.click(),children:h.jsx(Ae,{small:!0,icon:"cross-2"})})})})}function Za({className:t,children:e,style:n}){return h.jsx("div",{className:be("tlui-dialog__body",t),style:n,children:e})}function vw({className:t,children:e}){return h.jsx("div",{className:be("tlui-dialog__footer",t),children:e})}const Qd=_.forwardRef(function({className:e,label:n,icon:r,iconLeft:s,autoSelect:i=!1,autoFocus:o=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:d,onCancel:u,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:m=!1,children:y,value:S},g){const v=K(),x=_.useRef(null);_.useImperativeHandle(g,()=>x.current);const b=Re(),E=_.useRef(a??""),I=_.useRef(a??""),[C,P]=_.useState(!1),k=_.useCallback(j=>{P(!0);const R=j.currentTarget;I.current=R.value,v.timers.requestAnimationFrame(()=>{i&&R.select()}),p?.()},[i,p,v.timers]),T=_.useCallback(j=>{const R=j.currentTarget.value;I.current=R,d?.(R)},[d]),M=_.useCallback(j=>{switch(j.key){case"Enter":{j.currentTarget.blur(),jt(j),l?.(j.currentTarget.value);break}case"Escape":{j.currentTarget.value=E.current,j.currentTarget.blur(),jt(j),u?.(j.currentTarget.value);break}}},[l,u]),A=_.useCallback(j=>{P(!1);const R=j.currentTarget.value;f?.(R)},[f]);return _.useEffect(()=>{if(!v.environment.isIos)return;const j=window.visualViewport;if(C&&m&&j){const R=()=>{x.current?.scrollIntoView({block:"center"})};return j.addEventListener("resize",R),j.addEventListener("scroll",R),v.timers.requestAnimationFrame(()=>{x.current?.scrollIntoView({block:"center"})}),()=>{j.removeEventListener("resize",R),j.removeEventListener("scroll",R)}}},[v,C,m]),h.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[y,n&&h.jsx("label",{children:b(n)}),s&&h.jsx(zr,{icon:s,className:"tlui-icon-left",small:!0}),h.jsx("input",{ref:x,className:be("tlui-input",e),type:"text",defaultValue:a,onKeyUp:M,onChange:T,onFocus:k,onBlur:A,autoFocus:o,placeholder:c,value:S}),r&&h.jsx(zr,{icon:r,small:!!n})]})}),BD=Ot(function({onClose:e}){const n=K(),r=Re(),s=Sw(),[i,o]=_.useState(null),[a,c]=_.useState(""),[l,d]=_.useState(null),[u,p]=_.useState(!1),f=_.useRef(-1);return h.jsxs(h.Fragment,{children:[h.jsxs(Yd,{children:[h.jsx(Xd,{children:i?`${r("embed-dialog.title")} — ${i.title}`:r("embed-dialog.title")}),h.jsx(Zd,{})]}),i?h.jsxs(h.Fragment,{children:[h.jsxs(Za,{className:"tlui-embed-dialog__enter",children:[h.jsx(Qd,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:m=>{c(m);const y=Ls(m);d(y&&y.definition.type===i.type?y:null),p(!1),clearTimeout(f.current),f.current=n.timers.setTimeout(()=>p(!y),320)}}),a===""?h.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[h.jsx("span",{children:r("embed-dialog.instruction")})," ",i.instructionLink&&h.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",h.jsx(zr,{icon:"external-link",small:!0})]})]}):h.jsx("div",{className:"tlui-embed-dialog__warning",children:u?r("embed-dialog.invalid-url"):" "})]}),h.jsxs(vw,{className:"tlui-dialog__footer__actions",children:[h.jsx(we,{type:"normal",onClick:()=>{o(null),d(null),c("")},children:h.jsx(vt,{children:r("embed-dialog.back")})}),h.jsx("div",{className:"tlui-embed__spacer"}),h.jsx(we,{type:"normal",onClick:e,children:h.jsx(vt,{children:r("embed-dialog.cancel")})}),h.jsx(we,{type:"primary",disabled:!l,onClick:()=>{l&&(n.putExternalContent({type:"embed",url:a,point:n.getViewportPageBounds().center,embed:l.definition}),e())},children:h.jsx(vt,{children:r("embed-dialog.create")})})]})]}):h.jsx(h.Fragment,{children:h.jsx(Za,{className:"tlui-embed-dialog__list",children:gc.map(m=>h.jsxs(we,{type:"menu",onClick:()=>o(m),children:[h.jsx(vt,{children:m.title}),h.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${s.embedIcons[m.type]})`}})]},m.type))})})]})});function $D(){const t=K(),e=_.useRef();return _.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept=yz,n.multiple=!0,e.current=n;async function r(s){const i=s.target.files;!i||i.length===0||(t.mark("insert media"),await t.putExternalContent({type:"files",files:Array.from(i),point:t.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",r),()=>{e.current=void 0,n.removeEventListener("change",r)}},[t]),_.useCallback(()=>{e.current?.click()},[e])}const zD=_.createContext(null);function hV({overrides:t,children:e}){const n=K(),r=Gt(),{addDialog:s}=Di(),i=$D(),o=_.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(l){n.setCurrentTool("select"),r("select-tool",{source:l,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(l){n.setCurrentTool("hand"),r("select-tool",{source:l,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(l){n.setCurrentTool("eraser"),r("select-tool",{source:l,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(l){n.setCurrentTool("draw"),r("select-tool",{source:l,id:"draw"})}},...[...mr.values].map(l=>({id:l,label:`tool.${l}`,meta:{geo:l},kbd:l==="rectangle"?"r":l==="ellipse"?"o":void 0,icon:"geo-"+l,onSelect(d){n.run(()=>{n.setStyleForNextShapes(mr,l),n.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${l}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(l){n.setCurrentTool("arrow"),r("select-tool",{source:l,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(l){n.setCurrentTool("line"),r("select-tool",{source:l,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(l){n.setCurrentTool("frame"),r("select-tool",{source:l,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(l){n.setCurrentTool("text"),r("select-tool",{source:l,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(l){i(),r("select-tool",{source:l,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(l){n.setCurrentTool("note"),r("select-tool",{source:l,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(l){n.setCurrentTool("laser"),r("select-tool",{source:l,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(l){s({component:BD}),r("select-tool",{source:l,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(l){n.setCurrentTool("highlight"),r("select-tool",{source:l,id:"highlight"})}}];a.push();const c=Object.fromEntries(a.map(l=>[l.id,l]));return t?t(n,c,{insertMedia:i}):c},[t,n,r,i,s]);return h.jsx(zD.Provider,{value:o,children:e})}function Jd(){const t=_.useContext(zD);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}const UD=qe.createContext(null);function pV({forceMobile:t=!1,children:e}){const n=K(),r=X("breakpoint",()=>{const{width:s}=n.getViewportScreenBounds(),i=t?gt.MOBILE_SM:Bf.length-1;for(let o=0;o<i;o++)if(s>Bf[o]&&s<=Bf[o+1])return o;return i},[n]);return h.jsx(UD.Provider,{value:r,children:e})}function hn(){const t=_.useContext(UD);if(t===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}function fV(){const{addToast:t,removeToast:e,clearToasts:n}=_r(),{addDialog:r,clearDialogs:s,removeDialog:i,updateDialog:o}=Di(),c=hn()<gt.TABLET_SM,l=Re();return _.useMemo(()=>({addToast:t,removeToast:e,clearToasts:n,addDialog:r,clearDialogs:s,removeDialog:i,updateDialog:o,msg:l,isMobile:c}),[r,t,s,n,l,i,e,o,c])}function gV(t,e){const n={};for(const r of t)if(r.translations)for(const[s,i]of Pn(r.translations)){let o=n[s];o||(o=n[s]={}),Object.assign(o,i)}return{actions:(r,s)=>{for(const i of t)i.actions&&(s=i.actions(r,s,e));return s},tools:(r,s,i)=>{for(const o of t)o.tools&&(s=o.tools(r,s,{...e,...i}));return s},translations:n}}function qD(t){return _.useMemo(()=>t,t)}function mV(t){const e=qD(t==null?[]:Array.isArray(t)?t:[t]);return _.useMemo(()=>{const n={};for(const r of e)if(r.translations)for(const[s,i]of Pn(r.translations)){let o=n[s];o||(o=n[s]={}),Object.assign(o,i)}return n},[e])}function yV(t){const e=fV(),n=qD(t==null?[]:Array.isArray(t)?t:[t]);return _.useMemo(()=>gV(n,e),[n,e])}function SV(t,e){const n=Te(e.map(s=>t.getShape(s)).filter(s=>s&&t.isShapeOfType(s,"frame")));if(!n.length)return;const r=[];t.run(()=>{n.map(s=>{const i=t.getSortedChildIdsForParent(s.id);i.length&&(t.reparentShapes(i,s.parentId,s.index),r.push(...i))}),t.setSelectedShapes(r),t.deleteShapes(e)})}const vV=50;function xV(t,e,n={}){const r=t.getShape(e);if(!r)return;const s=t.getSortedChildIdsForParent(r.id),i=Te(s.map(f=>t.getShape(f)));if(!i.length)return;const o=ce.FromPoints(i.flatMap(f=>{const m=t.getShapeGeometry(f.id);return t.getShapeLocalTransform(f).applyToPoints(m.vertices)})),{padding:a=vV}=n,c=o.w+2*a,l=o.h+2*a,d=a-o.minX,u=a-o.minY;if(d===0&&u===0&&r.props.w===c&&r.props.h===l)return;const p=new w(d,u).rot(r.rotation);t.run(()=>{const f=s.map(m=>{const y=t.getShape(m);return{id:y.id,type:y.type,x:y.x+d,y:y.y+u}});f.push({id:r.id,type:r.type,x:r.x-p.x,y:r.y-p.y,props:{w:c,h:l}}),t.updateShapes(f)})}function XI(t){return $n.isValid(t)?{isValid:!0,hasProtocol:!0}:$n.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const bV=Ot(function({onClose:e}){const r=K().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?h.jsx(wV,{onClose:e,selectedShape:r}):null}),wV=Ot(function({onClose:e,selectedShape:n}){const r=K(),s=Re(),i=_.useRef(null);_.useEffect(()=>{r.timers.requestAnimationFrame(()=>i.current?.focus())},[r]);const o=_.useRef(n.props.url),[a,c]=_.useState(()=>{const m=XI(n.props.url),y=m.isValid===!0?m.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:y,safe:y,valid:!0}}),l=_.useCallback(m=>{const y=m.replace(/https?:\/\/(https?:\/\/)/,(v,x)=>x),S=XI(y),g=S.isValid===!0?S.hasProtocol?y:"https://"+y:"https://";c({actual:y,safe:g,valid:S.isValid})},[]),d=_.useCallback(()=>{const m=r.getOnlySelectedShape();m&&(r.updateShapes([{id:m.id,type:m.type,props:{url:""}}]),e())},[r,e]),u=_.useCallback(()=>{const m=r.getOnlySelectedShape();m&&(m&&"url"in m.props&&m.props.url!==a.safe&&r.updateShapes([{id:m.id,type:m.type,props:{url:a.safe}}]),e())},[r,e,a]),p=_.useCallback(()=>{e()},[e]);if(!n)return e(),null;const f=o.current&&!a.valid;return h.jsxs(h.Fragment,{children:[h.jsxs(Yd,{children:[h.jsx(Xd,{children:s("edit-link-dialog.title")}),h.jsx(Zd,{})]}),h.jsx(Za,{children:h.jsxs("div",{className:"tlui-edit-link-dialog",children:[h.jsx(Qd,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:l,onComplete:u,onCancel:p}),h.jsx("div",{children:a.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),h.jsxs(vw,{className:"tlui-dialog__footer__actions",children:[h.jsx(we,{type:"normal",onClick:p,onTouchEnd:p,children:h.jsx(vt,{children:s("edit-link-dialog.cancel")})}),f?h.jsx(we,{type:"danger",onTouchEnd:d,onClick:d,children:h.jsx(vt,{children:s("edit-link-dialog.clear")})}):h.jsx(we,{type:"primary",disabled:!a.valid,onTouchEnd:u,onClick:u,children:h.jsx(vt,{children:s("edit-link-dialog.save")})})]})]})});var $f={exports:{}},ZI;function CV(){return ZI||(ZI=1,(function(t){var e=(function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function o(c,l){if(!i[c]){i[c]={};for(var d=0;d<c.length;d++)i[c][c.charAt(d)]=d}return i[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(d){return r.charAt(d)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),d=new Uint8Array(l.length*2),u=0,p=l.length;u<p;u++){var f=l.charCodeAt(u);d[u*2]=f>>>8,d[u*2+1]=f%256}return d},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),d=0,u=l.length;d<u;d++)l[d]=c[d*2]*256+c[d*2+1];var p=[];return l.forEach(function(f){p.push(n(f))}),a.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return s.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(s,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,d){if(c==null)return"";var u,p,f={},m={},y="",S="",g="",v=2,x=3,b=2,E=[],I=0,C=0,P;for(P=0;P<c.length;P+=1)if(y=c.charAt(P),Object.prototype.hasOwnProperty.call(f,y)||(f[y]=x++,m[y]=!0),S=g+y,Object.prototype.hasOwnProperty.call(f,S))g=S;else{if(Object.prototype.hasOwnProperty.call(m,g)){if(g.charCodeAt(0)<256){for(u=0;u<b;u++)I=I<<1,C==l-1?(C=0,E.push(d(I)),I=0):C++;for(p=g.charCodeAt(0),u=0;u<8;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1}else{for(p=1,u=0;u<b;u++)I=I<<1|p,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=0;for(p=g.charCodeAt(0),u=0;u<16;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1}v--,v==0&&(v=Math.pow(2,b),b++),delete m[g]}else for(p=f[g],u=0;u<b;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1;v--,v==0&&(v=Math.pow(2,b),b++),f[S]=x++,g=String(y)}if(g!==""){if(Object.prototype.hasOwnProperty.call(m,g)){if(g.charCodeAt(0)<256){for(u=0;u<b;u++)I=I<<1,C==l-1?(C=0,E.push(d(I)),I=0):C++;for(p=g.charCodeAt(0),u=0;u<8;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1}else{for(p=1,u=0;u<b;u++)I=I<<1|p,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=0;for(p=g.charCodeAt(0),u=0;u<16;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1}v--,v==0&&(v=Math.pow(2,b),b++),delete m[g]}else for(p=f[g],u=0;u<b;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1;v--,v==0&&(v=Math.pow(2,b),b++)}for(p=2,u=0;u<b;u++)I=I<<1|p&1,C==l-1?(C=0,E.push(d(I)),I=0):C++,p=p>>1;for(;;)if(I=I<<1,C==l-1){E.push(d(I));break}else C++;return E.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,d){var u=[],p=4,f=4,m=3,y="",S=[],g,v,x,b,E,I,C,P={val:d(0),position:l,index:1};for(g=0;g<3;g+=1)u[g]=g;for(x=0,E=Math.pow(2,2),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;switch(x){case 0:for(x=0,E=Math.pow(2,8),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;C=n(x);break;case 1:for(x=0,E=Math.pow(2,16),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;C=n(x);break;case 2:return""}for(u[3]=C,v=C,S.push(C);;){if(P.index>c)return"";for(x=0,E=Math.pow(2,m),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;switch(C=x){case 0:for(x=0,E=Math.pow(2,8),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;u[f++]=n(x),C=f-1,p--;break;case 1:for(x=0,E=Math.pow(2,16),I=1;I!=E;)b=P.val&P.position,P.position>>=1,P.position==0&&(P.position=l,P.val=d(P.index++)),x|=(b>0?1:0)*I,I<<=1;u[f++]=n(x),C=f-1,p--;break;case 2:return S.join("")}if(p==0&&(p=Math.pow(2,m),m++),u[C])y=u[C];else if(C===f)y=v+v.charAt(0);else return null;S.push(y),u[f++]=v+y.charAt(0),p--,v=y,p==0&&(p=Math.pow(2,m),m++)}}};return a})();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})($f)),$f.exports}var _V=CV();const HD=Ws(_V);async function IV(t,e,n){const{elements:r,files:s}=e,i={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},o=new Map,a=new Map,c=t.getCurrentPageId(),l=new Map,d=[],u=new Set;r.forEach(g=>{if(l.set(g.id,He()),g.boundElements!==null)for(const v of g.boundElements)v.type==="text"&&u.add(v.id)});let p=Rj;for(const g of r){if(u.has(g.id))continue;const v=l.get(g.id),x={id:v,typeName:"shape",parentId:c,index:p,x:g.x,y:g.y,rotation:0,isLocked:g.locked,opacity:PV(g.opacity),meta:{}};switch(g.angle!==0&&a.set(v,g.angle),g.groupIds&&g.groupIds.length>0?o.has(g.groupIds[0])?o.get(g.groupIds[0])?.push(v):o.set(g.groupIds[0],[v]):d.push(v),g.type){case"rectangle":case"ellipse":case"diamond":{let b="",E="middle";if(g.boundElements!==null){for(const C of g.boundElements)if(C.type==="text"){const P=r.find(k=>k.id===C.id);P&&(b=P.text,E=jV[P.textAlign])}}const I=g.backgroundColor==="transparent"?g.strokeColor:g.backgroundColor;i.shapes.push({...x,type:"geo",props:{geo:g.type,url:g.link??"",w:g.width,h:g.height,size:xl[g.strokeWidth]??"draw",color:ha[I]??"black",text:b,align:E,dash:bl(g),fill:DV(g)}});break}case"freedraw":{i.shapes.push({...x,type:"draw",props:{dash:bl(g),size:xl[g.strokeWidth],color:ha[g.strokeColor]??"black",segments:[{type:"free",points:g.points.map(([b,E,I=.5])=>({x:b,y:E,z:I}))}]}});break}case"line":{if(g.points.slice().length<2)break;const E=Ga(g.points.length);i.shapes.push({...x,type:"line",props:{dash:bl(g),size:xl[g.strokeWidth],color:ha[g.strokeColor]??"black",spline:g.roundness?"cubic":"line",points:{...Object.fromEntries(g.points.map(([I,C],P)=>{const k=E[P];return[k,{id:k,index:k,x:I,y:C}]}))}}});break}case"arrow":{let b="";if(g.boundElements!==null){for(const k of g.boundElements)if(k.type==="text"){const T=r.find(M=>M.id===k.id);T&&(b=T.text)}}const E=g.points[0],I=g.points[g.points.length-1],C=l.get(g.startBinding?.elementId),P=l.get(g.endBinding?.elementId);i.shapes.push({...x,type:"arrow",props:{text:b,bend:OV(g,E,I),dash:bl(g),size:xl[g.strokeWidth]??"m",color:ha[g.strokeColor]??"black",start:{x:E[0],y:E[1]},end:{x:I[0],y:I[1]},arrowheadEnd:QI[g.endArrowhead]??"none",arrowheadStart:QI[g.startArrowhead]??"none"}}),C&&i.bindings.push({id:Si(),typeName:"binding",type:"arrow",fromId:v,toId:C,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),P&&i.bindings.push({id:Si(),typeName:"binding",type:"arrow",fromId:v,toId:P,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:b,scale:E}=kV(g.fontSize);i.shapes.push({...x,type:"text",props:{size:b,scale:E,font:TV[g.fontFamily]??"draw",color:ha[g.strokeColor]??"black",text:g.text,textAlign:RV[g.textAlign]}});break}case"image":{const b=s[g.fileId];if(!b)break;const E=fi.createId();i.assets.push({id:E,typeName:"asset",type:"image",props:{w:g.width,h:g.height,fileSize:b.size,name:g.id??"Untitled",isAnimated:!1,mimeType:b.mimeType,src:b.dataURL},meta:{}}),i.shapes.push({...x,type:"image",props:{w:g.width,h:g.height,assetId:E}})}}p=fr(p)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.mark("paste"),t.putContentOntoCurrentPage(i,{point:f,select:!1,preserveIds:!0});for(const g of o.values())if(g.length>1){t.groupShapes(g);const v=t.getShape(g[0]);v?.parentId&&vn(v.parentId)&&d.push(v.parentId)}for(const[g,v]of a)t.select(g),t.rotateShapesBy([g],v);const m=Te(d.map(g=>t.getShape(g))),y=ce.Common(m.map(g=>t.getShapePageBounds(g))),S=t.getViewportPageBounds().center;t.updateShapes(m.map(g=>{const v={x:(g.x??0)-(y.x+y.w/2),y:(g.y??0)-(y.y+y.h/2)};return{id:g.id,type:g.type,x:S.x+v.x,y:S.y+v.y}})),t.setSelectedShapes(d)}const PV=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},xl={1:"s",2:"m",3:"l",4:"xl"},EV={16:"s",20:"m",28:"l",36:"xl"};function kV(t){const e=EV[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const TV={1:"draw",2:"sans",3:"mono"},ha={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},MV={solid:"draw",dashed:"dashed",dotted:"dotted"},AV={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},jV={left:"start",center:"middle",right:"end"},RV={left:"start",center:"middle",right:"end"},QI={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function OV(t,e,n){let r=0;if(t.points.length>2){const s=new w(e[0],e[1]),i=new w(n[0],n[1]),o=new w(t.points[1][0],t.points[1][1]),a=w.Sub(i,s),c=w.Per(a),l=w.Med(i,s),d=w.Sub(l,c),u=w.Add(l,c),p=w.NearestPointOnLineSegment(d,u,o,!1);r=w.Dist(p,l),w.Clockwise(p,i,l)&&(r*=-1)}return r}const bl=t=>{let e=MV[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},DV=t=>t.backgroundColor==="transparent"?"none":AV[t.fillStyle]??"solid";async function LV(t,e,n,r){const i=(await Promise.all(e.map(async o=>await(await Nr(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));t.mark("paste"),await t.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),e.forEach(o=>URL.revokeObjectURL(o))}function NV(t,e,n){const r=t.getSelectionPageBounds();t.mark("paste"),t.putContentOntoCurrentPage(e,{point:n,select:!0});const s=t.getSelectionPageBounds();r&&s&&r?.collides(s)&&(t.updateInstanceState({isChangingStyle:!0}),t.timers.setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1})},150))}async function Xx(t,e,n,r){return t.mark("paste"),await t.putExternalContent({type:"url",point:n,url:e,sources:r})}function FV(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const BV=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},$V=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return ZR(e)},zV=t=>/^<svg/.test(t),UV=["input","select","textarea"];function zf(t){const{activeElement:e}=document;return t.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||UV.indexOf(e.tagName.toLowerCase())>-1)}const qV=t=>t.types.find(e=>e.match(/^image\//)),Uf=(t,e,n,r)=>{const s=$V(e);if(s)for(const i of s)Xx(t,i,n);else BV(e)?Xx(t,e,n):zV(e)?(t.mark("paste"),t.putExternalContent({type:"svg-text",text:e,point:n,sources:r})):(t.mark("paste"),t.putExternalContent({type:"text",text:e,point:n,sources:r}))},HV=async(t,e,n)=>{if(t.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const s of Object.values(e.items))switch(s.kind){case"file":{r.push({type:"file",source:new Promise(i=>i(s.getAsFile()))});break}case"string":{s.type==="text/html"?r.push({type:"html",source:new Promise(i=>s.getAsString(i))}):s.type==="text/plain"?r.push({type:"text",source:new Promise(i=>s.getAsString(i))}):r.push({type:s.type,source:new Promise(i=>s.getAsString(i))});break}}KD(t,r,n)},GD=async(t,e,n)=>{const r=[];for(const s of e){if(qV(s))for(const i of s.types)i.match(/^image\//)&&r.push({type:"blob",source:s.getType(i)});s.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const i=await s.getType("text/html");return await yi.blobToText(i)})()}),s.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const i=await s.getType("text/uri-list");return await yi.blobToText(i)})()}),s.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const i=await s.getType("text/plain");return await yi.blobToText(i)})()})}return await KD(t,r,n)};async function KD(t,e,n){const r=e.filter(i=>(i.type==="file"||i.type==="blob")&&i.source!==null);if(r.length){const o=(await Promise.all(r.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await LV(t,o,n)}const s=await Promise.all(e.filter(i=>i.type!=="file").map(i=>new Promise(o=>{const a=i;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{const l=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(l)try{const d=HD.decompressFromBase64(l);if(d===null){o({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const u=JSON.parse(d);if(u.type!=="application/tldraw"&&o({type:"error",data:u,reason:`found tldraw data comment but JSON was of a different type: ${u.type}`}),typeof u.data=="string"){o({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:u.data});return}}catch{o({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const d=JSON.parse(c);if(d.type==="excalidraw/clipboard"){o({type:"excalidraw",data:d});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const i of s)if(i.type==="tldraw"){NV(t,i.data,n);return}for(const i of s)if(i.type==="excalidraw"){IV(t,i.data,n);return}for(const i of s)if(i.type==="text"&&i.subtype==="html"){const a=new DOMParser().parseFromString(i.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");Uf(t,l,n,s);return}if(!s.some(l=>l.type==="text"&&l.subtype!=="html")&&i.data.trim()){Uf(t,FV(i.data),n,s);return}}for(const i of s)if(i.type==="text"&&i.subtype==="url"){Xx(t,i.data,n,s);return}for(const i of s)if(i.type==="text"&&i.subtype==="text"&&i.data.trim()){Uf(t,i.data,n,s);return}}const hd=async t=>{const e=await t.resolveAssetsInContent(t.getContentFromCurrentPage(t.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=HD.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const r=e.shapes.map(s=>t.isShapeOfType(s,"text")||t.isShapeOfType(s,"geo")||t.isShapeOfType(s,"arrow")?s.props.text:t.isShapeOfType(s,"bookmark")||t.isShapeOfType(s,"embed")?s.props.url:null).filter(Ez);if(navigator.clipboard?.write){const s=new Blob([`<div data-tldraw>${n}</div>`],{type:"text/html"});let i=r.join(" ");i===""&&(i=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([i],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${n}</div>`)}};function GV(){const t=K(),e=Gt(),n=_.useCallback(async function(o){t.getSelectedShapeIds().length!==0&&(await hd(t),e("copy",{source:o}))},[t,e]),r=_.useCallback(async function(o){t.getSelectedShapeIds().length!==0&&(await hd(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:o}))},[t,e]),s=_.useCallback(async function(o,a,c){t.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(GD(t,o,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{s(l,a,c)}))},[t,e]);return{copy:n,cut:r,paste:s}}function KV(){const t=K(),e=Gt(),n=X("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);_.useEffect(()=>{if(!n)return;const r=async c=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||zf(t)||(Le(c),await hd(t),e("copy",{source:"kbd"}))};async function s(c){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||zf(t)||(Le(c),await hd(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let i=!1;const o=c=>{c.button===1&&(i=!0,t.timers.requestAnimationFrame(()=>{i=!1}))},a=c=>{if(i){jt(c);return}if(t.getEditingShapeId()!==null||zf(t))return;let l,d=!1;t.inputs.shiftKey&&(d=!0),t.user.getIsPasteAtCursorMode()&&(d=!d),d&&(l=t.inputs.currentPagePoint),c.clipboardData&&!t.inputs.shiftKey?HV(t,c.clipboardData,l):navigator.clipboard.read().then(u=>{Array.isArray(u)&&u[0]instanceof ClipboardItem&&GD(t,u,l)}),Le(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",s),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",s),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[t,e,n])}async function VD(t,e,n){const{type:r,quality:s,scale:i,width:o,height:a}=n;let[c,l]=await D7(o*i,a*i);c=Math.floor(c),l=Math.floor(l);const d=c/o,u=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(m=>{const y=mo();y.crossOrigin="anonymous",y.onload=async()=>{t.environment.isSafari&&await new Promise(v=>t.timers.setTimeout(v,250));const S=document.createElement("canvas"),g=S.getContext("2d");S.width=c,S.height=l,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(y,0,0,c,l),URL.revokeObjectURL(u),m(S)},y.onerror=()=>{m(null)},y.src=u});if(!p)return null;const f=await new Promise(m=>p.toBlob(y=>{(!y||yt.throwToBlob.get())&&m(null),m(y)},"image/"+r,s));if(!f)return null;if(r==="png"){const m=new DataView(await f.arrayBuffer());return Mr.setPhysChunk(m,d,{type:"image/"+r})}else return f}async function WD(t,e,n){const r=await t.getSvgString(e?.length?e:[...t.getCurrentPageShapeIds()],{scale:1,background:t.getInstanceState().exportBackground,...n});if(!r)throw new Error("Could not construct SVG.");return r}async function Zx(t,e,n,r={}){switch(n){case"svg":return(await WD(t,e,r))?.svg;case"json":{const s=await t.resolveAssetsInContent(t.getContentFromCurrentPage(e));return JSON.stringify(s)}default:tn(n)}}async function xw({editor:t,ids:e,format:n,opts:r={}}){switch(n){case"svg":return new Blob([await Zx(t,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await Zx(t,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await WD(t,e,r);if(!s)throw new Error("Could not construct image.");const i=await VD(t,s.svg,{type:n,quality:1,scale:2,width:s.width,height:s.height});if(!i)throw new Error("Could not construct image.");return i}default:tn(n)}}const VV={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function WV(t,e,n,r={}){return{blobPromise:xw({editor:t,ids:e,format:n,opts:r}),mimeType:VV[n]}}function YV(t,e,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:s,mimeType:i}=WV(t,e,n,r);return window.navigator.clipboard.write([new ClipboardItem({[i]:s})]).catch(o=>(console.error(o),s.then(a=>window.navigator.clipboard.write([new ClipboardItem({[i]:a})]))))}switch(n){case"json":case"svg":return XV(async()=>Zx(t,e,n,r));case"jpeg":case"png":throw new Error("Copy not supported");default:tn(n)}}async function XV(t){await navigator.clipboard?.writeText?.(await t())}function ZV(){const t=K(),{addToast:e}=_r(),n=Re();return _.useCallback((r,s="svg")=>{YV(t,r,s).catch(()=>{e({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[t,e,n])}async function QV(t,e,n="png",r,s={}){if(!r&&(r=`shapes at ${JI()}`,e.length===1)){const a=t.getShape(e[0]);t.isShapeOfType(a,"frame")?r=a.props.name??"frame":r=`${a.id.replace(/:/,"_")} at ${JI()}`}r+=`.${n}`;const i=await xw({editor:t,ids:e,format:n,opts:s}),o=new File([i],r,{type:i.type});JV(o)}function JI(){const t=new Date,e=String(t.getFullYear()).slice(2),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${s}.${i}.${o}`}function JV(t){const e=document.createElement("a"),n=URL.createObjectURL(t);e.href=n,e.download=t.name,e.click(),URL.revokeObjectURL(n)}function eW(){const t=K(),{addToast:e}=_r(),n=Re();return _.useCallback((r,s="png",i)=>{QV(t,r,s,i,{scale:1,background:t.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[t,e,n])}async function tW(t,e,n){const r=Te(e.map(a=>{const c=t.getShape(a);if(!(!c||t.getShapeUtil(c.type).toSvg===void 0))return c}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||t.isShapeOfType(a,"image"))return}const s=[];if(n!==void 0){const a=r.map(c=>({shape:c,bounds:t.getShapeMaskedPageBounds(c).clone().expandBy(n)}));for(let c=0;c<a.length;c++){const l=a[c];if(c===0){s[0]={shapes:[l.shape],bounds:l.bounds};continue}let d=!1;for(const u of s)if(u.bounds.includes(l.bounds)){u.shapes.push(l.shape),u.bounds.expand(l.bounds),d=!0;break}d||s.push({shapes:[l.shape],bounds:l.bounds})}}else{const a=ce.Common(r.map(c=>t.getShapeMaskedPageBounds(c)));s.push({shapes:r,bounds:a})}const i=t.options.flattenImageBoundsPadding;for(const a of s){n!==void 0&&a.bounds.expandBy(-n);const c=await t.getSvgString(a.shapes,{padding:i});if(!c?.svg)continue;const l=new Blob([c.svg],{type:"image/svg+xml"}),d=await t.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});d&&(a.asset=d)}const o=[];return Or(()=>{for(const a of s){const{asset:c,bounds:l,shapes:d}=a;if(!c)continue;const u=t.findCommonAncestor(d)??t.getCurrentPageId();if(!u)continue;let p="a1";for(const g of d)if(g.parentId===u){g.index>p&&(p=g.index);break}let f,m,y;if(vn(u)){const g=t.getShape(u);if(!g)continue;const v=t.getPointInShapeSpace(g,{x:l.x,y:l.y});y=t.getShapePageTransform(u).rotation(),v.sub(new w(i,i).rot(-y)),f=v.x,m=v.y}else f=l.x-i,m=l.y-i,y=0;t.deleteShapes(d),t.createAssets([{...c,id:c.id}]);const S=He();t.createShape({id:S,type:"image",index:p,parentId:u,x:f,y:m,rotation:-y,props:{assetId:c.id,w:l.w+i*2,h:l.h+i*2}}),o.push(S)}}),o}function eu(){return K().store.props.collaboration!==void 0}function nW(){const t=K();return X("sync status",()=>t.store.props.collaboration?.status?t.store.props.collaboration.status.get():null,[t])}function rW(){const t=K(),e=_.useRef(null),n=_.useRef(null);return _.useCallback(async function(){const s=document.createElement("div"),i=document.createElement("style"),o=(g,v)=>{g&&(g.innerHTML=""),v&&document.head.contains(v)&&document.head.removeChild(v),g&&document.body.contains(g)&&document.body.removeChild(g)};o(e.current,n.current),e.current=s,n.current=i;const a=`tl-print-surface-${lt()}`;s.className=a,i.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(i),document.body.appendChild(s)},l=()=>{t.once("tick",()=>{o(s,i)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function d(g,v,x){try{s.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${g.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${x}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${v?"":"hide"}">
          ${v??""}
        </div>
      </div>`}catch(b){console.error(b)}}function u(){t.environment.isChromeForIos?(c(),window.print()):t.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=t.getSelectedShapeIds(),f=t.getCurrentPageId(),m=t.getPages(),S={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const g=await t.getSvgString(p,S);if(g){const v=m.find(x=>x.id===f);d(`tldraw — ${v?.name}`,null,g.svg),u()}}else{const g=t.getCurrentPage(),v=await t.getSvgString(t.getSortedChildIdsForParent(g.id),S);v&&(d(`tldraw — ${g.name}`,null,v.svg),u())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[t])}const YD=_.createContext(null);function sW(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function Xi(t,e){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||e}function iW({overrides:t,children:e}){const n=K(),r=eu(),{addDialog:s,clearDialogs:i}=Di(),{clearToasts:o,addToast:a}=_r(),c=Re(),l=$D(),d=rW(),{cut:u,copy:p,paste:f}=GV(),m=ZV(),y=eW(),S=c("document.default-name"),g=Gt(),v=_.useMemo(()=>{function x(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function b(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}const E=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(C){b()&&(x()||(g("edit-link",{source:C}),n.mark("edit-link"),s({component:bV})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(C){g("insert-embed",{source:C}),s({component:BD})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(C){g("insert-media",{source:C}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(C){g("undo",{source:C}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(C){g("redo",{source:C}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("export-as",{format:"svg",source:C}),y(P,"svg",Xi(n,S)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("export-as",{format:"png",source:C}),y(P,"png",Xi(n,S)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("export-as",{format:"json",source:C}),y(P,"json",Xi(n,S)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("export-all-as",{format:"svg",source:C}),y(Array.from(n.getCurrentPageShapeIds()),"svg",Xi(n,S)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(C){const P=Array.from(n.getCurrentPageShapeIds().values());P.length!==0&&(g("export-all-as",{format:"png",source:C}),y(P,"png",Xi(n,S)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(C){const P=Array.from(n.getCurrentPageShapeIds().values());P.length!==0&&(g("export-all-as",{format:"json",source:C}),y(P,"json",Xi(n,S)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("copy-as",{format:"svg",source:C}),m(P,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("copy-as",{format:"png",source:C}),m(P,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(C){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(g("copy-as",{format:"json",source:C}),m(P,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(C){if(!b()||x())return;g("toggle-auto-size",{source:C}),n.mark("toggling auto size");const P=n.getSelectedShapes().filter(k=>n.isShapeOfType(k,"text")&&k.props.autoSize===!1);n.updateShapes(P.map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}}))),Ve(n,P.map(k=>k.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(C){g("open-embed-link",{source:C});const P=n.getSelectedShapeIds(),k="No embed shapes selected";if(P.length!==1){console.error(k);return}const T=n.getShape(P[0]);if(!T||!n.isShapeOfType(T,"embed")){console.error(k);return}Q9(T.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(C){if(n.root.getCurrent()?.id!=="zoom"&&(g("zoom-tool",{source:C}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const P=n.root.getCurrent();P&&P.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:P.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(C){b()&&(x()||n.run(()=>{g("convert-to-bookmark",{source:C});const P=n.getSelectedShapes(),k=[],T=[];for(const M of P){if(!M||!n.isShapeOfType(M,"embed")||!M.props.url)continue;const A=new w(M.x,M.y);A.rot(-M.rotation),A.add(new w(M.props.w/2-300/2,M.props.h/2-320/2)),A.rot(M.rotation);const j={id:He(),type:"bookmark",rotation:M.rotation,x:A.x,y:A.y,opacity:1,props:{url:M.props.url}};k.push(j),T.push(M.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(T),n.createShapes(k)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(C){b()&&(x()||(g("convert-to-embed",{source:C}),n.run(()=>{const P=n.getSelectedShapeIds(),k=Te(P.map(A=>n.getShape(A))),T=[],M=[];for(const A of k){if(!n.isShapeOfType(A,"bookmark"))continue;const{url:j}=A.props,R=Ls(A.props.url);if(!R||!R.definition)continue;const{width:L,height:F}=R.definition,H=new w(A.x,A.y);H.rot(-A.rotation),H.add(new w(A.props.w/2-L/2,A.props.h/2-F/2)),H.rot(A.rotation);const B={id:He(),type:"embed",x:H.x,y:H.y,rotation:A.rotation,props:{url:j,w:L,h:F}};T.push(B),M.push(A.id)}n.mark("convert shapes to embed"),n.deleteShapes(M),n.createShapes(T)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(C){if(!b()||x())return;g("duplicate-shapes",{source:C});const P=n.getInstanceState();let k,T;if(P.duplicateProps)k=P.duplicateProps.shapeIds,T=P.duplicateProps.offset;else{k=n.getSelectedShapeIds();const M=ce.Common(Te(k.map(A=>n.getShapePageBounds(A))));T=n.getCameraOptions().isLocked?{x:n.options.adjacentShapeMargin,y:n.options.adjacentShapeMargin}:{x:M.width+n.options.adjacentShapeMargin,y:0}}n.mark("duplicate shapes"),n.duplicateShapes(k,T),P.duplicateProps&&n.updateInstanceState({duplicateProps:{...P.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(C){b()&&(x()||(g("ungroup-shapes",{source:C}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(C){if(!b()||x())return;g("group-shapes",{source:C});const P=n.getOnlySelectedShape();P&&n.isShapeOfType(P,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(C){if(!b())return;g("remove-frame",{source:C});const P=n.getSelectedShapes();P.length>0&&P.every(k=>n.isShapeOfType(k,"frame"))&&(n.mark("remove-frame"),SV(n,P.map(k=>k.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(C){if(!b())return;g("fit-frame-to-content",{source:C});const P=n.getOnlySelectedShape();P&&n.isShapeOfType(P,"frame")&&(n.mark("fit-frame-to-content"),xV(n,P.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"left",source:C}),n.mark("align left");const P=n.getSelectedShapeIds();n.alignShapes(P,"left"),Ve(n,P)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"center-horizontal",source:C}),n.mark("align center horizontal");const P=n.getSelectedShapeIds();n.alignShapes(P,"center-horizontal"),Ve(n,P)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"right",source:C}),n.mark("align right");const P=n.getSelectedShapeIds();n.alignShapes(P,"right"),Ve(n,P)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"center-vertical",source:C}),n.mark("align center vertical");const P=n.getSelectedShapeIds();n.alignShapes(P,"center-vertical"),Ve(n,P)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"top",source:C}),n.mark("align top");const P=n.getSelectedShapeIds();n.alignShapes(P,"top"),Ve(n,P)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(C){if(!b()||x())return;g("align-shapes",{operation:"bottom",source:C}),n.mark("align bottom");const P=n.getSelectedShapeIds();n.alignShapes(P,"bottom"),Ve(n,P)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(C){if(!b()||x())return;g("distribute-shapes",{operation:"horizontal",source:C}),n.mark("distribute horizontal");const P=n.getSelectedShapeIds();n.distributeShapes(P,"horizontal"),Ve(n,P)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(C){if(!b()||x())return;g("distribute-shapes",{operation:"vertical",source:C}),n.mark("distribute vertical");const P=n.getSelectedShapeIds();n.distributeShapes(P,"vertical"),Ve(n,P)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(C){if(!b()||x())return;g("stretch-shapes",{operation:"horizontal",source:C}),n.mark("stretch horizontal");const P=n.getSelectedShapeIds();n.stretchShapes(P,"horizontal"),Ve(n,P)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(C){if(!b()||x())return;g("stretch-shapes",{operation:"vertical",source:C}),n.mark("stretch vertical");const P=n.getSelectedShapeIds();n.stretchShapes(P,"vertical"),Ve(n,P)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(C){if(!b()||x())return;g("flip-shapes",{operation:"horizontal",source:C}),n.mark("flip horizontal");const P=n.getSelectedShapeIds();n.flipShapes(P,"horizontal"),Ve(n,P)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(C){if(!b()||x())return;g("flip-shapes",{operation:"vertical",source:C}),n.mark("flip vertical");const P=n.getSelectedShapeIds();n.flipShapes(P,"vertical"),Ve(n,P)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(C){if(!b()||x())return;g("pack-shapes",{source:C}),n.mark("pack");const P=n.getSelectedShapeIds();n.packShapes(P,n.options.adjacentShapeMargin),Ve(n,P)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(C){if(!b()||x())return;g("stack-shapes",{operation:"vertical",source:C}),n.mark("stack-vertical");const P=n.getSelectedShapeIds();n.stackShapes(P,"vertical",16),Ve(n,P)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(C){if(!b()||x())return;g("stack-shapes",{operation:"horizontal",source:C}),n.mark("stack-horizontal");const P=n.getSelectedShapeIds();n.stackShapes(P,"horizontal",16),Ve(n,P)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(C){b()&&(x()||(g("reorder-shapes",{operation:"toFront",source:C}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(C){b()&&(x()||(g("reorder-shapes",{operation:"forward",source:C}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(C){b()&&(x()||(g("reorder-shapes",{operation:"backward",source:C}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(C){b()&&(x()||(g("reorder-shapes",{operation:"toBack",source:C}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(C){b()&&(x()||(n.mark("cut"),u(C)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(C){b()&&(x()||p(C))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(C){navigator.clipboard?.read().then(P=>{f(P,C,C==="context-menu"?n.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(C){n.run(()=>{x()||(g("select-all-shapes",{source:C}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(C){b()&&(x()||(g("select-none-shapes",{source:C}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(C){b()&&(x()||(g("delete-shapes",{source:C}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(C){if(!b()||x())return;g("rotate-cw",{source:C}),n.mark("rotate-cw");const P=n.getSelectionRotation()%(Xe/2),k=$s(P,0)||$s(P,Xe/2),T=n.getSelectedShapeIds();n.rotateShapesBy(T,Xe/2-(k?0:P)),Ve(n,T)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(C){if(!b()||x())return;g("rotate-ccw",{source:C}),n.mark("rotate-ccw");const P=n.getSelectionRotation()%(Xe/2),k=$s(P,0),T=n.getSelectedShapeIds();n.rotateShapesBy(T,k?-(Xe/2):-P),Ve(n,T)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(C){g("zoom-in",{source:C}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(C){g("zoom-out",{source:C}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(C){g("reset-zoom",{source:C}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(C){g("zoom-to-fit",{source:C}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(C){b()&&(x()||(g("zoom-to-selection",{source:C}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(C){g("toggle-snap-mode",{source:C}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(C){const P=n.user.getIsDarkMode()?"light":"dark";g("color-scheme",{source:C,value:P}),n.user.updateUserPreferences({colorScheme:P})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(C){g("toggle-wrap-mode",{source:C}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(C){g("toggle-dynamic-size-mode",{source:C}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(C){g("toggle-paste-at-cursor",{source:C}),n.user.updateUserPreferences({isPasteAtCursorMode:!n.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(C){g("toggle-reduce-motion",{source:C}),n.user.updateUserPreferences({animationSpeed:n.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(C){g("toggle-edge-scrolling",{source:C}),n.user.updateUserPreferences({edgeScrollSpeed:n.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(C){g("toggle-transparent",{source:C}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(C){g("toggle-tool-lock",{source:C}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(C){g("unlock-all",{source:C});const P=[];for(const k of n.getCurrentPageShapes())k.isLocked&&P.push({id:k.id,type:k.type,isLocked:!1});P.length>0&&n.updateShapes(P)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(C){n.timers.requestAnimationFrame(()=>{n.run(()=>{g("toggle-focus-mode",{source:C}),i(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(C){g("toggle-grid-mode",{source:C}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(C){g("toggle-debug-mode",{source:C}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(C){g("print",{source:C}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(C){g("exit-pen-mode",{source:C}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(C){g("stop-following",{source:C}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(C){g("zoom-to-content",{source:C});const P=n.getSelectionPageBounds()??n.getCurrentPageBounds();P&&n.zoomToBounds(P,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(C){n.mark("locking"),g("toggle-lock",{source:C}),n.toggleLock(n.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(C){const P=ds.createId(),k=n.getSelectedShapeIds();n.run(()=>{n.mark("move_shapes_to_page"),n.createPage({name:c("page-menu.new-page-initial-name"),id:P}),n.moveShapesToPage(k,P)}),g("move-to-new-page",{source:C})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(C){const P=zn;n.run(()=>{n.mark("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(P,"white"),n.setStyleForNextShapes(P,"white")}),g("set-style",{source:C,id:P.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(C){const P=Ci;n.run(()=>{n.mark("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(P,"fill"),n.setStyleForNextShapes(P,"fill")}),g("set-style",{source:C,id:P.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async C=>{const P=n.getSelectedShapeIds();if(P.length===0)return;n.mark("flattening to image"),g("flatten-to-image",{source:C});const k=await tW(n,P,n.options.flattenImageBoundsExpand);k?.length&&n.setSelectedShapes(k)}}];r&&E.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(C){g("open-cursor-chat",{source:C}),!n.getInstanceState().isCoarsePointer&&n.timers.requestAnimationFrame(()=>{n.updateInstanceState({isChatting:!0})})}});const I=sW(E);return t?t(n,I,void 0):I},[n,g,t,s,a,l,y,m,u,p,f,i,o,d,c,S,r]);return h.jsx(YD.Provider,{value:v,children:e})}function ye(){const t=_.useContext(YD);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function Qa(t,e){return t?typeof t=="string"?t:e?t[e]??t.default:void 0:void 0}function Na(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t?.(s),n===!1||!s.defaultPrevented)return e?.(s)}}function oW(t){const e=aW(t),n=_.forwardRef((r,s)=>{const{children:i,...o}=r,a=_.Children.toArray(i),c=a.find(lW);if(c){const l=c.props.children,d=a.map(u=>u===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:u);return h.jsx(e,{...o,ref:s,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return h.jsx(e,{...o,ref:s,children:i})});return n.displayName=`${t}.Slot`,n}function aW(t){const e=_.forwardRef((n,r)=>{const{children:s,...i}=n;if(_.isValidElement(s)){const o=uW(s),a=dW(i,s.props);return s.type!==_.Fragment&&(a.ref=r?xd(r,o):o),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var cW=Symbol("radix.slottable");function lW(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===cW}function dW(t,e){const n={...e};for(const r in e){const s=t[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...a)=>{const c=i(...a);return s(...a),c}:s&&(n[r]=s):r==="style"?n[r]={...s,...i}:r==="className"&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...t,...n}}function uW(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var hW=bd[" useInsertionEffect ".trim().toString()]||wd;function pW({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[s,i,o]=fW({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:s;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const u=d.current;u!==a&&console.warn(`${r} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const u=gW(d)?d(t):d;u!==t&&o.current?.(u)}else i(d)},[a,t,i,o]);return[c,l]}function fW({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),s=_.useRef(n),i=_.useRef(e);return hW(()=>{i.current=e},[e]),_.useEffect(()=>{s.current!==n&&(i.current?.(n),s.current=n)},[n,s]),[n,r,i]}function gW(t){return typeof t=="function"}var tu="Popover",[XD]=lc(tu,[Cd]),_c=Cd(),[mW,Js]=XD(tu),ZD=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:s,onOpenChange:i,modal:o=!1}=t,a=_c(e),c=_.useRef(null),[l,d]=_.useState(!1),[u,p]=pW({prop:r,defaultProp:s??!1,onChange:i,caller:tu});return h.jsx(hb,{...a,children:h.jsx(mW,{scope:e,contentId:Ua(),triggerRef:c,open:u,onOpenChange:p,onOpenToggle:_.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:l,onCustomAnchorAdd:_.useCallback(()=>d(!0),[]),onCustomAnchorRemove:_.useCallback(()=>d(!1),[]),modal:o,children:n})})};ZD.displayName=tu;var QD="PopoverAnchor",yW=_.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,s=Js(QD,n),i=_c(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=s;return _.useEffect(()=>(o(),()=>a()),[o,a]),h.jsx(pb,{...i,...r,ref:e})});yW.displayName=QD;var JD="PopoverTrigger",eL=_.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,s=Js(JD,n),i=_c(n),o=Un(e,s.triggerRef),a=h.jsx(Tn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":iL(s.open),...r,ref:o,onClick:Na(t.onClick,s.onOpenToggle)});return s.hasCustomAnchor?a:h.jsx(pb,{asChild:!0,...i,children:a})});eL.displayName=JD;var bw="PopoverPortal",[SW,vW]=XD(bw,{forceMount:void 0}),tL=t=>{const{__scopePopover:e,forceMount:n,children:r,container:s}=t,i=Js(bw,e);return h.jsx(SW,{scope:e,forceMount:n,children:h.jsx(Mo,{present:n||i.open,children:h.jsx(yA,{asChild:!0,container:s,children:r})})})};tL.displayName=bw;var Co="PopoverContent",nL=_.forwardRef((t,e)=>{const n=vW(Co,t.__scopePopover),{forceMount:r=n.forceMount,...s}=t,i=Js(Co,t.__scopePopover);return h.jsx(Mo,{present:r||i.open,children:i.modal?h.jsx(bW,{...s,ref:e}):h.jsx(wW,{...s,ref:e})})});nL.displayName=Co;var xW=oW("PopoverContent.RemoveScroll"),bW=_.forwardRef((t,e)=>{const n=Js(Co,t.__scopePopover),r=_.useRef(null),s=Un(e,r),i=_.useRef(!1);return _.useEffect(()=>{const o=r.current;if(o)return wA(o)},[]),h.jsx(CA,{as:xW,allowPinchZoom:!0,children:h.jsx(rL,{...t,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Na(t.onCloseAutoFocus,o=>{o.preventDefault(),i.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Na(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,l=a.button===2||c;i.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:Na(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),wW=_.forwardRef((t,e)=>{const n=Js(Co,t.__scopePopover),r=_.useRef(!1),s=_.useRef(!1);return h.jsx(rL,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(r.current||n.triggerRef.current?.focus(),i.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;n.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),rL=_.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:d,...u}=t,p=Js(Co,n),f=_c(n);return _A(),h.jsx(IA,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:i,children:h.jsx(SA,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>p.onOpenChange(!1),children:h.jsx(vA,{"data-state":iL(p.open),role:"dialog",id:p.contentId,...f,...u,ref:e,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),sL="PopoverClose",CW=_.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,s=Js(sL,n);return h.jsx(Tn.button,{type:"button",...r,ref:e,onClick:Na(t.onClick,()=>s.onOpenChange(!1))})});CW.displayName=sL;var _W="PopoverArrow",IW=_.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,s=_c(n);return h.jsx(xA,{...s,...r,ref:e})});IW.displayName=_W;function iL(t){return t?"open":"closed"}var ww=ZD,Cw=eL,_w=tL,Iw=nL;function Ss(t,e){const n=K(),r=_.useRef(!1),s=Gt(),i=_.useCallback(a=>{r.current=a,n.run(()=>{a?(n.complete(),n.addOpenMenu(t)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(c=>!c.startsWith(t))}),e?.(a)})},[n,t,e]),o=X("is menu open",()=>n.getOpenMenus().includes(t),[n,t]);return _.useEffect(()=>(r.current&&(s("open-menu",{source:"unknown",id:t}),n.addOpenMenu(t)),()=>{r.current&&(n.deleteOpenMenu(t),n.getOpenMenus().forEach(a=>{a.startsWith(t)&&(s("close-menu",{source:"unknown",id:t}),n.deleteOpenMenu(a))}),r.current=!1)}),[n,t,s]),[o,i]}function Pw({id:t,children:e,onOpenChange:n,open:r}){const[s,i]=Ss(t,n);return h.jsx(ww,{onOpenChange:i,open:r||s,children:h.jsx("div",{className:"tlui-popover",children:e})})}function Ew({children:t}){return h.jsx(Cw,{asChild:!0,dir:"ltr",children:t})}function kw({side:t,children:e,align:n="center",sideOffset:r=8,alignOffset:s=0}){const i=Dt();return h.jsx(_w,{container:i,children:h.jsx(Iw,{className:"tlui-popover__content",side:t,sideOffset:r,align:n,alignOffset:s,dir:"ltr",children:e})})}const oL=_.createContext(null);function nu(){const t=_.useContext(oL);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function sr({type:t,sourceId:e,children:n}){return h.jsx(oL.Provider,{value:{type:t,sourceId:e},children:n})}function PW(t){return t.getSelectedShapeIds().map(r=>t.getShape(r)).filter(r=>{if(!r)return!1;if(t.isShapeOfType(r,"arrow")){const s=wn(t,r);if(s.start||s.end)return!1}return!0})}const aL=()=>{const t=K();return X("threeStackableItems",()=>PW(t).length>2,[t])},vs=()=>{const t=K();return X("isInSelectState",()=>t.isIn("select"),[t])},cL=()=>{const t=K();return X("allow group",()=>{const e=t.getSelectedShapes();if(e.length<2)return!1;for(const n of e)if(t.isShapeOfType(n,"arrow")){const r=wn(t,n);if(r.start&&!e.some(s=>s.id===r.start.toId)||r.end&&!e.some(s=>s.id===r.end.toId))return!1}return!0},[t])},lL=()=>{const t=K();return X("allowUngroup",()=>t.getSelectedShapeIds().some(e=>t.getShape(e)?.type==="group"),[t])},EW=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function dL(t,e){const n=K();return X("selectedShapes",()=>n.getSelectedShapes().length>=t,[n,t,e])}function pn(t,e){const n=K();return X("selectedShapes",()=>{const r=n.getSelectedShapes().filter(s=>!n.isShapeOrAncestorLocked(s)).length;return t===void 0?r:r>=t},[n])}function kW(){const t=K();return X("showAutoSizeToggle",()=>{const e=t.getSelectedShapes();return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}function uL(){const t=K();return X("hasLinkShapeSelected",()=>{const e=t.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[t])}function TW(){const t=K();return X("onlyFlippableShape",()=>{const e=t.getOnlySelectedShape();return e&&(t.isShapeOfType(e,"group")||t.isShapeOfType(e,"image")||t.isShapeOfType(e,"arrow")||t.isShapeOfType(e,"line")||t.isShapeOfType(e,"draw"))},[t])}function hL(){const t=K();return X("useCanRedo",()=>t.getCanRedo(),[t])}function pL(){const t=K();return X("useCanUndo",()=>t.getCanUndo(),[t])}function pa(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t?.(s),n===!1||!s.defaultPrevented)return e?.(s)}}function St(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t?.(s),n===!1||!s.defaultPrevented)return e?.(s)}}function MW(t){const e=AW(t),n=_.forwardRef((r,s)=>{const{children:i,...o}=r,a=_.Children.toArray(i),c=a.find(RW);if(c){const l=c.props.children,d=a.map(u=>u===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:u);return h.jsx(e,{...o,ref:s,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return h.jsx(e,{...o,ref:s,children:i})});return n.displayName=`${t}.Slot`,n}function AW(t){const e=_.forwardRef((n,r)=>{const{children:s,...i}=n;if(_.isValidElement(s)){const o=DW(s),a=OW(i,s.props);return s.type!==_.Fragment&&(a.ref=r?xd(r,o):o),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var jW=Symbol("radix.slottable");function RW(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===jW}function OW(t,e){const n={...e};for(const r in e){const s=t[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...a)=>{const c=i(...a);return s(...a),c}:s&&(n[r]=s):r==="style"?n[r]={...s,...i}:r==="className"&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...t,...n}}function DW(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Qx=["Enter"," "],LW=["ArrowDown","PageUp","Home"],fL=["ArrowUp","PageDown","End"],NW=[...LW,...fL],FW={ltr:[...Qx,"ArrowRight"],rtl:[...Qx,"ArrowLeft"]},BW={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ic="Menu",[Ja,$W,zW]=MA(Ic),[Li,ru]=lc(Ic,[zW,Cd,AA]),Pc=Cd(),gL=AA(),[mL,ei]=Li(Ic),[UW,Ec]=Li(Ic),yL=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:s,onOpenChange:i,modal:o=!0}=t,a=Pc(e),[c,l]=_.useState(null),d=_.useRef(!1),u=_d(i),p=PA(s);return _.useEffect(()=>{const f=()=>{d.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>d.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),h.jsx(hb,{...a,children:h.jsx(mL,{scope:e,open:n,onOpenChange:u,content:c,onContentChange:l,children:h.jsx(UW,{scope:e,onClose:_.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:p,modal:o,children:r})})})};yL.displayName=Ic;var qW="MenuAnchor",Tw=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,s=Pc(n);return h.jsx(pb,{...s,...r,ref:e})});Tw.displayName=qW;var Mw="MenuPortal",[HW,SL]=Li(Mw,{forceMount:void 0}),vL=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:s}=t,i=ei(Mw,e);return h.jsx(HW,{scope:e,forceMount:n,children:h.jsx(Mo,{present:n||i.open,children:h.jsx(yA,{asChild:!0,container:s,children:r})})})};vL.displayName=Mw;var rr="MenuContent",[GW,Aw]=Li(rr),xL=_.forwardRef((t,e)=>{const n=SL(rr,t.__scopeMenu),{forceMount:r=n.forceMount,...s}=t,i=ei(rr,t.__scopeMenu),o=Ec(rr,t.__scopeMenu);return h.jsx(Ja.Provider,{scope:t.__scopeMenu,children:h.jsx(Mo,{present:r||i.open,children:h.jsx(Ja.Slot,{scope:t.__scopeMenu,children:o.modal?h.jsx(KW,{...s,ref:e}):h.jsx(VW,{...s,ref:e})})})})}),KW=_.forwardRef((t,e)=>{const n=ei(rr,t.__scopeMenu),r=_.useRef(null),s=Un(e,r);return _.useEffect(()=>{const i=r.current;if(i)return wA(i)},[]),h.jsx(jw,{...t,ref:s,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:St(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),VW=_.forwardRef((t,e)=>{const n=ei(rr,t.__scopeMenu);return h.jsx(jw,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),WW=MW("MenuContent.ScrollLock"),jw=_.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:p,onDismiss:f,disableOutsideScroll:m,...y}=t,S=ei(rr,n),g=Ec(rr,n),v=Pc(n),x=gL(n),b=$W(n),[E,I]=_.useState(null),C=_.useRef(null),P=Un(e,C,S.onContentChange),k=_.useRef(0),T=_.useRef(""),M=_.useRef(0),A=_.useRef(null),j=_.useRef("right"),R=_.useRef(0),L=m?CA:_.Fragment,F=m?{as:WW,allowPinchZoom:!0}:void 0,H=$=>{const Q=T.current+$,Z=b().filter(U=>!U.disabled),ee=document.activeElement,ne=Z.find(U=>U.ref.current===ee)?.textValue,N=Z.map(U=>U.textValue),D=oY(N,Q,ne),q=Z.find(U=>U.textValue===D)?.ref.current;(function U(V){T.current=V,window.clearTimeout(k.current),V!==""&&(k.current=window.setTimeout(()=>U(""),1e3))})(Q),q&&setTimeout(()=>q.focus())};_.useEffect(()=>()=>window.clearTimeout(k.current),[]),_A();const B=_.useCallback($=>j.current===A.current?.side&&cY($,A.current?.area),[]);return h.jsx(GW,{scope:n,searchRef:T,onItemEnter:_.useCallback($=>{B($)&&$.preventDefault()},[B]),onItemLeave:_.useCallback($=>{B($)||(C.current?.focus(),I(null))},[B]),onTriggerLeave:_.useCallback($=>{B($)&&$.preventDefault()},[B]),pointerGraceTimerRef:M,onPointerGraceIntentChange:_.useCallback($=>{A.current=$},[]),children:h.jsx(L,{...F,children:h.jsx(IA,{asChild:!0,trapped:s,onMountAutoFocus:St(i,$=>{$.preventDefault(),C.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:h.jsx(SA,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:p,onDismiss:f,children:h.jsx(aB,{asChild:!0,...x,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:E,onCurrentTabStopIdChange:I,onEntryFocus:St(c,$=>{g.isUsingKeyboardRef.current||$.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(vA,{role:"menu","aria-orientation":"vertical","data-state":NL(S.open),"data-radix-menu-content":"",dir:g.dir,...v,...y,ref:P,style:{outline:"none",...y.style},onKeyDown:St(y.onKeyDown,$=>{const Z=$.target.closest("[data-radix-menu-content]")===$.currentTarget,ee=$.ctrlKey||$.altKey||$.metaKey,ne=$.key.length===1;Z&&($.key==="Tab"&&$.preventDefault(),!ee&&ne&&H($.key));const N=C.current;if($.target!==N||!NW.includes($.key))return;$.preventDefault();const q=b().filter(U=>!U.disabled).map(U=>U.ref.current);fL.includes($.key)&&q.reverse(),sY(q)}),onBlur:St(t.onBlur,$=>{$.currentTarget.contains($.target)||(window.clearTimeout(k.current),T.current="")}),onPointerMove:St(t.onPointerMove,ec($=>{const Q=$.target,Z=R.current!==$.clientX;if($.currentTarget.contains(Q)&&Z){const ee=$.clientX>R.current?"right":"left";j.current=ee,R.current=$.clientX}}))})})})})})})});xL.displayName=rr;var YW="MenuGroup",Rw=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return h.jsx(Tn.div,{role:"group",...r,ref:e})});Rw.displayName=YW;var XW="MenuLabel",bL=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return h.jsx(Tn.div,{...r,ref:e})});bL.displayName=XW;var pd="MenuItem",eP="menu.itemSelect",su=_.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...s}=t,i=_.useRef(null),o=Ec(pd,t.__scopeMenu),a=Aw(pd,t.__scopeMenu),c=Un(e,i),l=_.useRef(!1),d=()=>{const u=i.current;if(!n&&u){const p=new CustomEvent(eP,{bubbles:!0,cancelable:!0});u.addEventListener(eP,f=>r?.(f),{once:!0}),WF(u,p),p.defaultPrevented?l.current=!1:o.onClose()}};return h.jsx(wL,{...s,ref:c,disabled:n,onClick:St(t.onClick,d),onPointerDown:u=>{t.onPointerDown?.(u),l.current=!0},onPointerUp:St(t.onPointerUp,u=>{l.current||u.currentTarget?.click()}),onKeyDown:St(t.onKeyDown,u=>{const p=a.searchRef.current!=="";n||p&&u.key===" "||Qx.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});su.displayName=pd;var wL=_.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:s,...i}=t,o=Aw(pd,n),a=gL(n),c=_.useRef(null),l=Un(e,c),[d,u]=_.useState(!1),[p,f]=_.useState("");return _.useEffect(()=>{const m=c.current;m&&f((m.textContent??"").trim())},[i.children]),h.jsx(Ja.ItemSlot,{scope:n,disabled:r,textValue:s??p,children:h.jsx(cB,{asChild:!0,...a,focusable:!r,children:h.jsx(Tn.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:l,onPointerMove:St(t.onPointerMove,ec(m=>{r?o.onItemLeave(m):(o.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:St(t.onPointerLeave,ec(m=>o.onItemLeave(m))),onFocus:St(t.onFocus,()=>u(!0)),onBlur:St(t.onBlur,()=>u(!1))})})})}),ZW="MenuCheckboxItem",CL=_.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...s}=t;return h.jsx(kL,{scope:t.__scopeMenu,checked:n,children:h.jsx(su,{role:"menuitemcheckbox","aria-checked":fd(n)?"mixed":n,...s,ref:e,"data-state":Lw(n),onSelect:St(s.onSelect,()=>r?.(fd(n)?!0:!n),{checkForDefaultPrevented:!1})})})});CL.displayName=ZW;var _L="MenuRadioGroup",[QW,JW]=Li(_L,{value:void 0,onValueChange:()=>{}}),IL=_.forwardRef((t,e)=>{const{value:n,onValueChange:r,...s}=t,i=_d(r);return h.jsx(QW,{scope:t.__scopeMenu,value:n,onValueChange:i,children:h.jsx(Rw,{...s,ref:e})})});IL.displayName=_L;var PL="MenuRadioItem",EL=_.forwardRef((t,e)=>{const{value:n,...r}=t,s=JW(PL,t.__scopeMenu),i=n===s.value;return h.jsx(kL,{scope:t.__scopeMenu,checked:i,children:h.jsx(su,{role:"menuitemradio","aria-checked":i,...r,ref:e,"data-state":Lw(i),onSelect:St(r.onSelect,()=>s.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});EL.displayName=PL;var Ow="MenuItemIndicator",[kL,eY]=Li(Ow,{checked:!1}),TL=_.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...s}=t,i=eY(Ow,n);return h.jsx(Mo,{present:r||fd(i.checked)||i.checked===!0,children:h.jsx(Tn.span,{...s,ref:e,"data-state":Lw(i.checked)})})});TL.displayName=Ow;var tY="MenuSeparator",ML=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return h.jsx(Tn.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});ML.displayName=tY;var nY="MenuArrow",AL=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,s=Pc(n);return h.jsx(xA,{...s,...r,ref:e})});AL.displayName=nY;var Dw="MenuSub",[rY,jL]=Li(Dw),RL=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:s}=t,i=ei(Dw,e),o=Pc(e),[a,c]=_.useState(null),[l,d]=_.useState(null),u=_d(s);return _.useEffect(()=>(i.open===!1&&u(!1),()=>u(!1)),[i.open,u]),h.jsx(hb,{...o,children:h.jsx(mL,{scope:e,open:r,onOpenChange:u,content:l,onContentChange:d,children:h.jsx(rY,{scope:e,contentId:Ua(),triggerId:Ua(),trigger:a,onTriggerChange:c,children:n})})})};RL.displayName=Dw;var Pa="MenuSubTrigger",OL=_.forwardRef((t,e)=>{const n=ei(Pa,t.__scopeMenu),r=Ec(Pa,t.__scopeMenu),s=jL(Pa,t.__scopeMenu),i=Aw(Pa,t.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=i,l={__scopeMenu:t.__scopeMenu},d=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>d,[d]),_.useEffect(()=>{const u=a.current;return()=>{window.clearTimeout(u),c(null)}},[a,c]),h.jsx(Tw,{asChild:!0,...l,children:h.jsx(wL,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":s.contentId,"data-state":NL(n.open),...t,ref:xd(e,s.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:St(t.onPointerMove,ec(u=>{i.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:St(t.onPointerLeave,ec(u=>{d();const p=n.content?.getBoundingClientRect();if(p){const f=n.content?.dataset.side,m=f==="right",y=m?-5:5,S=p[m?"left":"right"],g=p[m?"right":"left"];i.onPointerGraceIntentChange({area:[{x:u.clientX+y,y:u.clientY},{x:S,y:p.top},{x:g,y:p.top},{x:g,y:p.bottom},{x:S,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(u),u.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:St(t.onKeyDown,u=>{const p=i.searchRef.current!=="";t.disabled||p&&u.key===" "||FW[r.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});OL.displayName=Pa;var DL="MenuSubContent",LL=_.forwardRef((t,e)=>{const n=SL(rr,t.__scopeMenu),{forceMount:r=n.forceMount,...s}=t,i=ei(rr,t.__scopeMenu),o=Ec(rr,t.__scopeMenu),a=jL(DL,t.__scopeMenu),c=_.useRef(null),l=Un(e,c);return h.jsx(Ja.Provider,{scope:t.__scopeMenu,children:h.jsx(Mo,{present:r||i.open,children:h.jsx(Ja.Slot,{scope:t.__scopeMenu,children:h.jsx(jw,{id:a.contentId,"aria-labelledby":a.triggerId,...s,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{o.isUsingKeyboardRef.current&&c.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:St(t.onFocusOutside,d=>{d.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:St(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:St(t.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),p=BW[o.dir].includes(d.key);u&&p&&(i.onOpenChange(!1),a.trigger?.focus(),d.preventDefault())})})})})})});LL.displayName=DL;function NL(t){return t?"open":"closed"}function fd(t){return t==="indeterminate"}function Lw(t){return fd(t)?"indeterminate":t?"checked":"unchecked"}function sY(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function iY(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function oY(t,e,n){const s=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,i=n?t.indexOf(n):-1;let o=iY(t,Math.max(i,0));s.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.toLowerCase().startsWith(s.toLowerCase()));return c!==n?c:void 0}function aY(t,e){const{x:n,y:r}=t;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],c=e[o],l=a.x,d=a.y,u=c.x,p=c.y;d>r!=p>r&&n<(u-l)*(r-d)/(p-d)+l&&(s=!s)}return s}function cY(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return aY(n,e)}function ec(t){return e=>e.pointerType==="mouse"?t(e):void 0}var FL=yL,BL=Tw,$L=vL,zL=xL,UL=Rw,qL=bL,HL=su,GL=CL,KL=IL,VL=EL,WL=TL,YL=ML,XL=AL,ZL=RL,QL=OL,JL=LL,lY=bd[" useInsertionEffect ".trim().toString()]||wd;function dY({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[s,i,o]=uY({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:s;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const u=d.current;u!==a&&console.warn(`${r} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const u=hY(d)?d(t):d;u!==t&&o.current?.(u)}else i(d)},[a,t,i,o]);return[c,l]}function uY({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),s=_.useRef(n),i=_.useRef(e);return lY(()=>{i.current=e},[e]),_.useEffect(()=>{s.current!==n&&(i.current?.(n),s.current=n)},[n,s]),[n,r,i]}function hY(t){return typeof t=="function"}var Nw="ContextMenu",[pY]=lc(Nw,[ru]),on=ru(),[fY,eN]=pY(Nw),tN=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:s,modal:i=!0}=t,[o,a]=_.useState(!1),c=on(e),l=_d(r),d=_.useCallback(u=>{a(u),l(u)},[l]);return h.jsx(fY,{scope:e,open:o,onOpenChange:d,modal:i,children:h.jsx(FL,{...c,dir:s,open:o,onOpenChange:d,modal:i,children:n})})};tN.displayName=Nw;var nN="ContextMenuTrigger",rN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...s}=t,i=eN(nN,n),o=on(n),a=_.useRef({x:0,y:0}),c=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=_.useRef(0),d=_.useCallback(()=>window.clearTimeout(l.current),[]),u=p=>{a.current={x:p.clientX,y:p.clientY},i.onOpenChange(!0)};return _.useEffect(()=>d,[d]),_.useEffect(()=>void(r&&d()),[r,d]),h.jsxs(h.Fragment,{children:[h.jsx(BL,{...o,virtualRef:c}),h.jsx(Tn.span,{"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,...s,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:pa(t.onContextMenu,p=>{d(),u(p),p.preventDefault()}),onPointerDown:r?t.onPointerDown:pa(t.onPointerDown,wl(p=>{d(),l.current=window.setTimeout(()=>u(p),700)})),onPointerMove:r?t.onPointerMove:pa(t.onPointerMove,wl(d)),onPointerCancel:r?t.onPointerCancel:pa(t.onPointerCancel,wl(d)),onPointerUp:r?t.onPointerUp:pa(t.onPointerUp,wl(d))})]})});rN.displayName=nN;var gY="ContextMenuPortal",Fw=t=>{const{__scopeContextMenu:e,...n}=t,r=on(e);return h.jsx($L,{...r,...n})};Fw.displayName=gY;var sN="ContextMenuContent",iN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=eN(sN,n),i=on(n),o=_.useRef(!1);return h.jsx(zL,{...i,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{t.onCloseAutoFocus?.(a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{t.onInteractOutside?.(a),!a.defaultPrevented&&!s.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});iN.displayName=sN;var mY="ContextMenuGroup",oN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(UL,{...s,...r,ref:e})});oN.displayName=mY;var yY="ContextMenuLabel",SY=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(qL,{...s,...r,ref:e})});SY.displayName=yY;var vY="ContextMenuItem",aN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(HL,{...s,...r,ref:e})});aN.displayName=vY;var xY="ContextMenuCheckboxItem",cN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(GL,{...s,...r,ref:e})});cN.displayName=xY;var bY="ContextMenuRadioGroup",wY=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(KL,{...s,...r,ref:e})});wY.displayName=bY;var CY="ContextMenuRadioItem",_Y=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(VL,{...s,...r,ref:e})});_Y.displayName=CY;var IY="ContextMenuItemIndicator",PY=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(WL,{...s,...r,ref:e})});PY.displayName=IY;var EY="ContextMenuSeparator",kY=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(YL,{...s,...r,ref:e})});kY.displayName=EY;var TY="ContextMenuArrow",MY=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(XL,{...s,...r,ref:e})});MY.displayName=TY;var lN="ContextMenuSub",dN=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,open:s,defaultOpen:i}=t,o=on(e),[a,c]=dY({prop:s,defaultProp:i??!1,onChange:r,caller:lN});return h.jsx(ZL,{...o,open:a,onOpenChange:c,children:n})};dN.displayName=lN;var AY="ContextMenuSubTrigger",uN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(QL,{...s,...r,ref:e})});uN.displayName=AY;var jY="ContextMenuSubContent",hN=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=on(n);return h.jsx(JL,{...s,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hN.displayName=jY;function wl(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var RY=tN,OY=rN,DY=Fw,LY=iN,NY=cN;const pN=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,FY=pN?"⌘":"Ctrl",BY=pN?"⌥":"Alt";function fN(t){return t.split(",")[0].split("").map(e=>{const n=e.replace(/\$/g,FY).replace(/\?/g,BY).replace(/!/g,"⇧");return n[0].toUpperCase()+n.slice(1)})}function Jx(t){return"— "+fN(t).join(" ")}function $Y(t){return h.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...t,children:h.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[h.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),h.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:h.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function gd(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t?.(s),n===!1||!s.defaultPrevented)return e?.(s)}}var zY=bd[" useInsertionEffect ".trim().toString()]||wd;function gN({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[s,i,o]=UY({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:s;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const u=d.current;u!==a&&console.warn(`${r} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const u=qY(d)?d(t):d;u!==t&&o.current?.(u)}else i(d)},[a,t,i,o]);return[c,l]}function UY({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),s=_.useRef(n),i=_.useRef(e);return zY(()=>{i.current=e},[e]),_.useEffect(()=>{s.current!==n&&(i.current?.(n),s.current=n)},[n,s]),[n,r,i]}function qY(t){return typeof t=="function"}var iu="DropdownMenu",[HY]=lc(iu,[ru]),an=ru(),[GY,mN]=HY(iu),yN=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:s,defaultOpen:i,onOpenChange:o,modal:a=!0}=t,c=an(e),l=_.useRef(null),[d,u]=gN({prop:s,defaultProp:i??!1,onChange:o,caller:iu});return h.jsx(GY,{scope:e,triggerId:Ua(),triggerRef:l,contentId:Ua(),open:d,onOpenChange:u,onOpenToggle:_.useCallback(()=>u(p=>!p),[u]),modal:a,children:h.jsx(FL,{...c,open:d,onOpenChange:u,dir:r,modal:a,children:n})})};yN.displayName=iu;var SN="DropdownMenuTrigger",vN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...s}=t,i=mN(SN,n),o=an(n);return h.jsx(BL,{asChild:!0,...o,children:h.jsx(Tn.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...s,ref:xd(e,i.triggerRef),onPointerDown:gd(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:gd(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});vN.displayName=SN;var KY="DropdownMenuPortal",xN=t=>{const{__scopeDropdownMenu:e,...n}=t,r=an(e);return h.jsx($L,{...r,...n})};xN.displayName=KY;var bN="DropdownMenuContent",wN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=mN(bN,n),i=an(n),o=_.useRef(!1);return h.jsx(zL,{id:s.contentId,"aria-labelledby":s.triggerId,...i,...r,ref:e,onCloseAutoFocus:gd(t.onCloseAutoFocus,a=>{o.current||s.triggerRef.current?.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:gd(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,d=c.button===2||l;(!s.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});wN.displayName=bN;var VY="DropdownMenuGroup",CN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(UL,{...s,...r,ref:e})});CN.displayName=VY;var WY="DropdownMenuLabel",YY=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(qL,{...s,...r,ref:e})});YY.displayName=WY;var XY="DropdownMenuItem",_N=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(HL,{...s,...r,ref:e})});_N.displayName=XY;var ZY="DropdownMenuCheckboxItem",IN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(GL,{...s,...r,ref:e})});IN.displayName=ZY;var QY="DropdownMenuRadioGroup",JY=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(KL,{...s,...r,ref:e})});JY.displayName=QY;var eX="DropdownMenuRadioItem",tX=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(VL,{...s,...r,ref:e})});tX.displayName=eX;var nX="DropdownMenuItemIndicator",rX=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(WL,{...s,...r,ref:e})});rX.displayName=nX;var sX="DropdownMenuSeparator",iX=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(YL,{...s,...r,ref:e})});iX.displayName=sX;var oX="DropdownMenuArrow",aX=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(XL,{...s,...r,ref:e})});aX.displayName=oX;var cX=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:s,defaultOpen:i}=t,o=an(e),[a,c]=gN({prop:r,defaultProp:i??!1,onChange:s,caller:"DropdownMenuSub"});return h.jsx(ZL,{...o,open:a,onOpenChange:c,children:n})},lX="DropdownMenuSubTrigger",PN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(QL,{...s,...r,ref:e})});PN.displayName=lX;var dX="DropdownMenuSubContent",EN=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=an(n);return h.jsx(JL,{...s,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});EN.displayName=dX;var Bw=yN,$w=vN,ou=xN,zw=wN,uX=CN,hX=_N,pX=IN,fX=cX,gX=PN,mX=EN;function Ei({id:t,children:e,modal:n=!1,debugOpen:r=!1}){const[s,i]=Ss(t);return h.jsx(Bw,{open:r||s,dir:"ltr",modal:n,onOpenChange:i,children:e})}function ki({children:t,...e}){return h.jsx($w,{dir:"ltr",asChild:!0,onTouchEnd:n=>Le(n),...e,children:t})}function Ti({side:t="bottom",align:e="start",sideOffset:n=8,alignOffset:r=8,children:s}){const i=Dt();return h.jsx(ou,{container:i,children:h.jsx(zw,{className:"tlui-menu",side:t,sideOffset:n,align:e,alignOffset:r,collisionPadding:4,children:s})})}function yX({id:t,children:e}){const[n,r]=Ss(t);return h.jsx(fX,{open:n,onOpenChange:r,children:e})}function SX({id:t,label:e,title:n,disabled:r}){return h.jsx(gX,{dir:"ltr",asChild:!0,disabled:r,children:h.jsxs(we,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[h.jsx(vt,{children:e}),h.jsx(Ae,{icon:"chevron-right",small:!0})]})})}function vX({id:t,alignOffset:e=-1,sideOffset:n=-4,size:r="small",children:s}){const i=Dt();return h.jsx(ou,{container:i,children:h.jsx(mX,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:n,collisionPadding:4,"data-size":r,children:s})})}function xX({children:t}){return h.jsx(uX,{dir:"ltr",className:"tlui-menu__group",children:t})}function tc({noClose:t,children:e}){return h.jsx(hX,{dir:"ltr",asChild:!0,onClick:t?Le:void 0,children:e})}function Fa({children:t,visibleOnMobileLayout:e=!1}){const n=hn();return!e&&n<gt.MOBILE?null:h.jsx("kbd",{className:"tlui-kbd",children:fN(t).map((r,s)=>h.jsx("span",{children:r},s))})}function W({disabled:t=!1,spinner:e=!1,readonlyOk:n=!1,id:r,kbd:s,label:i,icon:o,onSelect:a,noClose:c,isSelected:l}){const{type:d,sourceId:u}=nu(),p=Re(),[f,m]=_.useState(!1);if(ys()&&!n)return null;const S=Qa(i,d),g=s?Jx(s):void 0,v=S?p(S):void 0,x=v&&g?`${v} ${g}`:v;switch(d){case"menu":return h.jsx(tc,{children:h.jsxs(we,{type:"menu","data-testid":`${u}.${r}`,disabled:t,title:x,onClick:b=>{c&&Le(b),f?m(!1):a(u)},children:[h.jsx(vt,{children:v}),s&&h.jsx(Fa,{children:s})]})});case"context-menu":return t?null:h.jsxs(aN,{dir:"ltr",title:x,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${u}.${r}`,onSelect:b=>{c&&Le(b),f?m(!1):a(u)},children:[h.jsx("span",{className:"tlui-button__label",draggable:!1,children:v}),s&&h.jsx(Fa,{children:s}),e&&h.jsx($Y,{})]});case"panel":return h.jsxs(we,{"data-testid":`${u}.${r}`,type:"menu",title:x,disabled:t,onClick:()=>a(u),children:[h.jsx(vt,{children:v}),o&&h.jsx(Ae,{icon:o})]});case"small-icons":case"icons":return h.jsx(we,{"data-testid":`${u}.${r}`,type:"icon",title:x,disabled:t,onClick:()=>a(u),children:h.jsx(Ae,{icon:o,small:d==="small-icons"})});case"keyboard-shortcuts":return s?h.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${u}.${r}`,children:[h.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:v}),h.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:h.jsx(Fa,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${i}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return h.jsxs(we,{type:"low",onClick:()=>a(u),children:[h.jsx(Ae,{icon:o}),h.jsx(vt,{children:v})]});case"toolbar":return h.jsx(we,{type:"tool","data-testid":`tools.${r}`,"aria-label":S,"data-value":r,onClick:()=>a("toolbar"),title:x,onTouchStart:b=>{Le(b),a("toolbar")},role:"radio","aria-checked":l?"true":"false",children:h.jsx(Ae,{icon:o})});case"toolbar-overflow":return h.jsx(tc,{"aria-label":i,children:h.jsx(we,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:x,role:"radio","aria-checked":l?"true":"false","data-value":r,children:h.jsx(Ae,{icon:o})})});default:throw tn(d)}}function bX(){return h.jsxs(h.Fragment,{children:[h.jsx(wX,{}),h.jsx(CX,{}),h.jsx(_X,{}),h.jsx(IX,{}),h.jsx(PX,{}),h.jsx(TX,{}),h.jsx(MX,{}),h.jsx(AX,{})]})}function wX(){const t=ye(),e=pn(2),n=vs(),r=e&&n;return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t["align-left"],disabled:!r}),h.jsx(W,{...t["align-center-horizontal"],disabled:!r}),h.jsx(W,{...t["align-right"],disabled:!r}),h.jsx(W,{...t["stretch-horizontal"],disabled:!r}),h.jsx(W,{...t["align-top"],disabled:!r}),h.jsx(W,{...t["align-center-vertical"],disabled:!r}),h.jsx(W,{...t["align-bottom"],disabled:!r}),h.jsx(W,{...t["stretch-vertical"],disabled:!r})]})}function CX(){const t=ye(),e=pn(3),n=vs(),r=e&&n;return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t["distribute-horizontal"],disabled:!r}),h.jsx(W,{...t["distribute-vertical"],disabled:!r})]})}function _X(){const t=ye(),e=aL(),n=vs(),r=e&&n;return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t["stack-horizontal"],disabled:!r}),h.jsx(W,{...t["stack-vertical"],disabled:!r})]})}function IX(){const t=ye(),e=pn(1),n=vs(),r=e&&n;return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t["send-to-back"],disabled:!r}),h.jsx(W,{...t["send-backward"],disabled:!r}),h.jsx(W,{...t["bring-forward"],disabled:!r}),h.jsx(W,{...t["bring-to-front"],disabled:!r})]})}function PX(){return hn()<gt.TABLET_SM?h.jsx(EX,{}):h.jsx(kX,{})}function EX(){const t=ye(),e=K(),n=X("zoom is 1",()=>e.getZoomLevel()===1,[e]);return h.jsx(W,{...t["zoom-to-100"],disabled:n})}function kX(){const t=ye(),e=pn(1),n=vs(),r=e&&n;return h.jsx(W,{...t["rotate-ccw"],disabled:!r})}function TX(){const t=ye(),e=pn(1),n=vs(),r=e&&n;return h.jsx(W,{...t["rotate-cw"],disabled:!r})}function MX(){const t=ye(),e=uL(),n=vs(),r=e&&n;return h.jsx(W,{...t["edit-link"],disabled:!r})}function AX(){const t=cL(),e=lL();return t?h.jsx(tP,{}):e?h.jsx(jX,{}):h.jsx(tP,{})}function tP(){const t=ye(),e=pn(2),n=vs(),r=e&&n;return h.jsx(W,{...t.group,disabled:!r})}function jX(){const t=ye();return h.jsx(W,{...t.ungroup})}const RX=_.memo(function({children:e}){const n=Re(),r=hn(),s=ys(),i=K(),o=X("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),a=e??h.jsx(bX,{});if(!(s&&!o))return h.jsxs(Pw,{id:"actions-menu",children:[h.jsx(Ew,{children:h.jsx(we,{type:"icon","data-testid":"actions-menu.button",title:n("actions-menu.title"),children:h.jsx(Ae,{icon:"dots-vertical",small:!0})})}),h.jsx(kw,{side:r>=gt.TABLET?"bottom":"top",sideOffset:6,children:h.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:h.jsx(sr,{type:"icons",sourceId:"actions-menu",children:a})})})]})});function An({id:t,kbd:e,label:n,readonlyOk:r,onSelect:s,toggle:i=!1,disabled:o=!1,checked:a=!1}){const{type:c,sourceId:l}=nu(),d=ys(),u=Re();if(d&&!r)return null;const p=Qa(n,c),f=p?u(p):void 0;switch(c){case"menu":return h.jsxs(pX,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:m=>{s?.(l),Le(m)},disabled:o,checked:a,children:[h.jsx(zr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&h.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&h.jsx(Fa,{children:e})]});case"context-menu":return h.jsxs(NY,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:m=>{s(l),Le(m)},disabled:o,checked:a,children:[h.jsx(zr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&h.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&h.jsx(Fa,{children:e})]},t);default:return null}}function Pe({id:t,label:e,children:n}){const{type:r,sourceId:s}=nu(),i=Re(),o=Qa(e,r),a=o?i(o):void 0;switch(r){case"panel":return h.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${t}`,children:n});case"menu":return h.jsx(xX,{"data-testid":`${s}-group.${t}`,children:n});case"context-menu":return h.jsx(oN,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${t}`,children:n});case"keyboard-shortcuts":return h.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${t}`,children:[h.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),h.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function fn({id:t,disabled:e=!1,label:n,size:r="small",children:s}){const{type:i,sourceId:o}=nu(),a=Dt(),c=Re(),l=n?typeof n=="string"?n:n[i]??n.default:void 0,d=l?c(l):void 0;switch(i){case"menu":return h.jsxs(yX,{id:`${o}-sub.${t}`,children:[h.jsx(SX,{id:`${o}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:e,label:d,title:d}),h.jsx(vX,{id:`${o}-sub.${d?d.toLowerCase()+"-content":""}`,size:r,children:s})]});case"context-menu":return e?null:h.jsxs(OX,{id:`${o}-sub.${t}`,children:[h.jsx(uN,{dir:"ltr",disabled:e,asChild:!0,children:h.jsxs(we,{"data-testid":`${o}-sub-trigger.${t}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[h.jsx(vt,{children:d}),h.jsx(Ae,{icon:"chevron-right",small:!0})]})}),h.jsx(Fw,{container:a,children:h.jsx(hN,{"data-testid":`${o}-sub-content.${t}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:s})})]});default:return s}}function OX({id:t,children:e}){const[n,r]=Ss(t);return h.jsx(dN,{open:n,onOpenChange:r,children:e})}function kN(){const t=ye();return kW()?h.jsx(W,{...t["toggle-auto-size"]}):null}function TN(){const t=ye();return uL()?h.jsx(W,{...t["edit-link"]}):null}function DX(){const t=ye();return pn(1)?h.jsx(W,{...t.duplicate}):null}function MN(){const t=ye(),e=K();return X("should display flatten option",()=>{if(e.getSelectedShapeIds().length===0)return!1;const s=e.getOnlySelectedShape();return!(s&&e.isShapeOfType(s,"image"))},[e])?h.jsx(W,{...t["flatten-to-image"]}):null}function AN(){const t=ye();return cL()?h.jsx(W,{...t.group}):null}function jN(){const t=ye();return lL()?h.jsx(W,{...t.ungroup}):null}function RN(){const t=K(),e=ye();return X("allow unframe",()=>{const r=t.getSelectedShapes();return r.length===0?!1:r.every(s=>t.isShapeOfType(s,"frame"))},[t])?h.jsx(W,{...e["remove-frame"]}):null}function ON(){const t=K(),e=ye();return X("allow fit frame to content",()=>{const r=t.getOnlySelectedShape();return r?t.isShapeOfType(r,"frame")&&t.getSortedChildIdsForParent(r).length>0:!1},[t])?h.jsx(W,{...e["fit-frame-to-content"]}):null}function DN(){const t=K(),e=ye();return X("selected shapes",()=>t.getSelectedShapes().length>0,[t])?h.jsx(W,{...e["toggle-lock"]}):null}function Uw(){const t=ye(),e=K(),n=X("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return h.jsx(An,{...t["toggle-transparent"],checked:n,toggle:!0})}function LX(){const t=K(),e=ye(),n=X("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return h.jsx(W,{...e["unlock-all"],disabled:!n})}function LN(){const t=K(),e=X("zoomed to 100",()=>t.getZoomLevel()===1,[t]),n=ye();return h.jsx(W,{...n["zoom-to-100"],noClose:!0,disabled:e})}function NN(){const t=K(),e=X("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]),n=ye();return h.jsx(W,{...n["zoom-to-fit"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function FN(){const t=K(),e=X("has shapes",()=>t.getSelectedShapeIds().length>0,[t]),n=ye();return h.jsx(W,{...n["zoom-to-selection"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function BN(){return h.jsxs(Pe,{id:"clipboard",children:[h.jsx(FX,{}),h.jsx(BX,{}),h.jsx($X,{}),h.jsx(DX,{}),h.jsx(zX,{})]})}function NX(){const t=K(),e=ye(),n=X("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return h.jsxs(fn,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!n,children:[h.jsxs(Pe,{id:"copy-as-group",children:[h.jsx(W,{...e["copy-as-svg"]}),!!window.navigator.clipboard?.write&&h.jsx(W,{...e["copy-as-png"]}),h.jsx(W,{...e["copy-as-json"]})]}),h.jsx(Pe,{id:"copy-as-bg",children:h.jsx(Uw,{})})]})}function FX(){const t=ye(),e=pn(1);return h.jsx(W,{...t.cut,disabled:!e})}function BX(){const t=ye(),e=dL(1);return h.jsx(W,{...t.copy,disabled:!e})}function $X(){const t=ye(),e=EW;return h.jsx(W,{...t.paste,disabled:!e})}function $N(){const t=K(),e=ye();return X("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?h.jsxs(Pe,{id:"conversions",children:[h.jsx(NX,{}),h.jsxs(fn,{id:"export-as",label:"context-menu.export-as",size:"small",children:[h.jsxs(Pe,{id:"export-as-group",children:[h.jsx(W,{...e["export-as-svg"]}),h.jsx(W,{...e["export-as-png"]}),h.jsx(W,{...e["export-as-json"]})]}),h.jsx(Pe,{id:"export-as-bg",children:h.jsx(Uw,{})})]})]}):null}function zN(){const t=ye(),e=K(),n=X("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return h.jsx(W,{...t["select-all"],disabled:!n})}function zX(){const t=ye(),e=pn(1);return h.jsx(W,{...t.delete,disabled:!e})}function UX(){return dL(1)?h.jsxs(fn,{id:"edit",label:"context-menu.edit",size:"small",children:[h.jsx(AN,{}),h.jsx(jN,{}),h.jsx(MN,{}),h.jsx(TN,{}),h.jsx(ON,{}),h.jsx(RN,{}),h.jsx(qN,{}),h.jsx(UN,{}),h.jsx(kN,{}),h.jsx(DN,{})]}):null}function qX(){const t=pn(2),e=TW(),n=ye();return t||e?h.jsxs(fn,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&h.jsxs(Pe,{id:"align",children:[h.jsx(W,{...n["align-left"]}),h.jsx(W,{...n["align-center-horizontal"]}),h.jsx(W,{...n["align-right"]}),h.jsx(W,{...n["align-top"]}),h.jsx(W,{...n["align-center-vertical"]}),h.jsx(W,{...n["align-bottom"]})]}),h.jsx(HX,{}),t&&h.jsxs(Pe,{id:"stretch",children:[h.jsx(W,{...n["stretch-horizontal"]}),h.jsx(W,{...n["stretch-vertical"]})]}),(t||e)&&h.jsxs(Pe,{id:"flip",children:[h.jsx(W,{...n["flip-horizontal"]}),h.jsx(W,{...n["flip-vertical"]})]}),h.jsx(GX,{})]}):null}function HX(){const t=ye();return pn(3)?h.jsxs(Pe,{id:"distribute",children:[h.jsx(W,{...t["distribute-horizontal"]}),h.jsx(W,{...t["distribute-vertical"]})]}):null}function GX(){const t=ye(),e=pn(2),n=aL();return e?h.jsxs(Pe,{id:"order",children:[h.jsx(W,{...t.pack}),n&&h.jsx(W,{...t["stack-horizontal"]}),n&&h.jsx(W,{...t["stack-vertical"]})]}):null}function KX(){const t=ye();return pn(1)?h.jsx(fn,{id:"reorder",label:"context-menu.reorder",size:"small",children:h.jsxs(Pe,{id:"reorder",children:[h.jsx(W,{...t["bring-to-front"]}),h.jsx(W,{...t["bring-forward"]}),h.jsx(W,{...t["send-backward"]}),h.jsx(W,{...t["send-to-back"]})]})}):null}function VX(){const t=K(),e=X("pages",()=>t.getPages(),[t]),n=X("current page id",()=>t.getCurrentPageId(),[t]),{addToast:r}=_r(),s=ye(),i=Gt();return pn(1)?h.jsxs(fn,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[h.jsx(Pe,{id:"pages",children:e.map(a=>h.jsx(W,{id:a.id,disabled:n===a.id,label:a.name,onSelect:()=>{t.mark("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),a.id);const c=t.getPage(a.id);c&&r({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.mark("change-page"),t.setCurrentPage(n)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),h.jsx(Pe,{id:"new-page",children:h.jsx(W,{...s["move-to-new-page"]})})]}):null}function UN(){const t=K(),e=ye();return X("oneEmbedSelected",()=>{const r=t.getOnlySelectedShape();return r?!!(t.isShapeOfType(r,"embed")&&r.props.url&&!t.isShapeOrAncestorLocked(r)):!1},[t])?h.jsx(W,{...e["convert-to-bookmark"]}):null}function qN(){const t=K(),e=ye();return X("oneEmbeddableBookmarkSelected",()=>{const r=t.getOnlySelectedShape();return r?!!(t.isShapeOfType(r,"bookmark")&&r.props.url&&Ls(r.props.url)&&!t.isShapeOrAncestorLocked(r)):!1},[t])?h.jsx(W,{...e["convert-to-embed"]}):null}function WX(){const t=ye(),e=K(),n=X("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return h.jsx(An,{...t["toggle-snap-mode"],checked:n})}function YX(){const t=ye(),e=K(),n=X("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return h.jsx(An,{...t["toggle-tool-lock"],checked:n})}function XX(){const t=ye(),e=K(),n=X("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return h.jsx(An,{...t["toggle-grid"],checked:n})}function ZX(){const t=ye(),e=K(),n=X("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return h.jsx(An,{...t["toggle-wrap-mode"],checked:n})}function QX(){const t=ye(),e=K(),n=X("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return h.jsx(An,{...t["toggle-focus-mode"],checked:n})}function JX(){const t=ye(),e=K(),n=X("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return h.jsx(An,{...t["toggle-edge-scrolling"],checked:n===1})}function eZ(){const t=ye(),e=K(),n=X("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return h.jsx(An,{...t["toggle-reduce-motion"],checked:n===0})}function tZ(){const t=ye(),e=K(),n=X("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return h.jsx(An,{...t["toggle-debug-mode"],checked:n})}function nZ(){const t=ye(),e=K(),n=X("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return h.jsx(An,{...t["toggle-dynamic-size-mode"],checked:n})}function rZ(){const t=ye(),e=K(),n=X("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return h.jsx(An,{...t["toggle-paste-at-cursor"],checked:n})}function sZ(){const t=K(),e=ye();return X("show cursor chat",()=>t.getCurrentToolId()==="select"&&!t.getInstanceState().isCoarsePointer,[t])?h.jsx(W,{...e["open-cursor-chat"]}):null}function iZ(){const t=K(),e=eu();return X("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t])?h.jsxs(h.Fragment,{children:[e&&h.jsx(sZ,{}),h.jsxs(Pe,{id:"modify",children:[h.jsx(UX,{}),h.jsx(qX,{}),h.jsx(KX,{}),h.jsx(VX,{})]}),h.jsx(BN,{}),h.jsx($N,{}),h.jsx(Pe,{id:"select-all",children:h.jsx(zN,{})})]}):null}const oZ=_.memo(function({children:e}){const n=K(),{Canvas:r}=st(),s=_.useCallback(l=>{if(l){if(n.getInstanceState().isCoarsePointer){const d=n.getSelectedShapes(),{inputs:{currentPagePoint:u}}=n,p=n.getShapesAtPoint(u);if(!n.getSelectedShapes().length||!p.some(f=>d.includes(f))){const f=p.filter(m=>n.isShapeOrAncestorLocked(m));f.length&&n.select(...f.map(m=>m.id))}}}else{const d=n.getOnlySelectedShape();d&&n.isShapeOrAncestorLocked(d)&&n.setSelectedShapes([])}},[n]),i=Dt(),[o,a]=Ss("context menu",s),c=e??h.jsx(iZ,{});return h.jsxs(RY,{dir:"ltr",onOpenChange:a,modal:!1,children:[h.jsx(OY,{onContextMenu:void 0,dir:"ltr",children:r?h.jsx(r,{}):null}),o&&h.jsx(DY,{container:i,children:h.jsx(LY,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Le,children:h.jsx(sr,{type:"context-menu",sourceId:"context-menu",children:c})})})]})}),aZ=2e3,cZ=5e3,lZ=Ot(function(){const e=K(),{isChatting:n,chatMessage:r}=e.getInstanceState(),s=_.useRef(-1),[i,o]=_.useState("");return _.useEffect(()=>{if(!n&&r||n){const c=n?cZ:aZ;s.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},c)}return()=>{clearTimeout(s.current)}},[e,r,n]),n?h.jsx(uZ,{value:i,setValue:o,chatMessage:r}):r.trim()?h.jsx(dZ,{chatMessage:r}):null});function HN(t){const e=K();_.useLayoutEffect(()=>{if(!t.current)return;const{x:r,y:s}=e.inputs.currentScreenPoint;t.current?.style.setProperty("transform",`translate(${r}px, ${s}px)`);function i(o){const{minX:a,minY:c}=e.getViewportScreenBounds();t.current?.style.setProperty("transform",`translate(${o.clientX-a}px, ${o.clientY-c}px)`)}return window.addEventListener("pointermove",i),()=>{window.removeEventListener("pointermove",i)}},[t,e])}const dZ=({chatMessage:t})=>{const e=K(),n=_.useRef(null);return HN(n),h.jsx("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:t})},uZ=Ot(function({chatMessage:e,value:n,setValue:r}){const s=K(),i=Re(),o=_.useRef(null),a=e||i("cursor-chat.type-to-chat");HN(o),_.useLayoutEffect(()=>{const p=o.current;if(!p)return;const f=s.textMeasure.measureText(n||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[s,n,a]),_.useLayoutEffect(()=>{const p=s.timers.requestAnimationFrame(()=>{o.current?.focus()});return()=>{cancelAnimationFrame(p)}},[s]);const c=_.useCallback(()=>{s.updateInstanceState({isChatting:!1}),s.focus()},[s]),l=_.useCallback(p=>{const{value:f}=p.target;r(f.slice(0,64)),s.updateInstanceState({chatMessage:f})},[s,r]),d=_.useCallback(p=>{const f=o.current;if(!f)return;const{value:m}=f;switch(p.key){case"Enter":{if(Le(p),p.stopPropagation(),!m){c();return}r("");break}case"Escape":{Le(p),p.stopPropagation(),c();break}}},[c,r]),u=_.useCallback(p=>{p.stopPropagation()},[]);return h.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:s.user.getColor()},onBlur:c,onChange:l,onKeyDown:d,onPaste:u,value:n,placeholder:a,spellCheck:!1})});function eb({checked:t}){return h.jsx(zr,{icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function hZ(){const t=K(),{addToast:e}=_r(),{addDialog:n}=Di(),[r,s]=qe.useState(!1);return h.jsxs(h.Fragment,{children:[h.jsxs(Pe,{id:"items",children:[h.jsx(W,{id:"add-toast",onSelect:()=>{e({id:lt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:lt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:lt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:lt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),h.jsx(W,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:i})=>h.jsx(gZ,{displayDontShowAgain:!0,onCancel:()=>i(),onContinue:()=>i()}),onClose:()=>{}})}}),h.jsx(W,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>mZ(t,100)}),h.jsx(W,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{const i=t.getSelectedShapes(),o=i.length===0?t.getRenderingShapes():i;window.alert(`Shapes ${o.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),h.jsx(W,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),h.jsx(W,{id:"hard-reset",onSelect:iO,label:"Hard reset"})]}),h.jsxs(Pe,{id:"flags",children:[h.jsx(pZ,{}),h.jsx(fZ,{})]})]})}function pZ(){const t=Object.values(yt);return t.length?h.jsx(fn,{id:"debug flags",label:"Debug Flags",children:h.jsx(Pe,{id:"debug flags",children:t.map(e=>h.jsx(GN,{flag:e},e.name))})}):null}function fZ(){const t=Object.values(Ob);return t.length?h.jsx(fn,{id:"feature flags",label:"Feature Flags",children:h.jsx(Pe,{id:"feature flags",children:t.map(e=>h.jsx(GN,{flag:e},e.name))})}):null}function gZ({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:s=!1,onCancel:i,onContinue:o}){const[a,c]=qe.useState(!1);return h.jsxs(h.Fragment,{children:[h.jsxs(Yd,{children:[h.jsx(Xd,{children:t}),h.jsx(Zd,{})]}),h.jsx(Za,{style:{maxWidth:350},children:e}),h.jsxs(vw,{className:"tlui-dialog__footer__actions",children:[s&&h.jsxs(we,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[h.jsx(eb,{checked:a}),h.jsx(vt,{children:"Don’t show again"})]}),h.jsx(we,{type:"normal",onClick:i,children:h.jsx(vt,{children:n})}),h.jsx(we,{type:"primary",onClick:async()=>o(),children:h.jsx(vt,{children:r})})]})]})}const GN=Ot(function({flag:e,onChange:n}){const r=e.get();return h.jsx(An,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,s=>`${s[0]} ${s[1].toLowerCase()}`).replace(/^[a-z]/,s=>s.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),n?.(!r)}})});let nP=0;function mZ(t,e){const n=Array(e),r=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)nP++,n[s]={id:He("box"+nP),type:"geo",x:s%r*132,y:Math.floor(s/r)*132};t.run(()=>{t.createShapes(n).setSelectedShapes(n.map(s=>s.id))})}function yZ({children:t}){const e=t??h.jsx(hZ,{});return h.jsxs(Ei,{id:"debug",children:[h.jsx(ki,{children:h.jsx(we,{type:"icon",title:"Debug menu",children:h.jsx(Ae,{icon:"dots-horizontal"})})}),h.jsx(Ti,{side:"top",align:"end",alignOffset:0,children:h.jsx(sr,{type:"menu",sourceId:"debug-panel",children:e})})]})}const SZ=_.memo(function(){const{DebugMenu:e}=ni();return h.jsxs("div",{className:"tlui-debug-panel",children:[h.jsx(xZ,{}),h.jsx(bZ,{}),e&&h.jsx(e,{})]})});function vZ(t=!0){const[e,n]=_.useState(0),r=K();_.useEffect(()=>{if(!t)return;const s=()=>n(i=>i+1);return r.on("tick",s),()=>{r.off("tick",s)}},[r,t])}const xZ=Ot(function(){vZ();const e=K(),n=e.getPath(),r=e.getHoveredShape(),s=e.getOnlySelectedShape(),i=n==="select.idle"||!n.includes("select.")?r:s,o=i&&n.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${w.ToInt(e.getPointInShapeSpace(i,e.inputs.currentPagePoint))}]`:"",a=n.startsWith("select.")&&!n.includes(".idle")?` / [${w.ToInt(e.inputs.originPagePoint)}] → [${w.ToInt(e.inputs.currentPagePoint)}] = ${w.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return h.jsx("div",{className:"tlui-debug-panel__current-state",children:`${n}${o}${a}`})});function bZ(){const t=K(),e=X("show_fps",()=>yt.showFps.get(),[yt]),n=_.useRef(null);return _.useEffect(()=>{if(!e)return;const r=250;let s=0,i=-1,o=performance.now(),a=0,c=0,l=!1;function d(){if(c++,a=performance.now()-o,a>r){const u=Math.round(c*(r/a)*(1e3/r));u>s&&(s=u);const p=s*.75;(u<p&&!l||u>=p&&l)&&(l=!l),n.current.innerHTML=`FPS ${u.toString()}`,n.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),a-=r,c=0,o=performance.now()}i=t.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(i)}},[e,t]),e?h.jsx("div",{ref:n}):null}const wZ=_.memo(function(){const e=hn(),{MainMenu:n,QuickActions:r,ActionsMenu:s,PageMenu:i}=ni();return!n&&!i&&e<6?null:h.jsx("div",{className:"tlui-menu-zone",children:h.jsxs("div",{className:"tlui-buttons__horizontal",children:[n&&h.jsx(n,{}),i&&h.jsx(i,{}),e<6?null:h.jsxs(h.Fragment,{children:[r&&h.jsx(r,{}),s&&h.jsx(s,{})]})]})})});function CZ(){const t=K(),e=ye(),[n,r]=_.useState(!1),s=_.useRef(!1);return Bs("toggle showback to content",()=>{const i=s.current,o=t.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===t.getCulledShapes().size),i!==a&&(r(a),s.current=a)},[t]),n?h.jsx(W,{...e["back-to-content"],onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function _Z(){const t=K(),e=ye();return X("is pen mode",()=>t.getInstanceState().isPenMode,[t])?h.jsx(W,{...e["exit-pen-mode"]}):null}function IZ(){const t=K(),e=ye();return X("is following user",()=>!!t.getInstanceState().followingUserId,[t])?h.jsx(W,{...e["stop-following"]}):null}function PZ(){return h.jsxs(h.Fragment,{children:[h.jsx(_Z,{}),h.jsx(CZ,{}),h.jsx(IZ,{})]})}function EZ({children:t}){const e=t??h.jsx(PZ,{});return h.jsx("div",{className:"tlui-helper-buttons",children:h.jsx(sr,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function kZ(){const t=ye(),e=Jd(),n=eu();return h.jsxs(h.Fragment,{children:[h.jsxs(Pe,{label:"shortcuts-dialog.tools",id:"tools",children:[h.jsx(W,{...t["toggle-tool-lock"]}),h.jsx(W,{...t["insert-media"]}),h.jsx(W,{...e.select}),h.jsx(W,{...e.draw}),h.jsx(W,{...e.eraser}),h.jsx(W,{...e.hand}),h.jsx(W,{...e.rectangle}),h.jsx(W,{...e.ellipse}),h.jsx(W,{...e.arrow}),h.jsx(W,{...e.line}),h.jsx(W,{...e.text}),h.jsx(W,{...e.frame}),h.jsx(W,{...e.note}),h.jsx(W,{...e.laser})]}),h.jsxs(Pe,{label:"shortcuts-dialog.preferences",id:"preferences",children:[h.jsx(W,{...t["toggle-dark-mode"]}),h.jsx(W,{...t["toggle-focus-mode"]}),h.jsx(W,{...t["toggle-grid"]})]}),h.jsxs(Pe,{label:"shortcuts-dialog.edit",id:"edit",children:[h.jsx(W,{...t.undo}),h.jsx(W,{...t.redo}),h.jsx(W,{...t.cut}),h.jsx(W,{...t.copy}),h.jsx(W,{...t.paste}),h.jsx(W,{...t["select-all"]}),h.jsx(W,{...t.delete}),h.jsx(W,{...t.duplicate})]}),h.jsxs(Pe,{label:"shortcuts-dialog.view",id:"view",children:[h.jsx(W,{...t["zoom-in"]}),h.jsx(W,{...t["zoom-out"]}),h.jsx(W,{...t["zoom-to-100"]}),h.jsx(W,{...t["zoom-to-fit"]}),h.jsx(W,{...t["zoom-to-selection"]})]}),h.jsxs(Pe,{label:"shortcuts-dialog.transform",id:"transform",children:[h.jsx(W,{...t["bring-to-front"]}),h.jsx(W,{...t["bring-forward"]}),h.jsx(W,{...t["send-backward"]}),h.jsx(W,{...t["send-to-back"]}),h.jsx(W,{...t.group}),h.jsx(W,{...t.ungroup}),h.jsx(W,{...t["flip-horizontal"]}),h.jsx(W,{...t["flip-vertical"]}),h.jsx(W,{...t["align-top"]}),h.jsx(W,{...t["align-center-vertical"]}),h.jsx(W,{...t["align-bottom"]}),h.jsx(W,{...t["align-left"]}),h.jsx(W,{...t["align-center-horizontal"]}),h.jsx(W,{...t["align-right"]})]}),n&&h.jsx(Pe,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:h.jsx(W,{...t["open-cursor-chat"]})})]})}const TZ=_.memo(function({children:e}){const n=Re(),r=hn(),s=e??h.jsx(kZ,{});return h.jsxs(h.Fragment,{children:[h.jsxs(Yd,{className:"tlui-shortcuts-dialog__header",children:[h.jsx(Xd,{children:n("shortcuts-dialog.title")}),h.jsx(Zd,{})]}),h.jsx(Za,{className:be("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=gt.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=gt.TABLET}),children:h.jsx(sr,{type:"keyboard-shortcuts",sourceId:"kbd",children:s})}),h.jsx("div",{className:"tlui-dialog__scrim"})]})}),MZ=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function AZ(){const t=K(),e=Gt(),n=X("colorScheme",()=>t.user.getUserPreferences().colorScheme??t.user.getIsDarkMode()?"dark":"light",[t]);return h.jsx(fn,{id:"help menu color-scheme",label:"menu.theme",children:h.jsx(Pe,{id:"languages",children:MZ.map(({colorScheme:r,label:s})=>h.jsx(An,{id:`color-scheme-${r}`,label:s,checked:r===n,onSelect:()=>{t.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}function KN(){const t=K(),e=Gt(),n=X("locale",()=>t.user.getLocale(),[t]);return h.jsx(fn,{id:"help menu language",label:"menu.language",children:h.jsx(Pe,{id:"languages",children:Va.map(({locale:r,label:s})=>h.jsx(An,{id:`language-${r}`,title:r,label:s,checked:r===n,onSelect:()=>{t.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})})}function jZ(){return h.jsxs(h.Fragment,{children:[h.jsx(KN,{}),h.jsx(VN,{})]})}function VN(){const{KeyboardShortcutsDialog:t}=ni(),{addDialog:e}=Di();return t?h.jsx(W,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{e({component:t})}}):null}function RZ(){return h.jsxs(h.Fragment,{children:[h.jsx(DZ,{}),h.jsx(BZ,{}),h.jsx(OZ,{}),h.jsx($Z,{}),h.jsx(UZ,{}),h.jsx(zZ,{})]})}function OZ(){const t=ye();return h.jsxs(fn,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[h.jsxs(Pe,{id:"export-all-as-group",children:[h.jsx(W,{...t["export-all-as-svg"]}),h.jsx(W,{...t["export-all-as-png"]}),h.jsx(W,{...t["export-all-as-json"]})]}),h.jsx(Pe,{id:"export-all-as-bg",children:h.jsx(Uw,{})})]})}function DZ(){const t=K(),e=X("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]);return h.jsxs(fn,{id:"edit",label:"menu.edit",disabled:!e,children:[h.jsx(FZ,{}),h.jsx(BN,{}),h.jsx($N,{}),h.jsx(LZ,{}),h.jsx(NZ,{}),h.jsx(Pe,{id:"select-all",children:h.jsx(zN,{})})]})}function LZ(){return h.jsxs(Pe,{id:"misc",children:[h.jsx(AN,{}),h.jsx(jN,{}),h.jsx(TN,{}),h.jsx(kN,{}),h.jsx(RN,{}),h.jsx(ON,{}),h.jsx(qN,{}),h.jsx(UN,{}),h.jsx(MN,{})]})}function NZ(){return h.jsxs(Pe,{id:"lock",children:[h.jsx(DN,{}),h.jsx(LX,{})]})}function FZ(){const t=ye(),e=pL(),n=hL();return h.jsxs(Pe,{id:"undo-redo",children:[h.jsx(W,{...t.undo,disabled:!e}),h.jsx(W,{...t.redo,disabled:!n})]})}function BZ(){const t=ye();return h.jsx(fn,{id:"view",label:"menu.view",children:h.jsxs(Pe,{id:"view-actions",children:[h.jsx(W,{...t["zoom-in"]}),h.jsx(W,{...t["zoom-out"]}),h.jsx(LN,{}),h.jsx(NN,{}),h.jsx(FN,{})]})})}function $Z(){const t=ye();return h.jsxs(Pe,{id:"extras",children:[h.jsx(W,{...t["insert-embed"]}),h.jsx(W,{...t["insert-media"]})]})}function zZ(){function t(e){window.open(e,"_blank")}return h.jsx(Pe,{id:"help",children:h.jsx(fn,{id:"help",label:"menu.help",children:h.jsxs(Pe,{id:"help-actions",children:[h.jsx(VN,{}),h.jsx(W,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{t("https://tldraw.dev")}})]})})})}function UZ(){return h.jsx(Pe,{id:"preferences",children:h.jsxs(fn,{id:"preferences",label:"menu.preferences",children:[h.jsxs(Pe,{id:"preferences-actions",children:[h.jsx(WX,{}),h.jsx(YX,{}),h.jsx(XX,{}),h.jsx(ZX,{}),h.jsx(QX,{}),h.jsx(JX,{}),h.jsx(eZ,{}),h.jsx(nZ,{}),h.jsx(rZ,{}),h.jsx(tZ,{})]}),h.jsx(Pe,{id:"color-scheme",children:h.jsx(AZ,{})}),h.jsx(Pe,{id:"language",children:h.jsx(KN,{})})]})})}const qZ=_.memo(function({children:e}){const n=Dt(),[r,s]=Ss("main menu"),i=Re(),o=e??h.jsx(RZ,{});return h.jsxs(Bw,{dir:"ltr",open:r,onOpenChange:s,modal:!1,children:[h.jsx($w,{asChild:!0,dir:"ltr",children:h.jsx(we,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:h.jsx(Ae,{icon:"menu",small:!0})})}),h.jsx(ou,{container:n,children:h.jsx(zw,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:h.jsx(sr,{type:"menu",sourceId:"main-menu",children:o})})})]})}),qf={};function fa(t){if(qf[t])return qf[t];const n=document.createElement("canvas").getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const[r,s,i,o]=n.getImageData(0,0,1,1).data,a=new Float32Array([r/255,s/255,i/255,o/255]);return qf[t]=a,a}const Bl=10,WN=24*Bl+12+48;function Ji(t,{center:e,radius:n,numArcSegments:r=20,startAngle:s=0,endAngle:i=Ue,offset:o=0}){const a=(i-s)/r;let c=o;for(let l=s;l<i;l+=a)t[c++]=e.x,t[c++]=e.y,t[c++]=e.x+Math.cos(l)*n,t[c++]=e.y+Math.sin(l)*n,t[c++]=e.x+Math.cos(l+a)*n,t[c++]=e.y+Math.sin(l+a)*n;return t}function eo(t,e,n,r,s,i){t[e++]=n,t[e++]=r,t[e++]=n,t[e++]=r+i,t[e++]=n+s,t[e++]=r,t[e++]=n+s,t[e++]=r,t[e++]=n,t[e++]=r+i,t[e++]=n+s,t[e++]=r+i}function HZ(t,e,n){const r=Bl;n=Math.min(n,Math.min(e.w,e.h)/2);const s=ce.ExpandBy(e,-n);if(s.w<=0||s.h<=0)return Ji(t,{center:e.center,radius:n,numArcSegments:Bl*4}),Bl*4*6;let i=0;return eo(t,i,s.minX,s.minY,s.w,s.h),i+=12,eo(t,i,s.minX,e.minY,s.w,n),i+=12,eo(t,i,s.maxX,s.minY,n,s.h),i+=12,eo(t,i,s.minX,s.maxY,s.w,n),i+=12,eo(t,i,e.minX,s.minY,n,s.h),i+=12,Ji(t,{numArcSegments:r,offset:i,center:s.point,radius:n,startAngle:$e,endAngle:$e*1.5}),i+=r*6,Ji(t,{numArcSegments:r,offset:i,center:w.Add(s.point,new w(s.w,0)),radius:n,startAngle:$e*1.5,endAngle:Ue}),i+=r*6,Ji(t,{numArcSegments:r,offset:i,center:w.Add(s.point,s.size),radius:n,startAngle:0,endAngle:Xe}),i+=r*6,Ji(t,{numArcSegments:r,offset:i,center:w.Add(s.point,new w(0,s.h)),radius:n,startAngle:Xe,endAngle:$e}),WN}function GZ(t){if(!t)throw new Error("Canvas element not found");const e=t.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const s=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,i=e.createShader(e.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(e.shaderSource(i,s),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const c=e.getUniformLocation(o,"canvasPageBounds"),l=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:Cl(e,1024),unselectedShapes:Cl(e,4096),viewport:Cl(e,WN),collaborators:Cl(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(l,p)},setCanvasPageBounds(p){e.uniform4fv(c,p)}}}function Cl(t,e){const n=t.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(e)}}function rP(t,e,n){let r=t.vertices.length;for(;r<e+n.length;)r*=2;if(r!=t.vertices.length){const s=new Float32Array(r);s.set(t.vertices),t.vertices=s}t.vertices.set(n,e)}var KZ=Object.defineProperty,VZ=Object.getOwnPropertyDescriptor,ti=(t,e,n,r)=>{for(var s=VZ(e,n),i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=o(e,n,s)||s);return s&&KZ(e,n,s),s};class xs{constructor(e,n,r){this.editor=e,this.elem=n,this.container=r,this.gl=GZ(n),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",s=>{const i=e.getShapeMaskedPageBounds(s.id);if(!i)return null;const o=new Float32Array(12);return eo(o,0,i.x,i.y,i.w,i.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Oi("minimap render",this.render))}disposables=[];close=()=>this.disposables.forEach(e=>e());gl;shapeGeometryCache;_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:fa(e.getPropertyValue("--color-text-3").trim()),selectFill:fa(e.getPropertyValue("--color-selected").trim()),viewportFill:fa(e.getPropertyValue("--color-muted-1").trim()),background:fa(e.getPropertyValue("--color-low").trim())}}colors;updateColors(){this.colors=this._getColors()}id=lt();getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),n=this.editor.getCurrentPageBounds();return n?ce.Expand(n,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),n=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new w(e.maxX,e.maxY));return new ce(n.x,n.y,r.x-n.x,r.y-n.y)}_getCanvasBoundingRect(){const{x:e,y:n,width:r,height:s}=this.elem.getBoundingClientRect();return new ce(e,n,r,s)}canvasBoundingClientRect=Tt("canvasBoundingClientRect",new ce);getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const n=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(n)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),n=this.getDpr();return new w(e.width*n,e.height*n)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}originPagePoint=new w;originPageCenter=new w;isInViewport=!1;getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),n=this.getContentPageBounds(),r=e.width/e.height;let s=n.width,i=s/r;i<n.height&&(i=n.height,s=i*r);const o=new ce(0,0,s,i);return o.center=n.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:n,w:r,h:s}=this.getCanvasPageBounds();return new Float32Array([e,n,r,s])}getMinimapPagePoint=(e,n)=>{const r=this.getCanvasPageBounds(),s=this.getCanvasScreenBounds();let i=e-s.x,o=n-s.y;return i*=r.width/s.width,o*=r.height/s.height,i+=r.minX,o+=r.minY,new w(i,o,1)};minimapScreenPointToPagePoint=(e,n,r=!1,s=!1)=>{const{editor:i}=this,o=i.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(e,n);if(s){const l=this.editor.getCurrentPageBounds()??new ce,d=l.minX-o.width/2,u=l.maxX+o.width/2,p=l.minY-o.height/2,f=l.maxY+o.height/2,m=Math.max(0,d+o.width-a),y=Math.max(0,-(u-o.width-a)),S=Math.max(0,p+o.height-c),g=Math.max(0,-(f-o.height-c));a+=(m-y)/2,c+=(S-g)/2,a=Et(a,d,u),c=Et(c,p,f)}if(r){const{originPagePoint:l}=this,d=Math.abs(a-l.x),u=Math.abs(c-l.y);d>u?c=l.y:a=l.x}return new w(a,c)};render=()=>{const e=this.gl.context,n=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=n.x,this.elem.height=n.y,e.viewport(0,0,n.x,n.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),s=this.colors;let i=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,l=a.length;c<l;c++){const d=a[c],u=this.shapeGeometryCache.get(d);if(!u)continue;const p=u.length;r.has(d)?(rP(this.gl.selectedShapes,i,u),i+=p):(rP(this.gl.unselectedShapes,o,u),o+=p)}this.drawShapes(this.gl.unselectedShapes,o,s.shapeFill),this.drawShapes(this.gl.selectedShapes,i,s.selectFill),this.drawViewport(),this.drawCollaborators()};drawShapes(e,n,r){this.gl.prepareTriangles(e,n),this.gl.setFillColor(r),this.gl.drawTriangles(n)}drawViewport(){const e=this.editor.getViewportPageBounds(),n=HZ(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,n),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(n),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const n=20,r=n*6,s=r*e.length;this.gl.collaborators.vertices.length<s&&(this.gl.collaborators.vertices=new Float32Array(s));const i=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:c}of e)Ji(i,{center:w.From(c),radius:3*a,offset:o,numArcSegments:n}),o+=r;this.gl.prepareTriangles(this.gl.collaborators,s),o=0;for(const{color:c}of e)this.gl.setFillColor(fa(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,r/2),o+=r}}ti([J],xs.prototype,"getDpr");ti([J],xs.prototype,"getContentPageBounds");ti([J],xs.prototype,"getContentScreenBounds");ti([J],xs.prototype,"getCanvasSize");ti([J],xs.prototype,"getCanvasClientPosition");ti([J],xs.prototype,"getCanvasPageBounds");ti([J],xs.prototype,"getZoom");ti([J],xs.prototype,"getCanvasPageBoundsArray");function WZ(){const t=K(),e=Dt(),n=_.useRef(null),r=_.useRef(!1),s=_.useRef();_.useEffect(()=>{try{const d=new xs(t,n.current,e);return s.current=d,s.current.close}catch(d){t.annotateError(d,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout(()=>{throw d})}},[t,e]);const i=_.useCallback(d=>{if(!t.getCurrentPageShapeIds().size||!s.current)return;const u=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),p=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.originPagePoint.setTo(p),s.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(u,{animation:{duration:t.options.animationMediumMs}})},[t]),o=_.useCallback(d=>{if(!s.current)return;const u=d.currentTarget;if(yc(u,d),!t.getCurrentPageShapeIds().size)return;r.current=!0,s.current.isInViewport=!1;const p=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),f=t.getViewportPageBounds(),m=s.current.getContentPageBounds();if(new ce(m.x-f.width/2,m.y-f.height/2,m.width+f.width,m.height+f.height).containsPoint(p)&&!f.containsPoint(p)){s.current.isInViewport=f.containsPoint(p);const g=w.Sub(f.center,f.point),v=w.Add(p,g);s.current.originPagePoint.setTo(v),s.current.originPageCenter.setTo(p),t.centerOnPoint(p,{animation:{duration:t.options.animationMediumMs}})}else{const g=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.isInViewport=f.containsPoint(g),s.current.originPagePoint.setTo(g),s.current.originPageCenter.setTo(f.center)}function S(g){u&&Sc(u,g),r.current=!1,document.body.removeEventListener("pointerup",S)}document.body.addEventListener("pointerup",S)},[t]),a=_.useCallback(d=>{if(!s.current)return;const u=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(r.current){if(s.current.isInViewport){const y=s.current.originPagePoint.clone().sub(s.current.originPageCenter);t.centerOnPoint(w.Sub(u,y));return}t.centerOnPoint(u)}const p=s.current.getMinimapPagePoint(d.clientX,d.clientY),f=t.pageToScreen(p),m={type:"pointer",target:"canvas",name:"pointer_move",..._n(d),point:f,isPen:t.getInstanceState().isPenMode};t.dispatch(m)},[t]),c=_.useCallback(d=>{const u=VR(d);t.dispatch({type:"wheel",name:"wheel",delta:u,point:new w(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey})},[t]),l=Cc();return _.useEffect(()=>{t.timers.setTimeout(()=>{s.current?.updateColors(),s.current?.render()})},[l,t]),h.jsx("div",{className:"tlui-minimap",children:h.jsx("canvas",{role:"img","aria-label":"minimap",ref:n,className:"tlui-minimap__canvas",onDoubleClick:i,onPointerMove:a,onPointerDown:o,onWheel:c})})}function YZ(t,e){const[n,r]=qe.useState(e);qe.useLayoutEffect(()=>{const i=Ab(t);if(i)try{r(JSON.parse(i))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const s=qe.useCallback(i=>{r(o=>{const a=typeof i=="function"?i(o):i;return jb(t,JSON.stringify(a)),a})},[t]);return[n,s]}const XZ=_.memo(function(){const e=ye(),n=Re(),r=hn(),[s,i]=YZ("minimap",!0),o=_.useCallback(()=>{i(l=>!l)},[i]),{ZoomMenu:a,Minimap:c}=ni();return r<gt.MOBILE?null:h.jsxs("div",{className:"tlui-navigation-panel",children:[h.jsx("div",{className:"tlui-buttons__horizontal",children:a&&r<gt.TABLET?h.jsx(a,{}):s?h.jsxs(h.Fragment,{children:[a&&h.jsx(a,{}),c&&h.jsx(we,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:h.jsx(Ae,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):h.jsxs(h.Fragment,{children:[h.jsx(we,{type:"icon","data-testid":"minimap.zoom-out",title:`${n(Qa(e["zoom-out"].label))} ${Jx(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:h.jsx(Ae,{icon:"minus"})}),a&&h.jsx(a,{}),h.jsx(we,{type:"icon","data-testid":"minimap.zoom-in",title:`${n(Qa(e["zoom-in"].label))} ${Jx(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:h.jsx(Ae,{icon:"plus"})}),c&&h.jsx(we,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:h.jsx(Ae,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),c&&r>=gt.TABLET&&!s&&h.jsx(c,{})]})}),ZZ=function({name:e,id:n,isCurrentPage:r}){const s=K(),i=Gt(),o=_.useRef(null),a=_.useCallback(()=>{s.mark("rename page")},[s]),c=_.useCallback(l=>{s.renamePage(n,l||"New Page"),i("rename-page",{source:"page-menu"})},[s,n,i]);return h.jsx(Qd,{className:"tlui-page-menu__item__input",ref:l=>o.current=l,defaultValue:e,onValueChange:c,onFocus:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},tb=(t,e,n,r,s)=>{let i;const o=t.getPages(),a=n>r?o[r-1]:o[r],c=n>r?o[r]:o[r+1];a&&!c?i=fr(a.index):!a&&c?i=xz(o[0].index):i=Ha(a.index,c.index),i!==o[n].index&&(t.mark("moving page"),t.updatePage({id:e,index:i}),s("move-page",{source:"page-menu"}))},sP=Ot(function({index:e,listSize:n,item:r,onRename:s}){const i=K(),o=Re(),a=i.getPages(),c=Gt(),l=_.useCallback(()=>{i.mark("creating page");const f=ds.createId();i.duplicatePage(r.id,f),c("duplicate-page",{source:"page-menu"})},[i,r,c]),d=_.useCallback(()=>{tb(i,r.id,e,e-1,c)},[i,r,e,c]),u=_.useCallback(()=>{tb(i,r.id,e,e+1,c)},[i,r,e,c]),p=_.useCallback(()=>{i.mark("deleting page"),i.deletePage(r.id),c("delete-page",{source:"page-menu"})},[i,r,c]);return h.jsxs(Ei,{id:`page item submenu ${e}`,children:[h.jsx(ki,{children:h.jsx(we,{type:"icon",title:o("page-menu.submenu.title"),children:h.jsx(Ae,{icon:"dots-vertical"})})}),h.jsx(Ti,{alignOffset:0,side:"right",sideOffset:-4,children:h.jsxs(sr,{type:"menu",sourceId:"page-menu",children:[h.jsxs(Pe,{id:"modify",children:[s&&h.jsx(W,{id:"rename",label:"page-menu.submenu.rename",onSelect:s}),h.jsx(W,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:l,disabled:a.length>=i.options.maxPages}),e>0&&h.jsx(W,{id:"move-up",onSelect:d,label:"page-menu.submenu.move-up"}),e<n-1&&h.jsx(W,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:u})]}),n>1&&h.jsx(Pe,{id:"delete",children:h.jsx(W,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),QZ=_.memo(function(){const e=K(),n=Gt(),r=Re(),s=hn(),i=_.useCallback(()=>g(!1),[]),[o,a]=Ss("page-menu",i),c=36,l=_.useRef(null),d=X("pages",()=>e.getPages(),[e]),u=X("currentPage",()=>e.getCurrentPage(),[e]),p=X("currentPageId",()=>e.getCurrentPageId(),[e]),f=ys(),m=X("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),y=X("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[S,g]=_.useState(!1),v=_.useCallback(()=>{f||g(j=>!j)},[f]),x=_.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,E]=_.useState(Object.fromEntries(d.map((j,R)=>[j.id,{y:R*c,offsetY:0,isSelected:!1}])));_.useLayoutEffect(()=>{E(Object.fromEntries(d.map((j,R)=>[j.id,{y:R*c,offsetY:0,isSelected:!1}])))},[c,d]),_.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const j=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(j){const R=l.current;if(!R)return;const L=j.offsetTop,F=R.scrollTop;L<F&&R.scrollTo({top:L});const H=L+c,B=R.scrollTop+R.offsetHeight;H>B&&R.scrollTo({top:H-R.offsetHeight})}})},[c,p,o,e]);const I=_.useCallback(j=>{const{clientY:R,currentTarget:L}=j,{dataset:{id:F,index:H}}=L;if(!F||!H)return;const B=x.current;yc(j.currentTarget,j),B.status="pointing",B.pointing={id:F,index:+H};const Q=b[F].y;B.startY=R,B.startIndex=Math.max(0,Math.min(Math.round(Q/c),d.length-1))},[c,d.length,b]),C=_.useCallback(j=>{const R=x.current;if(R.status==="pointing"){const{clientY:L}=j,F=L-R.startY;Math.abs(F)>5&&(R.status="dragging")}if(R.status==="dragging"){const{clientY:L}=j,F=L-R.startY,H=b[R.pointing.id],{startIndex:B,pointing:$}=R,Q=H.y+F,Z=Math.max(0,Math.min(Math.round(Q/c),d.length-1)),ee={...b};if(ee[$.id]={y:H.y,offsetY:F,isSelected:!0},Z!==R.dragIndex){R.dragIndex=Z;for(let ne=0;ne<d.length;ne++){const N=d[ne];if(N.id===R.pointing.id)continue;let{y:D}=ee[N.id];Z===B?D=ne*c:Z<B?Z<=ne&&ne<B?D=(ne+1)*c:D=ne*c:Z>B&&(Z>=ne&&ne>B?D=(ne-1)*c:D=ne*c),D!==ee[N.id].y&&(ee[N.id]={y:D,offsetY:0,isSelected:!0})}}E(ee)}},[c,d,b]),P=_.useCallback(j=>{const R=x.current;if(R.status==="dragging"){const{id:L,index:F}=R.pointing;tb(e,L,F,R.dragIndex,n)}Sc(j.currentTarget,j),R.status="idle"},[e,n]),k=_.useCallback(j=>{const R=x.current;j.key==="Escape"&&(R.status==="dragging"&&E(Object.fromEntries(d.map((L,F)=>[L.id,{y:F*c,offsetY:0,isSelected:!1}]))),R.status="idle")},[c,d]),T=_.useCallback(()=>{f||(e.run(()=>{e.mark("creating page");const j=ds.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:j}),e.setCurrentPage(j),g(!0)}),n("new-page",{source:"page-menu"}))},[e,r,f,n]),M=_.useCallback(j=>{e.setCurrentPage(j),n("change-page",{source:"page-menu"})},[e,n]),A=_.useCallback((j,R)=>{e.renamePage(j,R),n("rename-page",{source:"page-menu"})},[e,n]);return h.jsxs(Pw,{id:"pages",onOpenChange:a,open:o,children:[h.jsx(Ew,{"data-testid":"main.page-menu",children:h.jsxs(we,{type:"menu",title:u.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[h.jsx("div",{className:"tlui-page-menu__name",children:u.name}),h.jsx(Ae,{icon:"chevron-down",small:!0})]})}),h.jsx(kw,{side:"bottom",align:"start",sideOffset:6,children:h.jsxs("div",{className:"tlui-page-menu__wrapper",children:[h.jsxs("div",{className:"tlui-page-menu__header",children:[h.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!f&&h.jsxs("div",{className:"tlui-buttons__horizontal",children:[h.jsx(we,{type:"icon","data-testid":"page-menu.edit",title:r(S?"page-menu.edit-done":"page-menu.edit-start"),onClick:v,children:h.jsx(Ae,{icon:S?"check":"edit"})}),h.jsx(we,{type:"icon","data-testid":"page-menu.create",title:r(m?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:m,onClick:T,children:h.jsx(Ae,{icon:"plus"})})]})]}),h.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*d.length+4},ref:l,children:d.map((j,R)=>{const L=b[j.id]??{offsetY:0};return S?h.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:j.id===u.id?888:R,transform:`translate(0px, ${L.y+L.offsetY}px)`},children:[h.jsx(we,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:I,onPointerUp:P,onPointerMove:C,onKeyDown:k,"data-id":j.id,"data-index":R,children:h.jsx(Ae,{icon:"drag-handle-dots"})}),s<gt.TABLET_SM&&y?h.jsxs(we,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const F=window.prompt("Rename page",j.name);F&&F!==j.name&&A(j.id,F)},onDoubleClick:v,children:[h.jsx(eb,{checked:j.id===u.id}),h.jsx(vt,{children:j.name})]}):h.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:h.jsx(ZZ,{id:j.id,name:j.name,isCurrentPage:j.id===u.id})}),!f&&h.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":S,children:h.jsx(sP,{index:R,item:j,listSize:d.length})})]},j.id+"_editing"):h.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[h.jsxs(we,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>M(j.id),onDoubleClick:v,title:r("page-menu.go-to-page"),children:[h.jsx(eb,{checked:j.id===u.id}),h.jsx(vt,{children:j.name})]}),!f&&h.jsx("div",{className:"tlui-page_menu__item__submenu",children:h.jsx(sP,{index:R,item:j,listSize:d.length,onRename:()=>{if(e.environment.isIos){const F=window.prompt("Rename page",j.name);F&&F!==j.name&&A(j.id,F)}else g(!0),p!==j.id&&M(j.id)}})})]},j.id)})})]})})]})});function JZ(){const t=ye(),e=K(),n=pL(),r=hL(),s=pn(1),i=ys(),o=X("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]),a=vs(),c=s&&a;if(!(i&&!o))return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t.undo,disabled:!n}),h.jsx(W,{...t.redo,disabled:!r}),h.jsx(W,{...t.delete,disabled:!c}),h.jsx(W,{...t.duplicate,disabled:!c})]})}const eQ=_.memo(function({children:e}){const n=e??h.jsx(JZ,{});return h.jsx(sr,{type:"small-icons",sourceId:"quick-actions",children:n})});function tQ({userId:t}){const e=Ld(t);return e?h.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},t):null}const nQ=Ot(function({userId:e}){const n=K(),r=Re(),s=Gt(),i=Ld(e),o=_.useCallback(()=>{n.getInstanceState().followingUserId===e?(n.stopFollowingUser(),s("stop-following",{source:"people-menu"})):(n.startFollowingUser(e),s("start-following",{source:"people-menu"}))},[n,e,s]),a=i?.followingUserId===n.user.getId(),c=n.getInstanceState().followingUserId===e;return i?h.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[h.jsxs(we,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>n.zoomToUser(e),onDoubleClick:o,children:[h.jsx(zr,{icon:"color",color:i.color}),h.jsx("div",{className:"tlui-people-menu__name",children:i.userName??"New User"})]}),h.jsx(we,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,"data-active":c||a,children:h.jsx(Ae,{icon:a?"leading":c?"following":"follow"})})]}):null});function rQ({count:t}){return h.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(t)})}const sQ=Ot(function(){const e=K(),n=Dt(),r=Re(),s=Gt(),i=_.useRef(!1),[o,a]=_.useState(!1),c=_.useCallback(y=>{a(y)},[]),l=e.user.getColor(),d=_.useCallback(y=>{e.user.updateUserPreferences({color:y}),s("set-color",{source:"people-menu"})},[e,s]),{handleButtonClick:u,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:m}=qe.useMemo(()=>{const y=()=>{i.current=!1,window.removeEventListener("pointerup",y)};return{handleButtonClick:b=>{const{id:E}=b.currentTarget.dataset;E&&l!==E&&d(E)},handleButtonPointerDown:b=>{const{id:E}=b.currentTarget.dataset;E&&(d(E),i.current=!0,window.addEventListener("pointerup",y))},handleButtonPointerEnter:b=>{if(!i.current)return;const{id:E}=b.currentTarget.dataset;E&&d(E)},handleButtonPointerUp:b=>{const{id:E}=b.currentTarget.dataset;E&&d(E)}}},[l,d]);return h.jsxs(ww,{onOpenChange:c,open:o,children:[h.jsx(Cw,{dir:"ltr",asChild:!0,children:h.jsx(we,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:h.jsx(Ae,{icon:"color"})})}),h.jsx(_w,{container:n,children:h.jsx(Iw,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:h.jsx("div",{className:"tlui-buttons__grid",children:Rx.map(y=>h.jsx(we,{type:"icon","data-id":y,"data-testid":y,"aria-label":y,"data-state":l===y?"hinted":void 0,title:y,className:"tlui-button-grid__button",style:{color:y},onPointerEnter:f,onPointerDown:p,onPointerUp:m,onClick:u,children:h.jsx(Ae,{icon:"color"})},y))})})})]})});function iQ(){const t=K(),e=Gt(),n=X("userName",()=>t.user.getName(),[]),r=Re(),s=_.useRef(n),i=_.useRef(n),[o,a]=_.useState(!1),c=_.useCallback(()=>{a(u=>!u)},[]),l=_.useCallback(u=>{i.current=u,t.user.updateUserPreferences({name:u})},[t]),d=_.useCallback(()=>{s.current!==i.current&&(e("change-user-name",{source:"people-menu"}),s.current=i.current)},[e]);return h.jsxs("div",{className:"tlui-people-menu__user",children:[h.jsx(sQ,{}),o?h.jsx(Qd,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:l,onComplete:c,onCancel:c,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:n}),n==="New User"?h.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),h.jsx(we,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:h.jsx(Ae,{icon:o?"check":"edit"})})]})}const oQ=Ot(function({children:e}){const n=Re(),r=Dt(),s=K(),i=QR(),o=X("user",()=>s.user.getColor(),[s]),a=X("user",()=>s.user.getName(),[s]),[c,l]=Ss("people menu");return h.jsxs(ww,{onOpenChange:l,open:c,children:[h.jsx(Cw,{dir:"ltr",asChild:!0,children:h.jsxs("button",{className:"tlui-people-menu__avatars-button",title:n("people-menu.title"),children:[i.length>5&&h.jsx(rQ,{count:i.length-5}),h.jsxs("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(d=>h.jsx(tQ,{userId:d},d)),h.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:a==="New User"?"":a[0]??""})]})]})}),h.jsx(_w,{container:r,children:h.jsx(Iw,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:h.jsxs("div",{className:"tlui-people-menu__wrapper",children:[h.jsx("div",{className:"tlui-people-menu__section",children:h.jsx(iQ,{})}),i.length>0&&h.jsx("div",{className:"tlui-people-menu__section",children:i.map(d=>h.jsx(nQ,{userId:d},d+"_presence"))}),e]})})})]})});function aQ(){return h.jsx("div",{className:"tlui-share-zone",draggable:!1,children:h.jsx(oQ,{})})}const cQ=Object.freeze([zn,wi,Ci,Br]);function YN(t=cQ){const e=K();return X("getRelevantStyles",()=>{const n=new Dx(e.getSharedStyles()),r=!!e.root.getCurrent()?.shapeType,s=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(n.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const i of t)n.applyValue(i,e.getStyleForNextShape(i));return r||s||n.size>0?n:null},[e])}const nr={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},gi=_.memo(function(e){const{uiType:n,items:r,title:s,style:i,value:o,onValueChange:a,theme:c}=e,l=K(),d=Re(),u=_.useRef(!1),p=_.useRef(null),{handleButtonClick:f,handleButtonPointerDown:m,handleButtonPointerEnter:y,handleButtonPointerUp:S}=_.useMemo(()=>{const g=()=>{u.current=!1,window.removeEventListener("pointerup",g);const I=p.current;I&&["TEXTAREA","INPUT"].includes(I.nodeName)&&I.focus(),p.current=null};return{handleButtonClick:I=>{const{id:C}=I.currentTarget.dataset;o.type==="shared"&&o.value===C||(l.mark("point picker item"),a(i,C))},handleButtonPointerDown:I=>{const{id:C}=I.currentTarget.dataset;l.mark("point picker item"),a(i,C),u.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",g)},handleButtonPointerEnter:I=>{if(!u.current)return;const{id:C}=I.currentTarget.dataset;a(i,C)},handleButtonPointerUp:I=>{const{id:C}=I.currentTarget.dataset;o.type==="shared"&&o.value===C||a(i,C)}}},[o,l,a,i]);return h.jsx("div",{"data-testid":`style.${n}`,className:be("tlui-buttons__grid"),children:r.map(g=>h.jsx(we,{type:"icon","data-id":g.value,"data-testid":`style.${n}.${g.value}`,"aria-label":g.value,"data-state":o.type==="shared"&&o.value===g.value?"hinted":void 0,title:s+" — "+d(`${n}-style.${g.value}`),className:be("tlui-button-grid__button"),style:i===zn?{color:c[g.value].solid}:void 0,onPointerEnter:y,onPointerDown:m,onPointerUp:S,onClick:f,children:h.jsx(Ae,{icon:g.icon})},g.value))})});function lo(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t?.(s),n===!1||!s.defaultPrevented)return e?.(s)}}var lQ=bd[" useInsertionEffect ".trim().toString()]||wd;function dQ({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[s,i,o]=uQ({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:s;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const u=d.current;u!==a&&console.warn(`${r} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const u=hQ(d)?d(t):d;u!==t&&o.current?.(u)}else i(d)},[a,t,i,o]);return[c,l]}function uQ({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),s=_.useRef(n),i=_.useRef(e);return lQ(()=>{i.current=e},[e]),_.useEffect(()=>{s.current!==n&&(i.current?.(n),s.current=n)},[n,s]),[n,r,i]}function hQ(t){return typeof t=="function"}var XN=["PageUp","PageDown"],ZN=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],QN={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Bo="Slider",[nb,pQ,fQ]=MA(Bo),[JN]=lc(Bo,[fQ]),[gQ,au]=JN(Bo),e3=_.forwardRef((t,e)=>{const{name:n,min:r=0,max:s=100,step:i=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:d,onValueChange:u=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:m,...y}=t,S=_.useRef(new Set),g=_.useRef(0),x=o==="horizontal"?mQ:yQ,[b=[],E]=dQ({prop:d,defaultProp:l,onChange:M=>{[...S.current][g.current]?.focus(),u(M)}}),I=_.useRef(b);function C(M){const A=wQ(b,M);T(M,A)}function P(M){T(M,g.current)}function k(){const M=I.current[g.current];b[g.current]!==M&&p(b)}function T(M,A,{commit:j}={commit:!1}){const R=PQ(i),L=EQ(Math.round((M-r)/i)*i+r,R),F=EA(L,[r,s]);E((H=[])=>{const B=xQ(H,F,A);if(IQ(B,c*i)){g.current=B.indexOf(F);const $=String(B)!==String(H);return $&&j&&p(B),$?B:H}else return H})}return h.jsx(gQ,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:s,valueIndexToChangeRef:g,thumbs:S.current,values:b,orientation:o,form:m,children:h.jsx(nb.Provider,{scope:t.__scopeSlider,children:h.jsx(nb.Slot,{scope:t.__scopeSlider,children:h.jsx(x,{"aria-disabled":a,"data-disabled":a?"":void 0,...y,ref:e,onPointerDown:lo(y.onPointerDown,()=>{a||(I.current=b)}),min:r,max:s,inverted:f,onSlideStart:a?void 0:C,onSlideMove:a?void 0:P,onSlideEnd:a?void 0:k,onHomeKeyDown:()=>!a&&T(r,0,{commit:!0}),onEndKeyDown:()=>!a&&T(s,b.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:A})=>{if(!a){const L=XN.includes(M.key)||M.shiftKey&&ZN.includes(M.key)?10:1,F=g.current,H=b[F],B=i*L*A;T(H+B,F,{commit:!0})}}})})})})});e3.displayName=Bo;var[t3,n3]=JN(Bo,{startEdge:"left",endEdge:"right",size:"width",direction:1}),mQ=_.forwardRef((t,e)=>{const{min:n,max:r,dir:s,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...d}=t,[u,p]=_.useState(null),f=Un(e,x=>p(x)),m=_.useRef(void 0),y=PA(s),S=y==="ltr",g=S&&!i||!S&&i;function v(x){const b=m.current||u.getBoundingClientRect(),E=[0,b.width],C=qw(E,g?[n,r]:[r,n]);return m.current=b,C(x-b.left)}return h.jsx(t3,{scope:t.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:h.jsx(r3,{dir:y,"data-orientation":"horizontal",...d,ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:x=>{const b=v(x.clientX);o?.(b)},onSlideMove:x=>{const b=v(x.clientX);a?.(b)},onSlideEnd:()=>{m.current=void 0,c?.()},onStepKeyDown:x=>{const E=QN[g?"from-left":"from-right"].includes(x.key);l?.({event:x,direction:E?-1:1})}})})}),yQ=_.forwardRef((t,e)=>{const{min:n,max:r,inverted:s,onSlideStart:i,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=t,d=_.useRef(null),u=Un(e,d),p=_.useRef(void 0),f=!s;function m(y){const S=p.current||d.current.getBoundingClientRect(),g=[0,S.height],x=qw(g,f?[r,n]:[n,r]);return p.current=S,x(y-S.top)}return h.jsx(t3,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:h.jsx(r3,{"data-orientation":"vertical",...l,ref:u,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:y=>{const S=m(y.clientY);i?.(S)},onSlideMove:y=>{const S=m(y.clientY);o?.(S)},onSlideEnd:()=>{p.current=void 0,a?.()},onStepKeyDown:y=>{const g=QN[f?"from-bottom":"from-top"].includes(y.key);c?.({event:y,direction:g?-1:1})}})})}),r3=_.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:s,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=t,d=au(Bo,n);return h.jsx(Tn.span,{...l,ref:e,onKeyDown:lo(t.onKeyDown,u=>{u.key==="Home"?(o(u),u.preventDefault()):u.key==="End"?(a(u),u.preventDefault()):XN.concat(ZN).includes(u.key)&&(c(u),u.preventDefault())}),onPointerDown:lo(t.onPointerDown,u=>{const p=u.target;p.setPointerCapture(u.pointerId),u.preventDefault(),d.thumbs.has(p)?p.focus():r(u)}),onPointerMove:lo(t.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&s(u)}),onPointerUp:lo(t.onPointerUp,u=>{const p=u.target;p.hasPointerCapture(u.pointerId)&&(p.releasePointerCapture(u.pointerId),i(u))})})}),s3="SliderTrack",i3=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,s=au(s3,n);return h.jsx(Tn.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...r,ref:e})});i3.displayName=s3;var rb="SliderRange",o3=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,s=au(rb,n),i=n3(rb,n),o=_.useRef(null),a=Un(e,o),c=s.values.length,l=s.values.map(p=>l3(p,s.min,s.max)),d=c>1?Math.min(...l):0,u=100-Math.max(...l);return h.jsx(Tn.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...r,ref:a,style:{...t.style,[i.startEdge]:d+"%",[i.endEdge]:u+"%"}})});o3.displayName=rb;var sb="SliderThumb",a3=_.forwardRef((t,e)=>{const n=pQ(t.__scopeSlider),[r,s]=_.useState(null),i=Un(e,a=>s(a)),o=_.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return h.jsx(SQ,{...t,ref:i,index:o})}),SQ=_.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:s,...i}=t,o=au(sb,n),a=n3(sb,n),[c,l]=_.useState(null),d=Un(e,v=>l(v)),u=c?o.form||!!c.closest("form"):!0,p=YF(c),f=o.values[r],m=f===void 0?0:l3(f,o.min,o.max),y=bQ(r,o.values.length),S=p?.[a.size],g=S?CQ(S,m,a.direction):0;return _.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),h.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${m}% + ${g}px)`},children:[h.jsx(nb.ItemSlot,{scope:t.__scopeSlider,children:h.jsx(Tn.span,{role:"slider","aria-label":t["aria-label"]||y,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:d,style:f===void 0?{display:"none"}:t.style,onFocus:lo(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),u&&h.jsx(c3,{name:s??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},r)]})});a3.displayName=sb;var vQ="RadioBubbleInput",c3=_.forwardRef(({__scopeSlider:t,value:e,...n},r)=>{const s=_.useRef(null),i=Un(s,r),o=lB(e);return _.useEffect(()=>{const a=s.current;if(!a)return;const c=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&d){const u=new Event("input",{bubbles:!0});d.call(a,e),a.dispatchEvent(u)}},[o,e]),h.jsx(Tn.input,{style:{display:"none"},...n,ref:i,defaultValue:e})});c3.displayName=vQ;function xQ(t=[],e,n){const r=[...t];return r[n]=e,r.sort((s,i)=>s-i)}function l3(t,e,n){const i=100/(n-e)*(t-e);return EA(i,[0,100])}function bQ(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function wQ(t,e){if(t.length===1)return 0;const n=t.map(s=>Math.abs(s-e)),r=Math.min(...n);return n.indexOf(r)}function CQ(t,e,n){const r=t/2,i=qw([0,50],[0,r]);return(r-i(e)*n)*n}function _Q(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function IQ(t,e){if(e>0){const n=_Q(t);return Math.min(...n)>=e}return!0}function qw(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function PQ(t){return(String(t).split(".")[1]||"").length}function EQ(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var kQ=e3,TQ=i3,MQ=o3,AQ=a3;const jQ=_.memo(function(e){const{title:n,steps:r,value:s,label:i,onValueChange:o}=e,a=K(),c=Re(),l=_.useCallback(p=>{o(p[0])},[o]),d=_.useCallback(()=>{a.mark("click slider")},[a]),u=_.useCallback(()=>{s&&o(s)},[s,o]);return h.jsx("div",{className:"tlui-slider__container",children:h.jsxs(kQ,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:s?[s]:void 0,onPointerDown:d,onValueChange:l,onPointerUp:u,title:n+" — "+c(i),children:[h.jsx(TQ,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&h.jsx(MQ,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&h.jsx(AQ,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function RQ({label:t,uiTypeA:e,uiTypeB:n,labelA:r,labelB:s,itemsA:i,itemsB:o,styleA:a,styleB:c,valueA:l,valueB:d,onValueChange:u}){const p=Re(),f=_.useMemo(()=>i.find(y=>l.type==="shared"&&l.value===y.value)?.icon??"mixed",[i,l]),m=_.useMemo(()=>o.find(y=>d.type==="shared"&&d.value===y.value)?.icon??"mixed",[o,d]);return l===void 0&&d===void 0?null:h.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[h.jsx("div",{title:p(t),className:"tlui-style-panel__double-select-picker-label",children:p(t)}),h.jsxs("div",{className:"tlui-buttons__horizontal",children:[h.jsxs(Ei,{id:`style panel ${e} A`,children:[h.jsx(ki,{children:h.jsx(we,{type:"icon","data-testid":`style.${e}`,title:p(r)+" — "+(l===null||l.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${l.value}`)),children:h.jsx(Ae,{icon:f,small:!0,invertIcon:!0})})}),h.jsx(Ti,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:h.jsx("div",{className:"tlui-buttons__grid",children:i.map((y,S)=>h.jsx(tc,{"data-testid":`style.${e}.${y.value}`,children:h.jsx(we,{type:"icon",onClick:()=>u(a,y.value),title:`${p(r)} — ${p(`${e}-style.${y.value}`)}`,children:h.jsx(Ae,{icon:y.icon,invertIcon:!0})},y.value)},S))})})]}),h.jsxs(Ei,{id:`style panel ${n}`,children:[h.jsx(ki,{children:h.jsx(we,{type:"icon","data-testid":`style.${n}`,title:p(s)+" — "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${n}-style.${d.value}`)),children:h.jsx(Ae,{icon:m,small:!0})})}),h.jsx(Ti,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:h.jsx("div",{className:"tlui-buttons__grid",children:o.map(y=>h.jsx(tc,{children:h.jsx(we,{type:"icon",title:`${p(s)} — ${p(`${n}-style.${y.value}`)}`,"data-testid":`style.${n}.${y.value}`,onClick:()=>u(c,y.value),children:h.jsx(Ae,{icon:y.icon})})},y.value))})})]})]})]})}const OQ=_.memo(RQ);function DQ({id:t,label:e,uiType:n,style:r,items:s,type:i,value:o,onValueChange:a}){const c=Re(),l=K(),d=_.useMemo(()=>s.find(f=>o.type==="shared"&&f.value===o.value)?.icon,[s,o]),u=o.type==="mixed"?c("style-panel.mixed"):c(`${n}-style.${o.value}`),p=e?c(e):"";return h.jsxs(Ei,{id:`style panel ${t}`,children:[h.jsx(ki,{children:h.jsxs(we,{type:i,"data-testid":`style.${n}`,title:u,children:[h.jsx(vt,{children:p}),h.jsx(Ae,{icon:d??"mixed"})]})}),h.jsx(Ti,{side:"left",align:"center",alignOffset:0,children:h.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>h.jsx(tc,{children:h.jsx(we,{type:"icon","data-testid":`style.${n}.${f.value}`,title:c(`${n}-style.${f.value}`),onClick:()=>{l.mark("select style dropdown item"),a(r,f.value)},children:h.jsx(Ae,{icon:f.icon})})},f.value))})})]})}const Hw=_.memo(DQ);function LQ({styles:t}){const e=Cc();if(!t)return null;const n=t.get(mr),r=t.get(Xl),s=t.get(Yl),i=t.get(ed),o=t.get(Fr),a=n===void 0,c=r===void 0&&s===void 0,l=i===void 0,d=o===void 0,u=ms({isDarkMode:e});return h.jsxs(h.Fragment,{children:[h.jsx(NQ,{theme:u,styles:t}),!d&&h.jsx(FQ,{theme:u,styles:t}),!(a&&c&&l)&&h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[h.jsx(BQ,{styles:t}),h.jsx(zQ,{styles:t}),h.jsx($Q,{styles:t})]})]})}function kc(){const t=K(),e=Gt();return qe.useMemo(()=>(function(r,s){t.run(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(r,s),t.setStyleForNextShapes(r,s),t.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:s})}),[t,e])}function NQ({styles:t,theme:e}){const n=Re(),r=K(),s=kc(),i=t.get(zn),o=t.get(Ci),a=t.get(wi),c=t.get(Br),l=o!==void 0||a!==void 0||c!==void 0;return h.jsxs(h.Fragment,{children:[h.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[i===void 0?null:h.jsx(gi,{title:n("style-panel.color"),uiType:"color",style:zn,items:nr.color,value:i,onValueChange:s,theme:e}),h.jsx(UQ,{})]}),l&&h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[o===void 0?null:h.jsx(gi,{title:n("style-panel.fill"),uiType:"fill",style:Ci,items:nr.fill,value:o,onValueChange:s,theme:e}),a===void 0?null:h.jsx(gi,{title:n("style-panel.dash"),uiType:"dash",style:wi,items:nr.dash,value:a,onValueChange:s,theme:e}),c===void 0?null:h.jsx(gi,{title:n("style-panel.size"),uiType:"size",style:Br,items:nr.size,value:c,onValueChange:(d,u)=>{s(d,u);const p=r.getSelectedShapeIds();p.length>0&&Ve(r,p)},theme:e})]})]})}function FQ({theme:t,styles:e}){const n=Re(),r=kc(),s=e.get(Fr),i=e.get(kx),o=e.get(Ql),a=e.get(Jl);return s===void 0&&o===void 0?null:h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[s===void 0?null:h.jsx(gi,{title:n("style-panel.font"),uiType:"font",style:Fr,items:nr.font,value:s,onValueChange:r,theme:t}),i===void 0?null:h.jsxs("div",{className:"tlui-style-panel__row",children:[h.jsx(gi,{title:n("style-panel.align"),uiType:"align",style:kx,items:nr.textAlign,value:i,onValueChange:r,theme:t}),h.jsx("div",{className:"tlui-style-panel__row__extra-button",children:h.jsx(we,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:h.jsx(Ae,{icon:"vertical-align-middle"})})})]}),o===void 0?null:h.jsxs("div",{className:"tlui-style-panel__row",children:[h.jsx(gi,{title:n("style-panel.align"),uiType:"align",style:Ql,items:nr.horizontalAlign,value:o,onValueChange:r,theme:t}),h.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a===void 0?h.jsx(we,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:h.jsx(Ae,{icon:"vertical-align-middle"})}):h.jsx(Hw,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Jl,items:nr.verticalAlign,value:a,onValueChange:r})})]})]})}function BQ({styles:t}){const e=kc(),n=t.get(mr);return n===void 0?null:h.jsx(Hw,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:mr,items:nr.geo,value:n,onValueChange:e})}function $Q({styles:t}){const e=kc(),n=t.get(ed);return n===void 0?null:h.jsx(Hw,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:ed,items:nr.spline,value:n,onValueChange:e})}function zQ({styles:t}){const e=kc(),n=t.get(Xl),r=t.get(Yl);return!n||!r?null:h.jsx(OQ,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Yl,itemsA:nr.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Xl,itemsB:nr.arrowheadEnd,valueB:n,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const ga=[.1,.25,.5,.75,1];function UQ(){const t=K(),e=X("opacity",()=>t.getSharedOpacity(),[t]),n=Gt(),r=Re(),s=qe.useCallback(o=>{const a=ga[o];t.run(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(a),t.setOpacityForNextShapes(a),t.updateInstanceState({isChangingStyle:!0})}),n("set-style",{source:"style-panel",id:"opacity",value:o})},[t,n]);if(e===void 0)return null;const i=e.type==="mixed"?-1:ga.indexOf(az(ga,o=>Math.abs(o-e.value)));return h.jsx(jQ,{"data-testid":"style.opacity",value:i>=0?i:ga.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:s,steps:ga.length-1,title:r("style-panel.opacity")})}const qQ=_.memo(function({isMobile:e,children:n}){const r=K(),s=YN(),i=_.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),o=n??h.jsx(LQ,{styles:s});return h.jsx("div",{className:be("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:i,children:o})});function HQ(){const t=K(),e=Re(),r=YN()?.get(zn),s=ms({isDarkMode:t.user.getIsDarkMode()}),i=(r?.type==="shared"?s[r.value]:s.black).solid,o=X("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),a=_.useCallback(l=>{l||t.updateInstanceState({isChangingStyle:!1})},[t]),{StylePanel:c}=ni();return c?h.jsxs(Pw,{id:"mobile style menu",onOpenChange:a,children:[h.jsx(Ew,{children:h.jsx(we,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":i},title:e("style-panel.title"),disabled:o,children:h.jsx(Ae,{icon:o?"blob":r?.type==="mixed"?"mixed":"blob"})})}),h.jsx(kw,{side:"top",align:"end",children:c&&h.jsx(c,{isMobile:!0})})]}):null}function GQ(){return h.jsxs(h.Fragment,{children:[h.jsx(VQ,{}),h.jsx(WQ,{}),h.jsx(YQ,{}),h.jsx(XQ,{}),h.jsx(ZQ,{}),h.jsx(QQ,{}),h.jsx(JQ,{}),h.jsx(eJ,{}),h.jsx(tJ,{}),h.jsx(nJ,{}),h.jsx(sJ,{}),h.jsx(rJ,{}),h.jsx(aJ,{}),h.jsx(dJ,{}),h.jsx(iJ,{}),h.jsx(lJ,{}),h.jsx(cJ,{}),h.jsx(oJ,{}),h.jsx(uJ,{}),h.jsx(hJ,{}),h.jsx(pJ,{}),h.jsx(fJ,{}),h.jsx(gJ,{}),h.jsx(mJ,{}),h.jsx(yJ,{}),h.jsx(SJ,{}),h.jsx(xJ,{}),h.jsx(vJ,{})]})}function KQ(t){const e=K(),n=t.meta?.geo;return X("is tool selected",()=>{const r=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(mr);return n?r==="geo"&&s===n:r===t.id},[e,t.id,n])}function Ke({tool:t}){const e=Jd(),n=KQ(e[t]);return h.jsx(W,{...e[t],isSelected:n})}function VQ(){return h.jsx(Ke,{tool:"select"})}function WQ(){return h.jsx(Ke,{tool:"hand"})}function YQ(){return h.jsx(Ke,{tool:"draw"})}function XQ(){return h.jsx(Ke,{tool:"eraser"})}function ZQ(){return h.jsx(Ke,{tool:"arrow"})}function QQ(){return h.jsx(Ke,{tool:"text"})}function JQ(){return h.jsx(Ke,{tool:"note"})}function eJ(){const t=Jd();return h.jsx(W,{...t.asset})}function tJ(){return h.jsx(Ke,{tool:"rectangle"})}function nJ(){return h.jsx(Ke,{tool:"ellipse"})}function rJ(){return h.jsx(Ke,{tool:"diamond"})}function sJ(){return h.jsx(Ke,{tool:"triangle"})}function iJ(){return h.jsx(Ke,{tool:"rhombus"})}function oJ(){return h.jsx(Ke,{tool:"heart"})}function aJ(){return h.jsx(Ke,{tool:"hexagon"})}function cJ(){return h.jsx(Ke,{tool:"cloud"})}function lJ(){return h.jsx(Ke,{tool:"star"})}function dJ(){return h.jsx(Ke,{tool:"oval"})}function uJ(){return h.jsx(Ke,{tool:"x-box"})}function hJ(){return h.jsx(Ke,{tool:"check-box"})}function pJ(){return h.jsx(Ke,{tool:"arrow-left"})}function fJ(){return h.jsx(Ke,{tool:"arrow-up"})}function gJ(){return h.jsx(Ke,{tool:"arrow-down"})}function mJ(){return h.jsx(Ke,{tool:"arrow-right"})}function yJ(){return h.jsx(Ke,{tool:"line"})}function SJ(){return h.jsx(Ke,{tool:"highlight"})}function vJ(){return h.jsx(Ke,{tool:"frame"})}function xJ(){return h.jsx(Ke,{tool:"laser"})}const Hf=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Gf(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function ma(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function d3(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function u3(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function bJ(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let s=!0;for(let i=0;i<n.length;i++)r.indexOf(n[i])===-1&&(s=!1);return s}const nc={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Hf?173:189,"=":Hf?61:187,";":Hf?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},vr={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},Ea={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ft={16:!1,18:!1,17:!1,91:!1},ut={};for(let t=1;t<20;t++)nc["f".concat(t)]=111+t;let rt=[],Ba=null,h3="all";const ts=new Map,$o=t=>nc[t.toLowerCase()]||vr[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),wJ=t=>Object.keys(nc).find(e=>nc[e]===t),CJ=t=>Object.keys(vr).find(e=>vr[e]===t);function p3(t){h3=t||"all"}function rc(){return h3||"all"}function _J(){return rt.slice(0)}function IJ(){return rt.map(t=>wJ(t)||CJ(t)||String.fromCharCode(t))}function PJ(){const t=[];return Object.keys(ut).forEach(e=>{ut[e].forEach(n=>{let{key:r,scope:s,mods:i,shortcut:o}=n;t.push({scope:s,shortcut:o,mods:i,keys:r.split("+").map(a=>$o(a))})})}),t}function EJ(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const s=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(s||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function kJ(t){return typeof t=="string"&&(t=$o(t)),rt.indexOf(t)!==-1}function TJ(t,e){let n,r;t||(t=rc());for(const s in ut)if(Object.prototype.hasOwnProperty.call(ut,s))for(n=ut[s],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(o=>{let{element:a}=o;return Gw(a)}):r++;rc()===t&&p3(e||"all")}function MJ(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=$o(t.key));const n=rt.indexOf(e);if(n>=0&&rt.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&rt.splice(0,rt.length),(e===93||e===224)&&(e=91),e in Ft){Ft[e]=!1;for(const r in vr)vr[r]===e&&(In[r]=!1)}}function f3(t){if(typeof t>"u")Object.keys(ut).forEach(s=>{Array.isArray(ut[s])&&ut[s].forEach(i=>_l(i)),delete ut[s]}),Gw(null);else if(Array.isArray(t))t.forEach(s=>{s.key&&_l(s)});else if(typeof t=="object")t.key&&_l(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[s,i]=n;typeof s=="function"&&(i=s,s=""),_l({key:t,scope:s,method:i,splitKey:"+"})}}const _l=t=>{let{key:e,scope:n,method:r,splitKey:s="+"}=t;u3(e).forEach(o=>{const a=o.split(s),c=a.length,l=a[c-1],d=l==="*"?"*":$o(l);if(!ut[d])return;n||(n=rc());const u=c>1?d3(vr,a):[],p=[];ut[d]=ut[d].filter(f=>{const y=(r?f.method===r:!0)&&f.scope===n&&bJ(f.mods,u);return y&&p.push(f.element),!y}),p.forEach(f=>Gw(f))})};function iP(t,e,n,r){if(e.element!==r)return;let s;if(e.scope===n||e.scope==="all"){s=e.mods.length>0;for(const i in Ft)Object.prototype.hasOwnProperty.call(Ft,i)&&(!Ft[i]&&e.mods.indexOf(+i)>-1||Ft[i]&&e.mods.indexOf(+i)===-1)&&(s=!1);(e.mods.length===0&&!Ft[16]&&!Ft[18]&&!Ft[17]&&!Ft[91]||s||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(rt),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function oP(t,e){const n=ut["*"];let r=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!In.filter.call(this,t))return;if((r===93||r===224)&&(r=91),rt.indexOf(r)===-1&&r!==229&&rt.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=Ea[a];t[a]&&rt.indexOf(c)===-1?rt.push(c):!t[a]&&rt.indexOf(c)>-1?rt.splice(rt.indexOf(c),1):a==="metaKey"&&t[a]&&(rt=rt.filter(l=>l in Ea||l===r))}),r in Ft){Ft[r]=!0;for(const a in vr)if(Object.prototype.hasOwnProperty.call(vr,a)){const c=Ea[vr[a]];In[a]=t[c]}if(!n)return}for(const a in Ft)Object.prototype.hasOwnProperty.call(Ft,a)&&(Ft[a]=t[Ea[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(rt.indexOf(17)===-1&&rt.push(17),rt.indexOf(18)===-1&&rt.push(18),Ft[17]=!0,Ft[18]=!0);const s=rc();if(n)for(let a=0;a<n.length;a++)n[a].scope===s&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&iP(t,n[a],s,e);if(!(r in ut))return;const i=ut[r],o=i.length;for(let a=0;a<o;a++)if((t.type==="keydown"&&i[a].keydown||t.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,d=c.key.split(l),u=[];for(let p=0;p<d.length;p++)u.push($o(d[p]));u.sort().join("")===rt.sort().join("")&&iP(t,c,s,e)}}function In(t,e,n){rt=[];const r=u3(t);let s=[],i="all",o=document,a=0,c=!1,l=!0,d="+",u=!1,p=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(o=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(u=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(i=e),p&&f3(t,i);a<r.length;a++)t=r[a].split(d),s=[],t.length>1&&(s=d3(vr,t)),t=t[t.length-1],t=t==="*"?"*":$o(t),t in ut||(ut[t]=[]),ut[t].push({keyup:c,keydown:l,scope:i,mods:s,shortcut:r[a],method:n,key:r[a],splitKey:d,element:o});if(typeof o<"u"&&window){if(!ts.has(o)){const f=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return oP(y,o)},m=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;oP(y,o),MJ(y)};ts.set(o,{keydownListener:f,keyupListenr:m,capture:u}),Gf(o,"keydown",f,u),Gf(o,"keyup",m,u)}if(!Ba){const f=()=>{rt=[]};Ba={listener:f,capture:u},Gf(window,"focus",f,u)}}}function AJ(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(ut).forEach(n=>{ut[n].filter(s=>s.scope===e&&s.shortcut===t).forEach(s=>{s&&s.method&&s.method()})})}function Gw(t){const e=Object.values(ut).flat();if(e.findIndex(r=>{let{element:s}=r;return s===t})<0){const{keydownListener:r,keyupListenr:s,capture:i}=ts.get(t)||{};r&&s&&(ma(t,"keyup",s,i),ma(t,"keydown",r,i),ts.delete(t))}if((e.length<=0||ts.size<=0)&&(Object.keys(ts).forEach(s=>{const{keydownListener:i,keyupListenr:o,capture:a}=ts.get(s)||{};i&&o&&(ma(s,"keyup",o,a),ma(s,"keydown",i,a),ts.delete(s))}),ts.clear(),Object.keys(ut).forEach(s=>delete ut[s]),Ba)){const{listener:s,capture:i}=Ba;ma(window,"focus",s,i),Ba=null}}const Kf={getPressedKeyString:IJ,setScope:p3,getScope:rc,deleteScope:TJ,getPressedKeyCodes:_J,getAllKeyCodes:PJ,isPressed:kJ,filter:EJ,trigger:AJ,unbind:f3,keyMap:nc,modifier:vr,modifierMap:Ea};for(const t in Kf)Object.prototype.hasOwnProperty.call(Kf,t)&&(In[t]=Kf[t]);if(typeof window<"u"){const t=window.hotkeys;In.noConflict=e=>(e&&window.hotkeys===In&&(window.hotkeys=t),In),window.hotkeys=In}const aP=["copy","cut","paste","asset"];function jJ(){const t=K(),e=ys(),n=ye(),r=Jd(),s=X("is focused",()=>t.getInstanceState().isFocused,[t]);_.useEffect(()=>{if(!s)return;const i=new Array,o=(c,l)=>{In(c,{element:document.body},l),i.push(()=>{In.unbind(c,l)})},a=(c,l)=>{In(c,{element:document.body,keyup:!0,keydown:!1},l),i.push(()=>{In.unbind(c,l)})};for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||aP.includes(c.id)||o(cP(c.kbd),l=>{ka(t)||(Le(l),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&t.getInstanceState().isReadonly||aP.includes(c.id)||o(cP(c.kbd),l=>{ka(t)||(Le(l),c.onSelect("kbd"))});return o(",",c=>{if(ka(t)||t.inputs.keys.has("Comma"))return;Le(c),t.focus(),t.inputs.keys.add("Comma");const{x:l,y:d,z:u}=t.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_down",point:{x:l,y:d,z:u},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(p)}),a(",",c=>{if(ka(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:l,y:d,z:u}=t.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:l,y:d,z:u},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(p)}),()=>{i.forEach(c=>c())}},[n,r,e,t,s])}function cP(t){return RJ(t).map(e=>{let n="";const r=e.split("");return r.length===1?n=r[0]:r[0]==="!"?n=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?n=`alt+shift+${r[2]}`:n=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?n=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?n=`cmd+⌥+${r[2]},ctrl+alt+${r[2]}`:n=`cmd+${r[1]},ctrl+${r[1]}`:n=e,n}).join(",")}function RJ(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function ka(t){return t.getIsMenuOpen()||t.getEditingShapeId()!==null||t.getCrashingError()}const OJ=_.createContext(!1);function DJ({children:t}){const e=K(),n=eO(),r=hn(),s=Re(),i=Math.min(8,5+r),[o,a]=_.useState(0),c=_.useRef(null),[l,d]=_.useState(null),u=_.useMemo(()=>{const f=l?`:not([data-value="${l}"])`:"";return`
			#${n}_main > *:nth-child(n + ${i+(l?1:2)})${f} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${i}) {
				display: none;
			}
        `},[l,n,i]),p=AO(()=>{if(!c.current)return;const f=Array.from(c.current.children);a(f.length),f.findIndex(S=>S.getAttribute("data-value")===l)<=i&&d(null);const y=Array.from(c.current.children).findIndex(S=>S.getAttribute("aria-checked")==="true");y!==-1&&y>=i&&d(f[y].getAttribute("data-value"))});return _.useLayoutEffect(()=>{p()}),_.useLayoutEffect(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),_.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[m,y]of f)In(m,S=>{if(ka(e))return;Le(S);const v=Array.from(c.current?.children??[]).filter(x=>!(x instanceof HTMLElement)||x.tagName.toLowerCase()!=="button"?!1:!!(x.offsetWidth||x.offsetHeight))[y];v&&v.click()});return()=>{In.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),h.jsxs(h.Fragment,{children:[h.jsx("style",{children:u}),h.jsxs("div",{className:be("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<gt.TABLET_SM}),role:"radiogroup",children:[h.jsx("div",{id:`${n}_main`,ref:c,className:"tlui-toolbar__tools__list",children:h.jsx(sr,{type:"toolbar",sourceId:"toolbar",children:t})}),o>i+1&&h.jsx(OJ.Provider,{value:!0,children:h.jsxs(Ei,{id:"toolbar overflow",modal:!1,children:[h.jsx(ki,{children:h.jsx(we,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:h.jsx(Ae,{icon:"chevron-up"})})}),h.jsx(Ti,{side:"top",align:"center",children:h.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${n}_more`,children:h.jsx(sr,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})]})}function LJ({activeToolId:t}){const e=K(),n=hn(),r=Re(),s=X("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),i=X("current tool",()=>e.getCurrentTool(),[e]);return!t||!i.isLockable?null:h.jsx(we,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:be("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<gt.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!s}),children:h.jsx(Ae,{icon:s?"lock":"unlock",small:!0})})}const NJ=_.memo(function({children:e}){const n=K(),r=hn(),s=ys(),i=X("current tool id",()=>n.getCurrentToolId(),[n]),{ActionsMenu:o,QuickActions:a}=ni();return h.jsx("div",{className:"tlui-toolbar",children:h.jsxs("div",{className:"tlui-toolbar__inner",children:[h.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&h.jsxs("div",{className:"tlui-toolbar__extras",children:[r<gt.TABLET&&h.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[a&&h.jsx(a,{}),o&&h.jsx(o,{})]}),h.jsx(LJ,{activeToolId:i})]}),h.jsx(DJ,{children:e??h.jsx(GQ,{})})]}),r<gt.TABLET_SM&&!s&&h.jsx("div",{className:"tlui-toolbar__tools",children:h.jsx(HQ,{})})]})})});function FJ(){const t=Re();return h.jsxs("div",{className:be("tlui-offline-indicator"),children:[t("status.offline"),h.jsx(zr,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function BJ({maxWidth:t=420,ignoreRightWidth:e=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:s=52,children:i}){const o=_.useRef(null),a=hn(),c=_.useCallback(()=>{const l=o.current;if(!l)return;const d=l.parentElement.parentElement,u=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=d.offsetWidth,m=u.offsetWidth,y=p.offsetWidth,S=l.offsetWidth-e;let g=(f-S)/2;f%2!==0&&(g-=.5);const v=m+r,x=l.offsetLeft,b=Math.min(f-y-m-2*r,t),E=Math.max(g,v)-x;p.offsetWidth>n&&a<=6?l.style.setProperty("max-width",b-s+"px"):l.style.setProperty("max-width",b+"px"),l.style.setProperty("transform",`translate(${E}px, 0px)`)},[a,e,r,t,s,n]);return _.useLayoutEffect(()=>{const l=o.current;if(!l)return;const d=l.parentElement.parentElement,u=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(c);return f.observe(u),f.observe(p),f.observe(d),f.observe(l),c(),()=>{f.disconnect()}},[c]),_.useLayoutEffect(()=>{c()}),h.jsx("div",{ref:o,className:"tlui-top-panel__container",children:i})}function $J(){const t=nW()==="offline";return h.jsx(BJ,{children:t&&h.jsx(FJ,{})})}function zJ(){const t=ye();return h.jsxs(h.Fragment,{children:[h.jsx(W,{...t["zoom-in"],noClose:!0}),h.jsx(W,{...t["zoom-out"],noClose:!0}),h.jsx(LN,{}),h.jsx(NN,{}),h.jsx(FN,{})]})}const UJ=_.memo(function({children:e}){const n=Dt(),[r,s]=Ss("zoom menu"),i=e??h.jsx(zJ,{});return h.jsxs(Bw,{dir:"ltr",open:r,onOpenChange:s,modal:!1,children:[h.jsx($w,{asChild:!0,dir:"ltr",children:h.jsx(qJ,{})}),h.jsx(ou,{container:n,children:h.jsx(zw,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:h.jsx(sr,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),qJ=_.forwardRef(function(e,n){const r=K(),s=hn(),i=X("zoom",()=>r.getZoomLevel(),[r]),o=Re(),a=_.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return h.jsx(we,{ref:n,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:s<gt.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:s<gt.MOBILE?"zoom-in":void 0,children:s<gt.MOBILE?null:h.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(i*100),"%"]})})}),g3=_.createContext(null);function HJ({overrides:t={},children:e}){const n=Nd(t),r=eu();return h.jsx(g3.Provider,{value:_.useMemo(()=>({ContextMenu:oZ,ActionsMenu:RX,HelpMenu:null,ZoomMenu:UJ,MainMenu:qZ,Minimap:WZ,StylePanel:qQ,PageMenu:QZ,NavigationPanel:XZ,Toolbar:NJ,KeyboardShortcutsDialog:TZ,QuickActions:eQ,HelperButtons:EZ,DebugPanel:SZ,DebugMenu:yZ,MenuPanel:wZ,SharePanel:r?aQ:null,CursorChatBubble:r?lZ:null,TopPanel:r?$J:null,...n}),[n,r]),children:e})}function ni(){const t=_.useContext(g3);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}function GJ({overrides:t,components:e,assetUrls:n,onUiEvent:r,forceMobile:s,children:i}){return h.jsx(HG,{assetUrls:uV(n),children:h.jsx(VG,{overrides:mV(t),children:h.jsx(ZK,{onEvent:r,children:h.jsx(sV,{children:h.jsx(QK,{children:h.jsx(pV,{forceMobile:s,children:h.jsx(HJ,{overrides:e,children:h.jsx(KJ,{overrides:t,children:i})})})})})})})})}function KJ({overrides:t,children:e}){const n=yV(t);return h.jsx(iW,{overrides:n.actions,children:h.jsx(hV,{overrides:n.tools,children:e})})}function VJ(){const t=K(),{addToast:e}=_r();_.useEffect(()=>{function n({name:r,count:s}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${s}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}const WJ=qe.memo(function({renderDebugMenuItems:e,children:n,hideUi:r,components:s,...i}){return h.jsx(GJ,{...i,components:s,children:h.jsx(YJ,{hideUi:r,renderDebugMenuItems:e,children:n})})}),YJ=qe.memo(function({children:e,hideUi:n,...r}){return h.jsxs(h.Fragment,{children:[e,n?null:h.jsx(XJ,{...r})]})}),XJ=qe.memo(function(){const e=K(),n=Re(),r=hn(),s=ys(),i=X("focus",()=>e.getInstanceState().isFocusMode,[e]),o=X("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:c,MenuPanel:l,StylePanel:d,Toolbar:u,HelpMenu:p,NavigationPanel:f,HelperButtons:m,DebugPanel:y,CursorChatBubble:S}=ni();jJ(),KV(),VJ();const{"toggle-focus-mode":g}=ye();return h.jsxs("div",{className:be("tlui-layout",{"tlui-layout__mobile":r<gt.TABLET_SM}),"data-breakpoint":r,children:[i?h.jsx("div",{className:"tlui-layout__top",children:h.jsx(we,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>g.onSelect("menu"),children:h.jsx(Ae,{icon:"dot"})})}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"tlui-layout__top",children:[h.jsxs("div",{className:"tlui-layout__top__left",children:[l&&h.jsx(l,{}),m&&h.jsx(m,{})]}),h.jsx("div",{className:"tlui-layout__top__center",children:c&&h.jsx(c,{})}),h.jsxs("div",{className:"tlui-layout__top__right",children:[a&&h.jsx(a,{}),d&&r>=gt.TABLET_SM&&!s&&h.jsx(d,{})]})]}),h.jsxs("div",{className:"tlui-layout__bottom",children:[h.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&h.jsx(f,{}),u&&h.jsx(u,{}),p&&h.jsx(p,{})]}),o&&y&&h.jsx(y,{})]})]}),h.jsx(cV,{}),h.jsx(tV,{}),h.jsx(lV,{}),h.jsx(nV,{}),S&&h.jsx(S,{})]})});async function ZJ(t,e){const{url:n,style:r="normal",weight:s="500",display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l,format:d}=e,u={style:r,weight:s,display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l},p=new FontFace(t,`url(${n})`,u);return await p.load(),document.fonts.add(p),p.$$_url=n,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${n}") format("${d}")
}`,p}const Il=(t,e)=>{const[n,r]=_.useState(2);return _.useEffect(()=>{let s=!1;return r(2),ZJ(t,e).then(()=>{s||r(0)}).catch(i=>{s||(console.error(i),r(1))}),()=>{s=!0}},[t,e]),n};function QJ(t){return{draw:{url:t.fonts.draw,format:t.fonts.draw.split(".").pop()},serif:{url:t.fonts.serif,format:t.fonts.serif.split(".").pop()},sansSerif:{url:t.fonts.sansSerif,format:t.fonts.sansSerif.split(".").pop()},monospace:{url:t.fonts.monospace,format:t.fonts.monospace.split(".").pop()}}}function m3(t){const e=_.useMemo(()=>QJ(t),[t]),n=[Il("tldraw_draw",e.draw),Il("tldraw_serif",e.serif),Il("tldraw_sans",e.sansSerif),Il("tldraw_mono",e.monospace)];return{error:n.some(r=>r===1),done:!n.some(r=>r===2)}}function JJ(t){const{children:e,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i,onMount:o,components:a={},shapeUtils:c=[],bindingUtils:l=[],tools:d=[],...u}=t,p=Nd(a),f=_.useMemo(()=>({Scribble:uI,ShapeIndicators:l7,CollaboratorScribble:uI,SelectionForeground:o7,SelectionBackground:s7,Handles:J9,...p}),[p]),m=Da(c),y=_.useMemo(()=>[...kD,...m],[m]),S=Da(l),g=_.useMemo(()=>[...VO,...S],[S]),v=Da(d),x=_.useMemo(()=>[...XK,...SH,...v],[v]),b=FD(u.assetUrls),{done:E,error:I}=m3(b);return I?h.jsx(qO,{children:"Could not load assets. Please refresh the page."}):E?h.jsx(N9,{initialState:"select",...u,components:f,shapeUtils:y,bindingUtils:g,tools:x,children:h.jsxs(WJ,{...u,components:f,children:[h.jsx(eee,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i,onMount:o}),e]})}):h.jsx(ow,{children:h.jsx(Yb,{})})}function eee({maxImageDimension:t=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:n=Mb,acceptedVideoMimeTypes:r=Pj,onMount:s}){const i=K(),o=_r(),a=Re();HO(()=>{const d=[];return d.push(oK(i)),K7(i,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r},{toasts:o,msg:a}),d.push(i.store.props.onMount(i)),d.push(s?.(i)),()=>{d.forEach(u=>u?.())}});const{Canvas:c}=st(),{ContextMenu:l}=ni();return l?h.jsx(l,{}):c?h.jsx(c,{}):null}_.memo(function(e){const[n,r]=_.useState(null),[s,i]=_.useState(null),o=Da(e.shapeUtils??[]),a=_.useMemo(()=>[...kD,...o],[o]),c=Da(e.bindingUtils??[]),l=_.useMemo(()=>[...VO,...c],[c]),d=G9({snapshot:e.snapshot,shapeUtils:a}),u=FD(),{done:p,error:f}=m3(u),{pageId:m,bounds:y,scale:S,background:g,padding:v,darkMode:x,preserveAspectRatio:b,format:E="svg",licenseKey:I}=e;return _.useLayoutEffect(()=>{if(!s||!d||!p)return;let C=!1;const P=document.createElement("div");s.appendChild(P),s.classList.add("tl-container","tl-theme__light");const k=new he({store:d,shapeUtils:a,bindingUtils:l,tools:[],getContainer:()=>P,licenseKey:I});m&&k.setCurrentPage(m);const T=k.getCurrentPageShapeIds();async function M(){const A=await k.getSvgString([...T],{bounds:y,scale:S,background:g,padding:v,darkMode:x,preserveAspectRatio:b});if(A&&!C){if(E==="svg"){if(!C){const j=new Blob([A.svg],{type:"image/svg+xml"}),R=URL.createObjectURL(j);r(R)}}else if(E==="png"){const j=await VD(k,A.svg,{type:E,quality:1,scale:2,width:A.width,height:A.height});if(j&&!C){const R=URL.createObjectURL(j);r(R)}}}k.dispose()}return M(),()=>{C=!0}},[E,s,d,a,l,m,y,S,g,v,x,b,p,f,I]),f?h.jsx(qO,{children:"Could not load assets."}):p?h.jsx("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:n&&h.jsx("img",{src:n,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):h.jsx(ow,{children:h.jsx(Yb,{})})});_.memo(function({children:e}){const n=Re(),r=hn(),s=e??h.jsx(jZ,{});return r<gt.MOBILE?null:h.jsx("div",{className:"tlui-help-menu",children:h.jsxs(Ei,{id:"help menu",children:[h.jsx(ki,{children:h.jsx(we,{type:"help",title:n("help-menu.title"),"data-testid":"help-menu.button",children:h.jsx(Ae,{icon:"question-mark",small:!0})})}),h.jsx(Ti,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:h.jsx(sr,{type:"menu",sourceId:"help-menu",children:s})})]})})});const tee=je({schemaVersion:nn(1),storeVersion:jl,recordVersions:Vl(Ee,je({version:jl,subTypeVersions:Vl(Ee,jl).optional(),subTypeKey:Ee.optional()}))}),nee=je({schemaVersion:nn(2),sequences:Vl(Ee,jl)});je({tldrawFileFormatVersion:Xz,schema:Zz("schemaVersion",{1:tee,2:nee}),records:$t(je({id:Ee,typeName:Ee}).allowUnknownProperties())});function ree({className:t,initialSnapshot:e,initialTitle:n="Untitled",onImportMermaid:r}){const s=_.useMemo(()=>Ya(),[]),i=_.useRef(null),o=_.useRef(!1),[a,c]=_.useState(n),[l,d]=_.useState(!1),[u,p]=_.useState(!1),[f,m]=_.useState(!1),[y,S]=_.useState(!1),[g,v]=_.useState(""),x=_.useRef(!1),{toast:b}=bA(),E=_.useCallback(()=>{const A=i.current;if(!A){p(!1),m(!1);return}const j=A?.getCanUndo,R=A?.getCanRedo,L=A?.history?.getNumUndos,F=A?.history?.getNumRedos,H=typeof j=="function"?!!j.call(A):typeof L=="function"?L.call(A.history)>0:!1,B=typeof R=="function"?!!R.call(A):typeof F=="function"?F.call(A.history)>0:!1;p(H),m(B)},[]);_.useEffect(()=>{if(e){x.current=!0;try{Qb(s,e);const A=i.current;typeof A?.clearHistory=="function"?A.clearHistory():o.current=!0,d(!1),E()}catch(A){console.error("Failed to load tldraw snapshot:",A)}finally{x.current=!1}}},[e,s,E]),_.useEffect(()=>s.listen(()=>{x.current||(d(!0),E())},{source:"user",scope:"document"}),[s,E]);const I=_.useCallback(async()=>{const A=bO(s),L=`Concept Maps/${((a||"Untitled").trim()||"Untitled").replace(/[/\\?%*:|"<>]/g,"-")}.tldraw.json`;try{await kA.obsidian.saveFile(L,JSON.stringify(A,null,2)),d(!1),b({title:"Freehand map saved",description:L})}catch(F){b({title:"Save failed",description:String(F),variant:"destructive"})}},[s,a,b]),C=_.useCallback(A=>{if(i.current=A,A.user.updateUserPreferences({colorScheme:"dark"}),o.current){o.current=!1;const j=i.current?.clearHistory;typeof j=="function"&&j.call(i.current)}E()},[E]),P=_.useCallback(()=>{const A=i.current,j=A?.undo;typeof j=="function"&&j.call(A),E()},[E]),k=_.useCallback(()=>{const A=i.current,j=A?.redo;typeof j=="function"&&j.call(A),E()},[E]),T=_.useCallback(async()=>{const A=i.current;if(!A){b({title:"Export failed",description:"Editor not ready",variant:"destructive"});return}const j=Array.from(A.getCurrentPageShapeIds());if(j.length===0){b({title:"Nothing to export",description:"Add shapes to the canvas first",variant:"destructive"});return}try{const R=await xw({editor:A,ids:j,format:"png",opts:{scale:1,background:!0}}),L=URL.createObjectURL(R),F=document.createElement("a");F.href=L,F.download=`${(a||"concept-map").replace(/[/\\?%*:|"<>]/g,"-")}.png`,F.click(),URL.revokeObjectURL(L),b({title:"PNG exported"})}catch(R){b({title:"Export failed",description:String(R),variant:"destructive"})}},[a,b]),M=_.useCallback(()=>{const A=g.trim();A&&r&&(r(A),S(!1),v(""))},[g,r]);return h.jsxs("div",{className:is("flex flex-col h-full",t),children:[h.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-primary/20 bg-black/40 shrink-0 flex-wrap",children:[h.jsx(sB,{value:a,onChange:A=>c(A.target.value),placeholder:"Map title...",className:"h-7 min-w-[120px] text-xs font-terminal bg-black/40 border-primary/20 rounded-none flex-1 max-w-[180px]"}),h.jsx("div",{className:"w-px h-4 bg-primary/20"}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:P,disabled:!u,title:"Undo",children:h.jsx(DB,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none",onClick:k,disabled:!f,title:"Redo",children:h.jsx(RB,{className:"w-3 h-3"})}),h.jsx("div",{className:"w-px h-4 bg-primary/20"}),h.jsxs(bt,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-[10px]",onClick:T,title:"Export PNG",children:[h.jsx(jA,{className:"w-3 h-3 mr-1"}),"PNG"]}),h.jsxs(bt,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-[10px]",onClick:I,title:"Save to vault",children:[h.jsx(TA,{className:"w-3 h-3 mr-1"}),"Save"]}),r&&h.jsxs(bt,{size:"sm",variant:"ghost",className:"h-7 px-1.5 rounded-none font-terminal text-[10px]",onClick:()=>S(!0),title:"Import Mermaid",children:[h.jsx(PB,{className:"w-3 h-3 mr-1"}),"Import"]}),h.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-terminal text-muted-foreground ml-auto",children:[h.jsx("span",{className:is("w-1.5 h-1.5 rounded-full shrink-0",l?"bg-destructive":"bg-success")}),l?"Unsaved":"Saved"]})]}),y&&h.jsxs("div",{className:"shrink-0 px-3 py-2 border-b border-primary/20 bg-black/40 flex flex-col gap-2",children:[h.jsx("p",{className:"font-arcade text-[10px] text-primary",children:"PASTE MERMAID → SWITCH TO STRUCTURED"}),h.jsx("textarea",{value:g,onChange:A=>v(A.target.value),placeholder:`graph TD
  A[Topic] --> B[Subtopic]`,className:"min-h-[60px] w-full px-2 py-1.5 font-mono text-xs bg-black/60 border border-primary/30 rounded-none text-foreground placeholder:text-muted-foreground resize-y",rows:3}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(bt,{size:"sm",className:"rounded-none font-terminal text-xs",onClick:M,disabled:!g.trim(),children:"Import & switch"}),h.jsx(bt,{size:"sm",variant:"outline",className:"rounded-none font-terminal text-xs border-primary/30",onClick:()=>{S(!1),v("")},children:"Cancel"})]})]}),h.jsx("div",{className:"flex-1 min-h-0 bg-black/80 border border-primary/20",children:h.jsx(JJ,{store:s,onMount:C,inferDarkMode:!1})})]})}function wt(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=wt(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}function see(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(i){for(s=0;s<n;++s)r[s]=t[s]*(1-i)+e[s]*i;return r}}function iee(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function oee(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),i=new Array(n),o;for(o=0;o<r;++o)s[o]=$a(t[o],e[o]);for(;o<n;++o)i[o]=e[o];return function(a){for(o=0;o<r;++o)i[o]=s[o](a);return i}}function aee(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function cee(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=$a(t[s],e[s]):r[s]=e[s];return function(i){for(s in n)r[s]=n[s](i);return r}}function $a(t,e){var n=typeof e,r;return e==null||n==="boolean"?pB(e):(n==="number"?T0:n==="string"?(r=A0(e))?(e=r,M0):fB:e instanceof A0?M0:e instanceof Date?aee:iee(e)?see:Array.isArray(e)?oee:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?cee:T0)(t,e)}const Ur={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},sc=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],y3=["Enter"," ","Escape"],S3={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var _o;(function(t){t.Strict="strict",t.Loose="loose"})(_o||(_o={}));var vi;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(vi||(vi={}));var ic;(function(t){t.Partial="partial",t.Full="full"})(ic||(ic={}));const v3={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var js;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(js||(js={}));var Io;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Io||(Io={}));var ve;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(ve||(ve={}));const lP={[ve.Left]:ve.Right,[ve.Right]:ve.Left,[ve.Top]:ve.Bottom,[ve.Bottom]:ve.Top};function x3(t){return t===null?null:t?"valid":"invalid"}const b3=t=>"id"in t&&"source"in t&&"target"in t,lee=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),Kw=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),Tc=(t,e=[0,0])=>{const{width:n,height:r}=bs(t),s=t.origin??e,i=n*s[0],o=r*s[1];return{x:t.position.x-i,y:t.position.y-o}},dee=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,s)=>{const i=typeof s=="string";let o=!e.nodeLookup&&!i?s:void 0;e.nodeLookup&&(o=i?e.nodeLookup.get(s):Kw(s)?s:e.nodeLookup.get(s.id));const a=o?md(o,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return cu(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return lu(n)},Mc=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(s=>{(e.filter===void 0||e.filter(s))&&(n=cu(n,md(s)),r=!0)}),r?lu(n):{x:0,y:0,width:0,height:0}},Vw=(t,e,[n,r,s]=[0,0,1],i=!1,o=!1)=>{const a={...jc(e,[n,r,s]),width:e.width/s,height:e.height/s},c=[];for(const l of t.values()){const{measured:d,selectable:u=!0,hidden:p=!1}=l;if(o&&!u||p)continue;const f=d.width??l.width??l.initialWidth??null,m=d.height??l.height??l.initialHeight??null,y=oc(a,Eo(l)),S=(f??0)*(m??0),g=i&&y>0;(!l.internals.handleBounds||g||y>=S||l.dragging)&&c.push(l)}return c},uee=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function hee(t,e){const n=new Map,r=e?.nodes?new Set(e.nodes.map(s=>s.id)):null;return t.forEach(s=>{s.measured.width&&s.measured.height&&(e?.includeHiddenNodes||!s.hidden)&&(!r||r.has(s.id))&&n.set(s.id,s)}),n}async function pee({nodes:t,width:e,height:n,panZoom:r,minZoom:s,maxZoom:i},o){if(t.size===0)return Promise.resolve(!0);const a=hee(t,o),c=Mc(a),l=Ww(c,e,n,o?.minZoom??s,o?.maxZoom??i,o?.padding??.1);return await r.setViewport(l,{duration:o?.duration,ease:o?.ease,interpolate:o?.interpolate}),Promise.resolve(!0)}function w3({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:s,onError:i}){const o=n.get(t),a=o.parentId?n.get(o.parentId):void 0,{x:c,y:l}=a?a.internals.positionAbsolute:{x:0,y:0},d=o.origin??r;let u=o.extent||s;if(o.extent==="parent"&&!o.expandParent)if(!a)i?.("005",Ur.error005());else{const f=a.measured.width,m=a.measured.height;f&&m&&(u=[[c,l],[c+f,l+m]])}else a&&ko(o.extent)&&(u=[[o.extent[0][0]+c,o.extent[0][1]+l],[o.extent[1][0]+c,o.extent[1][1]+l]]);const p=ko(u)?Mi(e,u,o.measured):e;return(o.measured.width===void 0||o.measured.height===void 0)&&i?.("015",Ur.error015()),{position:{x:p.x-c+(o.measured.width??0)*d[0],y:p.y-l+(o.measured.height??0)*d[1]},positionAbsolute:p}}async function fee({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:s}){const i=new Set(t.map(p=>p.id)),o=[];for(const p of n){if(p.deletable===!1)continue;const f=i.has(p.id),m=!f&&p.parentId&&o.find(y=>y.id===p.parentId);(f||m)&&o.push(p)}const a=new Set(e.map(p=>p.id)),c=r.filter(p=>p.deletable!==!1),d=uee(o,c);for(const p of c)a.has(p.id)&&!d.find(m=>m.id===p.id)&&d.push(p);if(!s)return{edges:d,nodes:o};const u=await s({nodes:o,edges:d});return typeof u=="boolean"?u?{edges:d,nodes:o}:{edges:[],nodes:[]}:u}const Po=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),Mi=(t={x:0,y:0},e,n)=>({x:Po(t.x,e[0][0],e[1][0]-(n?.width??0)),y:Po(t.y,e[0][1],e[1][1]-(n?.height??0))});function C3(t,e,n){const{width:r,height:s}=bs(n),{x:i,y:o}=n.internals.positionAbsolute;return Mi(t,[[i,o],[i+r,o+s]],e)}const dP=(t,e,n)=>t<e?Po(Math.abs(t-e),1,e)/e:t>n?-Po(Math.abs(t-n),1,e)/e:0,_3=(t,e,n=15,r=40)=>{const s=dP(t.x,r,e.width-r)*n,i=dP(t.y,r,e.height-r)*n;return[s,i]},cu=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),ib=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),lu=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),Eo=(t,e=[0,0])=>{const{x:n,y:r}=Kw(t)?t.internals.positionAbsolute:Tc(t,e);return{x:n,y:r,width:t.measured?.width??t.width??t.initialWidth??0,height:t.measured?.height??t.height??t.initialHeight??0}},md=(t,e=[0,0])=>{const{x:n,y:r}=Kw(t)?t.internals.positionAbsolute:Tc(t,e);return{x:n,y:r,x2:n+(t.measured?.width??t.width??t.initialWidth??0),y2:r+(t.measured?.height??t.height??t.initialHeight??0)}},I3=(t,e)=>lu(cu(ib(t),ib(e))),oc=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},uP=t=>yr(t.width)&&yr(t.height)&&yr(t.x)&&yr(t.y),yr=t=>!isNaN(t)&&isFinite(t),gee=(t,e)=>{},Ac=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),jc=({x:t,y:e},[n,r,s],i=!1,o=[1,1])=>{const a={x:(t-n)/s,y:(e-r)/s};return i?Ac(a,o):a},yd=({x:t,y:e},[n,r,s])=>({x:t*s+n,y:e*s+r});function Zi(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function mee(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=Zi(t,n),s=Zi(t,e);return{top:r,right:s,bottom:r,left:s,x:s*2,y:r*2}}if(typeof t=="object"){const r=Zi(t.top??t.y??0,n),s=Zi(t.bottom??t.y??0,n),i=Zi(t.left??t.x??0,e),o=Zi(t.right??t.x??0,e);return{top:r,right:o,bottom:s,left:i,x:i+o,y:r+s}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function yee(t,e,n,r,s,i){const{x:o,y:a}=yd(t,[e,n,r]),{x:c,y:l}=yd({x:t.x+t.width,y:t.y+t.height},[e,n,r]),d=s-c,u=i-l;return{left:Math.floor(o),top:Math.floor(a),right:Math.floor(d),bottom:Math.floor(u)}}const Ww=(t,e,n,r,s,i)=>{const o=mee(i,e,n),a=(e-o.x)/t.width,c=(n-o.y)/t.height,l=Math.min(a,c),d=Po(l,r,s),u=t.x+t.width/2,p=t.y+t.height/2,f=e/2-u*d,m=n/2-p*d,y=yee(t,f,m,d,e,n),S={left:Math.min(y.left-o.left,0),top:Math.min(y.top-o.top,0),right:Math.min(y.right-o.right,0),bottom:Math.min(y.bottom-o.bottom,0)};return{x:f-S.left+S.right,y:m-S.top+S.bottom,zoom:d}},ac=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function ko(t){return t!=null&&t!=="parent"}function bs(t){return{width:t.measured?.width??t.width??t.initialWidth??0,height:t.measured?.height??t.height??t.initialHeight??0}}function P3(t){return(t.measured?.width??t.width??t.initialWidth)!==void 0&&(t.measured?.height??t.height??t.initialHeight)!==void 0}function E3(t,e={width:0,height:0},n,r,s){const i={...t},o=r.get(n);if(o){const a=o.origin||s;i.x+=o.internals.positionAbsolute.x-(e.width??0)*a[0],i.y+=o.internals.positionAbsolute.y-(e.height??0)*a[1]}return i}function hP(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}function See(){let t,e;return{promise:new Promise((r,s)=>{t=r,e=s}),resolve:t,reject:e}}function vee(t){return{...S3,...t||{}}}function za(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:s}){const{x:i,y:o}=Sr(t),a=jc({x:i-(s?.left??0),y:o-(s?.top??0)},r),{x:c,y:l}=n?Ac(a,e):a;return{xSnapped:c,ySnapped:l,...a}}const Yw=t=>({width:t.offsetWidth,height:t.offsetHeight}),k3=t=>t?.getRootNode?.()||window?.document,xee=["INPUT","SELECT","TEXTAREA"];function T3(t){const e=t.composedPath?.()?.[0]||t.target;return e?.nodeType!==1?!1:xee.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const M3=t=>"clientX"in t,Sr=(t,e)=>{const n=M3(t),r=n?t.clientX:t.touches?.[0].clientX,s=n?t.clientY:t.touches?.[0].clientY;return{x:r-(e?.left??0),y:s-(e?.top??0)}},pP=(t,e,n,r,s)=>{const i=e.querySelectorAll(`.${t}`);return!i||!i.length?null:Array.from(i).map(o=>{const a=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:t,nodeId:s,position:o.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...Yw(o)}})};function A3({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:s,sourceControlY:i,targetControlX:o,targetControlY:a}){const c=t*.125+s*.375+o*.375+n*.125,l=e*.125+i*.375+a*.375+r*.125,d=Math.abs(c-t),u=Math.abs(l-e);return[c,l,d,u]}function Pl(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function fP({pos:t,x1:e,y1:n,x2:r,y2:s,c:i}){switch(t){case ve.Left:return[e-Pl(e-r,i),n];case ve.Right:return[e+Pl(r-e,i),n];case ve.Top:return[e,n-Pl(n-s,i)];case ve.Bottom:return[e,n+Pl(s-n,i)]}}function j3({sourceX:t,sourceY:e,sourcePosition:n=ve.Bottom,targetX:r,targetY:s,targetPosition:i=ve.Top,curvature:o=.25}){const[a,c]=fP({pos:n,x1:t,y1:e,x2:r,y2:s,c:o}),[l,d]=fP({pos:i,x1:r,y1:s,x2:t,y2:e,c:o}),[u,p,f,m]=A3({sourceX:t,sourceY:e,targetX:r,targetY:s,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:d});return[`M${t},${e} C${a},${c} ${l},${d} ${r},${s}`,u,p,f,m]}function R3({sourceX:t,sourceY:e,targetX:n,targetY:r}){const s=Math.abs(n-t)/2,i=n<t?n+s:n-s,o=Math.abs(r-e)/2,a=r<e?r+o:r-o;return[i,a,s,o]}function bee({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:s=!1,zIndexMode:i="basic"}){if(i==="manual")return r;const o=s&&n?r+1e3:r,a=Math.max(t.parentId||s&&t.selected?t.internals.z:0,e.parentId||s&&e.selected?e.internals.z:0);return o+a}function wee({sourceNode:t,targetNode:e,width:n,height:r,transform:s}){const i=cu(md(t),md(e));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const o={x:-s[0]/s[2],y:-s[1]/s[2],width:n/s[2],height:r/s[2]};return oc(o,lu(i))>0}const Cee=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,_ee=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),O3=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||Cee;let s;return b3(t)?s={...t}:s={...t,id:r(t)},_ee(s,e)?e:(s.sourceHandle===null&&delete s.sourceHandle,s.targetHandle===null&&delete s.targetHandle,e.concat(s))};function D3({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[s,i,o,a]=R3({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,s,i,o,a]}const gP={[ve.Left]:{x:-1,y:0},[ve.Right]:{x:1,y:0},[ve.Top]:{x:0,y:-1},[ve.Bottom]:{x:0,y:1}},Iee=({source:t,sourcePosition:e=ve.Bottom,target:n})=>e===ve.Left||e===ve.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},mP=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function Pee({source:t,sourcePosition:e=ve.Bottom,target:n,targetPosition:r=ve.Top,center:s,offset:i,stepPosition:o}){const a=gP[e],c=gP[r],l={x:t.x+a.x*i,y:t.y+a.y*i},d={x:n.x+c.x*i,y:n.y+c.y*i},u=Iee({source:l,sourcePosition:e,target:d}),p=u.x!==0?"x":"y",f=u[p];let m=[],y,S;const g={x:0,y:0},v={x:0,y:0},[,,x,b]=R3({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(a[p]*c[p]===-1){p==="x"?(y=s.x??l.x+(d.x-l.x)*o,S=s.y??(l.y+d.y)/2):(y=s.x??(l.x+d.x)/2,S=s.y??l.y+(d.y-l.y)*o);const I=[{x:y,y:l.y},{x:y,y:d.y}],C=[{x:l.x,y:S},{x:d.x,y:S}];a[p]===f?m=p==="x"?I:C:m=p==="x"?C:I}else{const I=[{x:l.x,y:d.y}],C=[{x:d.x,y:l.y}];if(p==="x"?m=a.x===f?C:I:m=a.y===f?I:C,e===r){const A=Math.abs(t[p]-n[p]);if(A<=i){const j=Math.min(i-1,i-A);a[p]===f?g[p]=(l[p]>t[p]?-1:1)*j:v[p]=(d[p]>n[p]?-1:1)*j}}if(e!==r){const A=p==="x"?"y":"x",j=a[p]===c[A],R=l[A]>d[A],L=l[A]<d[A];(a[p]===1&&(!j&&R||j&&L)||a[p]!==1&&(!j&&L||j&&R))&&(m=p==="x"?I:C)}const P={x:l.x+g.x,y:l.y+g.y},k={x:d.x+v.x,y:d.y+v.y},T=Math.max(Math.abs(P.x-m[0].x),Math.abs(k.x-m[0].x)),M=Math.max(Math.abs(P.y-m[0].y),Math.abs(k.y-m[0].y));T>=M?(y=(P.x+k.x)/2,S=m[0].y):(y=m[0].x,S=(P.y+k.y)/2)}return[[t,{x:l.x+g.x,y:l.y+g.y},...m,{x:d.x+v.x,y:d.y+v.y},n],y,S,x,b]}function Eee(t,e,n,r){const s=Math.min(mP(t,e)/2,mP(e,n)/2,r),{x:i,y:o}=e;if(t.x===i&&i===n.x||t.y===o&&o===n.y)return`L${i} ${o}`;if(t.y===o){const l=t.x<n.x?-1:1,d=t.y<n.y?1:-1;return`L ${i+s*l},${o}Q ${i},${o} ${i},${o+s*d}`}const a=t.x<n.x?1:-1,c=t.y<n.y?-1:1;return`L ${i},${o+s*c}Q ${i},${o} ${i+s*a},${o}`}function ob({sourceX:t,sourceY:e,sourcePosition:n=ve.Bottom,targetX:r,targetY:s,targetPosition:i=ve.Top,borderRadius:o=5,centerX:a,centerY:c,offset:l=20,stepPosition:d=.5}){const[u,p,f,m,y]=Pee({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:s},targetPosition:i,center:{x:a,y:c},offset:l,stepPosition:d});return[u.reduce((g,v,x)=>{let b="";return x>0&&x<u.length-1?b=Eee(u[x-1],v,u[x+1],o):b=`${x===0?"M":"L"}${v.x} ${v.y}`,g+=b,g},""),p,f,m,y]}function yP(t){return t&&!!(t.internals.handleBounds||t.handles?.length)&&!!(t.measured.width||t.width||t.initialWidth)}function kee(t){const{sourceNode:e,targetNode:n}=t;if(!yP(e)||!yP(n))return null;const r=e.internals.handleBounds||SP(e.handles),s=n.internals.handleBounds||SP(n.handles),i=vP(r?.source??[],t.sourceHandle),o=vP(t.connectionMode===_o.Strict?s?.target??[]:(s?.target??[]).concat(s?.source??[]),t.targetHandle);if(!i||!o)return t.onError?.("008",Ur.error008(i?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const a=i?.position||ve.Bottom,c=o?.position||ve.Top,l=Ai(e,i,a),d=Ai(n,o,c);return{sourceX:l.x,sourceY:l.y,targetX:d.x,targetY:d.y,sourcePosition:a,targetPosition:c}}function SP(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function Ai(t,e,n=ve.Left,r=!1){const s=(e?.x??0)+t.internals.positionAbsolute.x,i=(e?.y??0)+t.internals.positionAbsolute.y,{width:o,height:a}=e??bs(t);if(r)return{x:s+o/2,y:i+a/2};switch(e?.position??n){case ve.Top:return{x:s+o/2,y:i};case ve.Right:return{x:s+o,y:i+a/2};case ve.Bottom:return{x:s+o/2,y:i+a};case ve.Left:return{x:s,y:i+a/2}}}function vP(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function ab(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function Tee(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:s}){const i=new Set;return t.reduce((o,a)=>([a.markerStart||r,a.markerEnd||s].forEach(c=>{if(c&&typeof c=="object"){const l=ab(c,e);i.has(l)||(o.push({id:l,color:c.color||n,...c}),i.add(l))}}),o),[]).sort((o,a)=>o.id.localeCompare(a.id))}const L3=1e3,Mee=10,Xw={nodeOrigin:[0,0],nodeExtent:sc,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Aee={...Xw,checkEquality:!0};function Zw(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function jee(t,e,n){const r=Zw(Xw,n);for(const s of t.values())if(s.parentId)Jw(s,t,e,r);else{const i=Tc(s,r.nodeOrigin),o=ko(s.extent)?s.extent:r.nodeExtent,a=Mi(i,o,bs(s));s.internals.positionAbsolute=a}}function Ree(t,e){if(!t.handles)return t.measured?e?.internals.handleBounds:void 0;const n=[],r=[];for(const s of t.handles){const i={id:s.id,width:s.width??1,height:s.height??1,nodeId:t.id,x:s.x,y:s.y,position:s.position,type:s.type};s.type==="source"?n.push(i):s.type==="target"&&r.push(i)}return{source:n,target:r}}function Qw(t){return t==="manual"}function cb(t,e,n,r={}){const s=Zw(Aee,r),i={i:0},o=new Map(e),a=s?.elevateNodesOnSelect&&!Qw(s.zIndexMode)?L3:0;let c=t.length>0;e.clear(),n.clear();for(const l of t){let d=o.get(l.id);if(s.checkEquality&&l===d?.internals.userNode)e.set(l.id,d);else{const u=Tc(l,s.nodeOrigin),p=ko(l.extent)?l.extent:s.nodeExtent,f=Mi(u,p,bs(l));d={...s.defaults,...l,measured:{width:l.measured?.width,height:l.measured?.height},internals:{positionAbsolute:f,handleBounds:Ree(l,d),z:N3(l,a,s.zIndexMode),userNode:l}},e.set(l.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(c=!1),l.parentId&&Jw(d,e,n,r,i)}return c}function Oee(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function Jw(t,e,n,r,s){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:a,zIndexMode:c}=Zw(Xw,r),l=t.parentId,d=e.get(l);if(!d){console.warn(`Parent node ${l} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Oee(t,n),s&&!d.parentId&&d.internals.rootParentIndex===void 0&&c==="auto"&&(d.internals.rootParentIndex=++s.i,d.internals.z=d.internals.z+s.i*Mee),s&&d.internals.rootParentIndex!==void 0&&(s.i=d.internals.rootParentIndex);const u=i&&!Qw(c)?L3:0,{x:p,y:f,z:m}=Dee(t,d,o,a,u,c),{positionAbsolute:y}=t.internals,S=p!==y.x||f!==y.y;(S||m!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:S?{x:p,y:f}:y,z:m}})}function N3(t,e,n){const r=yr(t.zIndex)?t.zIndex:0;return Qw(n)?r:r+(t.selected?e:0)}function Dee(t,e,n,r,s,i){const{x:o,y:a}=e.internals.positionAbsolute,c=bs(t),l=Tc(t,n),d=ko(t.extent)?Mi(l,t.extent,c):l;let u=Mi({x:o+d.x,y:a+d.y},r,c);t.extent==="parent"&&(u=C3(u,c,e));const p=N3(t,s,i),f=e.internals.z??0;return{x:u.x,y:u.y,z:f>=p?f+1:p}}function e0(t,e,n,r=[0,0]){const s=[],i=new Map;for(const o of t){const a=e.get(o.parentId);if(!a)continue;const c=i.get(o.parentId)?.expandedRect??Eo(a),l=I3(c,o.rect);i.set(o.parentId,{expandedRect:l,parent:a})}return i.size>0&&i.forEach(({expandedRect:o,parent:a},c)=>{const l=a.internals.positionAbsolute,d=bs(a),u=a.origin??r,p=o.x<l.x?Math.round(Math.abs(l.x-o.x)):0,f=o.y<l.y?Math.round(Math.abs(l.y-o.y)):0,m=Math.max(d.width,Math.round(o.width)),y=Math.max(d.height,Math.round(o.height)),S=(m-d.width)*u[0],g=(y-d.height)*u[1];(p>0||f>0||S||g)&&(s.push({id:c,type:"position",position:{x:a.position.x-p+S,y:a.position.y-f+g}}),n.get(c)?.forEach(v=>{t.some(x=>x.id===v.id)||s.push({id:v.id,type:"position",position:{x:v.position.x+p,y:v.position.y+f}})})),(d.width<o.width||d.height<o.height||p||f)&&s.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:m+(p?u[0]*p-S:0),height:y+(f?u[1]*f-g:0)}})}),s}function Lee(t,e,n,r,s,i,o){const a=r?.querySelector(".xyflow__viewport");let c=!1;if(!a)return{changes:[],updatedInternals:c};const l=[],d=window.getComputedStyle(a),{m22:u}=new window.DOMMatrixReadOnly(d.transform),p=[];for(const f of t.values()){const m=e.get(f.id);if(!m)continue;if(m.hidden){e.set(m.id,{...m,internals:{...m.internals,handleBounds:void 0}}),c=!0;continue}const y=Yw(f.nodeElement),S=m.measured.width!==y.width||m.measured.height!==y.height;if(!!(y.width&&y.height&&(S||!m.internals.handleBounds||f.force))){const v=f.nodeElement.getBoundingClientRect(),x=ko(m.extent)?m.extent:i;let{positionAbsolute:b}=m.internals;m.parentId&&m.extent==="parent"?b=C3(b,y,e.get(m.parentId)):x&&(b=Mi(b,x,y));const E={...m,measured:y,internals:{...m.internals,positionAbsolute:b,handleBounds:{source:pP("source",f.nodeElement,v,u,m.id),target:pP("target",f.nodeElement,v,u,m.id)}}};e.set(m.id,E),m.parentId&&Jw(E,e,n,{nodeOrigin:s,zIndexMode:o}),c=!0,S&&(l.push({id:m.id,type:"dimensions",dimensions:y}),m.expandParent&&m.parentId&&p.push({id:m.id,parentId:m.parentId,rect:Eo(E,s)}))}}if(p.length>0){const f=e0(p,e,n,s);l.push(...f)}return{changes:l,updatedInternals:c}}async function Nee({delta:t,panZoom:e,transform:n,translateExtent:r,width:s,height:i}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const o=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[s,i]],r),a=!!o&&(o.x!==n[0]||o.y!==n[1]||o.k!==n[2]);return Promise.resolve(a)}function xP(t,e,n,r,s,i){let o=s;const a=r.get(o)||new Map;r.set(o,a.set(n,e)),o=`${s}-${t}`;const c=r.get(o)||new Map;if(r.set(o,c.set(n,e)),i){o=`${s}-${t}-${i}`;const l=r.get(o)||new Map;r.set(o,l.set(n,e))}}function F3(t,e,n){t.clear(),e.clear();for(const r of n){const{source:s,target:i,sourceHandle:o=null,targetHandle:a=null}=r,c={edgeId:r.id,source:s,target:i,sourceHandle:o,targetHandle:a},l=`${s}-${o}--${i}-${a}`,d=`${i}-${a}--${s}-${o}`;xP("source",c,d,t,s,o),xP("target",c,l,t,i,a),e.set(r.id,r)}}function B3(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:B3(n,e):!1}function bP(t,e,n){let r=t;do{if(r?.matches?.(e))return!0;if(r===n)return!1;r=r?.parentElement}while(r);return!1}function Fee(t,e,n,r){const s=new Map;for(const[i,o]of t)if((o.selected||o.id===r)&&(!o.parentId||!B3(o,t))&&(o.draggable||e&&typeof o.draggable>"u")){const a=t.get(i);a&&s.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return s}function Vf({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){const s=[];for(const[o,a]of e){const c=n.get(o)?.internals.userNode;c&&s.push({...c,position:a.position,dragging:r})}if(!t)return[s[0],s];const i=n.get(t)?.internals.userNode;return[i?{...i,position:e.get(t)?.position||i.position,dragging:r}:s[0],s]}function Bee({dragItems:t,snapGrid:e,x:n,y:r}){const s=t.values().next().value;if(!s)return null;const i={x:n-s.distance.x,y:r-s.distance.y},o=Ac(i,e);return{x:o.x-i.x,y:o.y-i.y}}function $ee({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:s}){let i={x:null,y:null},o=0,a=new Map,c=!1,l={x:0,y:0},d=null,u=!1,p=null,f=!1,m=!1,y=null;function S({noDragClassName:v,handleSelector:x,domNode:b,isSelectable:E,nodeId:I,nodeClickDistance:C=0}){p=Id(b);function P({x:A,y:j}){const{nodeLookup:R,nodeExtent:L,snapGrid:F,snapToGrid:H,nodeOrigin:B,onNodeDrag:$,onSelectionDrag:Q,onError:Z,updateNodePositions:ee}=e();i={x:A,y:j};let ne=!1;const N=a.size>1,D=N&&L?ib(Mc(a)):null,q=N&&H?Bee({dragItems:a,snapGrid:F,x:A,y:j}):null;for(const[U,V]of a){if(!R.has(U))continue;let te={x:A-V.distance.x,y:j-V.distance.y};H&&(te=q?{x:Math.round(te.x+q.x),y:Math.round(te.y+q.y)}:Ac(te,F));let ie=null;if(N&&L&&!V.extent&&D){const{positionAbsolute:de}=V.internals,ge=de.x-D.x+L[0][0],le=de.x+V.measured.width-D.x2+L[1][0],xe=de.y-D.y+L[0][1],me=de.y+V.measured.height-D.y2+L[1][1];ie=[[ge,xe],[le,me]]}const{position:oe,positionAbsolute:ue}=w3({nodeId:U,nextPosition:te,nodeLookup:R,nodeExtent:ie||L,nodeOrigin:B,onError:Z});ne=ne||V.position.x!==oe.x||V.position.y!==oe.y,V.position=oe,V.internals.positionAbsolute=ue}if(m=m||ne,!!ne&&(ee(a,!0),y&&(r||$||!I&&Q))){const[U,V]=Vf({nodeId:I,dragItems:a,nodeLookup:R});r?.(y,a,U,V),$?.(y,U,V),I||Q?.(y,V)}}async function k(){if(!d)return;const{transform:A,panBy:j,autoPanSpeed:R,autoPanOnNodeDrag:L}=e();if(!L){c=!1,cancelAnimationFrame(o);return}const[F,H]=_3(l,d,R);(F!==0||H!==0)&&(i.x=(i.x??0)-F/A[2],i.y=(i.y??0)-H/A[2],await j({x:F,y:H})&&P(i)),o=requestAnimationFrame(k)}function T(A){const{nodeLookup:j,multiSelectionActive:R,nodesDraggable:L,transform:F,snapGrid:H,snapToGrid:B,selectNodesOnDrag:$,onNodeDragStart:Q,onSelectionDragStart:Z,unselectNodesAndEdges:ee}=e();u=!0,(!$||!E)&&!R&&I&&(j.get(I)?.selected||ee()),E&&$&&I&&t?.(I);const ne=za(A.sourceEvent,{transform:F,snapGrid:H,snapToGrid:B,containerBounds:d});if(i=ne,a=Fee(j,L,ne,I),a.size>0&&(n||Q||!I&&Z)){const[N,D]=Vf({nodeId:I,dragItems:a,nodeLookup:j});n?.(A.sourceEvent,a,N,D),Q?.(A.sourceEvent,N,D),I||Z?.(A.sourceEvent,D)}}const M=DA().clickDistance(C).on("start",A=>{const{domNode:j,nodeDragThreshold:R,transform:L,snapGrid:F,snapToGrid:H}=e();d=j?.getBoundingClientRect()||null,f=!1,m=!1,y=A.sourceEvent,R===0&&T(A),i=za(A.sourceEvent,{transform:L,snapGrid:F,snapToGrid:H,containerBounds:d}),l=Sr(A.sourceEvent,d)}).on("drag",A=>{const{autoPanOnNodeDrag:j,transform:R,snapGrid:L,snapToGrid:F,nodeDragThreshold:H,nodeLookup:B}=e(),$=za(A.sourceEvent,{transform:R,snapGrid:L,snapToGrid:F,containerBounds:d});if(y=A.sourceEvent,(A.sourceEvent.type==="touchmove"&&A.sourceEvent.touches.length>1||I&&!B.has(I))&&(f=!0),!f){if(!c&&j&&u&&(c=!0,k()),!u){const Q=Sr(A.sourceEvent,d),Z=Q.x-l.x,ee=Q.y-l.y;Math.sqrt(Z*Z+ee*ee)>H&&T(A)}(i.x!==$.xSnapped||i.y!==$.ySnapped)&&a&&u&&(l=Sr(A.sourceEvent,d),P($))}}).on("end",A=>{if(!(!u||f)&&(c=!1,u=!1,cancelAnimationFrame(o),a.size>0)){const{nodeLookup:j,updateNodePositions:R,onNodeDragStop:L,onSelectionDragStop:F}=e();if(m&&(R(a,!1),m=!1),s||L||!I&&F){const[H,B]=Vf({nodeId:I,dragItems:a,nodeLookup:j,dragging:!1});s?.(A.sourceEvent,a,H,B),L?.(A.sourceEvent,H,B),I||F?.(A.sourceEvent,B)}}}).filter(A=>{const j=A.target;return!A.button&&(!v||!bP(j,`.${v}`,b))&&(!x||bP(j,x,b))});p.call(M)}function g(){p?.on(".drag",null)}return{update:S,destroy:g}}function zee(t,e,n){const r=[],s={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const i of e.values())oc(s,Eo(i))>0&&r.push(i);return r}const Uee=250;function qee(t,e,n,r){let s=[],i=1/0;const o=zee(t,n,e+Uee);for(const a of o){const c=[...a.internals.handleBounds?.source??[],...a.internals.handleBounds?.target??[]];for(const l of c){if(r.nodeId===l.nodeId&&r.type===l.type&&r.id===l.id)continue;const{x:d,y:u}=Ai(a,l,l.position,!0),p=Math.sqrt(Math.pow(d-t.x,2)+Math.pow(u-t.y,2));p>e||(p<i?(s=[{...l,x:d,y:u}],i=p):p===i&&s.push({...l,x:d,y:u}))}}if(!s.length)return null;if(s.length>1){const a=r.type==="source"?"target":"source";return s.find(c=>c.type===a)??s[0]}return s[0]}function $3(t,e,n,r,s,i=!1){const o=r.get(t);if(!o)return null;const a=s==="strict"?o.internals.handleBounds?.[e]:[...o.internals.handleBounds?.source??[],...o.internals.handleBounds?.target??[]],c=(n?a?.find(l=>l.id===n):a?.[0])??null;return c&&i?{...c,...Ai(o,c,c.position,!0)}:c}function z3(t,e){return t||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function Hee(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const U3=()=>!0;function Gee(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:s,edgeUpdaterType:i,isTarget:o,domNode:a,nodeLookup:c,lib:l,autoPanOnConnect:d,flowId:u,panBy:p,cancelConnection:f,onConnectStart:m,onConnect:y,onConnectEnd:S,isValidConnection:g=U3,onReconnectEnd:v,updateConnection:x,getTransform:b,getFromHandle:E,autoPanSpeed:I,dragThreshold:C=1,handleDomNode:P}){const k=k3(t.target);let T=0,M;const{x:A,y:j}=Sr(t),R=z3(i,P),L=a?.getBoundingClientRect();let F=!1;if(!L||!R)return;const H=$3(s,R,r,c,e);if(!H)return;let B=Sr(t,L),$=!1,Q=null,Z=!1,ee=null;function ne(){if(!d||!L)return;const[oe,ue]=_3(B,L,I);p({x:oe,y:ue}),T=requestAnimationFrame(ne)}const N={...H,nodeId:s,type:R,position:H.position},D=c.get(s);let U={inProgress:!0,isValid:null,from:Ai(D,N,ve.Left,!0),fromHandle:N,fromPosition:N.position,fromNode:D,to:B,toHandle:null,toPosition:lP[N.position],toNode:null,pointer:B};function V(){F=!0,x(U),m?.(t,{nodeId:s,handleId:r,handleType:R})}C===0&&V();function te(oe){if(!F){const{x:me,y:et}=Sr(oe),ht=me-A,Kt=et-j;if(!(ht*ht+Kt*Kt>C*C))return;V()}if(!E()||!N){ie(oe);return}const ue=b();B=Sr(oe,L),M=qee(jc(B,ue,!1,[1,1]),n,c,N),$||(ne(),$=!0);const de=q3(oe,{handle:M,connectionMode:e,fromNodeId:s,fromHandleId:r,fromType:o?"target":"source",isValidConnection:g,doc:k,lib:l,flowId:u,nodeLookup:c});ee=de.handleDomNode,Q=de.connection,Z=Hee(!!M,de.isValid);const ge=c.get(s),le=ge?Ai(ge,N,ve.Left,!0):U.from,xe={...U,from:le,isValid:Z,to:de.toHandle&&Z?yd({x:de.toHandle.x,y:de.toHandle.y},ue):B,toHandle:de.toHandle,toPosition:Z&&de.toHandle?de.toHandle.position:lP[N.position],toNode:de.toHandle?c.get(de.toHandle.nodeId):null,pointer:B};x(xe),U=xe}function ie(oe){if(!("touches"in oe&&oe.touches.length>0)){if(F){(M||ee)&&Q&&Z&&y?.(Q);const{inProgress:ue,...de}=U,ge={...de,toPosition:U.toHandle?U.toPosition:null};S?.(oe,ge),i&&v?.(oe,ge)}f(),cancelAnimationFrame(T),$=!1,Z=!1,Q=null,ee=null,k.removeEventListener("mousemove",te),k.removeEventListener("mouseup",ie),k.removeEventListener("touchmove",te),k.removeEventListener("touchend",ie)}}k.addEventListener("mousemove",te),k.addEventListener("mouseup",ie),k.addEventListener("touchmove",te),k.addEventListener("touchend",ie)}function q3(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:s,fromType:i,doc:o,lib:a,flowId:c,isValidConnection:l=U3,nodeLookup:d}){const u=i==="target",p=e?o.querySelector(`.${a}-flow__handle[data-id="${c}-${e?.nodeId}-${e?.id}-${e?.type}"]`):null,{x:f,y:m}=Sr(t),y=o.elementFromPoint(f,m),S=y?.classList.contains(`${a}-flow__handle`)?y:p,g={handleDomNode:S,isValid:!1,connection:null,toHandle:null};if(S){const v=z3(void 0,S),x=S.getAttribute("data-nodeid"),b=S.getAttribute("data-handleid"),E=S.classList.contains("connectable"),I=S.classList.contains("connectableend");if(!x||!v)return g;const C={source:u?x:r,sourceHandle:u?b:s,target:u?r:x,targetHandle:u?s:b};g.connection=C;const k=E&&I&&(n===_o.Strict?u&&v==="source"||!u&&v==="target":x!==r||b!==s);g.isValid=k&&l(C),g.toHandle=$3(x,v,b,d,n,!0)}return g}const lb={onPointerDown:Gee,isValid:q3};function Kee({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const s=Id(t);function i({translateExtent:a,width:c,height:l,zoomStep:d=1,pannable:u=!0,zoomable:p=!0,inversePan:f=!1}){const m=x=>{if(x.sourceEvent.type!=="wheel"||!e)return;const b=n(),E=x.sourceEvent.ctrlKey&&ac()?10:1,I=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*d,C=b[2]*Math.pow(2,I*E);e.scaleTo(C)};let y=[0,0];const S=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(y=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},g=x=>{const b=n();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!e)return;const E=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],I=[E[0]-y[0],E[1]-y[1]];y=E;const C=r()*Math.max(b[2],Math.log(b[2]))*(f?-1:1),P={x:b[0]-I[0]*C,y:b[1]-I[1]*C},k=[[0,0],[c,l]];e.setViewportConstrained({x:P.x,y:P.y,zoom:b[2]},k,a)},v=OA().on("start",S).on("zoom",u?g:null).on("zoom.wheel",p?m:null);s.call(v,{})}function o(){s.on("zoom",null)}return{update:i,destroy:o,pointer:RA}}const du=t=>({x:t.x,y:t.y,zoom:t.k}),Wf=({x:t,y:e,zoom:n})=>gB.translate(t,e).scale(n),uo=(t,e)=>t.target.closest(`.${e}`),H3=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),Vee=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,Yf=(t,e=0,n=Vee,r=()=>{})=>{const s=typeof e=="number"&&e>0;return s||r(),s?t.transition().duration(e).ease(n).on("end",r):t},G3=t=>{const e=t.ctrlKey&&ac()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function Wee({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:s,panOnScrollSpeed:i,zoomOnPinch:o,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:l}){return d=>{if(uo(d,e))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const u=n.property("__zoom").k||1;if(d.ctrlKey&&o){const S=RA(d),g=G3(d),v=u*Math.pow(2,g);r.scaleTo(n,v,S,d);return}const p=d.deltaMode===1?20:1;let f=s===vi.Vertical?0:d.deltaX*p,m=s===vi.Horizontal?0:d.deltaY*p;!ac()&&d.shiftKey&&s!==vi.Vertical&&(f=d.deltaY*p,m=0),r.translateBy(n,-(f/u)*i,-(m/u)*i,{internal:!0});const y=du(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(c?.(d,y),t.panScrollTimeout=setTimeout(()=>{l?.(d,y),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,a?.(d,y))}}function Yee({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,s){const i=r.type==="wheel",o=!e&&i&&!r.ctrlKey,a=uo(r,t);if(r.ctrlKey&&i&&a&&r.preventDefault(),o||a)return null;r.preventDefault(),n.call(this,r,s)}}function Xee({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{if(r.sourceEvent?.internal)return;const s=du(r.transform);t.mouseButton=r.sourceEvent?.button||0,t.isZoomingOrPanning=!0,t.prevViewport=s,r.sourceEvent?.type==="mousedown"&&e(!0),n&&n?.(r.sourceEvent,s)}}function Zee({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:s}){return i=>{t.usedRightMouseButton=!!(n&&H3(e,t.mouseButton??0)),i.sourceEvent?.sync||r([i.transform.x,i.transform.y,i.transform.k]),s&&!i.sourceEvent?.internal&&s?.(i.sourceEvent,du(i.transform))}}function Qee({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:s,onPaneContextMenu:i}){return o=>{if(!o.sourceEvent?.internal&&(t.isZoomingOrPanning=!1,i&&H3(e,t.mouseButton??0)&&!t.usedRightMouseButton&&o.sourceEvent&&i(o.sourceEvent),t.usedRightMouseButton=!1,r(!1),s)){const a=du(o.transform);t.prevViewport=a,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{s?.(o.sourceEvent,a)},n?150:0)}}}function Jee({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:s,zoomOnDoubleClick:i,userSelectionActive:o,noWheelClassName:a,noPanClassName:c,lib:l,connectionInProgress:d}){return u=>{const p=t||e,f=n&&u.ctrlKey,m=u.type==="wheel";if(u.button===1&&u.type==="mousedown"&&(uo(u,`${l}-flow__node`)||uo(u,`${l}-flow__edge`)))return!0;if(!r&&!p&&!s&&!i&&!n||o||d&&!m||uo(u,a)&&m||uo(u,c)&&(!m||s&&m&&!t)||!n&&u.ctrlKey&&m)return!1;if(!n&&u.type==="touchstart"&&u.touches?.length>1)return u.preventDefault(),!1;if(!p&&!s&&!f&&m||!r&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(r)&&!r.includes(u.button)&&u.type==="mousedown")return!1;const y=Array.isArray(r)&&r.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||m)&&y}}function ete({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:s,onPanZoom:i,onPanZoomStart:o,onPanZoomEnd:a,onDraggingChange:c}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=t.getBoundingClientRect(),u=OA().scaleExtent([e,n]).translateExtent(r),p=Id(t).call(u);v({x:s.x,y:s.y,zoom:Po(s.zoom,e,n)},[[0,0],[d.width,d.height]],r);const f=p.on("wheel.zoom"),m=p.on("dblclick.zoom");u.wheelDelta(G3);function y(M,A){return p?new Promise(j=>{u?.interpolate(A?.interpolate==="linear"?$a:ah).transform(Yf(p,A?.duration,A?.ease,()=>j(!0)),M)}):Promise.resolve(!1)}function S({noWheelClassName:M,noPanClassName:A,onPaneContextMenu:j,userSelectionActive:R,panOnScroll:L,panOnDrag:F,panOnScrollMode:H,panOnScrollSpeed:B,preventScrolling:$,zoomOnPinch:Q,zoomOnScroll:Z,zoomOnDoubleClick:ee,zoomActivationKeyPressed:ne,lib:N,onTransformChange:D,connectionInProgress:q,paneClickDistance:U,selectionOnDrag:V}){R&&!l.isZoomingOrPanning&&g();const te=L&&!ne&&!R;u.clickDistance(V?1/0:!yr(U)||U<0?0:U);const ie=te?Wee({zoomPanValues:l,noWheelClassName:M,d3Selection:p,d3Zoom:u,panOnScrollMode:H,panOnScrollSpeed:B,zoomOnPinch:Q,onPanZoomStart:o,onPanZoom:i,onPanZoomEnd:a}):Yee({noWheelClassName:M,preventScrolling:$,d3ZoomHandler:f});if(p.on("wheel.zoom",ie,{passive:!1}),!R){const ue=Xee({zoomPanValues:l,onDraggingChange:c,onPanZoomStart:o});u.on("start",ue);const de=Zee({zoomPanValues:l,panOnDrag:F,onPaneContextMenu:!!j,onPanZoom:i,onTransformChange:D});u.on("zoom",de);const ge=Qee({zoomPanValues:l,panOnDrag:F,panOnScroll:L,onPaneContextMenu:j,onPanZoomEnd:a,onDraggingChange:c});u.on("end",ge)}const oe=Jee({zoomActivationKeyPressed:ne,panOnDrag:F,zoomOnScroll:Z,panOnScroll:L,zoomOnDoubleClick:ee,zoomOnPinch:Q,userSelectionActive:R,noPanClassName:A,noWheelClassName:M,lib:N,connectionInProgress:q});u.filter(oe),ee?p.on("dblclick.zoom",m):p.on("dblclick.zoom",null)}function g(){u.on("zoom",null)}async function v(M,A,j){const R=Wf(M),L=u?.constrain()(R,A,j);return L&&await y(L),new Promise(F=>F(L))}async function x(M,A){const j=Wf(M);return await y(j,A),new Promise(R=>R(j))}function b(M){if(p){const A=Wf(M),j=p.property("__zoom");(j.k!==M.zoom||j.x!==M.x||j.y!==M.y)&&u?.transform(p,A,null,{sync:!0})}}function E(){const M=p?mB(p.node()):{x:0,y:0,k:1};return{x:M.x,y:M.y,zoom:M.k}}function I(M,A){return p?new Promise(j=>{u?.interpolate(A?.interpolate==="linear"?$a:ah).scaleTo(Yf(p,A?.duration,A?.ease,()=>j(!0)),M)}):Promise.resolve(!1)}function C(M,A){return p?new Promise(j=>{u?.interpolate(A?.interpolate==="linear"?$a:ah).scaleBy(Yf(p,A?.duration,A?.ease,()=>j(!0)),M)}):Promise.resolve(!1)}function P(M){u?.scaleExtent(M)}function k(M){u?.translateExtent(M)}function T(M){const A=!yr(M)||M<0?0:M;u?.clickDistance(A)}return{update:S,destroy:g,setViewport:x,setViewportConstrained:v,getViewport:E,scaleTo:I,scaleBy:C,setScaleExtent:P,setTranslateExtent:k,syncViewport:b,setClickDistance:T}}var To;(function(t){t.Line="line",t.Handle="handle"})(To||(To={}));function tte({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:s,affectsY:i}){const o=t-e,a=n-r,c=[o>0?1:o<0?-1:0,a>0?1:a<0?-1:0];return o&&s&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function wP(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),s=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:s}}function ks(t,e){return Math.max(0,e-t)}function Ts(t,e){return Math.max(0,t-e)}function El(t,e,n){return Math.max(0,e-t,t-n)}function CP(t,e){return t?!e:e}function nte(t,e,n,r,s,i,o,a){let{affectsX:c,affectsY:l}=e;const{isHorizontal:d,isVertical:u}=e,p=d&&u,{xSnapped:f,ySnapped:m}=n,{minWidth:y,maxWidth:S,minHeight:g,maxHeight:v}=r,{x,y:b,width:E,height:I,aspectRatio:C}=t;let P=Math.floor(d?f-t.pointerX:0),k=Math.floor(u?m-t.pointerY:0);const T=E+(c?-P:P),M=I+(l?-k:k),A=-i[0]*E,j=-i[1]*I;let R=El(T,y,S),L=El(M,g,v);if(o){let B=0,$=0;c&&P<0?B=ks(x+P+A,o[0][0]):!c&&P>0&&(B=Ts(x+T+A,o[1][0])),l&&k<0?$=ks(b+k+j,o[0][1]):!l&&k>0&&($=Ts(b+M+j,o[1][1])),R=Math.max(R,B),L=Math.max(L,$)}if(a){let B=0,$=0;c&&P>0?B=Ts(x+P,a[0][0]):!c&&P<0&&(B=ks(x+T,a[1][0])),l&&k>0?$=Ts(b+k,a[0][1]):!l&&k<0&&($=ks(b+M,a[1][1])),R=Math.max(R,B),L=Math.max(L,$)}if(s){if(d){const B=El(T/C,g,v)*C;if(R=Math.max(R,B),o){let $=0;!c&&!l||c&&!l&&p?$=Ts(b+j+T/C,o[1][1])*C:$=ks(b+j+(c?P:-P)/C,o[0][1])*C,R=Math.max(R,$)}if(a){let $=0;!c&&!l||c&&!l&&p?$=ks(b+T/C,a[1][1])*C:$=Ts(b+(c?P:-P)/C,a[0][1])*C,R=Math.max(R,$)}}if(u){const B=El(M*C,y,S)/C;if(L=Math.max(L,B),o){let $=0;!c&&!l||l&&!c&&p?$=Ts(x+M*C+A,o[1][0])/C:$=ks(x+(l?k:-k)*C+A,o[0][0])/C,L=Math.max(L,$)}if(a){let $=0;!c&&!l||l&&!c&&p?$=ks(x+M*C,a[1][0])/C:$=Ts(x+(l?k:-k)*C,a[0][0])/C,L=Math.max(L,$)}}}k=k+(k<0?L:-L),P=P+(P<0?R:-R),s&&(p?T>M*C?k=(CP(c,l)?-P:P)/C:P=(CP(c,l)?-k:k)*C:d?(k=P/C,l=c):(P=k*C,c=l));const F=c?x+P:x,H=l?b+k:b;return{width:E+(c?-P:P),height:I+(l?-k:k),x:i[0]*P*(c?-1:1)+F,y:i[1]*k*(l?-1:1)+H}}const K3={width:0,height:0,x:0,y:0},rte={...K3,pointerX:0,pointerY:0,aspectRatio:1};function ste(t){return[[0,0],[t.measured.width,t.measured.height]]}function ite(t,e,n){const r=e.position.x+t.position.x,s=e.position.y+t.position.y,i=t.measured.width??0,o=t.measured.height??0,a=n[0]*i,c=n[1]*o;return[[r-a,s-c],[r+i-a,s+o-c]]}function ote({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:s}){const i=Id(t);let o={controlDirection:wP("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:l,boundaries:d,keepAspectRatio:u,resizeDirection:p,onResizeStart:f,onResize:m,onResizeEnd:y,shouldResize:S}){let g={...K3},v={...rte};o={boundaries:d,resizeDirection:p,keepAspectRatio:u,controlDirection:wP(l)};let x,b=null,E=[],I,C,P,k=!1;const T=DA().on("start",M=>{const{nodeLookup:A,transform:j,snapGrid:R,snapToGrid:L,nodeOrigin:F,paneDomNode:H}=n();if(x=A.get(e),!x)return;b=H?.getBoundingClientRect()??null;const{xSnapped:B,ySnapped:$}=za(M.sourceEvent,{transform:j,snapGrid:R,snapToGrid:L,containerBounds:b});g={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},v={...g,pointerX:B,pointerY:$,aspectRatio:g.width/g.height},I=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(I=A.get(x.parentId),C=I&&x.extent==="parent"?ste(I):void 0),E=[],P=void 0;for(const[Q,Z]of A)if(Z.parentId===e&&(E.push({id:Q,position:{...Z.position},extent:Z.extent}),Z.extent==="parent"||Z.expandParent)){const ee=ite(Z,x,Z.origin??F);P?P=[[Math.min(ee[0][0],P[0][0]),Math.min(ee[0][1],P[0][1])],[Math.max(ee[1][0],P[1][0]),Math.max(ee[1][1],P[1][1])]]:P=ee}f?.(M,{...g})}).on("drag",M=>{const{transform:A,snapGrid:j,snapToGrid:R,nodeOrigin:L}=n(),F=za(M.sourceEvent,{transform:A,snapGrid:j,snapToGrid:R,containerBounds:b}),H=[];if(!x)return;const{x:B,y:$,width:Q,height:Z}=g,ee={},ne=x.origin??L,{width:N,height:D,x:q,y:U}=nte(v,o.controlDirection,F,o.boundaries,o.keepAspectRatio,ne,C,P),V=N!==Q,te=D!==Z,ie=q!==B&&V,oe=U!==$&&te;if(!ie&&!oe&&!V&&!te)return;if((ie||oe||ne[0]===1||ne[1]===1)&&(ee.x=ie?q:g.x,ee.y=oe?U:g.y,g.x=ee.x,g.y=ee.y,E.length>0)){const le=q-B,xe=U-$;for(const me of E)me.position={x:me.position.x-le+ne[0]*(N-Q),y:me.position.y-xe+ne[1]*(D-Z)},H.push(me)}if((V||te)&&(ee.width=V&&(!o.resizeDirection||o.resizeDirection==="horizontal")?N:g.width,ee.height=te&&(!o.resizeDirection||o.resizeDirection==="vertical")?D:g.height,g.width=ee.width,g.height=ee.height),I&&x.expandParent){const le=ne[0]*(ee.width??0);ee.x&&ee.x<le&&(g.x=le,v.x=v.x-(ee.x-le));const xe=ne[1]*(ee.height??0);ee.y&&ee.y<xe&&(g.y=xe,v.y=v.y-(ee.y-xe))}const ue=tte({width:g.width,prevWidth:Q,height:g.height,prevHeight:Z,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),de={...g,direction:ue};S?.(M,de)!==!1&&(k=!0,m?.(M,de),r(ee,H))}).on("end",M=>{k&&(y?.(M,{...g}),s?.({...g}),k=!1)});i.call(T)}function c(){i.on(".drag",null)}return{update:a,destroy:c}}var Xf={exports:{}},Zf={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _P;function ate(){if(_P)return Zf;_P=1;var t=XF(),e=ZF();function n(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var r=typeof Object.is=="function"?Object.is:n,s=e.useSyncExternalStore,i=t.useRef,o=t.useEffect,a=t.useMemo,c=t.useDebugValue;return Zf.useSyncExternalStoreWithSelector=function(l,d,u,p,f){var m=i(null);if(m.current===null){var y={hasValue:!1,value:null};m.current=y}else y=m.current;m=a(function(){function g(I){if(!v){if(v=!0,x=I,I=p(I),f!==void 0&&y.hasValue){var C=y.value;if(f(C,I))return b=C}return b=I}if(C=b,r(x,I))return C;var P=p(I);return f!==void 0&&f(C,P)?(x=I,C):(x=I,b=P)}var v=!1,x,b,E=u===void 0?null:u;return[function(){return g(d())},E===null?void 0:function(){return g(E())}]},[d,u,p,f]);var S=s(l,m[0],m[1]);return o(function(){y.hasValue=!0,y.value=S},[S]),c(S),S},Zf}var IP;function cte(){return IP||(IP=1,Xf.exports=ate()),Xf.exports}var lte=cte();const dte=Ws(lte),ute={},PP=t=>{let e;const n=new Set,r=(d,u)=>{const p=typeof d=="function"?d(e):d;if(!Object.is(p,e)){const f=e;e=u??(typeof p!="object"||p===null)?p:Object.assign({},e,p),n.forEach(m=>m(e,f))}},s=()=>e,c={setState:r,getState:s,getInitialState:()=>l,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{(ute?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},l=e=t(r,s,c);return c},hte=t=>t?PP(t):PP,{useDebugValue:pte}=qe,{useSyncExternalStoreWithSelector:fte}=dte,gte=t=>t;function V3(t,e=gte,n){const r=fte(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return pte(r),r}const EP=(t,e)=>{const n=hte(t),r=(s,i=e)=>V3(n,s,i);return Object.assign(r,n),r},mte=(t,e)=>t?EP(t,e):EP;function it(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,s]of t)if(!Object.is(s,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const uu=_.createContext(null),yte=uu.Provider,W3=Ur.error001();function Fe(t,e){const n=_.useContext(uu);if(n===null)throw new Error(W3);return V3(n,t,e)}function ot(){const t=_.useContext(uu);if(t===null)throw new Error(W3);return _.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])}const kP={display:"none"},Ste={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Y3="react-flow__node-desc",X3="react-flow__edge-desc",vte="react-flow__aria-live",xte=t=>t.ariaLiveMessage,bte=t=>t.ariaLabelConfig;function wte({rfId:t}){const e=Fe(xte);return h.jsx("div",{id:`${vte}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:Ste,children:e})}function Cte({rfId:t,disableKeyboardA11y:e}){const n=Fe(bte);return h.jsxs(h.Fragment,{children:[h.jsx("div",{id:`${Y3}-${t}`,style:kP,children:e?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),h.jsx("div",{id:`${X3}-${t}`,style:kP,children:n["edge.a11yDescription.default"]}),!e&&h.jsx(wte,{rfId:t})]})}const hu=_.forwardRef(({position:t="top-left",children:e,className:n,style:r,...s},i)=>{const o=`${t}`.split("-");return h.jsx("div",{className:wt(["react-flow__panel",n,...o]),style:r,ref:i,...s,children:e})});hu.displayName="Panel";function _te({proOptions:t,position:e="bottom-right"}){return t?.hideAttribution?null:h.jsx(hu,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:h.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Ite=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},kl=t=>t.id;function Pte(t,e){return it(t.selectedNodes.map(kl),e.selectedNodes.map(kl))&&it(t.selectedEdges.map(kl),e.selectedEdges.map(kl))}function Ete({onSelectionChange:t}){const e=ot(),{selectedNodes:n,selectedEdges:r}=Fe(Ite,Pte);return _.useEffect(()=>{const s={nodes:n,edges:r};t?.(s),e.getState().onSelectionChangeHandlers.forEach(i=>i(s))},[n,r,t]),null}const kte=t=>!!t.onSelectionChangeHandlers;function Tte({onSelectionChange:t}){const e=Fe(kte);return t||e?h.jsx(Ete,{onSelectionChange:t}):null}const Z3=[0,0],Mte={x:0,y:0,zoom:1},Ate=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],TP=[...Ate,"rfId"],jte=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges}),MP={translateExtent:sc,nodeOrigin:Z3,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function Rte(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:s,setTranslateExtent:i,setNodeExtent:o,reset:a,setDefaultNodesAndEdges:c}=Fe(jte,it),l=ot();_.useEffect(()=>(c(t.defaultNodes,t.defaultEdges),()=>{d.current=MP,a()}),[]);const d=_.useRef(MP);return _.useEffect(()=>{for(const u of TP){const p=t[u],f=d.current[u];p!==f&&(typeof t[u]>"u"||(u==="nodes"?e(p):u==="edges"?n(p):u==="minZoom"?r(p):u==="maxZoom"?s(p):u==="translateExtent"?i(p):u==="nodeExtent"?o(p):u==="ariaLabelConfig"?l.setState({ariaLabelConfig:vee(p)}):u==="fitView"?l.setState({fitViewQueued:p}):u==="fitViewOptions"?l.setState({fitViewOptions:p}):l.setState({[u]:p})))}d.current=t},TP.map(u=>t[u])),null}function AP(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Ote(t){const[e,n]=_.useState(t==="system"?null:t);return _.useEffect(()=>{if(t!=="system"){n(t);return}const r=AP(),s=()=>n(r?.matches?"dark":"light");return s(),r?.addEventListener("change",s),()=>{r?.removeEventListener("change",s)}},[t]),e!==null?e:AP()?.matches?"dark":"light"}const jP=typeof document<"u"?document:null;function cc(t=null,e={target:jP,actInsideInputWithModifier:!0}){const[n,r]=_.useState(!1),s=_.useRef(!1),i=_.useRef(new Set([])),[o,a]=_.useMemo(()=>{if(t!==null){const l=(Array.isArray(t)?t:[t]).filter(u=>typeof u=="string").map(u=>u.replace("+",`
`).replace(`

`,`
+`).split(`
`)),d=l.reduce((u,p)=>u.concat(...p),[]);return[l,d]}return[[],[]]},[t]);return _.useEffect(()=>{const c=e?.target??jP,l=e?.actInsideInputWithModifier??!0;if(t!==null){const d=f=>{if(s.current=f.ctrlKey||f.metaKey||f.shiftKey||f.altKey,(!s.current||s.current&&!l)&&T3(f))return!1;const y=OP(f.code,a);if(i.current.add(f[y]),RP(o,i.current,!1)){const S=f.composedPath?.()?.[0]||f.target,g=S?.nodeName==="BUTTON"||S?.nodeName==="A";e.preventDefault!==!1&&(s.current||!g)&&f.preventDefault(),r(!0)}},u=f=>{const m=OP(f.code,a);RP(o,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(f[m]),f.key==="Meta"&&i.current.clear(),s.current=!1},p=()=>{i.current.clear(),r(!1)};return c?.addEventListener("keydown",d),c?.addEventListener("keyup",u),window.addEventListener("blur",p),window.addEventListener("contextmenu",p),()=>{c?.removeEventListener("keydown",d),c?.removeEventListener("keyup",u),window.removeEventListener("blur",p),window.removeEventListener("contextmenu",p)}}},[t,r]),n}function RP(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(s=>e.has(s)))}function OP(t,e){return e.includes(t)?"code":"key"}const Dte=()=>{const t=ot();return _.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n?.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,s,i],panZoom:o}=t.getState();return o?(await o.setViewport({x:e.x??r,y:e.y??s,zoom:e.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},setCenter:async(e,n,r)=>t.getState().setCenter(e,n,r),fitBounds:async(e,n)=>{const{width:r,height:s,minZoom:i,maxZoom:o,panZoom:a}=t.getState(),c=Ww(e,r,s,i,o,n?.padding??.1);return a?(await a.setViewport(c,{duration:n?.duration,ease:n?.ease,interpolate:n?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={})=>{const{transform:r,snapGrid:s,snapToGrid:i,domNode:o}=t.getState();if(!o)return e;const{x:a,y:c}=o.getBoundingClientRect(),l={x:e.x-a,y:e.y-c},d=n.snapGrid??s,u=n.snapToGrid??i;return jc(l,r,u,d)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:s,y:i}=r.getBoundingClientRect(),o=yd(e,n);return{x:o.x+s,y:o.y+i}}}),[])};function Q3(t,e){const n=[],r=new Map,s=[];for(const i of t)if(i.type==="add"){s.push(i);continue}else if(i.type==="remove"||i.type==="replace")r.set(i.id,[i]);else{const o=r.get(i.id);o?o.push(i):r.set(i.id,[i])}for(const i of e){const o=r.get(i.id);if(!o){n.push(i);continue}if(o[0].type==="remove")continue;if(o[0].type==="replace"){n.push({...o[0].item});continue}const a={...i};for(const c of o)Lte(c,a);n.push(a)}return s.length&&s.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function Lte(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured={...t.dimensions},t.setAttributes&&((t.setAttributes===!0||t.setAttributes==="width")&&(e.width=t.dimensions.width),(t.setAttributes===!0||t.setAttributes==="height")&&(e.height=t.dimensions.height))),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}function J3(t,e){return Q3(t,e)}function e5(t,e){return Q3(t,e)}function pi(t,e){return{id:t,type:"select",selected:e}}function ho(t,e=new Set,n=!1){const r=[];for(const[s,i]of t){const o=e.has(s);!(i.selected===void 0&&!o)&&i.selected!==o&&(n&&(i.selected=o),r.push(pi(i.id,o)))}return r}function DP({items:t=[],lookup:e}){const n=[],r=new Map(t.map(s=>[s.id,s]));for(const[s,i]of t.entries()){const o=e.get(i.id),a=o?.internals?.userNode??o;a!==void 0&&a!==i&&n.push({id:i.id,item:i,type:"replace"}),a===void 0&&n.push({item:i,type:"add",index:s})}for(const[s]of e)r.get(s)===void 0&&n.push({id:s,type:"remove"});return n}function LP(t){return{id:t.id,type:"remove"}}const NP=t=>lee(t),Nte=t=>b3(t);function t5(t){return _.forwardRef(t)}const Fte=typeof window<"u"?_.useLayoutEffect:_.useEffect;function FP(t){const[e,n]=_.useState(BigInt(0)),[r]=_.useState(()=>Bte(()=>n(s=>s+BigInt(1))));return Fte(()=>{const s=r.get();s.length&&(t(s),r.reset())},[e]),r}function Bte(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const n5=_.createContext(null);function $te({children:t}){const e=ot(),n=_.useCallback(a=>{const{nodes:c=[],setNodes:l,hasDefaultNodes:d,onNodesChange:u,nodeLookup:p,fitViewQueued:f,onNodesChangeMiddlewareMap:m}=e.getState();let y=c;for(const g of a)y=typeof g=="function"?g(y):g;let S=DP({items:y,lookup:p});for(const g of m.values())S=g(S);d&&l(y),S.length>0?u?.(S):f&&window.requestAnimationFrame(()=>{const{fitViewQueued:g,nodes:v,setNodes:x}=e.getState();g&&x(v)})},[]),r=FP(n),s=_.useCallback(a=>{const{edges:c=[],setEdges:l,hasDefaultEdges:d,onEdgesChange:u,edgeLookup:p}=e.getState();let f=c;for(const m of a)f=typeof m=="function"?m(f):m;d?l(f):u&&u(DP({items:f,lookup:p}))},[]),i=FP(s),o=_.useMemo(()=>({nodeQueue:r,edgeQueue:i}),[]);return h.jsx(n5.Provider,{value:o,children:t})}function zte(){const t=_.useContext(n5);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const Ute=t=>!!t.panZoom;function t0(){const t=Dte(),e=ot(),n=zte(),r=Fe(Ute),s=_.useMemo(()=>{const i=u=>e.getState().nodeLookup.get(u),o=u=>{n.nodeQueue.push(u)},a=u=>{n.edgeQueue.push(u)},c=u=>{const{nodeLookup:p,nodeOrigin:f}=e.getState(),m=NP(u)?u:p.get(u.id),y=m.parentId?E3(m.position,m.measured,m.parentId,p,f):m.position,S={...m,position:y,width:m.measured?.width??m.width,height:m.measured?.height??m.height};return Eo(S)},l=(u,p,f={replace:!1})=>{o(m=>m.map(y=>{if(y.id===u){const S=typeof p=="function"?p(y):p;return f.replace&&NP(S)?S:{...y,...S}}return y}))},d=(u,p,f={replace:!1})=>{a(m=>m.map(y=>{if(y.id===u){const S=typeof p=="function"?p(y):p;return f.replace&&Nte(S)?S:{...y,...S}}return y}))};return{getNodes:()=>e.getState().nodes.map(u=>({...u})),getNode:u=>i(u)?.internals.userNode,getInternalNode:i,getEdges:()=>{const{edges:u=[]}=e.getState();return u.map(p=>({...p}))},getEdge:u=>e.getState().edgeLookup.get(u),setNodes:o,setEdges:a,addNodes:u=>{const p=Array.isArray(u)?u:[u];n.nodeQueue.push(f=>[...f,...p])},addEdges:u=>{const p=Array.isArray(u)?u:[u];n.edgeQueue.push(f=>[...f,...p])},toObject:()=>{const{nodes:u=[],edges:p=[],transform:f}=e.getState(),[m,y,S]=f;return{nodes:u.map(g=>({...g})),edges:p.map(g=>({...g})),viewport:{x:m,y,zoom:S}}},deleteElements:async({nodes:u=[],edges:p=[]})=>{const{nodes:f,edges:m,onNodesDelete:y,onEdgesDelete:S,triggerNodeChanges:g,triggerEdgeChanges:v,onDelete:x,onBeforeDelete:b}=e.getState(),{nodes:E,edges:I}=await fee({nodesToRemove:u,edgesToRemove:p,nodes:f,edges:m,onBeforeDelete:b}),C=I.length>0,P=E.length>0;if(C){const k=I.map(LP);S?.(I),v(k)}if(P){const k=E.map(LP);y?.(E),g(k)}return(P||C)&&x?.({nodes:E,edges:I}),{deletedNodes:E,deletedEdges:I}},getIntersectingNodes:(u,p=!0,f)=>{const m=uP(u),y=m?u:c(u),S=f!==void 0;return y?(f||e.getState().nodes).filter(g=>{const v=e.getState().nodeLookup.get(g.id);if(v&&!m&&(g.id===u.id||!v.internals.positionAbsolute))return!1;const x=Eo(S?g:v),b=oc(x,y);return p&&b>0||b>=x.width*x.height||b>=y.width*y.height}):[]},isNodeIntersecting:(u,p,f=!0)=>{const y=uP(u)?u:c(u);if(!y)return!1;const S=oc(y,p);return f&&S>0||S>=p.width*p.height||S>=y.width*y.height},updateNode:l,updateNodeData:(u,p,f={replace:!1})=>{l(u,m=>{const y=typeof p=="function"?p(m):p;return f.replace?{...m,data:y}:{...m,data:{...m.data,...y}}},f)},updateEdge:d,updateEdgeData:(u,p,f={replace:!1})=>{d(u,m=>{const y=typeof p=="function"?p(m):p;return f.replace?{...m,data:y}:{...m,data:{...m.data,...y}}},f)},getNodesBounds:u=>{const{nodeLookup:p,nodeOrigin:f}=e.getState();return dee(u,{nodeLookup:p,nodeOrigin:f})},getHandleConnections:({type:u,id:p,nodeId:f})=>Array.from(e.getState().connectionLookup.get(`${f}-${u}${p?`-${p}`:""}`)?.values()??[]),getNodeConnections:({type:u,handleId:p,nodeId:f})=>Array.from(e.getState().connectionLookup.get(`${f}${u?p?`-${u}-${p}`:`-${u}`:""}`)?.values()??[]),fitView:async u=>{const p=e.getState().fitViewResolver??See();return e.setState({fitViewQueued:!0,fitViewOptions:u,fitViewResolver:p}),n.nodeQueue.push(f=>[...f]),p.promise}}},[]);return _.useMemo(()=>({...s,...t,viewportInitialized:r}),[r])}const BP=t=>t.selected,qte=typeof window<"u"?window:void 0;function Hte({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=ot(),{deleteElements:r}=t0(),s=cc(t,{actInsideInputWithModifier:!1}),i=cc(e,{target:qte});_.useEffect(()=>{if(s){const{edges:o,nodes:a}=n.getState();r({nodes:a.filter(BP),edges:o.filter(BP)}),n.setState({nodesSelectionActive:!1})}},[s]),_.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function Gte(t){const e=ot();_.useEffect(()=>{const n=()=>{if(!t.current||!(t.current.checkVisibility?.()??!0))return!1;const r=Yw(t.current);(r.height===0||r.width===0)&&e.getState().onError?.("004",Ur.error004()),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const pu={position:"absolute",width:"100%",height:"100%",top:0,left:0},Kte=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib,connectionInProgress:t.connection.inProgress});function Vte({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:s=.5,panOnScrollMode:i=vi.Free,zoomOnDoubleClick:o=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:l,minZoom:d,maxZoom:u,zoomActivationKeyCode:p,preventScrolling:f=!0,children:m,noWheelClassName:y,noPanClassName:S,onViewportChange:g,isControlledViewport:v,paneClickDistance:x,selectionOnDrag:b}){const E=ot(),I=_.useRef(null),{userSelectionActive:C,lib:P,connectionInProgress:k}=Fe(Kte,it),T=cc(p),M=_.useRef();Gte(I);const A=_.useCallback(j=>{g?.({x:j[0],y:j[1],zoom:j[2]}),v||E.setState({transform:j})},[g,v]);return _.useEffect(()=>{if(I.current){M.current=ete({domNode:I.current,minZoom:d,maxZoom:u,translateExtent:l,viewport:c,onDraggingChange:F=>E.setState({paneDragging:F}),onPanZoomStart:(F,H)=>{const{onViewportChangeStart:B,onMoveStart:$}=E.getState();$?.(F,H),B?.(H)},onPanZoom:(F,H)=>{const{onViewportChange:B,onMove:$}=E.getState();$?.(F,H),B?.(H)},onPanZoomEnd:(F,H)=>{const{onViewportChangeEnd:B,onMoveEnd:$}=E.getState();$?.(F,H),B?.(H)}});const{x:j,y:R,zoom:L}=M.current.getViewport();return E.setState({panZoom:M.current,transform:[j,R,L],domNode:I.current.closest(".react-flow")}),()=>{M.current?.destroy()}}},[]),_.useEffect(()=>{M.current?.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:s,panOnScrollMode:i,zoomOnDoubleClick:o,panOnDrag:a,zoomActivationKeyPressed:T,preventScrolling:f,noPanClassName:S,userSelectionActive:C,noWheelClassName:y,lib:P,onTransformChange:A,connectionInProgress:k,selectionOnDrag:b,paneClickDistance:x})},[t,e,n,r,s,i,o,a,T,f,S,C,y,P,A,k,b,x]),h.jsx("div",{className:"react-flow__renderer",ref:I,style:pu,children:m})}const Wte=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function Yte(){const{userSelectionActive:t,userSelectionRect:e}=Fe(Wte,it);return t&&e?h.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const Qf=(t,e)=>n=>{n.target===e.current&&t?.(n)},Xte=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,connectionInProgress:t.connection.inProgress,dragging:t.paneDragging});function Zte({isSelecting:t,selectionKeyPressed:e,selectionMode:n=ic.Full,panOnDrag:r,paneClickDistance:s,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:a,onPaneClick:c,onPaneContextMenu:l,onPaneScroll:d,onPaneMouseEnter:u,onPaneMouseMove:p,onPaneMouseLeave:f,children:m}){const y=ot(),{userSelectionActive:S,elementsSelectable:g,dragging:v,connectionInProgress:x}=Fe(Xte,it),b=g&&(t||S),E=_.useRef(null),I=_.useRef(),C=_.useRef(new Set),P=_.useRef(new Set),k=_.useRef(!1),T=B=>{if(k.current||x){k.current=!1;return}c?.(B),y.getState().resetSelectedElements(),y.setState({nodesSelectionActive:!1})},M=B=>{if(Array.isArray(r)&&r?.includes(2)){B.preventDefault();return}l?.(B)},A=d?B=>d(B):void 0,j=B=>{k.current&&(B.stopPropagation(),k.current=!1)},R=B=>{const{domNode:$}=y.getState();if(I.current=$?.getBoundingClientRect(),!I.current)return;const Q=B.target===E.current;if(!Q&&!!B.target.closest(".nokey")||!t||!(i&&Q||e)||B.button!==0||!B.isPrimary)return;B.target?.setPointerCapture?.(B.pointerId),k.current=!1;const{x:ne,y:N}=Sr(B.nativeEvent,I.current);y.setState({userSelectionRect:{width:0,height:0,startX:ne,startY:N,x:ne,y:N}}),Q||(B.stopPropagation(),B.preventDefault())},L=B=>{const{userSelectionRect:$,transform:Q,nodeLookup:Z,edgeLookup:ee,connectionLookup:ne,triggerNodeChanges:N,triggerEdgeChanges:D,defaultEdgeOptions:q,resetSelectedElements:U}=y.getState();if(!I.current||!$)return;const{x:V,y:te}=Sr(B.nativeEvent,I.current),{startX:ie,startY:oe}=$;if(!k.current){const xe=e?0:s;if(Math.hypot(V-ie,te-oe)<=xe)return;U(),o?.(B)}k.current=!0;const ue={startX:ie,startY:oe,x:V<ie?V:ie,y:te<oe?te:oe,width:Math.abs(V-ie),height:Math.abs(te-oe)},de=C.current,ge=P.current;C.current=new Set(Vw(Z,ue,Q,n===ic.Partial,!0).map(xe=>xe.id)),P.current=new Set;const le=q?.selectable??!0;for(const xe of C.current){const me=ne.get(xe);if(me)for(const{edgeId:et}of me.values()){const ht=ee.get(et);ht&&(ht.selectable??le)&&P.current.add(et)}}if(!hP(de,C.current)){const xe=ho(Z,C.current,!0);N(xe)}if(!hP(ge,P.current)){const xe=ho(ee,P.current);D(xe)}y.setState({userSelectionRect:ue,userSelectionActive:!0,nodesSelectionActive:!1})},F=B=>{B.button===0&&(B.target?.releasePointerCapture?.(B.pointerId),!S&&B.target===E.current&&y.getState().userSelectionRect&&T?.(B),y.setState({userSelectionActive:!1,userSelectionRect:null}),k.current&&(a?.(B),y.setState({nodesSelectionActive:C.current.size>0})))},H=r===!0||Array.isArray(r)&&r.includes(0);return h.jsxs("div",{className:wt(["react-flow__pane",{draggable:H,dragging:v,selection:t}]),onClick:b?void 0:Qf(T,E),onContextMenu:Qf(M,E),onWheel:Qf(A,E),onPointerEnter:b?void 0:u,onPointerMove:b?L:p,onPointerUp:b?F:void 0,onPointerDownCapture:b?R:void 0,onClickCapture:b?j:void 0,onPointerLeave:f,ref:E,style:pu,children:[m,h.jsx(Yte,{})]})}function db({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:s,unselectNodesAndEdges:i,multiSelectionActive:o,nodeLookup:a,onError:c}=e.getState(),l=a.get(t);if(!l){c?.("012",Ur.error012(t));return}e.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&o)&&(i({nodes:[l],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):s([t])}function r5({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:s,isSelectable:i,nodeClickDistance:o}){const a=ot(),[c,l]=_.useState(!1),d=_.useRef();return _.useEffect(()=>{d.current=$ee({getStoreItems:()=>a.getState(),onNodeMouseDown:u=>{db({id:u,store:a,nodeRef:t})},onDragStart:()=>{l(!0)},onDragStop:()=>{l(!1)}})},[]),_.useEffect(()=>{if(e)d.current?.destroy();else if(t.current)return d.current?.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:i,nodeId:s,nodeClickDistance:o}),()=>{d.current?.destroy()}},[n,r,e,i,t,s]),c}const Qte=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function s5(){const t=ot();return _.useCallback(n=>{const{nodeExtent:r,snapToGrid:s,snapGrid:i,nodesDraggable:o,onError:a,updateNodePositions:c,nodeLookup:l,nodeOrigin:d}=t.getState(),u=new Map,p=Qte(o),f=s?i[0]:5,m=s?i[1]:5,y=n.direction.x*f*n.factor,S=n.direction.y*m*n.factor;for(const[,g]of l){if(!p(g))continue;let v={x:g.internals.positionAbsolute.x+y,y:g.internals.positionAbsolute.y+S};s&&(v=Ac(v,i));const{position:x,positionAbsolute:b}=w3({nodeId:g.id,nextPosition:v,nodeLookup:l,nodeExtent:r,nodeOrigin:d,onError:a});g.position=x,g.internals.positionAbsolute=b,u.set(g.id,g)}c(u)},[])}const n0=_.createContext(null),Jte=n0.Provider;n0.Consumer;const i5=()=>_.useContext(n0),ene=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),tne=(t,e,n)=>r=>{const{connectionClickStartHandle:s,connectionMode:i,connection:o}=r,{fromHandle:a,toHandle:c,isValid:l}=o,d=c?.nodeId===t&&c?.id===e&&c?.type===n;return{connectingFrom:a?.nodeId===t&&a?.id===e&&a?.type===n,connectingTo:d,clickConnecting:s?.nodeId===t&&s?.id===e&&s?.type===n,isPossibleEndHandle:i===_o.Strict?a?.type!==n:t!==a?.nodeId||e!==a?.id,connectionInProcess:!!a,clickConnectionInProcess:!!s,valid:d&&l}};function nne({type:t="source",position:e=ve.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:s=!0,isConnectableEnd:i=!0,id:o,onConnect:a,children:c,className:l,onMouseDown:d,onTouchStart:u,...p},f){const m=o||null,y=t==="target",S=ot(),g=i5(),{connectOnClick:v,noPanClassName:x,rfId:b}=Fe(ene,it),{connectingFrom:E,connectingTo:I,clickConnecting:C,isPossibleEndHandle:P,connectionInProcess:k,clickConnectionInProcess:T,valid:M}=Fe(tne(g,m,t),it);g||S.getState().onError?.("010",Ur.error010());const A=L=>{const{defaultEdgeOptions:F,onConnect:H,hasDefaultEdges:B}=S.getState(),$={...F,...L};if(B){const{edges:Q,setEdges:Z}=S.getState();Z(O3($,Q))}H?.($),a?.($)},j=L=>{if(!g)return;const F=M3(L.nativeEvent);if(s&&(F&&L.button===0||!F)){const H=S.getState();lb.onPointerDown(L.nativeEvent,{handleDomNode:L.currentTarget,autoPanOnConnect:H.autoPanOnConnect,connectionMode:H.connectionMode,connectionRadius:H.connectionRadius,domNode:H.domNode,nodeLookup:H.nodeLookup,lib:H.lib,isTarget:y,handleId:m,nodeId:g,flowId:H.rfId,panBy:H.panBy,cancelConnection:H.cancelConnection,onConnectStart:H.onConnectStart,onConnectEnd:H.onConnectEnd,updateConnection:H.updateConnection,onConnect:A,isValidConnection:n||H.isValidConnection,getTransform:()=>S.getState().transform,getFromHandle:()=>S.getState().connection.fromHandle,autoPanSpeed:H.autoPanSpeed,dragThreshold:H.connectionDragThreshold})}F?d?.(L):u?.(L)},R=L=>{const{onClickConnectStart:F,onClickConnectEnd:H,connectionClickStartHandle:B,connectionMode:$,isValidConnection:Q,lib:Z,rfId:ee,nodeLookup:ne,connection:N}=S.getState();if(!g||!B&&!s)return;if(!B){F?.(L.nativeEvent,{nodeId:g,handleId:m,handleType:t}),S.setState({connectionClickStartHandle:{nodeId:g,type:t,id:m}});return}const D=k3(L.target),q=n||Q,{connection:U,isValid:V}=lb.isValid(L.nativeEvent,{handle:{nodeId:g,id:m,type:t},connectionMode:$,fromNodeId:B.nodeId,fromHandleId:B.id||null,fromType:B.type,isValidConnection:q,flowId:ee,doc:D,lib:Z,nodeLookup:ne});V&&U&&A(U);const te=structuredClone(N);delete te.inProgress,te.toPosition=te.toHandle?te.toHandle.position:null,H?.(L,te),S.setState({connectionClickStartHandle:null})};return h.jsx("div",{"data-handleid":m,"data-nodeid":g,"data-handlepos":e,"data-id":`${b}-${g}-${m}-${t}`,className:wt(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",x,l,{source:!y,target:y,connectable:r,connectablestart:s,connectableend:i,clickconnecting:C,connectingfrom:E,connectingto:I,valid:M,connectionindicator:r&&(!k||P)&&(k||T?i:s)}]),onMouseDown:j,onTouchStart:j,onClick:v?R:void 0,ref:f,...p,children:c})}const Ns=_.memo(t5(nne));function rne({data:t,isConnectable:e,sourcePosition:n=ve.Bottom}){return h.jsxs(h.Fragment,{children:[t?.label,h.jsx(Ns,{type:"source",position:n,isConnectable:e})]})}function sne({data:t,isConnectable:e,targetPosition:n=ve.Top,sourcePosition:r=ve.Bottom}){return h.jsxs(h.Fragment,{children:[h.jsx(Ns,{type:"target",position:n,isConnectable:e}),t?.label,h.jsx(Ns,{type:"source",position:r,isConnectable:e})]})}function ine(){return null}function one({data:t,isConnectable:e,targetPosition:n=ve.Top}){return h.jsxs(h.Fragment,{children:[h.jsx(Ns,{type:"target",position:n,isConnectable:e}),t?.label]})}const Sd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},$P={input:rne,default:sne,output:one,group:ine};function ane(t){return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??t.style?.width,height:t.height??t.initialHeight??t.style?.height}:{width:t.width??t.style?.width,height:t.height??t.style?.height}}const cne=t=>{const{width:e,height:n,x:r,y:s}=Mc(t.nodeLookup,{filter:i=>!!i.selected});return{width:yr(e)?e:null,height:yr(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${s}px)`}};function lne({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=ot(),{width:s,height:i,transformString:o,userSelectionActive:a}=Fe(cne,it),c=s5(),l=_.useRef(null);if(_.useEffect(()=>{n||l.current?.focus({preventScroll:!0})},[n]),r5({nodeRef:l}),a||!s||!i)return null;const d=t?p=>{const f=r.getState().nodes.filter(m=>m.selected);t(p,f)}:void 0,u=p=>{Object.prototype.hasOwnProperty.call(Sd,p.key)&&(p.preventDefault(),c({direction:Sd[p.key],factor:p.shiftKey?4:1}))};return h.jsx("div",{className:wt(["react-flow__nodesselection","react-flow__container",e]),style:{transform:o},children:h.jsx("div",{ref:l,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:n?void 0:-1,onKeyDown:n?void 0:u,style:{width:s,height:i}})})}const zP=typeof window<"u"?window:void 0,dne=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function o5({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:s,onPaneContextMenu:i,onPaneScroll:o,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:l,selectionOnDrag:d,selectionMode:u,onSelectionStart:p,onSelectionEnd:f,multiSelectionKeyCode:m,panActivationKeyCode:y,zoomActivationKeyCode:S,elementsSelectable:g,zoomOnScroll:v,zoomOnPinch:x,panOnScroll:b,panOnScrollSpeed:E,panOnScrollMode:I,zoomOnDoubleClick:C,panOnDrag:P,defaultViewport:k,translateExtent:T,minZoom:M,maxZoom:A,preventScrolling:j,onSelectionContextMenu:R,noWheelClassName:L,noPanClassName:F,disableKeyboardA11y:H,onViewportChange:B,isControlledViewport:$}){const{nodesSelectionActive:Q,userSelectionActive:Z}=Fe(dne,it),ee=cc(l,{target:zP}),ne=cc(y,{target:zP}),N=ne||P,D=ne||b,q=d&&N!==!0,U=ee||Z||q;return Hte({deleteKeyCode:c,multiSelectionKeyCode:m}),h.jsx(Vte,{onPaneContextMenu:i,elementsSelectable:g,zoomOnScroll:v,zoomOnPinch:x,panOnScroll:D,panOnScrollSpeed:E,panOnScrollMode:I,zoomOnDoubleClick:C,panOnDrag:!ee&&N,defaultViewport:k,translateExtent:T,minZoom:M,maxZoom:A,zoomActivationKeyCode:S,preventScrolling:j,noWheelClassName:L,noPanClassName:F,onViewportChange:B,isControlledViewport:$,paneClickDistance:a,selectionOnDrag:q,children:h.jsxs(Zte,{onSelectionStart:p,onSelectionEnd:f,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:s,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:N,isSelecting:!!U,selectionMode:u,selectionKeyPressed:ee,paneClickDistance:a,selectionOnDrag:q,children:[t,Q&&h.jsx(lne,{onSelectionContextMenu:R,noPanClassName:F,disableKeyboardA11y:H})]})})}o5.displayName="FlowRenderer";const une=_.memo(o5),hne=t=>e=>t?Vw(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function pne(t){return Fe(_.useCallback(hne(t),[t]),it)}const fne=t=>t.updateNodeInternals;function gne(){const t=Fe(fne),[e]=_.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(s=>{const i=s.target.getAttribute("data-id");r.set(i,{id:i,nodeElement:s.target,force:!0})}),t(r)}));return _.useEffect(()=>()=>{e?.disconnect()},[e]),e}function mne({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const s=ot(),i=_.useRef(null),o=_.useRef(null),a=_.useRef(t.sourcePosition),c=_.useRef(t.targetPosition),l=_.useRef(e),d=n&&!!t.internals.handleBounds;return _.useEffect(()=>{i.current&&!t.hidden&&(!d||o.current!==i.current)&&(o.current&&r?.unobserve(o.current),r?.observe(i.current),o.current=i.current)},[d,t.hidden]),_.useEffect(()=>()=>{o.current&&(r?.unobserve(o.current),o.current=null)},[]),_.useEffect(()=>{if(i.current){const u=l.current!==e,p=a.current!==t.sourcePosition,f=c.current!==t.targetPosition;(u||p||f)&&(l.current=e,a.current=t.sourcePosition,c.current=t.targetPosition,s.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:i.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),i}function yne({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:s,onContextMenu:i,onDoubleClick:o,nodesDraggable:a,elementsSelectable:c,nodesConnectable:l,nodesFocusable:d,resizeObserver:u,noDragClassName:p,noPanClassName:f,disableKeyboardA11y:m,rfId:y,nodeTypes:S,nodeClickDistance:g,onError:v}){const{node:x,internals:b,isParent:E}=Fe(V=>{const te=V.nodeLookup.get(t),ie=V.parentLookup.has(t);return{node:te,internals:te.internals,isParent:ie}},it);let I=x.type||"default",C=S?.[I]||$P[I];C===void 0&&(v?.("003",Ur.error003(I)),I="default",C=S?.default||$P.default);const P=!!(x.draggable||a&&typeof x.draggable>"u"),k=!!(x.selectable||c&&typeof x.selectable>"u"),T=!!(x.connectable||l&&typeof x.connectable>"u"),M=!!(x.focusable||d&&typeof x.focusable>"u"),A=ot(),j=P3(x),R=mne({node:x,nodeType:I,hasDimensions:j,resizeObserver:u}),L=r5({nodeRef:R,disabled:x.hidden||!P,noDragClassName:p,handleSelector:x.dragHandle,nodeId:t,isSelectable:k,nodeClickDistance:g}),F=s5();if(x.hidden)return null;const H=bs(x),B=ane(x),$=k||P||e||n||r||s,Q=n?V=>n(V,{...b.userNode}):void 0,Z=r?V=>r(V,{...b.userNode}):void 0,ee=s?V=>s(V,{...b.userNode}):void 0,ne=i?V=>i(V,{...b.userNode}):void 0,N=o?V=>o(V,{...b.userNode}):void 0,D=V=>{const{selectNodesOnDrag:te,nodeDragThreshold:ie}=A.getState();k&&(!te||!P||ie>0)&&db({id:t,store:A,nodeRef:R}),e&&e(V,{...b.userNode})},q=V=>{if(!(T3(V.nativeEvent)||m)){if(y3.includes(V.key)&&k){const te=V.key==="Escape";db({id:t,store:A,unselect:te,nodeRef:R})}else if(P&&x.selected&&Object.prototype.hasOwnProperty.call(Sd,V.key)){V.preventDefault();const{ariaLabelConfig:te}=A.getState();A.setState({ariaLiveMessage:te["node.a11yDescription.ariaLiveMessage"]({direction:V.key.replace("Arrow","").toLowerCase(),x:~~b.positionAbsolute.x,y:~~b.positionAbsolute.y})}),F({direction:Sd[V.key],factor:V.shiftKey?4:1})}}},U=()=>{if(m||!R.current?.matches(":focus-visible"))return;const{transform:V,width:te,height:ie,autoPanOnNodeFocus:oe,setCenter:ue}=A.getState();if(!oe)return;Vw(new Map([[t,x]]),{x:0,y:0,width:te,height:ie},V,!0).length>0||ue(x.position.x+H.width/2,x.position.y+H.height/2,{zoom:V[2]})};return h.jsx("div",{className:wt(["react-flow__node",`react-flow__node-${I}`,{[f]:P},x.className,{selected:x.selected,selectable:k,parent:E,draggable:P,dragging:L}]),ref:R,style:{zIndex:b.z,transform:`translate(${b.positionAbsolute.x}px,${b.positionAbsolute.y}px)`,pointerEvents:$?"all":"none",visibility:j?"visible":"hidden",...x.style,...B},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:Q,onMouseMove:Z,onMouseLeave:ee,onContextMenu:ne,onClick:D,onDoubleClick:N,onKeyDown:M?q:void 0,tabIndex:M?0:void 0,onFocus:M?U:void 0,role:x.ariaRole??(M?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${Y3}-${y}`,"aria-label":x.ariaLabel,...x.domAttributes,children:h.jsx(Jte,{value:t,children:h.jsx(C,{id:t,data:x.data,type:I,positionAbsoluteX:b.positionAbsolute.x,positionAbsoluteY:b.positionAbsolute.y,selected:x.selected??!1,selectable:k,draggable:P,deletable:x.deletable??!0,isConnectable:T,sourcePosition:x.sourcePosition,targetPosition:x.targetPosition,dragging:L,dragHandle:x.dragHandle,zIndex:b.z,parentId:x.parentId,...H})})})}var Sne=_.memo(yne);const vne=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function a5(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:s,onError:i}=Fe(vne,it),o=pne(t.onlyRenderVisibleElements),a=gne();return h.jsx("div",{className:"react-flow__nodes",style:pu,children:o.map(c=>h.jsx(Sne,{id:c,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:a,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:s,nodeClickDistance:t.nodeClickDistance,onError:i},c))})}a5.displayName="NodeRenderer";const xne=_.memo(a5);function bne(t){return Fe(_.useCallback(n=>{if(!t)return n.edges.map(s=>s.id);const r=[];if(n.width&&n.height)for(const s of n.edges){const i=n.nodeLookup.get(s.source),o=n.nodeLookup.get(s.target);i&&o&&wee({sourceNode:i,targetNode:o,width:n.width,height:n.height,transform:n.transform})&&r.push(s.id)}return r},[t]),it)}const wne=({color:t="none",strokeWidth:e=1})=>{const n={strokeWidth:e,...t&&{stroke:t}};return h.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Cne=({color:t="none",strokeWidth:e=1})=>{const n={strokeWidth:e,...t&&{stroke:t,fill:t}};return h.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},UP={[Io.Arrow]:wne,[Io.ArrowClosed]:Cne};function _ne(t){const e=ot();return _.useMemo(()=>Object.prototype.hasOwnProperty.call(UP,t)?UP[t]:(e.getState().onError?.("009",Ur.error009(t)),null),[t])}const Ine=({id:t,type:e,color:n,width:r=12.5,height:s=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{const c=_ne(e);return c?h.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:h.jsx(c,{color:n,strokeWidth:o})}):null},c5=({defaultColor:t,rfId:e})=>{const n=Fe(i=>i.edges),r=Fe(i=>i.defaultEdgeOptions),s=_.useMemo(()=>Tee(n,{id:e,defaultColor:t,defaultMarkerStart:r?.markerStart,defaultMarkerEnd:r?.markerEnd}),[n,r,e,t]);return s.length?h.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:h.jsx("defs",{children:s.map(i=>h.jsx(Ine,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};c5.displayName="MarkerDefinitions";var Pne=_.memo(c5);function l5({x:t,y:e,label:n,labelStyle:r,labelShowBg:s=!0,labelBgStyle:i,labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:c,className:l,...d}){const[u,p]=_.useState({x:1,y:0,width:0,height:0}),f=wt(["react-flow__edge-textwrapper",l]),m=_.useRef(null);return _.useEffect(()=>{if(m.current){const y=m.current.getBBox();p({x:y.x,y:y.y,width:y.width,height:y.height})}},[n]),n?h.jsxs("g",{transform:`translate(${t-u.width/2} ${e-u.height/2})`,className:f,visibility:u.width?"visible":"hidden",...d,children:[s&&h.jsx("rect",{width:u.width+2*o[0],x:-o[0],y:-o[1],height:u.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),h.jsx("text",{className:"react-flow__edge-text",y:u.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]}):null}l5.displayName="EdgeText";const Ene=_.memo(l5);function fu({path:t,labelX:e,labelY:n,label:r,labelStyle:s,labelShowBg:i,labelBgStyle:o,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:l=20,...d}){return h.jsxs(h.Fragment,{children:[h.jsx("path",{...d,d:t,fill:"none",className:wt(["react-flow__edge-path",d.className])}),l?h.jsx("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:l,className:"react-flow__edge-interaction"}):null,r&&yr(e)&&yr(n)?h.jsx(Ene,{x:e,y:n,label:r,labelStyle:s,labelShowBg:i,labelBgStyle:o,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function qP({pos:t,x1:e,y1:n,x2:r,y2:s}){return t===ve.Left||t===ve.Right?[.5*(e+r),n]:[e,.5*(n+s)]}function d5({sourceX:t,sourceY:e,sourcePosition:n=ve.Bottom,targetX:r,targetY:s,targetPosition:i=ve.Top}){const[o,a]=qP({pos:n,x1:t,y1:e,x2:r,y2:s}),[c,l]=qP({pos:i,x1:r,y1:s,x2:t,y2:e}),[d,u,p,f]=A3({sourceX:t,sourceY:e,targetX:r,targetY:s,sourceControlX:o,sourceControlY:a,targetControlX:c,targetControlY:l});return[`M${t},${e} C${o},${a} ${c},${l} ${r},${s}`,d,u,p,f]}function u5(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:s,targetY:i,sourcePosition:o,targetPosition:a,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:S,interactionWidth:g})=>{const[v,x,b]=d5({sourceX:n,sourceY:r,sourcePosition:o,targetX:s,targetY:i,targetPosition:a}),E=t.isInternal?void 0:e;return h.jsx(fu,{id:E,path:v,labelX:x,labelY:b,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:S,interactionWidth:g})})}const kne=u5({isInternal:!1}),h5=u5({isInternal:!0});kne.displayName="SimpleBezierEdge";h5.displayName="SimpleBezierEdgeInternal";function p5(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:s,targetY:i,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:p,sourcePosition:f=ve.Bottom,targetPosition:m=ve.Top,markerEnd:y,markerStart:S,pathOptions:g,interactionWidth:v})=>{const[x,b,E]=ob({sourceX:n,sourceY:r,sourcePosition:f,targetX:s,targetY:i,targetPosition:m,borderRadius:g?.borderRadius,offset:g?.offset,stepPosition:g?.stepPosition}),I=t.isInternal?void 0:e;return h.jsx(fu,{id:I,path:x,labelX:b,labelY:E,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:p,markerEnd:y,markerStart:S,interactionWidth:v})})}const f5=p5({isInternal:!1}),g5=p5({isInternal:!0});f5.displayName="SmoothStepEdge";g5.displayName="SmoothStepEdgeInternal";function m5(t){return _.memo(({id:e,...n})=>{const r=t.isInternal?void 0:e;return h.jsx(f5,{...n,id:r,pathOptions:_.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])})})}const Tne=m5({isInternal:!1}),y5=m5({isInternal:!0});Tne.displayName="StepEdge";y5.displayName="StepEdgeInternal";function S5(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:s,targetY:i,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:p,markerEnd:f,markerStart:m,interactionWidth:y})=>{const[S,g,v]=D3({sourceX:n,sourceY:r,targetX:s,targetY:i}),x=t.isInternal?void 0:e;return h.jsx(fu,{id:x,path:S,labelX:g,labelY:v,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:p,markerEnd:f,markerStart:m,interactionWidth:y})})}const Mne=S5({isInternal:!1}),v5=S5({isInternal:!0});Mne.displayName="StraightEdge";v5.displayName="StraightEdgeInternal";function x5(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:s,targetY:i,sourcePosition:o=ve.Bottom,targetPosition:a=ve.Top,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:S,pathOptions:g,interactionWidth:v})=>{const[x,b,E]=j3({sourceX:n,sourceY:r,sourcePosition:o,targetX:s,targetY:i,targetPosition:a,curvature:g?.curvature}),I=t.isInternal?void 0:e;return h.jsx(fu,{id:I,path:x,labelX:b,labelY:E,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:S,interactionWidth:v})})}const Ane=x5({isInternal:!1}),b5=x5({isInternal:!0});Ane.displayName="BezierEdge";b5.displayName="BezierEdgeInternal";const HP={default:b5,straight:v5,step:y5,smoothstep:g5,simplebezier:h5},GP={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},jne=(t,e,n)=>n===ve.Left?t-e:n===ve.Right?t+e:t,Rne=(t,e,n)=>n===ve.Top?t-e:n===ve.Bottom?t+e:t,KP="react-flow__edgeupdater";function VP({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:s,onMouseEnter:i,onMouseOut:o,type:a}){return h.jsx("circle",{onMouseDown:s,onMouseEnter:i,onMouseOut:o,className:wt([KP,`${KP}-${a}`]),cx:jne(e,r,t),cy:Rne(n,r,t),r,stroke:"transparent",fill:"transparent"})}function One({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:s,targetX:i,targetY:o,sourcePosition:a,targetPosition:c,onReconnect:l,onReconnectStart:d,onReconnectEnd:u,setReconnecting:p,setUpdateHover:f}){const m=ot(),y=(b,E)=>{if(b.button!==0)return;const{autoPanOnConnect:I,domNode:C,isValidConnection:P,connectionMode:k,connectionRadius:T,lib:M,onConnectStart:A,onConnectEnd:j,cancelConnection:R,nodeLookup:L,rfId:F,panBy:H,updateConnection:B}=m.getState(),$=E.type==="target",Q=(ne,N)=>{p(!1),u?.(ne,n,E.type,N)},Z=ne=>l?.(n,ne),ee=(ne,N)=>{p(!0),d?.(b,n,E.type),A?.(ne,N)};lb.onPointerDown(b.nativeEvent,{autoPanOnConnect:I,connectionMode:k,connectionRadius:T,domNode:C,handleId:E.id,nodeId:E.nodeId,nodeLookup:L,isTarget:$,edgeUpdaterType:E.type,lib:M,flowId:F,cancelConnection:R,panBy:H,isValidConnection:P,onConnect:Z,onConnectStart:ee,onConnectEnd:j,onReconnectEnd:Q,updateConnection:B,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold,handleDomNode:b.currentTarget})},S=b=>y(b,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),g=b=>y(b,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>f(!0),x=()=>f(!1);return h.jsxs(h.Fragment,{children:[(t===!0||t==="source")&&h.jsx(VP,{position:a,centerX:r,centerY:s,radius:e,onMouseDown:S,onMouseEnter:v,onMouseOut:x,type:"source"}),(t===!0||t==="target")&&h.jsx(VP,{position:c,centerX:i,centerY:o,radius:e,onMouseDown:g,onMouseEnter:v,onMouseOut:x,type:"target"})]})}function Dne({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:s,onDoubleClick:i,onContextMenu:o,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,reconnectRadius:d,onReconnect:u,onReconnectStart:p,onReconnectEnd:f,rfId:m,edgeTypes:y,noPanClassName:S,onError:g,disableKeyboardA11y:v}){let x=Fe(ue=>ue.edgeLookup.get(t));const b=Fe(ue=>ue.defaultEdgeOptions);x=b?{...b,...x}:x;let E=x.type||"default",I=y?.[E]||HP[E];I===void 0&&(g?.("011",Ur.error011(E)),E="default",I=y?.default||HP.default);const C=!!(x.focusable||e&&typeof x.focusable>"u"),P=typeof u<"u"&&(x.reconnectable||n&&typeof x.reconnectable>"u"),k=!!(x.selectable||r&&typeof x.selectable>"u"),T=_.useRef(null),[M,A]=_.useState(!1),[j,R]=_.useState(!1),L=ot(),{zIndex:F,sourceX:H,sourceY:B,targetX:$,targetY:Q,sourcePosition:Z,targetPosition:ee}=Fe(_.useCallback(ue=>{const de=ue.nodeLookup.get(x.source),ge=ue.nodeLookup.get(x.target);if(!de||!ge)return{zIndex:x.zIndex,...GP};const le=kee({id:t,sourceNode:de,targetNode:ge,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:ue.connectionMode,onError:g});return{zIndex:bee({selected:x.selected,zIndex:x.zIndex,sourceNode:de,targetNode:ge,elevateOnSelect:ue.elevateEdgesOnSelect,zIndexMode:ue.zIndexMode}),...le||GP}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),it),ne=_.useMemo(()=>x.markerStart?`url('#${ab(x.markerStart,m)}')`:void 0,[x.markerStart,m]),N=_.useMemo(()=>x.markerEnd?`url('#${ab(x.markerEnd,m)}')`:void 0,[x.markerEnd,m]);if(x.hidden||H===null||B===null||$===null||Q===null)return null;const D=ue=>{const{addSelectedEdges:de,unselectNodesAndEdges:ge,multiSelectionActive:le}=L.getState();k&&(L.setState({nodesSelectionActive:!1}),x.selected&&le?(ge({nodes:[],edges:[x]}),T.current?.blur()):de([t])),s&&s(ue,x)},q=i?ue=>{i(ue,{...x})}:void 0,U=o?ue=>{o(ue,{...x})}:void 0,V=a?ue=>{a(ue,{...x})}:void 0,te=c?ue=>{c(ue,{...x})}:void 0,ie=l?ue=>{l(ue,{...x})}:void 0,oe=ue=>{if(!v&&y3.includes(ue.key)&&k){const{unselectNodesAndEdges:de,addSelectedEdges:ge}=L.getState();ue.key==="Escape"?(T.current?.blur(),de({edges:[x]})):ge([t])}};return h.jsx("svg",{style:{zIndex:F},children:h.jsxs("g",{className:wt(["react-flow__edge",`react-flow__edge-${E}`,x.className,S,{selected:x.selected,animated:x.animated,inactive:!k&&!s,updating:M,selectable:k}]),onClick:D,onDoubleClick:q,onContextMenu:U,onMouseEnter:V,onMouseMove:te,onMouseLeave:ie,onKeyDown:C?oe:void 0,tabIndex:C?0:void 0,role:x.ariaRole??(C?"group":"img"),"aria-roledescription":"edge","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":C?`${X3}-${m}`:void 0,ref:T,...x.domAttributes,children:[!j&&h.jsx(I,{id:t,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:k,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:H,sourceY:B,targetX:$,targetY:Q,sourcePosition:Z,targetPosition:ee,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:ne,markerEnd:N,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),P&&h.jsx(One,{edge:x,isReconnectable:P,reconnectRadius:d,onReconnect:u,onReconnectStart:p,onReconnectEnd:f,sourceX:H,sourceY:B,targetX:$,targetY:Q,sourcePosition:Z,targetPosition:ee,setUpdateHover:A,setReconnecting:R})]})})}var Lne=_.memo(Dne);const Nne=t=>({edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function w5({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:s,onReconnect:i,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:d,reconnectRadius:u,onEdgeDoubleClick:p,onReconnectStart:f,onReconnectEnd:m,disableKeyboardA11y:y}){const{edgesFocusable:S,edgesReconnectable:g,elementsSelectable:v,onError:x}=Fe(Nne,it),b=bne(e);return h.jsxs("div",{className:"react-flow__edges",children:[h.jsx(Pne,{defaultColor:t,rfId:n}),b.map(E=>h.jsx(Lne,{id:E,edgesFocusable:S,edgesReconnectable:g,elementsSelectable:v,noPanClassName:s,onReconnect:i,onContextMenu:o,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,onClick:d,reconnectRadius:u,onDoubleClick:p,onReconnectStart:f,onReconnectEnd:m,rfId:n,onError:x,edgeTypes:r,disableKeyboardA11y:y},E))]})}w5.displayName="EdgeRenderer";const Fne=_.memo(w5),Bne=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function $ne({children:t}){const e=Fe(Bne);return h.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function zne(t){const e=t0(),n=_.useRef(!1);_.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const Une=t=>t.panZoom?.syncViewport;function qne(t){const e=Fe(Une),n=ot();return _.useEffect(()=>{t&&(e?.(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function Hne(t){return t.connection.inProgress?{...t.connection,to:jc(t.connection.to,t.transform)}:{...t.connection}}function Gne(t){return Hne}function Kne(t){const e=Gne();return Fe(e,it)}const Vne=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function Wne({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:s,width:i,height:o,isValid:a,inProgress:c}=Fe(Vne,it);return!(i&&s&&c)?null:h.jsx("svg",{style:t,width:i,height:o,className:"react-flow__connectionline react-flow__container",children:h.jsx("g",{className:wt(["react-flow__connection",x3(a)]),children:h.jsx(C5,{style:e,type:n,CustomComponent:r,isValid:a})})})}const C5=({style:t,type:e=js.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:s,from:i,fromNode:o,fromHandle:a,fromPosition:c,to:l,toNode:d,toHandle:u,toPosition:p,pointer:f}=Kne();if(!s)return;if(n)return h.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:o,fromHandle:a,fromX:i.x,fromY:i.y,toX:l.x,toY:l.y,fromPosition:c,toPosition:p,connectionStatus:x3(r),toNode:d,toHandle:u,pointer:f});let m="";const y={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:l.x,targetY:l.y,targetPosition:p};switch(e){case js.Bezier:[m]=j3(y);break;case js.SimpleBezier:[m]=d5(y);break;case js.Step:[m]=ob({...y,borderRadius:0});break;case js.SmoothStep:[m]=ob(y);break;default:[m]=D3(y)}return h.jsx("path",{d:m,fill:"none",className:"react-flow__connection-path",style:t})};C5.displayName="ConnectionLine";const Yne={};function WP(t=Yne){_.useRef(t),ot(),_.useEffect(()=>{},[t])}function Xne(){ot(),_.useRef(!1),_.useEffect(()=>{},[])}function _5({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:s,onNodeDoubleClick:i,onEdgeDoubleClick:o,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:d,onSelectionContextMenu:u,onSelectionStart:p,onSelectionEnd:f,connectionLineType:m,connectionLineStyle:y,connectionLineComponent:S,connectionLineContainerStyle:g,selectionKeyCode:v,selectionOnDrag:x,selectionMode:b,multiSelectionKeyCode:E,panActivationKeyCode:I,zoomActivationKeyCode:C,deleteKeyCode:P,onlyRenderVisibleElements:k,elementsSelectable:T,defaultViewport:M,translateExtent:A,minZoom:j,maxZoom:R,preventScrolling:L,defaultMarkerColor:F,zoomOnScroll:H,zoomOnPinch:B,panOnScroll:$,panOnScrollSpeed:Q,panOnScrollMode:Z,zoomOnDoubleClick:ee,panOnDrag:ne,onPaneClick:N,onPaneMouseEnter:D,onPaneMouseMove:q,onPaneMouseLeave:U,onPaneScroll:V,onPaneContextMenu:te,paneClickDistance:ie,nodeClickDistance:oe,onEdgeContextMenu:ue,onEdgeMouseEnter:de,onEdgeMouseMove:ge,onEdgeMouseLeave:le,reconnectRadius:xe,onReconnect:me,onReconnectStart:et,onReconnectEnd:ht,noDragClassName:Kt,noWheelClassName:Vt,noPanClassName:It,disableKeyboardA11y:tt,nodeExtent:Gn,rfId:jn,viewport:Kn,onViewportChange:cn}){return WP(t),WP(e),Xne(),zne(n),qne(Kn),h.jsx(une,{onPaneClick:N,onPaneMouseEnter:D,onPaneMouseMove:q,onPaneMouseLeave:U,onPaneContextMenu:te,onPaneScroll:V,paneClickDistance:ie,deleteKeyCode:P,selectionKeyCode:v,selectionOnDrag:x,selectionMode:b,onSelectionStart:p,onSelectionEnd:f,multiSelectionKeyCode:E,panActivationKeyCode:I,zoomActivationKeyCode:C,elementsSelectable:T,zoomOnScroll:H,zoomOnPinch:B,zoomOnDoubleClick:ee,panOnScroll:$,panOnScrollSpeed:Q,panOnScrollMode:Z,panOnDrag:ne,defaultViewport:M,translateExtent:A,minZoom:j,maxZoom:R,onSelectionContextMenu:u,preventScrolling:L,noDragClassName:Kt,noWheelClassName:Vt,noPanClassName:It,disableKeyboardA11y:tt,onViewportChange:cn,isControlledViewport:!!Kn,children:h.jsxs($ne,{children:[h.jsx(Fne,{edgeTypes:e,onEdgeClick:s,onEdgeDoubleClick:o,onReconnect:me,onReconnectStart:et,onReconnectEnd:ht,onlyRenderVisibleElements:k,onEdgeContextMenu:ue,onEdgeMouseEnter:de,onEdgeMouseMove:ge,onEdgeMouseLeave:le,reconnectRadius:xe,defaultMarkerColor:F,noPanClassName:It,disableKeyboardA11y:tt,rfId:jn}),h.jsx(Wne,{style:y,type:m,component:S,containerStyle:g}),h.jsx("div",{className:"react-flow__edgelabel-renderer"}),h.jsx(xne,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:d,nodeClickDistance:oe,onlyRenderVisibleElements:k,noPanClassName:It,noDragClassName:Kt,disableKeyboardA11y:tt,nodeExtent:Gn,rfId:jn}),h.jsx("div",{className:"react-flow__viewport-portal"})]})})}_5.displayName="GraphView";const Zne=_.memo(_5),YP=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:s,height:i,fitView:o,fitViewOptions:a,minZoom:c=.5,maxZoom:l=2,nodeOrigin:d,nodeExtent:u,zIndexMode:p="basic"}={})=>{const f=new Map,m=new Map,y=new Map,S=new Map,g=r??e??[],v=n??t??[],x=d??[0,0],b=u??sc;F3(y,S,g);const E=cb(v,f,m,{nodeOrigin:x,nodeExtent:b,zIndexMode:p});let I=[0,0,1];if(o&&s&&i){const C=Mc(f,{filter:M=>!!((M.width||M.initialWidth)&&(M.height||M.initialHeight))}),{x:P,y:k,zoom:T}=Ww(C,s,i,c,l,a?.padding??.1);I=[P,k,T]}return{rfId:"1",width:s??0,height:i??0,transform:I,nodes:v,nodesInitialized:E,nodeLookup:f,parentLookup:m,edges:g,edgeLookup:S,connectionLookup:y,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:l,translateExtent:sc,nodeExtent:b,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:_o.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:o??!1,fitViewOptions:a,fitViewResolver:null,connection:{...v3},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:gee,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:S3,zIndexMode:p,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Qne=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:s,height:i,fitView:o,fitViewOptions:a,minZoom:c,maxZoom:l,nodeOrigin:d,nodeExtent:u,zIndexMode:p})=>mte((f,m)=>{async function y(){const{nodeLookup:S,panZoom:g,fitViewOptions:v,fitViewResolver:x,width:b,height:E,minZoom:I,maxZoom:C}=m();g&&(await pee({nodes:S,width:b,height:E,panZoom:g,minZoom:I,maxZoom:C},v),x?.resolve(!0),f({fitViewResolver:null}))}return{...YP({nodes:t,edges:e,width:s,height:i,fitView:o,fitViewOptions:a,minZoom:c,maxZoom:l,nodeOrigin:d,nodeExtent:u,defaultNodes:n,defaultEdges:r,zIndexMode:p}),setNodes:S=>{const{nodeLookup:g,parentLookup:v,nodeOrigin:x,elevateNodesOnSelect:b,fitViewQueued:E,zIndexMode:I}=m(),C=cb(S,g,v,{nodeOrigin:x,nodeExtent:u,elevateNodesOnSelect:b,checkEquality:!0,zIndexMode:I});E&&C?(y(),f({nodes:S,nodesInitialized:C,fitViewQueued:!1,fitViewOptions:void 0})):f({nodes:S,nodesInitialized:C})},setEdges:S=>{const{connectionLookup:g,edgeLookup:v}=m();F3(g,v,S),f({edges:S})},setDefaultNodesAndEdges:(S,g)=>{if(S){const{setNodes:v}=m();v(S),f({hasDefaultNodes:!0})}if(g){const{setEdges:v}=m();v(g),f({hasDefaultEdges:!0})}},updateNodeInternals:S=>{const{triggerNodeChanges:g,nodeLookup:v,parentLookup:x,domNode:b,nodeOrigin:E,nodeExtent:I,debug:C,fitViewQueued:P,zIndexMode:k}=m(),{changes:T,updatedInternals:M}=Lee(S,v,x,b,E,I,k);M&&(jee(v,x,{nodeOrigin:E,nodeExtent:I,zIndexMode:k}),P?(y(),f({fitViewQueued:!1,fitViewOptions:void 0})):f({}),T?.length>0&&(C&&console.log("React Flow: trigger node changes",T),g?.(T)))},updateNodePositions:(S,g=!1)=>{const v=[];let x=[];const{nodeLookup:b,triggerNodeChanges:E,connection:I,updateConnection:C,onNodesChangeMiddlewareMap:P}=m();for(const[k,T]of S){const M=b.get(k),A=!!(M?.expandParent&&M?.parentId&&T?.position),j={id:k,type:"position",position:A?{x:Math.max(0,T.position.x),y:Math.max(0,T.position.y)}:T.position,dragging:g};if(M&&I.inProgress&&I.fromNode.id===M.id){const R=Ai(M,I.fromHandle,ve.Left,!0);C({...I,from:R})}A&&M.parentId&&v.push({id:k,parentId:M.parentId,rect:{...T.internals.positionAbsolute,width:T.measured.width??0,height:T.measured.height??0}}),x.push(j)}if(v.length>0){const{parentLookup:k,nodeOrigin:T}=m(),M=e0(v,b,k,T);x.push(...M)}for(const k of P.values())x=k(x);E(x)},triggerNodeChanges:S=>{const{onNodesChange:g,setNodes:v,nodes:x,hasDefaultNodes:b,debug:E}=m();if(S?.length){if(b){const I=J3(S,x);v(I)}E&&console.log("React Flow: trigger node changes",S),g?.(S)}},triggerEdgeChanges:S=>{const{onEdgesChange:g,setEdges:v,edges:x,hasDefaultEdges:b,debug:E}=m();if(S?.length){if(b){const I=e5(S,x);v(I)}E&&console.log("React Flow: trigger edge changes",S),g?.(S)}},addSelectedNodes:S=>{const{multiSelectionActive:g,edgeLookup:v,nodeLookup:x,triggerNodeChanges:b,triggerEdgeChanges:E}=m();if(g){const I=S.map(C=>pi(C,!0));b(I);return}b(ho(x,new Set([...S]),!0)),E(ho(v))},addSelectedEdges:S=>{const{multiSelectionActive:g,edgeLookup:v,nodeLookup:x,triggerNodeChanges:b,triggerEdgeChanges:E}=m();if(g){const I=S.map(C=>pi(C,!0));E(I);return}E(ho(v,new Set([...S]))),b(ho(x,new Set,!0))},unselectNodesAndEdges:({nodes:S,edges:g}={})=>{const{edges:v,nodes:x,nodeLookup:b,triggerNodeChanges:E,triggerEdgeChanges:I}=m(),C=S||x,P=g||v,k=C.map(M=>{const A=b.get(M.id);return A&&(A.selected=!1),pi(M.id,!1)}),T=P.map(M=>pi(M.id,!1));E(k),I(T)},setMinZoom:S=>{const{panZoom:g,maxZoom:v}=m();g?.setScaleExtent([S,v]),f({minZoom:S})},setMaxZoom:S=>{const{panZoom:g,minZoom:v}=m();g?.setScaleExtent([v,S]),f({maxZoom:S})},setTranslateExtent:S=>{m().panZoom?.setTranslateExtent(S),f({translateExtent:S})},resetSelectedElements:()=>{const{edges:S,nodes:g,triggerNodeChanges:v,triggerEdgeChanges:x,elementsSelectable:b}=m();if(!b)return;const E=g.reduce((C,P)=>P.selected?[...C,pi(P.id,!1)]:C,[]),I=S.reduce((C,P)=>P.selected?[...C,pi(P.id,!1)]:C,[]);v(E),x(I)},setNodeExtent:S=>{const{nodes:g,nodeLookup:v,parentLookup:x,nodeOrigin:b,elevateNodesOnSelect:E,nodeExtent:I,zIndexMode:C}=m();S[0][0]===I[0][0]&&S[0][1]===I[0][1]&&S[1][0]===I[1][0]&&S[1][1]===I[1][1]||(cb(g,v,x,{nodeOrigin:b,nodeExtent:S,elevateNodesOnSelect:E,checkEquality:!1,zIndexMode:C}),f({nodeExtent:S}))},panBy:S=>{const{transform:g,width:v,height:x,panZoom:b,translateExtent:E}=m();return Nee({delta:S,panZoom:b,transform:g,translateExtent:E,width:v,height:x})},setCenter:async(S,g,v)=>{const{width:x,height:b,maxZoom:E,panZoom:I}=m();if(!I)return Promise.resolve(!1);const C=typeof v?.zoom<"u"?v.zoom:E;return await I.setViewport({x:x/2-S*C,y:b/2-g*C,zoom:C},{duration:v?.duration,ease:v?.ease,interpolate:v?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{f({connection:{...v3}})},updateConnection:S=>{f({connection:S})},reset:()=>f({...YP()})}},Object.is);function Jne({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:s,initialHeight:i,initialMinZoom:o,initialMaxZoom:a,initialFitViewOptions:c,fitView:l,nodeOrigin:d,nodeExtent:u,zIndexMode:p,children:f}){const[m]=_.useState(()=>Qne({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:s,height:i,fitView:l,minZoom:o,maxZoom:a,fitViewOptions:c,nodeOrigin:d,nodeExtent:u,zIndexMode:p}));return h.jsx(yte,{value:m,children:h.jsx($te,{children:f})})}function ere({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:s,width:i,height:o,fitView:a,fitViewOptions:c,minZoom:l,maxZoom:d,nodeOrigin:u,nodeExtent:p,zIndexMode:f}){return _.useContext(uu)?h.jsx(h.Fragment,{children:t}):h.jsx(Jne,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:s,initialWidth:i,initialHeight:o,fitView:a,initialFitViewOptions:c,initialMinZoom:l,initialMaxZoom:d,nodeOrigin:u,nodeExtent:p,zIndexMode:f,children:t})}const tre={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function nre({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:s,nodeTypes:i,edgeTypes:o,onNodeClick:a,onEdgeClick:c,onInit:l,onMove:d,onMoveStart:u,onMoveEnd:p,onConnect:f,onConnectStart:m,onConnectEnd:y,onClickConnectStart:S,onClickConnectEnd:g,onNodeMouseEnter:v,onNodeMouseMove:x,onNodeMouseLeave:b,onNodeContextMenu:E,onNodeDoubleClick:I,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:k,onNodesDelete:T,onEdgesDelete:M,onDelete:A,onSelectionChange:j,onSelectionDragStart:R,onSelectionDrag:L,onSelectionDragStop:F,onSelectionContextMenu:H,onSelectionStart:B,onSelectionEnd:$,onBeforeDelete:Q,connectionMode:Z,connectionLineType:ee=js.Bezier,connectionLineStyle:ne,connectionLineComponent:N,connectionLineContainerStyle:D,deleteKeyCode:q="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:V=!1,selectionMode:te=ic.Full,panActivationKeyCode:ie="Space",multiSelectionKeyCode:oe=ac()?"Meta":"Control",zoomActivationKeyCode:ue=ac()?"Meta":"Control",snapToGrid:de,snapGrid:ge,onlyRenderVisibleElements:le=!1,selectNodesOnDrag:xe,nodesDraggable:me,autoPanOnNodeFocus:et,nodesConnectable:ht,nodesFocusable:Kt,nodeOrigin:Vt=Z3,edgesFocusable:It,edgesReconnectable:tt,elementsSelectable:Gn=!0,defaultViewport:jn=Mte,minZoom:Kn=.5,maxZoom:cn=2,translateExtent:Wt=sc,preventScrolling:Kr=!0,nodeExtent:Y,defaultMarkerColor:ae="#b1b1b7",zoomOnScroll:Ce=!0,zoomOnPinch:De=!0,panOnScroll:_t=!1,panOnScrollSpeed:gn=.5,panOnScrollMode:si=vi.Free,zoomOnDoubleClick:lr=!0,panOnDrag:dr=!0,onPaneClick:Vn,onPaneMouseEnter:ur,onPaneMouseMove:Vr,onPaneMouseLeave:zi,onPaneScroll:Ko,onPaneContextMenu:ii,paneClickDistance:Vo=1,nodeClickDistance:Wo=0,children:Yo,onReconnect:oi,onReconnectStart:ju,onReconnectEnd:Ru,onEdgeContextMenu:Ou,onEdgeDoubleClick:Du,onEdgeMouseEnter:Lu,onEdgeMouseMove:Fc,onEdgeMouseLeave:Xo,reconnectRadius:Wr=10,onNodesChange:Nu,onEdgesChange:Fu,noDragClassName:Bu="nodrag",noWheelClassName:$u="nowheel",noPanClassName:Bc="nopan",fitView:Wn,fitViewOptions:$c,connectOnClick:zu,attributionPosition:Uu,proOptions:qu,defaultEdgeOptions:Hu,elevateNodesOnSelect:Yr=!0,elevateEdgesOnSelect:Gu=!1,disableKeyboardA11y:zc=!1,autoPanOnConnect:Ku,autoPanOnNodeDrag:Vu,autoPanSpeed:Wu,connectionRadius:Ui,isValidConnection:Yu,onError:Xu,style:Pr,id:Uc,nodeDragThreshold:Zu,connectionDragThreshold:Qu,viewport:Ju,onViewportChange:eh,width:th,height:qi,colorMode:nh="light",debug:ai,onScroll:Zo,ariaLabelConfig:qc,zIndexMode:Hc="basic",...rh},sh){const Qo=Uc||"1",Gc=Ote(nh),ih=_.useCallback(Kc=>{Kc.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Zo?.(Kc)},[Zo]);return h.jsx("div",{"data-testid":"rf__wrapper",...rh,onScroll:ih,style:{...Pr,...tre},ref:sh,className:wt(["react-flow",s,Gc]),id:Uc,role:"application",children:h.jsxs(ere,{nodes:t,edges:e,width:th,height:qi,fitView:Wn,fitViewOptions:$c,minZoom:Kn,maxZoom:cn,nodeOrigin:Vt,nodeExtent:Y,zIndexMode:Hc,children:[h.jsx(Zne,{onInit:l,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:v,onNodeMouseMove:x,onNodeMouseLeave:b,onNodeContextMenu:E,onNodeDoubleClick:I,nodeTypes:i,edgeTypes:o,connectionLineType:ee,connectionLineStyle:ne,connectionLineComponent:N,connectionLineContainerStyle:D,selectionKeyCode:U,selectionOnDrag:V,selectionMode:te,deleteKeyCode:q,multiSelectionKeyCode:oe,panActivationKeyCode:ie,zoomActivationKeyCode:ue,onlyRenderVisibleElements:le,defaultViewport:jn,translateExtent:Wt,minZoom:Kn,maxZoom:cn,preventScrolling:Kr,zoomOnScroll:Ce,zoomOnPinch:De,zoomOnDoubleClick:lr,panOnScroll:_t,panOnScrollSpeed:gn,panOnScrollMode:si,panOnDrag:dr,onPaneClick:Vn,onPaneMouseEnter:ur,onPaneMouseMove:Vr,onPaneMouseLeave:zi,onPaneScroll:Ko,onPaneContextMenu:ii,paneClickDistance:Vo,nodeClickDistance:Wo,onSelectionContextMenu:H,onSelectionStart:B,onSelectionEnd:$,onReconnect:oi,onReconnectStart:ju,onReconnectEnd:Ru,onEdgeContextMenu:Ou,onEdgeDoubleClick:Du,onEdgeMouseEnter:Lu,onEdgeMouseMove:Fc,onEdgeMouseLeave:Xo,reconnectRadius:Wr,defaultMarkerColor:ae,noDragClassName:Bu,noWheelClassName:$u,noPanClassName:Bc,rfId:Qo,disableKeyboardA11y:zc,nodeExtent:Y,viewport:Ju,onViewportChange:eh}),h.jsx(Rte,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:f,onConnectStart:m,onConnectEnd:y,onClickConnectStart:S,onClickConnectEnd:g,nodesDraggable:me,autoPanOnNodeFocus:et,nodesConnectable:ht,nodesFocusable:Kt,edgesFocusable:It,edgesReconnectable:tt,elementsSelectable:Gn,elevateNodesOnSelect:Yr,elevateEdgesOnSelect:Gu,minZoom:Kn,maxZoom:cn,nodeExtent:Y,onNodesChange:Nu,onEdgesChange:Fu,snapToGrid:de,snapGrid:ge,connectionMode:Z,translateExtent:Wt,connectOnClick:zu,defaultEdgeOptions:Hu,fitView:Wn,fitViewOptions:$c,onNodesDelete:T,onEdgesDelete:M,onDelete:A,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:k,onSelectionDrag:L,onSelectionDragStart:R,onSelectionDragStop:F,onMove:d,onMoveStart:u,onMoveEnd:p,noPanClassName:Bc,nodeOrigin:Vt,rfId:Qo,autoPanOnConnect:Ku,autoPanOnNodeDrag:Vu,autoPanSpeed:Wu,onError:Xu,connectionRadius:Ui,isValidConnection:Yu,selectNodesOnDrag:xe,nodeDragThreshold:Zu,connectionDragThreshold:Qu,onBeforeDelete:Q,debug:ai,ariaLabelConfig:qc,zIndexMode:Hc}),h.jsx(Tte,{onSelectionChange:j}),Yo,h.jsx(_te,{proOptions:qu,position:Uu}),h.jsx(Cte,{rfId:Qo,disableKeyboardA11y:zc})]})})}var rre=t5(nre);function sre(t){const[e,n]=_.useState(t),r=_.useCallback(s=>n(i=>J3(s,i)),[]);return[e,n,r]}function ire(t){const[e,n]=_.useState(t),r=_.useCallback(s=>n(i=>e5(s,i)),[]);return[e,n,r]}function ore({dimensions:t,lineWidth:e,variant:n,className:r}){return h.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:wt(["react-flow__background-pattern",n,r])})}function are({radius:t,className:e}){return h.jsx("circle",{cx:t,cy:t,r:t,className:wt(["react-flow__background-pattern","dots",e])})}var qs;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(qs||(qs={}));const cre={[qs.Dots]:1,[qs.Lines]:1,[qs.Cross]:6},lre=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function I5({id:t,variant:e=qs.Dots,gap:n=20,size:r,lineWidth:s=1,offset:i=0,color:o,bgColor:a,style:c,className:l,patternClassName:d}){const u=_.useRef(null),{transform:p,patternId:f}=Fe(lre,it),m=r||cre[e],y=e===qs.Dots,S=e===qs.Cross,g=Array.isArray(n)?n:[n,n],v=[g[0]*p[2]||1,g[1]*p[2]||1],x=m*p[2],b=Array.isArray(i)?i:[i,i],E=S?[x,x]:v,I=[b[0]*p[2]||1+E[0]/2,b[1]*p[2]||1+E[1]/2],C=`${f}${t||""}`;return h.jsxs("svg",{className:wt(["react-flow__background",l]),style:{...c,...pu,"--xy-background-color-props":a,"--xy-background-pattern-color-props":o},ref:u,"data-testid":"rf__background",children:[h.jsx("pattern",{id:C,x:p[0]%v[0],y:p[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${I[0]},-${I[1]})`,children:y?h.jsx(are,{radius:x/2,className:d}):h.jsx(ore,{dimensions:E,lineWidth:s,variant:e,className:d})}),h.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${C})`})]})}I5.displayName="Background";const dre=_.memo(I5);function ure(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:h.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function hre(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:h.jsx("path",{d:"M0 0h32v4.2H0z"})})}function pre(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:h.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function fre(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function gre(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Tl({children:t,className:e,...n}){return h.jsx("button",{type:"button",className:wt(["react-flow__controls-button",e]),...n,children:t})}const mre=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom,ariaLabelConfig:t.ariaLabelConfig});function P5({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:s,onZoomIn:i,onZoomOut:o,onFitView:a,onInteractiveChange:c,className:l,children:d,position:u="bottom-left",orientation:p="vertical","aria-label":f}){const m=ot(),{isInteractive:y,minZoomReached:S,maxZoomReached:g,ariaLabelConfig:v}=Fe(mre,it),{zoomIn:x,zoomOut:b,fitView:E}=t0(),I=()=>{x(),i?.()},C=()=>{b(),o?.()},P=()=>{E(s),a?.()},k=()=>{m.setState({nodesDraggable:!y,nodesConnectable:!y,elementsSelectable:!y}),c?.(!y)},T=p==="horizontal"?"horizontal":"vertical";return h.jsxs(hu,{className:wt(["react-flow__controls",T,l]),position:u,style:t,"data-testid":"rf__controls","aria-label":f??v["controls.ariaLabel"],children:[e&&h.jsxs(h.Fragment,{children:[h.jsx(Tl,{onClick:I,className:"react-flow__controls-zoomin",title:v["controls.zoomIn.ariaLabel"],"aria-label":v["controls.zoomIn.ariaLabel"],disabled:g,children:h.jsx(ure,{})}),h.jsx(Tl,{onClick:C,className:"react-flow__controls-zoomout",title:v["controls.zoomOut.ariaLabel"],"aria-label":v["controls.zoomOut.ariaLabel"],disabled:S,children:h.jsx(hre,{})})]}),n&&h.jsx(Tl,{className:"react-flow__controls-fitview",onClick:P,title:v["controls.fitView.ariaLabel"],"aria-label":v["controls.fitView.ariaLabel"],children:h.jsx(pre,{})}),r&&h.jsx(Tl,{className:"react-flow__controls-interactive",onClick:k,title:v["controls.interactive.ariaLabel"],"aria-label":v["controls.interactive.ariaLabel"],children:y?h.jsx(gre,{}):h.jsx(fre,{})}),d]})}P5.displayName="Controls";const yre=_.memo(P5);function Sre({id:t,x:e,y:n,width:r,height:s,style:i,color:o,strokeColor:a,strokeWidth:c,className:l,borderRadius:d,shapeRendering:u,selected:p,onClick:f}){const{background:m,backgroundColor:y}=i||{},S=o||m||y;return h.jsx("rect",{className:wt(["react-flow__minimap-node",{selected:p},l]),x:e,y:n,rx:d,ry:d,width:r,height:s,style:{fill:S,stroke:a,strokeWidth:c},shapeRendering:u,onClick:f?g=>f(g,t):void 0})}const vre=_.memo(Sre),xre=t=>t.nodes.map(e=>e.id),Jf=t=>t instanceof Function?t:()=>t;function bre({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:s,nodeComponent:i=vre,onClick:o}){const a=Fe(xre,it),c=Jf(e),l=Jf(t),d=Jf(n),u=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return h.jsx(h.Fragment,{children:a.map(p=>h.jsx(Cre,{id:p,nodeColorFunc:c,nodeStrokeColorFunc:l,nodeClassNameFunc:d,nodeBorderRadius:r,nodeStrokeWidth:s,NodeComponent:i,onClick:o,shapeRendering:u},p))})}function wre({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:s,nodeStrokeWidth:i,shapeRendering:o,NodeComponent:a,onClick:c}){const{node:l,x:d,y:u,width:p,height:f}=Fe(m=>{const{internals:y}=m.nodeLookup.get(t),S=y.userNode,{x:g,y:v}=y.positionAbsolute,{width:x,height:b}=bs(S);return{node:S,x:g,y:v,width:x,height:b}},it);return!l||l.hidden||!P3(l)?null:h.jsx(a,{x:d,y:u,width:p,height:f,style:l.style,selected:!!l.selected,className:r(l),color:e(l),borderRadius:s,strokeColor:n(l),strokeWidth:i,shapeRendering:o,onClick:c,id:l.id})}const Cre=_.memo(wre);var _re=_.memo(bre);const Ire=200,Pre=150,Ere=t=>!t.hidden,kre=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?I3(Mc(t.nodeLookup,{filter:Ere}),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height,ariaLabelConfig:t.ariaLabelConfig}},Tre="react-flow__minimap-desc";function E5({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:s="",nodeBorderRadius:i=5,nodeStrokeWidth:o,nodeComponent:a,bgColor:c,maskColor:l,maskStrokeColor:d,maskStrokeWidth:u,position:p="bottom-right",onClick:f,onNodeClick:m,pannable:y=!1,zoomable:S=!1,ariaLabel:g,inversePan:v,zoomStep:x=1,offsetScale:b=5}){const E=ot(),I=_.useRef(null),{boundingRect:C,viewBB:P,rfId:k,panZoom:T,translateExtent:M,flowWidth:A,flowHeight:j,ariaLabelConfig:R}=Fe(kre,it),L=t?.width??Ire,F=t?.height??Pre,H=C.width/L,B=C.height/F,$=Math.max(H,B),Q=$*L,Z=$*F,ee=b*$,ne=C.x-(Q-C.width)/2-ee,N=C.y-(Z-C.height)/2-ee,D=Q+ee*2,q=Z+ee*2,U=`${Tre}-${k}`,V=_.useRef(0),te=_.useRef();V.current=$,_.useEffect(()=>{if(I.current&&T)return te.current=Kee({domNode:I.current,panZoom:T,getTransform:()=>E.getState().transform,getViewScale:()=>V.current}),()=>{te.current?.destroy()}},[T]),_.useEffect(()=>{te.current?.update({translateExtent:M,width:A,height:j,inversePan:v,pannable:y,zoomStep:x,zoomable:S})},[y,S,v,x,M,A,j]);const ie=f?de=>{const[ge,le]=te.current?.pointer(de)||[0,0];f(de,{x:ge,y:le})}:void 0,oe=m?_.useCallback((de,ge)=>{const le=E.getState().nodeLookup.get(ge).internals.userNode;m(de,le)},[]):void 0,ue=g??R["minimap.ariaLabel"];return h.jsx(hu,{position:p,style:{...t,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof u=="number"?u*$:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof o=="number"?o:void 0},className:wt(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:h.jsxs("svg",{width:L,height:F,viewBox:`${ne} ${N} ${D} ${q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":U,ref:I,onClick:ie,children:[ue&&h.jsx("title",{id:U,children:ue}),h.jsx(_re,{onClick:oe,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:s,nodeStrokeWidth:o,nodeComponent:a}),h.jsx("path",{className:"react-flow__minimap-mask",d:`M${ne-ee},${N-ee}h${D+ee*2}v${q+ee*2}h${-D-ee*2}z
        M${P.x},${P.y}h${P.width}v${P.height}h${-P.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}E5.displayName="MiniMap";const Mre=_.memo(E5),Are=t=>e=>t?`${Math.max(1/e.transform[2],1)}`:void 0,jre={[To.Line]:"right",[To.Handle]:"bottom-right"};function Rre({nodeId:t,position:e,variant:n=To.Handle,className:r,style:s=void 0,children:i,color:o,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:u=!1,resizeDirection:p,autoScale:f=!0,shouldResize:m,onResizeStart:y,onResize:S,onResizeEnd:g}){const v=i5(),x=typeof t=="string"?t:v,b=ot(),E=_.useRef(null),I=n===To.Handle,C=Fe(_.useCallback(Are(I&&f),[I,f]),it),P=_.useRef(null),k=e??jre[n];_.useEffect(()=>{if(!(!E.current||!x))return P.current||(P.current=ote({domNode:E.current,nodeId:x,getStoreItems:()=>{const{nodeLookup:M,transform:A,snapGrid:j,snapToGrid:R,nodeOrigin:L,domNode:F}=b.getState();return{nodeLookup:M,transform:A,snapGrid:j,snapToGrid:R,nodeOrigin:L,paneDomNode:F}},onChange:(M,A)=>{const{triggerNodeChanges:j,nodeLookup:R,parentLookup:L,nodeOrigin:F}=b.getState(),H=[],B={x:M.x,y:M.y},$=R.get(x);if($&&$.expandParent&&$.parentId){const Q=$.origin??F,Z=M.width??$.measured.width??0,ee=M.height??$.measured.height??0,ne={id:$.id,parentId:$.parentId,rect:{width:Z,height:ee,...E3({x:M.x??$.position.x,y:M.y??$.position.y},{width:Z,height:ee},$.parentId,R,Q)}},N=e0([ne],R,L,F);H.push(...N),B.x=M.x?Math.max(Q[0]*Z,M.x):void 0,B.y=M.y?Math.max(Q[1]*ee,M.y):void 0}if(B.x!==void 0&&B.y!==void 0){const Q={id:x,type:"position",position:{...B}};H.push(Q)}if(M.width!==void 0&&M.height!==void 0){const Z={id:x,type:"dimensions",resizing:!0,setAttributes:p?p==="horizontal"?"width":"height":!0,dimensions:{width:M.width,height:M.height}};H.push(Z)}for(const Q of A){const Z={...Q,type:"position"};H.push(Z)}j(H)},onEnd:({width:M,height:A})=>{const j={id:x,type:"dimensions",resizing:!1,dimensions:{width:M,height:A}};b.getState().triggerNodeChanges([j])}})),P.current.update({controlPosition:k,boundaries:{minWidth:a,minHeight:c,maxWidth:l,maxHeight:d},keepAspectRatio:u,resizeDirection:p,onResizeStart:y,onResize:S,onResizeEnd:g,shouldResize:m}),()=>{P.current?.destroy()}},[k,a,c,l,d,u,y,S,g,m]);const T=k.split("-");return h.jsx("div",{className:wt(["react-flow__resize-control","nodrag",...T,n,r]),ref:E,style:{...s,scale:C,...o&&{[I?"backgroundColor":"borderColor"]:o}},children:i})}_.memo(Rre);function r0(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var eg,XP;function Ore(){if(XP)return eg;XP=1;function t(){this.__data__=[],this.size=0}return eg=t,eg}var tg,ZP;function zo(){if(ZP)return tg;ZP=1;function t(e,n){return e===n||e!==e&&n!==n}return tg=t,tg}var ng,QP;function gu(){if(QP)return ng;QP=1;var t=zo();function e(n,r){for(var s=n.length;s--;)if(t(n[s][0],r))return s;return-1}return ng=e,ng}var rg,JP;function Dre(){if(JP)return rg;JP=1;var t=gu(),e=Array.prototype,n=e.splice;function r(s){var i=this.__data__,o=t(i,s);if(o<0)return!1;var a=i.length-1;return o==a?i.pop():n.call(i,o,1),--this.size,!0}return rg=r,rg}var sg,eE;function Lre(){if(eE)return sg;eE=1;var t=gu();function e(n){var r=this.__data__,s=t(r,n);return s<0?void 0:r[s][1]}return sg=e,sg}var ig,tE;function Nre(){if(tE)return ig;tE=1;var t=gu();function e(n){return t(this.__data__,n)>-1}return ig=e,ig}var og,nE;function Fre(){if(nE)return og;nE=1;var t=gu();function e(n,r){var s=this.__data__,i=t(s,n);return i<0?(++this.size,s.push([n,r])):s[i][1]=r,this}return og=e,og}var ag,rE;function mu(){if(rE)return ag;rE=1;var t=Ore(),e=Dre(),n=Lre(),r=Nre(),s=Fre();function i(o){var a=-1,c=o==null?0:o.length;for(this.clear();++a<c;){var l=o[a];this.set(l[0],l[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=n,i.prototype.has=r,i.prototype.set=s,ag=i,ag}var cg,sE;function Bre(){if(sE)return cg;sE=1;var t=mu();function e(){this.__data__=new t,this.size=0}return cg=e,cg}var lg,iE;function $re(){if(iE)return lg;iE=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return lg=t,lg}var dg,oE;function zre(){if(oE)return dg;oE=1;function t(e){return this.__data__.get(e)}return dg=t,dg}var ug,aE;function Ure(){if(aE)return ug;aE=1;function t(e){return this.__data__.has(e)}return ug=t,ug}var hg,cE;function k5(){if(cE)return hg;cE=1;var t=typeof kt=="object"&&kt&&kt.Object===Object&&kt;return hg=t,hg}var pg,lE;function Ir(){if(lE)return pg;lE=1;var t=k5(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return pg=n,pg}var fg,dE;function Uo(){if(dE)return fg;dE=1;var t=Ir(),e=t.Symbol;return fg=e,fg}var gg,uE;function qre(){if(uE)return gg;uE=1;var t=Uo(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,s=t?t.toStringTag:void 0;function i(o){var a=n.call(o,s),c=o[s];try{o[s]=void 0;var l=!0}catch{}var d=r.call(o);return l&&(a?o[s]=c:delete o[s]),d}return gg=i,gg}var mg,hE;function Hre(){if(hE)return mg;hE=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return mg=n,mg}var yg,pE;function Ni(){if(pE)return yg;pE=1;var t=Uo(),e=qre(),n=Hre(),r="[object Null]",s="[object Undefined]",i=t?t.toStringTag:void 0;function o(a){return a==null?a===void 0?s:r:i&&i in Object(a)?e(a):n(a)}return yg=o,yg}var Sg,fE;function ar(){if(fE)return Sg;fE=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return Sg=t,Sg}var vg,gE;function Rc(){if(gE)return vg;gE=1;var t=Ni(),e=ar(),n="[object AsyncFunction]",r="[object Function]",s="[object GeneratorFunction]",i="[object Proxy]";function o(a){if(!e(a))return!1;var c=t(a);return c==r||c==s||c==n||c==i}return vg=o,vg}var xg,mE;function Gre(){if(mE)return xg;mE=1;var t=Ir(),e=t["__core-js_shared__"];return xg=e,xg}var bg,yE;function Kre(){if(yE)return bg;yE=1;var t=Gre(),e=(function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""})();function n(r){return!!e&&e in r}return bg=n,bg}var wg,SE;function T5(){if(SE)return wg;SE=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return wg=n,wg}var Cg,vE;function Vre(){if(vE)return Cg;vE=1;var t=Rc(),e=Kre(),n=ar(),r=T5(),s=/[\\^$.*+?()[\]{}|]/g,i=/^\[object .+?Constructor\]$/,o=Function.prototype,a=Object.prototype,c=o.toString,l=a.hasOwnProperty,d=RegExp("^"+c.call(l).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function u(p){if(!n(p)||e(p))return!1;var f=t(p)?d:i;return f.test(r(p))}return Cg=u,Cg}var _g,xE;function Wre(){if(xE)return _g;xE=1;function t(e,n){return e?.[n]}return _g=t,_g}var Ig,bE;function Fi(){if(bE)return Ig;bE=1;var t=Vre(),e=Wre();function n(r,s){var i=e(r,s);return t(i)?i:void 0}return Ig=n,Ig}var Pg,wE;function s0(){if(wE)return Pg;wE=1;var t=Fi(),e=Ir(),n=t(e,"Map");return Pg=n,Pg}var Eg,CE;function yu(){if(CE)return Eg;CE=1;var t=Fi(),e=t(Object,"create");return Eg=e,Eg}var kg,_E;function Yre(){if(_E)return kg;_E=1;var t=yu();function e(){this.__data__=t?t(null):{},this.size=0}return kg=e,kg}var Tg,IE;function Xre(){if(IE)return Tg;IE=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return Tg=t,Tg}var Mg,PE;function Zre(){if(PE)return Mg;PE=1;var t=yu(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function s(i){var o=this.__data__;if(t){var a=o[i];return a===e?void 0:a}return r.call(o,i)?o[i]:void 0}return Mg=s,Mg}var Ag,EE;function Qre(){if(EE)return Ag;EE=1;var t=yu(),e=Object.prototype,n=e.hasOwnProperty;function r(s){var i=this.__data__;return t?i[s]!==void 0:n.call(i,s)}return Ag=r,Ag}var jg,kE;function Jre(){if(kE)return jg;kE=1;var t=yu(),e="__lodash_hash_undefined__";function n(r,s){var i=this.__data__;return this.size+=this.has(r)?0:1,i[r]=t&&s===void 0?e:s,this}return jg=n,jg}var Rg,TE;function ese(){if(TE)return Rg;TE=1;var t=Yre(),e=Xre(),n=Zre(),r=Qre(),s=Jre();function i(o){var a=-1,c=o==null?0:o.length;for(this.clear();++a<c;){var l=o[a];this.set(l[0],l[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=n,i.prototype.has=r,i.prototype.set=s,Rg=i,Rg}var Og,ME;function tse(){if(ME)return Og;ME=1;var t=ese(),e=mu(),n=s0();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return Og=r,Og}var Dg,AE;function nse(){if(AE)return Dg;AE=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return Dg=t,Dg}var Lg,jE;function Su(){if(jE)return Lg;jE=1;var t=nse();function e(n,r){var s=n.__data__;return t(r)?s[typeof r=="string"?"string":"hash"]:s.map}return Lg=e,Lg}var Ng,RE;function rse(){if(RE)return Ng;RE=1;var t=Su();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return Ng=e,Ng}var Fg,OE;function sse(){if(OE)return Fg;OE=1;var t=Su();function e(n){return t(this,n).get(n)}return Fg=e,Fg}var Bg,DE;function ise(){if(DE)return Bg;DE=1;var t=Su();function e(n){return t(this,n).has(n)}return Bg=e,Bg}var $g,LE;function ose(){if(LE)return $g;LE=1;var t=Su();function e(n,r){var s=t(this,n),i=s.size;return s.set(n,r),this.size+=s.size==i?0:1,this}return $g=e,$g}var zg,NE;function i0(){if(NE)return zg;NE=1;var t=tse(),e=rse(),n=sse(),r=ise(),s=ose();function i(o){var a=-1,c=o==null?0:o.length;for(this.clear();++a<c;){var l=o[a];this.set(l[0],l[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=n,i.prototype.has=r,i.prototype.set=s,zg=i,zg}var Ug,FE;function ase(){if(FE)return Ug;FE=1;var t=mu(),e=s0(),n=i0(),r=200;function s(i,o){var a=this.__data__;if(a instanceof t){var c=a.__data__;if(!e||c.length<r-1)return c.push([i,o]),this.size=++a.size,this;a=this.__data__=new n(c)}return a.set(i,o),this.size=a.size,this}return Ug=s,Ug}var qg,BE;function vu(){if(BE)return qg;BE=1;var t=mu(),e=Bre(),n=$re(),r=zre(),s=Ure(),i=ase();function o(a){var c=this.__data__=new t(a);this.size=c.size}return o.prototype.clear=e,o.prototype.delete=n,o.prototype.get=r,o.prototype.has=s,o.prototype.set=i,qg=o,qg}var Hg,$E;function o0(){if($E)return Hg;$E=1;function t(e,n){for(var r=-1,s=e==null?0:e.length;++r<s&&n(e[r],r,e)!==!1;);return e}return Hg=t,Hg}var Gg,zE;function M5(){if(zE)return Gg;zE=1;var t=Fi(),e=(function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}})();return Gg=e,Gg}var Kg,UE;function xu(){if(UE)return Kg;UE=1;var t=M5();function e(n,r,s){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[r]=s}return Kg=e,Kg}var Vg,qE;function bu(){if(qE)return Vg;qE=1;var t=xu(),e=zo(),n=Object.prototype,r=n.hasOwnProperty;function s(i,o,a){var c=i[o];(!(r.call(i,o)&&e(c,a))||a===void 0&&!(o in i))&&t(i,o,a)}return Vg=s,Vg}var Wg,HE;function Oc(){if(HE)return Wg;HE=1;var t=bu(),e=xu();function n(r,s,i,o){var a=!i;i||(i={});for(var c=-1,l=s.length;++c<l;){var d=s[c],u=o?o(i[d],r[d],d,i,r):void 0;u===void 0&&(u=r[d]),a?e(i,d,u):t(i,d,u)}return i}return Wg=n,Wg}var Yg,GE;function cse(){if(GE)return Yg;GE=1;function t(e,n){for(var r=-1,s=Array(e);++r<e;)s[r]=n(r);return s}return Yg=t,Yg}var Xg,KE;function Gr(){if(KE)return Xg;KE=1;function t(e){return e!=null&&typeof e=="object"}return Xg=t,Xg}var Zg,VE;function lse(){if(VE)return Zg;VE=1;var t=Ni(),e=Gr(),n="[object Arguments]";function r(s){return e(s)&&t(s)==n}return Zg=r,Zg}var Qg,WE;function Dc(){if(WE)return Qg;WE=1;var t=lse(),e=Gr(),n=Object.prototype,r=n.hasOwnProperty,s=n.propertyIsEnumerable,i=t((function(){return arguments})())?t:function(o){return e(o)&&r.call(o,"callee")&&!s.call(o,"callee")};return Qg=i,Qg}var Jg,YE;function Ct(){if(YE)return Jg;YE=1;var t=Array.isArray;return Jg=t,Jg}var Ta={exports:{}},em,XE;function dse(){if(XE)return em;XE=1;function t(){return!1}return em=t,em}Ta.exports;var ZE;function qo(){return ZE||(ZE=1,(function(t,e){var n=Ir(),r=dse(),s=e&&!e.nodeType&&e,i=s&&!0&&t&&!t.nodeType&&t,o=i&&i.exports===s,a=o?n.Buffer:void 0,c=a?a.isBuffer:void 0,l=c||r;t.exports=l})(Ta,Ta.exports)),Ta.exports}var tm,QE;function wu(){if(QE)return tm;QE=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,s){var i=typeof r;return s=s??t,!!s&&(i=="number"||i!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<s}return tm=n,tm}var nm,JE;function a0(){if(JE)return nm;JE=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return nm=e,nm}var rm,ek;function use(){if(ek)return rm;ek=1;var t=Ni(),e=a0(),n=Gr(),r="[object Arguments]",s="[object Array]",i="[object Boolean]",o="[object Date]",a="[object Error]",c="[object Function]",l="[object Map]",d="[object Number]",u="[object Object]",p="[object RegExp]",f="[object Set]",m="[object String]",y="[object WeakMap]",S="[object ArrayBuffer]",g="[object DataView]",v="[object Float32Array]",x="[object Float64Array]",b="[object Int8Array]",E="[object Int16Array]",I="[object Int32Array]",C="[object Uint8Array]",P="[object Uint8ClampedArray]",k="[object Uint16Array]",T="[object Uint32Array]",M={};M[v]=M[x]=M[b]=M[E]=M[I]=M[C]=M[P]=M[k]=M[T]=!0,M[r]=M[s]=M[S]=M[i]=M[g]=M[o]=M[a]=M[c]=M[l]=M[d]=M[u]=M[p]=M[f]=M[m]=M[y]=!1;function A(j){return n(j)&&e(j.length)&&!!M[t(j)]}return rm=A,rm}var sm,tk;function Cu(){if(tk)return sm;tk=1;function t(e){return function(n){return e(n)}}return sm=t,sm}var Ma={exports:{}};Ma.exports;var nk;function c0(){return nk||(nk=1,(function(t,e){var n=k5(),r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,o=i&&n.process,a=(function(){try{var c=s&&s.require&&s.require("util").types;return c||o&&o.binding&&o.binding("util")}catch{}})();t.exports=a})(Ma,Ma.exports)),Ma.exports}var im,rk;function Lc(){if(rk)return im;rk=1;var t=use(),e=Cu(),n=c0(),r=n&&n.isTypedArray,s=r?e(r):t;return im=s,im}var om,sk;function A5(){if(sk)return om;sk=1;var t=cse(),e=Dc(),n=Ct(),r=qo(),s=wu(),i=Lc(),o=Object.prototype,a=o.hasOwnProperty;function c(l,d){var u=n(l),p=!u&&e(l),f=!u&&!p&&r(l),m=!u&&!p&&!f&&i(l),y=u||p||f||m,S=y?t(l.length,String):[],g=S.length;for(var v in l)(d||a.call(l,v))&&!(y&&(v=="length"||f&&(v=="offset"||v=="parent")||m&&(v=="buffer"||v=="byteLength"||v=="byteOffset")||s(v,g)))&&S.push(v);return S}return om=c,om}var am,ik;function _u(){if(ik)return am;ik=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,s=typeof r=="function"&&r.prototype||t;return n===s}return am=e,am}var cm,ok;function j5(){if(ok)return cm;ok=1;function t(e,n){return function(r){return e(n(r))}}return cm=t,cm}var lm,ak;function hse(){if(ak)return lm;ak=1;var t=j5(),e=t(Object.keys,Object);return lm=e,lm}var dm,ck;function l0(){if(ck)return dm;ck=1;var t=_u(),e=hse(),n=Object.prototype,r=n.hasOwnProperty;function s(i){if(!t(i))return e(i);var o=[];for(var a in Object(i))r.call(i,a)&&a!="constructor"&&o.push(a);return o}return dm=s,dm}var um,lk;function ws(){if(lk)return um;lk=1;var t=Rc(),e=a0();function n(r){return r!=null&&e(r.length)&&!t(r)}return um=n,um}var hm,dk;function ri(){if(dk)return hm;dk=1;var t=A5(),e=l0(),n=ws();function r(s){return n(s)?t(s):e(s)}return hm=r,hm}var pm,uk;function pse(){if(uk)return pm;uk=1;var t=Oc(),e=ri();function n(r,s){return r&&t(s,e(s),r)}return pm=n,pm}var fm,hk;function fse(){if(hk)return fm;hk=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return fm=t,fm}var gm,pk;function gse(){if(pk)return gm;pk=1;var t=ar(),e=_u(),n=fse(),r=Object.prototype,s=r.hasOwnProperty;function i(o){if(!t(o))return n(o);var a=e(o),c=[];for(var l in o)l=="constructor"&&(a||!s.call(o,l))||c.push(l);return c}return gm=i,gm}var mm,fk;function Bi(){if(fk)return mm;fk=1;var t=A5(),e=gse(),n=ws();function r(s){return n(s)?t(s,!0):e(s)}return mm=r,mm}var ym,gk;function mse(){if(gk)return ym;gk=1;var t=Oc(),e=Bi();function n(r,s){return r&&t(s,e(s),r)}return ym=n,ym}var Aa={exports:{}};Aa.exports;var mk;function R5(){return mk||(mk=1,(function(t,e){var n=Ir(),r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,o=i?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;function c(l,d){if(d)return l.slice();var u=l.length,p=a?a(u):new l.constructor(u);return l.copy(p),p}t.exports=c})(Aa,Aa.exports)),Aa.exports}var Sm,yk;function O5(){if(yk)return Sm;yk=1;function t(e,n){var r=-1,s=e.length;for(n||(n=Array(s));++r<s;)n[r]=e[r];return n}return Sm=t,Sm}var vm,Sk;function D5(){if(Sk)return vm;Sk=1;function t(e,n){for(var r=-1,s=e==null?0:e.length,i=0,o=[];++r<s;){var a=e[r];n(a,r,e)&&(o[i++]=a)}return o}return vm=t,vm}var xm,vk;function L5(){if(vk)return xm;vk=1;function t(){return[]}return xm=t,xm}var bm,xk;function d0(){if(xk)return bm;xk=1;var t=D5(),e=L5(),n=Object.prototype,r=n.propertyIsEnumerable,s=Object.getOwnPropertySymbols,i=s?function(o){return o==null?[]:(o=Object(o),t(s(o),function(a){return r.call(o,a)}))}:e;return bm=i,bm}var wm,bk;function yse(){if(bk)return wm;bk=1;var t=Oc(),e=d0();function n(r,s){return t(r,e(r),s)}return wm=n,wm}var Cm,wk;function u0(){if(wk)return Cm;wk=1;function t(e,n){for(var r=-1,s=n.length,i=e.length;++r<s;)e[i+r]=n[r];return e}return Cm=t,Cm}var _m,Ck;function Iu(){if(Ck)return _m;Ck=1;var t=j5(),e=t(Object.getPrototypeOf,Object);return _m=e,_m}var Im,_k;function N5(){if(_k)return Im;_k=1;var t=u0(),e=Iu(),n=d0(),r=L5(),s=Object.getOwnPropertySymbols,i=s?function(o){for(var a=[];o;)t(a,n(o)),o=e(o);return a}:r;return Im=i,Im}var Pm,Ik;function Sse(){if(Ik)return Pm;Ik=1;var t=Oc(),e=N5();function n(r,s){return t(r,e(r),s)}return Pm=n,Pm}var Em,Pk;function F5(){if(Pk)return Em;Pk=1;var t=u0(),e=Ct();function n(r,s,i){var o=s(r);return e(r)?o:t(o,i(r))}return Em=n,Em}var km,Ek;function B5(){if(Ek)return km;Ek=1;var t=F5(),e=d0(),n=ri();function r(s){return t(s,n,e)}return km=r,km}var Tm,kk;function vse(){if(kk)return Tm;kk=1;var t=F5(),e=N5(),n=Bi();function r(s){return t(s,n,e)}return Tm=r,Tm}var Mm,Tk;function xse(){if(Tk)return Mm;Tk=1;var t=Fi(),e=Ir(),n=t(e,"DataView");return Mm=n,Mm}var Am,Mk;function bse(){if(Mk)return Am;Mk=1;var t=Fi(),e=Ir(),n=t(e,"Promise");return Am=n,Am}var jm,Ak;function $5(){if(Ak)return jm;Ak=1;var t=Fi(),e=Ir(),n=t(e,"Set");return jm=n,jm}var Rm,jk;function wse(){if(jk)return Rm;jk=1;var t=Fi(),e=Ir(),n=t(e,"WeakMap");return Rm=n,Rm}var Om,Rk;function Ho(){if(Rk)return Om;Rk=1;var t=xse(),e=s0(),n=bse(),r=$5(),s=wse(),i=Ni(),o=T5(),a="[object Map]",c="[object Object]",l="[object Promise]",d="[object Set]",u="[object WeakMap]",p="[object DataView]",f=o(t),m=o(e),y=o(n),S=o(r),g=o(s),v=i;return(t&&v(new t(new ArrayBuffer(1)))!=p||e&&v(new e)!=a||n&&v(n.resolve())!=l||r&&v(new r)!=d||s&&v(new s)!=u)&&(v=function(x){var b=i(x),E=b==c?x.constructor:void 0,I=E?o(E):"";if(I)switch(I){case f:return p;case m:return a;case y:return l;case S:return d;case g:return u}return b}),Om=v,Om}var Dm,Ok;function Cse(){if(Ok)return Dm;Ok=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var s=r.length,i=new r.constructor(s);return s&&typeof r[0]=="string"&&e.call(r,"index")&&(i.index=r.index,i.input=r.input),i}return Dm=n,Dm}var Lm,Dk;function z5(){if(Dk)return Lm;Dk=1;var t=Ir(),e=t.Uint8Array;return Lm=e,Lm}var Nm,Lk;function h0(){if(Lk)return Nm;Lk=1;var t=z5();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return Nm=e,Nm}var Fm,Nk;function _se(){if(Nk)return Fm;Nk=1;var t=h0();function e(n,r){var s=r?t(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.byteLength)}return Fm=e,Fm}var Bm,Fk;function Ise(){if(Fk)return Bm;Fk=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return Bm=e,Bm}var $m,Bk;function Pse(){if(Bk)return $m;Bk=1;var t=Uo(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(s){return n?Object(n.call(s)):{}}return $m=r,$m}var zm,$k;function U5(){if($k)return zm;$k=1;var t=h0();function e(n,r){var s=r?t(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.length)}return zm=e,zm}var Um,zk;function Ese(){if(zk)return Um;zk=1;var t=h0(),e=_se(),n=Ise(),r=Pse(),s=U5(),i="[object Boolean]",o="[object Date]",a="[object Map]",c="[object Number]",l="[object RegExp]",d="[object Set]",u="[object String]",p="[object Symbol]",f="[object ArrayBuffer]",m="[object DataView]",y="[object Float32Array]",S="[object Float64Array]",g="[object Int8Array]",v="[object Int16Array]",x="[object Int32Array]",b="[object Uint8Array]",E="[object Uint8ClampedArray]",I="[object Uint16Array]",C="[object Uint32Array]";function P(k,T,M){var A=k.constructor;switch(T){case f:return t(k);case i:case o:return new A(+k);case m:return e(k,M);case y:case S:case g:case v:case x:case b:case E:case I:case C:return s(k,M);case a:return new A;case c:case u:return new A(k);case l:return n(k);case d:return new A;case p:return r(k)}}return Um=P,Um}var qm,Uk;function q5(){if(Uk)return qm;Uk=1;var t=ar(),e=Object.create,n=(function(){function r(){}return function(s){if(!t(s))return{};if(e)return e(s);r.prototype=s;var i=new r;return r.prototype=void 0,i}})();return qm=n,qm}var Hm,qk;function H5(){if(qk)return Hm;qk=1;var t=q5(),e=Iu(),n=_u();function r(s){return typeof s.constructor=="function"&&!n(s)?t(e(s)):{}}return Hm=r,Hm}var Gm,Hk;function kse(){if(Hk)return Gm;Hk=1;var t=Ho(),e=Gr(),n="[object Map]";function r(s){return e(s)&&t(s)==n}return Gm=r,Gm}var Km,Gk;function Tse(){if(Gk)return Km;Gk=1;var t=kse(),e=Cu(),n=c0(),r=n&&n.isMap,s=r?e(r):t;return Km=s,Km}var Vm,Kk;function Mse(){if(Kk)return Vm;Kk=1;var t=Ho(),e=Gr(),n="[object Set]";function r(s){return e(s)&&t(s)==n}return Vm=r,Vm}var Wm,Vk;function Ase(){if(Vk)return Wm;Vk=1;var t=Mse(),e=Cu(),n=c0(),r=n&&n.isSet,s=r?e(r):t;return Wm=s,Wm}var Ym,Wk;function G5(){if(Wk)return Ym;Wk=1;var t=vu(),e=o0(),n=bu(),r=pse(),s=mse(),i=R5(),o=O5(),a=yse(),c=Sse(),l=B5(),d=vse(),u=Ho(),p=Cse(),f=Ese(),m=H5(),y=Ct(),S=qo(),g=Tse(),v=ar(),x=Ase(),b=ri(),E=Bi(),I=1,C=2,P=4,k="[object Arguments]",T="[object Array]",M="[object Boolean]",A="[object Date]",j="[object Error]",R="[object Function]",L="[object GeneratorFunction]",F="[object Map]",H="[object Number]",B="[object Object]",$="[object RegExp]",Q="[object Set]",Z="[object String]",ee="[object Symbol]",ne="[object WeakMap]",N="[object ArrayBuffer]",D="[object DataView]",q="[object Float32Array]",U="[object Float64Array]",V="[object Int8Array]",te="[object Int16Array]",ie="[object Int32Array]",oe="[object Uint8Array]",ue="[object Uint8ClampedArray]",de="[object Uint16Array]",ge="[object Uint32Array]",le={};le[k]=le[T]=le[N]=le[D]=le[M]=le[A]=le[q]=le[U]=le[V]=le[te]=le[ie]=le[F]=le[H]=le[B]=le[$]=le[Q]=le[Z]=le[ee]=le[oe]=le[ue]=le[de]=le[ge]=!0,le[j]=le[R]=le[ne]=!1;function xe(me,et,ht,Kt,Vt,It){var tt,Gn=et&I,jn=et&C,Kn=et&P;if(ht&&(tt=Vt?ht(me,Kt,Vt,It):ht(me)),tt!==void 0)return tt;if(!v(me))return me;var cn=y(me);if(cn){if(tt=p(me),!Gn)return o(me,tt)}else{var Wt=u(me),Kr=Wt==R||Wt==L;if(S(me))return i(me,Gn);if(Wt==B||Wt==k||Kr&&!Vt){if(tt=jn||Kr?{}:m(me),!Gn)return jn?c(me,s(tt,me)):a(me,r(tt,me))}else{if(!le[Wt])return Vt?me:{};tt=f(me,Wt,Gn)}}It||(It=new t);var Y=It.get(me);if(Y)return Y;It.set(me,tt),x(me)?me.forEach(function(De){tt.add(xe(De,et,ht,De,me,It))}):g(me)&&me.forEach(function(De,_t){tt.set(_t,xe(De,et,ht,_t,me,It))});var ae=Kn?jn?d:l:jn?E:b,Ce=cn?void 0:ae(me);return e(Ce||me,function(De,_t){Ce&&(_t=De,De=me[_t]),n(tt,_t,xe(De,et,ht,_t,me,It))}),tt}return Ym=xe,Ym}var Xm,Yk;function jse(){if(Yk)return Xm;Yk=1;var t=G5(),e=4;function n(r){return t(r,e)}return Xm=n,Xm}var Zm,Xk;function p0(){if(Xk)return Zm;Xk=1;function t(e){return function(){return e}}return Zm=t,Zm}var Qm,Zk;function Rse(){if(Zk)return Qm;Zk=1;function t(e){return function(n,r,s){for(var i=-1,o=Object(n),a=s(n),c=a.length;c--;){var l=a[e?c:++i];if(r(o[l],l,o)===!1)break}return n}}return Qm=t,Qm}var Jm,Qk;function f0(){if(Qk)return Jm;Qk=1;var t=Rse(),e=t();return Jm=e,Jm}var ey,Jk;function g0(){if(Jk)return ey;Jk=1;var t=f0(),e=ri();function n(r,s){return r&&t(r,s,e)}return ey=n,ey}var ty,eT;function Ose(){if(eT)return ty;eT=1;var t=ws();function e(n,r){return function(s,i){if(s==null)return s;if(!t(s))return n(s,i);for(var o=s.length,a=r?o:-1,c=Object(s);(r?a--:++a<o)&&i(c[a],a,c)!==!1;);return s}}return ty=e,ty}var ny,tT;function Pu(){if(tT)return ny;tT=1;var t=g0(),e=Ose(),n=e(t);return ny=n,ny}var ry,nT;function $i(){if(nT)return ry;nT=1;function t(e){return e}return ry=t,ry}var sy,rT;function K5(){if(rT)return sy;rT=1;var t=$i();function e(n){return typeof n=="function"?n:t}return sy=e,sy}var iy,sT;function V5(){if(sT)return iy;sT=1;var t=o0(),e=Pu(),n=K5(),r=Ct();function s(i,o){var a=r(i)?t:e;return a(i,n(o))}return iy=s,iy}var oy,iT;function W5(){return iT||(iT=1,oy=V5()),oy}var ay,oT;function Dse(){if(oT)return ay;oT=1;var t=Pu();function e(n,r){var s=[];return t(n,function(i,o,a){r(i,o,a)&&s.push(i)}),s}return ay=e,ay}var cy,aT;function Lse(){if(aT)return cy;aT=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return cy=e,cy}var ly,cT;function Nse(){if(cT)return ly;cT=1;function t(e){return this.__data__.has(e)}return ly=t,ly}var dy,lT;function Y5(){if(lT)return dy;lT=1;var t=i0(),e=Lse(),n=Nse();function r(s){var i=-1,o=s==null?0:s.length;for(this.__data__=new t;++i<o;)this.add(s[i])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,dy=r,dy}var uy,dT;function Fse(){if(dT)return uy;dT=1;function t(e,n){for(var r=-1,s=e==null?0:e.length;++r<s;)if(n(e[r],r,e))return!0;return!1}return uy=t,uy}var hy,uT;function X5(){if(uT)return hy;uT=1;function t(e,n){return e.has(n)}return hy=t,hy}var py,hT;function Z5(){if(hT)return py;hT=1;var t=Y5(),e=Fse(),n=X5(),r=1,s=2;function i(o,a,c,l,d,u){var p=c&r,f=o.length,m=a.length;if(f!=m&&!(p&&m>f))return!1;var y=u.get(o),S=u.get(a);if(y&&S)return y==a&&S==o;var g=-1,v=!0,x=c&s?new t:void 0;for(u.set(o,a),u.set(a,o);++g<f;){var b=o[g],E=a[g];if(l)var I=p?l(E,b,g,a,o,u):l(b,E,g,o,a,u);if(I!==void 0){if(I)continue;v=!1;break}if(x){if(!e(a,function(C,P){if(!n(x,P)&&(b===C||d(b,C,c,l,u)))return x.push(P)})){v=!1;break}}else if(!(b===E||d(b,E,c,l,u))){v=!1;break}}return u.delete(o),u.delete(a),v}return py=i,py}var fy,pT;function Bse(){if(pT)return fy;pT=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(s,i){r[++n]=[i,s]}),r}return fy=t,fy}var gy,fT;function m0(){if(fT)return gy;fT=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(s){r[++n]=s}),r}return gy=t,gy}var my,gT;function $se(){if(gT)return my;gT=1;var t=Uo(),e=z5(),n=zo(),r=Z5(),s=Bse(),i=m0(),o=1,a=2,c="[object Boolean]",l="[object Date]",d="[object Error]",u="[object Map]",p="[object Number]",f="[object RegExp]",m="[object Set]",y="[object String]",S="[object Symbol]",g="[object ArrayBuffer]",v="[object DataView]",x=t?t.prototype:void 0,b=x?x.valueOf:void 0;function E(I,C,P,k,T,M,A){switch(P){case v:if(I.byteLength!=C.byteLength||I.byteOffset!=C.byteOffset)return!1;I=I.buffer,C=C.buffer;case g:return!(I.byteLength!=C.byteLength||!M(new e(I),new e(C)));case c:case l:case p:return n(+I,+C);case d:return I.name==C.name&&I.message==C.message;case f:case y:return I==C+"";case u:var j=s;case m:var R=k&o;if(j||(j=i),I.size!=C.size&&!R)return!1;var L=A.get(I);if(L)return L==C;k|=a,A.set(I,C);var F=r(j(I),j(C),k,T,M,A);return A.delete(I),F;case S:if(b)return b.call(I)==b.call(C)}return!1}return my=E,my}var yy,mT;function zse(){if(mT)return yy;mT=1;var t=B5(),e=1,n=Object.prototype,r=n.hasOwnProperty;function s(i,o,a,c,l,d){var u=a&e,p=t(i),f=p.length,m=t(o),y=m.length;if(f!=y&&!u)return!1;for(var S=f;S--;){var g=p[S];if(!(u?g in o:r.call(o,g)))return!1}var v=d.get(i),x=d.get(o);if(v&&x)return v==o&&x==i;var b=!0;d.set(i,o),d.set(o,i);for(var E=u;++S<f;){g=p[S];var I=i[g],C=o[g];if(c)var P=u?c(C,I,g,o,i,d):c(I,C,g,i,o,d);if(!(P===void 0?I===C||l(I,C,a,c,d):P)){b=!1;break}E||(E=g=="constructor")}if(b&&!E){var k=i.constructor,T=o.constructor;k!=T&&"constructor"in i&&"constructor"in o&&!(typeof k=="function"&&k instanceof k&&typeof T=="function"&&T instanceof T)&&(b=!1)}return d.delete(i),d.delete(o),b}return yy=s,yy}var Sy,yT;function Use(){if(yT)return Sy;yT=1;var t=vu(),e=Z5(),n=$se(),r=zse(),s=Ho(),i=Ct(),o=qo(),a=Lc(),c=1,l="[object Arguments]",d="[object Array]",u="[object Object]",p=Object.prototype,f=p.hasOwnProperty;function m(y,S,g,v,x,b){var E=i(y),I=i(S),C=E?d:s(y),P=I?d:s(S);C=C==l?u:C,P=P==l?u:P;var k=C==u,T=P==u,M=C==P;if(M&&o(y)){if(!o(S))return!1;E=!0,k=!1}if(M&&!k)return b||(b=new t),E||a(y)?e(y,S,g,v,x,b):n(y,S,C,g,v,x,b);if(!(g&c)){var A=k&&f.call(y,"__wrapped__"),j=T&&f.call(S,"__wrapped__");if(A||j){var R=A?y.value():y,L=j?S.value():S;return b||(b=new t),x(R,L,g,v,b)}}return M?(b||(b=new t),r(y,S,g,v,x,b)):!1}return Sy=m,Sy}var vy,ST;function Q5(){if(ST)return vy;ST=1;var t=Use(),e=Gr();function n(r,s,i,o,a){return r===s?!0:r==null||s==null||!e(r)&&!e(s)?r!==r&&s!==s:t(r,s,i,o,n,a)}return vy=n,vy}var xy,vT;function qse(){if(vT)return xy;vT=1;var t=vu(),e=Q5(),n=1,r=2;function s(i,o,a,c){var l=a.length,d=l,u=!c;if(i==null)return!d;for(i=Object(i);l--;){var p=a[l];if(u&&p[2]?p[1]!==i[p[0]]:!(p[0]in i))return!1}for(;++l<d;){p=a[l];var f=p[0],m=i[f],y=p[1];if(u&&p[2]){if(m===void 0&&!(f in i))return!1}else{var S=new t;if(c)var g=c(m,y,f,i,o,S);if(!(g===void 0?e(y,m,n|r,c,S):g))return!1}}return!0}return xy=s,xy}var by,xT;function J5(){if(xT)return by;xT=1;var t=ar();function e(n){return n===n&&!t(n)}return by=e,by}var wy,bT;function Hse(){if(bT)return wy;bT=1;var t=J5(),e=ri();function n(r){for(var s=e(r),i=s.length;i--;){var o=s[i],a=r[o];s[i]=[o,a,t(a)]}return s}return wy=n,wy}var Cy,wT;function eF(){if(wT)return Cy;wT=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return Cy=t,Cy}var _y,CT;function Gse(){if(CT)return _y;CT=1;var t=qse(),e=Hse(),n=eF();function r(s){var i=e(s);return i.length==1&&i[0][2]?n(i[0][0],i[0][1]):function(o){return o===s||t(o,s,i)}}return _y=r,_y}var Iy,_T;function Go(){if(_T)return Iy;_T=1;var t=Ni(),e=Gr(),n="[object Symbol]";function r(s){return typeof s=="symbol"||e(s)&&t(s)==n}return Iy=r,Iy}var Py,IT;function y0(){if(IT)return Py;IT=1;var t=Ct(),e=Go(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function s(i,o){if(t(i))return!1;var a=typeof i;return a=="number"||a=="symbol"||a=="boolean"||i==null||e(i)?!0:r.test(i)||!n.test(i)||o!=null&&i in Object(o)}return Py=s,Py}var Ey,PT;function Kse(){if(PT)return Ey;PT=1;var t=i0(),e="Expected a function";function n(r,s){if(typeof r!="function"||s!=null&&typeof s!="function")throw new TypeError(e);var i=function(){var o=arguments,a=s?s.apply(this,o):o[0],c=i.cache;if(c.has(a))return c.get(a);var l=r.apply(this,o);return i.cache=c.set(a,l)||c,l};return i.cache=new(n.Cache||t),i}return n.Cache=t,Ey=n,Ey}var ky,ET;function Vse(){if(ET)return ky;ET=1;var t=Kse(),e=500;function n(r){var s=t(r,function(o){return i.size===e&&i.clear(),o}),i=s.cache;return s}return ky=n,ky}var Ty,kT;function Wse(){if(kT)return Ty;kT=1;var t=Vse(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(s){var i=[];return s.charCodeAt(0)===46&&i.push(""),s.replace(e,function(o,a,c,l){i.push(c?l.replace(n,"$1"):a||o)}),i});return Ty=r,Ty}var My,TT;function Eu(){if(TT)return My;TT=1;function t(e,n){for(var r=-1,s=e==null?0:e.length,i=Array(s);++r<s;)i[r]=n(e[r],r,e);return i}return My=t,My}var Ay,MT;function Yse(){if(MT)return Ay;MT=1;var t=Uo(),e=Eu(),n=Ct(),r=Go(),s=t?t.prototype:void 0,i=s?s.toString:void 0;function o(a){if(typeof a=="string")return a;if(n(a))return e(a,o)+"";if(r(a))return i?i.call(a):"";var c=a+"";return c=="0"&&1/a==-1/0?"-0":c}return Ay=o,Ay}var jy,AT;function tF(){if(AT)return jy;AT=1;var t=Yse();function e(n){return n==null?"":t(n)}return jy=e,jy}var Ry,jT;function ku(){if(jT)return Ry;jT=1;var t=Ct(),e=y0(),n=Wse(),r=tF();function s(i,o){return t(i)?i:e(i,o)?[i]:n(r(i))}return Ry=s,Ry}var Oy,RT;function Nc(){if(RT)return Oy;RT=1;var t=Go();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return Oy=e,Oy}var Dy,OT;function Tu(){if(OT)return Dy;OT=1;var t=ku(),e=Nc();function n(r,s){s=t(s,r);for(var i=0,o=s.length;r!=null&&i<o;)r=r[e(s[i++])];return i&&i==o?r:void 0}return Dy=n,Dy}var Ly,DT;function Xse(){if(DT)return Ly;DT=1;var t=Tu();function e(n,r,s){var i=n==null?void 0:t(n,r);return i===void 0?s:i}return Ly=e,Ly}var Ny,LT;function Zse(){if(LT)return Ny;LT=1;function t(e,n){return e!=null&&n in Object(e)}return Ny=t,Ny}var Fy,NT;function nF(){if(NT)return Fy;NT=1;var t=ku(),e=Dc(),n=Ct(),r=wu(),s=a0(),i=Nc();function o(a,c,l){c=t(c,a);for(var d=-1,u=c.length,p=!1;++d<u;){var f=i(c[d]);if(!(p=a!=null&&l(a,f)))break;a=a[f]}return p||++d!=u?p:(u=a==null?0:a.length,!!u&&s(u)&&r(f,u)&&(n(a)||e(a)))}return Fy=o,Fy}var By,FT;function rF(){if(FT)return By;FT=1;var t=Zse(),e=nF();function n(r,s){return r!=null&&e(r,s,t)}return By=n,By}var $y,BT;function Qse(){if(BT)return $y;BT=1;var t=Q5(),e=Xse(),n=rF(),r=y0(),s=J5(),i=eF(),o=Nc(),a=1,c=2;function l(d,u){return r(d)&&s(u)?i(o(d),u):function(p){var f=e(p,d);return f===void 0&&f===u?n(p,d):t(u,f,a|c)}}return $y=l,$y}var zy,$T;function sF(){if($T)return zy;$T=1;function t(e){return function(n){return n?.[e]}}return zy=t,zy}var Uy,zT;function Jse(){if(zT)return Uy;zT=1;var t=Tu();function e(n){return function(r){return t(r,n)}}return Uy=e,Uy}var qy,UT;function eie(){if(UT)return qy;UT=1;var t=sF(),e=Jse(),n=y0(),r=Nc();function s(i){return n(i)?t(r(i)):e(i)}return qy=s,qy}var Hy,qT;function Cs(){if(qT)return Hy;qT=1;var t=Gse(),e=Qse(),n=$i(),r=Ct(),s=eie();function i(o){return typeof o=="function"?o:o==null?n:typeof o=="object"?r(o)?e(o[0],o[1]):t(o):s(o)}return Hy=i,Hy}var Gy,HT;function iF(){if(HT)return Gy;HT=1;var t=D5(),e=Dse(),n=Cs(),r=Ct();function s(i,o){var a=r(i)?t:e;return a(i,n(o,3))}return Gy=s,Gy}var Ky,GT;function tie(){if(GT)return Ky;GT=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,s){return r!=null&&e.call(r,s)}return Ky=n,Ky}var Vy,KT;function oF(){if(KT)return Vy;KT=1;var t=tie(),e=nF();function n(r,s){return r!=null&&e(r,s,t)}return Vy=n,Vy}var Wy,VT;function nie(){if(VT)return Wy;VT=1;var t=l0(),e=Ho(),n=Dc(),r=Ct(),s=ws(),i=qo(),o=_u(),a=Lc(),c="[object Map]",l="[object Set]",d=Object.prototype,u=d.hasOwnProperty;function p(f){if(f==null)return!0;if(s(f)&&(r(f)||typeof f=="string"||typeof f.splice=="function"||i(f)||a(f)||n(f)))return!f.length;var m=e(f);if(m==c||m==l)return!f.size;if(o(f))return!t(f).length;for(var y in f)if(u.call(f,y))return!1;return!0}return Wy=p,Wy}var Yy,WT;function aF(){if(WT)return Yy;WT=1;function t(e){return e===void 0}return Yy=t,Yy}var Xy,YT;function cF(){if(YT)return Xy;YT=1;var t=Pu(),e=ws();function n(r,s){var i=-1,o=e(r)?Array(r.length):[];return t(r,function(a,c,l){o[++i]=s(a,c,l)}),o}return Xy=n,Xy}var Zy,XT;function lF(){if(XT)return Zy;XT=1;var t=Eu(),e=Cs(),n=cF(),r=Ct();function s(i,o){var a=r(i)?t:n;return a(i,e(o,3))}return Zy=s,Zy}var Qy,ZT;function rie(){if(ZT)return Qy;ZT=1;function t(e,n,r,s){var i=-1,o=e==null?0:e.length;for(s&&o&&(r=e[++i]);++i<o;)r=n(r,e[i],i,e);return r}return Qy=t,Qy}var Jy,QT;function sie(){if(QT)return Jy;QT=1;function t(e,n,r,s,i){return i(e,function(o,a,c){r=s?(s=!1,o):n(r,o,a,c)}),r}return Jy=t,Jy}var eS,JT;function dF(){if(JT)return eS;JT=1;var t=rie(),e=Pu(),n=Cs(),r=sie(),s=Ct();function i(o,a,c){var l=s(o)?t:r,d=arguments.length<3;return l(o,n(a,4),c,d,e)}return eS=i,eS}var tS,e2;function iie(){if(e2)return tS;e2=1;var t=Ni(),e=Ct(),n=Gr(),r="[object String]";function s(i){return typeof i=="string"||!e(i)&&n(i)&&t(i)==r}return tS=s,tS}var nS,t2;function oie(){if(t2)return nS;t2=1;var t=sF(),e=t("length");return nS=e,nS}var rS,n2;function aie(){if(n2)return rS;n2=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",s=e+n+r,i="\\ufe0e\\ufe0f",o="\\u200d",a=RegExp("["+o+t+s+i+"]");function c(l){return a.test(l)}return rS=c,rS}var sS,r2;function cie(){if(r2)return sS;r2=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",s=e+n+r,i="\\ufe0e\\ufe0f",o="["+t+"]",a="["+s+"]",c="\\ud83c[\\udffb-\\udfff]",l="(?:"+a+"|"+c+")",d="[^"+t+"]",u="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",f="\\u200d",m=l+"?",y="["+i+"]?",S="(?:"+f+"(?:"+[d,u,p].join("|")+")"+y+m+")*",g=y+m+S,v="(?:"+[d+a+"?",a,u,p,o].join("|")+")",x=RegExp(c+"(?="+c+")|"+v+g,"g");function b(E){for(var I=x.lastIndex=0;x.test(E);)++I;return I}return sS=b,sS}var iS,s2;function lie(){if(s2)return iS;s2=1;var t=oie(),e=aie(),n=cie();function r(s){return e(s)?n(s):t(s)}return iS=r,iS}var oS,i2;function die(){if(i2)return oS;i2=1;var t=l0(),e=Ho(),n=ws(),r=iie(),s=lie(),i="[object Map]",o="[object Set]";function a(c){if(c==null)return 0;if(n(c))return r(c)?s(c):c.length;var l=e(c);return l==i||l==o?c.size:t(c).length}return oS=a,oS}var aS,o2;function uie(){if(o2)return aS;o2=1;var t=o0(),e=q5(),n=g0(),r=Cs(),s=Iu(),i=Ct(),o=qo(),a=Rc(),c=ar(),l=Lc();function d(u,p,f){var m=i(u),y=m||o(u)||l(u);if(p=r(p,4),f==null){var S=u&&u.constructor;y?f=m?new S:[]:c(u)?f=a(S)?e(s(u)):{}:f={}}return(y?t:n)(u,function(g,v,x){return p(f,g,v,x)}),f}return aS=d,aS}var cS,a2;function hie(){if(a2)return cS;a2=1;var t=Uo(),e=Dc(),n=Ct(),r=t?t.isConcatSpreadable:void 0;function s(i){return n(i)||e(i)||!!(r&&i&&i[r])}return cS=s,cS}var lS,c2;function S0(){if(c2)return lS;c2=1;var t=u0(),e=hie();function n(r,s,i,o,a){var c=-1,l=r.length;for(i||(i=e),a||(a=[]);++c<l;){var d=r[c];s>0&&i(d)?s>1?n(d,s-1,i,o,a):t(a,d):o||(a[a.length]=d)}return a}return lS=n,lS}var dS,l2;function pie(){if(l2)return dS;l2=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return dS=t,dS}var uS,d2;function uF(){if(d2)return uS;d2=1;var t=pie(),e=Math.max;function n(r,s,i){return s=e(s===void 0?r.length-1:s,0),function(){for(var o=arguments,a=-1,c=e(o.length-s,0),l=Array(c);++a<c;)l[a]=o[s+a];a=-1;for(var d=Array(s+1);++a<s;)d[a]=o[a];return d[s]=i(l),t(r,this,d)}}return uS=n,uS}var hS,u2;function fie(){if(u2)return hS;u2=1;var t=p0(),e=M5(),n=$i(),r=e?function(s,i){return e(s,"toString",{configurable:!0,enumerable:!1,value:t(i),writable:!0})}:n;return hS=r,hS}var pS,h2;function gie(){if(h2)return pS;h2=1;var t=800,e=16,n=Date.now;function r(s){var i=0,o=0;return function(){var a=n(),c=e-(a-o);if(o=a,c>0){if(++i>=t)return arguments[0]}else i=0;return s.apply(void 0,arguments)}}return pS=r,pS}var fS,p2;function hF(){if(p2)return fS;p2=1;var t=fie(),e=gie(),n=e(t);return fS=n,fS}var gS,f2;function Mu(){if(f2)return gS;f2=1;var t=$i(),e=uF(),n=hF();function r(s,i){return n(e(s,i,t),s+"")}return gS=r,gS}var mS,g2;function pF(){if(g2)return mS;g2=1;function t(e,n,r,s){for(var i=e.length,o=r+(s?1:-1);s?o--:++o<i;)if(n(e[o],o,e))return o;return-1}return mS=t,mS}var yS,m2;function mie(){if(m2)return yS;m2=1;function t(e){return e!==e}return yS=t,yS}var SS,y2;function yie(){if(y2)return SS;y2=1;function t(e,n,r){for(var s=r-1,i=e.length;++s<i;)if(e[s]===n)return s;return-1}return SS=t,SS}var vS,S2;function Sie(){if(S2)return vS;S2=1;var t=pF(),e=mie(),n=yie();function r(s,i,o){return i===i?n(s,i,o):t(s,e,o)}return vS=r,vS}var xS,v2;function vie(){if(v2)return xS;v2=1;var t=Sie();function e(n,r){var s=n==null?0:n.length;return!!s&&t(n,r,0)>-1}return xS=e,xS}var bS,x2;function xie(){if(x2)return bS;x2=1;function t(e,n,r){for(var s=-1,i=e==null?0:e.length;++s<i;)if(r(n,e[s]))return!0;return!1}return bS=t,bS}var wS,b2;function bie(){if(b2)return wS;b2=1;function t(){}return wS=t,wS}var CS,w2;function wie(){if(w2)return CS;w2=1;var t=$5(),e=bie(),n=m0(),r=1/0,s=t&&1/n(new t([,-0]))[1]==r?function(i){return new t(i)}:e;return CS=s,CS}var _S,C2;function Cie(){if(C2)return _S;C2=1;var t=Y5(),e=vie(),n=xie(),r=X5(),s=wie(),i=m0(),o=200;function a(c,l,d){var u=-1,p=e,f=c.length,m=!0,y=[],S=y;if(d)m=!1,p=n;else if(f>=o){var g=l?null:s(c);if(g)return i(g);m=!1,p=r,S=new t}else S=l?[]:y;e:for(;++u<f;){var v=c[u],x=l?l(v):v;if(v=d||v!==0?v:0,m&&x===x){for(var b=S.length;b--;)if(S[b]===x)continue e;l&&S.push(x),y.push(v)}else p(S,x,d)||(S!==y&&S.push(x),y.push(v))}return y}return _S=a,_S}var IS,_2;function fF(){if(_2)return IS;_2=1;var t=ws(),e=Gr();function n(r){return e(r)&&t(r)}return IS=n,IS}var PS,I2;function _ie(){if(I2)return PS;I2=1;var t=S0(),e=Mu(),n=Cie(),r=fF(),s=e(function(i){return n(t(i,1,r,!0))});return PS=s,PS}var ES,P2;function Iie(){if(P2)return ES;P2=1;var t=Eu();function e(n,r){return t(r,function(s){return n[s]})}return ES=e,ES}var kS,E2;function gF(){if(E2)return kS;E2=1;var t=Iie(),e=ri();function n(r){return r==null?[]:t(r,e(r))}return kS=n,kS}var TS,k2;function cr(){if(k2)return TS;k2=1;var t;if(typeof r0=="function")try{t={clone:jse(),constant:p0(),each:W5(),filter:iF(),has:oF(),isArray:Ct(),isEmpty:nie(),isFunction:Rc(),isUndefined:aF(),keys:ri(),map:lF(),reduce:dF(),size:die(),transform:uie(),union:_ie(),values:gF()}}catch{}return t||(t=window._),TS=t,TS}var MS,T2;function v0(){if(T2)return MS;T2=1;var t=cr();MS=s;var e="\0",n="\0",r="";function s(d){this._isDirected=t.has(d,"directed")?d.directed:!0,this._isMultigraph=t.has(d,"multigraph")?d.multigraph:!1,this._isCompound=t.has(d,"compound")?d.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}s.prototype._nodeCount=0,s.prototype._edgeCount=0,s.prototype.isDirected=function(){return this._isDirected},s.prototype.isMultigraph=function(){return this._isMultigraph},s.prototype.isCompound=function(){return this._isCompound},s.prototype.setGraph=function(d){return this._label=d,this},s.prototype.graph=function(){return this._label},s.prototype.setDefaultNodeLabel=function(d){return t.isFunction(d)||(d=t.constant(d)),this._defaultNodeLabelFn=d,this},s.prototype.nodeCount=function(){return this._nodeCount},s.prototype.nodes=function(){return t.keys(this._nodes)},s.prototype.sources=function(){var d=this;return t.filter(this.nodes(),function(u){return t.isEmpty(d._in[u])})},s.prototype.sinks=function(){var d=this;return t.filter(this.nodes(),function(u){return t.isEmpty(d._out[u])})},s.prototype.setNodes=function(d,u){var p=arguments,f=this;return t.each(d,function(m){p.length>1?f.setNode(m,u):f.setNode(m)}),this},s.prototype.setNode=function(d,u){return t.has(this._nodes,d)?(arguments.length>1&&(this._nodes[d]=u),this):(this._nodes[d]=arguments.length>1?u:this._defaultNodeLabelFn(d),this._isCompound&&(this._parent[d]=n,this._children[d]={},this._children[n][d]=!0),this._in[d]={},this._preds[d]={},this._out[d]={},this._sucs[d]={},++this._nodeCount,this)},s.prototype.node=function(d){return this._nodes[d]},s.prototype.hasNode=function(d){return t.has(this._nodes,d)},s.prototype.removeNode=function(d){var u=this;if(t.has(this._nodes,d)){var p=function(f){u.removeEdge(u._edgeObjs[f])};delete this._nodes[d],this._isCompound&&(this._removeFromParentsChildList(d),delete this._parent[d],t.each(this.children(d),function(f){u.setParent(f)}),delete this._children[d]),t.each(t.keys(this._in[d]),p),delete this._in[d],delete this._preds[d],t.each(t.keys(this._out[d]),p),delete this._out[d],delete this._sucs[d],--this._nodeCount}return this},s.prototype.setParent=function(d,u){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(u))u=n;else{u+="";for(var p=u;!t.isUndefined(p);p=this.parent(p))if(p===d)throw new Error("Setting "+u+" as parent of "+d+" would create a cycle");this.setNode(u)}return this.setNode(d),this._removeFromParentsChildList(d),this._parent[d]=u,this._children[u][d]=!0,this},s.prototype._removeFromParentsChildList=function(d){delete this._children[this._parent[d]][d]},s.prototype.parent=function(d){if(this._isCompound){var u=this._parent[d];if(u!==n)return u}},s.prototype.children=function(d){if(t.isUndefined(d)&&(d=n),this._isCompound){var u=this._children[d];if(u)return t.keys(u)}else{if(d===n)return this.nodes();if(this.hasNode(d))return[]}},s.prototype.predecessors=function(d){var u=this._preds[d];if(u)return t.keys(u)},s.prototype.successors=function(d){var u=this._sucs[d];if(u)return t.keys(u)},s.prototype.neighbors=function(d){var u=this.predecessors(d);if(u)return t.union(u,this.successors(d))},s.prototype.isLeaf=function(d){var u;return this.isDirected()?u=this.successors(d):u=this.neighbors(d),u.length===0},s.prototype.filterNodes=function(d){var u=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});u.setGraph(this.graph());var p=this;t.each(this._nodes,function(y,S){d(S)&&u.setNode(S,y)}),t.each(this._edgeObjs,function(y){u.hasNode(y.v)&&u.hasNode(y.w)&&u.setEdge(y,p.edge(y))});var f={};function m(y){var S=p.parent(y);return S===void 0||u.hasNode(S)?(f[y]=S,S):S in f?f[S]:m(S)}return this._isCompound&&t.each(u.nodes(),function(y){u.setParent(y,m(y))}),u},s.prototype.setDefaultEdgeLabel=function(d){return t.isFunction(d)||(d=t.constant(d)),this._defaultEdgeLabelFn=d,this},s.prototype.edgeCount=function(){return this._edgeCount},s.prototype.edges=function(){return t.values(this._edgeObjs)},s.prototype.setPath=function(d,u){var p=this,f=arguments;return t.reduce(d,function(m,y){return f.length>1?p.setEdge(m,y,u):p.setEdge(m,y),y}),this},s.prototype.setEdge=function(){var d,u,p,f,m=!1,y=arguments[0];typeof y=="object"&&y!==null&&"v"in y?(d=y.v,u=y.w,p=y.name,arguments.length===2&&(f=arguments[1],m=!0)):(d=y,u=arguments[1],p=arguments[3],arguments.length>2&&(f=arguments[2],m=!0)),d=""+d,u=""+u,t.isUndefined(p)||(p=""+p);var S=a(this._isDirected,d,u,p);if(t.has(this._edgeLabels,S))return m&&(this._edgeLabels[S]=f),this;if(!t.isUndefined(p)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(d),this.setNode(u),this._edgeLabels[S]=m?f:this._defaultEdgeLabelFn(d,u,p);var g=c(this._isDirected,d,u,p);return d=g.v,u=g.w,Object.freeze(g),this._edgeObjs[S]=g,i(this._preds[u],d),i(this._sucs[d],u),this._in[u][S]=g,this._out[d][S]=g,this._edgeCount++,this},s.prototype.edge=function(d,u,p){var f=arguments.length===1?l(this._isDirected,arguments[0]):a(this._isDirected,d,u,p);return this._edgeLabels[f]},s.prototype.hasEdge=function(d,u,p){var f=arguments.length===1?l(this._isDirected,arguments[0]):a(this._isDirected,d,u,p);return t.has(this._edgeLabels,f)},s.prototype.removeEdge=function(d,u,p){var f=arguments.length===1?l(this._isDirected,arguments[0]):a(this._isDirected,d,u,p),m=this._edgeObjs[f];return m&&(d=m.v,u=m.w,delete this._edgeLabels[f],delete this._edgeObjs[f],o(this._preds[u],d),o(this._sucs[d],u),delete this._in[u][f],delete this._out[d][f],this._edgeCount--),this},s.prototype.inEdges=function(d,u){var p=this._in[d];if(p){var f=t.values(p);return u?t.filter(f,function(m){return m.v===u}):f}},s.prototype.outEdges=function(d,u){var p=this._out[d];if(p){var f=t.values(p);return u?t.filter(f,function(m){return m.w===u}):f}},s.prototype.nodeEdges=function(d,u){var p=this.inEdges(d,u);if(p)return p.concat(this.outEdges(d,u))};function i(d,u){d[u]?d[u]++:d[u]=1}function o(d,u){--d[u]||delete d[u]}function a(d,u,p,f){var m=""+u,y=""+p;if(!d&&m>y){var S=m;m=y,y=S}return m+r+y+r+(t.isUndefined(f)?e:f)}function c(d,u,p,f){var m=""+u,y=""+p;if(!d&&m>y){var S=m;m=y,y=S}var g={v:m,w:y};return f&&(g.name=f),g}function l(d,u){return a(d,u.v,u.w,u.name)}return MS}var AS,M2;function Pie(){return M2||(M2=1,AS="2.1.8"),AS}var jS,A2;function Eie(){return A2||(A2=1,jS={Graph:v0(),version:Pie()}),jS}var RS,j2;function kie(){if(j2)return RS;j2=1;var t=cr(),e=v0();RS={write:n,read:i};function n(o){var a={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:s(o)};return t.isUndefined(o.graph())||(a.value=t.clone(o.graph())),a}function r(o){return t.map(o.nodes(),function(a){var c=o.node(a),l=o.parent(a),d={v:a};return t.isUndefined(c)||(d.value=c),t.isUndefined(l)||(d.parent=l),d})}function s(o){return t.map(o.edges(),function(a){var c=o.edge(a),l={v:a.v,w:a.w};return t.isUndefined(a.name)||(l.name=a.name),t.isUndefined(c)||(l.value=c),l})}function i(o){var a=new e(o.options).setGraph(o.value);return t.each(o.nodes,function(c){a.setNode(c.v,c.value),c.parent&&a.setParent(c.v,c.parent)}),t.each(o.edges,function(c){a.setEdge({v:c.v,w:c.w,name:c.name},c.value)}),a}return RS}var OS,R2;function Tie(){if(R2)return OS;R2=1;var t=cr();OS=e;function e(n){var r={},s=[],i;function o(a){t.has(r,a)||(r[a]=!0,i.push(a),t.each(n.successors(a),o),t.each(n.predecessors(a),o))}return t.each(n.nodes(),function(a){i=[],o(a),i.length&&s.push(i)}),s}return OS}var DS,O2;function mF(){if(O2)return DS;O2=1;var t=cr();DS=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var s=this._keyIndices;if(n=String(n),!t.has(s,n)){var i=this._arr,o=i.length;return s[n]=o,i.push({key:n,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var s=this._keyIndices[n];if(r>this._arr[s].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[s].priority+" New: "+r);this._arr[s].priority=r,this._decrease(s)},e.prototype._heapify=function(n){var r=this._arr,s=2*n,i=s+1,o=n;s<r.length&&(o=r[s].priority<r[o].priority?s:o,i<r.length&&(o=r[i].priority<r[o].priority?i:o),o!==n&&(this._swap(n,o),this._heapify(o)))},e.prototype._decrease=function(n){for(var r=this._arr,s=r[n].priority,i;n!==0&&(i=n>>1,!(r[i].priority<s));)this._swap(n,i),n=i},e.prototype._swap=function(n,r){var s=this._arr,i=this._keyIndices,o=s[n],a=s[r];s[n]=a,s[r]=o,i[a.key]=n,i[o.key]=r},DS}var LS,D2;function yF(){if(D2)return LS;D2=1;var t=cr(),e=mF();LS=r;var n=t.constant(1);function r(i,o,a,c){return s(i,String(o),a||n,c||function(l){return i.outEdges(l)})}function s(i,o,a,c){var l={},d=new e,u,p,f=function(m){var y=m.v!==u?m.v:m.w,S=l[y],g=a(m),v=p.distance+g;if(g<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+g);v<S.distance&&(S.distance=v,S.predecessor=u,d.decrease(y,v))};for(i.nodes().forEach(function(m){var y=m===o?0:Number.POSITIVE_INFINITY;l[m]={distance:y},d.add(m,y)});d.size()>0&&(u=d.removeMin(),p=l[u],p.distance!==Number.POSITIVE_INFINITY);)c(u).forEach(f);return l}return LS}var NS,L2;function Mie(){if(L2)return NS;L2=1;var t=yF(),e=cr();NS=n;function n(r,s,i){return e.transform(r.nodes(),function(o,a){o[a]=t(r,a,s,i)},{})}return NS}var FS,N2;function SF(){if(N2)return FS;N2=1;var t=cr();FS=e;function e(n){var r=0,s=[],i={},o=[];function a(c){var l=i[c]={onStack:!0,lowlink:r,index:r++};if(s.push(c),n.successors(c).forEach(function(p){t.has(i,p)?i[p].onStack&&(l.lowlink=Math.min(l.lowlink,i[p].index)):(a(p),l.lowlink=Math.min(l.lowlink,i[p].lowlink))}),l.lowlink===l.index){var d=[],u;do u=s.pop(),i[u].onStack=!1,d.push(u);while(c!==u);o.push(d)}}return n.nodes().forEach(function(c){t.has(i,c)||a(c)}),o}return FS}var BS,F2;function Aie(){if(F2)return BS;F2=1;var t=cr(),e=SF();BS=n;function n(r){return t.filter(e(r),function(s){return s.length>1||s.length===1&&r.hasEdge(s[0],s[0])})}return BS}var $S,B2;function jie(){if(B2)return $S;B2=1;var t=cr();$S=n;var e=t.constant(1);function n(s,i,o){return r(s,i||e,o||function(a){return s.outEdges(a)})}function r(s,i,o){var a={},c=s.nodes();return c.forEach(function(l){a[l]={},a[l][l]={distance:0},c.forEach(function(d){l!==d&&(a[l][d]={distance:Number.POSITIVE_INFINITY})}),o(l).forEach(function(d){var u=d.v===l?d.w:d.v,p=i(d);a[l][u]={distance:p,predecessor:l}})}),c.forEach(function(l){var d=a[l];c.forEach(function(u){var p=a[u];c.forEach(function(f){var m=p[l],y=d[f],S=p[f],g=m.distance+y.distance;g<S.distance&&(S.distance=g,S.predecessor=y.predecessor)})})}),a}return $S}var zS,$2;function vF(){if($2)return zS;$2=1;var t=cr();zS=e,e.CycleException=n;function e(r){var s={},i={},o=[];function a(c){if(t.has(i,c))throw new n;t.has(s,c)||(i[c]=!0,s[c]=!0,t.each(r.predecessors(c),a),delete i[c],o.push(c))}if(t.each(r.sinks(),a),t.size(s)!==r.nodeCount())throw new n;return o}function n(){}return n.prototype=new Error,zS}var US,z2;function Rie(){if(z2)return US;z2=1;var t=vF();US=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return US}var qS,U2;function xF(){if(U2)return qS;U2=1;var t=cr();qS=e;function e(r,s,i){t.isArray(s)||(s=[s]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),a=[],c={};return t.each(s,function(l){if(!r.hasNode(l))throw new Error("Graph does not have node: "+l);n(r,l,i==="post",c,o,a)}),a}function n(r,s,i,o,a,c){t.has(o,s)||(o[s]=!0,i||c.push(s),t.each(a(s),function(l){n(r,l,i,o,a,c)}),i&&c.push(s))}return qS}var HS,q2;function Oie(){if(q2)return HS;q2=1;var t=xF();HS=e;function e(n,r){return t(n,r,"post")}return HS}var GS,H2;function Die(){if(H2)return GS;H2=1;var t=xF();GS=e;function e(n,r){return t(n,r,"pre")}return GS}var KS,G2;function Lie(){if(G2)return KS;G2=1;var t=cr(),e=v0(),n=mF();KS=r;function r(s,i){var o=new e,a={},c=new n,l;function d(p){var f=p.v===l?p.w:p.v,m=c.priority(f);if(m!==void 0){var y=i(p);y<m&&(a[f]=l,c.decrease(f,y))}}if(s.nodeCount()===0)return o;t.each(s.nodes(),function(p){c.add(p,Number.POSITIVE_INFINITY),o.setNode(p)}),c.decrease(s.nodes()[0],0);for(var u=!1;c.size()>0;){if(l=c.removeMin(),t.has(a,l))o.setEdge(l,a[l]);else{if(u)throw new Error("Input graph is not connected: "+s);u=!0}s.nodeEdges(l).forEach(d)}return o}return KS}var VS,K2;function Nie(){return K2||(K2=1,VS={components:Tie(),dijkstra:yF(),dijkstraAll:Mie(),findCycles:Aie(),floydWarshall:jie(),isAcyclic:Rie(),postorder:Oie(),preorder:Die(),prim:Lie(),tarjan:SF(),topsort:vF()}),VS}var WS,V2;function Fie(){if(V2)return WS;V2=1;var t=Eie();return WS={Graph:t.Graph,json:kie(),alg:Nie(),version:t.version},WS}var YS,W2;function br(){if(W2)return YS;W2=1;var t;if(typeof r0=="function")try{t=Fie()}catch{}return t||(t=window.graphlib),YS=t,YS}var XS,Y2;function Bie(){if(Y2)return XS;Y2=1;var t=G5(),e=1,n=4;function r(s){return t(s,e|n)}return XS=r,XS}var ZS,X2;function Au(){if(X2)return ZS;X2=1;var t=zo(),e=ws(),n=wu(),r=ar();function s(i,o,a){if(!r(a))return!1;var c=typeof o;return(c=="number"?e(a)&&n(o,a.length):c=="string"&&o in a)?t(a[o],i):!1}return ZS=s,ZS}var QS,Z2;function $ie(){if(Z2)return QS;Z2=1;var t=Mu(),e=zo(),n=Au(),r=Bi(),s=Object.prototype,i=s.hasOwnProperty,o=t(function(a,c){a=Object(a);var l=-1,d=c.length,u=d>2?c[2]:void 0;for(u&&n(c[0],c[1],u)&&(d=1);++l<d;)for(var p=c[l],f=r(p),m=-1,y=f.length;++m<y;){var S=f[m],g=a[S];(g===void 0||e(g,s[S])&&!i.call(a,S))&&(a[S]=p[S])}return a});return QS=o,QS}var JS,Q2;function zie(){if(Q2)return JS;Q2=1;var t=Cs(),e=ws(),n=ri();function r(s){return function(i,o,a){var c=Object(i);if(!e(i)){var l=t(o,3);i=n(i),o=function(u){return l(c[u],u,c)}}var d=s(i,o,a);return d>-1?c[l?i[d]:d]:void 0}}return JS=r,JS}var ev,J2;function Uie(){if(J2)return ev;J2=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return ev=e,ev}var tv,eM;function qie(){if(eM)return tv;eM=1;var t=Uie(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return tv=n,tv}var nv,tM;function Hie(){if(tM)return nv;tM=1;var t=qie(),e=ar(),n=Go(),r=NaN,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt;function c(l){if(typeof l=="number")return l;if(n(l))return r;if(e(l)){var d=typeof l.valueOf=="function"?l.valueOf():l;l=e(d)?d+"":d}if(typeof l!="string")return l===0?l:+l;l=t(l);var u=i.test(l);return u||o.test(l)?a(l.slice(2),u?2:8):s.test(l)?r:+l}return nv=c,nv}var rv,nM;function bF(){if(nM)return rv;nM=1;var t=Hie(),e=1/0,n=17976931348623157e292;function r(s){if(!s)return s===0?s:0;if(s=t(s),s===e||s===-e){var i=s<0?-1:1;return i*n}return s===s?s:0}return rv=r,rv}var sv,rM;function Gie(){if(rM)return sv;rM=1;var t=bF();function e(n){var r=t(n),s=r%1;return r===r?s?r-s:r:0}return sv=e,sv}var iv,sM;function Kie(){if(sM)return iv;sM=1;var t=pF(),e=Cs(),n=Gie(),r=Math.max;function s(i,o,a){var c=i==null?0:i.length;if(!c)return-1;var l=a==null?0:n(a);return l<0&&(l=r(c+l,0)),t(i,e(o,3),l)}return iv=s,iv}var ov,iM;function Vie(){if(iM)return ov;iM=1;var t=zie(),e=Kie(),n=t(e);return ov=n,ov}var av,oM;function wF(){if(oM)return av;oM=1;var t=S0();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return av=e,av}var cv,aM;function Wie(){if(aM)return cv;aM=1;var t=f0(),e=K5(),n=Bi();function r(s,i){return s==null?s:t(s,e(i),n)}return cv=r,cv}var lv,cM;function Yie(){if(cM)return lv;cM=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return lv=t,lv}var dv,lM;function Xie(){if(lM)return dv;lM=1;var t=xu(),e=g0(),n=Cs();function r(s,i){var o={};return i=n(i,3),e(s,function(a,c,l){t(o,c,i(a,c,l))}),o}return dv=r,dv}var uv,dM;function x0(){if(dM)return uv;dM=1;var t=Go();function e(n,r,s){for(var i=-1,o=n.length;++i<o;){var a=n[i],c=r(a);if(c!=null&&(l===void 0?c===c&&!t(c):s(c,l)))var l=c,d=a}return d}return uv=e,uv}var hv,uM;function Zie(){if(uM)return hv;uM=1;function t(e,n){return e>n}return hv=t,hv}var pv,hM;function Qie(){if(hM)return pv;hM=1;var t=x0(),e=Zie(),n=$i();function r(s){return s&&s.length?t(s,n,e):void 0}return pv=r,pv}var fv,pM;function CF(){if(pM)return fv;pM=1;var t=xu(),e=zo();function n(r,s,i){(i!==void 0&&!e(r[s],i)||i===void 0&&!(s in r))&&t(r,s,i)}return fv=n,fv}var gv,fM;function Jie(){if(fM)return gv;fM=1;var t=Ni(),e=Iu(),n=Gr(),r="[object Object]",s=Function.prototype,i=Object.prototype,o=s.toString,a=i.hasOwnProperty,c=o.call(Object);function l(d){if(!n(d)||t(d)!=r)return!1;var u=e(d);if(u===null)return!0;var p=a.call(u,"constructor")&&u.constructor;return typeof p=="function"&&p instanceof p&&o.call(p)==c}return gv=l,gv}var mv,gM;function _F(){if(gM)return mv;gM=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return mv=t,mv}var yv,mM;function eoe(){if(mM)return yv;mM=1;var t=Oc(),e=Bi();function n(r){return t(r,e(r))}return yv=n,yv}var Sv,yM;function toe(){if(yM)return Sv;yM=1;var t=CF(),e=R5(),n=U5(),r=O5(),s=H5(),i=Dc(),o=Ct(),a=fF(),c=qo(),l=Rc(),d=ar(),u=Jie(),p=Lc(),f=_F(),m=eoe();function y(S,g,v,x,b,E,I){var C=f(S,v),P=f(g,v),k=I.get(P);if(k){t(S,v,k);return}var T=E?E(C,P,v+"",S,g,I):void 0,M=T===void 0;if(M){var A=o(P),j=!A&&c(P),R=!A&&!j&&p(P);T=P,A||j||R?o(C)?T=C:a(C)?T=r(C):j?(M=!1,T=e(P,!0)):R?(M=!1,T=n(P,!0)):T=[]:u(P)||i(P)?(T=C,i(C)?T=m(C):(!d(C)||l(C))&&(T=s(P))):M=!1}M&&(I.set(P,T),b(T,P,x,E,I),I.delete(P)),t(S,v,T)}return Sv=y,Sv}var vv,SM;function noe(){if(SM)return vv;SM=1;var t=vu(),e=CF(),n=f0(),r=toe(),s=ar(),i=Bi(),o=_F();function a(c,l,d,u,p){c!==l&&n(l,function(f,m){if(p||(p=new t),s(f))r(c,l,m,d,a,u,p);else{var y=u?u(o(c,m),f,m+"",c,l,p):void 0;y===void 0&&(y=f),e(c,m,y)}},i)}return vv=a,vv}var xv,vM;function roe(){if(vM)return xv;vM=1;var t=Mu(),e=Au();function n(r){return t(function(s,i){var o=-1,a=i.length,c=a>1?i[a-1]:void 0,l=a>2?i[2]:void 0;for(c=r.length>3&&typeof c=="function"?(a--,c):void 0,l&&e(i[0],i[1],l)&&(c=a<3?void 0:c,a=1),s=Object(s);++o<a;){var d=i[o];d&&r(s,d,o,c)}return s})}return xv=n,xv}var bv,xM;function soe(){if(xM)return bv;xM=1;var t=noe(),e=roe(),n=e(function(r,s,i){t(r,s,i)});return bv=n,bv}var wv,bM;function IF(){if(bM)return wv;bM=1;function t(e,n){return e<n}return wv=t,wv}var Cv,wM;function ioe(){if(wM)return Cv;wM=1;var t=x0(),e=IF(),n=$i();function r(s){return s&&s.length?t(s,n,e):void 0}return Cv=r,Cv}var _v,CM;function ooe(){if(CM)return _v;CM=1;var t=x0(),e=Cs(),n=IF();function r(s,i){return s&&s.length?t(s,e(i,2),n):void 0}return _v=r,_v}var Iv,_M;function aoe(){if(_M)return Iv;_M=1;var t=Ir(),e=function(){return t.Date.now()};return Iv=e,Iv}var Pv,IM;function coe(){if(IM)return Pv;IM=1;var t=bu(),e=ku(),n=wu(),r=ar(),s=Nc();function i(o,a,c,l){if(!r(o))return o;a=e(a,o);for(var d=-1,u=a.length,p=u-1,f=o;f!=null&&++d<u;){var m=s(a[d]),y=c;if(m==="__proto__"||m==="constructor"||m==="prototype")return o;if(d!=p){var S=f[m];y=l?l(S,m,f):void 0,y===void 0&&(y=r(S)?S:n(a[d+1])?[]:{})}t(f,m,y),f=f[m]}return o}return Pv=i,Pv}var Ev,PM;function loe(){if(PM)return Ev;PM=1;var t=Tu(),e=coe(),n=ku();function r(s,i,o){for(var a=-1,c=i.length,l={};++a<c;){var d=i[a],u=t(s,d);o(u,d)&&e(l,n(d,s),u)}return l}return Ev=r,Ev}var kv,EM;function doe(){if(EM)return kv;EM=1;var t=loe(),e=rF();function n(r,s){return t(r,s,function(i,o){return e(r,o)})}return kv=n,kv}var Tv,kM;function uoe(){if(kM)return Tv;kM=1;var t=wF(),e=uF(),n=hF();function r(s){return n(e(s,void 0,t),s+"")}return Tv=r,Tv}var Mv,TM;function hoe(){if(TM)return Mv;TM=1;var t=doe(),e=uoe(),n=e(function(r,s){return r==null?{}:t(r,s)});return Mv=n,Mv}var Av,MM;function poe(){if(MM)return Av;MM=1;var t=Math.ceil,e=Math.max;function n(r,s,i,o){for(var a=-1,c=e(t((s-r)/(i||1)),0),l=Array(c);c--;)l[o?c:++a]=r,r+=i;return l}return Av=n,Av}var jv,AM;function foe(){if(AM)return jv;AM=1;var t=poe(),e=Au(),n=bF();function r(s){return function(i,o,a){return a&&typeof a!="number"&&e(i,o,a)&&(o=a=void 0),i=n(i),o===void 0?(o=i,i=0):o=n(o),a=a===void 0?i<o?1:-1:n(a),t(i,o,a,s)}}return jv=r,jv}var Rv,jM;function goe(){if(jM)return Rv;jM=1;var t=foe(),e=t();return Rv=e,Rv}var Ov,RM;function moe(){if(RM)return Ov;RM=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return Ov=t,Ov}var Dv,OM;function yoe(){if(OM)return Dv;OM=1;var t=Go();function e(n,r){if(n!==r){var s=n!==void 0,i=n===null,o=n===n,a=t(n),c=r!==void 0,l=r===null,d=r===r,u=t(r);if(!l&&!u&&!a&&n>r||a&&c&&d&&!l&&!u||i&&c&&d||!s&&d||!o)return 1;if(!i&&!a&&!u&&n<r||u&&s&&o&&!i&&!a||l&&s&&o||!c&&o||!d)return-1}return 0}return Dv=e,Dv}var Lv,DM;function Soe(){if(DM)return Lv;DM=1;var t=yoe();function e(n,r,s){for(var i=-1,o=n.criteria,a=r.criteria,c=o.length,l=s.length;++i<c;){var d=t(o[i],a[i]);if(d){if(i>=l)return d;var u=s[i];return d*(u=="desc"?-1:1)}}return n.index-r.index}return Lv=e,Lv}var Nv,LM;function voe(){if(LM)return Nv;LM=1;var t=Eu(),e=Tu(),n=Cs(),r=cF(),s=moe(),i=Cu(),o=Soe(),a=$i(),c=Ct();function l(d,u,p){u.length?u=t(u,function(y){return c(y)?function(S){return e(S,y.length===1?y[0]:y)}:y}):u=[a];var f=-1;u=t(u,i(n));var m=r(d,function(y,S,g){var v=t(u,function(x){return x(y)});return{criteria:v,index:++f,value:y}});return s(m,function(y,S){return o(y,S,p)})}return Nv=l,Nv}var Fv,NM;function xoe(){if(NM)return Fv;NM=1;var t=S0(),e=voe(),n=Mu(),r=Au(),s=n(function(i,o){if(i==null)return[];var a=o.length;return a>1&&r(i,o[0],o[1])?o=[]:a>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(i,t(o,1),[])});return Fv=s,Fv}var Bv,FM;function boe(){if(FM)return Bv;FM=1;var t=tF(),e=0;function n(r){var s=++e;return t(r)+s}return Bv=n,Bv}var $v,BM;function woe(){if(BM)return $v;BM=1;function t(e,n,r){for(var s=-1,i=e.length,o=n.length,a={};++s<i;){var c=s<o?n[s]:void 0;r(a,e[s],c)}return a}return $v=t,$v}var zv,$M;function Coe(){if($M)return zv;$M=1;var t=bu(),e=woe();function n(r,s){return e(r||[],s||[],t)}return zv=n,zv}var Uv,zM;function at(){if(zM)return Uv;zM=1;var t;if(typeof r0=="function")try{t={cloneDeep:Bie(),constant:p0(),defaults:$ie(),each:W5(),filter:iF(),find:Vie(),flatten:wF(),forEach:V5(),forIn:Wie(),has:oF(),isUndefined:aF(),last:Yie(),map:lF(),mapValues:Xie(),max:Qie(),merge:soe(),min:ioe(),minBy:ooe(),now:aoe(),pick:hoe(),range:goe(),reduce:dF(),sortBy:xoe(),uniqueId:boe(),values:gF(),zipObject:Coe()}}catch{}return t||(t=window._),Uv=t,Uv}var qv,UM;function _oe(){if(UM)return qv;UM=1,qv=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,s=r._prev;if(s!==r)return e(s),s},t.prototype.enqueue=function(r){var s=this._sentinel;r._prev&&r._next&&e(r),r._next=s._next,s._next._prev=r,s._next=r,r._prev=s},t.prototype.toString=function(){for(var r=[],s=this._sentinel,i=s._prev;i!==s;)r.push(JSON.stringify(i,n)),i=i._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,s){if(r!=="_next"&&r!=="_prev")return s}return qv}var Hv,qM;function Ioe(){if(qM)return Hv;qM=1;var t=at(),e=br().Graph,n=_oe();Hv=s;var r=t.constant(1);function s(l,d){if(l.nodeCount()<=1)return[];var u=a(l,d||r),p=i(u.graph,u.buckets,u.zeroIdx);return t.flatten(t.map(p,function(f){return l.outEdges(f.v,f.w)}),!0)}function i(l,d,u){for(var p=[],f=d[d.length-1],m=d[0],y;l.nodeCount();){for(;y=m.dequeue();)o(l,d,u,y);for(;y=f.dequeue();)o(l,d,u,y);if(l.nodeCount()){for(var S=d.length-2;S>0;--S)if(y=d[S].dequeue(),y){p=p.concat(o(l,d,u,y,!0));break}}}return p}function o(l,d,u,p,f){var m=f?[]:void 0;return t.forEach(l.inEdges(p.v),function(y){var S=l.edge(y),g=l.node(y.v);f&&m.push({v:y.v,w:y.w}),g.out-=S,c(d,u,g)}),t.forEach(l.outEdges(p.v),function(y){var S=l.edge(y),g=y.w,v=l.node(g);v.in-=S,c(d,u,v)}),l.removeNode(p.v),m}function a(l,d){var u=new e,p=0,f=0;t.forEach(l.nodes(),function(S){u.setNode(S,{v:S,in:0,out:0})}),t.forEach(l.edges(),function(S){var g=u.edge(S.v,S.w)||0,v=d(S),x=g+v;u.setEdge(S.v,S.w,x),f=Math.max(f,u.node(S.v).out+=v),p=Math.max(p,u.node(S.w).in+=v)});var m=t.range(f+p+3).map(function(){return new n}),y=p+1;return t.forEach(u.nodes(),function(S){c(m,y,u.node(S))}),{graph:u,buckets:m,zeroIdx:y}}function c(l,d,u){u.out?u.in?l[u.out-u.in+d].enqueue(u):l[l.length-1].enqueue(u):l[0].enqueue(u)}return Hv}var Gv,HM;function Poe(){if(HM)return Gv;HM=1;var t=at(),e=Ioe();Gv={run:n,undo:s};function n(i){var o=i.graph().acyclicer==="greedy"?e(i,a(i)):r(i);t.forEach(o,function(c){var l=i.edge(c);i.removeEdge(c),l.forwardName=c.name,l.reversed=!0,i.setEdge(c.w,c.v,l,t.uniqueId("rev"))});function a(c){return function(l){return c.edge(l).weight}}}function r(i){var o=[],a={},c={};function l(d){t.has(c,d)||(c[d]=!0,a[d]=!0,t.forEach(i.outEdges(d),function(u){t.has(a,u.w)?o.push(u):l(u.w)}),delete a[d])}return t.forEach(i.nodes(),l),o}function s(i){t.forEach(i.edges(),function(o){var a=i.edge(o);if(a.reversed){i.removeEdge(o);var c=a.forwardName;delete a.reversed,delete a.forwardName,i.setEdge(o.w,o.v,a,c)}})}return Gv}var Kv,GM;function kn(){if(GM)return Kv;GM=1;var t=at(),e=br().Graph;Kv={addDummyNode:n,simplify:r,asNonCompoundGraph:s,successorWeights:i,predecessorWeights:o,intersectRect:a,buildLayerMatrix:c,normalizeRanks:l,removeEmptyRanks:d,addBorderNode:u,maxRank:p,partition:f,time:m,notime:y};function n(S,g,v,x){var b;do b=t.uniqueId(x);while(S.hasNode(b));return v.dummy=g,S.setNode(b,v),b}function r(S){var g=new e().setGraph(S.graph());return t.forEach(S.nodes(),function(v){g.setNode(v,S.node(v))}),t.forEach(S.edges(),function(v){var x=g.edge(v.v,v.w)||{weight:0,minlen:1},b=S.edge(v);g.setEdge(v.v,v.w,{weight:x.weight+b.weight,minlen:Math.max(x.minlen,b.minlen)})}),g}function s(S){var g=new e({multigraph:S.isMultigraph()}).setGraph(S.graph());return t.forEach(S.nodes(),function(v){S.children(v).length||g.setNode(v,S.node(v))}),t.forEach(S.edges(),function(v){g.setEdge(v,S.edge(v))}),g}function i(S){var g=t.map(S.nodes(),function(v){var x={};return t.forEach(S.outEdges(v),function(b){x[b.w]=(x[b.w]||0)+S.edge(b).weight}),x});return t.zipObject(S.nodes(),g)}function o(S){var g=t.map(S.nodes(),function(v){var x={};return t.forEach(S.inEdges(v),function(b){x[b.v]=(x[b.v]||0)+S.edge(b).weight}),x});return t.zipObject(S.nodes(),g)}function a(S,g){var v=S.x,x=S.y,b=g.x-v,E=g.y-x,I=S.width/2,C=S.height/2;if(!b&&!E)throw new Error("Not possible to find intersection inside of the rectangle");var P,k;return Math.abs(E)*I>Math.abs(b)*C?(E<0&&(C=-C),P=C*b/E,k=C):(b<0&&(I=-I),P=I,k=I*E/b),{x:v+P,y:x+k}}function c(S){var g=t.map(t.range(p(S)+1),function(){return[]});return t.forEach(S.nodes(),function(v){var x=S.node(v),b=x.rank;t.isUndefined(b)||(g[b][x.order]=v)}),g}function l(S){var g=t.min(t.map(S.nodes(),function(v){return S.node(v).rank}));t.forEach(S.nodes(),function(v){var x=S.node(v);t.has(x,"rank")&&(x.rank-=g)})}function d(S){var g=t.min(t.map(S.nodes(),function(E){return S.node(E).rank})),v=[];t.forEach(S.nodes(),function(E){var I=S.node(E).rank-g;v[I]||(v[I]=[]),v[I].push(E)});var x=0,b=S.graph().nodeRankFactor;t.forEach(v,function(E,I){t.isUndefined(E)&&I%b!==0?--x:x&&t.forEach(E,function(C){S.node(C).rank+=x})})}function u(S,g,v,x){var b={width:0,height:0};return arguments.length>=4&&(b.rank=v,b.order=x),n(S,"border",b,g)}function p(S){return t.max(t.map(S.nodes(),function(g){var v=S.node(g).rank;if(!t.isUndefined(v))return v}))}function f(S,g){var v={lhs:[],rhs:[]};return t.forEach(S,function(x){g(x)?v.lhs.push(x):v.rhs.push(x)}),v}function m(S,g){var v=t.now();try{return g()}finally{console.log(S+" time: "+(t.now()-v)+"ms")}}function y(S,g){return g()}return Kv}var Vv,KM;function Eoe(){if(KM)return Vv;KM=1;var t=at(),e=kn();Vv={run:n,undo:s};function n(i){i.graph().dummyChains=[],t.forEach(i.edges(),function(o){r(i,o)})}function r(i,o){var a=o.v,c=i.node(a).rank,l=o.w,d=i.node(l).rank,u=o.name,p=i.edge(o),f=p.labelRank;if(d!==c+1){i.removeEdge(o);var m,y,S;for(S=0,++c;c<d;++S,++c)p.points=[],y={width:0,height:0,edgeLabel:p,edgeObj:o,rank:c},m=e.addDummyNode(i,"edge",y,"_d"),c===f&&(y.width=p.width,y.height=p.height,y.dummy="edge-label",y.labelpos=p.labelpos),i.setEdge(a,m,{weight:p.weight},u),S===0&&i.graph().dummyChains.push(m),a=m;i.setEdge(a,l,{weight:p.weight},u)}}function s(i){t.forEach(i.graph().dummyChains,function(o){var a=i.node(o),c=a.edgeLabel,l;for(i.setEdge(a.edgeObj,c);a.dummy;)l=i.successors(o)[0],i.removeNode(o),c.points.push({x:a.x,y:a.y}),a.dummy==="edge-label"&&(c.x=a.x,c.y=a.y,c.width=a.width,c.height=a.height),o=l,a=i.node(o)})}return Vv}var Wv,VM;function vd(){if(VM)return Wv;VM=1;var t=at();Wv={longestPath:e,slack:n};function e(r){var s={};function i(o){var a=r.node(o);if(t.has(s,o))return a.rank;s[o]=!0;var c=t.min(t.map(r.outEdges(o),function(l){return i(l.w)-r.edge(l).minlen}));return(c===Number.POSITIVE_INFINITY||c===void 0||c===null)&&(c=0),a.rank=c}t.forEach(r.sources(),i)}function n(r,s){return r.node(s.w).rank-r.node(s.v).rank-r.edge(s).minlen}return Wv}var Yv,WM;function PF(){if(WM)return Yv;WM=1;var t=at(),e=br().Graph,n=vd().slack;Yv=r;function r(a){var c=new e({directed:!1}),l=a.nodes()[0],d=a.nodeCount();c.setNode(l,{});for(var u,p;s(c,a)<d;)u=i(c,a),p=c.hasNode(u.v)?n(a,u):-n(a,u),o(c,a,p);return c}function s(a,c){function l(d){t.forEach(c.nodeEdges(d),function(u){var p=u.v,f=d===p?u.w:p;!a.hasNode(f)&&!n(c,u)&&(a.setNode(f,{}),a.setEdge(d,f,{}),l(f))})}return t.forEach(a.nodes(),l),a.nodeCount()}function i(a,c){return t.minBy(c.edges(),function(l){if(a.hasNode(l.v)!==a.hasNode(l.w))return n(c,l)})}function o(a,c,l){t.forEach(a.nodes(),function(d){c.node(d).rank+=l})}return Yv}var Xv,YM;function koe(){if(YM)return Xv;YM=1;var t=at(),e=PF(),n=vd().slack,r=vd().longestPath,s=br().alg.preorder,i=br().alg.postorder,o=kn().simplify;Xv=a,a.initLowLimValues=u,a.initCutValues=c,a.calcCutValue=d,a.leaveEdge=f,a.enterEdge=m,a.exchangeEdges=y;function a(x){x=o(x),r(x);var b=e(x);u(b),c(b,x);for(var E,I;E=f(b);)I=m(b,x,E),y(b,x,E,I)}function c(x,b){var E=i(x,x.nodes());E=E.slice(0,E.length-1),t.forEach(E,function(I){l(x,b,I)})}function l(x,b,E){var I=x.node(E),C=I.parent;x.edge(E,C).cutvalue=d(x,b,E)}function d(x,b,E){var I=x.node(E),C=I.parent,P=!0,k=b.edge(E,C),T=0;return k||(P=!1,k=b.edge(C,E)),T=k.weight,t.forEach(b.nodeEdges(E),function(M){var A=M.v===E,j=A?M.w:M.v;if(j!==C){var R=A===P,L=b.edge(M).weight;if(T+=R?L:-L,g(x,E,j)){var F=x.edge(E,j).cutvalue;T+=R?-F:F}}}),T}function u(x,b){arguments.length<2&&(b=x.nodes()[0]),p(x,{},1,b)}function p(x,b,E,I,C){var P=E,k=x.node(I);return b[I]=!0,t.forEach(x.neighbors(I),function(T){t.has(b,T)||(E=p(x,b,E,T,I))}),k.low=P,k.lim=E++,C?k.parent=C:delete k.parent,E}function f(x){return t.find(x.edges(),function(b){return x.edge(b).cutvalue<0})}function m(x,b,E){var I=E.v,C=E.w;b.hasEdge(I,C)||(I=E.w,C=E.v);var P=x.node(I),k=x.node(C),T=P,M=!1;P.lim>k.lim&&(T=k,M=!0);var A=t.filter(b.edges(),function(j){return M===v(x,x.node(j.v),T)&&M!==v(x,x.node(j.w),T)});return t.minBy(A,function(j){return n(b,j)})}function y(x,b,E,I){var C=E.v,P=E.w;x.removeEdge(C,P),x.setEdge(I.v,I.w,{}),u(x),c(x,b),S(x,b)}function S(x,b){var E=t.find(x.nodes(),function(C){return!b.node(C).parent}),I=s(x,E);I=I.slice(1),t.forEach(I,function(C){var P=x.node(C).parent,k=b.edge(C,P),T=!1;k||(k=b.edge(P,C),T=!0),b.node(C).rank=b.node(P).rank+(T?k.minlen:-k.minlen)})}function g(x,b,E){return x.hasEdge(b,E)}function v(x,b,E){return E.low<=b.lim&&b.lim<=E.lim}return Xv}var Zv,XM;function Toe(){if(XM)return Zv;XM=1;var t=vd(),e=t.longestPath,n=PF(),r=koe();Zv=s;function s(c){switch(c.graph().ranker){case"network-simplex":a(c);break;case"tight-tree":o(c);break;case"longest-path":i(c);break;default:a(c)}}var i=e;function o(c){e(c),n(c)}function a(c){r(c)}return Zv}var Qv,ZM;function Moe(){if(ZM)return Qv;ZM=1;var t=at();Qv=e;function e(s){var i=r(s);t.forEach(s.graph().dummyChains,function(o){for(var a=s.node(o),c=a.edgeObj,l=n(s,i,c.v,c.w),d=l.path,u=l.lca,p=0,f=d[p],m=!0;o!==c.w;){if(a=s.node(o),m){for(;(f=d[p])!==u&&s.node(f).maxRank<a.rank;)p++;f===u&&(m=!1)}if(!m){for(;p<d.length-1&&s.node(f=d[p+1]).minRank<=a.rank;)p++;f=d[p]}s.setParent(o,f),o=s.successors(o)[0]}})}function n(s,i,o,a){var c=[],l=[],d=Math.min(i[o].low,i[a].low),u=Math.max(i[o].lim,i[a].lim),p,f;p=o;do p=s.parent(p),c.push(p);while(p&&(i[p].low>d||u>i[p].lim));for(f=p,p=a;(p=s.parent(p))!==f;)l.push(p);return{path:c.concat(l.reverse()),lca:f}}function r(s){var i={},o=0;function a(c){var l=o;t.forEach(s.children(c),a),i[c]={low:l,lim:o++}}return t.forEach(s.children(),a),i}return Qv}var Jv,QM;function Aoe(){if(QM)return Jv;QM=1;var t=at(),e=kn();Jv={run:n,cleanup:o};function n(a){var c=e.addDummyNode(a,"root",{},"_root"),l=s(a),d=t.max(t.values(l))-1,u=2*d+1;a.graph().nestingRoot=c,t.forEach(a.edges(),function(f){a.edge(f).minlen*=u});var p=i(a)+1;t.forEach(a.children(),function(f){r(a,c,u,p,d,l,f)}),a.graph().nodeRankFactor=u}function r(a,c,l,d,u,p,f){var m=a.children(f);if(!m.length){f!==c&&a.setEdge(c,f,{weight:0,minlen:l});return}var y=e.addBorderNode(a,"_bt"),S=e.addBorderNode(a,"_bb"),g=a.node(f);a.setParent(y,f),g.borderTop=y,a.setParent(S,f),g.borderBottom=S,t.forEach(m,function(v){r(a,c,l,d,u,p,v);var x=a.node(v),b=x.borderTop?x.borderTop:v,E=x.borderBottom?x.borderBottom:v,I=x.borderTop?d:2*d,C=b!==E?1:u-p[f]+1;a.setEdge(y,b,{weight:I,minlen:C,nestingEdge:!0}),a.setEdge(E,S,{weight:I,minlen:C,nestingEdge:!0})}),a.parent(f)||a.setEdge(c,y,{weight:0,minlen:u+p[f]})}function s(a){var c={};function l(d,u){var p=a.children(d);p&&p.length&&t.forEach(p,function(f){l(f,u+1)}),c[d]=u}return t.forEach(a.children(),function(d){l(d,1)}),c}function i(a){return t.reduce(a.edges(),function(c,l){return c+a.edge(l).weight},0)}function o(a){var c=a.graph();a.removeNode(c.nestingRoot),delete c.nestingRoot,t.forEach(a.edges(),function(l){var d=a.edge(l);d.nestingEdge&&a.removeEdge(l)})}return Jv}var ex,JM;function joe(){if(JM)return ex;JM=1;var t=at(),e=kn();ex=n;function n(s){function i(o){var a=s.children(o),c=s.node(o);if(a.length&&t.forEach(a,i),t.has(c,"minRank")){c.borderLeft=[],c.borderRight=[];for(var l=c.minRank,d=c.maxRank+1;l<d;++l)r(s,"borderLeft","_bl",o,c,l),r(s,"borderRight","_br",o,c,l)}}t.forEach(s.children(),i)}function r(s,i,o,a,c,l){var d={width:0,height:0,rank:l,borderType:i},u=c[i][l-1],p=e.addDummyNode(s,"border",d,o);c[i][l]=p,s.setParent(p,a),u&&s.setEdge(u,p,{weight:1})}return ex}var tx,eA;function Roe(){if(eA)return tx;eA=1;var t=at();tx={adjust:e,undo:n};function e(l){var d=l.graph().rankdir.toLowerCase();(d==="lr"||d==="rl")&&r(l)}function n(l){var d=l.graph().rankdir.toLowerCase();(d==="bt"||d==="rl")&&i(l),(d==="lr"||d==="rl")&&(a(l),r(l))}function r(l){t.forEach(l.nodes(),function(d){s(l.node(d))}),t.forEach(l.edges(),function(d){s(l.edge(d))})}function s(l){var d=l.width;l.width=l.height,l.height=d}function i(l){t.forEach(l.nodes(),function(d){o(l.node(d))}),t.forEach(l.edges(),function(d){var u=l.edge(d);t.forEach(u.points,o),t.has(u,"y")&&o(u)})}function o(l){l.y=-l.y}function a(l){t.forEach(l.nodes(),function(d){c(l.node(d))}),t.forEach(l.edges(),function(d){var u=l.edge(d);t.forEach(u.points,c),t.has(u,"x")&&c(u)})}function c(l){var d=l.x;l.x=l.y,l.y=d}return tx}var nx,tA;function Ooe(){if(tA)return nx;tA=1;var t=at();nx=e;function e(n){var r={},s=t.filter(n.nodes(),function(l){return!n.children(l).length}),i=t.max(t.map(s,function(l){return n.node(l).rank})),o=t.map(t.range(i+1),function(){return[]});function a(l){if(!t.has(r,l)){r[l]=!0;var d=n.node(l);o[d.rank].push(l),t.forEach(n.successors(l),a)}}var c=t.sortBy(s,function(l){return n.node(l).rank});return t.forEach(c,a),o}return nx}var rx,nA;function Doe(){if(nA)return rx;nA=1;var t=at();rx=e;function e(r,s){for(var i=0,o=1;o<s.length;++o)i+=n(r,s[o-1],s[o]);return i}function n(r,s,i){for(var o=t.zipObject(i,t.map(i,function(p,f){return f})),a=t.flatten(t.map(s,function(p){return t.sortBy(t.map(r.outEdges(p),function(f){return{pos:o[f.w],weight:r.edge(f).weight}}),"pos")}),!0),c=1;c<i.length;)c<<=1;var l=2*c-1;c-=1;var d=t.map(new Array(l),function(){return 0}),u=0;return t.forEach(a.forEach(function(p){var f=p.pos+c;d[f]+=p.weight;for(var m=0;f>0;)f%2&&(m+=d[f+1]),f=f-1>>1,d[f]+=p.weight;u+=p.weight*m})),u}return rx}var sx,rA;function Loe(){if(rA)return sx;rA=1;var t=at();sx=e;function e(n,r){return t.map(r,function(s){var i=n.inEdges(s);if(i.length){var o=t.reduce(i,function(a,c){var l=n.edge(c),d=n.node(c.v);return{sum:a.sum+l.weight*d.order,weight:a.weight+l.weight}},{sum:0,weight:0});return{v:s,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:s}})}return sx}var ix,sA;function Noe(){if(sA)return ix;sA=1;var t=at();ix=e;function e(s,i){var o={};t.forEach(s,function(c,l){var d=o[c.v]={indegree:0,in:[],out:[],vs:[c.v],i:l};t.isUndefined(c.barycenter)||(d.barycenter=c.barycenter,d.weight=c.weight)}),t.forEach(i.edges(),function(c){var l=o[c.v],d=o[c.w];!t.isUndefined(l)&&!t.isUndefined(d)&&(d.indegree++,l.out.push(o[c.w]))});var a=t.filter(o,function(c){return!c.indegree});return n(a)}function n(s){var i=[];function o(l){return function(d){d.merged||(t.isUndefined(d.barycenter)||t.isUndefined(l.barycenter)||d.barycenter>=l.barycenter)&&r(l,d)}}function a(l){return function(d){d.in.push(l),--d.indegree===0&&s.push(d)}}for(;s.length;){var c=s.pop();i.push(c),t.forEach(c.in.reverse(),o(c)),t.forEach(c.out,a(c))}return t.map(t.filter(i,function(l){return!l.merged}),function(l){return t.pick(l,["vs","i","barycenter","weight"])})}function r(s,i){var o=0,a=0;s.weight&&(o+=s.barycenter*s.weight,a+=s.weight),i.weight&&(o+=i.barycenter*i.weight,a+=i.weight),s.vs=i.vs.concat(s.vs),s.barycenter=o/a,s.weight=a,s.i=Math.min(i.i,s.i),i.merged=!0}return ix}var ox,iA;function Foe(){if(iA)return ox;iA=1;var t=at(),e=kn();ox=n;function n(i,o){var a=e.partition(i,function(y){return t.has(y,"barycenter")}),c=a.lhs,l=t.sortBy(a.rhs,function(y){return-y.i}),d=[],u=0,p=0,f=0;c.sort(s(!!o)),f=r(d,l,f),t.forEach(c,function(y){f+=y.vs.length,d.push(y.vs),u+=y.barycenter*y.weight,p+=y.weight,f=r(d,l,f)});var m={vs:t.flatten(d,!0)};return p&&(m.barycenter=u/p,m.weight=p),m}function r(i,o,a){for(var c;o.length&&(c=t.last(o)).i<=a;)o.pop(),i.push(c.vs),a++;return a}function s(i){return function(o,a){return o.barycenter<a.barycenter?-1:o.barycenter>a.barycenter?1:i?a.i-o.i:o.i-a.i}}return ox}var ax,oA;function Boe(){if(oA)return ax;oA=1;var t=at(),e=Loe(),n=Noe(),r=Foe();ax=s;function s(a,c,l,d){var u=a.children(c),p=a.node(c),f=p?p.borderLeft:void 0,m=p?p.borderRight:void 0,y={};f&&(u=t.filter(u,function(E){return E!==f&&E!==m}));var S=e(a,u);t.forEach(S,function(E){if(a.children(E.v).length){var I=s(a,E.v,l,d);y[E.v]=I,t.has(I,"barycenter")&&o(E,I)}});var g=n(S,l);i(g,y);var v=r(g,d);if(f&&(v.vs=t.flatten([f,v.vs,m],!0),a.predecessors(f).length)){var x=a.node(a.predecessors(f)[0]),b=a.node(a.predecessors(m)[0]);t.has(v,"barycenter")||(v.barycenter=0,v.weight=0),v.barycenter=(v.barycenter*v.weight+x.order+b.order)/(v.weight+2),v.weight+=2}return v}function i(a,c){t.forEach(a,function(l){l.vs=t.flatten(l.vs.map(function(d){return c[d]?c[d].vs:d}),!0)})}function o(a,c){t.isUndefined(a.barycenter)?(a.barycenter=c.barycenter,a.weight=c.weight):(a.barycenter=(a.barycenter*a.weight+c.barycenter*c.weight)/(a.weight+c.weight),a.weight+=c.weight)}return ax}var cx,aA;function $oe(){if(aA)return cx;aA=1;var t=at(),e=br().Graph;cx=n;function n(s,i,o){var a=r(s),c=new e({compound:!0}).setGraph({root:a}).setDefaultNodeLabel(function(l){return s.node(l)});return t.forEach(s.nodes(),function(l){var d=s.node(l),u=s.parent(l);(d.rank===i||d.minRank<=i&&i<=d.maxRank)&&(c.setNode(l),c.setParent(l,u||a),t.forEach(s[o](l),function(p){var f=p.v===l?p.w:p.v,m=c.edge(f,l),y=t.isUndefined(m)?0:m.weight;c.setEdge(f,l,{weight:s.edge(p).weight+y})}),t.has(d,"minRank")&&c.setNode(l,{borderLeft:d.borderLeft[i],borderRight:d.borderRight[i]}))}),c}function r(s){for(var i;s.hasNode(i=t.uniqueId("_root")););return i}return cx}var lx,cA;function zoe(){if(cA)return lx;cA=1;var t=at();lx=e;function e(n,r,s){var i={},o;t.forEach(s,function(a){for(var c=n.parent(a),l,d;c;){if(l=n.parent(c),l?(d=i[l],i[l]=c):(d=o,o=c),d&&d!==c){r.setEdge(d,c);return}c=l}})}return lx}var dx,lA;function Uoe(){if(lA)return dx;lA=1;var t=at(),e=Ooe(),n=Doe(),r=Boe(),s=$oe(),i=zoe(),o=br().Graph,a=kn();dx=c;function c(p){var f=a.maxRank(p),m=l(p,t.range(1,f+1),"inEdges"),y=l(p,t.range(f-1,-1,-1),"outEdges"),S=e(p);u(p,S);for(var g=Number.POSITIVE_INFINITY,v,x=0,b=0;b<4;++x,++b){d(x%2?m:y,x%4>=2),S=a.buildLayerMatrix(p);var E=n(p,S);E<g&&(b=0,v=t.cloneDeep(S),g=E)}u(p,v)}function l(p,f,m){return t.map(f,function(y){return s(p,y,m)})}function d(p,f){var m=new o;t.forEach(p,function(y){var S=y.graph().root,g=r(y,S,m,f);t.forEach(g.vs,function(v,x){y.node(v).order=x}),i(y,m,g.vs)})}function u(p,f){t.forEach(f,function(m){t.forEach(m,function(y,S){p.node(y).order=S})})}return dx}var ux,dA;function qoe(){if(dA)return ux;dA=1;var t=at(),e=br().Graph,n=kn();ux={positionX:m,findType1Conflicts:r,findType2Conflicts:s,addConflict:o,hasConflict:a,verticalAlignment:c,horizontalCompaction:l,alignCoordinates:p,findSmallestWidthAlignment:u,balance:f};function r(g,v){var x={};function b(E,I){var C=0,P=0,k=E.length,T=t.last(I);return t.forEach(I,function(M,A){var j=i(g,M),R=j?g.node(j).order:k;(j||M===T)&&(t.forEach(I.slice(P,A+1),function(L){t.forEach(g.predecessors(L),function(F){var H=g.node(F),B=H.order;(B<C||R<B)&&!(H.dummy&&g.node(L).dummy)&&o(x,F,L)})}),P=A+1,C=R)}),I}return t.reduce(v,b),x}function s(g,v){var x={};function b(I,C,P,k,T){var M;t.forEach(t.range(C,P),function(A){M=I[A],g.node(M).dummy&&t.forEach(g.predecessors(M),function(j){var R=g.node(j);R.dummy&&(R.order<k||R.order>T)&&o(x,j,M)})})}function E(I,C){var P=-1,k,T=0;return t.forEach(C,function(M,A){if(g.node(M).dummy==="border"){var j=g.predecessors(M);j.length&&(k=g.node(j[0]).order,b(C,T,A,P,k),T=A,P=k)}b(C,T,C.length,k,I.length)}),C}return t.reduce(v,E),x}function i(g,v){if(g.node(v).dummy)return t.find(g.predecessors(v),function(x){return g.node(x).dummy})}function o(g,v,x){if(v>x){var b=v;v=x,x=b}var E=g[v];E||(g[v]=E={}),E[x]=!0}function a(g,v,x){if(v>x){var b=v;v=x,x=b}return t.has(g[v],x)}function c(g,v,x,b){var E={},I={},C={};return t.forEach(v,function(P){t.forEach(P,function(k,T){E[k]=k,I[k]=k,C[k]=T})}),t.forEach(v,function(P){var k=-1;t.forEach(P,function(T){var M=b(T);if(M.length){M=t.sortBy(M,function(F){return C[F]});for(var A=(M.length-1)/2,j=Math.floor(A),R=Math.ceil(A);j<=R;++j){var L=M[j];I[T]===T&&k<C[L]&&!a(x,T,L)&&(I[L]=T,I[T]=E[T]=E[L],k=C[L])}}})}),{root:E,align:I}}function l(g,v,x,b,E){var I={},C=d(g,v,x,E),P=E?"borderLeft":"borderRight";function k(A,j){for(var R=C.nodes(),L=R.pop(),F={};L;)F[L]?A(L):(F[L]=!0,R.push(L),R=R.concat(j(L))),L=R.pop()}function T(A){I[A]=C.inEdges(A).reduce(function(j,R){return Math.max(j,I[R.v]+C.edge(R))},0)}function M(A){var j=C.outEdges(A).reduce(function(L,F){return Math.min(L,I[F.w]-C.edge(F))},Number.POSITIVE_INFINITY),R=g.node(A);j!==Number.POSITIVE_INFINITY&&R.borderType!==P&&(I[A]=Math.max(I[A],j))}return k(T,C.predecessors.bind(C)),k(M,C.successors.bind(C)),t.forEach(b,function(A){I[A]=I[x[A]]}),I}function d(g,v,x,b){var E=new e,I=g.graph(),C=y(I.nodesep,I.edgesep,b);return t.forEach(v,function(P){var k;t.forEach(P,function(T){var M=x[T];if(E.setNode(M),k){var A=x[k],j=E.edge(A,M);E.setEdge(A,M,Math.max(C(g,T,k),j||0))}k=T})}),E}function u(g,v){return t.minBy(t.values(v),function(x){var b=Number.NEGATIVE_INFINITY,E=Number.POSITIVE_INFINITY;return t.forIn(x,function(I,C){var P=S(g,C)/2;b=Math.max(I+P,b),E=Math.min(I-P,E)}),b-E})}function p(g,v){var x=t.values(v),b=t.min(x),E=t.max(x);t.forEach(["u","d"],function(I){t.forEach(["l","r"],function(C){var P=I+C,k=g[P],T;if(k!==v){var M=t.values(k);T=C==="l"?b-t.min(M):E-t.max(M),T&&(g[P]=t.mapValues(k,function(A){return A+T}))}})})}function f(g,v){return t.mapValues(g.ul,function(x,b){if(v)return g[v.toLowerCase()][b];var E=t.sortBy(t.map(g,b));return(E[1]+E[2])/2})}function m(g){var v=n.buildLayerMatrix(g),x=t.merge(r(g,v),s(g,v)),b={},E;t.forEach(["u","d"],function(C){E=C==="u"?v:t.values(v).reverse(),t.forEach(["l","r"],function(P){P==="r"&&(E=t.map(E,function(A){return t.values(A).reverse()}));var k=(C==="u"?g.predecessors:g.successors).bind(g),T=c(g,E,x,k),M=l(g,E,T.root,T.align,P==="r");P==="r"&&(M=t.mapValues(M,function(A){return-A})),b[C+P]=M})});var I=u(g,b);return p(b,I),f(b,g.graph().align)}function y(g,v,x){return function(b,E,I){var C=b.node(E),P=b.node(I),k=0,T;if(k+=C.width/2,t.has(C,"labelpos"))switch(C.labelpos.toLowerCase()){case"l":T=-C.width/2;break;case"r":T=C.width/2;break}if(T&&(k+=x?T:-T),T=0,k+=(C.dummy?v:g)/2,k+=(P.dummy?v:g)/2,k+=P.width/2,t.has(P,"labelpos"))switch(P.labelpos.toLowerCase()){case"l":T=P.width/2;break;case"r":T=-P.width/2;break}return T&&(k+=x?T:-T),T=0,k}}function S(g,v){return g.node(v).width}return ux}var hx,uA;function Hoe(){if(uA)return hx;uA=1;var t=at(),e=kn(),n=qoe().positionX;hx=r;function r(i){i=e.asNonCompoundGraph(i),s(i),t.forEach(n(i),function(o,a){i.node(a).x=o})}function s(i){var o=e.buildLayerMatrix(i),a=i.graph().ranksep,c=0;t.forEach(o,function(l){var d=t.max(t.map(l,function(u){return i.node(u).height}));t.forEach(l,function(u){i.node(u).y=c+d/2}),c+=d+a})}return hx}var px,hA;function Goe(){if(hA)return px;hA=1;var t=at(),e=Poe(),n=Eoe(),r=Toe(),s=kn().normalizeRanks,i=Moe(),o=kn().removeEmptyRanks,a=Aoe(),c=joe(),l=Roe(),d=Uoe(),u=Hoe(),p=kn(),f=br().Graph;px=m;function m(N,D){var q=D&&D.debugTiming?p.time:p.notime;q("layout",function(){var U=q("  buildLayoutGraph",function(){return k(N)});q("  runLayout",function(){y(U,q)}),q("  updateInputGraph",function(){S(N,U)})})}function y(N,D){D("    makeSpaceForEdgeLabels",function(){T(N)}),D("    removeSelfEdges",function(){$(N)}),D("    acyclic",function(){e.run(N)}),D("    nestingGraph.run",function(){a.run(N)}),D("    rank",function(){r(p.asNonCompoundGraph(N))}),D("    injectEdgeLabelProxies",function(){M(N)}),D("    removeEmptyRanks",function(){o(N)}),D("    nestingGraph.cleanup",function(){a.cleanup(N)}),D("    normalizeRanks",function(){s(N)}),D("    assignRankMinMax",function(){A(N)}),D("    removeEdgeLabelProxies",function(){j(N)}),D("    normalize.run",function(){n.run(N)}),D("    parentDummyChains",function(){i(N)}),D("    addBorderSegments",function(){c(N)}),D("    order",function(){d(N)}),D("    insertSelfEdges",function(){Q(N)}),D("    adjustCoordinateSystem",function(){l.adjust(N)}),D("    position",function(){u(N)}),D("    positionSelfEdges",function(){Z(N)}),D("    removeBorderNodes",function(){B(N)}),D("    normalize.undo",function(){n.undo(N)}),D("    fixupEdgeLabelCoords",function(){F(N)}),D("    undoCoordinateSystem",function(){l.undo(N)}),D("    translateGraph",function(){R(N)}),D("    assignNodeIntersects",function(){L(N)}),D("    reversePoints",function(){H(N)}),D("    acyclic.undo",function(){e.undo(N)})}function S(N,D){t.forEach(N.nodes(),function(q){var U=N.node(q),V=D.node(q);U&&(U.x=V.x,U.y=V.y,D.children(q).length&&(U.width=V.width,U.height=V.height))}),t.forEach(N.edges(),function(q){var U=N.edge(q),V=D.edge(q);U.points=V.points,t.has(V,"x")&&(U.x=V.x,U.y=V.y)}),N.graph().width=D.graph().width,N.graph().height=D.graph().height}var g=["nodesep","edgesep","ranksep","marginx","marginy"],v={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},x=["acyclicer","ranker","rankdir","align"],b=["width","height"],E={width:0,height:0},I=["minlen","weight","width","height","labeloffset"],C={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},P=["labelpos"];function k(N){var D=new f({multigraph:!0,compound:!0}),q=ne(N.graph());return D.setGraph(t.merge({},v,ee(q,g),t.pick(q,x))),t.forEach(N.nodes(),function(U){var V=ne(N.node(U));D.setNode(U,t.defaults(ee(V,b),E)),D.setParent(U,N.parent(U))}),t.forEach(N.edges(),function(U){var V=ne(N.edge(U));D.setEdge(U,t.merge({},C,ee(V,I),t.pick(V,P)))}),D}function T(N){var D=N.graph();D.ranksep/=2,t.forEach(N.edges(),function(q){var U=N.edge(q);U.minlen*=2,U.labelpos.toLowerCase()!=="c"&&(D.rankdir==="TB"||D.rankdir==="BT"?U.width+=U.labeloffset:U.height+=U.labeloffset)})}function M(N){t.forEach(N.edges(),function(D){var q=N.edge(D);if(q.width&&q.height){var U=N.node(D.v),V=N.node(D.w),te={rank:(V.rank-U.rank)/2+U.rank,e:D};p.addDummyNode(N,"edge-proxy",te,"_ep")}})}function A(N){var D=0;t.forEach(N.nodes(),function(q){var U=N.node(q);U.borderTop&&(U.minRank=N.node(U.borderTop).rank,U.maxRank=N.node(U.borderBottom).rank,D=t.max(D,U.maxRank))}),N.graph().maxRank=D}function j(N){t.forEach(N.nodes(),function(D){var q=N.node(D);q.dummy==="edge-proxy"&&(N.edge(q.e).labelRank=q.rank,N.removeNode(D))})}function R(N){var D=Number.POSITIVE_INFINITY,q=0,U=Number.POSITIVE_INFINITY,V=0,te=N.graph(),ie=te.marginx||0,oe=te.marginy||0;function ue(de){var ge=de.x,le=de.y,xe=de.width,me=de.height;D=Math.min(D,ge-xe/2),q=Math.max(q,ge+xe/2),U=Math.min(U,le-me/2),V=Math.max(V,le+me/2)}t.forEach(N.nodes(),function(de){ue(N.node(de))}),t.forEach(N.edges(),function(de){var ge=N.edge(de);t.has(ge,"x")&&ue(ge)}),D-=ie,U-=oe,t.forEach(N.nodes(),function(de){var ge=N.node(de);ge.x-=D,ge.y-=U}),t.forEach(N.edges(),function(de){var ge=N.edge(de);t.forEach(ge.points,function(le){le.x-=D,le.y-=U}),t.has(ge,"x")&&(ge.x-=D),t.has(ge,"y")&&(ge.y-=U)}),te.width=q-D+ie,te.height=V-U+oe}function L(N){t.forEach(N.edges(),function(D){var q=N.edge(D),U=N.node(D.v),V=N.node(D.w),te,ie;q.points?(te=q.points[0],ie=q.points[q.points.length-1]):(q.points=[],te=V,ie=U),q.points.unshift(p.intersectRect(U,te)),q.points.push(p.intersectRect(V,ie))})}function F(N){t.forEach(N.edges(),function(D){var q=N.edge(D);if(t.has(q,"x"))switch((q.labelpos==="l"||q.labelpos==="r")&&(q.width-=q.labeloffset),q.labelpos){case"l":q.x-=q.width/2+q.labeloffset;break;case"r":q.x+=q.width/2+q.labeloffset;break}})}function H(N){t.forEach(N.edges(),function(D){var q=N.edge(D);q.reversed&&q.points.reverse()})}function B(N){t.forEach(N.nodes(),function(D){if(N.children(D).length){var q=N.node(D),U=N.node(q.borderTop),V=N.node(q.borderBottom),te=N.node(t.last(q.borderLeft)),ie=N.node(t.last(q.borderRight));q.width=Math.abs(ie.x-te.x),q.height=Math.abs(V.y-U.y),q.x=te.x+q.width/2,q.y=U.y+q.height/2}}),t.forEach(N.nodes(),function(D){N.node(D).dummy==="border"&&N.removeNode(D)})}function $(N){t.forEach(N.edges(),function(D){if(D.v===D.w){var q=N.node(D.v);q.selfEdges||(q.selfEdges=[]),q.selfEdges.push({e:D,label:N.edge(D)}),N.removeEdge(D)}})}function Q(N){var D=p.buildLayerMatrix(N);t.forEach(D,function(q){var U=0;t.forEach(q,function(V,te){var ie=N.node(V);ie.order=te+U,t.forEach(ie.selfEdges,function(oe){p.addDummyNode(N,"selfedge",{width:oe.label.width,height:oe.label.height,rank:ie.rank,order:te+ ++U,e:oe.e,label:oe.label},"_se")}),delete ie.selfEdges})})}function Z(N){t.forEach(N.nodes(),function(D){var q=N.node(D);if(q.dummy==="selfedge"){var U=N.node(q.e.v),V=U.x+U.width/2,te=U.y,ie=q.x-V,oe=U.height/2;N.setEdge(q.e,q.label),N.removeNode(D),q.label.points=[{x:V+2*ie/3,y:te-oe},{x:V+5*ie/6,y:te-oe},{x:V+ie,y:te},{x:V+5*ie/6,y:te+oe},{x:V+2*ie/3,y:te+oe}],q.label.x=q.x,q.label.y=q.y}})}function ee(N,D){return t.mapValues(t.pick(N,D),Number)}function ne(N){var D={};return t.forEach(N,function(q,U){D[U.toLowerCase()]=q}),D}return px}var fx,pA;function Koe(){if(pA)return fx;pA=1;var t=at(),e=kn(),n=br().Graph;fx={debugOrdering:r};function r(s){var i=e.buildLayerMatrix(s),o=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(s.nodes(),function(a){o.setNode(a,{label:a}),o.setParent(a,"layer"+s.node(a).rank)}),t.forEach(s.edges(),function(a){o.setEdge(a.v,a.w,{},a.name)}),t.forEach(i,function(a,c){var l="layer"+c;o.setNode(l,{rank:"same"}),t.reduce(a,function(d,u){return o.setEdge(d,u,{style:"invis"}),u})}),o}return fx}var gx,fA;function Voe(){return fA||(fA=1,gx="0.8.5"),gx}var mx,gA;function Woe(){return gA||(gA=1,mx={graphlib:br(),layout:Goe(),debug:Koe(),util:{time:kn().time,notime:kn().notime},version:Voe()}),mx}var Yoe=Woe();const mA=Ws(Yoe),Xoe=/^graph\s+(TD|TB|LR|RL|BT)/i,Zoe=/^\s*(\w+)\["([^"]+)"\]/,Qoe=/^\s*(\w+)\(["']?([^)"']+)["']?\)/,Joe=/^\s*(\w+)\{["']?([^}"']+)["']?\}/,eae=/^\s*(\w+)\s*-->\s*\|([^|]+)\|\s*(\w+)/,tae=/^\s*(\w+)\s*-->\s*(\w+)/,nae=/^\s*(\w+)\s*-->\s*(\w+)\["([^"]+)"\]/;function rae(t){const e=t.split(`
`).map(a=>a.trim()).filter(Boolean);let n="TB";const r=new Map,s=[];let i=0;for(const a of e){const c=a.match(Xoe);if(c){const y=c[1].toUpperCase();n=y==="LR"||y==="RL"?"LR":"TB";continue}if(/^(subgraph|end|style|class|classDef|linkStyle)\b/i.test(a))continue;const l=a.match(eae);if(l){const[,y,S,g]=l;r.has(y)||r.set(y,y),r.has(g)||r.set(g,g),s.push({id:`e${i++}`,source:y,target:g,label:S.trim()});continue}const d=a.match(nae);if(d){const[,y,S,g]=d;r.has(y)||r.set(y,y),r.set(S,g),s.push({id:`e${i++}`,source:y,target:S});continue}const u=a.match(tae);if(u){const[,y,S]=u;r.has(y)||r.set(y,y),r.has(S)||r.set(S,S),s.push({id:`e${i++}`,source:y,target:S});continue}const p=a.match(Zoe);if(p){const[,y,S]=p;r.set(y,S);continue}const f=a.match(Qoe);if(f){const[,y,S]=f;r.set(y,S);continue}const m=a.match(Joe);if(m){const[,y,S]=m;r.set(y,S);continue}}return{nodes:Array.from(r.entries()).map(([a,c])=>({id:a,type:"arcade",position:{x:0,y:0},data:{label:c}})),edges:s,direction:n}}function yx(t,e,n="TB"){const r=[`graph ${n}`];for(const s of t){const i=s.data.label||s.id;r.push(`    ${s.id}["${i}"]`)}r.push("");for(const s of e)s.label?r.push(`    ${s.source} -->|${s.label}| ${s.target}`):r.push(`    ${s.source} --> ${s.target}`);return r.join(`
`)}function Sx(t,e,n){const{direction:r,nodeWidth:s=180,nodeHeight:i=50,rankSep:o=80,nodeSep:a=40}=n,c=new mA.graphlib.Graph;c.setDefaultEdgeLabel(()=>({})),c.setGraph({rankdir:r,ranksep:o,nodesep:a});for(const l of t)c.setNode(l.id,{width:s,height:i});for(const l of e)c.setEdge(l.source,l.target);return mA.layout(c),t.map(l=>{const d=c.node(l.id);return{...l,position:{x:d.x-s/2,y:d.y-i/2}}})}const ub=yB,sae=SB;function iae({data:t,selected:e}){const n=t.label,r=t.colorIdx??0,s=ub[r]||ub[0];return h.jsxs("div",{className:is("px-3 py-2 font-terminal text-xs border-2 rounded-none min-w-[100px] text-center",e?"border-primary text-primary ring-1 ring-primary":`${s.border} ${s.text}`,s.bg),children:[h.jsx(Ns,{type:"target",position:ve.Top,className:"!bg-primary !border-primary !w-2 !h-2"}),h.jsx(Ns,{type:"target",position:ve.Left,className:"!bg-primary !border-primary !w-2 !h-2"}),n,h.jsx(Ns,{type:"source",position:ve.Bottom,className:"!bg-primary !border-primary !w-2 !h-2"}),h.jsx(Ns,{type:"source",position:ve.Right,className:"!bg-primary !border-primary !w-2 !h-2"})]})}const oae={arcade:iae},aae={type:"smoothstep",style:{stroke:"hsl(var(--primary))",strokeWidth:2},markerEnd:{type:Io.ArrowClosed,color:"hsl(var(--primary))"}},cae=[{id:"basic-concept-map",name:"Concept Map",description:"Central concept with labeled branches",category:"concept-map",mermaid:`graph TD
    A["Central Concept"]
    B["Related Idea 1"]
    C["Related Idea 2"]
    D["Related Idea 3"]
    E["Related Idea 4"]
    A -->|"causes"| B
    A -->|"includes"| C
    A -->|"affects"| D
    B -->|"leads to"| E`},{id:"process-flowchart",name:"Process Flowchart",description:"Linear process with decision point",category:"flowchart",mermaid:`graph TD
    A["Start / Input"]
    B["Step 1"]
    C{"Decision?"}
    D["Path A"]
    E["Path B"]
    F["Outcome"]
    A --> B
    B --> C
    C -->|"Yes"| D
    C -->|"No"| E
    D --> F
    E --> F`},{id:"clinical-decision-tree",name:"Clinical Decision Tree",description:"Presentation to diagnosis reasoning",category:"decision-tree",mermaid:`graph TD
    A["Patient Presentation"]
    B{"Key Finding 1?"}
    C{"Key Finding 2?"}
    D["Differential A"]
    E["Differential B"]
    F["Confirm: Test X"]
    G["Confirm: Test Y"]
    A --> B
    B -->|"Present"| D
    B -->|"Absent"| C
    C -->|"Positive"| E
    C -->|"Negative"| D
    D --> F
    E --> G`},{id:"physiological-pathway",name:"Physiological Pathway",description:"Stimulus to response cascade",category:"pathway",mermaid:`graph TD
    A["Stimulus"]
    B["Receptor / Sensor"]
    C["Signal Transduction"]
    D["Effector Response"]
    E["Outcome / Adaptation"]
    F["Feedback Loop"]
    A --> B
    B --> C
    C --> D
    D --> E
    E -->|"negative feedback"| A
    E -->|"modulates"| F
    F --> B`},{id:"compare-contrast",name:"Compare & Contrast",description:"Two concepts with shared and unique features",category:"compare",mermaid:`graph LR
    A["Concept A"]
    B["Shared Feature 1"]
    C["Shared Feature 2"]
    D["Concept B"]
    E["Unique to A"]
    F["Unique to B"]
    A --> B
    D --> B
    A --> C
    D --> C
    A --> E
    D --> F`}];function lae({mermaidInput:t,onMermaidInputChange:e,onImport:n,onBlank:r,className:s}){return h.jsxs("div",{className:is("flex flex-col items-center h-full p-4 gap-3 overflow-auto",s),children:[h.jsx("p",{className:"font-arcade text-[10px] text-primary",children:"CONCEPT MAP EDITOR"}),h.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground",children:"START FROM TEMPLATE"}),h.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-md",children:cae.map(i=>h.jsxs("button",{onClick:()=>n(i.mermaid),className:"border-2 border-secondary/50 hover:border-primary p-3 cursor-pointer text-left transition-colors bg-black/40",children:[h.jsx("p",{className:"font-terminal text-[10px] text-primary",children:i.name}),h.jsx("p",{className:"font-terminal text-[9px] text-muted-foreground mt-0.5",children:i.description})]},i.id))}),h.jsx("div",{className:"w-px h-2"}),h.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground",children:"OR PASTE MERMAID CODE"}),h.jsx(iB,{value:t,onChange:i=>e(i.target.value),placeholder:`graph TD
    A["Main Topic"]
    B["Subtopic 1"]
    C["Subtopic 2"]
    A --> B
    A --> C`,className:"w-full max-w-md h-32 font-mono text-xs rounded-none border-secondary bg-black/60"}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs(bt,{size:"sm",className:"font-terminal text-xs rounded-none",onClick:()=>n(t),disabled:!t.trim(),children:[h.jsx(NA,{className:"w-3 h-3 mr-1"}),"Import"]}),h.jsxs(bt,{size:"sm",variant:"outline",className:"font-terminal text-xs rounded-none",onClick:r,children:[h.jsx(LA,{className:"w-3 h-3 mr-1"}),"Blank Canvas"]})]})]})}function dae({initialMermaid:t,onSave:e,onInitialMermaidConsumed:n,className:r}){const[s,i,o]=sre([]),[a,c,l]=ire([]),[d,u]=_.useState("TB"),[p,f]=_.useState(!t&&s.length===0),[m,y]=_.useState(t||""),[S,g]=_.useState(0),[v,x]=_.useState(!1),[b,E]=_.useState(null),[I,C]=_.useState(!1),P=_.useRef(null),k=_.useRef(!1),{toast:T}=bA(),M=_.useCallback(D=>{if(!D.trim())return;const q=rae(D);u(q.direction);const U=Sx(q.nodes,q.edges,{direction:q.direction});i(U),c(q.edges),g(q.nodes.length),f(!1),C(!0)},[i,c]);_.useEffect(()=>{t?.trim()&&!k.current&&(k.current=!0,M(t),y(t),n?.())},[t,M,n]),_.useEffect(()=>{if(!v)return;const D=q=>{q.key==="Escape"&&x(!1)};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[v]);const A=_.useCallback(D=>{C(!0),o(D)},[o]),j=_.useCallback(D=>{C(!0),l(D)},[l]),R=_.useCallback(D=>{C(!0),c(q=>O3(D,q))},[c]),L=_.useCallback(()=>{const D=Sx(s,a,{direction:d});i(D),C(!0)},[s,a,d,i]),F=_.useCallback(()=>{const D=d==="TB"?"LR":"TB";u(D);const q=Sx(s,a,{direction:D});i(q),C(!0)},[d,s,a,i]),H=_.useCallback(()=>{const D=`N${S+1}`;g(U=>U+1);const q={id:D,type:"arcade",position:{x:Math.random()*300+50,y:Math.random()*200+50},data:{label:`New Node ${S+1}`,colorIdx:0}};i(U=>[...U,q]),C(!0)},[S,i]),B=_.useCallback(()=>{i(D=>D.filter(q=>!q.selected)),c(D=>D.filter(q=>!q.selected)),C(!0)},[i,c]),$=_.useCallback(D=>{i(q=>q.map(U=>U.selected?{...U,data:{...U.data,colorIdx:D}}:U)),E(null),C(!0)},[i]),Q=_.useCallback(D=>{c(q=>q.map(U=>U.selected?{...U,style:{...U.style,stroke:D,strokeWidth:2},markerEnd:{type:Io.ArrowClosed,color:D}}:U)),E(null),C(!0)},[c]),Z=_.useCallback(async()=>{if(P.current)try{const D=P.current.querySelector(".react-flow__viewport");if(!D)return;const q=await dB(D,{backgroundColor:"#000",quality:1}),U=document.createElement("a");U.download="concept-map.png",U.href=q,U.click(),T({title:"PNG exported"})}catch(D){T({title:"Export failed",description:String(D),variant:"destructive"})}},[T]),ee=_.useCallback(()=>{const D=yx(s,a,d);navigator.clipboard.writeText(D),T({title:"Mermaid copied to clipboard"})},[s,a,d,T]),ne=_.useCallback(async()=>{const D=yx(s,a,d),q=(s[0]?.data?.label||"Untitled").replace(/[/\\?%*:|"<>]/g,"-"),U=`---
type: concept-map
created: ${new Date().toISOString()}
---

# ${q} Concept Map

\`\`\`mermaid
${D}
\`\`\`
`,V=`Concept Maps/${q}.md`;try{await kA.obsidian.saveFile(V,U),T({title:"Saved to vault",description:V}),e?.(D),C(!1)}catch(te){T({title:"Save failed",description:String(te),variant:"destructive"})}},[s,a,d,T,e]),N=_.useCallback(()=>{f(!0),y(s.length>0?yx(s,a,d):"")},[s,a,d]);return p&&s.length===0?h.jsx(lae,{mermaidInput:m,onMermaidInputChange:y,onImport:M,onBlank:()=>{f(!1),H()},className:r}):h.jsxs("div",{className:is("flex flex-col",v?"fixed inset-0 z-[100010] bg-black":"h-full",r),children:[h.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-secondary/30 bg-black/40 shrink-0 flex-wrap",children:[h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:N,title:"Back to import",children:h.jsx(vB,{className:"w-3 h-3"})}),h.jsx("div",{className:"w-px h-4 bg-secondary/30"}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:H,title:"Add node",children:h.jsx(LA,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:B,title:"Delete selected",children:h.jsx(oB,{className:"w-3 h-3"})}),h.jsxs("div",{className:"relative",children:[h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:()=>E(b?null:"node"),title:"Color selected",children:h.jsx(AB,{className:"w-3 h-3"})}),b&&h.jsxs("div",{className:"absolute top-full left-0 mt-1 p-2 bg-black border-2 border-primary/50 z-50 space-y-2 min-w-[160px]",children:[h.jsx("p",{className:"font-terminal text-[9px] text-muted-foreground",children:"NODE COLORS"}),h.jsx("div",{className:"flex flex-wrap gap-1",children:ub.map((D,q)=>h.jsx("button",{onClick:()=>$(q),className:is("w-5 h-5 border-2 rounded-none",D.border,D.bg),title:D.name},D.name))}),h.jsx("p",{className:"font-terminal text-[9px] text-muted-foreground pt-1",children:"EDGE COLORS"}),h.jsx("div",{className:"flex flex-wrap gap-1",children:sae.map(D=>h.jsx("button",{onClick:()=>Q(D.stroke),className:"w-5 h-5 border-2 border-secondary/50 rounded-none",style:{backgroundColor:D.stroke},title:D.name},D.name))})]})]}),h.jsx("div",{className:"w-px h-4 bg-secondary/30"}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:L,title:"Auto layout",children:h.jsx(TB,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:F,title:`Direction: ${d}`,children:d==="TB"?h.jsx(_B,{className:"w-3 h-3"}):h.jsx(wB,{className:"w-3 h-3"})}),h.jsx("div",{className:"w-px h-4 bg-secondary/30"}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:ee,title:"Copy Mermaid",children:h.jsx(xB,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:Z,title:"Export PNG",children:h.jsx(jA,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:ne,title:"Save to vault",children:h.jsx(TA,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:()=>x(!v),title:v?"Exit fullscreen":"Fullscreen",children:v?h.jsx(uB,{className:"w-3 h-3"}):h.jsx(hB,{className:"w-3 h-3"})}),h.jsx(bt,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:()=>{f(!0),i([]),c([])},title:"Import Mermaid",children:h.jsx(NA,{className:"w-3 h-3"})}),h.jsxs("div",{className:"ml-auto flex items-center gap-2 text-[9px] font-terminal text-muted-foreground",children:[h.jsxs("span",{children:[s.length,"N / ",a.length,"E"]}),h.jsx("span",{className:is("w-2 h-2 rounded-full",I?"bg-destructive":"bg-success")}),h.jsx("span",{children:I?"Unsaved":"Saved"})]})]}),h.jsx("div",{className:"flex-1 min-h-0",ref:P,children:h.jsxs(rre,{nodes:s,edges:a,onNodesChange:A,onEdgesChange:j,onConnect:R,nodeTypes:oae,defaultEdgeOptions:aae,fitView:!0,className:"bg-black/80",proOptions:{hideAttribution:!0},onPaneClick:()=>E(null),children:[h.jsx(dre,{color:"hsl(var(--primary) / 0.1)",gap:20}),h.jsx(yre,{className:"!bg-black !border-primary [&_button]:!bg-black/80 [&_button]:!border-primary/50 [&_button]:!text-primary"}),h.jsx(Mre,{className:"!bg-black/80 !border-primary",nodeColor:"hsl(var(--primary))",maskColor:"rgba(0,0,0,0.5)"})]})})]})}const uae=[{id:"freehand",label:"Freehand"},{id:"structured",label:"Structured (Mermaid)"}];function ece({initialMermaid:t,onSave:e,className:n}){const[r,s]=_.useState("freehand"),[i,o]=_.useState(null),a=_.useCallback(l=>{o(l.trim()||null),s("structured")},[]),c=_.useCallback(()=>o(null),[]);return h.jsxs("div",{className:is("flex flex-col h-full",n),children:[h.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 border-b border-primary/20 bg-black/40 shrink-0",children:[uae.map(l=>h.jsx("button",{type:"button",onClick:()=>s(l.id),className:is("px-2 py-1 font-arcade text-[10px] transition-colors rounded-none",r===l.id?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:l.label},l.id)),h.jsx("span",{className:"text-[9px] font-terminal text-muted-foreground/50 ml-auto",children:r==="freehand"?"tldraw":"mermaid"})]}),h.jsx("div",{className:"flex-1 min-h-0",children:r==="freehand"?h.jsx(ree,{className:"h-full",onImportMermaid:a}):h.jsx(dae,{initialMermaid:i??t,onSave:e,onInitialMermaidConsumed:c,className:"h-full"})})]})}export{ece as ConceptMapEditor};
