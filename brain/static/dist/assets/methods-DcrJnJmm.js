import{c as J,j as e,r as o,X as K,a as he,u as pe}from"./index-4CVbsBQk.js";import{G as fe,B as C,g as A,i as T,k as I,l as O,t as G,f as R,u as k,L as ge,H as be,I as _,a as j}from"./layout-DTDTwpLP.js";import{S as L,a as D,b as M,c as B,d as w}from"./select-SoN992Q6.js";import{P as X,a as je,b as Ne,c as ye}from"./colors-BDuz-soV.js";import{C as ve}from"./clock-Cmoe-2XZ.js";import{Z as Ce}from"./zap-uP-RMNPG.js";import{A as Se,S as F}from"./star-Bi3RtInH.js";import{P}from"./plus-BYVo8TMr.js";import{T as ke}from"./trending-up-FtO2dfO2.js";import{P as U}from"./play-b67nlv8s.js";import{L as we}from"./loader-circle-eXlOaEx_.js";import{a as Ee,C as Re}from"./index-DkJAiPOa.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ee=J("chart-column",_e);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Te=J("link-2",Ae),W={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"};function $({block:a,compact:d,onClick:m,draggable:i,onDragStart:x}){const u=X[a.category]||je,s=u.border,r=u.badge,f=Ne[a.energy_cost]||ye;return d?e.jsx("div",{className:`border-2 ${s} p-2 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-terminal text-base truncate",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1 py-0.5 rounded-none ${r}`,children:W[a.category]||a.category.toUpperCase()})]})}):e.jsxs("div",{className:`border-2 ${s} p-3 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-arcade text-sm",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 rounded-none ${r}`,children:W[a.category]||a.category.toUpperCase()})]}),a.description&&e.jsx("p",{className:"font-terminal text-lg text-muted-foreground mb-2 line-clamp-2",children:a.description}),a.evidence&&e.jsx("p",{className:"font-terminal text-base text-primary/50 italic mb-2 line-clamp-1",children:a.evidence}),e.jsxs("div",{className:"flex items-center gap-3 text-base text-muted-foreground font-terminal",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),a.default_duration_min,"m"]}),e.jsxs("span",{className:`flex items-center gap-1 ${f}`,children:[e.jsx(Ce,{className:"w-4 h-4"}),a.energy_cost]}),a.best_stage&&e.jsx("span",{className:"text-primary/60",children:a.best_stage.replace("_"," ")})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags.slice(0,4).map(h=>e.jsx("span",{className:"text-sm font-terminal bg-secondary/30 px-1 py-0.5 text-muted-foreground",children:h},h))})]})}function Ie({chain:a,allBlocks:d,onSave:m,readOnly:i}){const[x,u]=o.useState(a.block_ids||[]),[s,r]=o.useState(!1),f=new Map(d.map(l=>[l.id,l])),h=x.map(l=>f.get(l)).filter(Boolean),g=l=>{const n=[...x];n.splice(l,1),u(n),m(n)},y=l=>{const n=[...x,l];u(n),m(n),r(!1)},b=l=>{if(l===0)return;const n=[...x];[n[l-1],n[l]]=[n[l],n[l-1]],u(n),m(n)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN BLOCKS"}),e.jsxs("span",{className:"text-[10px] font-terminal text-muted-foreground",children:["(",h.length," blocks)"]})]}),h.length===0&&e.jsx("div",{className:"border-2 border-dashed border-secondary p-4 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No blocks in this chain yet"})}),e.jsx("div",{className:"space-y-2",children:h.map((l,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!i&&e.jsx("button",{className:"text-muted-foreground hover:text-primary cursor-grab",onClick:()=>b(n),title:"Move up",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx($,{block:l,compact:!0})}),n<h.length-1&&e.jsx(Se,{className:"w-3 h-3 text-primary/40 shrink-0"}),!i&&e.jsx("button",{className:"text-muted-foreground hover:text-red-400",onClick:()=>g(n),children:e.jsx(K,{className:"w-3 h-3"})})]},`${l.id}-${n}`))}),!i&&e.jsx("div",{children:s?e.jsxs("div",{className:"border-2 border-primary/30 bg-black/50 p-3 space-y-2 max-h-48 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-[10px] text-primary",children:"ADD BLOCK"}),e.jsx("button",{onClick:()=>r(!1),children:e.jsx(K,{className:"w-3 h-3 text-muted-foreground"})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:d.map(l=>e.jsx($,{block:l,compact:!0,onClick:()=>y(l.id)},l.id))})]}):e.jsxs(C,{variant:"outline",size:"sm",className:"w-full rounded-none border-2 border-dashed border-secondary font-arcade text-xs",onClick:()=>r(!0),children:[e.jsx(P,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})})]})}function Oe({data:a}){const{block_stats:d,chain_stats:m,recent_ratings:i}=a,x=d.filter(s=>s.usage_count>0),u=m.filter(s=>s.usage_count>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ee,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"BLOCK EFFECTIVENESS"})]}),x.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings yet. Rate methods after study sessions to see analytics."}):e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-32 truncate",children:s.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:`h-full ${X[s.category]?.bar||"bg-primary"}`,style:{width:`${(s.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground w-8 text-right",children:s.avg_effectiveness??"—"}),e.jsxs("span",{className:"font-terminal text-[10px] text-muted-foreground w-6 text-right",children:["(",s.usage_count,")"]})]},s.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ke,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN COMPARISON"})]}),u.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No chain ratings yet."}):e.jsx("div",{className:"space-y-2",children:u.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-40 truncate",children:s.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${(s.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground w-8 text-right",children:s.avg_effectiveness??"—"})]},s.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(F,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"RECENT RATINGS"})]}),i.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings recorded yet."}):e.jsx("div",{className:"space-y-2",children:i.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between border border-secondary/50 p-2 rounded-none",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-terminal text-xs",children:s.method_name||s.chain_name||"Unknown"}),s.notes&&e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mt-0.5 truncate max-w-[200px]",children:s.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-terminal",children:[e.jsxs("span",{children:["E:",s.effectiveness,"/5"]}),e.jsxs("span",{children:["G:",s.engagement,"/5"]})]})]},s.id))})]})]})}function Z({value:a,onChange:d,label:m}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-arcade text-[10px] text-muted-foreground",children:m}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{onClick:()=>d(i),className:"p-0.5 hover:scale-110 transition-transform",children:e.jsx(F,{className:`w-5 h-5 ${i<=a?"text-primary fill-primary":"text-secondary"}`})},i))})]})}function Le({open:a,onClose:d,onSubmit:m,targetName:i,targetType:x}){const[u,s]=o.useState(0),[r,f]=o.useState(0),[h,g]=o.useState(""),y=()=>{u===0||r===0||(m({effectiveness:u,engagement:r,notes:h}),s(0),f(0),g(""),d())};return e.jsx(A,{open:a,onOpenChange:b=>!b&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(I,{className:"font-arcade text-xs text-primary",children:["RATE ",x.toUpperCase()]}),e.jsx(O,{className:"sr-only",children:"Rate the effectiveness and engagement of this method"}),e.jsx("button",{onClick:d,children:e.jsx(K,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"font-terminal text-sm",children:i}),e.jsx(Z,{value:u,onChange:s,label:"EFFECTIVENESS (did it help you learn?)"}),e.jsx(Z,{value:r,onChange:f,label:"ENGAGEMENT (did it hold your focus?)"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-arcade text-[10px] text-muted-foreground",children:"NOTES (optional)"}),e.jsx(G,{value:h,onChange:b=>g(b.target.value),placeholder:"What worked? What didn't?",className:"h-16 bg-secondary/20 border-2 border-secondary font-terminal text-sm rounded-none resize-none mt-1"})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:y,disabled:u===0||r===0,children:"SUBMIT RATING"})]})]})})}const De=["all","prepare","encode","interrogate","retrieve","refine","overlearn"],te={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"},Me=[{id:"library",label:"LIBRARY",icon:be},{id:"chains",label:"CHAINS",icon:Te},{id:"analytics",label:"ANALYTICS",icon:ee}];function Xe(){const[a,d]=o.useState("library"),[m,i]=o.useState("all"),[x,u]=o.useState(""),[s,r]=o.useState(!1),[f,h]=o.useState(!1),[g,y]=o.useState(null),[b,l]=o.useState(null),[n,S]=o.useState(null),[p,E]=o.useState(null),{toast:v}=he(),c=pe(),{data:Q=[],isLoading:H}=R({queryKey:["methods"],queryFn:()=>j.methods.getAll()}),{data:q=[],isLoading:se}=R({queryKey:["chains"],queryFn:()=>j.chains.getAll()}),{data:V,isLoading:ae}=R({queryKey:["methods-analytics"],queryFn:()=>j.methods.analytics(),enabled:a==="analytics"}),{data:re=[]}=R({queryKey:["courses-active"],queryFn:()=>j.courses.getActive(),enabled:!!n}),{data:z=[]}=R({queryKey:["chain-run-history"],queryFn:()=>j.chainRun.getHistory(),enabled:a==="chains"}),ne=k({mutationFn:j.methods.create,onSuccess:()=>{c.invalidateQueries({queryKey:["methods"]}),c.invalidateQueries({queryKey:["methods-analytics"]}),r(!1),v({title:"Method block created"})}}),ie=k({mutationFn:j.methods.delete,onSuccess:()=>{c.invalidateQueries({queryKey:["methods"]}),c.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Method block deleted"})}}),le=k({mutationFn:j.chains.create,onSuccess:()=>{c.invalidateQueries({queryKey:["chains"]}),c.invalidateQueries({queryKey:["methods-analytics"]}),h(!1),v({title:"Chain created"})}}),de=k({mutationFn:({id:t,data:N})=>j.chains.update(t,N),onSuccess:()=>{c.invalidateQueries({queryKey:["chains"]}),v({title:"Chain updated"})}}),ce=k({mutationFn:j.chains.delete,onSuccess:()=>{c.invalidateQueries({queryKey:["chains"]}),c.invalidateQueries({queryKey:["methods-analytics"]}),y(null),v({title:"Chain deleted"})}}),oe=k({mutationFn:({id:t,data:N})=>j.methods.rate(t,N),onSuccess:()=>{c.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),me=k({mutationFn:({id:t,data:N})=>j.chains.rate(t,N),onSuccess:()=>{c.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),Y=Q.filter(t=>!(m!=="all"&&t.category!==m||x&&!t.name.toLowerCase().includes(x.toLowerCase()))),xe=async t=>{const N=await j.chains.getOne(t.id);y(N)},ue=t=>{b&&(b.type==="method"?oe.mutate({id:b.id,data:t}):me.mutate({id:b.id,data:t}))};return e.jsx(ge,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-arcade text-xl text-primary",children:"METHOD_LIBRARY"}),e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Composable study methods — build, chain, rate, optimize"})]})}),e.jsx("div",{className:"flex gap-1 border-b-2 border-primary/30 pb-0",children:Me.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:`flex items-center gap-1.5 px-3 py-2 font-arcade text-sm border-b-2 -mb-[2px] transition-colors ${a===t.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(t.icon,{className:"w-3 h-3"}),t.label]},t.id))}),a==="library"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_,{placeholder:"Search methods...",value:x,onChange:t=>u(t.target.value),className:"w-64 bg-black/40"}),e.jsx("div",{className:"flex gap-1",children:De.map(t=>e.jsx("button",{onClick:()=>i(t),className:`px-3 py-1.5 font-arcade text-xs border-2 rounded-none transition-colors ${m===t?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50 hover:bg-black/30"}`,children:te[t]||t.toUpperCase()},t))}),e.jsxs(C,{variant:"outline",size:"sm",className:"ml-auto rounded-none border-2 font-arcade text-sm h-10",onClick:()=>r(!0),children:[e.jsx(P,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})]}),H?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading methods..."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Y.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsx($,{block:t}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx("button",{className:"p-1 bg-black/80 border border-primary/40 hover:border-primary",onClick:()=>l({id:t.id,name:t.name,type:"method"}),title:"Rate",children:e.jsx(F,{className:"w-3 h-3 text-primary"})}),e.jsx("button",{className:"p-1 bg-black/80 border border-destructive/40 hover:border-destructive text-destructive",onClick:()=>{confirm(`Delete "${t.name}"?`)&&ie.mutate(t.id)},title:"Delete",children:e.jsx("span",{className:"text-[10px]",children:"x"})})]})]},t.id))}),!H&&Y.length===0&&e.jsxs("p",{className:"font-terminal text-base text-muted-foreground text-center py-8",children:["No methods found. ",m!=="all"?"Try a different category.":"Add your first method block."]})]}),a==="chains"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-arcade text-sm text-muted-foreground",children:[q.length," CHAINS (",q.filter(t=>t.is_template).length," templates)"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-2 font-arcade text-sm h-10",onClick:()=>h(!0),children:[e.jsx(P,{className:"w-3 h-3 mr-1"})," NEW CHAIN"]})]}),se?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading chains..."}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:q.map(t=>e.jsxs("div",{onClick:()=>xe(t),className:`border-2 p-3 rounded-none cursor-pointer transition-colors ${g?.id===t.id?"border-primary bg-primary/10":"border-muted-foreground/30 hover:border-muted-foreground/50 hover:bg-black/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-sm",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_template?e.jsx("span",{className:"text-xs font-arcade bg-primary/20 text-primary px-1.5 py-0.5",children:"TEMPLATE"}):null,e.jsx("button",{className:"p-0.5 hover:text-success",onClick:N=>{N.stopPropagation(),S({id:t.id,name:t.name})},title:"Run chain",children:e.jsx(U,{className:"w-3 h-3"})}),e.jsx("button",{className:"p-0.5 hover:text-primary",onClick:N=>{N.stopPropagation(),l({id:t.id,name:t.name,type:"chain"})},children:e.jsx(F,{className:"w-3 h-3"})})]})]}),t.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground line-clamp-1",children:t.description}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:(t.block_ids||[]).length>0&&e.jsxs("span",{className:"text-sm font-terminal text-muted-foreground",children:[(t.block_ids||[]).length," blocks"]})})]},t.id))}),e.jsx("div",{className:"border-2 border-primary/30 bg-black/40 p-4 rounded-none",children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-arcade text-sm text-primary",children:g.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-2 border-success text-success font-arcade text-xs h-8",onClick:()=>S({id:g.id,name:g.name}),children:[e.jsx(U,{className:"w-3 h-3 mr-1"})," RUN"]}),!g.is_template&&e.jsx(C,{variant:"ghost",size:"sm",className:"text-destructive rounded-none text-xs font-arcade h-8",onClick:()=>{confirm(`Delete chain "${g.name}"?`)&&ce.mutate(g.id)},children:"DELETE"})]})]}),g.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:g.description}),e.jsx(Ie,{chain:g,allBlocks:Q,readOnly:!!g.is_template,onSave:t=>{de.mutate({id:g.id,data:{block_ids:t}})}})]}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Select a chain to view or edit"})})})]}),z.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-arcade text-sm text-muted-foreground",children:"RUN HISTORY"}),e.jsx("div",{className:"border-2 border-primary/30 rounded-none overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-primary/30 bg-black/60",children:[e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"CHAIN"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STATUS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STEPS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"DATE"})]})}),e.jsx("tbody",{children:z.slice(0,10).map(t=>e.jsxs("tr",{className:"border-b border-primary/20 hover:bg-primary/5 cursor-pointer",onClick:async()=>{const N=await j.chainRun.getOne(t.id);E(N)},children:[e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base",children:t.chain_name}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:t.topic}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 ${t.status==="completed"?"bg-success/20 text-success":t.status==="failed"?"bg-destructive/20 text-destructive":"bg-warning/20 text-warning"}`,children:t.status.toUpperCase()})}),e.jsxs("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:[t.current_step,"/",t.total_steps]}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:new Date(t.started_at).toLocaleDateString()})]},t.id))})]})})]})]}),a==="analytics"&&e.jsx("div",{children:ae?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading analytics..."}):V?e.jsx(Oe,{data:V}):e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Failed to load analytics."})}),e.jsx(Be,{open:s,onClose:()=>r(!1),onSubmit:t=>ne.mutate(t)}),e.jsx(Fe,{open:f,onClose:()=>h(!1),onSubmit:t=>le.mutate(t)}),n&&e.jsx(qe,{open:!!n,chainId:n.id,chainName:n.name,courses:re,onClose:()=>S(null),onComplete:t=>{E(t),S(null),c.invalidateQueries({queryKey:["chain-run-history"]}),v({title:`${t.chain_name} ${t.status}`})}}),p&&e.jsx(Ke,{open:!!p,result:p,onClose:()=>E(null)}),b&&e.jsx(Le,{open:!!b,onClose:()=>l(null),onSubmit:ue,targetName:b.name,targetType:b.type})]})})}function Be({open:a,onClose:d,onSubmit:m}){const[i,x]=o.useState(""),[u,s]=o.useState("prepare"),[r,f]=o.useState(""),[h,g]=o.useState(5),[y,b]=o.useState("medium"),[l,n]=o.useState(""),S=()=>{i.trim()&&(m({name:i.trim(),category:u,description:r.trim()||null,default_duration_min:h,energy_cost:y,best_stage:l||null,tags:[]}),x(""),f(""))};return e.jsx(A,{open:a,onOpenChange:p=>!p&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsx(I,{className:"font-arcade text-sm text-primary",children:"NEW METHOD BLOCK"}),e.jsx(O,{className:"sr-only",children:"Create a new method block"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(_,{placeholder:"Method name",value:i,onChange:p=>x(p.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsxs(L,{value:u,onValueChange:s,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["prepare","encode","interrogate","retrieve","refine","overlearn"].map(p=>e.jsx(w,{value:p,className:"font-terminal text-sm",children:te[p]||p.charAt(0).toUpperCase()+p.slice(1)},p))})]}),e.jsx(G,{placeholder:"Description (optional)",value:r,onChange:p=>f(p.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"DURATION"}),e.jsx(_,{type:"number",value:h,onChange:p=>g(Number(p.target.value)),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"ENERGY"}),e.jsxs(L,{value:y,onValueChange:b,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["low","medium","high"].map(p=>e.jsx(w,{value:p,className:"font-terminal text-sm",children:p},p))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"BEST STAGE"}),e.jsxs(L,{value:l,onValueChange:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"Any"})}),e.jsxs(B,{className:"bg-black border-2 border-primary rounded-none",children:[e.jsx(w,{value:"first_exposure",className:"font-terminal text-sm",children:"First Exposure"}),e.jsx(w,{value:"review",className:"font-terminal text-sm",children:"Review"}),e.jsx(w,{value:"exam_prep",className:"font-terminal text-sm",children:"Exam Prep"}),e.jsx(w,{value:"consolidation",className:"font-terminal text-sm",children:"Consolidation"})]})]})]})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:S,disabled:!i.trim(),children:"CREATE BLOCK"})]})]})})}function Fe({open:a,onClose:d,onSubmit:m}){const[i,x]=o.useState(""),[u,s]=o.useState(""),r=()=>{i.trim()&&(m({name:i.trim(),description:u.trim()||null,block_ids:[],context_tags:{},is_template:0}),x(""),s(""))};return e.jsx(A,{open:a,onOpenChange:f=>!f&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsx(I,{className:"font-arcade text-sm text-primary",children:"NEW CHAIN"}),e.jsx(O,{className:"sr-only",children:"Create a new method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(_,{placeholder:"Chain name",value:i,onChange:f=>x(f.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsx(G,{placeholder:"Description (optional)",value:u,onChange:f=>s(f.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsx("p",{className:"font-terminal text-sm text-muted-foreground",children:"Add blocks to the chain after creating it."}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:r,disabled:!i.trim(),children:"CREATE CHAIN"})]})]})})}function qe({open:a,chainId:d,chainName:m,courses:i,onClose:x,onComplete:u}){const[s,r]=o.useState(""),[f,h]=o.useState(""),[g,y]=o.useState(!0),[b,l]=o.useState(!0),[n,S]=o.useState(!1),[p,E]=o.useState(null),v=async()=>{if(s.trim()){S(!0),E(null);try{const c=await j.chainRun.start({chain_id:d,topic:s.trim(),course_id:f?Number(f):void 0,options:{write_obsidian:g,draft_cards:b}});u(c)}catch(c){E(c instanceof Error?c.message:"Chain run failed"),S(!1)}}};return e.jsx(A,{open:a,onOpenChange:c=>!c&&!n&&x(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsxs(I,{className:"font-arcade text-sm text-primary",children:["RUN: ",m]}),e.jsx(O,{className:"sr-only",children:"Configure and run a method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx(_,{placeholder:"e.g., Glenohumeral Joint Ligaments",value:s,onChange:c=>r(c.target.value),disabled:n,className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"COURSE (OPTIONAL)"}),e.jsxs(L,{value:f,onValueChange:h,disabled:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"None"})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:i.map(c=>e.jsx(w,{value:String(c.id),className:"font-terminal text-sm",children:c.name},c.id))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:c=>y(c.target.checked),disabled:n,className:"accent-primary"}),"Write to Obsidian"]}),e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:c=>l(c.target.checked),disabled:n,className:"accent-primary"}),"Draft Anki cards"]})]}),p&&e.jsx("p",{className:"font-terminal text-base text-destructive",children:p}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:v,disabled:!s.trim()||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-3 h-3 mr-2 animate-spin"}),"RUNNING..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3 h-3 mr-1"})," START"]})}),n&&e.jsx("p",{className:"font-terminal text-sm text-muted-foreground text-center",children:"This may take 15-45 seconds depending on chain length."})]})]})})}function Ke({open:a,result:d,onClose:m}){const[i,x]=o.useState(new Set([1])),u=r=>{x(f=>{const h=new Set(f);return h.has(r)?h.delete(r):h.add(r),h})},s=d.artifacts?.metrics;return e.jsx(A,{open:a,onOpenChange:r=>!r&&m(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{className:"font-arcade text-sm text-primary flex items-center gap-2",children:[d.chain_name," RESULTS",e.jsx("span",{className:`text-xs px-1.5 py-0.5 ${d.status==="completed"?"bg-success/20 text-success":"bg-destructive/20 text-destructive"}`,children:d.status.toUpperCase()})]}),e.jsx(O,{className:"sr-only",children:"Chain run results"}),s&&e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"DURATION"}),e.jsxs("span",{className:"font-terminal text-sm",children:[(s.total_duration_ms/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"STEPS"}),e.jsx("span",{className:"font-terminal text-sm",children:s.steps_completed})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"CARDS"}),e.jsx("span",{className:"font-terminal text-sm",children:s.cards_drafted})]}),d.artifacts?.obsidian_path&&e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"OBSIDIAN"}),e.jsx("span",{className:"font-terminal text-sm text-success",children:"saved"})]})]}),e.jsx("div",{className:"space-y-2 mt-3",children:d.steps.map(r=>e.jsxs("div",{className:"border border-primary/30 rounded-none",children:[e.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-primary/5 text-left",onClick:()=>u(r.step),children:[i.has(r.step)?e.jsx(Ee,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}):e.jsx(Re,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"font-arcade text-xs text-primary",children:[r.step,"."]}),e.jsx("span",{className:"font-terminal text-base",children:r.method_name}),e.jsxs("span",{className:"ml-auto font-terminal text-sm text-muted-foreground",children:[r.category," | ",(r.duration_ms/1e3).toFixed(1),"s"]})]}),i.has(r.step)&&e.jsx("div",{className:"px-3 pb-3 border-t border-primary/20",children:e.jsx("pre",{className:"font-terminal text-base text-muted-foreground whitespace-pre-wrap mt-2 leading-relaxed",children:r.output})})]},r.step))}),d.error&&e.jsxs("div",{className:"mt-3 border border-destructive/40 bg-destructive/10 px-3 py-2",children:[e.jsx("span",{className:"font-arcade text-xs text-destructive",children:"ERROR: "}),e.jsx("span",{className:"font-terminal text-base text-destructive/80",children:d.error})]}),e.jsx(C,{variant:"outline",className:"w-full mt-3 font-arcade rounded-none text-xs",onClick:m,children:"CLOSE"})]})})}export{Xe as default};
