import{c as ee,j as e,b as Re,r,X as pe,u as fe}from"./index-Ney09JIT.js";import{f as se,a as A,S as ge,E as be,F as Pe,B as I,G as Ie,o as ye,p as Fe,n as Te,L as xe}from"./layout-DrTDpAPS.js";import{B as L,C as je}from"./badge-CxmU_6k5.js";import{I as v,T as f,d as J,e as H,f as te,P as ae,g as Ae,h as Ne,i as ke,j as Ue,b as qe}from"./theme-DVlXyDCo.js";import{C as le}from"./checkbox-ntfrV4kT.js";import{M as Ke,t as _}from"./MaterialUploader-BM3qjl6i.js";import{L as ve}from"./loader-circle-Cukh0dGl.js";import{F as de}from"./file-text-D2AIgzrF.js";import{C as De,a as ze}from"./index-BYJaSdCW.js";import{C as ne}from"./clock-DeGtxXW9.js";import{D as Ge,M as Qe,r as Be,F as Oe,P as Ve}from"./index-D4azcMu8.js";import{L as Xe}from"./link-DDwGf3-Y.js";import{Z as Ye}from"./zap-DLu7O9vm.js";import{S as He}from"./square-0Cn_Nc41.js";import{S as Ze}from"./send-CjlLm_ad.js";import{M as ce}from"./message-square-BM-TphxK.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Je=ee("cloud",We);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Le=ee("credit-card",es);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],ts=ee("cpu",ss);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],as=ee("globe",rs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Me=ee("map",ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]],os=ee("panel-right-close",is);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],cs=ee("settings-2",ls);function re({className:s,...i}){return e.jsx("div",{className:Re("animate-pulse rounded-md bg-primary/10",s),...i})}const ds={pdf:"PDF",docx:"DOC",pptx:"PPT",md:"MD",txt:"TXT"};function ms({courseId:s,selectedMaterials:i,setSelectedMaterials:w}){const{data:k=[],isLoading:h}=se({queryKey:["tutor-materials",s],queryFn:()=>A.tutor.getMaterials(s?{course_id:s}:void 0)}),T=c=>{w(i.includes(c)?i.filter(M=>M!==c):[...i,c])},g=()=>{i.length===k.length?w([]):w(k.map(c=>c.id))};return h?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx(ve,{className:`${v} animate-spin text-muted-foreground`})}):k.length===0?e.jsx("div",{className:`${f} text-center py-2`,children:"No materials uploaded yet"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${J} text-muted-foreground hover:text-foreground cursor-pointer border-b border-muted-foreground/10 pb-1`,children:[e.jsx(le,{checked:k.length>0&&i.length===k.length,onCheckedChange:g,className:"w-3 h-3"}),e.jsx("span",{children:"Select all"}),e.jsxs(L,{variant:"outline",className:`ml-auto ${H} h-4 px-1`,children:[i.length,"/",k.length]})]}),k.map(c=>e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${J} text-muted-foreground hover:text-foreground cursor-pointer`,children:[e.jsx(le,{checked:i.includes(c.id),onCheckedChange:()=>T(c.id),className:"w-3 h-3"}),e.jsx(de,{className:`${v} text-primary/60 shrink-0`}),e.jsx("span",{className:"truncate flex-1",children:c.title}),e.jsx(L,{variant:"outline",className:`${H} h-4 px-1 shrink-0`,children:ds[c.file_type]||c.file_type.toUpperCase()})]},c.id))]})}const Ce=["prepare","encode","interrogate","retrieve","refine","overlearn"];function xs({selectedBlockIds:s,setSelectedBlockIds:i}){const{data:w=[],isLoading:k}=se({queryKey:["tutor-method-blocks"],queryFn:()=>A.tutor.getMethodBlocks()}),[h,T]=r.useState(new Set),[g,c]=r.useState(null),[M,x]=r.useState(null),b=r.useMemo(()=>{const t=new Map;for(const a of w)t.set(a.id,a);return t},[w]),$=r.useMemo(()=>{const t={};for(const a of Ce)t[a]=[];for(const a of w)t[a.category]||(t[a.category]=[]),t[a.category].push(a);return t},[w]),m=r.useMemo(()=>s.map(t=>b.get(t)).filter(Boolean),[s,b]),D=r.useMemo(()=>m.reduce((t,a)=>t+(a.default_duration_min||0),0),[m]),q=t=>{T(a=>{const y=new Set(a);return y.has(t)?y.delete(t):y.add(t),y})},o=t=>{i([...s,t])},p=t=>{i(s.filter((a,y)=>y!==t))},C=t=>{c(t)},l=(t,a)=>{t.preventDefault(),x(a)},j=t=>{if(g===null||g===t){c(null),x(null);return}const a=[...s],[y]=a.splice(g,1);a.splice(t,0,y),i(a),c(null),x(null)},N=()=>{c(null),x(null)};return k?e.jsx("div",{className:`${f} p-2`,children:"Loading blocks..."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`${te} text-xs`,children:"BLOCK PICKER"}),e.jsx(ge,{className:"h-36 border-2 border-primary/30 bg-black/20",children:e.jsx("div",{className:"p-1",children:Ce.map(t=>{const a=$[t]||[];if(a.length===0)return null;const y=h.has(t),R=be[t];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>q(t),className:"w-full flex items-center gap-1 px-2 py-1 text-left hover:bg-black/30 transition-colors",children:[y?e.jsx(De,{className:"w-3 h-3",style:{color:R}}):e.jsx(ze,{className:"w-3 h-3",style:{color:R}}),e.jsxs("span",{className:"font-arcade text-xs uppercase",style:{color:R},children:[Pe[t]," (",a.length,")"]})]}),!y&&e.jsx("div",{className:"pl-4 pb-1 space-y-0.5",children:a.map(P=>e.jsxs("button",{onClick:()=>o(P.id),className:"w-full text-left px-2 py-1 text-xs font-terminal text-foreground/80 hover:bg-primary/10 hover:text-foreground transition-colors flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:P.name}),e.jsxs("span",{className:`${f} text-xs shrink-0 ml-2`,children:["~",P.default_duration_min,"m"]})]},P.id))})]},t)})})}),e.jsxs("div",{className:`${te} text-xs flex items-center justify-between`,children:[e.jsx("span",{children:"YOUR CHAIN"}),m.length>0&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>i([]),className:"h-5 px-2 text-xs font-arcade text-destructive hover:text-destructive",children:"CLEAR"})]}),e.jsx("div",{className:"border-2 border-primary/30 bg-black/20 min-h-[60px]",children:m.length===0?e.jsx("div",{className:`${f} text-xs p-3 text-center`,children:"Click blocks above to build your study chain"}):e.jsx("div",{className:"p-1 space-y-0.5",children:m.map((t,a)=>{const y=be[t.category]||"#888";return e.jsxs("div",{draggable:!0,onDragStart:()=>C(a),onDragOver:R=>l(R,a),onDrop:()=>j(a),onDragEnd:N,className:`flex items-center gap-1 px-2 py-1 border transition-all ${M===a?"border-primary bg-primary/20":"border-primary/20 bg-black/30"}`,children:[e.jsx(Ie,{className:"w-3 h-3 text-muted-foreground/40 cursor-grab shrink-0"}),e.jsx(L,{variant:"outline",className:"text-xs rounded-none px-1 h-4 shrink-0",style:{borderColor:y,color:y},children:t.category.slice(0,3).toUpperCase()}),e.jsx("span",{className:"font-terminal text-xs text-foreground/80 truncate flex-1",children:t.name}),e.jsxs("span",{className:`${f} text-xs shrink-0`,children:["~",t.default_duration_min,"m"]}),e.jsx("button",{onClick:()=>p(a),className:"shrink-0 text-muted-foreground/40 hover:text-destructive transition-colors",children:e.jsx(pe,{className:"w-3 h-3"})})]},`${t.id}-${a}`)})})}),m.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("span",{className:`${f} text-xs`,children:[m.length," block",m.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1 font-terminal text-xs text-primary",children:[e.jsx(ne,{className:v}),"~",D," min"]})]})]})}const oe=[{value:"arcee-ai/trinity-large-preview:free",label:"Trinity Large (free)"},{value:"qwen/qwen3-coder-next",label:"Qwen3 Coder Next"},{value:"google/gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite"}],us=["Teaching Sprint","Diagnostic Sprint"],Se={Core:"First Exposure (Core)",Sprint:"Review Sprint","Quick Sprint":"Quick Drill",Light:"Low Energy",Drill:"Mastery Review","Teaching Sprint":"First Exposure (Core)","Diagnostic Sprint":"Review Sprint"},we="tutor.autopick_chain.v1",_e="tutor.last_openrouter_model.v1",$e="tutor.last_codex_model.v1";function he(s){try{return localStorage.getItem(s)}catch{return null}}function ue(s,i){try{localStorage.setItem(s,i)}catch{}}function hs(s,i){const w=he(s);return w===null?i:w==="true"}function W({children:s,icon:i}){return e.jsxs("div",{className:`${te} flex items-center gap-1.5 pb-1 border-b border-primary/20 mb-2`,children:[i,s]})}function Ee({courseId:s,setCourseId:i,selectedMaterials:w,setSelectedMaterials:k,mode:h,setMode:T,chainId:g,setChainId:c,customBlockIds:M,setCustomBlockIds:x,topic:b,setTopic:$,model:m,setModel:D,webSearch:q,setWebSearch:o,onStartSession:p,isStarting:C,hasActiveSession:l}){const{data:j,isLoading:N,isError:t}=se({queryKey:["tutor-content-sources"],queryFn:()=>A.tutor.getContentSources()}),{data:a=[],isLoading:y,isError:R}=se({queryKey:["tutor-template-chains"],queryFn:()=>A.tutor.getTemplateChains()}),{data:P=[],isLoading:K}=se({queryKey:["courses-active"],queryFn:()=>A.courses.getActive()}),z=j?.openrouter_enabled??!1,E=m.includes("/")?"openrouter":"codex";r.useEffect(()=>{!z&&E==="openrouter"&&D("codex")},[z,E,D]),r.useEffect(()=>{m&&(m.includes("/")?ue(_e,m):ue($e,m))},[m]);const[F,G]=r.useState(()=>hs(we,!0)),[Q,B]=r.useState(null),[Z,O]=r.useState("templates");r.useEffect(()=>{ue(we,String(F))},[F]);const U=Se[h],u=r.useMemo(()=>{if(U)return a.find(n=>n.name===U)},[a,U]);r.useEffect(()=>{F&&g===void 0&&u&&Q!==h&&(c(u.id),B(h))},[F,g,u?.id,Q,h,c]);const V=n=>{if(T(n),!F||g!==void 0)return;const d=Se[n];if(!d)return;const S=a.find(X=>X.name===d);S&&(c(S.id),B(n))},ie=()=>{const n=he($e),d=n&&!n.includes("/")?n:"codex";D(d)},me=()=>{if(!z)return;const n=he(_e),d=n&&n.includes("/")?n:oe[0].value;D(d)};return r.useEffect(()=>{E==="openrouter"&&(oe.some(n=>n.value===m)||D(oe[0].value))},[E,m,D]),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`shrink-0 ${ae} pb-2 border-b-2 border-primary/30`,children:[e.jsx("div",{className:Ae,children:"CONTENT FILTER"}),(t||R)&&e.jsxs("div",{className:`${f} text-destructive`,children:["Tutor API unavailable. Start the dashboard via ",e.jsx("span",{className:"font-arcade",children:"Start_Dashboard.bat"}),"."]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 ${f}`,children:[e.jsx(Ge,{className:v}),j?.total_materials??0," materials",e.jsx("span",{className:"text-muted-foreground/40",children:"|"}),j?.total_instructions??0," SOP"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsxs("div",{className:`${ae} space-y-2`,children:[e.jsxs("div",{children:[e.jsx(W,{children:"Mode"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>V("Core"),className:`text-left px-2 py-2 border-2 transition-colors ${h==="Core"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LEARN"}),e.jsx("div",{className:`${f} text-xs leading-tight truncate`,children:"Prime + encode"})]}),e.jsxs("button",{onClick:()=>V("Quick Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${h==="Quick Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"QUICK"}),e.jsx("div",{className:`${f} text-xs leading-tight truncate`,children:"Quick retrieval"})]})]}),e.jsx("button",{onClick:()=>V("Drill"),className:`w-full text-left px-2 py-2 border-2 transition-colors ${h==="Drill"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"FIX"}),e.jsx("div",{className:`${f} text-xs leading-tight`,children:"Target weak spots"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>V("Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${h==="Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"REVIEW"}),e.jsx("div",{className:`${f} text-xs leading-tight truncate`,children:"Retrieve + refine"})]}),e.jsxs("button",{onClick:()=>V("Light"),className:`text-left px-2 py-2 border-2 transition-colors ${h==="Light"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LIGHT"}),e.jsx("div",{className:`${f} text-xs leading-tight truncate`,children:"Low energy"})]})]})]}),e.jsx("div",{className:`${f} text-xs mt-2`,children:"Auto-picks a chain template. Override below."}),us.includes(h)&&e.jsxs("div",{className:`${f} text-xs mt-1`,children:["Legacy mode active: ",h]})]}),e.jsxs("div",{children:[e.jsx(W,{icon:e.jsx(Xe,{className:v}),children:"Chain"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mb-2 min-w-0",children:[e.jsx("button",{onClick:()=>O("templates"),className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${Z==="templates"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"TEMPLATES"}),e.jsx("button",{onClick:()=>{O("custom"),c(void 0)},className:`px-1.5 py-1 border-2 font-arcade text-xs truncate transition-colors ${Z==="custom"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50"}`,children:"CUSTOM"})]}),Z==="templates"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:`${f} text-xs min-w-0 truncate`,children:[e.jsx("span",{className:"opacity-70",children:"Rec:"})," ",u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground font-medium",children:u.name}),e.jsxs(L,{variant:"outline",className:`ml-1 ${H} h-4 px-1.5 text-xs`,children:[u.blocks.length," blocks"]})]}):y?e.jsx(re,{className:"inline-block w-20 h-4 bg-primary/10"}):e.jsx("span",{className:"opacity-70",children:"—"})]}),u&&g!==u.id&&e.jsx(I,{size:"sm",onClick:()=>c(u.id),className:"rounded-none h-6 px-2 font-arcade text-xs bg-primary text-primary-foreground hover:bg-primary/90 border border-primary",children:"APPLY"})]}),e.jsxs("label",{className:`flex items-center gap-2 ${J} text-muted-foreground mb-2 cursor-pointer`,children:[e.jsx(le,{checked:F,onCheckedChange:n=>G(n===!0),className:"w-3 h-3"}),e.jsx("span",{className:"select-none text-xs",children:"Auto-pick recommended chain"})]}),e.jsx(ge,{className:"h-40 border-2 border-primary/30 bg-black/20",children:e.jsxs("div",{className:"p-1 space-y-1",children:[e.jsx("button",{onClick:()=>{c(void 0),B(h)},className:`w-full text-left px-3 py-2 border-2 transition-all ${g?"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30":"border-primary bg-primary/20 text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs",children:"FREEFORM"}),e.jsx("div",{className:`${f} text-xs`,children:"No template"})]}),!g&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),y?e.jsxs("div",{className:"space-y-2 p-2",children:[e.jsx(re,{className:"w-full h-10 bg-primary/10"}),e.jsx(re,{className:"w-full h-10 bg-primary/10"}),e.jsx(re,{className:"w-full h-10 bg-primary/10"})]}):a.map(n=>e.jsx("button",{onClick:()=>c(n.id),className:`w-full text-left px-3 py-2 border-2 transition-all ${g===n.id?"border-primary bg-primary/20 text-primary":"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-arcade text-xs truncate",children:n.name.toUpperCase()}),e.jsxs("div",{className:`${f} text-xs`,children:[n.blocks.length," blocks"]})]}),g===n.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary ml-2"})]})},n.id))]})})]}):e.jsx(xs,{selectedBlockIds:M,setSelectedBlockIds:x})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Topic"}),e.jsx("input",{value:b,onChange:n=>$(n.target.value),placeholder:"e.g. Hip Flexors",className:`${Ne} border-2 border-primary/30`})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Model"}),e.jsxs("div",{className:"space-y-1 mb-2",children:[e.jsx("button",{onClick:ie,className:`w-full text-left px-3 py-2 border-2 transition-colors ${E==="codex"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:v}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"CODEX"}),e.jsx("div",{className:`${f} text-xs leading-tight`,children:"ChatGPT login"})]})]}),E==="codex"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),e.jsx("button",{onClick:me,disabled:!z,className:`w-full text-left px-3 py-2 border-2 transition-colors ${E==="openrouter"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"} ${z?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:v}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"OPENROUTER"}),e.jsx("div",{className:`${f} text-xs leading-tight`,children:z?"API key enabled":"API key missing"})]})]}),E==="openrouter"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})})]}),E==="openrouter"?e.jsx("select",{value:m,onChange:n=>D(n.target.value),className:`${ke} border-2 border-primary/30`,children:oe.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}):e.jsx("input",{value:m==="codex"?"":m,onChange:n=>D(n.target.value.trim()?n.target.value:"codex"),placeholder:"Codex model override (optional)",className:`${Ne} border-2 border-primary/30`})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${E!=="codex"?"opacity-50":""}`,children:[e.jsx(le,{checked:q,onCheckedChange:n=>E==="codex"&&o(!!n),disabled:E!=="codex"}),e.jsx(as,{className:v}),e.jsx("span",{className:`${J} text-xs`,children:"Web search"}),E!=="codex"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Codex only)"})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Course"}),K?e.jsx(re,{className:"w-full h-10 bg-primary/10"}):e.jsxs("select",{value:s??"",onChange:n=>i(n.target.value?Number(n.target.value):void 0),className:`${ke} border-2 border-primary/30`,children:[e.jsx("option",{value:"",children:"All courses"}),P.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsx(W,{icon:e.jsx(de,{className:v}),children:"Materials"}),e.jsx(ms,{courseId:s,selectedMaterials:w,setSelectedMaterials:k})]}),e.jsxs("div",{className:"border-t border-primary/10 pt-2",children:[e.jsx(W,{children:"Upload"}),e.jsx(Ke,{courseId:s})]})]})}),e.jsx("div",{className:`shrink-0 ${ae} pt-2 border-t-2 border-primary/30`,children:e.jsxs(I,{onClick:p,disabled:C||l,className:`w-full rounded-none border-2 font-arcade text-xs h-9 ${l?"border-success/50 bg-success/10 text-success cursor-default":C?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[C?e.jsx(ve,{className:`${v} animate-spin mr-1`}):l?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success animate-pulse"}),"SESSION ACTIVE"]}):e.jsx(Ye,{className:`${v} mr-1`}),!C&&!l&&"START SESSION"]})})]})}function ps({sessionId:s,onArtifactCreated:i,onSessionEnd:w,chainBlocks:k=[],currentBlockIndex:h=0,onAdvanceBlock:T}){const g=k.length>0,c=g&&h>=k.length,[M,x]=r.useState([]),[b,$]=r.useState(""),[m,D]=r.useState(!1),q=r.useRef(null),o=r.useRef(null);r.useEffect(()=>{q.current&&(q.current.scrollTop=q.current.scrollHeight)},[M]),r.useEffect(()=>{o.current?.focus()},[s]);const p=r.useCallback(async()=>{if(!b.trim()||!s||m)return;const l=b.trim();$("");const j=/^\/(note|save)\b/i.test(l),N=/^\/(card|flashcard)\b/i.test(l),t=/^\/(map|diagram)\b/i.test(l);x(a=>[...a,{role:"user",content:l}]),x(a=>[...a,{role:"assistant",content:"",isStreaming:!0}]),D(!0);try{const y=(await fetch(`/api/tutor/session/${s}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l})})).body?.getReader(),R=new TextDecoder;if(!y)throw new Error("No response body");let P="",K="",z=[],E;for(;;){const{done:F,value:G}=await y.read();if(F)break;P+=R.decode(G,{stream:!0});const Q=P.split(`
`);P=Q.pop()??"";for(const B of Q){if(!B.startsWith("data: "))continue;const Z=B.slice(6);if(Z==="[DONE]")break;try{const O=JSON.parse(Z);if(O.type==="error"){x(U=>{const u=[...U];return u[u.length-1]={role:"assistant",content:`Error: ${O.content}`},u}),D(!1);return}O.type==="web_search_searching"&&x(U=>{const u=[...U];return u[u.length-1]={...u[u.length-1],content:`Searching the web...

`,isStreaming:!0},u}),O.type==="web_search_completed"&&(K="",x(U=>{const u=[...U];return u[u.length-1]={...u[u.length-1],content:"",isStreaming:!0},u})),O.type==="token"&&O.content&&(K+=O.content,x(U=>{const u=[...U],V=u[u.length-1];return u[u.length-1]={...V,content:V.content+O.content,isStreaming:!0},u})),O.type==="done"&&(z=O.citations??[],E=O.model)}catch{}}}x(F=>{const G=[...F];return G[G.length-1]={role:"assistant",content:K,citations:z,model:E,isStreaming:!1},G}),(j||N||t)&&i({type:j?"note":N?"card":"map",content:K,title:l.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(a){x(y=>{const R=[...y];return R[R.length-1]={role:"assistant",content:`Connection error: ${a instanceof Error?a.message:"Unknown"}`},R})}finally{D(!1)}},[b,s,m,i]),C=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),p())};return s?e.jsxs("div",{className:"flex flex-col h-full",children:[g&&e.jsxs("div",{className:"shrink-0 px-3 py-2 border-b-2 border-primary/30 bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto",children:[k.map((l,j)=>{const N=j<h,t=j===h&&!c;return e.jsxs("div",{className:"flex items-center shrink-0",children:[j>0&&e.jsx(De,{className:"w-4 h-4 text-muted-foreground/40 mx-0.5"}),e.jsxs("div",{className:`px-2 py-1 border-2 text-base font-terminal flex items-center gap-1 ${t?"border-primary bg-primary/20 text-primary":N?"border-primary/30 bg-primary/5 text-muted-foreground/70 line-through":"border-primary/20 text-muted-foreground/50"}`,children:[N&&e.jsx(ye,{className:"w-4 h-4"}),l.name]})]},l.id)}),!c&&T&&e.jsx("button",{onClick:T,className:"shrink-0 ml-2 px-3 py-1 border-2 border-primary/60 text-xs font-arcade text-primary hover:bg-primary/20 transition-colors",children:"NEXT"}),c&&e.jsx("span",{className:"shrink-0 ml-2 px-3 py-1 text-xs font-arcade text-green-400 border-2 border-green-400/50",children:"COMPLETE"})]}),!c&&k[h]&&e.jsxs("div",{className:"mt-1 text-base font-terminal text-muted-foreground",children:[e.jsx("span",{className:"text-primary",children:k[h].category.toUpperCase()})," ","· ~",k[h].duration,"min"]})]}),e.jsxs("div",{ref:q,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[M.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-primary",children:"SESSION STARTED"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),M.map((l,j)=>e.jsx("div",{className:`flex ${l.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-lg font-terminal ${l.role==="user"?"bg-primary/20 border-2 border-primary/50 text-foreground":"bg-black/40 border-2 border-primary/20 text-foreground"}`,children:[l.role==="assistant"?e.jsxs("div",{className:"prose prose-invert prose-lg max-w-none font-terminal [&_p]:my-2 [&_li]:my-1 [&_code]:text-base [&_pre]:text-base",children:[e.jsx(Qe,{remarkPlugins:[Be],children:l.content||(l.isStreaming?"...":"")}),l.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):e.jsx("div",{children:l.content}),(l.citations?.length||l.model)&&!l.isStreaming?e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-2 pt-2 border-t border-primary/20",children:[l.citations?.map(N=>N.url?e.jsx("a",{href:N.url,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(L,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",children:["[",N.index,"] ",N.source]})},N.index):e.jsxs(L,{variant:"outline",className:"text-sm rounded-none",children:["[",N.index,"] ",N.source]},N.index)),l.model&&e.jsx(L,{variant:"outline",className:"text-sm rounded-none text-muted-foreground/60 ml-auto",children:l.model})]}):null]})},j))]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-t border-primary/20",children:[e.jsx("span",{className:"text-base font-terminal text-muted-foreground/60",children:"Commands:"}),e.jsxs(L,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/note "),children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"/note"]}),e.jsxs(L,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/card "),children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),"/card"]}),e.jsxs(L,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>$("/map "),children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"/map"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(I,{variant:"ghost",size:"sm",onClick:w,className:"text-sm font-terminal text-destructive hover:text-destructive h-8 px-3",children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),"END"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-primary/20",children:[e.jsx("input",{ref:o,value:b,onChange:l=>$(l.target.value),onKeyDown:C,placeholder:"Ask a question...",disabled:m,className:"flex-1 bg-black/60 border-2 border-primary/40 rounded-none px-3 py-2 text-lg font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),e.jsx(I,{onClick:p,disabled:!b.trim()||m,className:"rounded-none border-2 border-primary h-11 w-11 p-0",children:m?e.jsx(ve,{className:"w-5 h-5 animate-spin"}):e.jsx(Ze,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const fs={note:de,card:Le,map:Me},gs={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function ys({sessionId:s,artifacts:i,turnCount:w,mode:k,topic:h,startedAt:T,recentSessions:g,onResumeSession:c}){const M=fe(),[x,b]=r.useState(null),[$,m]=r.useState(null),D=async o=>{try{await A.tutor.deleteSession(o),_.success("Session deleted"),M.invalidateQueries({queryKey:["tutor-sessions"]}),b(null)}catch(p){_.error(`Delete failed: ${p instanceof Error?p.message:"Unknown"}`)}},q=async o=>{m(o.session_id);try{const p=await A.tutor.getSession(o.session_id);if(!p.turns||p.turns.length===0){_.error("No turns to save");return}const C=[`# Tutor: ${o.topic||o.mode}`,`**Date:** ${new Date(o.started_at).toLocaleDateString()}`,`**Mode:** ${o.mode} | **Turns:** ${o.turn_count}`,"","---",""];for(const N of p.turns)C.push(`## Q${N.turn_number}`),C.push(N.question),C.push(""),N.answer&&(C.push("**Answer:**"),C.push(N.answer),C.push(""));const j=`Study Sessions/${`Tutor - ${(o.topic||o.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`}.md`;await A.obsidian.append(j,C.join(`
`)),_.success(`Saved to Obsidian: ${j}`)}catch(p){_.error(`Save failed: ${p instanceof Error?p.message:"Unknown"}`)}finally{m(null)}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${ae} pb-2 border-b-2 border-primary/30`,children:e.jsx("div",{className:Ae,children:"ARTIFACTS"})}),e.jsx(ge,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${ae} space-y-3`,children:[s?e.jsxs("div",{className:"space-y-2 pb-3 border-b border-muted-foreground/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(L,{variant:"outline",className:`${H} h-5 px-1.5`,children:k}),e.jsx(L,{variant:"outline",className:`${H} h-5 px-1.5 text-primary`,children:"FIRST PASS"})]}),h&&e.jsx("div",{className:`${J} text-sm`,children:h}),e.jsxs("div",{className:`flex items-center gap-3 ${f}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:v}),w," turns"]}),T&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:v}),new Date(T).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):e.jsx("div",{className:`${J} text-muted-foreground/50 py-3 text-center`,children:"No active session"}),i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:te,children:"Artifacts"}),i.map((o,p)=>{const C=fs[o.type],l=gs[o.type];return e.jsxs("div",{className:"border-2 border-muted-foreground/20 p-2.5 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(C,{className:`${Ue} ${l}`}),e.jsx("span",{className:`${J} text-sm truncate flex-1`,children:o.title||`${o.type} #${p+1}`})]}),o.content&&e.jsx("div",{className:`${f} mt-1 line-clamp-2`,children:o.content.slice(0,100)})]},p)})]}),s&&i.length===0&&e.jsxs("div",{className:"text-center space-y-1 py-4",children:[e.jsx(Fe,{className:`${qe} text-muted-foreground/30 mx-auto`}),e.jsx("div",{className:`${f} text-muted-foreground/50`,children:"No artifacts yet"}),e.jsx("div",{className:`${f} text-muted-foreground/30`,children:"Use /note, /card, or /map"})]}),g.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-muted-foreground/20",children:[e.jsx("div",{className:te,children:"Recent Sessions"}),g.slice(0,8).map(o=>e.jsxs("div",{className:"border-2 border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>c(o.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:`${H} h-5 px-1.5 shrink-0 ${o.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:o.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:o.topic||o.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${f}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:v}),o.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:v}),new Date(o.started_at).toLocaleDateString()]}),e.jsx(L,{variant:"outline",className:`${H} h-4 px-1 ml-auto`,children:o.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:$===o.session_id,onClick:p=>{p.stopPropagation(),q(o)},children:[e.jsx(Oe,{className:`${v} mr-1`}),$===o.session_id?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:x===o.session_id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:p=>{p.stopPropagation(),D(o.session_id)},children:e.jsx(ye,{className:v})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:p=>{p.stopPropagation(),b(null)},children:e.jsx(pe,{className:v})})]}):e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:p=>{p.stopPropagation(),b(o.session_id)},children:e.jsx(Te,{className:v})})})]})]},o.session_id))]})]})})]})}function Rs(){const s=fe(),[i,w]=r.useState(null),[k,h]=r.useState(!1),[T,g]=r.useState(),[c,M]=r.useState([]),[x,b]=r.useState("Core"),[$,m]=r.useState(),[D,q]=r.useState(0),[o,p]=r.useState([]),[C,l]=r.useState([]),[j,N]=r.useState(""),[t,a]=r.useState("codex"),[y,R]=r.useState(!1),[P,K]=r.useState([]),[z,E]=r.useState(0),[F,G]=r.useState(null),[Q,B]=r.useState(!1),[Z,O]=r.useState(!1),{data:U=[]}=se({queryKey:["tutor-sessions"],queryFn:()=>A.tutor.listSessions({limit:10})}),u=r.useCallback(async()=>{h(!0);try{let d=$;!d&&C.length>0&&(d=(await A.tutor.createCustomChain(C,`Custom ${j||"Chain"}`)).id);const S=await A.tutor.createSession({course_id:T,phase:"first_pass",mode:x,topic:j||void 0,content_filter:{...c.length>0?{material_ids:c}:{},model:t,...y?{web_search:!0}:{}},method_chain_id:d});if(w(S.session_id),G(S.started_at),K([]),E(0),q(S.current_block_index??0),O(!1),$){const X=await A.tutor.getSession(S.session_id);X.chain_blocks&&p(X.chain_blocks.map(Y=>({id:Y.id,name:Y.name,category:Y.category,duration:Y.default_duration_min})))}else p([]);_.success("Tutor session started"),s.invalidateQueries({queryKey:["tutor-sessions"]})}catch(d){_.error(`Failed to start session: ${d instanceof Error?d.message:"Unknown"}`)}finally{h(!1)}},[T,x,j,c,t,y,$,C,s]),V=r.useCallback(async()=>{if(i)try{await A.tutor.endSession(i),_.success("Session ended"),w(null),K([]),E(0),G(null),q(0),p([]),B(!1),s.invalidateQueries({queryKey:["tutor-sessions"]})}catch(d){_.error(`Failed to end session: ${d instanceof Error?d.message:"Unknown"}`)}},[i,s]),ie=r.useCallback(async d=>{if(i)try{const S=await A.tutor.createArtifact(i,{type:d.type,content:d.content,title:d.title}),X={type:d.type,title:d.title||`${d.type} #${P.length+1}`,content:d.content.slice(0,200),createdAt:new Date().toISOString(),cardId:S.card_id};K(Y=>[...Y,X]),B(!0),_.success(`${d.type.charAt(0).toUpperCase()+d.type.slice(1)} created`)}catch(S){_.error(`Failed to create artifact: ${S instanceof Error?S.message:"Unknown"}`)}},[i,P.length]),me=r.useCallback(async()=>{if(i)try{const d=await A.tutor.advanceBlock(i);q(d.block_index),d.complete?_.success("Chain complete!"):_.success(`Advanced to: ${d.block_name}`)}catch(d){_.error(`Failed to advance block: ${d instanceof Error?d.message:"Unknown"}`)}},[i]),n=r.useCallback(async d=>{try{const S=await A.tutor.getSession(d);if(w(S.session_id),E(S.turn_count),G(S.started_at),b(S.mode),N(S.topic||""),g(S.course_id??void 0),S.artifacts_json)try{const X=JSON.parse(S.artifacts_json);Array.isArray(X)&&K(X.map(Y=>({type:Y.type,title:Y.title,content:"",createdAt:Y.created_at})))}catch{K([])}_.success("Session resumed")}catch(S){_.error(`Failed to resume session: ${S instanceof Error?S.message:"Unknown"}`)}},[]);return!i&&!Z?e.jsx(xe,{children:e.jsx("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"font-arcade text-xl text-primary tracking-widest mb-2",children:"ADAPTIVE TUTOR"}),e.jsx("p",{className:"font-terminal text-lg text-muted-foreground",children:"Pick a mode, set a topic, and start learning."})]}),e.jsxs("div",{className:"grid lg:grid-cols-[1fr_340px] gap-6",children:[e.jsx(je,{className:"bg-black/40 border-2 border-primary rounded-none overflow-hidden",children:e.jsx(Ee,{courseId:T,setCourseId:g,selectedMaterials:c,setSelectedMaterials:M,mode:x,setMode:b,chainId:$,setChainId:m,customBlockIds:C,setCustomBlockIds:l,topic:j,setTopic:N,model:t,setModel:a,webSearch:y,setWebSearch:R,onStartSession:u,isStarting:k,hasActiveSession:!1})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:te,children:"Recent Sessions"}),U.length===0?e.jsx("div",{className:`${f} text-center py-6`,children:"No sessions yet. Start one!"}):e.jsx("div",{className:"space-y-2",children:U.slice(0,8).map(d=>e.jsx(vs,{session:d,onResume:n},d.session_id))})]})]})]})})})}):Z&&i?e.jsx(xe,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:"rounded-none font-arcade text-xs text-primary h-8 px-3",children:"BACK TO CHAT"}),e.jsx("span",{className:"font-terminal text-base text-muted-foreground",children:"Editing session settings"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-2xl mx-auto py-6 px-4",children:e.jsx(je,{className:"bg-black/40 border-2 border-primary rounded-none overflow-hidden",children:e.jsx(Ee,{courseId:T,setCourseId:g,selectedMaterials:c,setSelectedMaterials:M,mode:x,setMode:b,chainId:$,setChainId:m,customBlockIds:C,setCustomBlockIds:l,topic:j,setTopic:N,model:t,setModel:a,webSearch:y,setWebSearch:R,onStartSession:u,isStarting:k,hasActiveSession:!0})})})})]})}):e.jsx(xe,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-2 bg-black/60 border-b-2 border-primary/30",children:[e.jsx(L,{variant:"outline",className:`${H} h-6 px-2 text-primary border-primary/50`,children:x}),j&&e.jsx("span",{className:"font-terminal text-base text-foreground truncate max-w-[300px]",children:j}),e.jsxs("div",{className:`flex items-center gap-3 ${f} ml-auto`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:v}),z]}),F&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:v}),new Date(F).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>O(!0),className:"h-7 w-7 p-0 rounded-none text-muted-foreground hover:text-primary",title:"Session settings",children:e.jsx(cs,{className:"w-4 h-4"})}),e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>B(!Q),className:`h-7 px-2 rounded-none font-terminal text-sm gap-1 ${Q?"text-primary bg-primary/10":"text-muted-foreground hover:text-primary"}`,title:"Toggle artifacts panel",children:[Q?e.jsx(os,{className:"w-4 h-4"}):e.jsx(Ve,{className:"w-4 h-4"}),P.length>0&&e.jsx(L,{variant:"outline",className:"text-xs h-5 px-1 rounded-none",children:P.length})]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsx("div",{className:"flex-1 bg-black/60 border-x-2 border-primary/20 flex flex-col min-w-0",children:e.jsx(ps,{sessionId:i,onArtifactCreated:ie,onSessionEnd:V,chainBlocks:o,currentBlockIndex:D,onAdvanceBlock:me})}),Q&&e.jsx("div",{className:"w-80 shrink-0 bg-black/40 border-l-2 border-primary/30 overflow-hidden",children:e.jsx(ys,{sessionId:i,artifacts:P,turnCount:z,mode:x,topic:j,startedAt:F,onCreateArtifact:ie,recentSessions:U,onResumeSession:n})})]})]})})}function vs({session:s,onResume:i}){const w=fe(),[k,h]=r.useState(!1),[T,g]=r.useState(!1),c=async()=>{try{await A.tutor.deleteSession(s.session_id),_.success("Session deleted"),w.invalidateQueries({queryKey:["tutor-sessions"]})}catch(x){_.error(`Delete failed: ${x instanceof Error?x.message:"Unknown"}`)}h(!1)},M=async()=>{g(!0);try{const x=await A.tutor.getSession(s.session_id);if(!x.turns||x.turns.length===0){_.error("No turns to save");return}const b=[`# Tutor: ${s.topic||s.mode}`,`**Date:** ${new Date(s.started_at).toLocaleDateString()}`,`**Mode:** ${s.mode} | **Turns:** ${s.turn_count}`,"","---",""];for(const m of x.turns)b.push(`## Q${m.turn_number}`),b.push(m.question),b.push(""),m.answer&&(b.push("**Answer:**"),b.push(m.answer),b.push(""));const $=`Tutor - ${(s.topic||s.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`;await A.obsidian.append(`Study Sessions/${$}.md`,b.join(`
`)),_.success("Saved to Obsidian")}catch(x){_.error(`Save failed: ${x instanceof Error?x.message:"Unknown"}`)}finally{g(!1)}};return e.jsxs("div",{className:"border-2 border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>i(s.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:`${H} h-5 px-1.5 shrink-0 ${s.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:s.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:s.topic||s.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${f}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:v}),s.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:v}),new Date(s.started_at).toLocaleDateString()]}),e.jsx(L,{variant:"outline",className:`${H} h-4 px-1 ml-auto`,children:s.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:T,onClick:M,children:[e.jsx(Oe,{className:`${v} mr-1`}),T?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:k?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:c,children:e.jsx(ye,{className:v})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:()=>h(!1),children:e.jsx(pe,{className:v})})]}):e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:()=>h(!0),children:e.jsx(Te,{className:v})})})]})]})}export{Rs as default};
