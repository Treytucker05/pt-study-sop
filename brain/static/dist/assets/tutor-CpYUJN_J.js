import{c as U,j as t,r as f,m as $,d as Q}from"./index-vVCQ6IRb.js";import{u as B,S as H,B as q,o as D,L as J}from"./index-BladwfPm.js";import{C as z}from"./card-lz2euxC_.js";import{B as w}from"./badge-B-bQCjUJ.js";import{C as G}from"./checkbox-DC0aIlak.js";import{L}from"./loader-circle-DatGjMHo.js";import{a as Z,D as W,M as tt,r as et,F as V,b as K}from"./index-BJNc-I4n.js";import{Z as at}from"./zap-DBBHwsim.js";import{S as rt}from"./send-p6DebtSv.js";import{M as st}from"./message-square-j3K78Tt8.js";import{C as ot}from"./clock-DJ4HVU0u.js";import{B as nt}from"./book-open-Diz_6nYu.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],X=U("credit-card",it);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],lt=U("square",dt),ct=[{value:"Core",label:"CORE",desc:"Teach First — new material"},{value:"Sprint",label:"SPRINT",desc:"Test-First — find gaps"},{value:"Drill",label:"DRILL",desc:"Deep Practice — lock concepts"},{value:"Teaching Sprint",label:"TEACH",desc:"Quick focused lesson"},{value:"Diagnostic Sprint",label:"DIAG",desc:"Assess knowledge"}];function ut({courseId:d,setCourseId:a,selectedFolders:e,setSelectedFolders:i,mode:b,setMode:c,topic:m,setTopic:x,onStartSession:n,isStarting:r,hasActiveSession:h}){const{data:l,isLoading:y}=B({queryKey:["tutor-content-sources"],queryFn:()=>D.tutor.getContentSources()}),s=o=>{i(e.includes(o)?e.filter(E=>E!==o):[...e,o])},p=l?.folders.filter(o=>!d||o.course_id===d);return t.jsxs("div",{className:"flex flex-col h-full gap-3 p-3",children:[t.jsx("div",{className:"font-arcade text-xs text-primary tracking-wider",children:"CONTENT FILTER"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-[10px] font-terminal text-muted-foreground uppercase tracking-wider",children:"Phase: First Pass"}),t.jsx("div",{className:"grid grid-cols-1 gap-1",children:ct.map(o=>t.jsxs("button",{onClick:()=>c(o.value),className:`text-left px-2 py-1.5 border-2 text-xs font-terminal transition-colors ${b===o.value?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 hover:border-primary/50 text-muted-foreground"}`,children:[t.jsx("span",{className:"font-arcade text-[10px]",children:o.label}),t.jsx("span",{className:"ml-2 text-[10px] opacity-70",children:o.desc})]},o.value))})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-[10px] font-terminal text-muted-foreground uppercase tracking-wider",children:"Topic"}),t.jsx("input",{value:m,onChange:o=>x(o.target.value),placeholder:"e.g. Hip Flexors",className:"w-full bg-black/60 border-2 border-muted-foreground/30 px-2 py-1.5 text-xs font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-[10px] font-terminal text-muted-foreground uppercase tracking-wider",children:"Course"}),y?t.jsx(L,{className:"w-4 h-4 animate-spin text-muted-foreground"}):t.jsxs("div",{className:"space-y-1",children:[t.jsxs("button",{onClick:()=>a(void 0),className:`w-full text-left px-2 py-1 text-xs font-terminal border-2 ${d?"border-transparent text-muted-foreground hover:text-foreground":"border-primary text-primary"}`,children:["All Courses",t.jsx(w,{variant:"outline",className:"ml-2 text-[10px] rounded-none",children:l?.total_docs??0})]}),l?.courses.map(o=>t.jsxs("button",{onClick:()=>a(o.id),className:`w-full text-left px-2 py-1 text-xs font-terminal border-2 ${d===o.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[o.name,t.jsx(w,{variant:"outline",className:"ml-2 text-[10px] rounded-none",children:o.doc_count})]},o.id))]})]}),p&&p.length>0&&t.jsxs("div",{className:"space-y-1 flex-1 min-h-0",children:[t.jsxs("label",{className:"text-[10px] font-terminal text-muted-foreground uppercase tracking-wider flex items-center gap-1",children:[t.jsx(Z,{className:"w-3 h-3"}),"Folders"]}),t.jsx(H,{className:"flex-1 max-h-32",children:t.jsx("div",{className:"space-y-1",children:p.map(o=>t.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 text-xs font-terminal text-muted-foreground hover:text-foreground cursor-pointer",children:[t.jsx(G,{checked:e.includes(o.folder_path),onCheckedChange:()=>s(o.folder_path)}),t.jsx("span",{className:"truncate flex-1",children:o.folder_path}),t.jsx(w,{variant:"outline",className:"text-[10px] rounded-none",children:o.doc_count})]},o.folder_path))})})]}),t.jsxs(q,{onClick:n,disabled:r||h,className:"w-full rounded-none border-2 border-primary font-arcade text-xs",children:[r?t.jsx(L,{className:"w-4 h-4 animate-spin mr-2"}):t.jsx(at,{className:"w-4 h-4 mr-2"}),h?"SESSION ACTIVE":"START SESSION"]}),t.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-terminal text-muted-foreground",children:[t.jsx(W,{className:"w-3 h-3"}),l?.total_docs??0," docs indexed"]})]})}function mt({sessionId:d,onArtifactCreated:a,onSessionEnd:e}){const[i,b]=f.useState([]),[c,m]=f.useState(""),[x,n]=f.useState(!1),r=f.useRef(null),h=f.useRef(null);f.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[i]),f.useEffect(()=>{h.current?.focus()},[d]);const l=f.useCallback(async()=>{if(!c.trim()||!d||x)return;const s=c.trim();m("");const p=/^\/(note|save)\b/i.test(s),o=/^\/(card|flashcard)\b/i.test(s),E=/^\/(map|diagram)\b/i.test(s);b(j=>[...j,{role:"user",content:s}]),b(j=>[...j,{role:"assistant",content:"",isStreaming:!0}]),n(!0);try{const k=(await fetch(`/api/tutor/session/${d}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s})})).body?.getReader(),_=new TextDecoder;if(!k)throw new Error("No response body");let F="",I="",O=[];for(;;){const{done:R,value:u}=await k.read();if(R)break;F+=_.decode(u,{stream:!0});const g=F.split(`
`);F=g.pop()??"";for(const A of g){if(!A.startsWith("data: "))continue;const S=A.slice(6);if(S==="[DONE]")break;try{const C=JSON.parse(S);if(C.type==="error"){b(Y=>{const N=[...Y];return N[N.length-1]={role:"assistant",content:`Error: ${C.content}`},N}),n(!1);return}C.type==="token"&&C.content&&(I+=C.content,b(Y=>{const N=[...Y],P=N[N.length-1];return N[N.length-1]={...P,content:P.content+C.content,isStreaming:!0},N})),C.type==="done"&&(O=C.citations??[])}catch{}}}b(R=>{const u=[...R];return u[u.length-1]={role:"assistant",content:I,citations:O,isStreaming:!1},u}),(p||o||E)&&a({type:p?"note":o?"card":"map",content:I,title:s.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(j){b(k=>{const _=[...k];return _[_.length-1]={role:"assistant",content:`Connection error: ${j instanceof Error?j.message:"Unknown"}`},_})}finally{n(!1)}},[c,d,x,a]),y=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),l())};return d?t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{ref:r,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[i.length===0&&t.jsxs("div",{className:"text-center py-8 space-y-2",children:[t.jsx("div",{className:"font-arcade text-xs text-primary",children:"SESSION STARTED"}),t.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),i.map((s,p)=>t.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-xs font-terminal ${s.role==="user"?"bg-primary/20 border-2 border-primary/50 text-foreground":"bg-black/40 border-2 border-muted-foreground/20 text-foreground"}`,children:[s.role==="assistant"?t.jsxs("div",{className:"prose prose-invert prose-xs max-w-none [&_p]:my-1 [&_li]:my-0.5 [&_h1]:text-sm [&_h2]:text-xs [&_h3]:text-xs [&_code]:text-[10px] [&_pre]:text-[10px]",children:[t.jsx(tt,{remarkPlugins:[et],children:s.content||(s.isStreaming?"...":"")}),s.isStreaming&&t.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):t.jsx("div",{children:s.content}),s.citations&&s.citations.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-2 pt-2 border-t border-muted-foreground/20",children:s.citations.map(o=>t.jsxs(w,{variant:"outline",className:"text-[10px] rounded-none",children:["[",o.index,"] ",o.source]},o.index))})]})},p))]}),t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 border-t border-muted-foreground/20",children:[t.jsx("span",{className:"text-[10px] font-terminal text-muted-foreground/50",children:"Commands:"}),t.jsxs(w,{variant:"outline",className:"text-[10px] rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>m("/note "),children:[t.jsx(V,{className:"w-2.5 h-2.5 mr-1"}),"/note"]}),t.jsxs(w,{variant:"outline",className:"text-[10px] rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>m("/card "),children:[t.jsx(X,{className:"w-2.5 h-2.5 mr-1"}),"/card"]}),t.jsxs(w,{variant:"outline",className:"text-[10px] rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>m("/map "),children:[t.jsx(K,{className:"w-2.5 h-2.5 mr-1"}),"/map"]}),t.jsx("div",{className:"flex-1"}),t.jsxs(q,{variant:"ghost",size:"sm",onClick:e,className:"text-[10px] font-terminal text-destructive hover:text-destructive h-5 px-2",children:[t.jsx(lt,{className:"w-2.5 h-2.5 mr-1"}),"END"]})]}),t.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-muted-foreground/30",children:[t.jsx("input",{ref:h,value:c,onChange:s=>m(s.target.value),onKeyDown:y,placeholder:"Ask a question...",disabled:x,className:"flex-1 bg-black/60 border-2 border-muted-foreground/30 px-3 py-2 text-xs font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),t.jsx(q,{onClick:l,disabled:!c.trim()||x,className:"rounded-none border-2 border-primary h-9 w-9 p-0",children:x?t.jsx(L,{className:"w-4 h-4 animate-spin"}):t.jsx(rt,{className:"w-4 h-4"})})]})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),t.jsx("div",{className:"font-terminal text-xs text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const ft={note:V,card:X,map:K},pt={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function xt({sessionId:d,artifacts:a,turnCount:e,mode:i,topic:b,startedAt:c,recentSessions:m,onResumeSession:x}){return t.jsxs("div",{className:"flex flex-col h-full gap-3 p-3",children:[t.jsx("div",{className:"font-arcade text-xs text-primary tracking-wider",children:"ARTIFACTS"}),d?t.jsxs("div",{className:"space-y-1 pb-2 border-b border-muted-foreground/20",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(w,{variant:"outline",className:"text-[10px] rounded-none",children:i}),t.jsx(w,{variant:"outline",className:"text-[10px] rounded-none text-primary",children:"FIRST PASS"})]}),b&&t.jsx("div",{className:"text-xs font-terminal text-foreground truncate",children:b}),t.jsxs("div",{className:"flex items-center gap-3 text-[10px] font-terminal text-muted-foreground",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(st,{className:"w-3 h-3"}),e," turns"]}),c&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ot,{className:"w-3 h-3"}),new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):t.jsx("div",{className:"text-xs font-terminal text-muted-foreground/50 py-4 text-center",children:"No active session"}),a.length>0?t.jsx(H,{className:"flex-1",children:t.jsx("div",{className:"space-y-2",children:a.map((n,r)=>{const h=ft[n.type],l=pt[n.type];return t.jsxs("div",{className:"border-2 border-muted-foreground/20 p-2 hover:border-primary/30 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(h,{className:`w-3.5 h-3.5 ${l}`}),t.jsx("span",{className:"text-[10px] font-terminal text-foreground truncate flex-1",children:n.title||`${n.type} #${r+1}`})]}),n.content&&t.jsx("div",{className:"text-[10px] font-terminal text-muted-foreground mt-1 line-clamp-2",children:n.content.slice(0,100)})]},r)})})}):d?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx(nt,{className:"w-6 h-6 text-muted-foreground/30 mx-auto"}),t.jsx("div",{className:"text-[10px] font-terminal text-muted-foreground/50",children:"No artifacts yet"}),t.jsx("div",{className:"text-[10px] font-terminal text-muted-foreground/30",children:"Use /note, /card, or /map"})]})}):null,m.length>0&&t.jsxs("div",{className:"space-y-1 pt-2 border-t border-muted-foreground/20",children:[t.jsx("div",{className:"text-[10px] font-terminal text-muted-foreground uppercase tracking-wider",children:"Recent Sessions"}),t.jsx("div",{className:"space-y-1",children:m.slice(0,5).map(n=>t.jsxs("button",{onClick:()=>x(n.session_id),className:"w-full text-left px-2 py-1.5 border-2 border-transparent hover:border-muted-foreground/30 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(w,{variant:"outline",className:`text-[10px] rounded-none ${n.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:n.status==="active"?"LIVE":"DONE"}),t.jsx("span",{className:"text-[10px] font-terminal text-foreground truncate flex-1",children:n.topic||n.mode})]}),t.jsxs("div",{className:"text-[10px] font-terminal text-muted-foreground/50 mt-0.5",children:[n.turn_count," turns ·"," ",new Date(n.started_at).toLocaleDateString()]})]},n.session_id))})]})]})}function ht(d){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",a.appendChild(e),e.styleSheet?e.styleSheet.cssText=d:e.appendChild(document.createTextNode(d))}Array(12).fill(0);let M=1;class gt{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{const e=this.subscribers.indexOf(a);this.subscribers.splice(e,1)}),this.publish=a=>{this.subscribers.forEach(e=>e(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var e;const{message:i,...b}=a,c=typeof a?.id=="number"||((e=a.id)==null?void 0:e.length)>0?a.id:M++,m=this.toasts.find(n=>n.id===c),x=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(c)&&this.dismissedToasts.delete(c),m?this.toasts=this.toasts.map(n=>n.id===c?(this.publish({...n,...a,id:c,title:i}),{...n,...a,id:c,dismissible:x,title:i}):n):this.addToast({title:i,...b,dismissible:x,id:c}),c},this.dismiss=a=>(a?(this.dismissedToasts.add(a),requestAnimationFrame(()=>this.subscribers.forEach(e=>e({id:a,dismiss:!0})))):this.toasts.forEach(e=>{this.subscribers.forEach(i=>i({id:e.id,dismiss:!0}))}),a),this.message=(a,e)=>this.create({...e,message:a}),this.error=(a,e)=>this.create({...e,message:a,type:"error"}),this.success=(a,e)=>this.create({...e,type:"success",message:a}),this.info=(a,e)=>this.create({...e,type:"info",message:a}),this.warning=(a,e)=>this.create({...e,type:"warning",message:a}),this.loading=(a,e)=>this.create({...e,type:"loading",message:a}),this.promise=(a,e)=>{if(!e)return;let i;e.loading!==void 0&&(i=this.create({...e,promise:a,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));const b=Promise.resolve(a instanceof Function?a():a);let c=i!==void 0,m;const x=b.then(async r=>{if(m=["resolve",r],$.isValidElement(r))c=!1,this.create({id:i,type:"default",message:r});else if(yt(r)&&!r.ok){c=!1;const l=typeof e.error=="function"?await e.error(`HTTP error! status: ${r.status}`):e.error,y=typeof e.description=="function"?await e.description(`HTTP error! status: ${r.status}`):e.description,p=typeof l=="object"&&!$.isValidElement(l)?l:{message:l};this.create({id:i,type:"error",description:y,...p})}else if(r instanceof Error){c=!1;const l=typeof e.error=="function"?await e.error(r):e.error,y=typeof e.description=="function"?await e.description(r):e.description,p=typeof l=="object"&&!$.isValidElement(l)?l:{message:l};this.create({id:i,type:"error",description:y,...p})}else if(e.success!==void 0){c=!1;const l=typeof e.success=="function"?await e.success(r):e.success,y=typeof e.description=="function"?await e.description(r):e.description,p=typeof l=="object"&&!$.isValidElement(l)?l:{message:l};this.create({id:i,type:"success",description:y,...p})}}).catch(async r=>{if(m=["reject",r],e.error!==void 0){c=!1;const h=typeof e.error=="function"?await e.error(r):e.error,l=typeof e.description=="function"?await e.description(r):e.description,s=typeof h=="object"&&!$.isValidElement(h)?h:{message:h};this.create({id:i,type:"error",description:l,...s})}}).finally(()=>{c&&(this.dismiss(i),i=void 0),e.finally==null||e.finally.call(e)}),n=()=>new Promise((r,h)=>x.then(()=>m[0]==="reject"?h(m[1]):r(m[1])).catch(h));return typeof i!="string"&&typeof i!="number"?{unwrap:n}:Object.assign(i,{unwrap:n})},this.custom=(a,e)=>{const i=e?.id||M++;return this.create({jsx:a(i),id:i,...e}),i},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const v=new gt,bt=(d,a)=>{const e=a?.id||M++;return v.addToast({title:d,...a,id:e}),e},yt=d=>d&&typeof d=="object"&&"ok"in d&&typeof d.ok=="boolean"&&"status"in d&&typeof d.status=="number",vt=bt,wt=()=>v.toasts,jt=()=>v.getActiveToasts(),T=Object.assign(vt,{success:v.success,info:v.info,warning:v.warning,error:v.error,custom:v.custom,message:v.message,promise:v.promise,dismiss:v.dismiss,loading:v.loading},{getHistory:wt,getToasts:jt});ht("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function Ot(){const d=Q(),[a,e]=f.useState(null),[i,b]=f.useState(!1),[c,m]=f.useState(),[x,n]=f.useState([]),[r,h]=f.useState("Core"),[l,y]=f.useState(""),[s,p]=f.useState([]),[o,E]=f.useState(0),[j,k]=f.useState(null),{data:_=[]}=B({queryKey:["tutor-sessions"],queryFn:()=>D.tutor.listSessions({limit:10})}),F=f.useCallback(async()=>{b(!0);try{const u=await D.tutor.createSession({course_id:c,phase:"first_pass",mode:r,topic:l||void 0,content_filter:x.length>0?{folders:x}:void 0});e(u.session_id),k(u.started_at),p([]),E(0),T.success("Tutor session started"),d.invalidateQueries({queryKey:["tutor-sessions"]})}catch(u){T.error(`Failed to start session: ${u instanceof Error?u.message:"Unknown"}`)}finally{b(!1)}},[c,r,l,x,d]),I=f.useCallback(async()=>{if(a)try{await D.tutor.endSession(a),T.success("Session ended"),e(null),p([]),E(0),k(null),d.invalidateQueries({queryKey:["tutor-sessions"]})}catch(u){T.error(`Failed to end session: ${u instanceof Error?u.message:"Unknown"}`)}},[a,d]),O=f.useCallback(async u=>{if(a)try{const g=await D.tutor.createArtifact(a,{type:u.type,content:u.content,title:u.title}),A={type:u.type,title:u.title||`${u.type} #${s.length+1}`,content:u.content.slice(0,200),createdAt:new Date().toISOString(),cardId:g.card_id};p(S=>[...S,A]),T.success(`${u.type.charAt(0).toUpperCase()+u.type.slice(1)} created`)}catch(g){T.error(`Failed to create artifact: ${g instanceof Error?g.message:"Unknown"}`)}},[a,s.length]),R=f.useCallback(async u=>{try{const g=await D.tutor.getSession(u);if(e(g.session_id),E(g.turn_count),k(g.started_at),h(g.mode),y(g.topic||""),m(g.course_id??void 0),g.artifacts_json)try{const A=JSON.parse(g.artifacts_json);Array.isArray(A)&&p(A.map(S=>({type:S.type,title:S.title,content:"",createdAt:S.created_at})))}catch{p([])}T.success("Session resumed")}catch(g){T.error(`Failed to resume session: ${g instanceof Error?g.message:"Unknown"}`)}},[]);return t.jsx(J,{children:t.jsxs("div",{className:"h-[calc(100vh-140px)] flex gap-2",children:[t.jsx(z,{className:"w-56 shrink-0 bg-black/40 border-2 border-primary rounded-none overflow-y-auto",children:t.jsx(ut,{courseId:c,setCourseId:m,selectedFolders:x,setSelectedFolders:n,mode:r,setMode:h,topic:l,setTopic:y,onStartSession:F,isStarting:i,hasActiveSession:!!a})}),t.jsx(z,{className:"flex-1 bg-black/60 border-2 border-primary rounded-none flex flex-col min-w-0",children:t.jsx(mt,{sessionId:a,onArtifactCreated:O,onSessionEnd:I})}),t.jsx(z,{className:"w-56 shrink-0 bg-black/40 border-2 border-secondary rounded-none overflow-y-auto",children:t.jsx(xt,{sessionId:a,artifacts:s,turnCount:o,mode:r,topic:l,startedAt:j,onCreateArtifact:O,recentSessions:_,onResumeSession:R})})]})})}export{Ot as default};
