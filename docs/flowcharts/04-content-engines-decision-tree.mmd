%% PT Study SOP - Content Engine Selection & Flow
%% How to choose and execute Anatomy vs Concept Engine

flowchart TD
    Start([M3 Encode:<br/>Bucket Selected]) --> Question{Topic Type?}

    question -->|Regional/Spatial<br/>Anatomy| Anatomy["ANATOMY ENGINE<br/>━━━━━━━━━━━━━━<br/>(e.g., hip, arm,<br/>posterior chain)"]

    Question -->|Abstract/<br/>Non-Spatial| Concept["CONCEPT ENGINE<br/>━━━━━━━━━━━━━━<br/>(e.g., physiology,<br/>pharmacology, physics)"]

    Anatomy --> AStep1["STEP 1: BONES<br/>─────────────<br/>What bones are in<br/>this region?<br/><br/>Build SCAFFOLD<br/>- List exam-required bones<br/>- See as 3D structure<br/>- No detail yet"]

    AStep1 --> AStep2["STEP 2: LANDMARKS<br/>────────────────<br/>Where are attachment<br/>points?<br/><br/>Run LANDMARK PASS<br/>per landmark:<br/>1. VISUAL (shape, size,\n   texture)<br/>2. SPATIAL (sup/inf,\n   ant/post, med/lat)<br/>3. NEIGHBORS\n   (nearby landmarks)<br/>4. ATTACHMENTS\n   (muscle names only)"]

    AStep2 --> AStep3["STEP 3: ATTACHMENTS<br/>───────────────────<br/>Which muscles connect<br/>where?<br/><br/>Build ATTACHMENT MAP<br/>before OIANA+ details<br/>- Table: Landmark →\n  Origins | Insertions<br/>- See muscle landscape\n  on bone"]

    AStep3 --> AStep4["STEP 4-7: OIANA+ + CLINICAL<br/>───────────────────────────<br/>Per muscle:<br/>- O: Origin (bone/landmark)<br/>- I: Insertion (bone/landmark)<br/>- A: Actions<br/>- N: Nerve + root levels<br/>- Artery: Blood supply<br/>- Clinical: Application\n  (what happens if fails)"]

    AStep4 --> ARollback{Recall<br/>Failure?}
    ARollback -->|Yes| ABacktrack["ROLLBACK<br/>────────<br/>Step back to<br/>Landmark Pass or\n Attachment Map<br/>Rebuild foundation"]
    ABacktrack --> AStep2
    ARollback -->|No| ARec["✓ Receipt Confident<br/>Learner ready for<br/>retrieval practice"]

    ARec --> Concept_End["Proceed to M4 Build<br/>Apply progressive ladder"]

    Concept --> CStep1["STEP 1: DEFINITION<br/>────────────────<br/>L2 plain-language<br/>one-sentence hook<br/><br/>Ask learner FIRST<br/>for their definition<br/>Generation-first"]

    CStep1 --> CStep2["STEP 2: CONTEXT<br/>───────────────<br/>Place in hierarchy<br/>(H1/H-series map or<br/>outline)<br/><br/>Ask learner:<br/>'Where does this fit?'"]

    CStep2 --> CStep3["STEP 3: MECHANISM<br/>─────────────────<br/>Input → Process → Output<br/>(or Cause → Steps → Effect)<br/><br/>Ask learner:\n'How does it work?'"]

    CStep3 --> CStep4["STEP 4: DIFFERENTIATION<br/>──────────────────<br/>One near neighbor<br/>Example vs near-miss<br/><br/>Ask learner:\n'How is X different<br/>from Y?'"]

    CStep4 --> CStep5["STEP 5: APPLICATION<br/>────────────────<br/>One short problem/case<br/>Learner answers<br/>AI verifies<br/><br/>Ask learner:\n'Solve this case'"]

    CStep5 --> CRollback{Gaps or<br/>Misunderstanding?}
    CRollback -->|Yes| CBacktrack["BACKTRACK<br/>─────────<br/>Rebuild at failed step<br/>Re-explain mechanism or\n re-compare near neighbor"]
    CBacktrack --> CStep3
    CRollback -->|No| CRec["✓ Receipt Confident<br/>Learner can:<br/>- State definition<br/>- Place in context<br/>- Explain mechanism<br/>- Distinguish from neighbor<br/>- Solve application"]

    CRec --> Concept_End

    Concept_End --> M4["→ Proceed to M4: BUILD<br/>────────────────────<br/>Progressive Ladder:<br/>Guided → Faded →<br/>Independent → Interleaved"]

    style Anatomy fill:#ffab91,stroke:#333,color:#000
    style Concept fill:#b2dfdb,stroke:#333,color:#000
    style AStep1 fill:#ffe0b2,stroke:#333,color:#000
    style AStep2 fill:#fff59d,stroke:#333,color:#000
    style AStep3 fill:#c8e6c9,stroke:#333,color:#000
    style AStep4 fill:#b3e5fc,stroke:#333,color:#000
    style ARec fill:#90ee90,stroke:#333,color:#000
    style CStep1 fill:#e1bee7,stroke:#333,color:#000
    style CStep2 fill:#f8bbd0,stroke:#333,color:#000
    style CStep3 fill:#ffccbc,stroke:#333,color:#000
    style CStep4 fill:#ffe0b2,stroke:#333,color:#000
    style CStep5 fill:#fff59d,stroke:#333,color:#000
    style CRec fill:#90ee90,stroke:#333,color:#000
    style M4 fill:#4ecdc4,stroke:#333,color:#fff
